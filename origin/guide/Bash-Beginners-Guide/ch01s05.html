<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>5. Developing good scripts</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="Linux, Scripts, linux, Bash, guide, Guide, Exercises, exercises, bash, scripting, Scripting, awk, sed, variables, functions, loops, conditionals"><link rel="home" href="index.html" title="Bash Guide for Beginners"><link rel="up" href="ch01.html" title="Chapter 1. Bash and Bash scripts"><link rel="prev" href="ch01s04.html" title="4. Building blocks"><link rel="next" href="ch01s06.html" title="6. Summary"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. Developing good scripts</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch01s04.html">Prev</a> </td><th width="60%" align="center">Chapter 1. Bash and Bash scripts</th><td width="20%" align="right"> <a accesskey="n" href="ch01s06.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sect_01_05"></a>5. Developing good scripts</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_01_05_01"></a>5.1. Properties of good scripts</h3></div></div></div><p>This guide is mainly about the last shell building block, scripts.  Some general considerations<a class="indexterm" name="idm1105"></a> before we continue:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>A script should run without errors.</p></li><li class="listitem"><p>It should perform the task for which it is intended.</p></li><li class="listitem"><p>Program logic is clearly defined and apparent.</p></li><li class="listitem"><p>A script does not do unnecessary work.</p></li><li class="listitem"><p>Scripts should be reusable.</p></li></ol></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_01_05_02"></a>5.2. Structure</h3></div></div></div><p>The structure<a class="indexterm" name="idm1122"></a> of a shell script is very flexible.  Even though in Bash a lot of freedom is granted, you must ensure correct logic, flow control and efficiency so that users executing the script can do so easily and correctly.</p><p>When starting on a new script, ask yourself the following questions:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Will I be needing any information from the user or from the user's environment?</p></li><li class="listitem"><p>How will I store that information?</p></li><li class="listitem"><p>Are there any files that need to be created?  Where and with which permissions and ownerships?</p></li><li class="listitem"><p>What commands will I use?  When using the script on different systems, do all these systems have these commands in the required versions?</p></li><li class="listitem"><p>Does the user need any notifications?  When and why?</p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_01_05_03"></a>5.3. Terminology</h3></div></div></div><p>The table below gives an overview of programming terms<a class="indexterm" name="idm1140"></a> that you need to be familiar with:</p><div class="table"><a name="table_01_01"></a><p class="title"><b>Table 1.1. Overview of programming terms</b></p><div class="table-contents"><table class="table" summary="Overview of programming terms" border="1"><colgroup><col><col></colgroup><thead><tr><th align="left">Term</th><th align="left">What is it?</th></tr></thead><tbody><tr><td align="left">Command control</td><td align="left">Testing exit status of a command in order to determine whether a portion of the program should be executed.</td></tr><tr><td align="left">Conditional branch</td><td align="left">Logical point in the program when a condition determines what happens next.</td></tr><tr><td align="left">Logic flow</td><td align="left">The overall design of the program.  Determines logical sequence of tasks so that the result is successful and controlled.</td></tr><tr><td align="left">Loop</td><td align="left">Part of the program that is performed zero or more times.</td></tr><tr><td align="left">User input</td><td align="left">Information provided by an external source while the program is running, can be stored and recalled when needed.</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_01_05_04"></a>5.4. A word on order and logic</h3></div></div></div><p>In order to speed up the developing process, the logical<a class="indexterm" name="idm1169"></a> order of a program should be thought over in advance.  This is your first step when developing a script.</p><p>A number of methods can be used; one of the most common is working with lists.  Itemizing the list of tasks involved in a program allows you to describe each process.  Individual tasks can be referenced by their item number.</p><p>Using your own spoken language to pin down the tasks to be executed by your program will help you to create an understandable form of your program.  Later, you can replace the everyday language statements with shell language words and constructs.</p><p>The example<a class="indexterm" name="idm1175"></a> below shows such a logic flow design.  It describes the rotation of log files.  This example shows a possible repetitive loop, controlled by the number of base log files you want to rotate:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Do you want to rotate logs?</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>If yes:</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>Enter directory name containing the logs to be rotated.</p></li><li class="listitem"><p>Enter base name of the log file.</p></li><li class="listitem"><p>Enter number of days logs should be kept.</p></li><li class="listitem"><p>Make settings permanent in user's crontab file.</p></li></ol></div></li><li class="listitem"><p>If no, go to step 3.</p></li></ol></div></li><li class="listitem"><p>Do you want to rotate another set of logs?</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>If yes: repeat step 1.</p></li><li class="listitem"><p>If no: go to step 3.</p></li></ol></div></li><li class="listitem"><p>Exit</p></li></ol></div><p>The user should provide information for the program to do something.  Input from the user must be obtained and stored.  The user should be notified that his crontab will change.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_01_05_05"></a>5.5. An example<a class="indexterm" name="idm1207"></a> Bash script: mysystem.sh</h3></div></div></div><p>The <code class="filename">mysystem.sh</code> script below executes some well-known commands (<span class="command"><strong>date</strong></span>, <span class="command"><strong>w</strong></span>, <span class="command"><strong>uname</strong></span>, <span class="command"><strong>uptime</strong></span>) to display information about you and your machine.</p><pre class="screen">
<code class="prompt">tom:~&gt;</code> <span class="command"><strong>cat <code class="option">-n</code> <code class="filename">mysystem.sh</code></strong></span>
     1  #!/bin/bash
     2  clear
     3  echo "This is information provided by mysystem.sh.  Program starts now."
     4
     5  echo "Hello, $USER"
     6  echo
     7
     8  echo "Today's date is `date`, this is week `date +"%V"`."
     9  echo
    10
    11  echo "These users are currently connected:"
    12  w | cut -d " " -f 1 - | grep -v USER | sort -u
    13  echo
    14
    15  echo "This is `uname -s` running on a `uname -m` processor."
    16  echo
    17
    18  echo "This is the uptime information:"
    19  uptime
    20  echo
    21
    22  echo "That's all folks!"
</pre><p>A script always starts with the same two characters, <span class="quote">&#8220;<span class="quote">#!</span>&#8221;</span>.  After that, the shell that will execute the commands following the first line is defined.  This script starts with clearing the screen on line 2.  Line 3 makes it print a message, informing the user about what is going to happen.  Line 5 greets the user.  Lines 6, 9, 13, 16 and 20 are only there for orderly output display purposes.  Line 8 prints the current date and the number of the week.  Line 11 is again an informative message, like lines 3, 18 and 22.  Line 12 formats the output of the <span class="command"><strong>w</strong></span>; line 15 shows operating system and CPU information.  Line 19 gives the uptime and load information.</p><p>Both <span class="command"><strong>echo</strong></span> and <span class="command"><strong>printf</strong></span> are Bash built-in commands.  The first always exits with a 0 status, and simply prints arguments followed by an end of line character on the standard output, while the latter allows for definition of a formatting string and gives a non-zero exit status code upon failure.</p><p>This is the same script using the <span class="command"><strong>printf</strong></span> built-in:</p><pre class="screen">
<code class="prompt">tom:~&gt;</code> <span class="command"><strong>cat <code class="filename">mysystem.sh</code></strong></span>
#!/bin/bash
clear
printf "This is information provided by mysystem.sh.  Program starts now.\n"

printf "Hello, $USER.\n\n"

printf "Today's date is `date`, this is week `date +"%V"`.\n\n"

printf "These users are currently connected:\n"
w | cut -d " " -f 1 - | grep -v USER | sort -u
printf "\n"

printf "This is `uname -s` running on a `uname -m` processor.\n\n"

printf "This is the uptime information:\n"
uptime
printf "\n"

printf "That's all folks!\n"
</pre><p>Creating user friendly scripts by means of inserting messages is treated in <a class="xref" href="ch08.html" title="Chapter 8. Writing interactive scripts">Chapter 8, <i>Writing interactive scripts</i></a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Standard location of the Bourne Again shell</h3><p>This implies that the <span class="command"><strong>bash</strong></span> program is installed in <code class="filename">/bin</code>.</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">If stdout is not available</h3><p>If you execute a script from cron, supply full path names and redirect output and errors.  Since the shell runs in non-interactive mode, any errors will cause the script to exit prematurely if you don't think about this.</p></div><p>The following chapters will discuss the details of the above scripts.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_01_05_06"></a>5.6. Example init script</h3></div></div></div><p>An init script<a class="indexterm" name="idm1247"></a> starts system services on UNIX and Linux machines.  The system log daemon, the power management daemon, the name and mail daemons are common examples.  These scripts, also known as startup scripts, are stored in a specific location on your system, such as <code class="filename">/etc/rc.d/init.d</code> or <code class="filename">/etc/init.d</code>.  Init, the initial process, reads its configuration files and decides which services to start or stop in each run level.  A run level is a configuration of processes; each system has a single user run level, for instance, for performing administrative tasks, for which the system has to be in an unused state as much as possible, such as recovering a critical file system from a backup.  Reboot and shutdown run levels are usually also configured.</p><p>The tasks to be executed upon starting a service or stopping it are listed in the startup scripts.  It is one of the system administrator's tasks to configure <span class="command"><strong>init</strong></span>, so that services are started and stopped at the correct moment.  When confronted with this task, you need a good understanding of the startup and shutdown procedures on your system.  We therefore advise that you read the man pages for <span class="command"><strong>init</strong></span> and <code class="filename">inittab</code> before starting on your own initialization scripts.</p><p>Here is a very simple example, that will play a sound upon starting<a class="indexterm" name="idm1257"></a> and stopping your machine:</p><pre class="screen">
#!/bin/bash

# This script is for /etc/rc.d/init.d
# Link in rc3.d/S99audio-greeting and rc0.d/K01audio-greeting

case "$1" in
'start')
  cat /usr/share/audio/at_your_service.au &gt; /dev/audio
  ;;
'stop')
  cat /usr/share/audio/oh_no_not_again.au &gt; /dev/audio
  ;;
esac
exit 0
</pre><p>The <span class="command"><strong>case</strong></span> statement often used in this kind of script is described in <a class="xref" href="ch07s02.html#sect_07_02_05" title="2.5. Using the exit statement and if">Section 2.5, &#8220;Using the exit statement and if&#8221;</a>.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch01s04.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch01.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch01s06.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4. Building blocks </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 6. Summary</td></tr></table></div></body></html>
