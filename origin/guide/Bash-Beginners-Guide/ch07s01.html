<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>1. Introduction to if</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="Linux, Scripts, linux, Bash, guide, Guide, Exercises, exercises, bash, scripting, Scripting, awk, sed, variables, functions, loops, conditionals"><link rel="home" href="index.html" title="Bash Guide for Beginners"><link rel="up" href="ch07.html" title="Chapter 7. Conditional statements"><link rel="prev" href="ch07.html" title="Chapter 7. Conditional statements"><link rel="next" href="ch07s02.html" title="2. More advanced if usage"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1. Introduction to if</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch07.html">Prev</a> </td><th width="60%" align="center">Chapter 7. Conditional statements</th><td width="20%" align="right"> <a accesskey="n" href="ch07s02.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sect_07_01"></a>1. Introduction to if</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_07_01_01"></a>1.1. General</h3></div></div></div><p>At times you need to specify different courses of action to be taken in a shell script, depending on the success or failure of a command.  The <span class="command"><strong>if</strong></span> construction allows you to specify such conditions.</p><p>The most compact syntax of the <span class="command"><strong>if</strong></span> command is:</p><div class="cmdsynopsis"><p><code class="command">if TEST-COMMANDS; then CONSEQUENT-COMMANDS; fi</code> </p></div><p>The <span class="command"><strong>TEST-COMMAND</strong></span> list is executed, and if its return status is zero, the <span class="command"><strong>CONSEQUENT-COMMANDS</strong></span> list is executed.  The return status is the exit status of the last command executed, or zero if no condition tested true.</p><p>The <span class="command"><strong>TEST-COMMAND</strong></span> often involves numerical or string comparison tests, but it can also be any command that returns a status of zero when it succeeds and some other status when it fails.  Unary expressions are often used to examine the status of a file.  If the <code class="filename">FILE</code> argument to one of the primaries is of the form <code class="filename">/dev/fd/N</code>, then file descriptor <span class="quote">&#8220;<span class="quote">N</span>&#8221;</span> is checked.  <code class="filename">stdin</code>, <code class="filename">stdout</code> and <code class="filename">stderr</code> and their respective file descriptors may also be used for tests.</p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_07_01_01_01"></a>1.1.1. Expressions used with if</h4></div></div></div><p>The table below contains an overview of the so-called <span class="quote">&#8220;<span class="quote">primaries</span>&#8221;</span> that make up the <span class="command"><strong>TEST-COMMAND</strong></span> command or list of commands.  These primaries are put between square brackets to indicate the test of a conditional expression.</p><div class="table"><a name="tab_07_01"></a><p class="title"><b>Table 7.1. Primary expressions</b></p><div class="table-contents"><table class="table" summary="Primary expressions" border="1"><colgroup><col><col></colgroup><thead><tr><th align="left">Primary</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left">[ <code class="option">-a</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists.</td></tr><tr><td align="left">[ <code class="option">-b</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and is a block-special file.</td></tr><tr><td align="left">[ <code class="option">-c</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and is a character-special file.</td></tr><tr><td align="left">[ <code class="option">-d</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and is a directory.</td></tr><tr><td align="left">[ <code class="option">-e</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists.</td></tr><tr><td align="left">[ <code class="option">-f</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and is a regular file.</td></tr><tr><td align="left">[ <code class="option">-g</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and its SGID bit is set.</td></tr><tr><td align="left">[ <code class="option">-h</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and is a symbolic link.</td></tr><tr><td align="left">[ <code class="option">-k</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and its sticky bit is set.</td></tr><tr><td align="left">[ <code class="option">-p</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and is a named pipe (FIFO).</td></tr><tr><td align="left">[ <code class="option">-r</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and is readable.</td></tr><tr><td align="left">[ <code class="option">-s</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and has a size greater than zero.</td></tr><tr><td align="left">[ <code class="option">-t</code> <code class="filename">FD</code> ]</td><td align="left">True if file descriptor <code class="filename">FD</code> is open and refers to a terminal.</td></tr><tr><td align="left">[ <code class="option">-u</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and its SUID (set user ID) bit is set.</td></tr><tr><td align="left">[ <code class="option">-w</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and is writable.</td></tr><tr><td align="left">[ <code class="option">-x</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and is executable.</td></tr><tr><td align="left">[ <code class="option">-O</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and is owned by the effective user ID.</td></tr><tr><td align="left">[ <code class="option">-G</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and is owned by the effective group ID.</td></tr><tr><td align="left">[ <code class="option">-L</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and is a symbolic link.</td></tr><tr><td align="left">[ <code class="option">-N</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and has been modified since it was last read.</td></tr><tr><td align="left">[ <code class="option">-S</code> <code class="filename">FILE</code> ]</td><td align="left">True if <code class="filename">FILE</code> exists and is a socket.</td></tr><tr><td align="left">[ <code class="filename">FILE1</code> <code class="option">-nt</code> <code class="filename">FILE2</code> ]</td><td align="left">True if <code class="filename">FILE1</code> has been changed more recently than <code class="filename">FILE2</code>, or if <code class="filename">FILE1</code> exists and <code class="filename">FILE2</code> does not.</td></tr><tr><td align="left">[ <code class="filename">FILE1</code> <code class="option">-ot</code> <code class="filename">FILE2</code> ]</td><td align="left">True if <code class="filename">FILE1</code> is older than <code class="filename">FILE2</code>, or is <code class="filename">FILE2</code> exists and <code class="filename">FILE1</code> does not.</td></tr><tr><td align="left">[ <code class="filename">FILE1</code> <code class="option">-ef</code> <code class="filename">FILE2</code> ]</td><td align="left">True if <code class="filename">FILE1</code> and <code class="filename">FILE2</code> refer to the same device and inode numbers.</td></tr><tr><td align="left">[ <code class="option">-o</code> OPTIONNAME ]</td><td align="left">True if shell option <span class="quote">&#8220;<span class="quote">OPTIONNAME</span>&#8221;</span> is enabled.</td></tr><tr><td align="left"><code class="option">[ -z</code> STRING ]</td><td align="left">True if the length of <span class="quote">&#8220;<span class="quote">STRING</span>&#8221;</span> is zero.</td></tr><tr><td align="left"><code class="option">[ -n</code> STRING ] or [ STRING ]</td><td align="left">True if the length of <span class="quote">&#8220;<span class="quote">STRING</span>&#8221;</span> is non-zero.</td></tr><tr><td align="left">[ STRING1 == STRING2 ] </td><td align="left">True if the strings are equal.  <span class="quote">&#8220;<span class="quote">=</span>&#8221;</span> may be used instead of <span class="quote">&#8220;<span class="quote">==</span>&#8221;</span> for strict POSIX compliance.</td></tr><tr><td align="left">[ STRING1 != STRING2 ] </td><td align="left">True if the strings are not equal.</td></tr><tr><td align="left">[ STRING1 &lt; STRING2 ] </td><td align="left">True if <span class="quote">&#8220;<span class="quote">STRING1</span>&#8221;</span> sorts before <span class="quote">&#8220;<span class="quote">STRING2</span>&#8221;</span> lexicographically in the current locale.</td></tr><tr><td align="left">[ STRING1 &gt; STRING2 ] </td><td align="left">True if <span class="quote">&#8220;<span class="quote">STRING1</span>&#8221;</span> sorts after <span class="quote">&#8220;<span class="quote">STRING2</span>&#8221;</span> lexicographically in the current locale.</td></tr><tr><td align="left">[ ARG1 OP ARG2 ]</td><td align="left"><span class="quote">&#8220;<span class="quote">OP</span>&#8221;</span> is one of <code class="option">-eq</code>, <code class="option">-ne</code>, <code class="option">-lt</code>, <code class="option">-le</code>, <code class="option">-gt</code> or <code class="option">-ge</code>.  These arithmetic<a class="indexterm" name="idm4772"></a> binary operators return true if <span class="quote">&#8220;<span class="quote">ARG1</span>&#8221;</span> is equal to, not equal to, less than, less than or equal to, greater than, or greater than or equal to <span class="quote">&#8220;<span class="quote">ARG2</span>&#8221;</span>, respectively.  <span class="quote">&#8220;<span class="quote">ARG1</span>&#8221;</span> and <span class="quote">&#8220;<span class="quote">ARG2</span>&#8221;</span> are integers.</td></tr></tbody></table></div></div><br class="table-break"><p>Expressions may be combined using the following operators, listed in decreasing order of precedence:</p><div class="table"><a name="tab_07_02"></a><p class="title"><b>Table 7.2. Combining expressions</b></p><div class="table-contents"><table class="table" summary="Combining expressions" border="1"><colgroup><col><col></colgroup><thead><tr><th align="left">Operation</th><th align="left">Effect</th></tr></thead><tbody><tr><td align="left">[ ! EXPR ]</td><td align="left">True if <span class="command"><strong>EXPR</strong></span> is false.</td></tr><tr><td align="left">[ ( EXPR ) ]</td><td align="left">Returns the value of <span class="command"><strong>EXPR</strong></span>.  This may be used to override the normal precedence of operators.</td></tr><tr><td align="left">[ EXPR1 -a EXPR2 ]</td><td align="left">True if both <span class="command"><strong>EXPR1</strong></span> and <span class="command"><strong>EXPR2</strong></span> are true.</td></tr><tr><td align="left">[ EXPR1 -o EXPR2 ]</td><td align="left">True if either <span class="command"><strong>EXPR1</strong></span> or <span class="command"><strong>EXPR2</strong></span> is true.</td></tr></tbody></table></div></div><br class="table-break"><p>The <span class="command"><strong>[</strong></span> (or <span class="command"><strong>test</strong></span>) built-in evaluates conditional expressions using a set of rules based on the number of arguments.  More information about this subject can be found in the Bash documentation.  Just like the <span class="command"><strong>if</strong></span> is closed with <span class="command"><strong>fi</strong></span>, the opening square bracket should be closed after the conditions have been listed.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_07_01_01_02"></a>1.1.2. Commands following the then statement</h4></div></div></div><p>The <span class="command"><strong>CONSEQUENT-COMMANDS</strong></span> list that follows the <span class="command"><strong>then</strong></span> statement can be any valid UNIX command, any executable program, any executable shell script or any shell statement, with the exception of the closing <span class="command"><strong>fi</strong></span>.  It is important to remember that the <span class="command"><strong>then</strong></span> and <span class="command"><strong>fi</strong></span> are considered to be separated statements in the shell.  Therefore, when issued on the command line, they are separated by a semi-colon.</p><p>In a script, the different parts of the <span class="command"><strong>if</strong></span> statement are usually well-separated.  Below, a couple of simple examples.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_07_01_01_03"></a>1.1.3. Checking files</h4></div></div></div><p>The first example checks for the existence of a file:</p><pre class="screen">
<code class="prompt">anny ~&gt;</code> <span class="command"><strong>cat <code class="filename">msgcheck.sh</code></strong></span>
#!/bin/bash

echo "This scripts checks the existence of the messages file."
echo "Checking..."
if [ -f /var/log/messages ]
  then
    echo "/var/log/messages exists."
fi
echo
echo "...done."

<code class="prompt">anny ~&gt;</code> <span class="command"><strong>./msgcheck.sh</strong></span>
This scripts checks the existence of the messages file.
Checking...
/var/log/messages exists.

...done.
</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_07_01_01_04"></a>1.1.4. Checking shell options</h4></div></div></div><p>To add in your Bash configuration files:</p><pre class="screen">
# These lines will print a message if the noclobber option is set:

if [ -o noclobber ]
  then
	echo "Your files are protected against accidental overwriting using redirection."
fi

</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">The environment</h3><p>The above example will work when entered on the command line:</p><pre class="screen">
<code class="prompt">anny ~&gt;</code> <span class="command"><strong>if <em class="parameter"><code>[ -o noclobber ]</code></em> ; then echo ; echo <em class="parameter"><code>"your files are protected
against overwriting."</code></em> ; echo ; fi</strong></span>

your files are protected against overwriting.

<code class="prompt">anny ~&gt;</code>
</pre><p>However, if you use testing of conditions that depend on the environment, you might get different results when you enter the same command in a script, because the script will open a new shell, in which expected variables and options might not be set automatically.</p></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_07_01_02"></a>1.2. Simple applications of if</h3></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_07_01_02_01"></a>1.2.1. Testing exit status</h4></div></div></div><p>The <code class="varname">?</code> variable holds the exit status of the previously executed command (the most recently completed foreground process).</p><p>The following example shows a simple test:</p><pre class="screen">
<code class="prompt">anny ~&gt;</code> <span class="command"><strong>if <em class="parameter"><code>[ $? -eq 0 ]</code></em></strong></span>
<code class="prompt">More input&gt;</code> <span class="command"><strong>then echo <em class="parameter"><code>'That was a good job!'</code></em></strong></span>
<code class="prompt">More input&gt;</code> <span class="command"><strong>fi</strong></span>
That was a good job!

<code class="prompt">anny ~&gt;</code>
</pre><p>The following example demonstrates that <span class="command"><strong>TEST-COMMANDS</strong></span> might be any UNIX command that returns an exit status, and that <span class="command"><strong>if</strong></span> again returns an exit status of zero:</p><pre class="screen">
<code class="prompt">anny ~&gt;</code> <span class="command"><strong>if <em class="parameter"><code>! grep $USER</code></em> <code class="filename">/etc/passwd</code></strong></span>
<code class="prompt">More input&gt;</code> <span class="command"><strong>then echo <em class="parameter"><code>"your user account is not managed locally"</code></em>; fi</strong></span>
your user account is not managed locally

<code class="prompt">anny &gt;</code> <span class="command"><strong>echo <code class="varname">$?</code></strong></span>
0

<code class="prompt">anny &gt;</code>
</pre><p>The same result can be obtained as follows:</p><pre class="screen">
<code class="prompt">anny &gt;</code> <span class="command"><strong>grep <code class="varname">$USER</code> <code class="filename">/etc/passwd</code></strong></span>

<code class="prompt">anny &gt;</code> <span class="command"><strong>if <em class="parameter"><code>[ $? -ne 0 ]</code></em> ; then echo <em class="parameter"><code>"not a local account"</code></em> ; fi</strong></span>
not a local account

<code class="prompt">anny &gt;</code>
</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_07_01_02_02"></a>1.2.2. Numeric comparisons</h4></div></div></div><p>The examples below use numerical comparisons:</p><pre class="screen">
<code class="prompt">anny &gt;</code> <span class="command"><strong><code class="varname">num</code>=<em class="parameter"><code>`wc -l work.txt`</code></em></strong></span>

<code class="prompt">anny &gt;</code> <span class="command"><strong>echo <code class="varname">$num</code></strong></span>
201

<code class="prompt">anny &gt;</code> <span class="command"><strong>if <em class="parameter"><code>[ "$num" -gt "150" ]</code></em></strong></span>
<code class="prompt">More input&gt;</code> <span class="command"><strong>then echo ; echo <em class="parameter"><code>"you've worked hard enough for today."</code></em></strong></span>
<code class="prompt">More input&gt;</code> <span class="command"><strong>echo ; fi</strong></span>

you've worked hard enough for today.


<code class="prompt">anny &gt;</code>
</pre><p>This script is executed by cron every Sunday.  If the week number is even, it reminds you to put out the garbage cans:</p><pre class="screen">
#!/bin/bash

# Calculate the week number using the date command:

WEEKOFFSET=$[ $(date +"%V") % 2 ]

# Test if we have a remainder.  If not, this is an even week so send a message.
# Else, do nothing.

if [ $WEEKOFFSET -eq "0" ]; then
  echo "Sunday evening, put out the garbage cans." | mail -s "Garbage cans out" your@your_domain.org
fi
</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_07_01_02_03"></a>1.2.3. String comparisons</h4></div></div></div><p>An example of comparing strings for testing the user ID:</p><pre class="screen">
if [ "$(whoami)" != 'root' ]; then
        echo "You have no permission to run $0 as non-root user."
        exit 1;
fi
</pre><p>With Bash, you can shorten this type of construct.  The compact equivalent of the above test is as follows:</p><pre class="screen">
[ "$(whoami)" != 'root' ] &amp;&amp; ( echo you are using a non-privileged account; exit 1 )
</pre><p>Similar to the <span class="quote">&#8220;<span class="quote">&amp;&amp;</span>&#8221;</span> expression which indicates what to do if the test proves true, <span class="quote">&#8220;<span class="quote">||</span>&#8221;</span> specifies what to do if the test is false.</p><p>Regular expressions may also be used in comparisons:</p><pre class="screen">
<code class="prompt">anny &gt;</code> <span class="command"><strong><code class="varname">gender</code>=<em class="parameter"><code>"female"</code></em></strong></span>

<code class="prompt">anny &gt;</code> <span class="command"><strong>if <em class="parameter"><code>[[ "$gender" == f* ]]</code></em></strong></span>
<code class="prompt">More input&gt;</code> <span class="command"><strong>then echo <em class="parameter"><code>"Pleasure to meet you, Madame."</code></em>; fi</strong></span>
Pleasure to meet you, Madame.

<code class="prompt">anny &gt;</code>
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Real Programmers</h3><p>Most programmers will prefer to use the <span class="command"><strong>test</strong></span> built-in command, which is equivalent to using square brackets for comparison, like this:</p><pre class="screen">
test "$(whoami)" != 'root' &amp;&amp; (echo you are using a non-privileged account; exit 1)
</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">No exit?</h3><p>If you invoke the <span class="command"><strong>exit</strong></span> in a subshell, it will not pass variables to the parent.  Use { and } instead of ( and ) if you do not want Bash to fork a subshell.</p></div><p>See the info pages for Bash for more information on pattern matching with the <span class="quote">&#8220;<span class="quote">(( EXPRESSION ))</span>&#8221;</span> and <span class="quote">&#8220;<span class="quote">[[ EXPRESSION ]]</span>&#8221;</span> constructs.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch07.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch07.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch07s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 7. Conditional statements </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 2. More advanced if usage</td></tr></table></div></body></html>
