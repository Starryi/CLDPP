<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>4. Building blocks</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="Linux, Scripts, linux, Bash, guide, Guide, Exercises, exercises, bash, scripting, Scripting, awk, sed, variables, functions, loops, conditionals"><link rel="home" href="index.html" title="Bash Guide for Beginners"><link rel="up" href="ch01.html" title="Chapter 1. Bash and Bash scripts"><link rel="prev" href="ch01s03.html" title="3. Executing commands"><link rel="next" href="ch01s05.html" title="5. Developing good scripts"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. Building blocks</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch01s03.html">Prev</a> </td><th width="60%" align="center">Chapter 1. Bash and Bash scripts</th><td width="20%" align="right"> <a accesskey="n" href="ch01s05.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sect_01_04"></a>4. Building blocks</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_01_04_01"></a>4.1. Shell building blocks</h3></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_01_04_01_01"></a>4.1.1. Shell syntax</h4></div></div></div><p>If input is not commented, the shell reads<a class="indexterm" name="idm961"></a> it and divides it into words and operators, employing quoting rules to define the meaning of each character of input.  Then these words and operators are translated into commands and other constructs, which return an exit status available for inspection or processing.  The above fork-and-exec scheme is only applied after the shell has analyzed input in the following<a class="indexterm" name="idm964"></a> way:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The shell reads its input from a file, from a string or from the user's terminal.</p></li><li class="listitem"><p>Input is broken up into words and operators, obeying the quoting rules, see <a class="xref" href="ch03.html" title="Chapter 3. The Bash environment">Chapter 3, <i>The Bash environment</i></a>.  These tokens are separated by <span class="emphasis"><em>metacharacters</em></span>.  Alias expansion is performed.</p></li><li class="listitem"><p>The shell <span class="emphasis"><em>parses</em></span> (analyzes and substitutes) the tokens into simple and compound commands.</p></li><li class="listitem"><p>Bash performs various shell expansions, breaking the expanded tokens into lists of filenames and commands and arguments.</p></li><li class="listitem"><p>Redirection is performed if necessary, redirection operators and their operands are removed from the argument list.</p></li><li class="listitem"><p>Commands are executed.</p></li><li class="listitem"><p>Optionally the shell waits for the command to complete and collects its exit status.</p></li></ul></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_01_04_01_02"></a>4.1.2. Shell commands</h4></div></div></div><p>A simple shell command such as <span class="command"><strong>touch <code class="filename">file1</code> <code class="filename">file2</code> <code class="filename">file3</code></strong></span> consists of the command itself followed by arguments<a class="indexterm" name="idm992"></a>, separated by spaces.</p><p>More complex shell commands are composed of simple commands arranged together in a variety of ways: in a pipeline in which the output of one command becomes the input of a second, in a loop or conditional construct, or in some other grouping.  A couple of examples:</p><div class="cmdsynopsis"><p><code class="command">ls | more</code> </p></div><div class="cmdsynopsis"><p><code class="command">gunzip <code class="filename">file.tar.gz</code> | tar <code class="option">xvf</code> <em class="parameter"><code>-</code></em></code> </p></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_01_04_01_03"></a>4.1.3. Shell functions</h4></div></div></div><p>Shell functions<a class="indexterm" name="idm1006"></a> are a way to group commands for later execution using a single name for the group.  They are executed just like a <span class="quote">&#8220;<span class="quote">regular</span>&#8221;</span> command.  When the name of a shell function is used as a simple command name, the list of commands associated with that function name is executed.</p><p>Shell functions are executed in the current shell context; no new process is created to interpret them.</p><p>Functions are explained in <a class="xref" href="ch11.html" title="Chapter 11. Functions">Chapter 11, <i>Functions</i></a>.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_01_04_01_04"></a>4.1.4. Shell parameters</h4></div></div></div><p>A parameter<a class="indexterm" name="idm1016"></a> is an entity that stores values.  It can be a name, a number or a special value.  For the shell's purpose, a variable<a class="indexterm" name="idm1019"></a> is a parameter that stores a name.  A variable has a value and zero or more attributes.  Variables are created with the <span class="command"><strong>declare<a class="indexterm" name="idm1023"></a></strong></span> shell built-in command.</p><p>If no value is given, a variable is assigned the null string.  Variables can only be removed with the <span class="command"><strong>unset</strong></span> built-in.</p><p>Assigning variables is discussed in <a class="xref" href="ch03s02.html" title="2. Variables">Section 2, &#8220;Variables&#8221;</a>, advanced use of variables in <a class="xref" href="ch10.html" title="Chapter 10. More on variables">Chapter 10, <i>More on variables</i></a>.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_01_04_01_05"></a>4.1.5. Shell expansions</h4></div></div></div><p>Shell expansion<a class="indexterm" name="idm1034"></a> is performed after each command line has been split into tokens.  These are the expansions performed:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Brace expansion</p></li><li class="listitem"><p>Tilde expansion</p></li><li class="listitem"><p>Parameter and variable expansion</p></li><li class="listitem"><p>Command substitution</p></li><li class="listitem"><p>Arithmetic expansion</p></li><li class="listitem"><p>Word splitting</p></li><li class="listitem"><p>Filename expansion</p></li></ul></div><p>We'll discuss these expansion types in detail in <a class="xref" href="ch03s04.html" title="4. Shell expansion">Section 4, &#8220;Shell expansion&#8221;</a>.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_01_04_01_06"></a>4.1.6. Redirections</h4></div></div></div><p>Before a command is executed, its input and output may be redirected<a class="indexterm" name="idm1057"></a> using a special notation interpreted by the shell.  Redirection may also be used to open and close files for the current shell execution environment.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_01_04_01_07"></a>4.1.7. Executing commands</h4></div></div></div><p>When executing a command, the words that the parser has marked as variable assignments (preceding the command name) and redirections are saved for later reference.  Words that are not variable assignments or redirections are expanded; the first remaining word after expansion is taken to be the name of the command and the rest are arguments<a class="indexterm" name="idm1063"></a> to that command.  Then redirections are performed, then strings assigned to variables are expanded.  If no command name results, variables will affect the current shell environment.</p><p>An important part of the tasks of the shell is to search<a class="indexterm" name="idm1067"></a> for commands.  Bash does this as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Check whether the command contains slashes.  If not, first check with the function list to see if it contains a command by the name we are looking for.</p></li><li class="listitem"><p>If command is not a function, check for it in the built-in list.</p></li><li class="listitem"><p>If command is neither a function nor a built-in, look for it analyzing the directories listed in <code class="varname">PATH<a class="indexterm" name="idm1078"></a></code>.  Bash uses a <span class="emphasis"><em>hash table</em></span> (data storage area in memory) to remember the full path names of executables so extensive <code class="varname">PATH</code> searches can be avoided.</p></li><li class="listitem"><p>If the search is unsuccessful, bash prints an error message and returns an exit status of 127.</p></li><li class="listitem"><p>If the search was successful or if the command contains slashes, the shell executes the command in a separate execution environment.</p></li><li class="listitem"><p>If execution fails because the file is not executable and not a directory, it is assumed to be a shell script.</p></li><li class="listitem"><p>If the command was not begun asynchronously, the shell waits for the command to complete and collects its exit status.</p></li></ul></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_01_04_01_08"></a>4.1.8. Shell scripts</h4></div></div></div><p>When a file containing<a class="indexterm" name="idm1094"></a> shell commands is used as the first non-option argument when invoking Bash (without <code class="option">-c</code> or <code class="option">-s</code>, this will create a non-interactive shell.  This shell first searches for the script file in the current directory, then looks in <code class="varname">PATH</code> if the file cannot be found there.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch01s03.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch01.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch01s05.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3. Executing commands </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 5. Developing good scripts</td></tr></table></div></body></html>
