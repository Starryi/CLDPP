<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>1. Introduction</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="Linux, Scripts, linux, Bash, guide, Guide, Exercises, exercises, bash, scripting, Scripting, awk, sed, variables, functions, loops, conditionals"><link rel="home" href="index.html" title="Bash Guide for Beginners"><link rel="up" href="ch11.html" title="Chapter 11. Functions"><link rel="prev" href="ch11.html" title="Chapter 11. Functions"><link rel="next" href="ch11s02.html" title="2. Examples of functions in scripts"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1. Introduction</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch11.html">Prev</a> </td><th width="60%" align="center">Chapter 11. Functions</th><td width="20%" align="right"> <a accesskey="n" href="ch11s02.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sect_11_01"></a>1. Introduction</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_11_01_01"></a>1.1. What are functions?</h3></div></div></div><p>Shell functions are a way to group commands for later execution, using a single name for this group, or <span class="emphasis"><em>routine</em></span>.  The name of the routine must be unique within the shell or script.  All the commands that make up a function are executed like regular commands.  When calling on a function as a simple command name, the list of commands associated with that function name is executed.  A function is executed within the shell in which it has been declared: no new process is created to interpret the commands.</p><p>Special built-in commands are found before shell functions during command lookup.  The special built-ins are: <span class="command"><strong>break</strong></span>, <span class="command"><strong>:</strong></span>, <span class="command"><strong>.</strong></span>, <span class="command"><strong>continue</strong></span>, <span class="command"><strong>eval</strong></span>, <span class="command"><strong>exec</strong></span>, <span class="command"><strong>exit</strong></span>, <span class="command"><strong>export</strong></span>, <span class="command"><strong>readonly</strong></span>, <span class="command"><strong>return</strong></span>, <span class="command"><strong>set</strong></span>, <span class="command"><strong>shift</strong></span>, <span class="command"><strong>trap</strong></span> and <span class="command"><strong>unset</strong></span>.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_11_01_02"></a>1.2. Function syntax</h3></div></div></div><p>Functions either use the syntax</p><div class="cmdsynopsis"><p><code class="command">function FUNCTION { COMMANDS; }</code> </p></div><p>or</p><div class="cmdsynopsis"><p><code class="command">FUNCTION () { COMMANDS; }</code> </p></div><p>Both define a shell function <span class="command"><strong>FUNCTION</strong></span>.  The use of the built-in command <span class="command"><strong>function</strong></span> is optional; however, if it is not used, parentheses are needed.</p><p>The commands listed between curly braces make up the body of the function.  These commands are executed whenever <span class="command"><strong>FUNCTION</strong></span> is specified as the name of a command.  The exit status is the exit status of the last command executed in the body.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Common mistakes</h3><p>The curly braces must be separated from the body by spaces, otherwise they are interpreted in the wrong way.</p><p>The body of a function should end in a semicolon or a newline.</p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_11_01_03"></a>1.3. Positional parameters in functions</h3></div></div></div><p>Functions are like mini-scripts: they can accept parameters, they can use variables only known within the function (using the <span class="command"><strong>local</strong></span> shell built-in) and they can return values to the calling shell.</p><p>A function also has a system for interpreting positional parameters.  However, the positional parameters passed to a function are not the same as the ones passed to a command or script.</p><p>When a function is executed, the arguments<a class="indexterm" name="idm6872"></a> to the function<a class="indexterm" name="idm6875"></a> become the positional parameters during its execution.  The special parameter <code class="varname">#</code> that expands to the number of positional parameters is updated to reflect the change. Positional parameter <code class="varname">0</code> is unchanged.  The Bash variable <code class="varname">FUNCNAME</code> is set to the name of the function, while it is executing.</p><p>If the <span class="command"><strong>return</strong></span> built-in is executed in a function, the function completes and execution resumes with the next command after the function call.  When a function completes, the values of the positional parameters and the special parameter <code class="varname">#</code> are restored to the values they had prior to the function's execution.  If a numeric argument is given to <span class="command"><strong>return</strong></span>, that status is returned.  A simple<a class="indexterm" name="idm6885"></a> example<a class="indexterm" name="idm6888"></a>:</p><pre class="screen">
<code class="prompt">[lydia@cointreau ~/test]</code> <span class="command"><strong>cat <code class="filename">showparams.sh</code></strong></span>
#!/bin/bash
                                                                                
echo "This script demonstrates function arguments."
echo
                                                                                
echo "Positional parameter 1 for the script is $1."
echo
                                                                                
test ()
{
echo "Positional parameter 1 in the function is $1."
RETURN_VALUE=$?
echo "The exit code of this function is $RETURN_VALUE."
}
                                                                                
test other_param

<code class="prompt">[lydia@cointreau ~/test]</code> <span class="command"><strong>./showparams.sh <em class="parameter"><code>parameter1</code></em></strong></span>
This script demonstrates function arguments.
 
Positional parameter 1 for the script is parameter1.
 
Positional parameter 1 in the function is other_param.
The exit code of this function is 0.

<code class="prompt">[lydia@cointreau ~/test]</code>
</pre><p>Note that the return value or exit code of the function is often storen in a variable, so that it can be probed at a later point.  The init scripts on your system often use the technique of probing the <code class="varname">RETVAL</code> variable in a conditional test, like this one:</p><pre class="screen">
<span class="command"><strong>if <em class="parameter"><code>[ $RETVAL -eq 0 ]</code></em>; then
	&lt;start the daemon&gt;</strong></span>
</pre><p>Or like this example from the <code class="filename">/etc/init.d/amd</code> script, where Bash's optimization features are used:</p><pre class="screen">
<span class="command"><strong><em class="parameter"><code>[ $RETVAL = 0 ]</code></em> &amp;&amp; touch <code class="filename">/var/lock/subsys/amd</code></strong></span>
</pre><p>The commands after <span class="command"><strong>&amp;&amp;</strong></span> are only executed when the test proves to be true; this is a shorter way to represent an <span class="command"><strong>if/then/fi</strong></span> structure.</p><p>The return code of the function is often used as exit code of the entire script.  You'll see a lot of initscripts ending in something like <span class="command"><strong>exit <code class="varname">$RETVAL</code></strong></span>.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_11_01_04"></a>1.4. Displaying functions</h3></div></div></div><p>All functions known by the current shell can be displayed using the <span class="command"><strong>set</strong></span> built-in without options.  Functions are retained after they are used, unless they are <span class="command"><strong>unset</strong></span> after use.  The <span class="command"><strong>which</strong></span> command also displays functions:</p><pre class="screen">
<code class="prompt">[lydia@cointreau ~]</code> <span class="command"><strong>which <code class="filename">zless</code></strong></span>
zless is a function
zless ()
{
    zcat "$@" | "$PAGER"
}

<code class="prompt">[lydia@cointreau ~]</code> <span class="command"><strong>echo <code class="varname">$PAGER</code></strong></span>
less
</pre><p>This is the sort of function that is typically configured in the user's shell resource configuration files.  Functions are more flexible than aliases and provide a simple and easy way of adapting the user environment.</p><p>Here's one for DOS users:</p><pre class="screen">
dir ()
{
    ls -F --color=auto -lF --color=always "$@" | less -r
}
</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch11.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch11.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch11s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 11. Functions </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 2. Examples of functions in scripts</td></tr></table></div></body></html>
