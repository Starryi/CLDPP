<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>2. Compile, insert FreeS/WAN into the kernel</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="RedHat, redhat, maddy, linus, linux, Linux, Securing, Optimising, security, secure, openna, gerhard"><link rel="home" href="index.html" title="Securing and Optimizing Linux"><link rel="up" href="fSWAn.html" title="Chapter 25. Linux FreeS/WAN VPN"><link rel="prev" href="chap25sec199.html" title="1. IPSEC/VPN -FreeS/WAN"><link rel="next" href="chap25sec201.html" title="3. Reconfigure and install the kernel with FreeS/WAN VPN support"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2. Compile, insert FreeS/WAN into the kernel</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="chap25sec199.html">Prev</a> </td><th width="60%" align="center">Chapter 25. Linux FreeS/WAN VPN</th><td width="20%" align="right"> <a accesskey="n" href="chap25sec201.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm14485"></a>2. Compile, insert FreeS/WAN into the kernel</h2></div></div></div><p>
           You must modify the <code class="filename">Makefile</code> under the FreeS/WAN source directory and subdirectories named <code class="filename">utils</code>, <code class="filename">klips/utils</code>, <code class="filename">Pluto</code>, 
           and <code class="filename">lib</code> to specify installation paths. We must modify these files to be compliant with Red Hat's file system structure and install FreeS/WAN files under our <code class="envar">PATH</code> environment variable.
           </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
               Move to the top-level directory of the new FreeS/WAN distribution and type the following commands on your terminal:
               Edit the <code class="filename">Makefile</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">Makefile</code> and change the following lines:
               </p><ol type="a" class="substeps"><li class="step"><p>
                   </p><pre class="programlisting">
                     PUBDIR=/usr/local/sbin
                   </pre><p>
                   To read:
                   </p><pre class="programlisting">
                     PUBDIR=/usr/sbin
                   </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   PRIVDIR=/usr/local/lib/ipsec
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   PRIVDIR=/usr/lib/ipsec
                 </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   FINALPRIVDIR=/usr/local/lib/ipsec
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   FINALPRIVDIR=/usr/lib/ipsec
                 </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   MANTREE=/usr/local/man
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   MANTREE=/usr/man
                 </pre><p>
                 </p></li></ol></li><li class="step"><p>
               Edit the <code class="filename">Makefile</code> file of the subdirectory <code class="filename">utils</code>, <span class="command"><strong>vi</strong></span> <code class="filename">utils/Makefile</code> and change the following lines:
               </p><ol type="a" class="substeps"><li class="step"><p>
                 </p><pre class="programlisting">
                   PUBDIR=/usr/local/sbin
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   PUBDIR=/usr/sbin
                 </pre><p>
               </p></li><li class="step"><p>
               </p><pre class="programlisting">
                 PRIVDIR=/usr/local/lib/ipsec
               </pre><p>
               To read:
               </p><pre class="programlisting">
                 PRIVDIR=/usr/lib/ipsec
               </pre><p>
               </p></li><li class="step"><p>
               </p><pre class="programlisting">
                 FINALPRIVDIR=/usr/local/lib/ipsec
               </pre><p>
               To read:
               </p><pre class="programlisting">
                 FINALPRIVDIR=/usr/lib/ipsec
               </pre><p>
               </p></li><li class="step"><p>
               </p><pre class="programlisting">
                 MANTREE=/usr/local/man
               </pre><p>
               To read:
               </p><pre class="programlisting">
                 MANTREE=/usr/man
               </pre><p>
               </p></li></ol></li><li class="step"><p>
               Edit the <code class="filename">Makefile</code> file of the subdirectory <code class="filename">klips/utils</code>, <span class="command"><strong>vi</strong></span> <code class="filename">klips/utils/Makefile</code> and change the following lines:
               </p><ol type="a" class="substeps"><li class="step"><p>
                   </p><pre class="programlisting">
                     BINDIR=/usr/local/lib/ipsec
                   </pre><p>
                   To read:
                   </p><pre class="programlisting">
                     BINDIR=/usr/lib/ipsec
                   </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   MANTREE=/usr/local/man
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   MANTREE=/usr/man
                 </pre><p>
                 </p></li></ol></li><li class="step"><p>
               Edit the <code class="filename">Makefile</code> file of the subdirectory <code class="filename">pluto</code>, <span class="command"><strong>vi</strong></span> <code class="filename">pluto/Makefile</code> and change the following lines:
               </p><ol type="a" class="substeps"><li class="step"><p>
                   </p><pre class="programlisting">
                     BINDIR=/usr/local/lib/ipsec
                   </pre><p>
                   To read:
                   </p><pre class="programlisting">
                     BINDIR=/usr/lib/ipsec
                   </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   MANTREE=/usr/local/man
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   MANTREE=/usr/man
                 </pre><p>
                 </p></li></ol></li><li class="step"><p>
               Edit the <code class="filename">Makefile</code> file of the subdirectory <code class="filename">lib</code>, <span class="command"><strong>vi</strong></span> <code class="filename">lib/Makefile</code> and change the following lines:
               </p><pre class="programlisting">
                 MANTREE=/usr/local/man
               </pre><p>
               To read:
               </p><pre class="programlisting">
                 MANTREE=/usr/man
               </pre><p>
             </p></li><li class="step"><p>
               Edit the <code class="filename">Makefile</code> file of the subdirectory <code class="filename">libdes</code>, <span class="command"><strong>vi</strong></span> <code class="filename">libdes/Makefile</code> and change the following lines:
               </p><ol type="a" class="substeps"><li class="step"><p>
                   </p><pre class="programlisting">
                     LIBDIR=/usr/local/lib
                   </pre><p>
                   To read:
                   </p><pre class="programlisting">
                     LIBDIR=/usr/lib
                   </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   BINDIR=/usr/local/bin
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   BINDIR=/usr/bin
                 </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   INCDIR=/usr/local/include
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   INCDIR=/usr/include
                 </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   MANDIR=/usr/local/man
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   MANDIR=/usr/man
                 </pre><p>
                 The above changes, from step1 to step 6, will locate all files related to the FreeS/WAN software to the destination target directories we have chosen in order to be compliant with the Red Hat file system structure.
                 </p></li></ol></li></ol></div><p>
             Now, we must compile and install FreeSWAN on the server:
             </p><pre class="screen">
               [root@deep ]/freeswan-1.3#  <span class="command"><strong>make insert</strong></span>
               [root@deep ]/freeswan-1.3#  <span class="command"><strong>make programs</strong></span>
               [root@deep ]/freeswan-1.3#  <span class="command"><strong>make install</strong></span>
             </pre><p>
             </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                 The <span class="command"><strong>make insert</strong></span> command creates a symbolic link <code class="filename">/usr/src/linux/net/ipsec</code>, pointing to the <acronym class="acronym">KLIPS</acronym> source directory. It patches some kernel files, where 
                 necessary, to know about <acronym class="acronym">KLIPS</acronym> and/or to fix bugs. It also adds its default configuration to the kernel configuration file, and finally, it makes the <acronym class="acronym">KLIPS</acronym> communication file, <code class="filename">/dev/ipsec</code>, 
                 if it's not already there.
               </p></li><li class="listitem"><p>
               The <span class="command"><strong>make programs</strong></span> command builds the libraries, Pluto, and various user-level utilities. 
               </p></li><li class="listitem"><p>
               The <span class="command"><strong>make install</strong></span> will install the Pluto daemon and user-level utilities, and set things up for boot-time startup.
               </p></li></ul></div><p>
           </p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chap25sec199.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="fSWAn.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="chap25sec201.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">1. IPSEC/VPN -FreeS/WAN </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 3. Reconfigure and install the kernel with FreeS/WAN VPN support</td></tr></table></div></body></html>
