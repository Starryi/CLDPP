<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Securing and Optimizing Linux</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="RedHat, redhat, maddy, linus, linux, Linux, Securing, Optimising, security, secure, openna, gerhard"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book"><div class="titlepage"><div><div><h1 class="title"><a name="solrhe"></a>Securing and Optimizing Linux</h1></div><div><h2 class="subtitle">RedHat Edition -A Hands on Guide</h2></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Gerhard</span> <span class="surname">Mourani</span></h3><div class="affiliation"><span class="orgname">Open Network Architecture
                   <a class="link" href="#rsrcofwbi1" title="Open Network Architecture">www.openna.com</a>
                 <br></span><div class="address"><p><br>
             <code class="email">&lt;<a class="email" href="mailto:gmourani@openna.com">gmourani@openna.com</a>&gt;</code><br>
             <code class="email">&lt;<a class="email" href="mailto:gmourani@netscape.net">gmourani@netscape.net</a>&gt;</code><br>
             </p></div></div></div><div class="othercredit"><h3 class="othercredit"><span class="firstname">Madhu</span> <span class="othername">"Maddy"</span></h3><span class="contrib">Complete port of the Book to DocBook/XML source
                  and Editing</span> </div></div></div><div><p class="copyright">Copyright © 2000 Gerhard Mourani and OpenDocs, LLC.</p></div><div><p class="copyright">Copyright © 2000 
                  Madhusudan (Madhu "Maddy") XML Source 
                </p></div><div><div class="legalnotice"><a name="binflgnrsr1"></a><p>
                   This version and its subsequent outputs whether be it HTML, PDF or any other derivatives can be  distributed under the same licensing terms and conditions as the orginal <a class="link" href="#sc24obecfrs1" title="Obtaining the book and example configuration files">Securing and Optimizing Linux</a> i.e. as set forth in the 
                   Open Publication License; V1.0 or later, the latest version is presently available at <a class="link" href="#rsrclgnwbi2" title="Legalnotice">www.opencontent.org/openpub/</a>.   
                 </p><p>
                   Please note even if i madhusudan (Madhu "Maddy"),<code class="email">&lt;<a class="email" href="mailto:needaguru@yahoo.com">needaguru@yahoo.com</a>&gt;</code> hold the copyright for the XML source(Markup), you still need to get permission from Gerhard Mourani<code class="email">&lt;<a class="email" href="mailto:gmourani@openna.com">gmourani@openna.com</a>&gt;</code> the orginal author of <a class="link" href="#sc24obecfrs1" title="Obtaining the book and example configuration files">Securing and Optmising Linux</a>, 
                   to make any changes to the content of this book. Please do read the licensing terms and conditions detailed below for additional information
                 </p><p>This material may be distributed only subject to the terms and conditions 
                 set forth in the Open Publication License; V1.0 or later, the latest version 
                 is presently available at <a class="link" href="#rsrclgnwbi2" title="Legalnotice">www.opencontent.org/openpub/</a>.
                 </p><p>
                 Distribution of substantively modified versions of this document is 
                 prohibited without the explicit permission of the copyright holder.
                 </p><p>
                 Distribution of the work or derivative of the work in any standard (paper) 
                 book form for commercial purposes is prohibited unless prior permission 
                 is obtained from the copyright holder.
                 </p><p>
                 Please note even if I, Gerhard Mourani have the copyright, I don't control 
                 commercial printing of the book. Please contact <a class="link" href="#rsrclgnwbi2" title="Legalnotice">OpenDocs @www.opendocspublishing.com/</a> 
                 if you have questions concerning such matters.
                 </p><p>
                 The logos, trademarks, symbols used in this book are properties of their respective compan(y)ies.

                 </p></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="preface"><a href="#idm64">Preface</a></span></dt><dd><dl><dt><span class="section"><a href="#idm66">1. Why did i write this book?</a></span></dt><dt><span class="section"><a href="#idm71">2. Why fiddle?</a></span></dt><dt><span class="section"><a href="#idm94">3. DocBook ! </a></span></dt><dt><span class="section"><a href="#idm110">4. DocBook/<acronym class="acronym">XML</acronym></a></span></dt><dd><dl><dt><span class="section"><a href="#idm127">4.1. Bouquets Brickbats <abbr class="abbrev">Etc.</abbr></a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#idm141">1. Getting Started</a></span></dt><dd><dl><dt><span class="chapter"><a href="#ch1gnif">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#idm153">1. Audience</a></span></dt><dt><span class="section"><a href="#idm156">2. Organization of This Book</a></span></dt><dt><span class="section"><a href="#idm226">3. Pre-requisites</a></span></dt><dt><span class="section"><a href="#pr1ch2s4obefs">4. Obtaining the book and example configuration files</a></span></dt><dd><dl><dt><span class="section"><a href="#pr1ch2s4obefs1">4.1. Example Configuration files</a></span></dt></dl></dd><dt><span class="section"><a href="#idm283">5. Acknowledgements from Gerhard</a></span></dt><dd><dl><dt><span class="section"><a href="#pr1ch1ackn">5.1. Acknowledgements from "Maddy"</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#prt1bint">2. Installation</a></span></dt><dd><dl><dt><span class="chapter"><a href="#ch1prt1">2. Overview of OS Linux</a></span></dt><dd><dl><dt><span class="section"><a href="#idm334">1. What is Linux?</a></span></dt><dt><span class="section"><a href="#idm344">2.  A Few good reasons to use Linux</a></span></dt><dt><span class="section"><a href="#idm350">3. Fears, Uncertainity and Doubts</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr1ch2">3. Installation of your Linux Server</a></span></dt><dd><dl><dt><span class="section"><a href="#idm389">1. Know your Hardware!</a></span></dt><dt><span class="section"><a href="#prt2ch2sc2">2. Creating the Boot Disk and Booting</a></span></dt><dt><span class="section"><a href="#idm519">3. Installation Class and Method (Install Type)</a></span></dt><dt><span class="section"><a href="#idm536">4. Disk Setup- Disk Druid</a></span></dt><dt><span class="section"><a href="#idm635">5. Disk Druid</a></span></dt><dt><span class="section"><a href="#idm712">6. An example</a></span></dt><dt><span class="section"><a href="#pr1ch2sc7">7. Post-Partitioning</a></span></dt><dt><span class="section"><a href="#idm1033">8. 
               Components to Install- Package Group Selection
                 </a></span></dt><dt><span class="section"><a href="#idm1067">9. Select Individual Package - Part 'A'</a></span></dt><dt><span class="section"><a href="#idm1269">10. Select Individual Package -Part 'B'</a></span></dt><dt><span class="section"><a href="#idm1528">11. How to use RPM Commands</a></span></dt><dt><span class="section"><a href="#idm1567">12. Starting and stopping daemon services</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr2ch4Pi">4. Post-Install</a></span></dt><dd><dl><dt><span class="section"><a href="#ch3sc3.1-1">1. Software that must be uninstalled</a></span></dt><dt><span class="section"><a href="#idm1832">2. Use <acronym class="acronym">RPM</acronym> command to uninstall.</a></span></dt><dt><span class="section"><a href="#idm1904">3. Software that must be installed</a></span></dt><dt><span class="section"><a href="#idm2067">4. Check,Re-confirm</a></span></dt><dt><span class="section"><a href="#idm2617">5. Verify,Cross-check</a></span></dt><dt><span class="section"><a href="#idm3118">6. some colors for a change</a></span></dt><dt><span class="section"><a href="#prt2ch3sc7uls">7. Update of the latest software</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#idm3171">3. Security, Optimization and Upgrade</a></span></dt><dd><dl><dt><span class="chapter"><a href="#prt2ch1gss">5. General System Security</a></span></dt><dd><dl><dt><span class="section"><a href="#idm3193">1. BIOS</a></span></dt><dt><span class="section"><a href="#idm3200">2. Security as a Policy</a></span></dt><dt><span class="section"><a href="#idm3220">3. Choose a right Password</a></span></dt><dt><span class="section"><a href="#idm3244">4. The root account</a></span></dt><dt><span class="section"><a href="#idm3264">5. The <code class="filename">/etc/exports</code> file</a></span></dt><dt><span class="section"><a href="#p2ch1sct16">6. Disable console program access</a></span></dt><dt><span class="section"><a href="#idm3330">7. Disable all console access</a></span></dt><dt><span class="section"><a href="#idm3345">8. The inetd - <code class="filename">/etc/inetd.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm3395">9. TCP_WRAPPERS</a></span></dt><dd><dl><dt><span class="section"><a href="#idm3454">9.1. Don't display system issue file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm3460">10. The <code class="filename">/etc/host.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm3491">11. The /etc/services file</a></span></dt><dt><span class="section"><a href="#idm3503">12. The <code class="filename">/etc/securetty</code> file</a></span></dt><dt><span class="section"><a href="#idm3516">13. Special accounts</a></span></dt><dt><span class="section"><a href="#idm3602">14. Blocking; <span class="command"><strong>su</strong></span> to root, by one and sundry</a></span></dt><dt><span class="section"><a href="#idm3636">15. Put limits on resource</a></span></dt><dt><span class="section"><a href="#idm3663">16. Control mounting a file system</a></span></dt><dt><span class="section"><a href="#idm3724">17. Conceal binary <acronym class="acronym">RPM</acronym> </a></span></dt><dt><span class="section"><a href="#idm3744">18. Shell logging</a></span></dt><dt><span class="section"><a href="#idm3778">19. The LILO and <code class="filename">lilo.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm3836">20. Disable <span class="keycap"><strong>Ctrl-Alt-Delete</strong></span> keyboard shutdown command</a></span></dt><dt><span class="section"><a href="#idm3848">21. 
            Physical hard copies of all-important logs
              </a></span></dt><dt><span class="section"><a href="#idm3933">22. Tighten scripts under <code class="filename">/etc/rc.d/</code></a></span></dt><dd><dl><dt><span class="section"><a href="#idm3948">22.1. The <code class="filename">/etc/rc.d/rc.local</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm3975">23. 
            Bits from root-owned programs
              </a></span></dt><dt><span class="section"><a href="#idm4022">24. 
            The kernel tunable parameters</a></span></dt><dd><dl><dt><span class="section"><a href="#idm4027">24.1. Prevent your system responding to Ping</a></span></dt></dl></dd><dt><span class="section"><a href="#idm4050">25. Refuse responding to broadcasts request</a></span></dt><dt><span class="section"><a href="#idm4077">26. Routing Protocols</a></span></dt><dt><span class="section"><a href="#idm4104">27. Enable TCP SYN Cookie Protection</a></span></dt><dt><span class="section"><a href="#idm4131">28. Disable ICMP Redirect Acceptance</a></span></dt><dt><span class="section"><a href="#idm4153">29. Enable always-defragging Protection</a></span></dt><dt><span class="section"><a href="#idm4175">30. Enable bad error message Protection</a></span></dt><dt><span class="section"><a href="#idm4196">31. Enable <acronym class="acronym">IP</acronym> spoofing protection</a></span></dt><dt><span class="section"><a href="#idm4222">32. Log Spoofed, Source Routed and Redirect Packets</a></span></dt><dt><span class="section"><a href="#idm4243">33. Unusual or hidden files</a></span></dt><dt><span class="section"><a href="#idm4325">34. System is compromised !</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr3ch6lglc">6. Linux General Optimization</a></span></dt><dd><dl><dt><span class="section"><a href="#idm4340">1. The /etc/profile file</a></span></dt><dt><span class="section"><a href="#prt3ch2sc2br">2. Benchmark Results</a></span></dt><dt><span class="section"><a href="#idm4486">3. Benchmark results-i586</a></span></dt><dt><span class="section"><a href="#idm4501">4. Benchmark results -i486
               </a></span></dt><dt><span class="section"><a href="#idm4516">5. The bdflush parameters</a></span></dt><dt><span class="section"><a href="#idm4592">6. The buffermem parameters</a></span></dt><dt><span class="section"><a href="#idm4644">7. The ip_local_port_range parameters</a></span></dt><dt><span class="section"><a href="#idm4674">8. The <code class="filename">/etc/nsswitch.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm4692">9. 
          The file-max parameter
            </a></span></dt><dt><span class="section"><a href="#idm4733">10. The ulimit parameter</a></span></dt><dt><span class="section"><a href="#pr2ch6scntm">11. The atime and noatime attribute</a></span></dt><dt><span class="section"><a href="#idm4832">12. Tuning <acronym class="acronym">IDE</acronym> Hard Disk Performance</a></span></dt><dt><span class="section"><a href="#idm4895">13. Better manage your <acronym class="acronym">TCP/IP</acronym> resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr3ch7lnke">7. Configuring and Building a Secure, Optimized Kernel</a></span></dt><dd><dl><dt><span class="section"><a href="#prt3ch3sc1pi">1. Pre-Install</a></span></dt><dd><dl><dt><span class="section"><a href="#idm5018">1.1. Make an emergency boot floppy</a></span></dt></dl></dd><dt><span class="section"><a href="#idm5045">2.  Uninstallation and Optimization</a></span></dt><dt><span class="section"><a href="#idm5155">3. Securing the kernel</a></span></dt><dt><span class="section"><a href="#idm5235">4. Compilation</a></span></dt><dt><span class="section"><a href="#prt2sct35kcon">5. Kernel configuration -Part "A"</a></span></dt><dt><span class="section"><a href="#idm5390">6. Kernel configuration -Part "B"</a></span></dt><dt><span class="section"><a href="#idm5471">7. Kernel configuration -Part "C"</a></span></dt><dt><span class="section"><a href="#idm5538">8. Kernel configuration -Part "D"</a></span></dt><dt><span class="section"><a href="#idm5590">9. Kernel configuration -Part "E"</a></span></dt><dt><span class="section"><a href="#idm5643">10. Installing the new kernel</a></span></dt><dt><span class="section"><a href="#idm5761">11. Delete programs, Edit files pertaining to modules</a></span></dt><dt><span class="section"><a href="#idm5828">12. Create a emergency Rescue and Boot floppy disk</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#idm5891">4. Networking -Management, Firewall, Masquerading and Forwarding</a></span></dt><dd><dl><dt><span class="chapter"><a href="#idm5901">8. <acronym class="acronym">TCP/IP</acronym> -Network Management</a></span></dt><dd><dl><dt><span class="section"><a href="#idm5906">1. Multiple Ethernet Card per Machine</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm5981">9. Files -Networking Functionality</a></span></dt><dd><dl><dt><span class="section"><a href="#idm5990">1. The <code class="filename">/etc/HOSTNAME</code> file</a></span></dt><dt><span class="section"><a href="#idm5998">2. The <code class="filename">/etc/sysconfig/network-scripts/ifcfg-ethN</code> files</a></span></dt><dt><span class="section"><a href="#idm6043">3. The <code class="filename">/etc/resolv.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm6059">4. The <code class="filename">/etc/host.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm6085">5. The <code class="filename">/etc/sysconfig/network</code> file</a></span></dt><dt><span class="section"><a href="#idm6129">6. The <code class="filename">/etc/sysctl.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm6160">7. The <code class="filename">/etc/hosts</code> file</a></span></dt><dt><span class="section"><a href="#idm6199">8. Config <acronym class="acronym">TCP/IP</acronym> Networking manually -command line</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr4ch4nfl">10. Networking -Firewall</a></span></dt><dd><dl><dt><span class="section"><a href="#idm6289">1. Policy, Guidelines <abbr class="abbrev">etc.</abbr></a></span></dt><dt><span class="section"><a href="#idm6306">2. The topology</a></span></dt><dt><span class="section"><a href="#idm6439">3. Build a kernel with <code class="literal">IPCHAINS</code> Firewall support</a></span></dt><dt><span class="section"><a href="#idm6448">4. Rules used in the Firewall script files</a></span></dt><dt><span class="section"><a href="#idm6542">5. Source Address Filtering</a></span></dt></dl></dd><dt><span class="chapter"><a href="#prt3chp4fscf">11. The firewall scripts files</a></span></dt><dd><dl><dt><span class="section"><a href="#pr3ch4fsfsc41">1. 
          Config <code class="filename">/etc/rc.d/init.d/firewall</code> script file  -Web Server</a></span></dt><dt><span class="section"><a href="#pr3ch4fsfsc42">2. Config <code class="filename">/etc/rc.d/init.d/firewall</code> script file - Mail Server</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr4ch12nfmf">12. Networking Firewall -Masquerading and Forwarding</a></span></dt><dd><dl><dt><span class="section"><a href="#idm6691">1. Build a kernel with Firewall Masquerading and Forwarding support</a></span></dt><dt><span class="section"><a href="#idm6810">2. Config <code class="filename">/etc/rc.d/init.d/firewall</code> script file -Gateway Server</a></span></dt><dt><span class="section"><a href="#idm6824">3. Configure script for Example Gateway Server</a></span></dt><dt><span class="section"><a href="#idm6886">4. Deny access to some address</a></span></dt><dt><span class="section"><a href="#idm6923">5. <code class="literal">IPCHAINS</code> Administrative Tools</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#idm6948">5. Software -Security</a></span></dt><dd><dl><dt><span class="chapter"><a href="#idm6964">13. Linux -The Compiler functionality</a></span></dt><dd><dl><dt><span class="section"><a href="#idm6968">1. The necessary packages</a></span></dt><dt><span class="section"><a href="#idm7103">2. Why choose <code class="literal">tarballs</code>?</a></span></dt><dd><dl><dt><span class="section"><a href="#idm7127">2.1. Compiling software on your system</a></span></dt></dl></dd><dt><span class="section"><a href="#idm7164">3. Build, Install software on your system</a></span></dt><dd><dl><dt><span class="section"><a href="#idm7244">3.1. Edit files with the vi editor</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#prt5ch2ssmt">14. Software -Security/Monitoring</a></span></dt><dd><dl><dt><span class="section"><a href="#prt5ch2s1Xd">1. sXid</a></span></dt><dt><span class="section"><a href="#idm7400">2. Configure and Optimize sXid</a></span></dt><dd><dl><dt><span class="section"><a href="#idm7427">2.1. Configure the <code class="filename">/etc/sxid.conf</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#pr5ch2sc3lc">3. Logcheck</a></span></dt><dt><span class="section"><a href="#idm7569">4. Configure and Optimize Logcheck</a></span></dt><dt><span class="section"><a href="#prt5ch2sc5PS">5. PortSentry</a></span></dt><dt><span class="section"><a href="#idm7748">6. Configure and Optimise Portsentry</a></span></dt><dt><span class="section"><a href="#idm7774">7. Test fire your PortSentry</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#idm7867">6. Software -Networking</a></span></dt><dd><dl><dt><span class="chapter"><a href="#prt6ch15ssh">15. Software -Securities</a></span></dt><dd><dl><dt><span class="section"><a href="#prt6ch1sc1ossh">1. OpenSSH</a></span></dt><dt><span class="section"><a href="#idm7998">2. Configure and optimise Openssh</a></span></dt><dt><span class="section"><a href="#idm8037">3. Configure the <code class="filename">/etc/ssh/ssh_config file</code></a></span></dt><dt><span class="section"><a href="#idm8173">4. Configure the <code class="filename">/etc/ssh/sshd_config file</code></a></span></dt><dt><span class="section"><a href="#idm8326">5. Configure OpenSSH to use TCP-Wrappers/inetd super server</a></span></dt><dt><span class="section"><a href="#idm8430">6. OpenSSH Per-User Configuration</a></span></dt><dt><span class="section"><a href="#idm8480">7. OpenSSH Users Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm8495">7.1. scp</a></span></dt></dl></dd><dt><span class="section"><a href="#idm8536">8. Installed files</a></span></dt><dd><dl><dt><span class="section"><a href="#idm8578">8.1. Free SSH clients for Windows</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#idm8590">16. Software -Securties(commercial)</a></span></dt><dd><dl><dt><span class="section"><a href="#prt6ch2sc1ssh">1. Linux SSH2 Client/Server</a></span></dt><dt><span class="section"><a href="#idm8669">2. Configure and Optimise SSH2</a></span></dt><dt><span class="section"><a href="#idm8707">3. Configure the <code class="filename">/etc/ssh2/ssh2_config</code> file</a></span></dt><dt><span class="section"><a href="#idm8822">4. Configure the <code class="filename">/etc/ssh2/sshd2_config</code> file</a></span></dt><dt><span class="section"><a href="#idm9020">5. Configure sshd2 to use tcp-wrappers/inetd super server</a></span></dt><dt><span class="section"><a href="#idm9082">6. Configuration of the <code class="filename">/etc/pam.d/ssh</code> file</a></span></dt><dt><span class="section"><a href="#idm9130">7. Ssh2 Per-User Configuration</a></span></dt><dt><span class="section"><a href="#idm9179">8. SSH2 Users Tools</a></span></dt><dt><span class="section"><a href="#idm9208">9. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr6ch17SSSI">17. Software -Securities/System Integrity</a></span></dt><dd><dl><dt><span class="section"><a href="#prt6ch3sc1trwr">1. Linux Tripwire 2.2.1</a></span></dt><dt><span class="section"><a href="#idm9368">2. Configure the <code class="filename">/var/tmp/install.cfg</code> file</a></span></dt><dt><span class="section"><a href="#idm9423">3. Configuration files</a></span></dt><dt><span class="section"><a href="#idm9454">4. Configure the <code class="filename">/usr/TSS/policy/twpol.txt</code> file</a></span></dt><dt><span class="section"><a href="#idm9482">5. Securing Tripwire for Linux</a></span></dt><dd><dl><dt><span class="section"><a href="#idm9547">5.1. Often used Commands</a></span></dt></dl></dd><dt><span class="section"><a href="#idm9566">6. Integrity or Interactive Check Mode</a></span></dt><dt><span class="section"><a href="#idm9608">7. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr6ch4sc1ltp">18. Linux Tripwire ASR 1.3.1</a></span></dt><dd><dl><dt><span class="section"><a href="#idm9682">1. Install, Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm9796">2. Configurations</a></span></dt><dt><span class="section"><a href="#idm9824">3. Configure the <code class="filename">/etc/tw.config</code> file</a></span></dt><dt><span class="section"><a href="#idm9844">4. Configure the <code class="filename">/etc/cron.daily/tripwire.verify</code> script</a></span></dt><dd><dl><dt><span class="section"><a href="#idm9860">4.1. Security Issue</a></span></dt></dl></dd><dt><span class="section"><a href="#idm9889">5. Tripwire in <code class="literal">Interactive Checking Mode</code></a></span></dt><dt><span class="section"><a href="#pr6ch4sc5trp">6. Run Tripwire in <em class="wordasword">Database Update Mode</em></a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch4sc51tri">6.1. Installed Files</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#idm9985">19. Software -Securities/Management &amp; Limitation</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch19sgpgp">1. Linux GnuPG</a></span></dt><dt><span class="section"><a href="#idm10052">2. Often used Commands</a></span></dt><dt><span class="section"><a href="#idm10071">3. Importing keys</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10084">3.1. Key signing</a></span></dt></dl></dd><dt><span class="section"><a href="#idm10104">4. Encrypt and decrypt</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10144">4.1. Exporting your public key</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#idm10190">20. Set Limits using Qouta</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10192">1. Qouta</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10214">1.1. Modify the <code class="filename">/etc/fstab</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm10283">2. Create of the <code class="filename">quota.user</code> and <code class="filename">quota.group</code> </a></span></dt><dt><span class="section"><a href="#idm10348">3. edquota </a></span></dt><dd><dl><dt><span class="section"><a href="#idm10390">3.1. The <code class="literal">grace period</code> parameter</a></span></dt></dl></dd><dt><span class="section"><a href="#idm10411">4. Assign quota for a particular group</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10421">4.1. Assign quota for groups of users with the same value</a></span></dt></dl></dd><dt><span class="section"><a href="#idm10481">5. Often used Commands</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr6ch21Sonet">21. Software -Networking</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch7sc1dbs">1. Linux <acronym class="acronym">DNS</acronym> and <acronym class="acronym">BIND</acronym> Server</a></span></dt><dt><span class="section"><a href="#idm10608">2. Configure</a></span></dt><dt><span class="section"><a href="#idm10707">3. <code class="literal">Caching-only</code> name Server</a></span></dt><dt><span class="section"><a href="#idm10804">4. Primary <code class="literal">master</code> name Server</a></span></dt><dt><span class="section"><a href="#idm10913">5. <code class="literal">Secondary</code> slave name Server</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10964">5.1. <code class="filename">/etc/rc.d/init.d/named script </code></a></span></dt></dl></dd><dt><span class="section"><a href="#idm10999">6. Run <acronym class="acronym">ISC</acronym>  <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> in a chroot jail</a></span></dt><dt><span class="section"><a href="#idm11151">7. The syslog daemon</a></span></dt><dt><span class="section"><a href="#idm11242">8. Clean-up and Test the new chrooted jail</a></span></dt><dt><span class="section"><a href="#idm11414">9. DNS Administrative Tools</a></span></dt><dt><span class="section"><a href="#idm11447">10. <acronym class="acronym">DNS</acronym> Users Tools</a></span></dt><dt><span class="section"><a href="#idm11519">11. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr6ch22SSMn">22. Software -Server/Mail Network</a></span></dt><dd><dl><dt><span class="section"><a href="#idm11678">1. Linux Sendmail Server</a></span></dt><dt><span class="section"><a href="#idm11743">2. Compile and optimize</a></span></dt><dt><span class="section"><a href="#idm11916">3. Configurations</a></span></dt><dt><span class="section"><a href="#idm11977">4. The <code class="filename">/etc/sendmail.mc</code> file /Central Mail Hub</a></span></dt><dt><span class="section"><a href="#idm12145">5. Build and Tweak Sendmail</a></span></dt><dd><dl><dt><span class="section"><a href="#idm12162">5.1. The <code class="filename">null.mc</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm12262">6. The <code class="filename">/etc/mail/access</code> and <code class="filename">access.db</code> files </a></span></dt><dt><span class="section"><a href="#idm12298">7. The <code class="filename">/etc/mail/aliases</code> and <code class="filename">aliases.db</code> files</a></span></dt><dd><dl><dt><span class="section"><a href="#idm12333">7.1. The <code class="filename">/etc/mail/</code> Directory</a></span></dt></dl></dd><dt><span class="section"><a href="#idm12384">8. The <code class="filename">/etc/mail/local-host-names</code> file </a></span></dt><dd><dl><dt><span class="section"><a href="#idm12420">8.1. Configure the <code class="filename">/etc/sysconfig/sendmail</code> file </a></span></dt></dl></dd><dt><span class="section"><a href="#idm12442">9. The <code class="filename">/etc/rc.d/init.d/sendmail</code> script file</a></span></dt><dt><span class="section"><a href="#idm12474">10. Secure Sendmail using <span class="command"><strong>smrsh</strong></span></a></span></dt><dt><span class="section"><a href="#idm12577">11. The <code class="filename">/etc/mail/aliases</code> file</a></span></dt><dt><span class="section"><a href="#idm12660">12. Limit queue processing to <code class="literal">root</code></a></span></dt><dd><dl><dt><span class="section"><a href="#idm12681">12.1. The <acronym class="acronym">SMTP</acronym> greeting message</a></span></dt></dl></dd><dt><span class="section"><a href="#idm12780">13. Sendmail Administrative Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm12823">13.1. Sendmail Users Tools</a></span></dt></dl></dd><dt><span class="section"><a href="#idm12842">14. Installed  files: Sendmail -Central Mail Hub</a></span></dt><dt><span class="section"><a href="#idm12932">15. Installed files: Sendmail -Local server/client</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm12988">23. Linux <acronym class="acronym">IMAP</acronym> &amp; <acronym class="acronym">POP</acronym> Server</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch23sc1ip">1. Configure and Compile</a></span></dt><dt><span class="section"><a href="#idm13186">2. Configure to tweak</a></span></dt><dd><dl><dt><span class="section"><a href="#idm13224">2.1. The <code class="filename">/etc/pam.d/imap</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm13258">3. Enable <acronym class="acronym">IMAP</acronym> or <acronym class="acronym">POP</acronym> via the tcp-wrappers inetd super server</a></span></dt><dd><dl><dt><span class="section"><a href="#idm13306">3.1. Securing <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym></a></span></dt></dl></dd><dt><span class="section"><a href="#idm13367">4. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr6ch24SoNE">24. Software -Networking/Encryption</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch24sc1ossl">1. Linux OPENSSL Server</a></span></dt><dt><span class="section"><a href="#idm13648">2. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm13782">3. Configure OpenSSL to optimise</a></span></dt><dt><span class="section"><a href="#idm13820">4. The <code class="filename">/etc/ssl/openssl.cnf</code> file</a></span></dt><dt><span class="section"><a href="#idm13846">5. Create the <code class="filename">/usr/bin/sign.sh</code> program file</a></span></dt><dt><span class="section"><a href="#idm13874">6. Commands -often used</a></span></dt><dt><span class="section"><a href="#idm14003">7. Securing OpenSSL</a></span></dt><dt><span class="section"><a href="#idm14021">8. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm14399">25. Linux FreeS/WAN VPN</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch25sc1fsw">1. IPSEC/VPN -FreeS/WAN</a></span></dt><dt><span class="section"><a href="#idm14485">2. Compile, insert FreeS/WAN into the kernel</a></span></dt><dt><span class="section"><a href="#idm14621">3. Reconfigure and install the kernel with FreeS/WAN VPN support</a></span></dt><dt><span class="section"><a href="#idm14699">4. Configure to optimise</a></span></dt><dt><span class="section"><a href="#idm14737">5. Automatic or Manual Key connections</a></span></dt><dt><span class="section"><a href="#idm14792">6. The <code class="filename">/etc/ipsec.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm14954">7. The <code class="filename">/etc/ipsec.secrets</code> file</a></span></dt><dt><span class="section"><a href="#idm15018">8. Configure <acronym class="acronym">RSA</acronym> private keys secrets</a></span></dt><dt><span class="section"><a href="#idm15198">9. Required network setup for IPSec</a></span></dt><dt><span class="section"><a href="#idm15370">10. Testing the installation</a></span></dt><dt><span class="section"><a href="#idm15416">11. Further documentation</a></span></dt><dt><span class="section"><a href="#idm15892">12. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm16038">26. Linux OpenLDAP Server</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch26sccmi">1. Compile ans Install</a></span></dt><dt><span class="section"><a href="#idm16093">2. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm16204">3. Configurations</a></span></dt><dt><span class="section"><a href="#idm16241">4. Configure the <code class="filename">/etc/ldap/slapd.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm16303">5. Configure the <code class="filename">/etc/rc.d/init.d/ldap</code> script file</a></span></dt><dt><span class="section"><a href="#idm16326">6. Securing OpenLDAP</a></span></dt><dt><span class="section"><a href="#idm16450">7. OpenLDAP Creation and Maintenance Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm16469">7.1. <acronym class="acronym">LDMB</acronym> backend database off-line </a></span></dt></dl></dd><dt><span class="section"><a href="#idm16505">8. Create the LDMB backend database on-line</a></span></dt><dd><dl><dt><span class="section"><a href="#idm16544">8.1. ldapmodify</a></span></dt></dl></dd><dt><span class="section"><a href="#idm16571">9. OpenLDAP Users Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm16593">9.1. The Netscape Address Book client for <acronym class="acronym">LDAP</acronym></a></span></dt></dl></dd><dt><span class="section"><a href="#idm16638">10. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm17110">27. Linux PostgreSQL Database Server</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch27scpsql">1. Install PostgreSQL</a></span></dt><dt><span class="section"><a href="#idm17174">2. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm17277">3. Database installation using superuser account</a></span></dt><dt><span class="section"><a href="#idm17319">4. Configuration files</a></span></dt><dt><span class="section"><a href="#idm17352">5. Configure the <code class="filename">/etc/rc.d/init.d/postgresql</code> script file</a></span></dt><dt><span class="section"><a href="#idm17370">6. Commands often used</a></span></dt><dt><span class="section"><a href="#idm17438">7. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr6sserprnt">28. Software -Server/Proxy Network</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch28scsps">1. Linux Squid Proxy Server</a></span></dt><dt><span class="section"><a href="#idm17930">2. Configure and Optimize</a></span></dt><dt><span class="section"><a href="#idm18014">3. Improve performance Using GNU malloc library </a></span></dt><dt><span class="section"><a href="#idm18048">4. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm18123">5. Configurations</a></span></dt><dt><span class="section"><a href="#pr6ch28scsqcnf">6. Configure the <code class="filename">/etc/squid/squid.conf</code> file -in <code class="literal">httpd-accelerator mode</code></a></span></dt><dt><span class="section"><a href="#idm18345">7. Configure of the <code class="filename">/etc/squid/squid.conf</code> file -/proxy-caching mode</a></span></dt><dt><span class="section"><a href="#idm18388">8. Configure the <code class="filename">/etc/rc.d/init.d/squid</code> script file -/all configurations</a></span></dt><dt><span class="section"><a href="#idm18419">9. Configure the <code class="filename">/etc/logrotate.d/squid</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm18428">9.1. Securing and Immunize Squid</a></span></dt></dl></dd><dt><span class="section"><a href="#idm18456">10. Optimizing Squid</a></span></dt><dd><dl><dt><span class="section"><a href="#idm18464">10.1. The cachemgr.cgi </a></span></dt></dl></dd><dt><span class="section"><a href="#idm18503">11. Netscape Proxies Configuration</a></span></dt><dt><span class="section"><a href="#idm18550">12. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr6ch29wapch">29. Software -Network Server, web/Apache</a></span></dt><dd><dl><dt><span class="section"><a href="#prt6ch29scmm">1. Linux MM Shared Memory Library </a></span></dt><dt><span class="section"><a href="#idm18766">2. Compile</a></span></dt><dd><dl><dt><span class="section"><a href="#idm18801">2.1. Installed files</a></span></dt></dl></dd><dt><span class="section"><a href="#prt6ch29sapws">3. Linux Apache Web Server</a></span></dt><dt><span class="section"><a href="#idm18910">4. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm18970">5. Configure and apply <acronym class="acronym">PHP4</acronym> to Apache source</a></span></dt><dt><span class="section"><a href="#idm19032">6. Apply mod_perl to Apache source tree </a></span></dt><dt><span class="section"><a href="#idm19118">7. Install Apache</a></span></dt><dt><span class="section"><a href="#idm19184">8. Post install Configuration</a></span></dt><dt><span class="section"><a href="#idm19232">9. Configure the <code class="filename">/etc/httpd/conf/httpd.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm19392">10. Configure the <code class="filename">/etc/logrotate.d/apache</code> file</a></span></dt><dt><span class="section"><a href="#idm19414">11. Configure the <code class="filename">/etc/rc.d/init.d/httpd</code> script file</a></span></dt><dt><span class="section"><a href="#idm19437">12. <acronym class="acronym">PHP4</acronym> server-side scripting</a></span></dt><dt><span class="section"><a href="#pr6ch29sappsy">13. Perl module Devel::Symdump</a></span></dt><dd><dl><dt><span class="section"><a href="#idm19531">13.1. Installed files</a></span></dt></dl></dd><dt><span class="section"><a href="#pr6ch29sapcgi">14. CGI.pm Perl library</a></span></dt><dd><dl><dt><span class="section"><a href="#idm19579">14.1. Installed files</a></span></dt></dl></dd><dt><span class="section"><a href="#pr6ch29apscr">15. Securing Apache</a></span></dt><dt><span class="section"><a href="#idm19622">16. users authentication with <code class="filename">.dbmpasswd</code> password file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm19672">16.1. Immunize configuration files like <code class="filename">httpd.conf</code></a></span></dt></dl></dd><dt><span class="section"><a href="#idm19679">17. Apache in a chroot jail</a></span></dt><dt><span class="section"><a href="#idm19800">18. Apache to use shared libraries</a></span></dt><dt><span class="section"><a href="#idm19849">19. The <code class="filename">/chroot/etc</code> directory</a></span></dt><dt><span class="section"><a href="#idm19936">20. Test the new chrooted jail</a></span></dt><dt><span class="section"><a href="#idm19965">21. Configure the new <code class="filename">/etc/logrotate.d/apache</code> file</a></span></dt><dt><span class="section"><a href="#pr6ch29sapo">22. Optimizing Apache</a></span></dt><dt><span class="section"><a href="#idm20023">23. Installed files for Apache Web Server</a></span></dt><dt><span class="section"><a href="#idm20209">24. Installed files /PHP4</a></span></dt><dt><span class="section"><a href="#idm20445">25. Installed files by mod_perl</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm20873">30. Optional component to install with Apache</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch30swblzr">1. Linux Webalizer</a></span></dt><dt><span class="section"><a href="#idm20959">2. Compile</a></span></dt><dd><dl><dt><span class="section"><a href="#idm20986">2.1. Configurations</a></span></dt></dl></dd><dt><span class="section"><a href="#idm21018">3. Configure the <code class="filename">/etc/webalizer.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm21094">4. Make Apache aware of Webalizer output directory</a></span></dt><dd><dl><dt><span class="section"><a href="#idm21112">4.1. Running Webalizer manually first time</a></span></dt></dl></dd><dt><span class="section"><a href="#idm21128">5. Run Webalizer automatically with a cron job</a></span></dt><dd><dl><dt><span class="section"><a href="#idm21134">5.1. Installed files</a></span></dt></dl></dd><dt><span class="section"><a href="#pr6ch30scfqmtc">6. Linux FAQ-O-Matic</a></span></dt><dt><span class="section"><a href="#idm21203">7. Compile and install FAQ-O-Matic</a></span></dt><dt><span class="section"><a href="#idm21263">8. Make Apache aware Faq-O-Matic file's location</a></span></dt><dt><span class="section"><a href="#idm21281">9. Configure your FAQ-O-Matic</a></span></dt><dt><span class="section"><a href="#idm21343">10. Installed files</a></span></dt><dt><span class="section"><a href="#pr6ch30swmlimp">11. Linux Webmail IMP</a></span></dt><dt><span class="section"><a href="#pr6ch30sphplb">12. Set up PHPLib </a></span></dt><dt><span class="section"><a href="#idm21572">13. Compile to install Webmail IMP</a></span></dt><dt><span class="section"><a href="#idm21628">14. Configure and create Webmail IMP SQL database</a></span></dt><dt><span class="section"><a href="#idm21708">15. Configure your <code class="filename">php.ini</code> from PHP4</a></span></dt><dd><dl><dt><span class="section"><a href="#idm21728">15.1. Configure Apache to recognize Webmail IMP</a></span></dt></dl></dd><dt><span class="section"><a href="#idm21743">16. Configure Webmail <acronym class="acronym">IMP</acronym> via your web browser</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm21783">31. Software -Server/File Sharing-Network</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch31slss">1. Linux Samba Server</a></span></dt><dt><span class="section"><a href="#idm21840">2. Configure Samba</a></span></dt><dt><span class="section"><a href="#idm21889">3. Compile and optimize</a></span></dt><dt><span class="section"><a href="#idm21961">4. Configurations</a></span></dt><dt><span class="section"><a href="#idm22007">5. Configuration of the <code class="filename">/etc/smb.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm22266">6. Configure the <code class="filename">/etc/lmhosts</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm22283">6.1. Configure the <code class="filename">/etc/pam.d/samba</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm22302">7. Encrypted Samba password file for clients</a></span></dt><dt><span class="section"><a href="#idm22359">8. Optimizing Samba</a></span></dt><dd><dl><dt><span class="section"><a href="#idm22366">8.1. Tuning the buffer cache</a></span></dt></dl></dd><dt><span class="section"><a href="#idm22401">9. Tuning the buffermem</a></span></dt><dt><span class="section"><a href="#idm22430">10. Further documentation</a></span></dt><dt><span class="section"><a href="#idm22539">11. Samba Administrative Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm22548">11.1. Samba Users Tools</a></span></dt></dl></dd><dt><span class="section"><a href="#idm22563">12. The <code class="filename">/etc/rc.d/init.d/smb</code> script file</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch31ssmb">12.1. Securing Samba</a></span></dt></dl></dd><dt><span class="section"><a href="#idm22595">13. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm22763">32. Linux <code class="literal">FTP</code> Server</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch32sftp">1. chroot'd Guest FTP access</a></span></dt><dt><span class="section"><a href="#idm22819">2. Setup an <code class="literal">FTP</code> user account minus shells</a></span></dt><dt><span class="section"><a href="#idm22888">3. Setup a chroot user environment</a></span></dt><dt><span class="section"><a href="#idm23080">4. Configurations</a></span></dt><dt><span class="section"><a href="#idm23132">5. Configure the <code class="filename">/etc/ftphosts</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm23156">5.1. Configure the <code class="filename">/etc/ftpusers</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm23175">6. Configure the <code class="filename">/etc/ftpconversions</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm23192">6.1. Configure the <code class="filename">/etc/pam.d/ftp</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm23199">7. Configure the <code class="filename">/etc/logrotate.d/ftpd</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm23206">7.1. Configure ftpd to use tcp-wrappers inetd</a></span></dt></dl></dd><dt><span class="section"><a href="#idm23228">8. <acronym class="acronym">FTP</acronym> Administrative Tools</a></span></dt><dt><span class="section"><a href="#idm23250">9. Securing <code class="literal">FTP</code></a></span></dt><dt><span class="section"><a href="#idm23313">10. The special file <code class="filename">.notar</code></a></span></dt><dt><span class="section"><a href="#idm23372">11. Installed files</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#idm23430">7. Backup and Restore</a></span></dt><dd><dl><dt><span class="chapter"><a href="#idm23440">33. Why's and When's of Backup and Restore</a></span></dt><dd><dl><dt><span class="section"><a href="#idm23450">1. What to backup</a></span></dt><dt><span class="section"><a href="#idm23462">2. The tar backup program</a></span></dt><dt><span class="section"><a href="#idm23611">3. Automating backups with <span class="command"><strong>tar</strong></span></a></span></dt><dt><span class="section"><a href="#idm23684">4. Restore files with <span class="command"><strong>tar</strong></span></a></span></dt><dt><span class="section"><a href="#idm23747">5. The dump backup program</a></span></dt><dt><span class="section"><a href="#idm23825">6. Making backups with dump</a></span></dt><dt><span class="section"><a href="#idm23976">7. Restoring files with dump</a></span></dt><dt><span class="section"><a href="#idm24060">8. Backing up and restoring over the network</a></span></dt><dd><dl><dt><span class="section"><a href="#idm24088">8.1. Using the scp SSH command </a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#idm24169">I. Appendixes</a></span></dt><dd><dl><dt><span class="appendix"><a href="#idm24182">A. Resources</a></span></dt><dt><span class="appendix"><a href="#idm24626">B. Tweaks, Tips and Administration tasks</a></span></dt><dt><span class="appendix"><a href="#pr7ap3rfc">C. Obtaining Requests for Comments (RFCs)</a></span></dt></dl></dd></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>3.1. <a href="#idm907">Sample representaion of partitions</a></dt><dt>33.1. <a href="#idm23759">Dump scheme</a></dt></dl></div><div class="list-of-examples"><p><b>List of Examples</b></p><dl><dt>3.1. <a href="#idm1574">Starting and Stopping various Daemon's</a></dt><dt>5.1. <a href="#idm3270">Export file systems using <acronym class="acronym">NFS</acronym></a></dt><dt>5.2. <a href="#idm3307">Disable console-equivalent access</a></dt><dt>5.3. <a href="#idm3854">Print log reports </a></dt><dt>5.4. <a href="#idm4016">Use man pages</a></dt><dt>5.5. <a href="#idm4250">Use find to find</a></dt><dt>6.1. <a href="#idm4625">For 128 MB of RAM</a></dt><dt>7.1. <a href="#idm5283">SMP support</a></dt><dt>8.1. <a href="#idm5920">Two ISA ethernet cards</a></dt><dt>12.1. <a href="#idm6898"><code class="filename">rc.firewall.blocked</code></a></dt><dt>13.1. <a href="#idm7175">Using tar</a></dt><dt>15.1. <a href="#idm8487">Remote login using ssh</a></dt><dt>15.2. <a href="#idm8501">scp Secure Copy utility</a></dt><dt>15.3. <a href="#idm8511">local to remote</a></dt><dt>16.1. <a href="#idm9187">login to a remote using ssh2</a></dt><dt>16.2. <a href="#idm9200">sftp2, Secure File Transfer</a></dt><dt>18.1. <a href="#idm9929">Usage of Tripwire</a></dt><dt>19.1. <a href="#idm10076">Importing using gpg</a></dt><dt>19.2. <a href="#idm10089">Signing key</a></dt><dt>19.3. <a href="#idm10109">Encrypting</a></dt><dt>19.4. <a href="#idm10132">Decrypting</a></dt><dt>20.1. <a href="#idm10233"><code class="literal">usrquota</code></a></dt><dt>20.2. <a href="#idm10253"><code class="literal">grpquota</code></a></dt><dt>21.1. <a href="#idm11472">dnsquery</a></dt><dt>21.2. <a href="#idm11485">Look up host names</a></dt><dt>21.3. <a href="#idm11500">Using host</a></dt><dt>21.4. <a href="#idm11511">List a complete domain</a></dt><dt>22.1. <a href="#idm12140">Overriding <acronym class="acronym">RBL</acronym></a></dt><dt>22.2. <a href="#idm12401">Alternative names</a></dt><dt>22.3. <a href="#idm12549"><code class="filename">sendmail.cf</code></a></dt><dt>26.1. <a href="#idm16477"><code class="filename">my-data-file</code></a></dt><dt>26.2. <a href="#idm16513"><acronym class="acronym">LDMB</acronym> backend</a></dt><dt>26.3. <a href="#idm16549"><code class="filename">modifyentry</code></a></dt><dt>26.4. <a href="#idm16613">Address Book</a></dt><dt>30.1. <a href="#idm21301">Using Netscape browser</a></dt><dt>33.1. <a href="#idm23634">Backup directory of a week</a></dt><dt>33.2. <a href="#idm24103">scp SSH command</a></dt><dt>33.3. <a href="#idm24141">scp SSH command</a></dt></dl></div><div class="preface"><div class="titlepage"><div><div><h1 class="title"><a name="idm64"></a>Preface</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm66">1. Why did i write this book?</a></span></dt><dt><span class="section"><a href="#idm71">2. Why fiddle?</a></span></dt><dt><span class="section"><a href="#idm94">3. DocBook ! </a></span></dt><dt><span class="section"><a href="#idm110">4. DocBook/<acronym class="acronym">XML</acronym></a></span></dt><dd><dl><dt><span class="section"><a href="#idm127">4.1. Bouquets Brickbats <abbr class="abbrev">Etc.</abbr></a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm66"></a>1. Why did i write this book?</h2></div></div></div><p>
                  When I began writing this book, the first question I asked myself was how to 
                  install Linux on a  server, and be sure that no one from the outside, or 
                  inside, could access it without authorization. Then I wondered if any method 
                  similar to the one on <span class="trademark">Windows</span>® exists to improve the computers 
                  performance. Subsequently, I began a search on the Internet and read several books 
                  to get the most information on security and performance for my server. After many 
                  years of research and studies I had finally found the answer to my questions. 
                  These answers were found, all scattered throughout different documents, books, 
                  articles, and Internet sites. I created  documentation based on my research that 
                  could help me through my daily activities.  </p><p>Through the years, my documentation grew and started to look more like a book 
                    and less like simple,  scattered notes. I decide to publish it on the Internet so 
                    that anyone could take advantage of it. By sharing this information, I felt that I 
                    was doing my part for the community who answered so many of my computing needs with 
                    one magical, reliable, strong, powerful, fast and free operating system named Linux. 
                    I had received a lot of feedback and comments about my documentation, which helped to 
                    improve it over time.
                    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm71"></a>2. Why fiddle?</h2></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Madhu</span> <span class="othername">"Maddy"</span></h3></div></div></div></div></div><div class="abstract"><p class="title"><b>Abstract</b></p><p>Is there a need to fiddle with what apparently is perfectly working and is serving the need. Well for one the i have choosen a format, <acronym class="acronym">XML</acronym>, unlike the original manuscript which was written in word, 
                   in this case has the advantage of source being one  and output can be in various format. That is if the source is in <acronym class="acronym">XML</acronym>, it is easier now to convert into <acronym class="acronym">HTML, PDF, RTF</acronym> <abbr class="abbrev">etc.</abbr> Also to 
                   prove to the sceptics that DocBook is very much suitable for large production quality projects, not that this is the first effort, in this case an entire book has been marked up in <acronym class="acronym">XML</acronym>.
                 </p></div><p>Infact why <acronym class="acronym">XML</acronym> indeed? <acronym class="acronym">XML</acronym> -eXtensible Markup Language  has been able to do justice to a large extent to the hype. Maybe having a watch body like w3.org to monitor
                   has been advantageous; unlike HTML which lacked a formal monitoring, ability to extend, a weak structure and no support for validation,  <acronym class="acronym">XML</acronym> has all these and more. It is a system-independant, vendor-independant and
                   has behind it the proven experience of SGML implementation, XML being a subset of SGML. I concur with Tim Bray's reported comment that it is ridiculous to use an application like MS Word, Quark Express <abbr class="abbrev">etc.</abbr>for writing text which will be stored as a binary 
                   and proprietory format therby bloating it considerably. And unlike <acronym class="acronym">HTML</acronym> which has about <abbr class="abbrev">aprox.</abbr> 50-60 pre-cooked tags, with <acronym class="acronym">XML</acronym> one can make up one's own. Infact this facility of having one's own
                   tag will make it very, very useful in the long run. And the inherent factor that <acronym class="acronym">XML</acronym> is all about content and nothing to do with presentation will be its greatest strength for years to come. The presentation part is taken care of by
                   Stylesheet or FO or some such thing.                 
                 </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm94"></a>3. DocBook ! </h2></div></div></div><p>DocBook is a <acronym class="acronym">DTD</acronym> - Document Type Definition. now what is this? well 
                   say for example  having said <acronym class="acronym">XML</acronym> is in itself a rule set , suppose i use an 
                   markup element tag &lt;author&gt; in my document and another author uses &lt;writer&gt; element 
                   tag in his document, isn't it true we are trying to convey the same meaning .Imagine thousands of 
                   pages are being written for the web, for the publishing industry  and what a waste of enormous 
                   time if people would like to convey similar meaning but use different elements with the core 
                   language being same, this is where an <acronym class="acronym">DTD</acronym> comes into picture. 
                 </p><div class="blockquote"><table border="0" class="blockquote" style="width: 100%; cellspacing: 0; cellpadding: 0;" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><pre class="literallayout">
                       Docbook <acronym class="acronym">DTD</acronym> is a very popular set of tags for describing books, 
                       articles and other prose documents, particularly technical documentation. Docbook 
                       is defined using the native <acronym class="acronym">DTD</acronym> syntax of <acronym class="acronym">SGML</acronym> 
                       and <acronym class="acronym">XML.</acronym> Like <acronym class="acronym">HTML</acronym>, DocBook is an example of 
                       a markup language defined in <acronym class="acronym">SGML/XML.</acronym>
                     </pre></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution">-From the book <em class="citetitle"> DocBook -
                     The Definitive Guide </em>  by Norman Walsh and Leonard Muellner.</span></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm110"></a>4. DocBook/<acronym class="acronym">XML</acronym></h2></div></div></div><p>With the sole intent of making this book future proof, I have ported ( i am not sure this is the right term)
                   this entire book into DocBook/<acronym class="acronym">XML</acronym>.That the source being Markedup in <acronym class="acronym">XML</acronym>,
                   this ensures:
                   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
                         It will become platform independant and the source is not in any proprietory format like word.
                       </p></li><li class="listitem" style="list-style-type: disc"><p>
                         It will be easy to have different outputs like <acronym class="acronym">HTML, PDF, RTF</acronym> <abbr class="abbrev">etc.</abbr>
                         With the never version of browsers supporting Raw <acronym class="acronym">XML</acronym> as input with stylesheet 
                         being a seperate component, that this remains ready for that day when it becomes possible to have it converted on the fly.
                       </p></li><li class="listitem" style="list-style-type: disc"><p>
                         That in the eventuality of me not being involved in the project at a later date, with the 
                         advent of professionals, there will be enough warm bodies to do this job.   
                       </p></li></ul></div><p>
                 </p><p>My fond hope is that this should not turn out be just a futile excersize and it proves usefull to everybody;
                   atleast to some people even they are a small minority, the least of all to Gerhard Mourani, who is the author of 
                   this splendid book.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm127"></a>4.1. Bouquets Brickbats <abbr class="abbrev">Etc.</abbr></h3></div></div></div><p>
                       The idea behind this exercize primarily has been :
                       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                           To give back something to the Linux community which has been instrumental in 
                           spearheading the spirit of sharing.
                         </p></li><li class="listitem"><p>
                           To create awareness about possibilities existing with the available tools set.
                         </p></li></ul></div><p>
                     </p><p>
                       But in the process some mistakes might have creeped in but there can be no excuse. Since this book has been looked at twice over; but still, i think the mistakes are entirely mine,
                       if at all and not Gerhard's. So if you spot some glaring mistakes whether be it in the form of wrong or mis-information, typos or grammatical mistakes  please do inform me at 
                       <code class="email">&lt;<a class="email" href="mailto:needaguru@yahoo.com">needaguru@yahoo.com</a>&gt;</code> or you can even inform gerhard at <code class="email">&lt;<a class="email" href="mailto:gmourani@openna.com">gmourani@openna.com</a>&gt;</code>. I am sure he will give a wallop on my backside( it is quite fragile!) so that such mistakes don't happen next time.
                       Also welcome are the suggestions on how we could improve on this, so that next time round it will much be better.
                     </p><p>
                       Here is hoping that this proves useful despite those already mentioned, creeped in mistakes, errors <abbr class="abbrev">etc.</abbr> and it kindles in you the same spirit which has embodied the growth of Linux as a powerful environement to work in.
                       And if that happens i would consider myself highly obliged and this will prove to be a satisfying endevour for me personally. I have a feeling that the orginal author of this book Gerhard Mourani shares this thought of 
                       mine and probably agrees with me.
                     </p></div></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="idm141"></a>Part 1. Getting Started</h1></div></div></div><div class="partintro"><div></div><div class="mediaobject" align="center"><img src="./resources/Annimals/Chapter12.gif" align="middle" alt="Owl"></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="chapter"><a href="#ch1gnif">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#idm153">1. Audience</a></span></dt><dt><span class="section"><a href="#idm156">2. Organization of This Book</a></span></dt><dt><span class="section"><a href="#idm226">3. Pre-requisites</a></span></dt><dt><span class="section"><a href="#pr1ch2s4obefs">4. Obtaining the book and example configuration files</a></span></dt><dd><dl><dt><span class="section"><a href="#pr1ch2s4obefs1">4.1. Example Configuration files</a></span></dt></dl></dd><dt><span class="section"><a href="#idm283">5. Acknowledgements from Gerhard</a></span></dt><dd><dl><dt><span class="section"><a href="#pr1ch1ackn">5.1. Acknowledgements from "Maddy"</a></span></dt></dl></dd></dl></dd></dl></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="ch1gnif"></a>Chapter 1. Introduction</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm153">1. Audience</a></span></dt><dt><span class="section"><a href="#idm156">2. Organization of This Book</a></span></dt><dt><span class="section"><a href="#idm226">3. Pre-requisites</a></span></dt><dt><span class="section"><a href="#pr1ch2s4obefs">4. Obtaining the book and example configuration files</a></span></dt><dd><dl><dt><span class="section"><a href="#pr1ch2s4obefs1">4.1. Example Configuration files</a></span></dt></dl></dd><dt><span class="section"><a href="#idm283">5. Acknowledgements from Gerhard</a></span></dt><dd><dl><dt><span class="section"><a href="#pr1ch1ackn">5.1. Acknowledgements from "Maddy"</a></span></dt></dl></dd></dl></div><div class="abstract"><p class="title"><b>Abstract</b></p><p>
                     I realized that a lot of people wanted to see it published for its contents, to get 
                     advantages out of it and see the power of this beautiful Linux system in action. A lot of 
                     time and effort went into the making of this book, and to ensure that the results were as 
                     accurate as possible. If you find any abnormalities, inconsistent results, errors, omissions 
                     or anything else that doesn't look right, please let me know so I that can investigate the 
                     problem or correct the error. Suggestions for future versions are also welcome and appreciated.              
                   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm153"></a>1. Audience</h2></div></div></div><p>
                 This book is intended for a target audience of technical and system administrators who manage 
                 Linux servers, but it also includes enough material for home users and others. It discusses 
                 how to install and setup a Red Hat Linux Server with all the necessary security and 
                 optimization for a high performance Linux specific machine. Since we speak of optimization 
                 and security configuration, we have used only source distribution (tar.gz) programs; the most 
                 available type for critical server software, like Apache, BIND/DNS, Samba, Squid, OpenSSL etc. 
                 Source packages give us fast upgrades, security updates when necessary, and a better 
                 compilation, customization, and optimization option for our specific machines that often we 
                 can't have with RPM packages.
                 </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm156"></a>2. Organization of This Book</h2></div></div></div><p>
                     Depending of your level of knowledge in Linux, you can read this book from the start to finish
                     or each chapter which may be of interest to you. Each chapter and section of this book appears 
                     in a manner that let you read only the relevant parts of your interest without the need to schedule 
                     a couple of day's reading. 
                   </p><p>
                     Too many books available as of now take two pages to explain something that 
                     can be explained in two lines, I'm sure that many of you agree with my opinion. This book attempts a different 
                     path, in the sense, only the essential and important information that the readers are interested in knowing are
                     explained in detail thereby eliminating all the nonsense. Though the fact that you can read this book in any
                     order you want, there is a particular order that you could follow if something seem to be confusing
                     for you. The steps shown below is what I recommend to facilitate a smooth reading.
                   </p><p>
                     <a class="link" href="#ch1prt1" title="Chapter 2. Overview of OS Linux">Chapter 2</a> through <a class="link" href="#pr2ch4Pi" title="Chapter 4. Post-Install">Chapter 4</a>  will guide you to do these steps:
                     </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
                         Setup Linux in your computer
                       </p></li><li class="listitem"><p>
                       Remove all the unnecessary <acronym class="acronym">RPM</acronym> package(s) during setup
                       </p></li><li class="listitem"><p>
                       Install the necessary <acronym class="acronym">RPM</acronym> package(s) for compilation
                       </p></li></ol></div><p>
                   </p><p>
                     <a class="link" href="#prt2ch1gss" title="Chapter 5. General System Security">Chapter 5</a> through <a class="link" href="#pr3ch7lnke" title="Chapter 7. Configuring and Building a Secure, Optimized Kernel">Chapter 7</a> will guide you with these additional steps:
                     </p><div class="orderedlist"><ol class="orderedlist" start="4" type="i"><li class="listitem"><p>
                         Secure the system in general
                       </p></li><li class="listitem"><p>
                       Optimize the system in general
                       </p></li><li class="listitem"><p>
                       Install, recompile and customize the Kernel
                       </p></li></ol></div><p>
                   </p><p>
                     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                         <a class="link" href="#pr6ch24SoNE" title="Chapter 24. Software -Networking/Encryption">Chapter 24</a> will guide you through this:
                         </p><div class="orderedlist"><ol class="orderedlist" start="7" type="i"><li class="listitem"><p>
                             Install OpenSSL to be able to use encryption with the Linux server
                           </p></li></ol></div><p>
                       </p></li><li class="listitem"><p>
                         <a class="link" href="#prt6ch15ssh" title="Chapter 15. Software -Securities">Chapter 15</a> will guide you through this:
                         </p><div class="orderedlist"><ol class="orderedlist" start="8" type="i"><li class="listitem"><p>
                             Install OpenSSH to be able to make remote administration tasks
                           </p></li></ol></div><p>
                       </p></li><li class="listitem"><p>
                         <a class="link" href="#pr6ch21Sonet" title="Chapter 21. Software -Networking">Chapter 21</a> will guide you through this:
                         </p><div class="orderedlist"><ol class="orderedlist" start="9" type="i"><li class="listitem"><p>
                           Install BIND/DNS as client or server depending of your needs
                         </p></li></ol></div><p>
                       </p></li><li class="listitem"><p>
                         <a class="link" href="#pr6ch22SSMn" title="Chapter 22. Software -Server/Mail Network">Chapter 22</a> will guide you through this:
                         </p><div class="orderedlist"><ol class="orderedlist" start="10" type="i"><li class="listitem"><p>
                           Install Sendmail as client or server depending of your needs
                         </p></li></ol></div><p>
                       </p></li><li class="listitem"><p>
                         <a class="link" href="#pr4ch4nfl" title="Chapter 10. Networking -Firewall">Chapter 10</a> through <a class="link" href="#pr4ch12nfmf" title="Chapter 12. Networking Firewall -Masquerading and Forwarding">Chapter 12</a> will guide you through these steps:
                         </p><div class="orderedlist"><ol class="orderedlist" start="11" type="i"><li class="listitem"><p>
                           Install &amp; Configure the firewall script according to which services
                           are installed in your system
                         </p></li></ol></div><p>
                       </p></li><li class="listitem"><p>
                         <a class="link" href="#pr6ch17SSSI" title="Chapter 17. Software -Securities/System Integrity">Chapter 17</a> and <a class="link" href="#pr6ch4sc1ltp" title="Chapter 18. Linux Tripwire ASR 1.3.1">Chapter 18</a> should guide you through this step:
                         </p><div class="orderedlist"><ol class="orderedlist" start="12" type="i"><li class="listitem"><p>
                           Install Tripwire
                         </p></li></ol></div><p>
                       </p></li></ul></div><p>
                   </p><p>
                     Now for this step you will need to go through the book section wise to choose what you want.
                     </p><div class="orderedlist"><ol class="orderedlist" start="13" type="i"><li class="listitem"><p>
                       Install any software you need later.
                     </p></li></ol></div><p>
                   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm226"></a>3. Pre-requisites</h2></div></div></div><p>
                   These installation instructions assume that:
                   You have a CD-ROM drive on your computer and the Official Red Hat Linux CD-ROM.
                   Installations were tested on the Official Red Hat Linux version 6.1 and 6.2.
                   You should understand the hardware system on which the operating system will be 
                   installed. After examining the hardware, the rest of this document guides you, 
                   step-by-step, though the installation process.
                   </p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>About products mentioned in this book:</b></p></div></div></div><p>
                   Many products, mentioned in this book; some commercial, but most are not commercial, 
                   cost nothing and can be freely used or distributed. It is also important to say that 
                   I'm not affiliated with any of them and if I mention a tool, because it is useful. 
                   You will find that a lot of big companies in their daily use, use most of them.
                   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr1ch2s4obefs"></a>4. Obtaining the book and example configuration files</h2></div></div></div><p>Securing and Optimizing Linux: RedHat Edition is now also available to download 
                     around the most popular Linux web sites. Free formatted versions of this book can be 
                     found on the Internet via the following addresses listed below.
                     
                     From the original web site
                     </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                       <code class="systemitem">Open Network Architecture</code><a class="link" href="#sc24obecfrs1" title="Obtaining the book and example configuration files">www.openna.com</a>
                       </td></tr><tr><td>
                     <code class="systemitem">The Linux Documentation Project homepage:</code>
                     <a class="link" href="#sc24obecfrs1" title="Obtaining the book and example configuration files">www.linuxdoc.org</a>
                     </td></tr><tr><td>                       
                     <code class="systemitem">O'Reilly Network:</code>
                     <a class="link" href="#sc24obecfrs1" title="Obtaining the book and example configuration files">oreilly.linu.com/pub/d/25</a> 
                     </td></tr><tr><td>                       
                     <code class="systemitem">Linux Security portal</code>
                     <a class="link" href="#sc24obecfrs1" title="Obtaining the book and example configuration files">linuxsecurity.com/docs</a> 
                     </td></tr></table><p>
                     </p><p>On the other hand you like the nice feel of paper and would like to browse through 
                     the pages at your convenience, you will have to purchase it. 
                     </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                     <a class="link" href="#sc24obecfrs1" title="Obtaining the book and example configuration files">
                       By clicking here!
                     </a>
                     </td></tr></table><p>
                     </p><div class="mediaobject" align="center"><img src="./images/lcanim-1.gif" align="middle" alt="You can Buy here!"></div><p>
                      It also comes with an accompanying CD filled with some nice goodies and all the example configuration files.
                     </p><p>
                     Other related web sites may exist without my knowledge. If you host this book 
                     Securing and Optimizing Linux: RedHat Edition and want to be included in the 
                     list of the next release, please send me a message with your intentions.
                     If you receive this as part of a printed distribution or on a CD-ROM, please 
                     check out the Linux Documentation home page <a class="link" href="#sc24obecfrs1" title="Obtaining the book and example configuration files">www.linuxdoc.org/</a>
                     or the original website at <a class="link" href="#sc24obecfrs1" title="Obtaining the book and example configuration files">www.openna.com</a>  to see 
                     if there is a more recent version. This could potentially save you a lot of trouble. 
                     If you want to translate this book, please notify me so I can keep track of what 
                     languages I have been published in.
                     </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="pr1ch2s4obefs1"></a>4.1. Example Configuration files</h3></div></div></div><p>The example configuration files in this book are available 
                       electronically via http from this website <a class="link" href="#sc24obecfrs2">www.openna.com/books/floppy.tgz.</a> 
                       In either case, be it from CDROM or if you have downloaded from the website extract the files from the 
                       archive by typing:
                   </p><pre class="screen">    
                   [root@deep ]/tmp#<span class="command"><strong>tar</strong></span> xzpf floppy.tgz
                  </pre><p> 

                   this is assuming you have stored the <code class="filename">floppy.tgz</code> in a directory called 
                   <code class="filename">tmp/ .</code>
                     </p><p>
                       </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Errata</h3><p>
                         </p><div class="mediaobject"><img src="./images/Important.gif" alt="Important"></div><p>                   

                       As i was giving the final look over on this book, Gerhard Mourani has released an errata for all firewall scripts
                       and it is available here <a class="link" href="#prtinxfperrt1" title="Openna Errata">http://www.openna.com/books/errata.htm</a>
                       </p></div><p>
                     If you cannot get the examples directly over the Internet, please contact the author 
                     at these email addresses:
                     </p><table border="0" summary="Simple list" class="simplelist"><tr><td> 
                     <code class="email">&lt;<a class="email" href="mailto:gmourani@openna.com">gmourani@openna.com</a>&gt;</code>
                     </td></tr><tr><td> 
                     <code class="email">&lt;<a class="email" href="mailto:gmourani@netscape.net">gmourani@netscape.net</a>&gt;</code>
                     </td></tr></table><p> 
                     </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm283"></a>5. Acknowledgements from Gerhard</h2></div></div></div><p>I would like to thank Michel Méral who has drawn all the beautiful animal drawing in 
                         my book, Robert L. Ziegler for allowing me to include his Firewall software and all Linux 
                         users around the world for their comments and suggestions.
                       </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="pr1ch1ackn"></a>5.1. Acknowledgements from "Maddy"</h3></div></div></div><p>The book has been orginally written by Gerhard Mourani <a class="link" href="#rsrcofwbi1" title="Open Network Architecture">www.openna.com</a> but i would like to thank him for collaborating
                         with me in porting ( for the want of a better word).To say he was co-operative will be an under statement he was always there with a helping hand
                         to answer my innumerable queries etc.
                         Also i would like to thank the following people,but not in any particular order;</p><p>
                           Norman Walsh, <a class="link" href="#prtinxfp1acn" title="Docbook and Additional resources">http://nwalsh.com/~ndw/</a> for his phenominal and brilliant contribution to DocBook. To me at times looks like only one man contributing to its growth, popularity  and in the process as well making it a mature 
                           product. Add to that he is a wonderful human being. My many many thanks to him. 
                         </p><p>
                           Peter Graves, <a class="link" href="#prtinxfp1acn" title="Docbook and Additional resources">http://armedbear.org</a> for his Brilliant editor j, i do all my work using it and there are no words to describe it.
                           i am indebted to him. I doubt very much if i could have worked for long stretches without it.
                         </p><p>
                           Bryan Henderson, <a class="link" href="#prtinxfp1acn" title="Docbook and Additional resources">http://netpbm.sourceforge.net/</a> for his netpbm package and more than any thing for having the patience in dealing with my often persistent and idiotic queries. His software was mainly responsible for converting and manupilating
                           all the orginal images which were in some esoteric format. 
                         </p><p>
                           Additionally i would also like to thank the following for releasing the right software at the right time:
                           </p><div class="informaltable"><table class="informaltable" border="0"><colgroup><col></colgroup><tbody valign="middle"><tr><td valign="middle">
                                   James clark, <a class="link" href="#prtinxfp1acn" title="Docbook and Additional resources">http://www.jclark.com/</a> for his xt and xp 
                                 </td></tr><tr><td valign="middle">
                                   Michael Kay, <a class="link" href="#prtinxfp1acn" title="Docbook and Additional resources">http://users.iclway.co.uk/mhkay/saxon/</a> for Saxon
                                 </td></tr><tr><td valign="middle">
                                   To each and everyone at OASIS, <a class="link" href="#prtinxfp1acn" title="Docbook and Additional resources">http://www.oasis-open.org/docbook/</a>
                                 </td></tr><tr><td valign="middle">
                                   To each and everyone at Docbook.org, <a class="link" href="#prtinxfp1acn" title="Docbook and Additional resources">http://docbook.org/</a>
                                 </td></tr><tr><td valign="middle">
                                   To Sebestain Rahtz, <a class="link" href="#prtinxfp1acn" title="Docbook and Additional resources">http://users.ox.ac.uk/~rahtz/passivetex/</a> for his contribution to DocBook
                                 </td></tr><tr><td valign="middle">
                                 Mark Galassi for his brilliant Docbook Tutorial <a class="link" href="#prtinxfp1acn" title="Docbook and Additional resources">http://nis-www.lanl.gov/~rosalia/mydocs/</a> , My starting point!.
                                 </td></tr></tbody></table></div><p>
                           The list would probably go on endlessly, and may be require a book for acknowledgements  i guess.
                         </p></div></div></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="prt1bint"></a>Part 2. Installation</h1></div></div></div><div class="partintro"><div></div><div class="mediaobject" align="center"><img src="./resources/Annimals/Chapter7-8.gif" align="middle" alt="Turtle!"></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="chapter"><a href="#ch1prt1">2. Overview of OS Linux</a></span></dt><dd><dl><dt><span class="section"><a href="#idm334">1. What is Linux?</a></span></dt><dt><span class="section"><a href="#idm344">2.  A Few good reasons to use Linux</a></span></dt><dt><span class="section"><a href="#idm350">3. Fears, Uncertainity and Doubts</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr1ch2">3. Installation of your Linux Server</a></span></dt><dd><dl><dt><span class="section"><a href="#idm389">1. Know your Hardware!</a></span></dt><dt><span class="section"><a href="#prt2ch2sc2">2. Creating the Boot Disk and Booting</a></span></dt><dt><span class="section"><a href="#idm519">3. Installation Class and Method (Install Type)</a></span></dt><dt><span class="section"><a href="#idm536">4. Disk Setup- Disk Druid</a></span></dt><dt><span class="section"><a href="#idm635">5. Disk Druid</a></span></dt><dt><span class="section"><a href="#idm712">6. An example</a></span></dt><dt><span class="section"><a href="#pr1ch2sc7">7. Post-Partitioning</a></span></dt><dt><span class="section"><a href="#idm1033">8. 
               Components to Install- Package Group Selection
                 </a></span></dt><dt><span class="section"><a href="#idm1067">9. Select Individual Package - Part 'A'</a></span></dt><dt><span class="section"><a href="#idm1269">10. Select Individual Package -Part 'B'</a></span></dt><dt><span class="section"><a href="#idm1528">11. How to use RPM Commands</a></span></dt><dt><span class="section"><a href="#idm1567">12. Starting and stopping daemon services</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr2ch4Pi">4. Post-Install</a></span></dt><dd><dl><dt><span class="section"><a href="#ch3sc3.1-1">1. Software that must be uninstalled</a></span></dt><dt><span class="section"><a href="#idm1832">2. Use <acronym class="acronym">RPM</acronym> command to uninstall.</a></span></dt><dt><span class="section"><a href="#idm1904">3. Software that must be installed</a></span></dt><dt><span class="section"><a href="#idm2067">4. Check,Re-confirm</a></span></dt><dt><span class="section"><a href="#idm2617">5. Verify,Cross-check</a></span></dt><dt><span class="section"><a href="#idm3118">6. some colors for a change</a></span></dt><dt><span class="section"><a href="#prt2ch3sc7uls">7. Update of the latest software</a></span></dt></dl></dd></dl></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="ch1prt1"></a>Chapter 2. Overview of OS Linux</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm334">1. What is Linux?</a></span></dt><dt><span class="section"><a href="#idm344">2.  A Few good reasons to use Linux</a></span></dt><dt><span class="section"><a href="#idm350">3. Fears, Uncertainity and Doubts</a></span></dt></dl></div><div class="highlights"><p>
               This part of the book deals with all the basic knowledge required to properly install a 
               Linux OS, in our case a Redhat Linux on your system.
               </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Introduction to Linux</td></tr><tr><td> Steps to be taken prior to install</td></tr><tr><td>Steps to be taken post install </td></tr></table><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm334"></a>1. What is Linux?</h2></div></div></div><p>Linux is an <em class="firstterm">Operating System</em> that was first created at the
           University of Helsinki in Finland by a young student named Linus Torvalds. At
           this time the student was working on a UNIX system that was running on an
           expensive platform. Because of his low budget, and his need to work at home, he
           decided to create a copy of the UNIX system in order to run it on a less
           expensive platform, such as an IBM PC.  He began his work in 1991 when he
           released version 0.02 and worked steadily until 1994 when version 1.0 of the
           Linux Kernel was released. The current full-featured version at this time is
           2.2.X; released January 25, 1999, and development continues.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b><acronym class="acronym">GNU</acronym> <acronym class="acronym">GPL</acronym>  and Linux</b></p></div></div></div><p>
             The Linux operating system is developed under the <acronym class="acronym">GNU</acronym> General Public License (also known as GNU GPL) and its 
             source code is freely available to everyone who downloads it via the Internet. The CD-ROM version of Linux is 
             also available in many stores, and companies that provide it will charge you for the cost of the media and support. 
             Linux may be used for a wide variety of purposes including networking, software development, and as an end-user 
             platform. Linux is often considered an excellent, low-cost alternative to other more expensive operating systems 
             because you can install it on multiple computers without paying more.
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm344"></a>2.  A Few good reasons to use Linux</h2></div></div></div><p> There are no royalty or licensing fees for using Linux, and the source code can be modified 
           to fit your needs. The results can be sold for profit, but original authors retain copyright and 
           you must provide the source to your modifications.
           </p><p>
           Because it comes with source code to the kernel, it is quite portable. Linux runs on more CPUs and 
           platforms than any other computer operating system. The recent direction of the software and hardware 
           industry is to push consumers to purchase faster computers with more system memory and hard drive storage. 
           Linux systems are not affected by those industries orientation because of it capacity to run on any kind 
           of computers, even aging x486-based computers with limited amounts of RAM.
           </p><p>
           Linux is a true multi-tasking operating system similar to its brother UNIX. It uses sophisticated, state-of-the-art 
           memory management to control all system processes. That means that if a program crashes you can kill it and continue 
           working with confidence.
           </p><p>
           Another benefit is that Linux is practically immunized against all kinds of viruses that we find in other operating 
           systems. To date we have found only two viruses that were effective on Linux systems.
         
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm350"></a>3. Fears, Uncertainity and Doubts</h2></div></div></div><h3><a name="idm352"></a>Let's dispel some of the fear, uncertainty, and doubt about Linux:</h3><p><b> It's a toy operating system. </b>
            
             Fortune 500 companies, governments, and consumers; more and more use, Linux as a cost-effective computing 
             solution. It has been used and is still used by big companies like IBM, Amtrak, NASA, and others.
             </p><p><b> There's no support. </b>
           
             Every Linux distribution comes with more than 12,000 pages of documentation. Commercial Linux distributions such 
             as Red Hat Linux, Caldera, SuSE, and OpenLinux offer initial support for registered users, and small business 
             and corporate accounts can get 24/7 supports through a number of commercial support companies. As an Open Source 
             operating system, there's no six-months to wait for a service release, and the online Linux community fixes many 
             serious bugs within hours.
             </p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="pr1ch2"></a>Chapter 3. Installation of your Linux Server</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm389">1. Know your Hardware!</a></span></dt><dt><span class="section"><a href="#prt2ch2sc2">2. Creating the Boot Disk and Booting</a></span></dt><dt><span class="section"><a href="#idm519">3. Installation Class and Method (Install Type)</a></span></dt><dt><span class="section"><a href="#idm536">4. Disk Setup- Disk Druid</a></span></dt><dt><span class="section"><a href="#idm635">5. Disk Druid</a></span></dt><dt><span class="section"><a href="#idm712">6. An example</a></span></dt><dt><span class="section"><a href="#pr1ch2sc7">7. Post-Partitioning</a></span></dt><dt><span class="section"><a href="#idm1033">8. 
               Components to Install- Package Group Selection
                 </a></span></dt><dt><span class="section"><a href="#idm1067">9. Select Individual Package - Part 'A'</a></span></dt><dt><span class="section"><a href="#idm1269">10. Select Individual Package -Part 'B'</a></span></dt><dt><span class="section"><a href="#idm1528">11. How to use RPM Commands</a></span></dt><dt><span class="section"><a href="#idm1567">12. Starting and stopping daemon services</a></span></dt></dl></div><div class="highlights"><p>The next two chapters is structured  in a manner that follows the original installation of the Red Hat Linux <span class="hardware">CD-ROM.</span> 
              Each section below refers to, and will guide you through, different screens that will appear during the setup of your 
              system after the insertion of the Red Hat boot diskette in your computer.
              </p><p>
              We promise that it will be interesting to have the machine you want to install Linux on, ready and near to you when you follow the steps described below.
              From time to time Red Hat Linux updates its operating system to a new version and adds, changes or removes some packages 
              as well as changes some locations, content or features of files in its distribution. 
              </p><p>
              Red Hat Recently has updated their version of operating system to 6.2 called <em class="firstterm">Zoot</em>, which is a minor upgrade of 6.1, 
              so to be as accurate as possible about all information contained in these early chapters, we'll comment upon installation of version 6.1 as well as version 6.2 for those who will upgrade 
              or install to it. Any sections in this chapter that refer to version 6.1 will be for the Red Hat Linux 6.1 <em class="firstterm">(Cartman)</em> distribution, 
              and any section where we talk about version 6.2 will be for the Red Hat Linux 6.2 (Zoot) distribution, respectively.
            </p></div><p>
            The following conventions will simplify the interpretations in these chapter: 
            </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
            <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="All versions"></span> This icon applies to Red Hat Linux 
            version 6.1 and 6.2 respectively.
            </td></tr><tr><td>
          <span class="inlinemediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></span> This icon applies to Red Hat Linux version 6.1 only.
            </td></tr><tr><td>
            <span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></span> This icon applies to Red Hat Linux version 6.2 only.
              </td></tr></table><p>
              </p><p>
            We know that many organizations and companies handle different versions of this operating system, and run a number of services on 
            them. Sometimes it may be difficult to upgrade to the latest version since clients use services on the server 24 hours a day. With 
            this simple convention, people who maintain and use version 6.1 of Red Hat Linux will always find exact information related to their
            needs.
              </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm389"></a>1. Know your Hardware!</h2></div></div></div><p>
            Understanding the hardware of your computer is essential for a successful installation of Red Hat Linux. Therefore, you should take a 
            moment now and familiarize yourself with your computer hardware. Be prepared to answer the following questions:
             </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            How many hard drives do you have?
            </p></li><li class="listitem"><p>
            What size is each hard drive? <abbr class="abbrev">e.g.</abbr> <code class="literal">3.2GB</code>.
            </p></li><li class="listitem"><p>
            If you have more than one hard drive, which is the primary one?
            </p></li><li class="listitem"><p>
            What kind of hard drive do you have? <abbr class="abbrev">e.g.</abbr> <acronym class="acronym">IDE</acronym>, <acronym class="acronym">SCSI</acronym>.
            </p></li><li class="listitem"><p>
            How much <acronym class="acronym">RAM</acronym> do you have <abbr class="abbrev">e.g.</abbr> 256MB <acronym class="acronym">RAM</acronym>.
            </p></li><li class="listitem"><p>
            Do you have a <acronym class="acronym">SCSI</acronym> adapter? If so, who is the manufacturer and what model is it?
            </p></li><li class="listitem"><p>
            Do you have a <acronym class="acronym">RAID</acronym> system? If so, who is the manufacturer and what model is it?
            </p></li><li class="listitem"><p>
            What type of mouse do you have <abbr class="abbrev">e.g.</abbr> <code class="literal">PS/2</code>, Microsoft, Logitech.
            </p></li><li class="listitem"><p>
            How many buttons does your mouse have? <code class="literal">2/3</code> buttons.
            </p></li><li class="listitem"><p>
            If you have a serial mouse, what <acronym class="acronym">COM</acronym> port is it connected to? <abbr class="abbrev">e.g.</abbr> <code class="literal">COM1.</code>
            </p></li><li class="listitem"><p>
            What is the make and model of your video card? How much video <acronym class="acronym">RAM</acronym> do you have? <abbr class="abbrev">e.g.</abbr> 4MB.
            </p></li><li class="listitem"><p>
            What kind of monitor do you have? <span class="emphasis"><em>Make and Model</em></span>.
            </p></li><li class="listitem"><p>
            Will you be connected to a network? If so, what will be the following:
            </p></li><li class="listitem" style="list-style-type: none"><p>
            </p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>            
            Your <acronym class="acronym">IP</acronym> address?
            </p></li><li class="listitem"><p>
            Your netmask?
            </p></li><li class="listitem"><p>
            Your gateway address?
            </p></li><li class="listitem"><p>
            Your domain name server's <acronym class="acronym">IP</acronym> address?
            </p></li><li class="listitem"><p>
            Your domain name?
            </p></li><li class="listitem"><p>
            Your hostname?
            </p></li><li class="listitem"><p>
            Your types of network(s) card(s)? <span class="emphasis"><em>Make and Model</em></span>.
            </p></li><li class="listitem"><p>
            Your number of card(s)? <span class="emphasis"><em>Make and Model</em></span>.
            </p></li></ol></div><p>
            </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prt2ch2sc2"></a>2. Creating the Boot Disk and Booting</h2></div></div></div><p>
              </p><div class="informalfigure"><div class="mediaobject"><img src="images/VersionAll.gif"></div></div><p>
              The first thing to do is to create an installation diskette also known as a boot disk. If you have purchased the 
              official Red Hat Linux <span class="hardware">CD-ROM</span>, you will find this floppy disk named Boot Diskette in the Red Hat Linux box and 
              you don't need to create it. From time to time, you may find that the installation will fail with the standard diskette 
              image that comes with the official Red Hat Linux CD-ROM. If this happens, a revised diskette is required in order for 
              the installation to work properly. In these cases, special images are available via the Red Hat Linux Errata web 
              page to solve the problem <a class="link" href="#prtinxfp4" title="Creating the Boot Disk and Booting">www.redhat.com/errata</a>. Since this, is a 
              relatively rare occurrence, you will save time if you try to use the standard diskette images first, and then review 
              the Errata only if you experience any problem completing the installation.
              </p><p><b>Step 1. </b>
             Before you make the boot disk, insert the Official <span class="productname">Red Hat Linux</span>&#8482; <span class="hardware">CD-ROM</span> 
             Part 1 in your computer that runs the <span class="productname">Windows</span>© operating system. When the program asks for the filename, 
             enter <code class="filename">boot.img</code> for the boot disk. To make the floppies under <span class="productname">MS-DOS</span>©, you need to use these 
             commands assuming your <span class="hardware">CD-ROM</span> is drive <code class="prompt">D:</code> and contain the Official <span class="productname">Red Hat Linux</span>© 
             <span class="hardware">CD-ROM</span>.
             </p><p>Open the Command Prompt under Windows: <span class="command"><strong><span class="guimenu">Start</span></strong></span> | <span class="command"><strong><span class="guimenuitem">Programs</span></strong></span> | <span class="command"><strong><span class="guimenuitem">Command Prompt</span></strong></span></p><pre class="literallayout"><code class="computeroutput">
             C:\&gt; d:
             D:\&gt; cd \dosutils
             D:\dosutils&gt; rawrite
             Enter disk image source file name: ..\images\boot.img
             Enter target diskette drive: a:
             Please insert a formatted diskette into drive A: and press --ENTER-- :

             D:\dosutils&gt;             
             </code></pre><p>
               The <span class="application">rawrite.exe</span> program asks for the filename of the disk image: Enter <code class="filename">boot.img</code> and insert a <span class="hardware">floppy</span> 
               into drive A. It will then ask for a disk to write to: Enter <strong class="userinput"><code>a:</code></strong>, and when complete, label the disk; for example, Red Hat boot disk.
             </p><p><b>Step 2. </b>
             Since we'd start the installation directly off the <span class="hardware">CD-ROM</span>, boot with the boot disk. Insert the boot diskette you create into the drive A: on the computer where you want to 
             install Linux and reboot the computer. At the <code class="prompt">boot:</code>, press <span class="command"><strong>Enter</strong></span> to continue booting and follow the three simple steps below:
             </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>Choose your language</strong></span></span></dt><dd><p>You can choose your prefferd language for the Linux OS from a list. For example, English, Danish etc
               </p></dd><dt><span class="term"><span class="command"><strong>Choose your keyboard type</strong></span></span></dt><dd><p>You can choose your Keyboard type. For example <code class="literal">US pc104</code>, norwegian etc
               </p></dd><dt><span class="term"><span class="command"><strong>Select your mouse type</strong></span></span></dt><dd><p>You can choose your mouse type. For example Logitech two button, Microsoft three button mouse etc

               </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm519"></a>3. Installation Class and Method (Install Type)</h2></div></div></div><p>
              Red Hat Linux 6.1 and 6.2 include four different classes, or type of installation. They are:
              </p><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="command"><strong>
              GNOME Workstation
              </strong></span>
              </td></tr><tr><td><span class="command"><strong>
              KDE Workstation
              </strong></span>
              </td></tr><tr><td><span class="command"><strong>
              Server
              </strong></span>
              </td></tr><tr><td><span class="command"><strong>
              Custom
              </strong></span>
              </td></tr></table><p>
              </p><p>
              The first three classes <span class="command"><strong>GNOME Workstation, KDE Workstation, and Server</strong></span> give you the option of simplifying 
              the installation process with a significant loss of configuration flexibility that we don't want to lose. For this 
              reason we highly recommend <span class="command"><strong>Custom</strong></span> installation, as this allows you to choose what services are added and how the system is 
              partitioned.The idea is to load the minimum number of packages, while maintaining maximum efficiency. The less software that resides 
              on the box, the fewer potential security exploits or holes may appear.Select <span class="command"><strong>Custom</strong></span> and click <span class="command"><strong>Next</strong></span>
              </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm536"></a>4. Disk Setup- Disk Druid</h2></div></div></div><p>
                </p><div class="mediaobject"><img src="images/VersionAll.gif" alt="Versian All"></div><p> We 
                assume that you are installing your new Linux server to a new hard drive, with no other existing file system or operating system previously 
                installed. A good partition strategy is to create a separate partition for each major file system. This enhances security and prevents accidental 
                denial of service or exploit of <acronym class="acronym">SUID</acronym> programs.
                </p><p>Creating multiple partitions offers you the following advantages:
                  </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                  Protection against denial of service attack.
                  </td></tr><tr><td>
                  Protection against <acronym class="acronym">SUID</acronym> programs.
                  </td></tr><tr><td>
                  Faster booting.
                  </td></tr><tr><td>
                  Easy backup and upgrade management.
                  </td></tr><tr><td>
                  Ability for better control of mounted file system.
                  </td></tr><tr><td>
                  Limit each file system's ability to grow.
                  </td></tr></table><p>
                </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Warning.gif" alt="Warning"></span>
</h3><p>
                    If previous file system or operating system exist on the hard drive and computer where you 
                    want to install your Linux system, we highly recommend, that you make a backup of your current 
                    system before proceeding with the disk partitioning.
                  </p></div><p><b>Step 1. </b>
                  For performance, stability and security reasons you must create something like the following partitions 
                  listed below on your computer. We suppose for this partition configuration the fact that you have a <acronym class="acronym">SCSI</acronym> 
                  hard drive of 3.2 GB. Of course you will need to adjust partition sizes according to your own needs and 
                  disk size.
                  Partitions that must be created on your system:
                 
                   

                      </p><pre class="programlisting">

                      /boot	   5MB		<a name="boot"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
                      /usr	 512MB		<a name="usr"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
                      /home	1146MB		<a name="home"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
                      /chroot	 256MB		<a name="chroot"></a><span><img src="images/callouts/4.png" alt="4" border="0"></span>
                      /cache	 256MB		<a name="cache"></a><span><img src="images/callouts/5.png" alt="5" border="0"></span>
                      /var	 256MB		<a name="var"></a><span><img src="images/callouts/6.png" alt="6" border="0"></span>
                   &lt;Swap&gt;	 128MB		<a name="swap"></a><span><img src="images/callouts/7.png" alt="7" border="0"></span>
                      /tmp	 256MB		<a name="tmp"></a><span><img src="images/callouts/8.png" alt="8" border="0"></span>
                      /		 256MB		<a name="root"></a><span><img src="images/callouts/9.png" alt="9" border="0"></span>
                      </pre><p>                    
                    </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#boot"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>All Kernel images are kept here.
                        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#usr"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>Must be large, since all Linux binaries programs are installed here.
                        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#home"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>Proportional to the number of users you intend to host <abbr class="abbrev">i.e.</abbr> 10MB per users 
                          multiplied by the number of users 114 = 1140MB.
                        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#chroot"><span><img src="images/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>If you want to install programs in chroot jail environment <abbr class="abbrev">i.e.</abbr> DNS.
                        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#cache"><span><img src="images/callouts/5.png" alt="5" border="0"></span></a> </p></td><td valign="top" align="left"><p>This is the cache partition of a proxy server <abbr class="abbrev">i.e.</abbr> Squid.
                        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#var"><span><img src="images/callouts/6.png" alt="6" border="0"></span></a> </p></td><td valign="top" align="left"><p>Contains files that change when the system run normally <abbr class="abbrev">i.e.</abbr> Log files.
                        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#var"><span><img src="images/callouts/6.png" alt="6" border="0"></span></a> </p></td><td valign="top" align="left"><p>Our swap partition. The virtual memory of the Linux operating system.
                        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#tmp"><span><img src="images/callouts/8.png" alt="8" border="0"></span></a> </p></td><td valign="top" align="left"><p>Our temporary files partition.
                        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#root"><span><img src="images/callouts/9.png" alt="9" border="0"></span></a> </p></td><td valign="top" align="left"><p>Our root partition.
                        </p></td></tr></table></div><p>

                    </p><p>
               We have made two more special partitions:
               </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">/chroot</code> </span></dt><dd><p>
               The <code class="filename">/chroot</code> partition can be used for DNS server chrooted, Apache server chrooted and other chrooted future programs. 
               </p></dd><dt><span class="term"><code class="filename">/cache</code></span></dt><dd><p>
               The <code class="filename">/cache</code> partition can be used for a Squid Proxy server. 
               </p></dd></dl></div><p>
               If you are not intending to install Squid Proxy server you don't need to create the <code class="filename">/cache</code> partition.
               </p><p>
               Keeping <code class="filename">/tmp</code> and <code class="filename">/home</code> on separate partitions is pretty much mandatory if users have shell access 
               to the server- protection against <code class="envar">SUID</code> programs; splitting these off into separate partitions also 
               prevent users from filling up any critical file system -denial of service attack.
               The same applies to  <code class="filename">/var</code>, and <code class="filename">/usr</code> on separate partitions is also a very good idea. By isolating the <code class="filename">/var</code> partition, you protect 
               your root partition from overfilling -denial of service attack.

               </p><p>
               In our partition configuration we'll reserve 256 MB of disk space for chrooted programs like Apache, 
               DNS and other software. This is necessary because Apache <code class="filename">DocumentRoot</code> files and other binaries, programs 
               related to Apache will be installed in this partition if you decide to run Apache web server in a chrooted 
               jail. 
               </p><p>
               Take note that the size of the Apache chrooted directory on the chrooted partition is proportional 
               to the size of your <code class="filename">DocumentRoot</code> files. If you're not intending to install and use Apache on your server, 
               you can reduce the size of this partition to something like 10 MB for <acronym class="acronym">DNS</acronym> server that you always need in 
               a chrooted jail environment for security reasons.
               </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
              Minimum size of partitions
              </h3><div class="mediaobject"><img src="./images/Note.gif" alt="Note"></div><p>
              For information purposes only, this is the minimum size in megabytes, which a Linux installation must have to function properly. The sizes of partitions 
              listed below are really small. This configuration can fit into a very old hard disk of 512MB in size that you might find in old x486 computers. We show 
              you this partition just to get an idea of the minimum requirements.
              </p><pre class="screen">

              /	         35MB
              /boot	  5MB
              /chroot	 10MB
              /home	100MB
              /tmp	 30MB
              /usr	232MB
              /var	 25MB
              </pre><p>
              </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm635"></a>5. Disk Druid</h2></div></div></div><p>
               Disk Druid Partitions is a program that partitions your hard drive for you. Choose <span class="command"><strong>Add</strong></span> to add a new partition, <span class="command"><strong><span class="guimenu">Edit</span></strong></span> to edit 
               a partition, <span class="command"><strong><span class="guimenu">Delete</span></strong></span> to delete a partition and <span class="command"><strong><span class="guimenu">Reset</span></strong></span> to reset the partitions to the original state. When you add a new 
               partition, a new window appears on your screen and gives you parameters to choose. Different parameters are:
             
             </p><div class="glosslist"><dl><dt><span class="glossterm"><span class="command"><strong>
                 <span class="guimenuitem">Mount Point:</span></strong></span></span></dt><dd class="glossdef"><p>
                   for where you want to mount your new partition in the filesystem.
                   </p></dd><dt><span class="glossterm">
                   <span class="command"><strong><span class="guimenuitem">Size (Megs):</span></strong></span></span></dt><dd class="glossdef"><p>
                   for the size of your new partition in megabytes.
             </p></dd><dt><span class="glossterm">
             <span class="command"><strong><span class="guimenuitem">Partition Type:</span></strong></span>
             </span></dt><dd class="glossdef"><p>
             Linux native for Linux filesystem and Swap for Linux Swap Partition.
  
             </p></dd></dl></div><p>
             </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a name="ch2scp1"></a>
               <span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span>
</h3><p>
             If you have a <acronym class="acronym">SCSI</acronym> disk the device name will be <code class="filename">/dev/sda</code> 
             and if you have an <acronym class="acronym">IDE</acronym> disk it will be <code class="filename">/dev/hda</code>. If you're looking 
             for high performance and stability, a <acronym class="acronym">SCSI</acronym> disk is highly recommended.
             Linux refers to disk partitions using a combination of letters and numbers. It uses a naming scheme that 
             is more flexible and conveys more information than the approach used by other operating systems. 
             </p><p>
             Here is a summary:
             </p><div class="variablelist"><p class="title"><b>Disk naming convention</b></p><dl class="variablelist"><dt><span class="term">First Two Letters</span></dt><dd><p>
              The first two letters of the partition name indicate the type of device on which the 
             partition resides. You'll normally see either <code class="filename">hd</code> (for <acronym class="acronym"><acronym class="acronym">IDE</acronym></acronym> 
             disks), or <code class="filename">sd</code> (for <acronym class="acronym"><acronym class="acronym">SCSI</acronym></acronym> disks).
             </p></dd><dt><span class="term">The Next Letter</span></dt><dd><p>
              This letter indicates which device the partition is on. For example: <code class="filename">/dev/hda</code> 
             (the first <acronym class="acronym">IDE</acronym> hard disk) and <code class="filename">/dev/hdb</code> (the second 
             <acronym class="acronym"><acronym class="acronym">IDE</acronym></acronym> disk).
             </p></dd></dl></div><p>
             Keep this information in mind, it will make things easier to understand when you're setting up the partitions 
             Linux requires.
                </p><p>
             
             Swap partitions are used to support virtual memory. If your computer has 16 MB of <acronym class="acronym">RAM</acronym> or less, you must create 
             a swap partition. Even if you have more memory, a swap partition is still recommended. The minimum size of your 
             swap partition should be equal to your computer's <acronym class="acronym">RAM</acronym> or 16 MB (whichever is larger). The 
             largest useable swap partition is roughly 1 GB, <span class="emphasis"><em>since 2.2 kernel, 1 GB swap file are supported</em></span> so making a 
             swap partition larger than that will result in wasted space. Note, however, that you can create and use more than 
             one swap partition <span class="emphasis"><em>although this is usually only necessary for very large server installations</em></span>.
             </p><p><a name="pr1ch25lk1"></a>
             Try to put your swap partitions near the beginning of your drive. The beginning of the drive is physically 
             located on the outer portion of the cylinder, so the read/write head can cover much more ground per revolution.
             </p><div class="mediaobject"><img src="images/Linux-Partitions.gif" alt="Linux Partitions"><div class="caption"><p>representation of linux partition</p></div></div><p>
             </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm712"></a>6. An example</h2></div></div></div><p>
             To make the partitions listed below on your system; this is the partition we'll need for our server installation example; 
             the command will be under <span class="application"> Disk Druid:</span>
             </p><p>
               </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
             <span class="command"><strong><span class="guimenuitem">Add</span></strong></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Mount Point:</span></strong></span> <strong class="userinput"><code>/boot</code></strong> <span class="emphasis"><em>our /boot directory.</em></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Size (Megs):</span></strong></span> <strong class="userinput"><code>5</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Partition Type:</span></strong></span> <strong class="userinput"><code>Linux Native</code></strong>
             </td></tr><tr><td>
             <strong class="userinput"><code><span class="guimenuitem">Ok</span></code></strong>
              </td></tr></table><p>
             </p><p>
             </p><table border="0" summary="Simple list" class="simplelist"><tr><td> 
              <span class="command"><strong><span class="guimenuitem">Add</span></strong></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Mount Point:</span></strong></span> <strong class="userinput"><code>/usr</code></strong>  <span class="emphasis"><em>our /usr directory.</em></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Size (Megs):</span></strong></span> <strong class="userinput"><code>512</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Partition Type:</span></strong></span> <strong class="userinput"><code>Linux Native</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Ok</span></strong></span> 
             </td></tr></table><p>
             </p><p>
             </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
              <span class="command"><strong><span class="guimenuitem">Add</span></strong></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Mount Point:</span></strong></span> <strong class="userinput"><code>/home</code></strong>   <span class="emphasis"><em>our /home directory.</em></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Size (Megs):</span></strong></span> <strong class="userinput"><code>1146</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Partition Type:</span></strong></span> <strong class="userinput"><code>Linux Native</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Ok</span></strong></span> 
             </td></tr></table><p>
             </p><p>
               </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
              <span class="command"><strong><span class="guimenuitem">Add</span></strong></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Mount Point:</span></strong></span> <strong class="userinput"><code>/chroot</code></strong>   <span class="emphasis"><em>our /chroot directory.</em></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Size (Megs):</span></strong></span> <strong class="userinput"><code>256</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Partition Type:</span></strong></span> <strong class="userinput"><code>Linux Native</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Ok</span></strong></span> 
             </td></tr></table><p>
             </p><p>
             </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
              <span class="command"><strong><span class="guimenuitem">Add</span></strong></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Mount Point:</span></strong></span> <strong class="userinput"><code>/cache</code></strong>   <span class="emphasis"><em>our /cache directory.</em></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Size (Megs):</span></strong></span> <strong class="userinput"><code>256</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Partition Type:</span></strong></span> <strong class="userinput"><code>Linux Native</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Ok</span></strong></span> 
             </td></tr></table><p>
             </p><p>
             </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
              <span class="command"><strong><span class="guimenuitem">Add</span></strong></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Mount Point:</span></strong></span> <strong class="userinput"><code>/var</code></strong>   <span class="emphasis"><em>our /var directory.</em></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Size (Megs):</span></strong></span> <strong class="userinput"><code>256</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Partition Type:</span></strong></span> <strong class="userinput"><code>Linux Native</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Ok</span></strong></span> 
             </td></tr></table><p>
             </p><p>
             </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
              <span class="command"><strong><span class="guimenuitem">Add</span></strong></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Mount Point:</span></strong></span>  our <strong class="userinput"><code>/Swap</code></strong> partition  <span class="emphasis"><em>leave the Mount Point Blank.</em></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Size (Megs):</span></strong></span> <strong class="userinput"><code>128</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Partition Type:</span></strong></span> <strong class="userinput"><code>Linux Swap</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Ok</span></strong></span> </td></tr></table><p>
             </p><p>
             </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
              <span class="command"><strong><span class="guimenuitem">Add</span></strong></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Mount Point:</span></strong></span> <strong class="userinput"><code>/tmp</code></strong>   <span class="emphasis"><em>our /tmp directory.</em></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Size (Megs):</span></strong></span> <strong class="userinput"><code>256</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Partition Type:</span></strong></span> <strong class="userinput"><code>Linux Native</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Ok</span></strong></span> 
             </td></tr></table><p>
             </p><p>
             </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
              <span class="command"><strong><span class="guimenuitem">Add</span></strong></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Mount Point:</span></strong></span> <strong class="userinput"><code>/</code></strong>   <span class="emphasis"><em>our / directory. </em></span>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Size (Megs):</span></strong></span> <strong class="userinput"><code>256</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Partition Type:</span></strong></span> <strong class="userinput"><code>Linux Native</code></strong>
             </td></tr><tr><td>
             <span class="command"><strong><span class="guimenuitem">Ok</span></strong></span> 
             </td></tr></table><p>
             </p><p>
             After the partitions of your hard disk has been completed, you must see something like the following information on 
             your screen. Our mount points will look like this:
             </p><p>
             </p><div class="table"><a name="idm907"></a><p class="title"><b>Table 3.1. Sample representaion of partitions</b></p><div class="table-contents"><table class="table" summary="Sample representaion of partitions" width="100%" border="0"><colgroup><col width="1in" align="left"><col width="1in" align="left"><col width="1in" align="left"><col width="1in" align="left"><col width="1in" align="left"></colgroup><thead><tr><th align="left">Mount Point</th><th align="left">Device</th><th align="left">Requested</th><th align="left"> Actual</th><th align="left"> Type</th></tr></thead><tbody><tr><td align="left">/boot</td><td align="left">sda1</td><td align="left">5M</td><td align="left">5M</td><td align="left"> Linux Native</td></tr><tr><td align="left">/usr</td><td align="left">sda5</td><td align="left">512M</td><td align="left">1146M</td><td align="left">Linux Native</td></tr><tr><td align="left">/home</td><td align="left">sda6</td><td align="left">256M</td><td align="left">256M</td><td align="left">Linux Native</td></tr><tr><td align="left">/chroot</td><td align="left">sda7</td><td align="left">256M</td><td align="left">256M</td><td align="left">Linux Native</td></tr><tr><td align="left">/cache</td><td align="left">sda8</td><td align="left">256M</td><td align="left">256M</td><td align="left">Linux Native</td></tr><tr><td align="left">/var</td><td align="left">sda9</td><td align="left">256M</td><td align="left">256M</td><td align="left">Linux Native</td></tr><tr><td align="left">&lt;Swap&gt;</td><td align="left">sda10</td><td align="left">128M</td><td align="left">128M</td><td align="left">Linux Swap</td></tr><tr><td align="left">/tmp</td><td align="left">sda11</td><td align="left">256M</td><td align="left">256M</td><td align="left">Linux Native</td></tr><tr><td align="left">/</td><td align="left">sda12</td><td align="left">256M</td><td align="left">256M</td><td align="left">Linux Native</td></tr></tbody></table></div></div><p><br class="table-break">
           </p><p>
             </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th align="left">
               Drive</th><th align="left">Geom [C/H/S]</th><th align="left">Total (M)</th><th align="left">Free (M)</th><th align="left">Used (M)</th><th align="left">Used (%)</th></tr></thead><tbody><tr><td align="left">sda</td><td align="left">[3079/64/32]</td><td align="left">3079M</td><td align="left">1M</td><td align="left">3078M</td><td align="left">99%</td></tr></tbody></table></div><p>
           </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span>
</h3><p> We are using a <acronym class="acronym">SCSI</acronym> hard disk hence the first two letters of the 
             device are <code class="filename">sd</code>.
             </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr1ch2sc7"></a>7. Post-Partitioning</h2></div></div></div><p>
               Now that you are partitioning and choosing the mount point of your directories, select <span class="command"><strong>Next</strong></span> to continue. After 
               your partitions are created, the installation program will ask you to choose partitions to format. Choose the partitions you want 
               to initialize, check the (Check for bad blocks during format) box, and press <span class="command"><strong>Next</strong></span>. This formats the partitions 
               and makes them active so Linux can use them.
              </p><p>                
               On the next screen you will see the LILO Configuration where you have the choice to install LILO boot record on:
               </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
               <span class="command"><strong><span class="guimenuitem">Master Boot Record (MBR)</span></strong></span>
               </td></tr></table><p>
                Or
                </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
               <span class="command"><strong><span class="guimenuitem">First Sector of Boot Partition</span></strong></span>
               </td></tr></table><p>
               </p><p>
               Usually if Linux is the only OS on your machine you should choose the <span class="command"><strong><span class="guimenuitem">Master Boot Record (MBR)</span></strong></span> option. After that, 
               you need to configure your Network and Clock. After you finish configuring the clock, you need to give your system a root password and 
               authentication configuration.

               For Authentication Configuration don't forget to select:
               </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
               <span class="command"><strong><span class="guimenuitem">Enable MD5 passwords</span></strong></span>
               </td></tr><tr><td>
               <span class="command"><strong><span class="guimenuitem">Enable Shadow passwords</span></strong></span> 
               </td></tr></table><p>

               <span class="command"><strong><span class="guimenuitem">Enable NIS</span></strong></span>  doesn't need to be selected since we are not configuring <acronym class="acronym">NIS</acronym> services on this server.
               </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm1033"></a>8. 
               Components to Install- Package Group Selection
                 </h2></div></div></div><p>
                 After your partitions have been configured and selected for formatting, you are ready to select packages for installation. By 
                 default, Linux is a powerful operating system that executes many useful services. However, many of these services are unneeded 
                 and pose potential security risks.
                </p><p>
                 Ideally, each network service should be on a dedicated, single-purpose host. Many Linux operating systems are configured by default 
                 to provide a wider set of services and applications than are required to provide a particular network service, so you may need to configure 
                 the server to eliminate unneeded services. Offering only essential services on a particular host can enhance your network security in 
                 several ways:
                 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>

                 Other services cannot be used to attack the host and impair or remove desired network services.
                </p></li><li class="listitem" style="list-style-type: disc"><p>
                 Different individuals may administer different services. By isolating services so each host and service has a single administrator you will 
                 minimize the possibility of conflicts between administrators.
                </p></li><li class="listitem" style="list-style-type: disc"><p>
                 The host can be configured to better suit the requirements of the particular service. Different services might require different hardware and 
                 software configurations, which could lead to needless vulnerabilities or service restrictions.
                 </p></li></ul></div><p>
                 By reducing services, the number of logs and log entries is reduced so detecting unexpected behavior becomes easier.
                 </p><p>
                 A proper installation of your Linux server is the first step to a stable, secure system. You first have to choose which system components you 
                 want to install. Choose the components, and then you can go through and select or deselect each individual package of each component by 
                 selecting <strong class="userinput"><code>Select individual packages</code></strong> option on your Red Hat setup screen.
                 Since we are configuring a Linux Server, we don't need to install a graphical interface <code class="literal">XFree86</code> on our system, <span class="emphasis"><em>a graphical interface on a server 
                 means less processes, less <acronym class="acronym">CPU</acronym> availability, less memory, security risks, and so on</em></span>. Graphical interfaces are usually used on workstations only.
                 </p><p>

                 Select the following packages for installation:
                 </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                 <strong class="userinput"><code>Networked Workstation</code></strong>
                 </td></tr><tr><td>
                 <strong class="userinput"><code>Network Management Workstation</code></strong>
                 </td></tr><tr><td>
                 <strong class="userinput"><code>Utilities</code></strong>
                 </td></tr></table><p>
                 </p><p>
                 After selecting the components you wish to install, you may select or deselect packages.
                 </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>                   
</h3><p>
                 Select the <span class="command"><strong>Select individual packages</strong></span> options before continuing to have the option to select 
                 and deselect packages.
                 </p></div><p>
                 </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm1067"></a>9. Select Individual Package - Part 'A'</h2></div></div></div><p>The installation program presents a list of the package groups available. Select a group to examine.
                 The components listed below must be deselected from the Menu Group for security; optimization and other reasons 
                 described below:
                 </p><p><b>

                
                                        <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="All versions"></span> Applications/File: </b>
                 </p><div class="glosslist"><dl><dt><span class="glossterm">git</span></dt><dd class="glossdef"><p>
                 The GIT package provides an extensible file system browser, an ASCII/hexadecimal file viewer, a process viewer/killer 
                 and other related utilities and shell scripts. <span class="emphasis"><em>Unnecessary.</em></span>
                 </p></dd></dl></div><p>
                 </p><p><b>

      
                   <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="All versions"></span> Applications/Internet: </b>
                 </p><div class="glosslist"><dl><dt><span class="glossterm">finger</span></dt><dd class="glossdef"><p>
                 The finger package is a client utility, which allows users to see information about system users. <span class="emphasis"><em>Security risks.</em></span>
                 </p></dd><dt><span class="glossterm">ftp</span></dt><dd class="glossdef"><p>
                 The ftp package provides the standard UNIX command-line FTP client. <span class="emphasis"><em>Security risks.</em></span>
                 </p></dd><dt><span class="glossterm">fwhois</span></dt><dd class="glossdef"><p>
                 The fwhois client program allows for querying whois databases. <span class="emphasis"><em>Security risks.</em></span>
                </p></dd><dt><span class="glossterm">ncftp</span></dt><dd class="glossdef"><p>
                 The Ncftp package is an improved FTP client. [Security risks, <span class="emphasis"><em>Unnecessary.</em></span>
                 </p></dd><dt><span class="glossterm">rsh</span></dt><dd class="glossdef"><p>                   
                 The rsh package provides client programs, which allows users to run commands on remote machines, login 
                 to other machines and copy files between machines (rsh, rlogin and rcp). <span class="emphasis"><em>Security risks.</em></span>
                   </p></dd><dt><span class="glossterm">rsync</span></dt><dd class="glossdef"><p>
                  rsync is very powerfull mirroring program, which brings very quickly remote and host files into sync.  <span class="emphasis"><em>Unnecessary</em></span>
                 </p></dd><dt><span class="glossterm">talk</span></dt><dd class="glossdef"><p>
                 The ntalk package provides client and daemon programs for the Internet talk protocol, which allows you 
                 to chat with other users on different UNIX systems. <span class="emphasis"><em>Security risks.</em></span>
                 </p></dd><dt><span class="glossterm">telnet</span></dt><dd class="glossdef"><p>
                 Telnet is a popular protocol for logging into remote systems over the network but it is insecure (transfer password 
                 in plain text). <span class="emphasis"><em>Security risks.</em></span>
                 </p></dd></dl></div><p>
                 </p><p><b>

                 
                                    <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="All versions"></span> Applications/Publishing: </b>
                 </p><div class="glosslist"><dl><dt><span class="glossterm">ghostscript</span></dt><dd class="glossdef"><p>The GhostScript package is a set of software that provides a PostScript interpreter, and an interpreter 
                   for Portable Document Format <acronym class="acronym">PDF files</acronym>. <span class="emphasis"><em>Unnecessary</em></span>
                 </p></dd><dt><span class="glossterm">ghostscript-fonts</span></dt><dd class="glossdef"><p>The GhostScript interpreter can use the Ghostscript-fonts package during text rendering. <span class="emphasis"><em>Unnecessary.</em></span>
                 </p></dd><dt><span class="glossterm">
                 <span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></span> <span class="application"> groff-perl</span>
                 </span></dt><dd class="glossdef"><p>The groff-perl package is a set of commands and print filter used in printer environment. <span class="emphasis"><em>Unnecessary, 
                 no printer installed on the server.</em></span>
                 </p></dd><dt><span class="glossterm">
                  <span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></span> <span class="application"> mpage</span>
                 </span></dt><dd class="glossdef"><p>
                 The mpage package utility takes plain text files or PostScript documents as input, reduces the size of the text, and prints the 
                 files on a PostScript printer with several pages on each sheet of paper. <span class="emphasis"><em>Unnecessary, no printer installed on the server</em></span>
                 </p></dd><dt><span class="glossterm">
                 <span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></span> <span class="application"> pnm2ppa</span>
                 </span></dt><dd class="glossdef"><p>
                 The pnm2ppa package is a color driver for printing to HP PPA printers. <span class="emphasis"><em>Unnecessary, no printer installed on the server.</em></span>
                 </p></dd><dt><span class="glossterm">rhs-printfilters</span></dt><dd class="glossdef"><p>
                 The rhs-printfilters package contains a set of print filters, which is primarily meant to be use with the Red Hat printtool. 
                 <span class="emphasis"><em>Unnecessary, no printer installed on the server</em></span>
                 </p></dd></dl></div><p>
                 </p><p><b><span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version all"></span> Applications/System: </b>
                 </p><div class="glosslist"><dl><dt><span class="glossterm">arpwatch</span></dt><dd class="glossdef"><p>
                 The arpwatch package contains utilities to monitor Ethernet or FDDI network traffic and build databases of Ethernet/IP address 
                 pairs. <span class="emphasis"><em>Unnecessary</em></span>
                 </p></dd><dt><span class="glossterm">bind-utils</span></dt><dd class="glossdef"><p>
                 The bind-utils package contains a collection of utilities to find out information about Internet hosts. We will compile it later on 
                 this book.
                 </p></dd><dt><span class="glossterm">
                 <span class="inlinemediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></span> <span class="application"> knfsd-clients</span>
                 </span></dt><dd class="glossdef"><p>
                 The knfsd-clients package contains the showmount program that queries the mount daemon on a remote host for information about the NFS 
                 server on the remote host. <span class="emphasis"><em>Security risks, and NFS services are not installed on this server.</em></span>
                 </p></dd><dt><span class="glossterm">
                 <span class="inlinemediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></span> <span class="application"> procinfo</span>
                 </span></dt><dd class="glossdef"><p>
                 The procinfo package acquires information about your system from the kernel as it is running. <span class="emphasis"><em>Unnecessary, other methods exist.</em></span>
                 </p></dd><dt><span class="glossterm">rdate</span></dt><dd class="glossdef"><p>
                 The rdate package utility can retrieve the date and time from another machine on your network. <span class="emphasis"><em>Security risks.</em></span>
                 </p></dd><dt><span class="glossterm">rdist</span></dt><dd class="glossdef"><p>
                 The rdist package is a program that maintains identical copies of files on multiple hosts. <span class="emphasis"><em>Security risks.</em></span>
                 </p></dd><dt><span class="glossterm">screen</span></dt><dd class="glossdef"><p>
                 This screen package is a useful utility for users who telnet into a machine or are connected via a dumb terminal, but want to use more than just one 
                 login. <span class="emphasis"><em>Unnecessary</em></span>
                 </p></dd><dt><span class="glossterm"><span class="application">ucd-snmp-utils</span></span></dt><dd class="glossdef"><p>
                 The <span class="application"> ucd-snmp-utils</span> package contains various utilities for use with the ucd-snmp network management project. <span class="emphasis"><em>Unnecessary, Security risks</em></span>
                 </p></dd></dl></div><p>
                 </p><p><b><span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span> Documentation: </b>
                 </p><div class="glosslist"><dl><dt><span class="glossterm"><span class="application">indexhtml</span></span></dt><dd class="glossdef"><p>
                 The indexhtml package contains the <acronym class="acronym">HTML</acronym> page and graphics for a welcome page shown 
                 by your Web browser into X Window Systems. <span class="emphasis"><em>Unnecessary,we don't use graphical interface.</em></span> 
                 </p></dd></dl></div><p>
                 </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm1269"></a>10. Select Individual Package -Part 'B'</h2></div></div></div><p><b><span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span> System Environment/Base: </b>
                     </p><div class="glosslist"><dl><dt><span class="glossterm"><span class="application">chkfontpath</span></span></dt><dd class="glossdef"><p>
                 The chkfontpath package is a simple program for adding, removing and listing the directories contained in the X font server's 
                 path. <span class="emphasis"><em>Unnecessary, we don't use graphical interface</em></span>
                 </p></dd><dt><span class="glossterm"><span class="application">yp-tools</span></span></dt><dd class="glossdef"><p>
                 The Network Information Service <acronym class="acronym">NIS</acronym> is a system, which provides and centralizes network information; login names, passwords, 
                 home directories, and group information, to all of the machines on a network. <span class="emphasis"><em>Security risks, we don't use it on our server</em></span>
                 </p></dd></dl></div><p>
                 </p><p><b>
                   <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>  System Environment/Daemons:
                   . </b>
                   </p><div class="glosslist"><dl><dt><span class="glossterm"><span class="application">XFree86-xfs</span></span></dt><dd class="glossdef"><p>
                 The XFree86-xfs package is a font server for XFree86 that can also serve fonts to other X servers remotely. <span class="emphasis"><em>Unnecessary, we don't use graphical interface</em></span>
                 </p></dd><dt><span class="glossterm">
                   <span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></span><span class="application"> finger-server</span>
                 
                 </span></dt><dd class="glossdef"><p>
                 The finger-server package contain the finger daemon that runs from the <code class="filename">/etc/inetd.conf,</code> file and allows users to see information about system 
                 users on the server. <span class="emphasis"><em>Security risks.</em></span>
                 </p></dd><dt><span class="glossterm"> <span class="application"> lpr</span></span></dt><dd class="glossdef"><p>
                 The lpr package provides the basic system utility for managing printing services. <span class="emphasis"><em>Unnecessary and no printer installed on the server</em></span>
                 </p></dd><dt><span class="glossterm">
                 <span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></span>
                  <span class="application"> nfs-utils</span>
                 </span></dt><dd class="glossdef"><p>
                 The nfs-utils package provides the tools and daemon for the kernel <acronym class="acronym">NFS</acronym> server. This package must be installed if you want to provide <acronym class="acronym">NFS</acronym> 
                 services on your server. <span class="emphasis"><em>Security risks, and <acronym class="acronym">NFS</acronym> services are not installed on this server. </em></span>
                 </p></dd><dt><span class="glossterm"><span class="application">pidentd</span></span></dt><dd class="glossdef"><p>
                 The pidentd package contains the identd, which looks up specific <acronym class="acronym">TCP/IP</acronym> connections and returns either the user name or other information about the process that owns the 
                 connection. <span class="emphasis"><em>Unnecessary, very few things on the net require the sender to be running identd, because many machines don't have it and because many people turn it off.</em></span>
                 </p></dd><dt><span class="glossterm"><span class="application">portmap</span></span></dt><dd class="glossdef"><p>
                 The portmapper package manages RPC connections, which are used by protocols like <acronym class="acronym">NFS</acronym> and <acronym class="acronym">NIS.</acronym> <span class="emphasis"><em>Unnecessary, Security risks, and <acronym class="acronym">NIS/NFS</acronym> services are 
                 not installed on this server.</em></span>
                 </p></dd><dt><span class="glossterm">
                   <span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></span> <span class="application"> rsh-server
                   </span></span></dt><dd class="glossdef"><p>
                 The rsh-server package provides the servers needed for (rsh, rlogin, rcp) which allow users to run remote access commands on remote machines. <span class="emphasis"><em>Security risks</em></span>
                 </p></dd><dt><span class="glossterm"><span class="application">rusers
                   </span></span></dt><dd class="glossdef"><p>
                 The routed package routing daemon maintains current routing tables by handling incoming <acronym class="acronym">RIP</acronym> traffic and broadcasts outgoing <acronym class="acronym">RIP</acronym> traffic about network traffic routes. 
                 Unnecessary, <span class="emphasis"><em>Security risks, and limited.</em></span>
                 </p></dd><dt><span class="glossterm">
                   <span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></span> <span class="application"> rusers-server
                 </span></span></dt><dd class="glossdef"><p>
                 The rusers package program allows users to find out who is logged into various machines on the local network. <span class="emphasis"><em>Security risks.</em></span>
                 </p></dd><dt><span class="glossterm"><span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></span> <span class="application"> rwall-server
                  </span></span></dt><dd class="glossdef"><p>
                 The rwall-server package contains the daemon which allows receiving remote messages from users in remote hosts. <span class="emphasis"><em>Security risks</em></span>
                 </p></dd><dt><span class="glossterm"><span class="application">rwho
                    </span></span></dt><dd class="glossdef"><p>
                 The rwho package shows who is logged in for all machines on the local network running the rwho daemon. <span class="emphasis"><em>Security risks.</em></span>
                 </p></dd><dt><span class="glossterm">
                   <span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></span> <span class="application"> talk-server </span>
                 </span></dt><dd class="glossdef"><p>
                 The talk-server package provides the daemon program, which allows you to chat via terminal with other users on remote 
                 <span class="productname">UNIX systems.</span>&#8482; <span class="emphasis"><em>Security risks.</em></span>
                 </p></dd><dt><span class="glossterm">
                  <span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></span> <span class="application"> telnet-server</span>
                 </span></dt><dd class="glossdef"><p>
                 The telnet-server package provides the daemon, which allows telnet remote logins protocol to your server. <span class="emphasis"><em>Security risks, replace by SSH</em></span>
                 </p></dd><dt><span class="glossterm">
                   <span class="inlinemediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></span> <span class="application"> tftp</span>
                 </span></dt><dd class="glossdef"><p>
                 The tftp package or Trivial File Transfer Protocol <acronym class="acronym">TFTP</acronym> allows users to transfer files to and from a remote machine. It is normally used 
                 only for booting diskless workstations. <span class="emphasis"><em>Security risks, Unnecessary.</em></span>
                 </p></dd><dt><span class="glossterm">
                   <span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2.only"></span> <span class="application"> tftp-server</span>
                 </span></dt><dd class="glossdef"><p>
                 The tftp-server package provides the server for (TFTP), which allows users to transfer files to and from a remote machine. <span class="emphasis"><em>Security risks, Unnecessary.</em></span>
                 </p></dd><dt><span class="glossterm"><span class="application">ucd-snmp</span></span></dt><dd class="glossdef"><p>
                 The ucd-snmp package or <acronym class="acronym">SNMP</acronym> -Simple Network Management Protocol is a protocol used for network management. <span class="emphasis"><em>Unnecessary, Security risks</em></span>
                 </p></dd><dt><span class="glossterm">
                   <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span> <span class="application"> ypbind</span>
                 </span></dt><dd class="glossdef"><p>
                   The ypbind package is a daemon which binds <acronym class="acronym">NIS</acronym> -Network Information Service server client to <acronym class="acronym">NIS</acronym> server. <span class="emphasis"><em>Security risks, we don't use it on our server.</em></span>
                 </p></dd><dt><span class="glossterm">
                   <span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></span> <span class="application"> ypserv</span>
                  </span></dt><dd class="glossdef"><p>
                 The ypserv package is the <acronym class="acronym">NIS</acronym> -Network Information Service server, which provides network information (NIS) to all of the machines on a network. <span class="emphasis"><em>Security risks, we don't use it on our server</em></span>
                 </p></dd></dl></div><p>
                 </p><p><b><span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span> System Environment/Libraries: </b>
                  </p><div class="glosslist"><dl><dt><span class="glossterm"><span class="application">XFree86-libs</span></span></dt><dd class="glossdef"><p>
                 The XFree86-libs package contains the shared libraries that most X programs need to run properly. <span class="emphasis"><em>Unnecessary, we dont use graphical interface.</em></span>
                 </p></dd><dt><span class="glossterm"><span class="application">libpng</span></span></dt><dd class="glossdef"><p>
                 The libpng package contains a library of functions for creating and manipulating GIF image format files. GIF is a bit-mapped graphics format similar to the GIF 
                 format. <span class="emphasis"><em>Unnecessary.</em></span>
                 </p></dd></dl></div><p>
                 </p><p><b>User Interface/X: </b>
                  </p><div class="glosslist"><dl><dt><span class="glossterm">
                   <span class="inlinemediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></span> <span class="application"> XFree86-75dpi-fonts</span>
                 </span></dt><dd class="glossdef"><p>
                 The XFree86-75dpi-fonts package contains the 75 dpi fonts (the standard fonts) used on most X Window Systems. <span class="emphasis"><em>Unnecessary, we don't use graphical interface.</em></span>
                 </p></dd><dt><span class="glossterm">
                   
                     <span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></span> <span class="application"> urw-fonts </span>
                 </span></dt><dd class="glossdef"><p>
                 The urw-fonts package contain free versions of the 35 standard Type 1 PostScript fonts. <span class="emphasis"><em>Unnecessary, we don't use graphical interface.</em></span>
                 </p></dd></dl></div><p>
                 </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm1528"></a>11. How to use RPM Commands</h2></div></div></div><p>
                 This section contains an overview of principal modes using with <acronym class="acronym">RPM</acronym> for installing, uninstalling, upgrading, querying, listing, and checking <acronym class="acronym">RPM</acronym> packages on your Linux 
                 system. You must be familiar with these <acronym class="acronym">RPM</acronym> commands now because we'll use them often in the continuation of this book.
                 To install a RPM package, use the command:
                 </p><pre class="screen">
                 [root@deep] /#<span class="command"><strong>rpm</strong></span> -ivh foo-1.0-2.i386.rpm
                 </pre><p>
                 Take a note that <acronym class="acronym">RPM</acronym> packages have a file of names like <code class="filename">foo-1.0-2.i386.rpm,</code> which include the package name (foo), version (1.0), release (2), and architecture (i386).
                 </p><p>
                 To uninstall a RPM package, use the command:
                 </p><pre class="screen">
                 [root@deep] /#<span class="command"><strong>rpm</strong></span> -e foo
                 </pre><p>
                 Notice that we used the package name <code class="filename">foo,</code> not the name of the original package file <code class="filename">foo-1.0-2.i386.rpm.</code>
                 </p><p>
                 To upgrade a RPM package, use the command:
                 </p><pre class="screen">
                 [root@deep] /#<span class="command"><strong>rpm</strong></span> -Uvh foo-1.0-2.i386.rpm
                 </pre><p>
                 With this command, <acronym class="acronym">RPM</acronym> automatically uninstall the old version of <code class="filename">foo</code> package and install the new one. Always 
                 use <strong class="userinput"><code>rpm -Uvh</code></strong> to install packages, since it works fine even when there are no previous versions of the package installed.
                 </p><p>
                 To query a RPM package, use the command:
                 </p><pre class="screen">
                 [root@deep] /#<span class="command"><strong>rpm</strong></span> -q foo
                 </pre><p>
                 This command will print the package name, version, and release number of installed package <code class="filename">foo.</code> Use this command to verify that a package is or is not installed on your system.
                 </p><p>
                 To display package information, use the command:
                 </p><pre class="screen">
                 [root@deep] /#<span class="command"><strong>rpm</strong></span> -qi foo
                 </pre><p>
                 This command display package information; includes name, version, and description of the installed program. Use this command to get information about the installed package.
                 </p><p>
                 To list files in package, use the command:
                 </p><pre class="screen">
                 [root@deep] /#<span class="command"><strong>rpm</strong></span> -qlfoo
                 </pre><p>
                 This command will list all files in a installed <acronym class="acronym">RPM</acronym> package. It works only when the package is already installed on your system.
                 </p><p>
                 To check a RPM signature package, use the command:
                 </p><pre class="screen">
                 [root@deep] /#<span class="command"><strong>rpm</strong></span>  --checksig foo
                 </pre><p>
                 This command checks the <acronym class="acronym">PGP</acronym> signature of specified package to ensure its integrity and origin. Always use this command first before installing new 
                 <acronym class="acronym">RPM</acronym> package on your system. Also, <span class="application">GnuPG</span> or <span class="application">Pgp</span> software must be already installed on your system before you can use this command.
                 </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm1567"></a>12. Starting and stopping daemon services</h2></div></div></div><p>The init program of Linux -also known as process control initialization, is in charge of starting all the normal and authorized processes that need to run at boot time on your system. These may include the APACHE daemons, NETWORK daemons, 
           and anything else that must be running when your machine boots. Each of these processes has a script under <code class="filename">/etc/rc.d/init.d/</code> directory written to accept an argument, which can be <span class="command"><strong>start</strong></span>, 
           <span class="command"><strong>stop</strong></span> and <span class="command"><strong>restart.</strong></span> You can execute those scripts by hand in fact with a command:
          </p><div class="example"><a name="idm1574"></a><p class="title"><b>Example 3.1. Starting and Stopping various Daemon's</b></p><div class="example-contents"><p>
         To start the httpd Web Server manually under Linux.
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/httpd <span class="command"><strong>start</strong></span>
         </pre><p>
         </p><div class="literallayout"><p><code class="computeroutput"><br>
         Starting httpd:                        [OK]<br>
         </code></p></div><p>
         
         </p><p>
         To stop the httpd Web Server manually under Linux.
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/httpd <span class="command"><strong>stop</strong></span>
         </pre><p>
         </p><div class="literallayout"><p><code class="computeroutput"><br>
         Shutting down http:            	[OK]<br>
         </code></p></div><p>
         
         </p><p>
         To restart the httpd Web Server manually under Linux.
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/httpd <span class="command"><strong>restart</strong></span>
         </pre><p>
         </p><div class="literallayout"><p><code class="computeroutput"><br>
         Shutting down http:             	[OK]<br>
         Starting httpd:                	[OK]<br>
         </code></p></div><p>
         </p><p>
         Check inside your <code class="filename">/etc/rc.d/init.d/</code> directory for services available and use command <span class="command"><strong>start | stop | restart</strong></span> 
         to work around.
         </p></div></div><br class="example-break"></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="pr2ch4Pi"></a>Chapter 4. Post-Install</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#ch3sc3.1-1">1. Software that must be uninstalled</a></span></dt><dt><span class="section"><a href="#idm1832">2. Use <acronym class="acronym">RPM</acronym> command to uninstall.</a></span></dt><dt><span class="section"><a href="#idm1904">3. Software that must be installed</a></span></dt><dt><span class="section"><a href="#idm2067">4. Check,Re-confirm</a></span></dt><dt><span class="section"><a href="#idm2617">5. Verify,Cross-check</a></span></dt><dt><span class="section"><a href="#idm3118">6. some colors for a change</a></span></dt><dt><span class="section"><a href="#prt2ch3sc7uls">7. Update of the latest software</a></span></dt></dl></div><div class="highlights"><p>This entire chapter deals with the steps to be taken after the installation of your server, for example, uninstallation of certain programs
             which are going to compiled on your server using source tarballs, installation of certain programs required to compile these source tarballs etc
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ch3sc3.1-1"></a>1. Software that must be uninstalled</h2></div></div></div><p>
           Red Hat Linux installs other pre-compiled binaries of  programs on your system by default and doesn't give you the choice to uninstall them during the install setup. For this 
           reason, you must uninstall the following software on your system after the installation of your server.We must uninstall them for better security and to make space in our server. 
           </p><p>
           For more information and explanation of their capabilities and uses, please see your Red Hat manual or install the package and make an <span class="command"><strong>rpm</strong></span> -qi <code class="filename">foo</code> 
           command to query and get a detailed description of the program, and then uninstall it again.
           Below is the list of programs and a short description of their utilizations. 
           </p><p>
         </p><div class="glosslist"><dl><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">pump</span>
          </span></dt><dd class="glossdef"><p>
           The Pump DHCP package allows individual diskless clients on a network to get their own IP network configuration information from network servers. <span class="emphasis"><em>Unnecessary.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">mt-st</span>
          </span></dt><dd class="glossdef"><p>
          The <code class="literal">mt</code> -for magnetic tape drives and <code class="literal">st</code> -for <acronym class="acronym"><acronym class="acronym">SCSI</acronym></acronym> tape devices tape drive management programs can control rewinding, ejecting, skipping files, blocks and more. 
          <span class="emphasis"><em>Necessary only if you have a tape backup on this server.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">eject</span>
          </span></dt><dd class="glossdef"><p>
          The eject package contains an eject program that allows the user to eject removable media typically <span class="hardware">CD-ROMs, floppy disks, Iomega Jaz or Zip</span> disks using software control. 
          <span class="emphasis"><em>Necessary only if you have a tape backup on this server.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">Metamail</span>
          </span></dt><dd class="glossdef"><p>
          Metamail is a program that uses the mailcap file to determine how it should display non-text or multimedia material. <span class="emphasis"><em>Unnecessary.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">apmd</span>
          </span></dt><dd class="glossdef"><p>
          The <acronym class="acronym">apmd</acronym> package, or advanced Power Management daemon utilities, can watch your notebook's battery and warn all users when the battery is low. <span class="emphasis"><em>Unnecessary for a server.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">kernel-pcmcia-cs</span>
          </span></dt><dd class="glossdef"><p>
          The kernel-pcmcia-cs package is for laptop machines and some non-laptops that support <acronym class="acronym">PCMCIA</acronym> cards for expansion. <span class="emphasis"><em>Unnecessary for a server.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">linuxconf</span>
          </span></dt><dd class="glossdef"><p>
          The linuxconf package is a system configuration tool. <span class="emphasis"><em>Unnecessary, buggy program.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
          <span class="application"> getty_ps</span>
          </span></dt><dd class="glossdef"><p>
          The getty_ps package contains programs that are used to accept logins on the console or a terminal on your system. <span class="emphasis"><em>Unnecessary.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></span>
                 <span class="application">setconsole</span>
          </span></dt><dd class="glossdef"><p>
          The setconsole package is a basic system utility for setting up the <code class="filename">/etc/inittab, /dev/systty</code> and <code class="filename">/dev/console</code> files to 
          handle a new console. <span class="emphasis"><em>Unnecessary.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">isapnptools</span>
          </span></dt><dd class="glossdef"><p>
          The isapnptools package contains utilities for configuring <acronym class="acronym">ISA</acronym> Plug-and-Play (<acronym class="acronym">PnP</acronym>) cards/boards. <span class="emphasis"><em>Unnecessary.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">setserial</span>
          </span></dt><dd class="glossdef"><p>
          The setserial package is a basic system utility for displaying or setting serial port information. <span class="emphasis"><em>Unnecessary.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application"> kudzu</span>
          </span></dt><dd class="glossdef"><p>
          The kudzu package is a hardware-probing tool run at system boot time to determine what hardware has been added or removed from the system. <span class="emphasis"><em>Unnecessary.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="version All"></span>
                 <span class="application"> raidtools</span>
          </span></dt><dd class="glossdef"><p>
          The raidtools package includes the tools you need to set up and maintain a software <acronym class="acronym"><acronym class="acronym">RAID</acronym></acronym> device on a Linux system. <span class="emphasis"><em>Depending if you use Raid or not.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">gnuPG</span>
          </span></dt><dd class="glossdef"><p>
          The GnuPG package is a tool for secure communication and data storage. It is a replacement for the <acronym class="acronym">PGP</acronym> software. It can also be used to encrypt data and to create digital 
          signatures. <span class="emphasis"><em>We will compile it later on our book.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">redhat-logos</span>
          </span></dt><dd class="glossdef"><p>
          The redhat-logos package contains files of the Red Hat "Shadow Man" logo and the <acronym class="acronym">RPM</acronym> logo. <span class="emphasis"><em>Unnecessary on a server.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">redhat-release</span>
          </span></dt><dd class="glossdef"><p>
          The redhat-release package contains the Red Hat Linux release file. <span class="emphasis"><em>Unnecessary.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">gd</span>
          </span></dt><dd class="glossdef"><p>
          The gd package allows your code to quickly draw images and write out the result as a <code class="filename">.gif</code> file. <span class="emphasis"><em>Unnecessary.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">pciutils</span>
          </span></dt><dd class="glossdef"><p>
          The pciutils package contains various utilities for inspecting and setting devices connected to the <acronym class="acronym">PCI</acronym> bus. <span class="emphasis"><em>We use other methods.</em></span>
          </p></dd><dt><span class="glossterm">
          <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
                 <span class="application">rmt</span>
          </span></dt><dd class="glossdef"><p>
          The rmt utility provides remote network access to make backup. <span class="emphasis"><em>Security risks since rmt depends on rsh to work.</em></span>
          </p></dd></dl></div><p>
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm1832"></a>2. Use <acronym class="acronym">RPM</acronym> command to uninstall.</h2></div></div></div><p>
         The command to uninstall software is:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>rpm</strong></span> -e &lt;softwarename(s)&gt;
         </pre><p>
         Where &lt;softwarename&gt; is the name of the software you want to uninstall e.g. (foo).
         </p><p>
         Since Programs like apmd, kudzu, and sendmail are daemons that run as process. It is better to stop those processes before uninstalling them from the 
         system.To stop those processes, use the following commands:
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/apmd <span class="command"><strong>stop</strong></span>
         [root@deep] /# /etc/rc.d/init.d/sendmail <span class="command"><strong>stop</strong></span>
         [root@deep] /# /etc/rc.d/init.d/kudzu <span class="command"><strong>stop</strong></span>
         </pre><p>
         </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
             <span class="inlinemediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></span>
             Now you can uninstall them safely, and all other packages, as shown below:
             Remove the specified packages for Red Hat Linux version 6.1 (Cartman).
             </p><pre class="screen">
             [root@deep] /# <span class="command"><strong>rpm</strong></span> -e --nodeps pump mt-st eject mailcap apmd kernel-pcmcia-cs linuxconf getty_ps 
             setconsole isapnptools setserial kudzu raidtools gnupg redhat-logos redhat-release gd pciutils rmt</pre><p>

             <span class="inlinemediaobject"><img src="images/Version6.2.gif" alt="Version 6.2. only"></span> Remove the specified packages for Red Hat Linux version 6.2 (Zoot).
             </p><pre class="screen">
             [root@deep] /# <span class="command"><strong>rpm</strong></span> -e --nodeps pump mt-st eject mailcap apmd kernel-pcmcia-cs linuxconf getty_ps 
             isapnptools setserial kudzu raidtools gnupg redhat-logos redhat-release gd pciutils rmt</pre><p>
         </p></li><li class="step"><p>
         <span class="inlinemediaobject"><img src="images/VersionAll.gif" alt="Version All"></span>
         Remove the linux.conf-installed file manually.
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>rm</strong></span> -f /etc/conf.linuxconf-installed
         </pre><p>
         </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
           This is a configuration file related to linuxconf software that must be removed manually.                  
         </p></div><p>
         The program hdparm is needed by <acronym class="acronym"><acronym class="acronym">IDE</acronym></acronym> hard disk but not <acronym class="acronym"><acronym class="acronym">SCSI</acronym></acronym> hard disks. If you have an <acronym class="acronym"><acronym class="acronym">IDE</acronym></acronym> disk on your system you must keep 
         this program (hdparm), but if you don't have an <acronym class="acronym"><acronym class="acronym">IDE</acronym></acronym> hard disk you can remove it safely from your system.

         To remove hdparm from your system, use the following command:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>rpm</strong></span> -e hdparm
         </pre><p>
         </p><p>
         Use the programs <span class="application"> kbdconfig, mouseconfig, timeconfig, authconfig, ntsysv,</span> and <span class="application">setuptool</span> in order 
         to set your keyboard language and type, your mouse type, your default time zone, your <acronym class="acronym">NIS</acronym> and shadow passwords, your numerous symbolic links in <code class="filename">/etc/rc.d</code> 
         directory, and text mode menu utility which allow you to access all of these features. After those configurations have been set during the installation stage 
         of your Linux server it's rare that you would need to change them again. So, you can uninstall them, and if in future you need to change your keyboard, 
         mouse, default time, etc again via test mode menu, all you have to do is to install the program with the <acronym class="acronym">RPM</acronym> from your original <span class="hardware">CD-ROM.</span>

         To remove all the above programs from your system, use the following command:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>rpm</strong></span> -e kbdconfig mouseconfig timeconfig authconfig ntsysv setuptool
         </pre><p>
         </p><p>
         Even if you are not intending to install a mail server on your Linux system, the program Sendmail is always needed on your servers for potential messages sent to the root user 
         by different software services installed on your machine.
         </p><p>
         Sendmail is a Mail Transport Agent -<acronym class="acronym">MTA</acronym> program that sends mail from one machine to another. It can be configured in different manners; it can serve as an 
         internal delivery mail system to a Mail Hub Server, or can be configured to be a Central Mail Hub Server for all Sendmail machines on your network. So depending on what you 
         want to do with Sendmail, you must configure it to respond to your specific needs. For this reason you must uninstall Sendmail 
         and see the relevant sections in this book that is related to <a class="link" href="#pr6ch22SSMn" title="Chapter 22. Software -Server/Mail Network">Sendmail</a> configuration and installation.
         </p><p>
         To remove Sendmail from your system, use the following command:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>rpm</strong></span> -e sendmail
         </pre><p>
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm1904"></a>3. Software that must be installed</h2></div></div></div><p>
           There are certain programs required to be able to compile programs on your server, hence you must install the following <acronym class="acronym">RPM</acronym> packages. This part of the installation is very important and 
           requires that you install all related packages described below. These are on your Red Hat Part 1 <span class="hardware">CD-ROM</span> under RedHat/<acronym class="acronym">RPMS</acronym> directory and represent the base 
           necessary software needed on Linux to compile and install programs.
           </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
                 First, we mount the <span class="hardware">CD-ROM</span> drive and move to the <acronym class="acronym">RPMS</acronym> subdirectory of the <span class="hardware">CD-ROM.</span>
                 To mount the CD-ROM drive and move to RPM directory, use the following commands:
                 </p><pre class="screen">
                   [root@deep] /# <span class="command"><strong>mount</strong></span> /dev/cdrom /mnt/cdrom/
                   [root@deep] /# <span class="command"><strong>cd</strong></span> /mnt/cdrom/RedHat/RPMS/

                 </pre><p>
               </p><p>
                 In the process of customizing our linux server, we will be using, most of the time source tarballs rather than pre-compiled RPMs hence
                 these are the packages that we need to be able to compile and install programs. Remember, this is the minimum package that will allow you 
                 to compile most of the tarballs available for Linux. Other compiled binary packages exist on the Red Hat CD-ROM, so verify with the README 
                 file that came with the tarballs program you want to install if you receive an error messages during compilation of the specific software.
               </p><p>
               </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
                 </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">m4-1.4-12.i386.rpm</code></td><td><code class="filename">egcs-1.1.2-24.i386.rpm</code></td></tr><tr><td><code class="filename">dev86-0.14.9-1.i386.rpm</code></td><td><code class="filename">ElectricFence-2.1-1.i386.rpm</code></td></tr><tr><td><code class="filename">bison-1.28-1.i386.rpm</code></td><td><code class="filename">flex-2.5.4a-7.i386.rpm</code></td></tr><tr><td><code class="filename">byacc-1.9-11.i386.rpm</code></td><td><code class="filename">gdb-4.18-4.i386.rpm</code></td></tr><tr><td><code class="filename">cdecl-2.5-9.i386.rpm</code></td><td><code class="filename">kernel-headers-2.2.12-20.i386.rpm</code></td></tr><tr><td><code class="filename">cpp-1.1.2-24.i386.rpm</code></td><td><code class="filename">glibc-devel-2.1.2-11.i386.rpm</code></td></tr><tr><td><code class="filename">cproto-4.6-2.i386.rpm</code></td><td><code class="filename">make-3.77-6.i386.rpm</code></td></tr><tr><td><code class="filename">ctags-3.2-1.i386.rpm</code></td><td><code class="filename">patch-2.5-9.i386.rpm</code></td></tr></table><p>
                   </p><p>
                    </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
                   </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">m4-1.4-12.i386.rpm</code></td><td><code class="filename">egcs-1.1.2-30.i386.rpm</code></td></tr><tr><td><code class="filename">dev86-0.15.0-2.i386.rpm</code></td><td><code class="filename">ElectricFence-2.1-3.i386.rpm</code></td></tr><tr><td><code class="filename">bison-1.28-2.i386.rpm</code></td><td><code class="filename">flex-2.5.4a-9.i386.rpm</code></td></tr><tr><td><code class="filename">byacc-1.9-12.i386.rpm</code></td><td><code class="filename">gdb-4.18-11.i386.rpm</code></td></tr><tr><td><code class="filename">cdecl-2.5-10.i386.rpm</code></td><td><code class="filename">kernel-headers-2.2.14-5.0.i386.rpm</code></td></tr><tr><td><code class="filename">cpp-1.1.2-30.i386.rpm</code></td><td><code class="filename">glibc-devel-2.1.3-15.i386.rpm</code></td></tr><tr><td><code class="filename">cproto-4.6-3.i386.rpm</code></td><td><code class="filename">make-3.78.1-4.i386.rpm</code></td></tr><tr><td><code class="filename">ctags-3.4-1.i386.rpm</code></td><td><code class="filename">patch-2.5-10.i386.rpm</code></td></tr></table><p>                 

             </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
                 It is better to install software mentioned above in one shot, if you don't want to receive error message 
                 regarding dependencies  during <acronym class="acronym">RPM</acronym> install.

               </p></div><p>
                   </p></li><li class="step"><p>
                 </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
                 Install all the needed software above with one RPM command.

                 The RPM command to install all software together is:
                 </p><pre class="screen">
                   [root@deep ] /RPMS#<span class="command"><strong>rpm</strong></span> -Uvh  m4-1.4-12.i386.rpm  dev86-0.14.9-1.i386.rpm bison-1.28-1.i386.rpm byacc-1.9-11.i386.rpm cdecl-2.5-9.i386.rpm cpp-1.1.2-24.i386.rpm 
                   cproto-4.6-2.i386.rpm ctags-3.2-1.i386.rpm egcs-1.1.2-24.i386.rpm ElectricFence-2.1-1.i386.rpm flex-2.5.4a-7.i386.rpm gdb-4.18-4.i386.rpm kernel-headers-2.2.12-20.i386.rpm glibc-devel-2.1.2-11.i386.rpm 
                   make-3.77-6.i386.rpm patch-2.5-9.i386.rpm
                 </pre><p>
               </p><p>
                 </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
                 Install all the needed software above with one RPM command.

                 The RPM command to install all software together is:
                 </p><pre class="screen">
                   [root@deep ] /RPMS#<span class="command"><strong>rpm</strong></span> -Uvh m4-1.4-12.i386.rpm dev86-0.15.0-2.i386.rpm bison-1.28-2.i386.rpm byacc-1.9-12.i386.rpm cdecl-2.5-10.i386.rpm cpp-1.1.2-30.i386.rpm 
                   cproto-4.6-3.i386.rpm ctags-3.4-1.i386.rpm egcs-1.1.2-30.i386.rpm ElectricFence-2.1-3.i386.rpm flex-2.5.4a-9.i386.rpm gdb-4.18-11.i386.rpm kernel-headers-2.2.14-5.0.i386.rpm glibc-devel-2.1.3-15.i386.rpm 
                   make-3.78.1-4.i386.rpm patch-2.5-10.i386.rpm
                 </pre><p>

               </p></li></ol></div><p>
          The <acronym class="acronym">RPM</acronym> package has many options, for example we have used the following sytax: </p><div class="cmdsynopsis"><p><code class="command">rpm</code>  [-Uvh] [<em class="replaceable"><code>file</code></em>]</p></div><p>
          you might be curious to know what these arguments  -Uvh means, why should it be given at all <abbr class="abbrev">etc.</abbr>Here is a brief description:

          </p><div class="glosslist"><dl><dt><span class="glossterm"><em class="parameter"><code>-U</code></em></span></dt><dd class="glossdef"><p>
                -stands for Upgrade which will uninstall an older version of the package you are installing and install the new one, which will eliminate the error likely to occur
                if in case the package being uninstalled has dependencies. It is generally recomded to use this argument even while you are obsolutely sure that there is no earlier version of the package you are trying to install is 
                existing on your machine.
               </p></dd><dt><span class="glossterm"><em class="parameter"><code>v</code></em></span></dt><dd class="glossdef"><p>
               -stands for verbose, which is quite self explanatory. This argument ensures all messages are written to the stdout/console so you get to know what is happening.
              </p></dd><dt><span class="glossterm"><em class="parameter"><code>h</code></em></span></dt><dd class="glossdef"><p>
              -this generates the hash mark <code class="prompt">#</code> in a series, this will give a sense of visual progress with the install process .
              </p></dd></dl></div><p>
          </p><p>So, when you use <span class="command"><strong>rpm  <strong class="userinput"><code>-Uvh</code></strong></strong></span>, whether it is Redhat ver 6.1 or ver 6.2, what you see on your console is shown below,Notice in the display 
            that the name of the package is seen but not the version number. Infact we have mentioned this earlier in this book that when you install or upgrade you have 
            to enter the package name with version name, for example <span class="command"><strong>rpm <strong class="userinput"><code>-ivh mnt-1.0.4.rpm</code></strong></strong></span> but while querying the same package using rpm command 
            the syntax is as follows: <span class="command"><strong>rpm</strong></span> <strong class="userinput"><code>-qi mnt</code></strong>, Please do keep this mind. Given below is a graphical representation of your screen when you 
            install the above mentioned rpm's :
          </p><p>
            </p><div class="mediaobject"><img src="images/VersionAll.gif" alt="version all"></div><p>
            </p><pre class="literallayout"><code class="computeroutput">
              m4                          	##################################################              
              dev86                      	##################################################
              bison                       	##################################################
              byacc                       	##################################################
              cdecl                       	##################################################
              cpp                         	##################################################
              cproto                      	##################################################
              ctags                       	##################################################
              egcs                        	##################################################
              ElectricFence               	##################################################
              flex                        	##################################################
              gdb                         	##################################################
              kernel-headers                    ##################################################
              glibc-devel                 	##################################################
              make                        	##################################################
              patch                       	##################################################
            </code></pre><p>           
          </p><p>
          You must exit and re-login for all the change to take effect.
          To exit from your console, use the command:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>exit</strong></span> 
          </pre><p>

          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm2067"></a>4. Check,Re-confirm</h2></div></div></div><p>
             After installation and compilation of all programs you need on your server, it's a good idea to remove all unnecessary programs (compilers, etc) described above unless needed it is obsolutely needed by the system. 
             Few reasons are:
             
             </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: opencircle; "><li class="listitem" style="list-style-type: circle"><p>
             If a cracker gains access to your server he or she cannot compile or modify binary programs. Also, this will free a lot of space and will help to improve regular scanning of files on 
             your server for integrity checking.
             </p></li><li class="listitem" style="list-style-type: circle"><p>

             When you run a server you will give it a special task to accomplish. You will never put all services you want to offer in one machine or you will lose speed - <span class="emphasis"><em>resources available divided by the 
             number of process running on the server</em></span>.
             </p></li><li class="listitem" style="list-style-type: circle"><p>
             Decrease your security with a lot of services running on the same machine, if a cracker accesses this server, he or she can attack directly all 
             the others available.
             </p></li><li class="listitem" style="list-style-type: circle"><p>
             Having different servers doing different tasks will simplify the administration, management you know what task each server is supposed to do, what services should be available, which ports are 
             open to clients access and which one are closed, you know what you are supposed to see in the log files, etc, and give you more control and flexibility on each server dedicated for mail, 
             web pages, database, development, backup, etc. 
             </p></li><li class="listitem" style="list-style-type: circle"><p>
             For example, having one server specialized just for development and testing will permit you to not be compelled to install compiler programs 
             on a server each time you want to compile and install new software on it, and be obliged afterwards to uninstall the compilers, or other sharp objects.
             </p></li></ul></div><p>
           </p><p>
           If you have followed each step exactly as described till now, Since we have chosen to customize the installation of our Linux system, this is the list of all installed programs that you must have on your 
           server after the complete installation of the Linux Server. This list must match exactly the install.log file located in your <code class="filename">/tmp</code> directory or you could run into a problem. Don't 
           forget to install all programs listed above in <a class="link" href="#ch3sec3.3-1">Software that must be installed</a> after installation of the Server to be able to compile programd properly on your Server.
           </p><p>
             </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
             </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">Installing setup.</code></td><td><code class="filename">Installing gawk.</code></td><td><code class="filename">Installing netkit-base.</code></td></tr><tr><td><code class="filename">Installing filesystem.</code></td><td><code class="filename">Installing gd.</code></td><td><code class="filename">Installing newt.</code></td></tr><tr><td><code class="filename">Installing basesystem.</code></td><td><code class="filename">Installing gdbm.</code></td><td><code class="filename">Installing ntsysv.</code></td></tr><tr><td><code class="filename">Installing ldconfig.</code></td><td><code class="filename">Installing getty_ps.</code></td><td><code class="filename">Installing passwd.</code></td></tr><tr><td><code class="filename">Installing glibc.</code></td><td><code class="filename">Installing glib.</code></td><td><code class="filename">Installing pciutils.</code></td></tr><tr><td><code class="filename">Installing shadow-utils.</code></td><td><code class="filename">Installing gmp.</code></td><td><code class="filename">Installing perl.</code></td></tr><tr><td><code class="filename">Installing mktemp.</code></td><td><code class="filename">Installing gnupg.</code></td><td><code class="filename">Installing procmail.</code></td></tr><tr><td><code class="filename">Installing termcap.</code></td><td><code class="filename">Installing gpm.</code></td><td><code class="filename">Installing procps.</code></td></tr><tr><td><code class="filename">Installing libtermcap.</code></td><td><code class="filename">Installing groff.</code></td><td><code class="filename">Installing psmisc.</code></td></tr><tr><td><code class="filename">Installing bash.</code></td><td><code class="filename">Installing gzip.</code></td><td><code class="filename">Installing pump.</code></td></tr><tr><td><code class="filename">Installing MAKEDEV.</code></td><td><code class="filename">Installing hdparm.</code></td><td><code class="filename">Installing python.</code></td></tr><tr><td><code class="filename">Installing SysVinit.</code></td><td><code class="filename">Installing initscripts.</code></td><td><code class="filename">Installing quota.</code></td></tr><tr><td><code class="filename">Installing XFree86-Mach64.</code></td><td><code class="filename">Installing ipchains.</code></td><td><code class="filename">Installing raidtools.</code></td></tr><tr><td><code class="filename">Installing chkconfig.</code></td><td><code class="filename">Installing isapnptools.</code></td><td><code class="filename">Installing readline.</code></td></tr><tr><td><code class="filename">Installing apmd.</code></td><td><code class="filename">Installing kbdconfig.</code></td><td><code class="filename">Installing redhat-logos.</code></td></tr><tr><td><code class="filename">Installing ncurses.</code></td><td><code class="filename">Installing kernel.</code></td><td><code class="filename">Installing rootfiles.</code></td></tr><tr><td><code class="filename">Installing info.</code></td><td><code class="filename">Installing kernel-pcmcia-cs.</code></td><td><code class="filename">Installing rpm.</code></td></tr><tr><td><code class="filename">Installing fileutils.</code></td><td><code class="filename">Installing kudzu.</code></td><td><code class="filename">Installing sash.</code></td></tr><tr><td><code class="filename">Installing grep.</code></td><td><code class="filename">Installing ld.so.</code></td><td><code class="filename">Installing sendmail.</code></td></tr><tr><td><code class="filename">Installing ash.</code></td><td><code class="filename">Installing less.</code></td><td><code class="filename">Installing setconsole.</code></td></tr><tr><td><code class="filename">Installing at.</code></td><td><code class="filename">Installing libc.</code></td><td><code class="filename">Installing setserial.</code></td></tr><tr><td><code class="filename">Installing authconfig.</code></td><td><code class="filename">Installing libstdc++.</code></td><td><code class="filename">Installing setuptool.</code></td></tr><tr><td><code class="filename">Installing bc.</code></td><td><code class="filename">Installing lilo.</code></td><td><code class="filename">Installing shapecfg.</code></td></tr><tr><td><code class="filename">Installing bdflush.</code></td><td><code class="filename">Installing pwdb.</code></td><td><code class="filename">Installing slang.</code></td></tr><tr><td><code class="filename">Installing binutils.</code></td><td><code class="filename">Installing pam.</code></td><td><code class="filename">Installing slocate.</code></td></tr><tr><td><code class="filename">Installing bzip2.</code></td><td><code class="filename">Installing sh-utils.</code></td><td><code class="filename">Installing stat.</code></td></tr><tr><td><code class="filename">Installing sed.</code></td><td><code class="filename">Installing redhat-release.</code></td><td><code class="filename">Installing sysklogd.</code></td></tr><tr><td><code class="filename">Installing console-tools.</code></td><td><code class="filename">Installing linuxconf.</code></td><td><code class="filename">Installing tar.</code></td></tr><tr><td><code class="filename">Installing e2fsprogs.</code></td><td><code class="filename">Installing logrotate.</code></td><td><code class="filename">Installing tcp_wrappers.</code></td></tr><tr><td><code class="filename">Installing rmt.</code></td><td><code class="filename">Installing losetup.</code></td><td><code class="filename">Installing tcpdump.</code></td></tr><tr><td><code class="filename">Installing cpio.</code></td><td><code class="filename">Installing lsof.</code></td><td><code class="filename">Installing tcsh.</code></td></tr><tr><td><code class="filename">Installing cracklib.</code></td><td><code class="filename">Installing mailcap.</code></td><td><code class="filename">Installing time.</code></td></tr><tr><td><code class="filename">Installing cracklib-dicts.</code></td><td><code class="filename">Installing mailx.</code></td><td><code class="filename">Installing timeconfig.</code></td></tr><tr><td><code class="filename">Installing crontabs.</code></td><td><code class="filename">Installing man.</code></td><td><code class="filename">Installing timed.</code></td></tr><tr><td><code class="filename">Installing textutils.</code></td><td><code class="filename">Installing mingetty.</code></td><td><code class="filename">Installing tmpwatch.</code></td></tr><tr><td><code class="filename">Installing dev.</code></td><td><code class="filename">Installing mkbootdisk.</code></td><td><code class="filename">Installing traceroute.</code></td></tr><tr><td><code class="filename">Installing diffutils.</code></td><td><code class="filename">Installing mkinitrd.</code></td><td><code class="filename">Installing utempter.</code></td></tr><tr><td><code class="filename">Installing dump.</code></td><td><code class="filename">Installing modutils.</code></td><td><code class="filename">Installing util-linux.</code></td></tr><tr><td><code class="filename">Installing ed.</code></td><td><code class="filename">Installing mount.</code></td><td><code class="filename">Installing vim-common.</code></td></tr><tr><td><code class="filename">Installing eject.</code></td><td><code class="filename">Installing mouseconfig.</code></td><td><code class="filename">Installing vim-minimal.</code></td></tr><tr><td><code class="filename">Installing etcskel.</code></td><td><code class="filename">Installing mt-st.</code></td><td><code class="filename">Installing vixie-cron.</code></td></tr><tr><td><code class="filename">Installing file.</code></td><td><code class="filename">Installing ncompress.</code></td><td><code class="filename">Installing which.</code></td></tr><tr><td><code class="filename">Installing findutils.</code></td><td><code class="filename">Installing net-tools.</code></td><td><code class="filename">Installing zlib.</code></td></tr></table><p>  </p><p>
             </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>

             </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">Installing setup.</code></td><td><code class="filename">Installing gawk.</code></td><td><code class="filename">Installing ncompress.</code></td></tr><tr><td><code class="filename">Installing filesystem.</code></td><td><code class="filename">Installing gd.</code></td><td><code class="filename">Installing net-tools.</code></td></tr><tr><td><code class="filename">Installing basesystem.</code></td><td><code class="filename">Installing gdbm.</code></td><td><code class="filename">Installing newt.</code></td></tr><tr><td><code class="filename">Installing ldconfig.</code></td><td><code class="filename">Installing getty_ps.</code></td><td><code class="filename">Installing ntsysv.</code></td></tr><tr><td><code class="filename">Installing glibc.</code></td><td><code class="filename">Installing glib.</code></td><td><code class="filename">Installing passwd.</code></td></tr><tr><td><code class="filename">Installing shadow-utils.</code></td><td><code class="filename">Installing gmp.</code></td><td><code class="filename">Installing pciutils.</code></td></tr><tr><td><code class="filename">Installing mktemp.</code></td><td><code class="filename">Installing gnupg.</code></td><td><code class="filename">Installing perl.</code></td></tr><tr><td><code class="filename">Installing termcap.</code></td><td><code class="filename">Installing gpm.</code></td><td><code class="filename">Installing popt.</code></td></tr><tr><td><code class="filename">Installing libtermcap.</code></td><td><code class="filename">Installing groff.</code></td><td><code class="filename">Installing procmail.</code></td></tr><tr><td><code class="filename">Installing bash.</code></td><td><code class="filename">Installing gzip.</code></td><td><code class="filename">Installing procps.</code></td></tr><tr><td><code class="filename">Installing MAKEDEV.</code></td><td><code class="filename">Installing hdparm.</code></td><td><code class="filename">Installing psmisc.</code></td></tr><tr><td><code class="filename">Installing SysVinit.</code></td><td><code class="filename">Installing inetd.</code></td><td><code class="filename">Installing pump.</code></td></tr><tr><td><code class="filename">Installing XFree86-Mach64.</code></td><td><code class="filename">Installing initscripts.</code></td><td><code class="filename">Installing quota.</code></td></tr><tr><td><code class="filename">Installing anacron.</code></td><td><code class="filename">Installing ipchains.</code></td><td><code class="filename">Installing raidtools.</code></td></tr><tr><td><code class="filename">Installing chkconfig.</code></td><td><code class="filename">Installing iputils.</code></td><td><code class="filename">Installing readline.</code></td></tr><tr><td><code class="filename">Installing apmd.</code></td><td><code class="filename">Installing isapnptools.</code></td><td><code class="filename">Installing redhat-logos.</code></td></tr><tr><td><code class="filename">Installing ncurses.</code></td><td><code class="filename">Installing kbdconfig.</code></td><td><code class="filename">Installing rootfiles.</code></td></tr><tr><td><code class="filename">Installing info.</code></td><td><code class="filename">Installing kernel.</code></td><td><code class="filename">Installing rpm.</code></td></tr><tr><td><code class="filename">Installing fileutils.</code></td><td><code class="filename">Installing kernel-pcmcia-cs.</code></td><td><code class="filename">Installing sash.</code></td></tr><tr><td><code class="filename">Installing grep.</code></td><td><code class="filename">Installing kernel-utils.</code></td><td><code class="filename">Installing sendmail.</code></td></tr><tr><td><code class="filename">Installing ash.</code></td><td><code class="filename">Installing kudzu.</code></td><td><code class="filename">Installing setserial.</code></td></tr><tr><td><code class="filename">Installing at.</code></td><td><code class="filename">Installing ld.so.</code></td><td><code class="filename">Installing setuptool.</code></td></tr><tr><td><code class="filename">Installing authconfig.</code></td><td><code class="filename">Installing less.</code></td><td><code class="filename">Installing shapecfg.</code></td></tr><tr><td><code class="filename">Installing bc.</code></td><td><code class="filename">Installing libc.</code></td><td><code class="filename">Installing slang.</code></td></tr><tr><td><code class="filename">Installing bdflush.</code></td><td><code class="filename">Installing libstdc++.</code></td><td><code class="filename">Installing slocate.</code></td></tr><tr><td><code class="filename">Installing binutils.</code></td><td><code class="filename">Installing lilo.</code></td><td><code class="filename">Installing stat.</code></td></tr><tr><td><code class="filename">Installing bzip2.</code></td><td><code class="filename">Installing pwdb.</code></td><td><code class="filename">Installing sysklogd.</code></td></tr><tr><td><code class="filename">Installing sed.</code></td><td><code class="filename">Installing pam.</code></td><td><code class="filename">Installing tar.</code></td></tr><tr><td><code class="filename">Installing console-tools.</code></td><td><code class="filename">Installing sh-utils.</code></td><td><code class="filename">Installing tcp_wrappers.</code></td></tr><tr><td><code class="filename">Installing e2fsprogs.</code></td><td><code class="filename">Installing redhat-release.</code></td><td><code class="filename">Installing tcpdump.</code></td></tr><tr><td><code class="filename">Installing rmt.</code></td><td><code class="filename">Installing linuxconf.</code></td><td><code class="filename">Installing tcsh.</code></td></tr><tr><td><code class="filename">Installing cpio.</code></td><td><code class="filename">Installing logrotate.</code></td><td><code class="filename">Installing time.</code></td></tr><tr><td><code class="filename">Installing cracklib.</code></td><td><code class="filename">Installing losetup.</code></td><td><code class="filename">Installing timeconfig.</code></td></tr><tr><td><code class="filename">Installing cracklib-dicts.</code></td><td><code class="filename">Installing lsof.</code></td><td><code class="filename">Installing tmpwatch.</code></td></tr><tr><td><code class="filename">Installing crontabs.</code></td><td><code class="filename">Installing mailcap.</code></td><td><code class="filename">Installing traceroute.</code></td></tr><tr><td><code class="filename">Installing textutils.</code></td><td><code class="filename">Installing mailx.</code></td><td><code class="filename">Installing utempter.</code></td></tr><tr><td><code class="filename">Installing dev.</code></td><td><code class="filename">Installing man.</code></td><td><code class="filename">Installing util-linux.</code></td></tr><tr><td><code class="filename">Installing diffutils.</code></td><td><code class="filename">Installing mingetty.</code></td><td><code class="filename">Installing vim-common.</code></td></tr><tr><td><code class="filename">Installing dump.</code></td><td><code class="filename">Installing mkbootdisk.</code></td><td><code class="filename">Installing vim-minimal.</code></td></tr><tr><td><code class="filename">Installing ed.</code></td><td><code class="filename">Installing mkinitrd.</code></td><td><code class="filename">Installing vixie-cron.</code></td></tr><tr><td><code class="filename">Installing eject.</code></td><td><code class="filename">Installing modutils.</code></td><td><code class="filename">Installing which.</code></td></tr><tr><td><code class="filename">Installing etcskel.</code></td><td><code class="filename">Installing mount.</code></td><td><code class="filename">Installing zlib.</code></td></tr><tr><td><code class="filename">Installing file.</code></td><td><code class="filename">Installing mouseconfig.</code></td><td> </td></tr><tr><td><code class="filename">Installing findutils.</code></td><td><code class="filename">Installing mt-st.</code></td><td> </td></tr></table><p>
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm2617"></a>5. Verify,Cross-check</h2></div></div></div><p>
           After we have uninstalled all the software that must be uninstalled after the installation of our Linux server see <a class="link" href="#ch3sc3.1-1" title="1. Software that must be uninstalled">Software that must be uninstalled</a>
           after installation of the Server and after the addition of the necessary <acronym class="acronym">RPM</acronym> packages, so that we will able to compile programs on our server,  we must verify 
           the list of all installed <acronym class="acronym">RPM</acronym> programs again but this time with the following command:
           </p><p>
           To verify the list of all installed <acronym class="acronym">RPM</acronym> package on your system, use the command:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>rpm</strong></span> -qa &gt; installed_rpm
           </pre><p>
           The <strong class="userinput"><code>-qa</code></strong> option will query all installed <acronym class="acronym">RPM</acronym> packages on your system and the symbol &gt; will redirect the output to the file 
           named <code class="filename">installed_rpm.</code>
           </p><p>
             </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
           The content of the <code class="filename">installed_rpm</code> file must match exactly this:
           </p><p>
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">setup-2.0.5-1</code></td><td><code class="filename">findutils-4.1-32</code></td><td><code class="filename">passwd-0.63-1</code></td></tr><tr><td><code class="filename">filesystem-1.3.5-1</code></td><td><code class="filename">gawk-3.0.4-1</code></td><td><code class="filename">perl-5.00503-6</code></td></tr><tr><td><code class="filename">basesystem-6.0-4</code></td><td><code class="filename">cdecl-2.5-9</code></td><td><code class="filename">flex-2.5.4a-7</code></td></tr><tr><td><code class="filename">ldconfig-1.9.5-15</code></td><td><code class="filename">gdbm-1.8.0-2</code></td><td><code class="filename">procps-2.0.4-2</code></td></tr><tr><td><code class="filename">glibc-2.1.2-11</code></td><td><code class="filename">glib-1.2.5-1</code></td><td><code class="filename">psmisc-18-3</code></td></tr><tr><td><code class="filename">shadow-utils-19990827-2</code></td><td><code class="filename">gmp-2.0.2-10</code></td><td><code class="filename">python-1.5.2-7</code></td></tr><tr><td><code class="filename">mktemp-1.5-1</code></td><td><code class="filename">cpp-1.1.2-24</code></td><td><code class="filename">quota-1.66-8</code></td></tr><tr><td><code class="filename">termcap-9.12.6-15</code></td><td><code class="filename">gpm-1.17.9-3</code></td><td><code class="filename">gdb-4.18-4</code></td></tr><tr><td><code class="filename">libtermcap-2.0.8-18</code></td><td><code class="filename">groff-1.11a-9</code></td><td><code class="filename">readline-2.2.1-5</code></td></tr><tr><td><code class="filename">bash-1.14.7-16</code></td><td><code class="filename">gzip-1.2.4-14</code></td><td><code class="filename">glibc-devel-2.1.2-11</code></td></tr><tr><td><code class="filename">MAKEDEV-2.5-2</code></td><td><code class="filename">initscripts-4.48-1</code></td><td><code class="filename">rootfiles-5.2-5</code></td></tr><tr><td><code class="filename">SysVinit-2.77-2</code></td><td><code class="filename">ipchains-1.3.9-3</code></td><td><code class="filename">rpm-3.0.3-2</code></td></tr><tr><td><code class="filename">chkconfig-1.0.7-2</code></td><td><code class="filename">cproto-4.6-2</code></td><td><code class="filename">sash-3.3-1</code></td></tr><tr><td><code class="filename">ncurses-4.2-25</code></td><td><code class="filename">ElectricFence-2.1-1</code></td><td><code class="filename">make-3.77-6</code></td></tr><tr><td><code class="filename">info-3.12h-2</code></td><td><code class="filename">kernel-2.2.12-20</code></td><td><code class="filename">shapecfg-2.2.12-2</code></td></tr><tr><td><code class="filename">fileutils-4.0-8</code></td><td><code class="filename">patch-2.5-9</code></td><td><code class="filename">slang-1.2.2-4</code></td></tr><tr><td><code class="filename">grep-2.3-2</code></td><td><code class="filename">ld.so-1.9.5-11</code></td><td><code class="filename">slocate-2.0-3</code></td></tr><tr><td><code class="filename">ash-0.2-18</code></td><td><code class="filename">less-340-1</code></td><td><code class="filename">stat-1.5-11</code></td></tr><tr><td><code class="filename">at-3.1.7-11</code></td><td><code class="filename">libc-5.3.12-31</code></td><td><code class="filename">sysklogd-1.3.31-12</code></td></tr><tr><td><code class="filename">m4-1.4-12</code></td><td><code class="filename">libstdc++-2.9.0-24</code></td><td><code class="filename">tar-1.13.11-1</code></td></tr><tr><td><code class="filename">bdflush-1.5-10</code></td><td><code class="filename">lilo-0.21-10</code></td><td><code class="filename">tcp_wrappers-7.6-9</code></td></tr><tr><td><code class="filename">binutils-2.9.1.0.23-6</code></td><td><code class="filename">pwdb-0.60-1</code></td><td><code class="filename">tcpdump-3.4-16</code></td></tr><tr><td><code class="filename">bzip2-0.9.5c-1</code></td><td><code class="filename">pam-0.68-7</code></td><td><code class="filename">tcsh-6.08.00-6</code></td></tr><tr><td><code class="filename">sed-3.02-4</code></td><td><code class="filename">sh-utils-2.0-1</code></td><td><code class="filename">time-1.7-9</code></td></tr><tr><td><code class="filename">console-tools-19990302-17</code></td><td><code class="filename">logrotate-3.3-1</code></td><td><code class="filename">timed-0.10-23</code></td></tr><tr><td><code class="filename">e2fsprogs-1.15-3</code></td><td><code class="filename">losetup-2.9u-4</code></td><td><code class="filename">tmpwatch-2.0-1</code></td></tr><tr><td><code class="filename">byacc-1.9-11</code></td><td><code class="filename">lsof-4.45-1</code></td><td><code class="filename">traceroute-1.4a5-16</code></td></tr><tr><td><code class="filename">cpio-2.4.2-13</code></td><td><code class="filename">mailx-8.1.1-9</code></td><td><code class="filename">utempter-0.5.1-2</code></td></tr><tr><td><code class="filename">cracklib-2.7-5</code></td><td><code class="filename">man-1.5g-6</code></td><td><code class="filename">util-linux-2.9w-24</code></td></tr><tr><td><code class="filename">cracklib-dicts-2.7-5</code></td><td><code class="filename">mingetty-0.9.4-10</code></td><td><code class="filename">vim-common-5.4-2</code></td></tr><tr><td><code class="filename">crontabs-1.7-7</code></td><td><code class="filename">mkbootdisk-1.2.2-1</code></td><td><code class="filename">vim-minimal-5.4-2</code></td></tr><tr><td><code class="filename">textutils-2.0-2</code></td><td><code class="filename">mkinitrd-2.3-1</code></td><td><code class="filename">vixie-cron-3.0.1-39</code></td></tr><tr><td><code class="filename">dev-2.7.10-2</code></td><td><code class="filename">modutils-2.1.121-14</code></td><td><code class="filename">which-2.8-1</code></td></tr><tr><td><code class="filename">diffutils-2.7-16</code></td><td><code class="filename">mount-2.9u-4</code></td><td><code class="filename">zlib-1.1.3-5</code></td></tr><tr><td><code class="filename">dump-0.4b4-11</code></td><td><code class="filename">ctags-3.2-1</code></td><td><code class="filename">dev86-0.14.9-1</code></td></tr><tr><td><code class="filename">ed-0.2-12</code></td><td><code class="filename">ncompress-4.2.4-14</code></td><td><code class="filename">egcs-1.1.2-24</code></td></tr><tr><td><code class="filename">bison-1.28-1</code></td><td><code class="filename">net-tools-1.53-1</code></td><td><code class="filename">kernel-headers-2.2.12-20</code></td></tr><tr><td><code class="filename">etcskel-2.0-1</code></td><td><code class="filename">netkit-base-0.10-37</code></td><td> </td></tr><tr><td><code class="filename">file-3.27-3</code></td><td><code class="filename">newt-0.50-13</code></td><td> </td></tr></table><p>
          </p><p>
            </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
          The content of the <code class="filename">installed_rpm </code> file must look exactly like this:
          </p><p>
          </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">setup-2.1.8-1</code></td><td><code class="filename">file-3.28-2</code></td><td><code class="filename">ncompress-4.2.4-15</code></td></tr><tr><td><code class="filename">filesystem-1.3.5-1</code></td><td><code class="filename">findutils-4.1-34</code></td><td><code class="filename">net-tools-1.54-4</code></td></tr><tr><td><code class="filename">basesystem-6.0-4</code></td><td><code class="filename">gawk-3.0.4-2</code></td><td><code class="filename">newt-0.50.8-2</code></td></tr><tr><td><code class="filename">ldconfig-1.9.5-16</code></td><td><code class="filename">patch-2.5-10</code></td><td><code class="filename">passwd-0.64.1-1</code></td></tr><tr><td><code class="filename">glibc-2.1.3-15</code></td><td><code class="filename">gdbm-1.8.0-3</code></td><td><code class="filename">perl-5.00503-10</code></td></tr><tr><td><code class="filename">shadow-utils-19990827-10</code></td><td><code class="filename">bison-1.28-2</code></td><td><code class="filename">popt-1.5-0.48</code></td></tr><tr><td><code class="filename">mktemp-1.5-2</code></td><td><code class="filename">glib-1.2.6-3</code></td><td><code class="filename">procmail-3.14-2</code></td></tr><tr><td><code class="filename">termcap-10.2.7-9</code></td><td><code class="filename">gmp-2.0.2-13</code></td><td><code class="filename">procps-2.0.6-5</code></td></tr><tr><td><code class="filename">libtermcap-2.0.8-20</code></td><td><code class="filename">gpm-1.18.1-7</code></td><td><code class="filename">psmisc-19-2</code></td></tr><tr><td><code class="filename">bash-1.14.7-22</code></td><td><code class="filename">groff-1.15-8</code></td><td><code class="filename">quota-2.00pre3-2</code></td></tr><tr><td><code class="filename">MAKEDEV-2.5.2-1</code></td><td><code class="filename">gzip-1.2.4a-2</code></td><td><code class="filename">gdb-4.18-11</code></td></tr><tr><td><code class="filename">SysVinit-2.78-5</code></td><td><code class="filename">inetd-0.16-4</code></td><td><code class="filename">readline-2.2.1-6</code></td></tr><tr><td><code class="filename">anacron-2.1-6</code></td><td><code class="filename">initscripts-5.00-1</code></td><td><code class="filename">make-3.78.1-4</code></td></tr><tr><td><code class="filename">chkconfig-1.1.2-1</code></td><td><code class="filename">ipchains-1.3.9-5</code></td><td><code class="filename">rootfiles-5.2-5</code></td></tr><tr><td><code class="filename">m4-1.4-12</code></td><td><code class="filename">iputils-20000121-2</code></td><td><code class="filename">rpm-3.0.4-0.48</code></td></tr><tr><td><code class="filename">ncurses-5.0-11</code></td><td><code class="filename">cpp-1.1.2-30</code></td><td><code class="filename">sash-3.4-2</code></td></tr><tr><td><code class="filename">info-4.0-5</code></td><td><code class="filename">cproto-4.6-3</code></td><td><code class="filename">shapecfg-2.2.12-2</code></td></tr><tr><td><code class="filename">fileutils-4.0-21</code></td><td><code class="filename">kernel-2.2.14-5.0</code></td><td><code class="filename">slang-1.2.2-5</code></td></tr><tr><td><code class="filename">grep-2.4-3</code></td><td><code class="filename">ctags-3.4-1</code></td><td><code class="filename">slocate-2.1-2</code></td></tr><tr><td><code class="filename">ash-0.2-20</code></td><td><code class="filename">kernel-utils-2.2.14-5.0</code></td><td><code class="filename">stat-1.5-12</code></td></tr><tr><td><code class="filename">at-3.1.7-14</code></td><td><code class="filename">ElectricFence-2.1-3</code></td><td><code class="filename">sysklogd-1.3.31-16</code></td></tr><tr><td><code class="filename">byacc-1.9-12</code></td><td><code class="filename">ld.so-1.9.5-13</code></td><td><code class="filename">tar-1.13.17-3</code></td></tr><tr><td><code class="filename">bc-1.05a-5</code></td><td><code class="filename">less-346-2</code></td><td><code class="filename">tcp_wrappers-7.6-10</code></td></tr><tr><td><code class="filename">bdflush-1.5-11</code></td><td><code class="filename">libc-5.3.12-31</code></td><td><code class="filename">tcpdump-3.4-19</code></td></tr><tr><td><code class="filename">binutils-2.9.5.0.22-6</code></td><td><code class="filename">libstdc++-2.9.0-30</code></td><td><code class="filename">tcsh-6.09-4</code></td></tr><tr><td><code class="filename">bzip2-0.9.5d-2</code></td><td><code class="filename">lilo-0.21-15</code></td><td><code class="filename">time-1.7-9</code></td></tr><tr><td><code class="filename">sed-3.02-6</code></td><td><code class="filename">pwdb-0.61-0</code></td><td><code class="filename">tmpwatch-2.2-1</code></td></tr><tr><td><code class="filename">console-tools-19990829-10</code></td><td><code class="filename">pam-0.72-6</code></td><td><code class="filename">traceroute-1.4a5-18</code></td></tr><tr><td><code class="filename">e2fsprogs-1.18-5</code></td><td><code class="filename">sh-utils-2.0-5</code></td><td><code class="filename">utempter-0.5.2-2</code></td></tr><tr><td><code class="filename">cpio-2.4.2-16</code></td><td><code class="filename">logrotate-3.3.2-1</code></td><td><code class="filename">util-linux-2.10f-7</code></td></tr><tr><td><code class="filename">cracklib-2.7-5</code></td><td><code class="filename">losetup-2.10f-1</code></td><td><code class="filename">vim-common-5.6-11</code></td></tr><tr><td><code class="filename">cracklib-dicts-2.7-5</code></td><td><code class="filename">lsof-4.47-2</code></td><td><code class="filename">vim-minimal-5.6-11</code></td></tr><tr><td><code class="filename">crontabs-1.7-7</code></td><td><code class="filename">mailx-8.1.1-10</code></td><td><code class="filename">vixie-cron-3.0.1-40</code></td></tr><tr><td><code class="filename">textutils-2.0a-2</code></td><td><code class="filename">man-1.5h1-1</code></td><td><code class="filename">which-2.9-2</code></td></tr><tr><td><code class="filename">dev-2.7.18-3</code></td><td><code class="filename">mingetty-0.9.4-11</code></td><td><code class="filename">zlib-1.1.3-6</code></td></tr><tr><td><code class="filename">diffutils-2.7-17</code></td><td><code class="filename">mkbootdisk-1.2.5-3</code></td><td><code class="filename">dev86-0.15.0-2</code></td></tr><tr><td><code class="filename">dump-0.4b15-1</code></td><td><code class="filename">mkinitrd-2.4.1-2</code></td><td><code class="filename">egcs-1.1.2-30</code></td></tr><tr><td><code class="filename">ed-0.2-13</code></td><td><code class="filename">modutils-2.3.9-6</code></td><td><code class="filename">kernel-headers-2.2.14-5.0</code></td></tr><tr><td><code class="filename">cdecl-2.5-10</code></td><td><code class="filename">mount-2.10f-1</code></td><td><code class="filename">glibc-devel-2.1.3-15</code></td></tr><tr><td><code class="filename">etcskel-2.3-1</code></td><td><code class="filename">flex-2.5.4a-9</code></td><td> </td></tr></table><p>
            </p><p>
            This step is required to make sure we have not forgotten to remove some unnecessary RPM or to add some important packages that permit us to compile programs on the system. If the result looks as our <code class="filename">installed_rpm</code> file above, 
            we are ready to play with our new Linux server.
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3118"></a>6. some colors for a change</h2></div></div></div><p>
         Putting some colors on your terminal can help you to distinguish folders, files, archives, devices, symbolic links and executable file from others. My opinion is that colors help to make less errors and fast navigation on your 
         system. It's important to note that this hack is necessary only for Red Hat Linux version 6.1 (Cartman) and older, since the new Red Hat Linux version 6.2 (Zoot) now enables and includes this feature by default.
         Edit the profile file vi <code class="filename">/etc/profile</code> and add the following lines:
         </p><p>
          </p><pre class="programlisting">
         # Enable Colour ls
         eval `dircolors /etc/DIR_COLORS -b`
         export LS_OPTIONS='-s -F -T 0 --color=yes'
         </pre><p>

         Edit the <code class="filename">bashrc</code> file <strong class="userinput"><code>vi /etc/bashrc</code></strong> and add the line:
         </p><pre class="screen">
         <strong class="userinput"><code>alias ls='ls --color=auto' </code></strong>
         </pre><p>
         Then log in and out. The new <code class="envar">COLORS</code>-environment variable should now be set, and your system will recognize that.

         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         Remember that this feature is only required for Red Hat Linux version 6.1 and older.
         </p></div><p>
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prt2ch3sc7uls"></a>7. Update of the latest software</h2></div></div></div><p>
         Keep and update all software especially network software up to date with the latest versions. Check the errata pages for the Red Hat Linux distribution, available at <a class="link" href="#prtinxfp4" title="Creating the Boot Disk and Booting">www.redhat.com/corp/support/errata/index.html</a>. 
         The errata pages are perhaps the best resource for fixing 90% of the common problems with Red Hat Linux. In addition, security holes for which a solution exists are generally on the errata page 24 hours after Red Hat has been notified. You should always check there first. Software that 
         must be updated at this time for your Red Hat Linux server are:
         </p><p>
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">
         groff-1_15-1_i386.rpm
         </code>
         </td><td><code class="filename">
         pam-0_68-10_i386.rpm
         </code>
         </td></tr><tr><td><code class="filename">
         sysklogd-1_3_31-14_i386.rpm
         </code>
         </td><td><code class="filename">
         gpm-1.19.1-1.i386.rpm
         </code>
         </td></tr><tr><td><code class="filename">
         initscripts-4_70-1_i386.rpm
         </code>
         </td><td><code class="filename">
         Linux kernel 2.2.14 -linux-2_2_14_tar.gz
         </code>
         </td></tr><tr><td><code class="filename">
         e2fsprogs-1.17-1.i386.rpm
         </code>
         </td><td>
           <code class="filename">
         gpm-1.19.1-1.i386.rpm
         </code>
         </td></tr></table><p>
         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
        The Linux kernel is the most important, and always must be updated. See below for more information on building a custom kernel for your specific system.
        </p></div><p>
         You can verify that the RPM software above is installed on your system before make an update with the following command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>rpm</strong></span> -q &lt;softwarename&gt;
         </pre><p>
         Where <code class="filename">&lt;softwarename&gt;</code> is the name of the software you want to verify like groff, sysklogd, etc.
        </p></div></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="idm3171"></a>Part 3. Security, Optimization and Upgrade</h1></div></div></div><div class="partintro"><div></div><div class="mediaobject" align="center"><img src="./resources/Annimals/Chapter15.gif" align="middle" alt="Bat"></div><div class="abstract"><p class="title"><b>Abstract</b></p><p>Now that we have installed a base system, the next three chapters will concentrate on 
               </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: opencircle; "><li class="listitem" style="list-style-type: circle"><p>
             How to tighten the security of our configured system.
             </p></li><li class="listitem" style="list-style-type: circle"><p>
             Optimise our sytem to perform at its peak.
             </p></li><li class="listitem" style="list-style-type: circle"><p>
             Upgrade our machine for the latest kernel.
             </p></li></ul></div><p>
             Please note when we talk of tightening the security we are referring to the features available within the base installed system and not to any new additional software. We will talk about that later 
             in this book.</p></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="chapter"><a href="#prt2ch1gss">5. General System Security</a></span></dt><dd><dl><dt><span class="section"><a href="#idm3193">1. BIOS</a></span></dt><dt><span class="section"><a href="#idm3200">2. Security as a Policy</a></span></dt><dt><span class="section"><a href="#idm3220">3. Choose a right Password</a></span></dt><dt><span class="section"><a href="#idm3244">4. The root account</a></span></dt><dt><span class="section"><a href="#idm3264">5. The <code class="filename">/etc/exports</code> file</a></span></dt><dt><span class="section"><a href="#p2ch1sct16">6. Disable console program access</a></span></dt><dt><span class="section"><a href="#idm3330">7. Disable all console access</a></span></dt><dt><span class="section"><a href="#idm3345">8. The inetd - <code class="filename">/etc/inetd.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm3395">9. TCP_WRAPPERS</a></span></dt><dd><dl><dt><span class="section"><a href="#idm3454">9.1. Don't display system issue file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm3460">10. The <code class="filename">/etc/host.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm3491">11. The /etc/services file</a></span></dt><dt><span class="section"><a href="#idm3503">12. The <code class="filename">/etc/securetty</code> file</a></span></dt><dt><span class="section"><a href="#idm3516">13. Special accounts</a></span></dt><dt><span class="section"><a href="#idm3602">14. Blocking; <span class="command"><strong>su</strong></span> to root, by one and sundry</a></span></dt><dt><span class="section"><a href="#idm3636">15. Put limits on resource</a></span></dt><dt><span class="section"><a href="#idm3663">16. Control mounting a file system</a></span></dt><dt><span class="section"><a href="#idm3724">17. Conceal binary <acronym class="acronym">RPM</acronym> </a></span></dt><dt><span class="section"><a href="#idm3744">18. Shell logging</a></span></dt><dt><span class="section"><a href="#idm3778">19. The LILO and <code class="filename">lilo.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm3836">20. Disable <span class="keycap"><strong>Ctrl-Alt-Delete</strong></span> keyboard shutdown command</a></span></dt><dt><span class="section"><a href="#idm3848">21. 
            Physical hard copies of all-important logs
              </a></span></dt><dt><span class="section"><a href="#idm3933">22. Tighten scripts under <code class="filename">/etc/rc.d/</code></a></span></dt><dd><dl><dt><span class="section"><a href="#idm3948">22.1. The <code class="filename">/etc/rc.d/rc.local</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm3975">23. 
            Bits from root-owned programs
              </a></span></dt><dt><span class="section"><a href="#idm4022">24. 
            The kernel tunable parameters</a></span></dt><dd><dl><dt><span class="section"><a href="#idm4027">24.1. Prevent your system responding to Ping</a></span></dt></dl></dd><dt><span class="section"><a href="#idm4050">25. Refuse responding to broadcasts request</a></span></dt><dt><span class="section"><a href="#idm4077">26. Routing Protocols</a></span></dt><dt><span class="section"><a href="#idm4104">27. Enable TCP SYN Cookie Protection</a></span></dt><dt><span class="section"><a href="#idm4131">28. Disable ICMP Redirect Acceptance</a></span></dt><dt><span class="section"><a href="#idm4153">29. Enable always-defragging Protection</a></span></dt><dt><span class="section"><a href="#idm4175">30. Enable bad error message Protection</a></span></dt><dt><span class="section"><a href="#idm4196">31. Enable <acronym class="acronym">IP</acronym> spoofing protection</a></span></dt><dt><span class="section"><a href="#idm4222">32. Log Spoofed, Source Routed and Redirect Packets</a></span></dt><dt><span class="section"><a href="#idm4243">33. Unusual or hidden files</a></span></dt><dt><span class="section"><a href="#idm4325">34. System is compromised !</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr3ch6lglc">6. Linux General Optimization</a></span></dt><dd><dl><dt><span class="section"><a href="#idm4340">1. The /etc/profile file</a></span></dt><dt><span class="section"><a href="#prt3ch2sc2br">2. Benchmark Results</a></span></dt><dt><span class="section"><a href="#idm4486">3. Benchmark results-i586</a></span></dt><dt><span class="section"><a href="#idm4501">4. Benchmark results -i486
               </a></span></dt><dt><span class="section"><a href="#idm4516">5. The bdflush parameters</a></span></dt><dt><span class="section"><a href="#idm4592">6. The buffermem parameters</a></span></dt><dt><span class="section"><a href="#idm4644">7. The ip_local_port_range parameters</a></span></dt><dt><span class="section"><a href="#idm4674">8. The <code class="filename">/etc/nsswitch.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm4692">9. 
          The file-max parameter
            </a></span></dt><dt><span class="section"><a href="#idm4733">10. The ulimit parameter</a></span></dt><dt><span class="section"><a href="#pr2ch6scntm">11. The atime and noatime attribute</a></span></dt><dt><span class="section"><a href="#idm4832">12. Tuning <acronym class="acronym">IDE</acronym> Hard Disk Performance</a></span></dt><dt><span class="section"><a href="#idm4895">13. Better manage your <acronym class="acronym">TCP/IP</acronym> resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr3ch7lnke">7. Configuring and Building a Secure, Optimized Kernel</a></span></dt><dd><dl><dt><span class="section"><a href="#prt3ch3sc1pi">1. Pre-Install</a></span></dt><dd><dl><dt><span class="section"><a href="#idm5018">1.1. Make an emergency boot floppy</a></span></dt></dl></dd><dt><span class="section"><a href="#idm5045">2.  Uninstallation and Optimization</a></span></dt><dt><span class="section"><a href="#idm5155">3. Securing the kernel</a></span></dt><dt><span class="section"><a href="#idm5235">4. Compilation</a></span></dt><dt><span class="section"><a href="#prt2sct35kcon">5. Kernel configuration -Part "A"</a></span></dt><dt><span class="section"><a href="#idm5390">6. Kernel configuration -Part "B"</a></span></dt><dt><span class="section"><a href="#idm5471">7. Kernel configuration -Part "C"</a></span></dt><dt><span class="section"><a href="#idm5538">8. Kernel configuration -Part "D"</a></span></dt><dt><span class="section"><a href="#idm5590">9. Kernel configuration -Part "E"</a></span></dt><dt><span class="section"><a href="#idm5643">10. Installing the new kernel</a></span></dt><dt><span class="section"><a href="#idm5761">11. Delete programs, Edit files pertaining to modules</a></span></dt><dt><span class="section"><a href="#idm5828">12. Create a emergency Rescue and Boot floppy disk</a></span></dt></dl></dd></dl></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="prt2ch1gss"></a>Chapter 5. General System Security</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm3193">1. BIOS</a></span></dt><dt><span class="section"><a href="#idm3200">2. Security as a Policy</a></span></dt><dt><span class="section"><a href="#idm3220">3. Choose a right Password</a></span></dt><dt><span class="section"><a href="#idm3244">4. The root account</a></span></dt><dt><span class="section"><a href="#idm3264">5. The <code class="filename">/etc/exports</code> file</a></span></dt><dt><span class="section"><a href="#p2ch1sct16">6. Disable console program access</a></span></dt><dt><span class="section"><a href="#idm3330">7. Disable all console access</a></span></dt><dt><span class="section"><a href="#idm3345">8. The inetd - <code class="filename">/etc/inetd.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm3395">9. TCP_WRAPPERS</a></span></dt><dd><dl><dt><span class="section"><a href="#idm3454">9.1. Don't display system issue file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm3460">10. The <code class="filename">/etc/host.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm3491">11. The /etc/services file</a></span></dt><dt><span class="section"><a href="#idm3503">12. The <code class="filename">/etc/securetty</code> file</a></span></dt><dt><span class="section"><a href="#idm3516">13. Special accounts</a></span></dt><dt><span class="section"><a href="#idm3602">14. Blocking; <span class="command"><strong>su</strong></span> to root, by one and sundry</a></span></dt><dt><span class="section"><a href="#idm3636">15. Put limits on resource</a></span></dt><dt><span class="section"><a href="#idm3663">16. Control mounting a file system</a></span></dt><dt><span class="section"><a href="#idm3724">17. Conceal binary <acronym class="acronym">RPM</acronym> </a></span></dt><dt><span class="section"><a href="#idm3744">18. Shell logging</a></span></dt><dt><span class="section"><a href="#idm3778">19. The LILO and <code class="filename">lilo.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm3836">20. Disable <span class="keycap"><strong>Ctrl-Alt-Delete</strong></span> keyboard shutdown command</a></span></dt><dt><span class="section"><a href="#idm3848">21. 
            Physical hard copies of all-important logs
              </a></span></dt><dt><span class="section"><a href="#idm3933">22. Tighten scripts under <code class="filename">/etc/rc.d/</code></a></span></dt><dd><dl><dt><span class="section"><a href="#idm3948">22.1. The <code class="filename">/etc/rc.d/rc.local</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm3975">23. 
            Bits from root-owned programs
              </a></span></dt><dt><span class="section"><a href="#idm4022">24. 
            The kernel tunable parameters</a></span></dt><dd><dl><dt><span class="section"><a href="#idm4027">24.1. Prevent your system responding to Ping</a></span></dt></dl></dd><dt><span class="section"><a href="#idm4050">25. Refuse responding to broadcasts request</a></span></dt><dt><span class="section"><a href="#idm4077">26. Routing Protocols</a></span></dt><dt><span class="section"><a href="#idm4104">27. Enable TCP SYN Cookie Protection</a></span></dt><dt><span class="section"><a href="#idm4131">28. Disable ICMP Redirect Acceptance</a></span></dt><dt><span class="section"><a href="#idm4153">29. Enable always-defragging Protection</a></span></dt><dt><span class="section"><a href="#idm4175">30. Enable bad error message Protection</a></span></dt><dt><span class="section"><a href="#idm4196">31. Enable <acronym class="acronym">IP</acronym> spoofing protection</a></span></dt><dt><span class="section"><a href="#idm4222">32. Log Spoofed, Source Routed and Redirect Packets</a></span></dt><dt><span class="section"><a href="#idm4243">33. Unusual or hidden files</a></span></dt><dt><span class="section"><a href="#idm4325">34. System is compromised !</a></span></dt></dl></div><div class="highlights"><p>
             A secure Linux server depends on how the administrator configures it to be. Once we have eliminated the potential securities risk by removing <acronym class="acronym">RPM</acronym> 
             services not needed, we can start to secure our existing services and software on our server. In this chapter we will discuss some of the more general, basic techniques used 
             to secure your system. The following is a list of features that can be used to help prevent attacks from external and internal sources.
                </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3193"></a>1. BIOS</h2></div></div></div><p>
              It is recommended that you set a Boot password  to disallow booting from floppy drives and set passwords on <acronym class="acronym">BIOS</acronym> features. You can check 
              your <acronym class="acronym">BIOS</acronym> manual or look it over thoroughly the next time you boot up your system to know how to do this. Disallowing the possibility to 
              boot from floppy drives and being able to set a password to access the <acronym class="acronym">BIOS</acronym> features will improve the security of your system. This will 
              block undesired people from trying to boot your Linux system with a special boot disk and will protect you from people trying to change <acronym class="acronym">BIOS</acronym> 
              feature like allowing boot from floppy drive or booting the server without prompt password.
              </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3200"></a>2. Security as a Policy</h2></div></div></div><p>
              It is important to point out that you cannot implement security if you have not decided what needs to be protected, and from whom. You need a security policy; a kind of 
              list of what you consider allowable and not allowable, upon which to base any decisions regarding security. The policy should also determine your 
              response to security violations. What you should consider while compiling a security policy will depend entirely on your definition of security. The answers to the 
              following questions should provide some general guidelines:
             </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: dash; "><li class="listitem" style="list-style-type: dash"><p>
              How do you classify confidential or sensitive information?
             </p></li><li class="listitem" style="list-style-type: dash"><p>
              Does the system contain confidential or sensitive information?
             </p></li><li class="listitem" style="list-style-type: dash"><p>
              Exactly whom do you want to guard against?
             </p></li><li class="listitem" style="list-style-type: dash"><p>
              Do remote users really need access to your system?
             </p></li><li class="listitem" style="list-style-type: dash"><p>
              Do passwords or encryption provide enough protection?
             </p></li><li class="listitem" style="list-style-type: dash"><p>
              Do you need access to the Internet?
             </p></li><li class="listitem" style="list-style-type: dash"><p>
              How much access do you want to allow to your system from the Internet?
             </p></li><li class="listitem" style="list-style-type: dash"><p>
              What action will you take if you discover a breach in your security?
             </p></li></ul></div><p>

              This list is not very comprehensive, and your policy will probably encompass a lot more before it is completed. Any security policy must be based on some degree of paranoia; deciding 
              how much you trust people, both inside and outside your organization. The policy must, however, provide a balance between allowing your users reasonable access to the 
              information they require to do their work and totally disallowing access to your information. The point where this line is drawn will determine your policy.
              </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3220"></a>3. Choose a right Password</h2></div></div></div><p>
              The starting point of our Linux General Security tour is the password. Many people keep their valuable information and files on a computer, and the only thing preventing others from seeing 
              it is the eight-character string called a password. An unbreakable password, contrary to popular belief, does not exist. Given time and resources all passwords can be guessed either by social 
              engineering or by brute force.
              </p><p>
              Social engineering of server passwords and other access methods are still the easiest and most popular way to gain access to accounts and servers. Often, something as simple as acting as a 
              superior or executive in a company and yelling at the right person at the right time of the day yields terrific results.
              </p><p>
              Running a password cracker on a weekly basis on your system is a good idea. This helps to find and replace passwords that are easily guessed or weak. Also, a password checking mechanism 
              should be present to reject a weak password when first choosing a password or changing an old one. Character strings that are plain dictionary words, or are all in the same case, or do not 
              contain numbers or special characters should not be accepted as a new password.
              We recommend the following rules to make passwords effective:
              </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: dash; "><li class="listitem" style="list-style-type: dash"><p>                                                                           
              They should be at least six characters in length, preferably eight characters including at least one numeral or special character.
              </p></li><li class="listitem" style="list-style-type: dash"><p>
              They must not be trivial; a trivial password is one that is easy to guess and is usually based on the user's name, family, occupation or some other personal characteristic.
              </p></li><li class="listitem" style="list-style-type: dash"><p> 
              They should have an aging period, requiring a new password to be chosen within a specific time frame.
              </p></li><li class="listitem" style="list-style-type: dash"><p>
              They should be revoked and reset after a limited number of concurrent incorrect retries.
              </p></li></ul></div><p>
            </p><p>
            The minimum acceptable password length by default when you install your Linux system is 5. This mean that when a new user is allowed to have a access on the server, his/her password 
            length will be at minimum 5 mixes of character strings, letter, number, special character etc.  
            This is not enough and must be 8. 
            </p><p>
            To prevent non-security-minded people or administrators from being able to enter just 5 characters for the valuable password, edit the rather 
            important <code class="filename">/etc/login.defs</code> file and change the value of 5 to 8.
            Edit the <code class="filename">login.defs</code> file vi <code class="filename">/etc/login.defs</code> and change the line that read:
           </p><pre class="literallayout"><code class="computeroutput">
            PASS_MIN_LEN    5
            </code></pre><p>
            To read:
            </p><pre class="literallayout"><code class="computeroutput">
            PASS_MIN_LEN    8
            </code></pre><p>
            The <code class="filename">login.defs</code> is the configuration file for the login program. You should review or make changes to this file for your particular system. This is where you set 
            other security policy settings like password expiration defaults or minimum acceptable password length.
               </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3244"></a>4. The root account</h2></div></div></div><p>
            The <span class="emphasis"><em>root</em></span> account is the most privileged account on a Unix system. The <span class="emphasis"><em>root</em></span> account has no security restrictions imposed upon it. This means the 
            system assumes you know what you are doing, and will do exactly what you request -- <span class="emphasis"><em>no questions asked</em></span>. Therefore it is easy, with a mistyped command, to wipe out crucial system files. When 
            using this account it is important to be as careful as possible. For security reasons, never log in on your server as <span class="emphasis"><em>root</em></span> unless it is absolutely an instance that 
            necessitates root access. Also, if you are not on your server, never sign in and leave yourself on as <span class="emphasis"><em>root</em></span> <span class="emphasis"><em>--this is Very, Very, Very BAD practice</em></span>.
            </p><p>
            <span class="emphasis"><em>Set login time out for the root account</em></span>. Despite the notice to never, if they are not on the server sign in as <span class="emphasis"><em>root</em></span> and leave it unattended, administrators 
            still stay on as <span class="emphasis"><em>root</em></span> or forget to logout after finishing their work and leave their terminals unattended. The answer to solve this problem is to make the bash shell automatically 
            logout after not being used for a period of time. To do that, you must set the special variable of Linux named <code class="envar">TMOUT</code> to the time in seconds of no input before logout.
            Edit your profile file <code class="filename"> /etc/profile</code> and add the following line somewhere after the line that read <code class="envar">HISTFILESIZE=</code> on this file:
            </p><pre class="screen">
            TMOUT=7200
            </pre><p>
            The value we enter for the variable <code class="envar">TMOUT=</code> is in second and represent 2 hours (60 * 60 = 3600 * 2 = 7200 seconds). It is important to note that if you decide to put the above line 
            in your <code class="filename">/etc/profile</code> file, then the automatic logout after two hours of inactivity will apply for all users on the system. So, instead, if your prefer to control which users will be automatically 
            logged out and which ones not, you can set this variable in their individual <code class="filename">.bashrc</code>  file.
            After this parameter has been set on your system, you must logout and login again as root for the change to take effect.
            </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3264"></a>5. The <code class="filename">/etc/exports</code> file</h2></div></div></div><p>
            If you are exporting file systems using <acronym class="acronym">NFS</acronym> service, be sure to configure the <code class="filename">/etc/exports</code> file with the most restrictive access possible. This means not using wildcards, not allowing root write access, and mounting read-only wherever possible.
            </p><div class="example"><a name="idm3270"></a><p class="title"><b>Example 5.1. Export file systems using <acronym class="acronym">NFS</acronym></b></p><div class="example-contents"><p>
            Edit the exports file vi <code class="filename">/etc/exports</code> and add:
            </p><pre class="programlisting">
            /dir/to/export host1.mydomain.com(ro,root_squash)
            /dir/to/export host2.mydomain.com(ro,root_squash)
            </pre><p>
             Where:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: opencircle; "><li class="listitem" style="list-style-type: circle"><p>
            <code class="filename">/dir/to/export</code> is the directory you want to export.
            </p></li><li class="listitem" style="list-style-type: circle"><p>
            <code class="literal">host<code class="prompt">#</code>.mydomain.com</code> is the machine allowed to log in this directory.
            </p></li><li class="listitem" style="list-style-type: circle"><p>
            The <code class="literal">ro</code> option mean mounting read-only. 
            </p></li><li class="listitem" style="list-style-type: circle"><p>
            The <code class="literal">root_squash</code> option for not allowing root write access in this directory.
            </p></li></ul></div><p>
             </p></div></div><p><br class="example-break">
            For this change to take effect you will need to run the following command on your terminal:
            </p><pre class="screen">
            [root@deep]# /usr/sbin/exportfs -a
            </pre><p>
              </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
            Please be aware that having an <acronym class="acronym">NFS</acronym> service available on your system can be a security risk. Personally, I don't recommend using it.
            </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="p2ch1sct16"></a>6. Disable console program access</h2></div></div></div><p>
             In a safe environment where we are sure that console is secured because passwords for BIOS and LILO are set and all physical power and reset switches on the system are disabled it may be advantageous to entirely disable all 
             console-equivalent access to programs like shutdown, reboot, and halt for regular users on your server.
             To do this, run the following command:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>rm</strong></span> -f /etc/security/console.apps/&lt;servicename&gt;
             </pre><p>
             Where &lt;servicename&gt; is the name of the program to which you wish to disable console-equivalent access. Unless you use xdm, however, be careful not to remove the xserver file or no one but root will be able to start the <code class="literal">X server</code>. 
             If you always use xdm to start the <code class="literal">X server</code>, root is the only user that needs to start X, in which case you might actually want to remove the xserver file.
             </p><div class="example"><a name="idm3307"></a><p class="title"><b>Example 5.2. Disable console-equivalent access</b></p><div class="example-contents"><p>
                 </p><pre class="screen">             
             [root@deep] /# <span class="command"><strong>rm</strong></span> -f  /etc/security/console.apps/halt
             [root@deep] /# <span class="command"><strong>rm</strong></span> -f  /etc/security/console.apps/poweroff
             [root@deep] /# <span class="command"><strong>rm</strong></span> -f  /etc/security/console.apps/reboot
             [root@deep] /# <span class="command"><strong>rm</strong></span> -f  /etc/security/console.apps/shutdown
             [root@deep] /# <span class="command"><strong>rm</strong></span> -f  /etc/security/console.apps/xserver   <a name="prt2c012sc15"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span> 
             </pre><p>
             </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#prt2c012sc15"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
             if removed, root will be the only user able to start <code class="literal">X</code>.
             </p></td></tr></table></div><p>
             This will disable console-equivalent access to programs halt, poweroff, reboot, and shutdown. Once again, the program xserver apply only is you are installed the Xwindow interface on your system.
             </p></div></div><br class="example-break"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
             If you are following our setup installation, the Xwindow interface is not installed on your server and all the files described above will not appear in the <code class="filename">/etc/security</code> directory, so 
             can safely ignore the above steps.
            </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3330"></a>7. Disable all console access</h2></div></div></div><p>
               The Linux-PAM library installed by default on your system allows the system administrator to choose how applications authenticate users, such as for console access, program and file access. In order to disable all these accesses for the 
               users, you must comment out all lines that refer to <code class="filename">pam_console.so</code> in the <code class="filename">/etc/pam.d/</code> directory. This step is a continuation of the above hack <a class="link" href="#p2ch1sct16" title="6. Disable console program access"> Disable console program access.</a>
               The following script will do the trick automatically for you. As root creates the <code class="filename">disabling.sh</code> script file, <span class="command"><strong>touch</strong></span> <code class="filename">disabling.sh</code> and add the following lines inside:
               </p><pre class="programlisting">
               # !/bin/sh
               cd /etc/pam.d
               for i in * ; do
               sed '/[^#].*pam_console.so/s/^/#/' &lt; $i &gt; foo &amp;&amp; mv foo $i
               done
               </pre><p>               
               Make this script executable with the following command and execute it:
               </p><pre class="screen">
               [root@deep] /# <span class="command"><strong>chmod</strong></span>  700  disabling.sh
               [root@deep] /# <span class="command"><strong>./disabling.sh</strong></span>
               </pre><p>
               This will comment out all lines that refer to <code class="filename">pam_console.so</code> for all files located under <code class="filename">/etc/pam.d</code> directory. Once the script has been executed, you can remove it from your system.
               
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3345"></a>8. The inetd - <code class="filename">/etc/inetd.conf</code> file</h2></div></div></div><p>
             inetd, called also the <span class="emphasis"><em>super server</em></span>, will load a network program based upon a request from the network. The <code class="filename">inetd.conf</code> file tells inetd which ports to listen to and what server to start for each port. 
             </p><p>
             The first thing to look at as soon as you put your Linux system on ANY network is what services you need to offer. Services that you do not need to offer should be disabled and uninstalled so that you have one less thing to worry about, and 
             attackers have one less place to look for a hole. Look at your <code class="filename">/etc/inetd.conf</code> file to see what services are being offered by your inetd program. Disable what you do not need by commenting them out by adding a <code class="prompt">#</code> at 
             the beginning of the line, and then sending your inetd process a <span class="command"><strong>SIGHUP</strong></span> command to update it to the current <code class="filename">inetd.conf</code> file.
               </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
             Change the permissions on this file to 600.
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>chmod</strong></span> 600  /etc/inetd.conf
             </pre><p>
             </p></li><li class="step"><p>
             Ensure that the owner is root.
             </p><pre class="screen">
             [root@deep] /# <span class="command"><strong>stat</strong></span> /etc/inetd.conf
             </pre><p>
             </p><pre class="literallayout"><code class="computeroutput">
             File: "/etc/inetd.conf"
             Size: 2869         Filetype: Regular File
             Mode: (0600/-rw-------)         Uid: (    0/    root)  Gid: (    0/    root)
             Device:  8,6   Inode: 18219     Links: 1    
             Access:	Wed	Sep	22	16:24:16	1999(00000.00:10:44)
             Modify:	Mon	Sep	20	10:22:44	1999(00002.06:12:16)
             Change:	Mon	Sep	20	10:22:44	1999(00002.06:12:16)
             </code></pre><p>
             </p></li><li class="step"><p>
             Edit the <code class="filename">inetd.conf</code> file vi <code class="filename">/etc/inetd.conf</code> and disable services like: ftp, telnet, shell, login, exec, talk, ntalk, imap, pop-2, pop-3, finger, 
             auth, etc. unless you plan to use it. If it's turned off, it's much less of a risk.
             </p><pre class="programlisting">
             # To re-read this file after changes, just do a 'killall -HUP inetd'
             #
             #echo	stream	tcp	nowait	root	internal
             #echo	dgram	udp	wait	root	internal
             #discard	stream	tcp	nowait	root	internal
             #discard	dgram	udp	wait	root	internal
             #daytime	stream	tcp	nowait	root	internal
             #daytime	dgram	udp	wait	root	internal
             #chargen	stream	tcp	nowait	root	internal
             #chargen	dgram	udp	wait	root	internal
             #time	stream	tcp	nowait	root	internal
             #time	dgram	udp	wait	root	internal
             #
             # These are standard services.
             #
             #ftp	stream	tcp	nowait	root	/usr/sbin/tcpd	in.ftpd -l -a
             #telnet 	stream	tcp	nowait	root	/usr/sbin/tcpd	in.telnetd
             #
             # Shell, login, exec, comsat and talk are BSD protocols.
             #
             #shell	stream	tcp	nowait	root	/usr/sbin/tcpd	in.rshd
             #login	stream	tcp	nowait	root	/usr/sbin/tcpd	in.rlogind
             #exec	stream	tcp	nowait	root	/usr/sbin/tcpd	in.rexecd
             #comsat	dgram	udp	wait	root	/usr/sbin/tcpd	in.comsat
             #talk	dgram	udp	wait	root	/usr/sbin/tcpd	in.talkd
             #ntalk	dgram	udp	wait	root	/usr/sbin/tcpd	in.ntalkd
             #dtalk 	stream	tcp	wait	nobody	/usr/sbin/tcpd	in.dtalkd
             #
             # Pop and imap mail services et al
             #
             #pop-2	stream	tcp	nowait	root	/usr/sbin/tcpd	ipop2d
             #pop-3	stream	tcp	nowait	root	/usr/sbin/tcpd	ipop3d
             #imap	stream	tcp	nowait	root	/usr/sbin/tcpd	imapd
             #
             # The Internet UUCP service.
             #
             #uucp	stream	tcp	nowait	uucp	/usr/sbin/tcpd  /usr/lib/uucp/uucico    -l
             #
             # Tftp service is provided primarily for booting.  Most sites
             # run this only on machines acting as "boot servers." Do not uncomment
             # this unless you *need* it.  
             #
             #tftp	dgram	udp	wait	root	/usr/sbin/tcpd	in.tftpd
             #bootps	dgram	udp	wait	root	/usr/sbin/tcpd	bootpd
             #
             # Finger, systat and netstat give out user information which may be
             # valuable to potential "system crackers."  Many sites choose to disable 
             # some or all of these services to improve security.
             #
             #finger	stream	tcp	nowait	root	/usr/sbin/tcpd	in.fingerd
             #cfinger	stream	tcp	nowait	root	/usr/sbin/tcpd	in.cfingerd
             #systat	stream	tcp	nowait	guest	/usr/sbin/tcpd	/bin/ps -auwwx
             #netstat	stream	tcp	nowait	guest	/usr/sbin/tcpd	/bin/netstat    -f inet
             #
             # Authentication
             #
             #auth	stream	tcp	nowait	nobody	/usr/sbin/in.identd    in.identd -l -e -o
             #
             # End of inetd.conf
             </pre><p>
             </p></li><li class="step"><p>
           </p><pre class="screen">
             [root@deep] /# <span class="command"><strong>killall</strong></span>  -HUP inetd
           </pre><p>
           </p></li><li class="step"><p>
             One more security measure you can take to secure the <code class="filename">inetd.conf</code> file is to set it immutable, using the chattr command.
             To set the file immutable simply, execute the following command:
             </p><pre class="screen">
             [root@deep] /# <span class="command"><strong>chattr</strong></span>  +i /etc/inetd.conf
             </pre><p>
             This will prevent any changes accidental or otherwise to the <code class="filename">inetd.conf</code> file. A file with the immutable attribute set i cannot be modified, 
             deleted or renamed, no link can be created to this file and no data can be written to it. The only person that can set or clear this attribute 
             is the super-user root. If you wish later to modify the inetd.conf file you will need to unset the immutable flag:
             To unset the immutable flag, simply execute the following command:
             </p><pre class="screen">
             [root@deep] /# <span class="command"><strong>chattr</strong></span> -i /etc/inetd.conf
             </pre><p>
             </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span>               
               </h3><p>
             Don't forget to send your inetd process a <span class="command"><strong>SIGHUP</strong></span> signal <strong class="userinput"><code>killall -HUP inetd</code></strong> after making change to your <code class="filename">inetd.conf</code> file. The services you enable on a selected 
             host depend on the functions you want the host to provide. Functions could support the selected network service, other services hosted on this computer, or development and maintenance 
             of the operating system and applications.
             </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3395"></a>9. TCP_WRAPPERS</h2></div></div></div><p>
             By default Red Hat Linux allows all service requests. Using TCP_WRAPPERS makes securing your servers against outside intrusion is a lot simpler and painless then you would expect. Deny all hosts by 
             putting <code class="envar">ALL: ALL@ALL, PARANOID</code> in the <code class="filename">/etc/hosts.deny</code> file and explicitly list trusted hosts who are allowed to your machine in the <code class="filename">/etc/hosts.allow</code> file. This 
             is the safest and the best configuration. TCP_WRAPPERS is controlled from two files and the search stops at the first match.
             </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">
             /etc/hosts.allow
             </code></td></tr><tr><td><code class="filename">
             /etc/hosts.deny
             </code></td></tr></table><p>
             </p><p>
             Access will be granted when a daemon, client pair matches an entry in the <code class="filename">/etc/hosts.allow</code> file.
             Otherwise, access will be denied when a daemon, client pair matches an entry in the <code class="filename">/etc/hosts.deny</code> file.
             Otherwise, access will be granted.
             </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
             Edit the <code class="filename">hosts.deny</code> file vi <code class="filename">/etc/hosts.deny</code> and add the following lines:
             <span class="emphasis"><em>Access is denied by default</em></span>.
             </p><pre class="programlisting">
             # Deny access to everyone.
             ALL: ALL@ALL, PARANOID # Matches any host whose name does not match its address, see below.
             </pre><p>

             Which means all services, all locations, so any service not explicitly allowed is then blocked, unless they are permitted access by entries in the allow file.
              </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
             <span class="emphasis"><em>
             With the parameter</em></span> PARANOID; <span class="emphasis"><em>If you intend to run telnet or ftp services on your server, dont forget to add the client's machine name and IP address in 
             your <code class="filename">/etc/hosts</code> file on the server or you can expect to wait several minutes for the DNS lookup to time out, before you get a</em></span> 
             login: prompt.             
             </p></div><p>             
             </p></li><li class="step"><p>

             Edit the <code class="filename">hosts.allow</code> file <span class="command"><strong>vi</strong></span> <code class="filename">/etc/hosts.allow</code> and add for example, the following line:
             The explicitly authorized host are listed in the allow file.
             As an example:<code class="envar">sshd:</code> <code class="literal">208.164.186.1 gate.openna.com</code>, For your client machine: <code class="literal">208.164.186.1</code> is the <acronym class="acronym">IP</acronym> address and <code class="literal">gate.openna.com</code> the host 
             name of one of your client allowed using sshd.
            </p></li><li class="step"><p>
             The tcpdchk program is the <code class="literal">tcpd wrapper</code> configuration checker. It examines your <code class="literal">tcp wrapper</code> configuration and reports all potential and real problems it can find.
             After your configuration is done, run the program tcpdchk.
             </p><pre class="screen">
             [root@deep] /# <span class="command"><strong>tcpdchk</strong></span>
             </pre><p>
             </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
             Error messages may look like this: 
             </p><pre class="literallayout"><code class="computeroutput">
             warning: /etc/hosts.allow, 
             line 6: can't verify hostname: gethostbyname(win.openna.com) failed.              
             </code>
             </pre><p>
             If you receive this kind of error message, check in your <acronym class="acronym">DNS</acronym> configuration file 
             for the existence of this hostname.
            </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm3454"></a>9.1. Don't display system issue file</h3></div></div></div><p>
               If you don't want your systems issue file to be displayed when people log in remotely, you can change the telnet option in your <code class="filename">/etc/inetd.conf</code> file to look like:
               </p><pre class="screen">
               telnet  stream  tcp     nowait  root    /usr/sbin/tcpd  in.telnetd -h
               </pre><p>
               Adding the <code class="literal">-h</code> flag on the end will cause the daemon to not display any system information and just hit the user with a login: prompt. This hack is only necessary if you are using a telnet daemon on 
               your server instead I recommend you use SSH.
             </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3460"></a>10. The <code class="filename">/etc/host.conf</code> file</h2></div></div></div><p>
           Linux uses a resolver library to obtain the <acronym class="acronym">IP</acronym> address corresponding to a host name. The <code class="filename">/etc/host.conf</code> file specifies how names are resolved. The entries in the <code class="filename">etc/host.conf</code> 
           file tell the resolver library what services to use, and in what order, to resolve names. Edit the <code class="filename">host.conf</code> file vi <code class="filename">/etc/host.conf</code> and add the following lines:
           </p><pre class="programlisting">
           # Lookup names via DNS first then fall back to /etc/hosts.
           order bind,hosts
           # We have machines with multiple <acronym class="acronym">IP</acronym> addresses.
           multi on
           # Check for <acronym class="acronym">IP</acronym> address spoofing.
           nospoof on
           </pre><p>
           </p><p>
           The <em class="parameter"><code>order</code></em> option indicates the order of services. The sample entry specifies that the resolver library should first consult the name server to resolve a name and then check the <code class="filename">/etc/hosts</code> file. It is 
           recommended to set the resolver library to first check the name server, <code class="literal">bind</code> and then the hosts file (hosts) for better performance and security on all your servers. Of course you must have the <acronym class="acronym">DNS/BIND</acronym> software installed 
           or this configuration will not work.
           </p><p>
           The <em class="parameter"><code>multi</code></em> option determines whether a host in the <code class="filename">/etc/hosts</code> file can have multiple <acronym class="acronym">IP</acronym> addresses <abbr class="abbrev">i.e.</abbr>multiple interface <code class="literal">ethN</code>. Hosts that have more than one <acronym class="acronym">IP</acronym> 
           address are said to be multiomed, because the presence of multiple <acronym class="acronym">IP</acronym> addresses implies that host has several network interfaces. As an example, a Gateway Server will always have multiple <acronym class="acronym">IP</acronym> address and must have this 
           option set to <strong class="userinput"><code>ON</code></strong>.
           </p><p>
           The <em class="parameter"><code>nospoof</code></em> option indicates to take care of not permitting spoofing on this machine. <acronym class="acronym">IP</acronym>-Spoofing is a security exploit that works by tricking computers in a trust relationship that you are someone that you really 
           aren't. In this type of attack, a machine is set up to look like a legitimate server and then issue connections and other types of network activities to legitimate end systems, other servers or large data repository 
           systems. This option must be set <strong class="userinput"><code>ON</code></strong> for all types of servers.
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3491"></a>11. The /etc/services file</h2></div></div></div><p>
           The port numbers on which certain <span class="emphasis"><em>standard</em></span> services are offered are defined in the RFC 1700 <span class="emphasis"><em>Assigned Numbers</em></span>. The <code class="filename">/etc/services</code> file enables server and client programs to convert service names to these 
           numbers -<code class="literal">ports</code>. The list is kept on each host and it is stored in the file <code class="filename">/etc/services</code>. Only the "root" user is allowed to make modification in this file and it is rare to edit the <code class="filename">/etc/services</code> 
           file to make change since it already contains the more common service names to port numbers. To improve security, we can immunize this file to prevent unauthorized deletion or addition of services.
           To immunize the <code class="filename">/etc/services</code> file, use the command:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>chattr</strong></span>  +i /etc/services
           </pre><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3503"></a>12. The <code class="filename">/etc/securetty</code> file</h2></div></div></div><p>
             The <code class="filename">/etc/securetty</code> file allows you to specify which TTY devices the root user is allowed to login on. The <code class="filename">/etc/securetty</code> file is read by the login program usually <code class="filename">/bin/login</code>. Its format is a list of the 
             tty devices names allowed, and for all others that are commented out or do not appear in this file, root login is disallowed. Disable any tty that you do not need by commenting them out <code class="prompt">#</code> at the beginning of the line.
             Edit the securetty file <span class="command"><strong>vi</strong></span>, <code class="filename">/etc/securetty</code> and comment out the following lines:
             </p><pre class="programlisting">
             tty1
             #tty2
             #tty3
             #tty4
             #tty5
             #tty6
             #tty7
             #tty8
             </pre><p>
             Which means only root is allowed to login on <code class="prompt">tty1</code>. This is my recommendation, allowing root to log in only on one tty device and use the <span class="command"><strong>su</strong></span> command to switch to root if you need more. devices to log in as root.
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3516"></a>13. Special accounts</h2></div></div></div><p>
               It is important to <code class="envar">DISABLE ALL</code> default vendor accounts that you don't use on your system, some accounts exist by default even if you have not installed the related services on your server. This 
               should be checked after each upgrade or new software installation. Linux provides these accounts for various system activities, which you may not need if the services are not installed on your 
               server. If you do not need the accounts, remove them. The more accounts you have, the easier it is to access your system.
               </p><p>
               We assume you are using the Shadow password suite on your Linux system. If you are not, you should consider doing so, as it helps to tighten up security somewhat. This must already be set if 
               you've followed our instructions till now and selected under the <a class="link" href="#pr1ch2sc7" title="7. Post-Partitioning"> Authentication Configuration</a> the option to <span class="command"><strong>Enable Shadow Passwords</strong></span> see 
               <a class="link" href="#pr1ch2sc7" title="7. Post-Partitioning">Post Partitioning</a> for more information.
                              
               To delete user on your system, use the command:
               </p><pre class="screen">
               [root@deep] /# <span class="command"><strong>userdel</strong></span> username
               </pre><p>
               To delete group on your system, use the command:
                </p><pre class="screen">
               [root@deep] /# <span class="command"><strong>groupdel</strong></span> username
               </pre><p>
               </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
               Type the following commands on your terminal to delete users listed below:

               </p><pre class="screen">
               [root@deep] /# <span class="command"><strong>userdel</strong></span> adm
               [root@deep] /# <span class="command"><strong>userdel</strong></span> lp
               [root@deep] /# <span class="command"><strong>userdel</strong></span> sync
               [root@deep] /# <span class="command"><strong>userdel</strong></span> shutdown
               [root@deep] /# <span class="command"><strong>userdel</strong></span> halt
               [root@deep] /# <span class="command"><strong>userdel</strong></span> news
               [root@deep] /# <span class="command"><strong>userdel</strong></span> uucp
               [root@deep] /# <span class="command"><strong>userdel</strong></span> operator
               [root@deep] /# <span class="command"><strong>userdel</strong></span> games       <a name="pr2ch1s22co1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>  
               [root@deep] /# <span class="command"><strong>userdel</strong></span> gopher
               [root@deep] /# <span class="command"><strong>userdel</strong></span> ftp         <a name="pr2ch1s22co2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
               </pre><p>
               </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#pr2ch1s22co1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
               Delete this user if you don't use X Window Server.
               </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#pr2ch1s22co2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
               Delete this user if you don't use ftp anonymous server.
               </p></td></tr></table></div><p>
               <span class="emphasis"><em>
               By default, the <span class="command"><strong>userdel</strong></span> command will not delete a user's home directory. If you want the home directories of accounts to be deleted too, then 
               add the <code class="literal">-r</code> option to the userdel command.
               </em></span>
               </p></li><li class="step"><p>
               Type the following commands on your terminal to delete the usersgroups listed below:
               </p><pre class="screen">
               [root@deep] /# <span class="command"><strong>groupdel</strong></span> adm
               [root@deep] /# <span class="command"><strong>groupdel</strong></span> lp
               [root@deep] /# <span class="command"><strong>groupdel</strong></span> news
               [root@deep] /# <span class="command"><strong>groupdel</strong></span> uucp
               [root@deep] /# <span class="command"><strong>groupdel</strong></span> games      <a name="pr2ch1s22co3"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span> 
               [root@deep] /# <span class="command"><strong>groupdel</strong></span> dip
               [root@deep] /# <span class="command"><strong>groupdel</strong></span> pppusers
               [root@deep] /# <span class="command"><strong>groupdel</strong></span> popusers   <a name="pr2ch1s22co4"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span> 
               [root@deep] /# <span class="command"><strong>groupdel</strong></span> slipusers
               </pre><p>
               </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#pr2ch1s22co3"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
               Delete this group if you don't use X Window Server.
               </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#pr2ch1s22co4"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
               Delete this group if you don't use pop server for email.
               </p></td></tr></table></div><p>
               </p></li><li class="step"><p>
               Add the necessary user to the system, to add a new user on your system, use the command:
               </p><pre class="screen">
               [root@deep] /# <span class="command"><strong>useradd</strong></span> username
               </pre><p>
               To add or change password for user on your system, use the command:
               </p><pre class="screen">
               [root@deep] /# <span class="command"><strong>passwd</strong></span> username
               </pre><p>
               For example:
               </p><pre class="screen">
               [root@deep] /# <span class="command"><strong>useradd</strong></span> admin
               [root@deep] /# <span class="command"><strong>passwd</strong></span> admin
               </pre><p>
               The output should look something like this.
               </p><pre class="literallayout"><code class="computeroutput">
               Changing password for user admin
               New UNIX password: somepasswd
               passwd: all authentication tokens updated successfully
               </code></pre><p>
               </p></li><li class="step"><p>
               The immutable bit can be used to prevent accidentally deleting or overwriting a file that must be protected. It also prevents someone from creating a symbolic link to this file, which has been the source of attacks involving the deletion 
               of <code class="filename">/etc/passwd</code>, <code class="filename">/etc/shadow</code>, <code class="filename">/etc/group</code> or <code class="filename">/etc/gshadow</code>.
               To set the immutable bit on the passwords and groups files, use the command:
               </p><pre class="screen">
               [root@deep] /# <span class="command"><strong>chattr</strong></span>   +i /etc/passwd
               [root@deep] /# <span class="command"><strong>chattr</strong></span>   +i /etc/shadow
               [root@deep] /# <span class="command"><strong>chattr</strong></span>   +i /etc/group
               [root@deep] /# <span class="command"><strong>chattr</strong></span>   +i /etc/gshadow
               </pre><p>
               </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
               In future, if you intend to add or delete users, passwords, usergroups, or group files, you must unset the immutable bit on all those files or you will not be able to make your changes. Also if you intend to install an RPM program that will automatically add a new user to the different 
               immunized passwd and group files, then you will receive an error message during the install if you have not unset the immutable bit from those files.
               </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3602"></a>14. Blocking; <span class="command"><strong>su</strong></span> to root, by one and sundry</h2></div></div></div><p>
               The <span class="command"><strong>su</strong></span> Substitute User command allows you to become other existing users on the system. For example you can temporarily become root and execute commands as the super-user root. If you don't want anyone to su to root or restrict <span class="command"><strong>su</strong></span> command to 
               certain users then add the following two lines to the top of your <span class="command"><strong>su</strong></span> configuration file in the <code class="filename">/etc/pam.d/</code> directory. We highly recommend that you limit the person 
               allowed to <span class="command"><strong>su</strong></span> to the root account.
               </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
               Edit the su file vi <code class="filename">/etc/pam.d/su</code> and add the following two lines to the top of the file:
               </p><pre class="programlisting">
               auth sufficient /lib/security/pam_rootok.so debug
               auth required /lib/security/pam_wheel.so group=wheel
                </pre><p>
               After adding the two lines above, the <code class="filename">/etc/pam.d/su</code> file should look like this:
               </p><pre class="programlisting">
               #%PAM-1.0
               auth	      sufficient   	/lib/security/pam_rootok.so debug
               auth             required    	/lib/security/pam_wheel.so group=wheel
               auth       	required     	/lib/security/pam_pwdb.so shadow nullok
               account    	required     	/lib/security/pam_pwdb.so
               password   	required     	/lib/security/pam_cracklib.so
               password   	required     	/lib/security/pam_pwdb.so shadow use_authtok nullok
               session    	required     	/lib/security/pam_pwdb.so
               session    	optional     	/lib/security/pam_xauth.so
               </pre><p>
               Which mean only those who are a member of the wheel group can su to root; it also includes 
               logging. Note that the wheel group is a special account on your system that can be used for this purpose. You cannot 
               use any group name you want to make this hack. This hack combined with specifying which TTY devices root is allowed to 
               login on will improve your security a lot on the system.
               </p></li><li class="step"><p>
               Now that we have defined the wheel group in our <code class="filename">/etc/pam.d/su</code> file configuration, it is time to add some users allowed to su to 
               root account. If you want to make, for example, the user admin a member of the wheel group, and thus be able to su to root, use the following command:
               </p><pre class="screen">
               [root@deep] /# <span class="command"><strong>usermod</strong></span> -G10 admin
               </pre><p>
               </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
               Which means <code class="literal">G</code> is a list of supplementary groups, 
               </p></li><li class="listitem"><p>
               Where the user is also a member of, <code class="literal">10</code> is the numeric value of the user's <acronym class="acronym">ID</acronym> wheel, 
               </p></li><li class="listitem"><p>
               admin is the user we want to add to wheel group. 
               </p></li></ul></div><p>
               Use the same command above for all users on your system you want to be able to su to 
               root account.
               <span class="emphasis"><em>
               If you can't <span class="command"><strong>su</strong></span> in a <acronym class="acronym">GNOME</acronym> terminal, it's because you've used the wrong terminal. So don't think that this advice simply doesn't work because of a terminal problem!.
               </em></span>
               </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3636"></a>15. Put limits on resource</h2></div></div></div><p>
               The <code class="filename">limits.conf</code> file located under the <code class="filename">/etc/security</code> directory can be used to control and limit resources for the users on your system. It is important to set resource limits on all your 
               users so they can't perform denial of service attacks number of processes, amount of memory, etc). These limits will have to be set up for the user when he or she logs in. For example, limits 
               for all users on your system might look like this.
               </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
               Edit the <code class="filename">limits.conf</code> file vi <code class="filename">/etc/security/limits.conf</code> and add or change the lines to read:
               </p><pre class="programlisting">
               *	hard	core		0
               *	hard	rss		5000
               *	hard	nproc	20
               </pre><p>
               This says to prohibit the creation of core files - <span class="emphasis"><em>core 0</em></span>, restrict the number of processes to 20 - <span class="emphasis"><em>nproc 20</em></span>, and restrict memory usage to 5M - <span class="emphasis"><em>rss 5000</em></span> for everyone except the 
               super user root. All of the above only concern users who have entered through the login prompt on your system. With this kind of quota, you have more control on the processes, core files, and memory usage that users 
               may have on your system. The asterisk   * mean: all users that logs in on the server.
               </p></li><li class="step"><p>
               You must also edit the <code class="filename">/etc/pam.d/login</code> file and add the following line to the bottom of the file:
               </p><pre class="screen">
               session  required  /lib/security/pam_limits.so
               </pre><p>
               After adding the line above, the <code class="filename">/etc/pam.d/login</code> file should look like this:
               </p><pre class="programlisting">
               #%PAM-1.0
               auth	required     	/lib/security/pam_securetty.so
               auth	required     	/lib/security/pam_pwdb.so shadow nullok
               auth	required     	/lib/security/pam_nologin.so
               account	required     	/lib/security/pam_pwdb.so
               password	required     	/lib/security/pam_cracklib.so
               password	required     	/lib/security/pam_pwdb.so nullok use_authtok md5 shadow
               session	required     	/lib/security/pam_pwdb.so
               session	required     	/lib/security/pam_limits.so
               #session	optional    	/lib/security/pam_console.so
               </pre><p>
               </p></li><li class="step"><p>
               Finally edit the <code class="filename">/etc/profile</code> file and change the following line:
               </p><pre class="programlisting">
               ulimit -c 1000000
               </pre><p>
               to read:
               </p><pre class="programlisting">
               ulimit -S -c 1000000 &gt; /dev/null 2&lt;&amp;1
               </pre><p>
               This modification is required so as to avoid getting error messages like this <code class="computeroutput">Unable to reach limit</code> during <code class="prompt">login:</code>.
               </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3663"></a>16. Control mounting a file system</h2></div></div></div><p>
             You can have more control on mounting a file system like <code class="filename">/home</code> and <code class="filename">/tmp</code> partitions with some nifty options like noexec, nodev, and nosuid. This can be 
             setup in the <code class="filename">/etc/fstab</code> text file. The fstab file contains descriptive information about the various file systems mount options; each line addresses one file system.
             Details regarding to security options in the fstab text file are:
             </p><div class="segmentedlist"><div class="seglistitem"><div class="seg"><strong><span class="segtitle">defaults: </span></strong>Allow everything quota, read-write, and suid on this partition.</div><div class="seg"><strong><span class="segtitle">noquota: </span></strong>Do not set users quotas on this partition.</div><div class="seg"><strong><span class="segtitle">nosuid: </span></strong>Do not set <acronym class="acronym">SUID/SGID</acronym> access on this partition.</div><div class="seg"><strong><span class="segtitle">nodev: </span></strong>Do not set character or special devices access on this partition.</div><div class="seg"><strong><span class="segtitle">noexec: </span></strong>Do not set execution of any binaries on this partition.</div><div class="seg"><strong><span class="segtitle">quota: </span></strong>Allow users quotas on this partition.</div><div class="seg"><strong><span class="segtitle">ro: </span></strong>Allow read-only on this partition.</div><div class="seg"><strong><span class="segtitle">rw: </span></strong>Allow read-write on this partition.</div><div class="seg"><strong><span class="segtitle">suid: </span></strong>Allow <acronym class="acronym">SUID/SGID</acronym> access on this partition.</div></div></div><p>

             For more information on options that you can set in this file fstab, see the man pages about <span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span>.
             </p><p>
             Edit the fstab file vi <code class="filename">/etc/fstab</code> and change it depending on your needs. For example:
             </p><pre class="programlisting">
             /dev/sda11	        /tmp		ext2	defaults        1 2
             /dev/sda6		/home		ext2	defaults        1 2
             </pre><p>
            
             To read:
             </p><pre class="programlisting">
             /dev/sda11 	/tmp 		ext2 	defaults,rw,nosuid,nodev,noexec	1 2
             /dev/sda6 	        /home 		ext2 	defaults,rw,nosuid,nodev	1 2
             </pre><p>
             </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
              <code class="literal">nosuid</code>, Meaning do not allow set-user-identifier or set-group-identifier bits to take effect,  
              </td></tr><tr><td>
              <code class="literal">nodev</code>, do not interpret character or block special devices on this file system partition, 
              </td></tr><tr><td>
              <code class="literal">noexec</code>, do not allow execution of any binaries on the mounted file system. 
              </td></tr></table><p>
              Take a note that we have added the <code class="literal">rw</code> option to the modified lines above. This is because the default options for these lines are defaults, which means to set quota, read-write, and suid, so we must 
             add the <code class="literal">rw</code> option to continue having read-write access on these modified file systems.
             
             For our example above, the <code class="filename">/dev/sda11</code> represent our <code class="filename">/tmp</code> directory partition on the system, and <code class="filename">/dev/sda6</code> 
             the <code class="filename">/home</code> directory partition. Of course this will be not the same for you, depending on how you have partitioned your hard disk and what kind of disks are installed on your system, <acronym class="acronym"><acronym class="acronym">IDE</acronym></acronym> -hda, hdb, etc 
             or <acronym class="acronym">SCSI</acronym> -<code class="literal">sda</code>, <code class="literal">sdb</code>, etc.
             </p><p>
             Once you have made the necessary adjustments to the <code class="filename">/etc/fstab</code> file, it is time to makethe Linux system aware about the modification. This can be accomplished with the following commands:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>mount</strong></span> -oremount /home/
             [root@deep] /#<span class="command"><strong>mount</strong></span> -oremount /tmp/
             </pre><p>
             </p><p>
             Each file system that has been modified must be remounted with the command show above. In our example we have modified the <code class="filename">/home/</code>, 
             and <code class="filename">/tmp/</code> file system and it is for this reason that we remount these file system with the above commands.
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3724"></a>17. Conceal binary <acronym class="acronym">RPM</acronym> </h2></div></div></div><p>
             Once you have installed all the software that you need on yo42ur Linux server with the <acronym class="acronym">RPM</acronym> command, it's a good idea for better security to move it to a safe 
             place like a floppy disk or other safe place of your choice. With this method if some one accesses your server and has the intention to install software like trojan horses, password 
             thieves etc. with <acronym class="acronym">RPM</acronym> command, he shouldn't be able to do so. Of course, if in the future you want to install or upgrade new software via <acronym class="acronym">RPM</acronym>, all 
             you have to do is to replace the <acronym class="acronym">RPM</acronym> binary to its original directory again. To move the <acronym class="acronym">RPM</acronym> binary on the floppy disk, use the command:
             </p><pre class="screen">
             [root@deep] /# <span class="command"><strong>mount</strong></span> /dev/fd0 /mnt/floppy/
             [root@deep] /# <span class="command"><strong>mv</strong></span> /bin/rpm /mnt/floppy/
             [root@deep] /# <span class="command"><strong>umount</strong></span> /mnt/floppy
             </pre><p>
             </p><p>
             Never uninstall the <acronym class="acronym">RPM</acronym> program completely from your system or you will be unable to reinstall it again later, since to install <acronym class="acronym">RPM</acronym> or other software you need to have <acronym class="acronym">RPM</acronym> commands available.
             Another thing you can do is change the default permission of the rpm command from 755 to 700. With this modification, non-root users can't use the rpm program to query, install etc; in case 
             you forget to move it to a safe place after installation of new programs.
              To change the default permission of <code class="filename">/bin/rpm</code>, use the command:
              </p><pre class="screen">
             [root@deep] /# <span class="command"><strong>chmod</strong></span> 700  /bin/rpm
             </pre><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3744"></a>18. Shell logging</h2></div></div></div><p>
                To make it easy for you to repeat long commands, the bash shell stores up to 500 old commands in the <code class="filename">~/.bash_history</code> file where <code class="filename">~/</code> is your home directory. Each 
                user that has an account on the system will have this file <code class="filename">.bash_history</code> in their home directory. Reducing the number of old commands the <code class="filename">.bash_history</code> files can 
                hold may protect users on the server who enter by mistake their password on the screen in plain text and have their password stored for a long time in the <code class="filename">.bash_history</code> file.
                </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
                      The <code class="envar">HISTFILESIZE</code> and <code class="envar">HISTSIZE</code> lines in the <code class="filename">/etc/profile</code> file determine the size of old commands the <code class="filename">.bash_history</code> file for all users on your system can 
                      hold. For all accounts I would highly recommend setting the HISTFILESIZE and HISTSIZE in <code class="filename">/etc/profile</code> file to a low value such as 20.
                      Edit the profile file vi <code class="filename">/etc/profile</code> and change the lines to:
                      </p><pre class="screen">
                        HISTFILESIZE=20
                        HISTSIZE=20
                      </pre><p>
                      Which mean, the <code class="filename">.bash_history</code> file in each users home directory can store 20 old commands and no more. Now, if a cracker tries to see the <code class="filename">~/.bash_history</code> file of users on your server to find 
                      some password typed by mistake in plain text, he or she has less chance to find one.
                    </p></li><li class="step"><p>
                      The administrator should also add into the /etc/skel/.bash_logout file the <span class="command"><strong>rm</strong></span>   -f  <code class="filename">$HOME/.bash_history</code> line, so that each time a user logs out, its <code class="filename">.bash_history</code> 
                      file will be deleted so crackers will not be able to use <code class="filename">.bash_history</code> file of users who are not presently logged into the system.
                      Edit the <code class="filename">.bash_logout</code> file vi <code class="filename">/etc/skel/.bash_logout</code> and add the following line:
                      </p><pre class="screen">
                        <span class="command"><strong>rm</strong></span> -f  $HOME/.bash_history
                      </pre><p>
                    </p></li></ol></div><p>
                <span class="emphasis"><em>
                  The above hack will only work for future users you'll add in the server. If you already have existing users in the <code class="filename">/etc/passwd</code> file, you must edit and add the above line into their <code class="filename">.bash_logout</code> files manually.
                </em></span>
            </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3778"></a>19. The LILO and <code class="filename">lilo.conf</code> file</h2></div></div></div><p>
              LILO is the most commonly used boot loader for Linux. It manages the boot process and can boot Linux kernel images from floppy disks, hard disks or can even act as a boot manager for other operating systems. LILO is very important in the Linux system and 
              for this reason, we must protect it the best we can. The most important configuration file of LILO is the <code class="filename">lilo.conf</code> file, which resides under the <code class="filename">/etc</code> directory. It is with this file that we can 
              configure and improve the security of our LILO program and Linux system. Following are three important options that will improve the security of our valuable LILO program.
              </p><div class="glosslist"><dl><dt><span class="glossterm"><code class="envar">Adding: timeout=00</code></span></dt><dd class="glossdef"><p>
              This option controls how long in seconds LILO waits for user input before booting to the default selection. One of the requirements of C2 security is that this interval be set to 0 unless the system dual boots something else.
              </p></dd><dt><span class="glossterm"><code class="envar">Adding: restricted</code></span></dt><dd class="glossdef"><p>
              This option asks for a password only, if parameters are specified on the command line (e.g. linux single). The option restricted can only be used together with the password option. Make sure you use this one on each image.
              </p></dd><dt><span class="glossterm"><code class="envar">Adding: password=&lt;password&gt;</code></span></dt><dd class="glossdef"><p>
              This option asks the user for a password when trying to load the Linux system in single mode. Passwords are always case-sensitive, also make sure the <code class="filename">/etc/lilo.conf</code> file is no longer world readable, or any user will be able 
              to read the password. 
              </p></dd></dl></div><p>
              </p><div class="procedure"><a name="idm3801"></a><p class="title"><b>Procedure 5.1. An example of protected <code class="filename">lilo.conf</code> file.</b></p><ol class="procedure" type="1"><li class="step"><p>              
              Edit the lilo.conf file vi <code class="filename">/etc/lilo.conf</code> and add or change the above three options as show:
              
              </p><pre class="programlisting">
              boot=/dev/sda
              map=/boot/map
              install=/boot/boot.b
              prompt
              timeout=00 ß change this line to 00.
              Default=linux
              restricted ß add this line.
              password=&lt;password&gt;  <a name="llcnf1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
              image=/boot/vmlinuz-2.2.12-20
              label=linux
              initrd=/boot/initrd-2.2.12-10.img
              root=/dev/sda6
              read-only
              </pre><p>
              </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#llcnf1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p><span class="emphasis"><em>add this line and put your password.</em></span></p></td></tr></table></div><p>
              
                  </p></li><li class="step"><p>
              
              Because the configuration file <code class="filename">/etc/lilo.conf</code> now contains unencrypted passwords, it should only be readable for the super-user root.
              </p><pre class="screen">
              [root@deep] /# <span class="command"><strong>chmod</strong></span> 600  /etc/lilo.conf <span class="emphasis"><em>will be no longer world readable.</em></span>
              </pre><p>
                  </p></li><li class="step"><p>
              Now we must update our configuration file <code class="filename">/etc/lilo.conf</code> for the change to take effect.
              </p><pre class="screen">
              [root@deep] /# <span class="command"><strong>/sbin/lilo</strong></span> -v <span class="emphasis"><em>to update the lilo.conf file.</em></span>
              </pre><p>
                  </p></li><li class="step"><p>
              One more security measure you can take to secure the <code class="filename">lilo.conf</code> file is to set it immutable, using the chattr command.
              To set the file immutable simply, use the command:
              </p><pre class="screen">
              [root@deep] /# <span class="command"><strong>chattr</strong></span> +i <code class="filename">/etc/lilo.conf</code>
              </pre><p>
              And this will prevent any changes accidental or otherwise to the <code class="filename">lilo.conf</code> file. If you wish to modify the <code class="filename">lilo.conf</code> file you 
              will need to unset the immutable flag:
              To unset the immutable flag, use the command:
              </p><pre class="screen">
              [root@deep] /# <span class="command"><strong>chattr</strong></span> -i <code class="filename">/etc/lilo.conf</code>
              </pre><p>
              </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3836"></a>20. Disable <span class="keycap"><strong>Ctrl-Alt-Delete</strong></span> keyboard shutdown command</h2></div></div></div><p>
            Commenting out the line with a <code class="prompt">#</code> listed below in your <code class="filename">/etc/inittab</code> file will disable the possibility of using 
            the <span class="keycap"><strong>Ctrl-Alt-Delete</strong></span> command to shutdown your computer. This is pretty important if you don't have the best physical security on the box.
            To do this, edit the inittab file vi <code class="filename">/etc/inittab</code> and change the line:
            </p><pre class="screen">
            ca::ctrlaltdel:/sbin/shutdown -t3 -r now
            </pre><p>
            To read:
            </p><pre class="screen">
            #ca::ctrlaltdel:/sbin/shutdown -t3 -r now
            </pre><p>
            Now, for the change to take effect type in the following at a prompt:
            </p><pre class="screen">
            [root@deep] /#<span class="command"><strong>/sbin/init</strong></span> q
            </pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3848"></a>21. 
            Physical hard copies of all-important logs
              </h2></div></div></div><p>
            One of the most important security considerations is the integrity of the different log files under the <code class="filename">/var/log</code> directory on your server. If despite each of the 
            security functions put in place on our server a cracker can gain access to it, our last defense is the log file system, so it is very important to consider a method of being sure of the integrity of our log files.
            </p><p>
            If you have a printer installed on your server, or on a machine on your network, a good idea would be to have actual physical hard copies of all-important logs. This can be easily accomplished by using a continuous 
            feed printer and having the syslog program sending all logs you seem important out to <code class="filename">/dev/lp0</code> the printer device. Cracker can change the files, programs, etc on your server, but can do nothing when 
            you have a printer that prints a real paper copy of all of your important logs.
            </p><div class="example"><a name="idm3854"></a><p class="title"><b>Example 5.3. Print log reports </b></p><div class="example-contents"><p>
            For logging of all telnet, mail, boot messages and ssh connections from your server to the printer attached to this server, you would want to add the following line to the "/etc/syslog.conf" file:
            Edit the syslog.conf file vi <code class="filename">/etc/syslog.conf</code> and add at the end of this file the following line:
            </p><pre class="screen">
            authpriv.*;mail.*;local7.*;auth.*;daemon.info /dev/lp0
            </pre><p>
            Now restart your syslog daemon for the change to take effect:
            </p><pre class="screen">
            [root@deep] /# /etc/rc.d/init.d/syslog <span class="command"><strong>restart</strong></span>
            </pre><p>
            </p><p>
            For logging of all telnet, mail, boot messages and ssh connections from your server to the printer attached to a remote server in your local network, then you would want to add the following line 
            to <code class="filename">/etc/syslog.conf</code> file on the remote server.
            If you don't have a printer in your network, you can also copy all the log files to another machine; simply omit the first step below of adding <code class="filename">/dev/lp0</code> to your <code class="filename">syslog.conf</code> file 
            on remote and go directly to the <code class="literal">-r</code> option step on remote. Using the feature of copying all the log files to another machine will give you the possibility to control all syslog messages on one 
            host and will tear down administration needs.
            Edit the <code class="filename">syslog.conf</code> file vi <code class="filename">/etc/syslog.conf</code> on the remote server for example: <code class="literal">mail.openna.com</code> and add at the end of this file the following line:
            </p><pre class="screen">
            authpriv.*;mail.*;local7.*;auth.*;daemon.info <code class="filename">/dev/lp0</code>
            </pre><p>
            Since the default configuration of the syslog daemon is to not receive any messages from the network, we must enable on the remote server the facility to receive messages from the network. To enable the facility 
            to receive messages from the network on the remote server, add the following option <code class="literal">-r</code> to your syslog daemon script file <span class="emphasis"><em>only on the remote host</em></span>:
            Edit the syslog daemon <span class="command"><strong>vi</strong></span> +24 <code class="filename">/etc/rc.d/init.d/syslog</code> and change:
            </p><pre class="programlisting">
            
            <span class="command"><strong>daemon</strong></span> syslogd -m 0
            
            </pre><p>
            To read:
            </p><pre class="programlisting">
            <span class="command"><strong>daemon</strong></span> syslogd -r -m 0
            </pre><p>
            
            Now restart your syslog daemon on the remote host for the change to take effect:
            </p><pre class="screen">
            [root@mail /]# /etc/rc.d/init.d/syslog <span class="command"><strong>restart</strong></span>
            </pre><p>
            </p></div></div><br class="example-break"><p>
            Now, if we have a firewall on the remote server you are supposed to have one), we must add or verify the existence 
            of the following lines:
            </p><pre class="programlisting">
            ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \ <a name="exin1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
            -s $SYSLOG_CLIENT \     <a name="ipd1"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
            -d $IPADDR 514 -j ACCEPT <a name="syse1"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
             </pre><p>
                          </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#exin1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            Where EXTERNAL_INTERFACE="eth0" in the firewall file.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ipd1"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            Where IPADDR="208.164.186.2" in the firewall file.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#syse1"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            Where SYSLOG_CLIENT="208.164.168.0/24" in the firewall file.
            </p></td></tr></table></div><p>
              
              </p><p>
            Now restart your firewall on the remote host for the change to take effect:
            </p><pre class="screen">
            [root@mail /]# /etc/rc.d/init.d/firewall <span class="command"><strong>restart</strong></span>
            </pre><p>
            This firewall rule will allow incoming UDP packet on port 514 (syslog port) on the remote server that come from our internal client to 
            be accepted. For more information on Firewall see Chapter 7 <code class="filename">Networking firewall</code>.
            </p><p>
            Finally, edit the syslog.conf file <code class="filename">vi /etc/syslog.conf</code> on the local server, and add at the end of this file the following line:
            </p><pre class="programlisting">
            authpriv.*;mail.*;local7.*;auth.*;daemon.info @mail
             </pre><p>
            Where mail is the hostname of the remote server. Now if anyone ever hacks your box and menaces to erase vital system logs, you still 
            have a hard copy of everything. It should then be fairly simple to trace where they came from and deal with it accordingly.
            Now restart your syslog daemon for the change to take effect:
            </p><pre class="screen">
            [root@deep] /# /etc/rc.d/init.d/syslog <span class="command"><strong>restart</strong></span>
            </pre><p>
            Same as on the remote host, we must add or verify the existence of the following lines in our firewall script file on the local host:
            </p><pre class="programlisting">
            ipchains -A output -i $EXTERNAL_INTERFACE -p udp \ <a name="exin2"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
            -s $IPADDR 514 \   <a name="ipd2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
            -d $SYSLOG_SERVER 514 -j ACCEPT  <a name="syse2"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
            </pre><p>
            
              </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#exin2"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            Where EXTERNAL_INTERFACE="eth0" in the firewall file.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ipd2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            Where IPADDR="208.164.186.1" in the firewall file.
             </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#syse2"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            Where SYSLOG_SERVER="mail.openna.com" in the firewall file.
            </p></td></tr></table></div><p>
              
              </p><p>
            Now restart your firewall for the change to take effect:
            </p><pre class="screen">
            [root@deep] /# /etc/rc.d/init.d/firewall <span class="command"><strong>restart</strong></span>
            </pre><p>
            This firewall rule will allow outgoing UDP packet on port 514 syslog port on the local server destined to the remote syslog server to be accepted. For more information on 
            Firewall see chapter 7 Networking firewall.
            </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
            Never use your Gateway Server as a host to control all syslog messages; this is a very bad idea. More options and strategies exist with the sysklogd program, see 
            the man pages about <span class="citerefentry"><span class="refentrytitle">sysklogd</span>(8)</span>, <span class="citerefentry"><span class="refentrytitle">syslog</span>(2)</span>, 
            and <span class="citerefentry"><span class="refentrytitle">syslog.conf</span>(5)</span> for more information.
             </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3933"></a>22. Tighten scripts under <code class="filename">/etc/rc.d/</code></h2></div></div></div><p>
            Fix the permissions of the script files that are responsible for starting and stopping all your normal processes that need to run at boot time.
            </p><pre class="screen">
            [root@deep] /# <span class="command"><strong>chmod</strong></span> -R 700  /etc/rc.d/init.d/*
            </pre><p>
            Which means just root is allowed to Read, Write, and Execute scripts files on this directory. I don't think regular users need to know what is inside those script files.
            </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
            If you install a new program or update a program that use the init system V script located under <code class="filename">/etc/rc.d/init.d/</code> directory, don't 
            forget to change or verify the permission of this script file again.
              </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm3948"></a>22.1. The <code class="filename">/etc/rc.d/rc.local</code> file</h3></div></div></div><p>
            By default, when you login to a Linux box, it tells you the Linux distribution name, version, kernel version, and the name of the server. This is giving away too 
            much info. We'd rather just prompt users with a <code class="prompt">Login:</code>
            </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>              
            To do this, Edit the <code class="filename">/etc/rc.d/rc.local</code> file and Place <code class="prompt">#</code> in front of the following 
            lines as shown:
            </p><pre class="programlisting">
            
            # This will overwrite /etc/issue at every boot.  So, make any changes you
            # want to make to /etc/issue here or you will lose them when you reboot.
            #echo "" &gt; /etc/issue
            #echo "$R" &gt;&gt; /etc/issue
            #echo "Kernel $(uname -r) on $a $(uname -m)" &gt;&gt; /etc/issue
            #
            #cp -f /etc/issue /etc/issue.net
            #echo &gt;&gt; /etc/issue
            </pre><p>
            
              </p></li><li class="step"><p>              
            Then, remove the following files: <code class="filename">issue.net</code> and <code class="filename">issue</code> under <code class="filename">/etc</code> directory:
            </p><pre class="screen">
            [root@deep] /# <span class="command"><strong>rm</strong></span> -f  /etc/issue
            [root@deep] /# <span class="command"><strong>rm</strong></span> -f  /etc/issue.net
            </pre><p>
            </p></li></ol></div><p>
            The <code class="filename">/etc/issue.net</code> file is the login banner that users will see when they make a networked <abbr class="abbrev">i.e.</abbr> telnet, SSH connection to 
            your machine. You will find it in the <code class="filename">/etc</code> directory, along with a similar file called <code class="filename">issue</code>, which is the login banner 
            that gets displayed to local users. It is simply a text file and can be customized to your own taste, but be aware that as noted above, if you do change it or 
            remove it like we do, you'll also need to modify the <code class="filename">/etc/rc.d/rc.local</code> shell script, which re-creates both the <code class="filename">issue</code> and <code class="filename">issue.net</code> files 
            every time the system boots.
            </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm3975"></a>23. 
            Bits from root-owned programs
              </h2></div></div></div><p>
            A regular user will be able to run a program as root if it is set to SUID root. All programs and files on your computer with the <code class="literal">s</code> bits appearing on its mode, have 
            the <acronym class="acronym">SUID</acronym> <code class="computeroutput">-rwsr-xr-x</code> or <acronym class="acronym">SGID</acronym> <code class="computeroutput">-r-xr-sr-x</code> bit enabled. Because these programs grant special privileges 
            to the user who is executing them, it is important to remove the <code class="literal">s</code> bits from root-owned programs that won't absolutely require such privilege. This can be accomplished by executing the 
            command <span class="command"><strong>chmod</strong></span> <code class="literal">a-s</code> with the name(s) of the <acronym class="acronym">SUID/SGID</acronym> files as its arguments.
            Such programs include, but aren't limited to:
            </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
            Programs you never use.
            </p></li><li class="listitem" style="list-style-type: disc"><p>                
            Programs that you don't want any non-root users to run.
            </p></li><li class="listitem" style="list-style-type: disc"><p>                
            Programs you use occasionally, and don't mind having to <span class="command"><strong>su</strong></span> to root to run.
            </p></li></ul></div><p>
            </p><p>
            We've placed an asterisk * next to each program we personally might disable and consider to be not absolutely required for the working of our 
            server. Remember that your system needs some suid root programs to work properly, so be careful. make your choices based on your requirements.
            To find all files with the <code class="literal">s</code> bits from root-owned programs, use the command:
            </p><pre class="screen">
            [root@deep]#<span class="command"><strong>find</strong></span> / -type f \( -perm -04000 -o -perm -02000 \) \-exec ls 'lg {} \;
             </pre><p>
             </p><p>
            </p><pre class="programlisting">
            *-rwsr-xr-x	1 root     root	35168	Sep	22	23:35	/usr/bin/chage
            *-rwsr-xr-x	1 root     root	36756	Sep	22	23:35	/usr/bin/gpasswd
            *-r-xr-sr-x	1 root     tty	6788	Sep 	6	18:17	/usr/bin/wall
            -rwsr-xr-x	1 root     root	33152	Aug	16	16:35	/usr/bin/at
            -rwxr-sr-x	1 root     man	34656	Sep	13	20:26	/usr/bin/man
            -r-s--x--x	1 root     root	22312	Sep	25	11:52	/usr/bin/passwd
            -rws--x--x	2 root     root	518140 	Aug	30	23:12	/usr/bin/suidperl
            -rws--x--x	2 root     root	518140 	Aug	30	23:12	/usr/bin/sperl5.00503
            -rwxr-sr-x	1 root     slocate	24744	Sep	20	10:29	/usr/bin/slocate
            *-rws--x--x	1 root     root	14024	Sep 	9	01:01	/usr/bin/chfn
            *-rws--x--x	1 root     root	13768	Sep	9	01:01	/usr/bin/chsh
            *-rws--x--x	1 root     root	5576	Sep	9	01:01	/usr/bin/newgrp
            *-rwxr-sr-x	1 root     tty	8328	Sep	9	01:01	/usr/bin/write
            -rwsr-xr-x	1 root     root	21816	Sep	10	16:03	/usr/bin/crontab
            *-rwsr-xr-x	1 root     root	5896	Nov	23	21:59	/usr/sbin/usernetctl
            *-rwsr-xr-x	1 root     bin	16488	Jul	2	10:21	/usr/sbin/traceroute
            -rwxr-sr-x	1 root     utmp	6096	Sep	13	20:11	/usr/sbin/utempter
            -rwsr-xr-x	1 root     root	14124	Aug	17	22:31	/bin/su
            *-rwsr-xr-x	1 root     root	53620	Sep	13	20:26	/bin/mount
            *-rwsr-xr-x	1 root     root	26700	Sep	13	20:26	/bin/umount
            *-rwsr-xr-x	1 root     root	18228	Sep	10	16:04	/bin/ping
            *-rwxr-sr-x	1 root     root	3860	Nov	23	21:59	/sbin/netreport
            -r-sr-xr-x	1 root     root	26309	Oct	11	20:48	/sbin/pwdb_chkpwd
            </pre><p>
            
            </p><p>
            To disable the suid bits on selected programs above, type the following commands:
</p><pre class="screen">
            [root@deep] /# <span class="command"><strong>chmod</strong></span> a-s /usr/bin/chage
            [root@deep] /# <span class="command"><strong>chmod</strong></span> a-s /usr/bin/gpasswd
            [root@deep] /# <span class="command"><strong>chmod</strong></span> a-s /usr/bin/wall
            [root@deep] /# <span class="command"><strong>chmod</strong></span> a-s /usr/bin/chfn
            [root@deep] /# <span class="command"><strong>chmod</strong></span> a-s /usr/bin/chsh
            [root@deep] /# <span class="command"><strong>chmod</strong></span> a-s /usr/bin/newgrp
            [root@deep] /# <span class="command"><strong>chmod</strong></span> a-s /usr/bin/write
            [root@deep] /# <span class="command"><strong>chmod</strong></span> a-s /usr/sbin/usernetctl
            [root@deep] /# <span class="command"><strong>chmod</strong></span> a-s /usr/sbin/traceroute
            [root@deep] /# <span class="command"><strong>chmod</strong></span> a-s /bin/mount
            [root@deep] /# <span class="command"><strong>chmod</strong></span> a-s /bin/umount
            [root@deep] /# <span class="command"><strong>chmod</strong></span> a-s /bin/ping
            [root@deep] /# <span class="command"><strong>chmod</strong></span> a-s /sbin/netreport
</pre><p>
             
             </p><div class="example"><a name="idm4016"></a><p class="title"><b>Example 5.4. Use man pages</b></p><div class="example-contents"><p>
            If you want to know what those programs do, type <strong class="userinput"><code>man program-name</code></strong> and read the man page.
            </p><pre class="screen">          
            [root@deep] /# <span class="command"><strong>man</strong></span> netreport
            </pre><p>
            </p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4022"></a>24. 
            The kernel tunable parameters</h2></div></div></div><p>
            With the new version of Red Hat Linux 6.2 all kernel parameters available under the /proc/sys subdirectory of Linux can be configured at runtime. You can now use the 
            new <code class="filename">/etc/sysctl.conf</code> file under Red Hat Linux 6.2 to modify and set kernel parameters at runtime. The sysctl.conf file is read and loaded each time the system reboots. All 
            settings are now stored in the <code class="filename">/etc/sysctl.conf</code> file. All modifications to /proc/sys should be made through /etc/sysctl.conf, because they offer better for control, and 
            are executed before rc.local or any other users scripts. We have shown you the networking security options that you must configure on your server for both Red Hat Linux 
            version 6.1 and 6.2 below.
            </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm4027"></a>24.1. Prevent your system responding to Ping</h3></div></div></div><p>
             </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
            Preventing your system for responding to ping request can be a big improvement in your network security since no one can ping on your server and receive an answer. The TCP/IP 
            protocol suite has a number of loopholes that allows an attacker to leverage techniques in the form of covert channels to surreptitiously pass data in otherwise benign 
            packets. Preventing your server from responding to ping requests can help to minimize this problem.
            An...
            </p><pre class="screen">
            [root@deep] /#<span class="command"><strong>echo</strong></span> 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all
            </pre><p>
            ... should do the job such that your system won't respond to ping on any interface. You can add this line in your /etc/rc.d/rc.local file so the command will be automatically set if your system reboots. Not responding to pings would at least keep most "crackers" out because they would never even know it's there.
            To turn it backs on, simply do this:
            </p><pre class="screen">
            [root@deep] /#<span class="command"><strong>echo</strong></span> 0 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all
            </pre><p>
            You can add this line in your <code class="filename">/etc/rc.d/rc.local</code> file so the command will be automatically set if your system reboots.
            </p><p>
            </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
            Edit the /etc/sysctl.conf file and add the following line:
            </p><pre class="programlisting">
            # Enable ignoring ping request
            net.ipv4.icmp_echo_ignore_all = 1
            </pre><p>
            
            You must restart your network for the change to take effect. The command to restart the network is the following:
            To restart all network devices manually on your system, use the following command:
            </p><pre class="screen">
            [root@deep] /# /etc/rc.d/init.d/network restart
            </pre><p>
            </p><div class="literallayout"><p><code class="computeroutput"><br>
            Setting network parameters		[  OK  ]<br>
            Bringing up interface lo		[  OK  ]<br>
            Bringing up interface eth0	        [  OK  ]<br>
            Bringing up interface eth1	        [  OK  ]<br>
            </code></p></div><p>
            </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4050"></a>25. Refuse responding to broadcasts request</h2></div></div></div><p>
              As for the ping request, it's also important to disable broadcast request. When a packet is sent to an <acronym class="acronym">IP</acronym> broadcast address (i.e. 192.168.1.255) from a machine on the 
              local network, that packet is delivered to all machines on that network. Then all the machines on a network respond to this ICMP echo request and the result can be 
              severe network congestion or outages <span class="emphasis"><em>-denial-of-service</em></span> attacks. See the <acronym class="acronym">RFC</acronym> 2644 for more information.

              </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
                 </p><pre class="screen">
              [root@deep] /# <span class="command"><strong>echo</strong></span> 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts
              </pre><p>
              You can add this line in your <code class="filename">/etc/rc.d/rc.local</code> file so the command will be automatically set 
              if your system reboots.
              </p><p>
               </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
              Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
              </p><pre class="programlisting">
              # Enable ignoring broadcasts request
              net.ipv4.icmp_echo_ignore_broadcasts = 1
              </pre><p>
              
              You must restart your network for the change to take effect. The command to restart the network is the following:
              </p><p>
              To restart all networks devices manually on your system, use the following command:
              </p><pre class="screen">
              [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
              </pre><p>
              </p><div class="literallayout"><p><code class="computeroutput"><br>
              Setting network parameters	  [  OK  ]<br>
              Bringing up interface lo		  [  OK  ]<br>
              Bringing up interface eth0	  [  OK  ]<br>
              Bringing up interface eth1	  [  OK  ]<br>
              </code></p></div><p>
              </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4077"></a>26. Routing Protocols</h2></div></div></div><p>
              Routing and routing protocols can create several problems. The <acronym class="acronym">IP</acronym> source routing, where an <acronym class="acronym">IP</acronym> packet contains details of the path to its intended destination, is dangerous because 
              according to <acronym class="acronym">RFC</acronym> 1122 the destination host must respond along the same path. If an attacker was able to send a source routed packet into your network, then he would be able to 
              intercept the replies and fool your host into thinking it is communicating with a trusted host. I strongly recommend that you disable IP source routing to protect your server from this hole.
              </p><p>
              To disable IP source routing on your server, type the following command in your terminal:
               </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
               </p><pre class="programlisting">
              [root@deep] /# for f in /proc/sys/net/ipv4/conf/*/accept_source_route; do
              &gt; echo 0 &gt; $f
              &gt; done
              </pre><p>
              </p><pre class="screen">
              [root@deep] /#
              </pre><p>
              
              Add the above commands to the <code class="filename">/etc/rc.d/rc.local</code> script file and you'll not have to type it again the next time you reboot your system.
             </p><p>
                  </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
                               
              Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
              </p><pre class="programlisting">
              # Disables IP source routing
              net.ipv4.conf.all.accept_source_route = 0
              </pre><p>
              
              You must restart your network for the change to take effect. The command to restart the network is the following:
              </p><pre class="screen">
              [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
              </pre><p>
              </p><div class="literallayout"><p><code class="computeroutput"><br>
              Setting network parameters	[  OK  ]<br>
              Bringing up interface lo		[  OK  ]<br>
              Bringing up interface eth0	[  OK  ]<br>
              Bringing up interface eth1	[  OK  ]<br>
             </code> </p></div><p>
               Take Note that the above command for Red Hat Linux 6.1 or 6.2 will disable Source Routed Packets on 
               all your interfaces lo, ethN, pppN etc.
               </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4104"></a>27. Enable TCP SYN Cookie Protection</h2></div></div></div><p>
            A <acronym class="acronym">SYN</acronym> Attack is a denial of service <acronym class="acronym">DoS</acronym> attack that consumes all the resources on your machine, forcing you to reboot. Denial of service attacks -attacks which incapacitate a server due to high 
            traffic volume or ones that tie-up system resources enough that the server cannot respond to a legitimate connection request from a remote system) are easily achievable from internal resources 
            or external connections via extranets and Internet. To enable it, you have to do: 
            </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1.only"></div><p>
                 </p><pre class="screen">
            [root@deep] /# echo 1 &gt; /proc/sys/net/ipv4/tcp_syncookies
            </pre><p>
            Add the above commands to the <code class="filename">/etc/rc.d/rc.local</code> script file and you'll not have to type it again the next time you reboot your system.
            </p><p>
              </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
            
            Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
            </p><pre class="programlisting">
            # Enable TCP SYN Cookie Protection
            net.ipv4.tcp_syncookies = 1
            </pre><p>
            
            You must restart your network for the change to take effect. The command to restart the network is the following:
            </p><pre class="screen">
            [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
            Setting network parameters		[  OK  ]
            Bringing up interface lo		[  OK  ]
            Bringing up interface eth0	        [  OK  ]
            Bringing up interface eth1	        [  OK  ]
            </pre><p>            
            If you receive an error message during execution of the above command, check that you have enabled the <acronym class="acronym">TCP</acronym> syncookies option in your kernel configuration: 
            <code class="computeroutput">IP: TCP syncookie support</code> <span class="emphasis"><em>not enabled per default</em></span> <span class="command"><strong>CONFIG_SYN_COOKIES</strong></span> <code class="literal">Y/n/?</code>.

            </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4131"></a>28. Disable ICMP Redirect Acceptance</h2></div></div></div><p>
              When hosts use a non-optimal or defunct route to a particular destination, an ICMP redirect packet is used by routers to inform the hosts what the correct route 
              should be. If an attacker is able to forge <acronym class="acronym">ICMP</acronym> redirect packets, he or she can alter the routing tables on the host and possibly subvert the 
              security of the host by causing traffic to flow via a path you didn't intend. It's strongly recommended to disable <acronym class="acronym">ICMP</acronym> Redirect Acceptance to 
              protect your server from this hole.
              </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="version 6.1 only"></div><p>
             </p><pre class="programlisting">
              [root@deep] /# for f in /proc/sys/net/ipv4/conf/*/accept_redirects; do
              &gt; echo 0 &gt; $f
              &gt; done
              </pre><p>
              </p><pre class="screen">
              [root@deep] /#
              </pre><p>
              
              Add the above commands to the <code class="filename">/etc/rc.d/rc.local</code> script file and you'll not have to type it again the next time you reboot your system.
              </p><p>
              </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
              Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
              </p><pre class="programlisting">
              # Disable ICMP Redirect Acceptance
              net.ipv4.conf.all.accept_redirects = 0
              </pre><p>
              
              You must restart your network for the change to take effect. The command to restart manually the network is the following:

              </p><pre class="screen">
              [root@deep] /# /etc/rc.d/init.d/network restart
              Setting network parameters	[  OK  ]
              Bringing up interface lo		[  OK  ]
              Bringing up interface eth0	[  OK  ]
              Bringing up interface eth1	[  OK  ]
              </pre><p>
              Take Note that the above command for Red Hat Linux 6.1 or 6.2 will disable Redirect Acceptance Packets on all 
              your interfaces lo, ethN, pppN etc.

             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4153"></a>29. Enable always-defragging Protection</h2></div></div></div><p>
            </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
            This protection must be enabled if you use your Linux server as a gateway to masquerade internal traffic to the Internet <acronym class="acronym">IP</acronym> Masquerading.
            </p><pre class="screen">
            [root@deep] /#<span class="command"><strong>echo</strong></span> 1 &gt; /proc/sys/net/ipv4/ip_always_defrag
            </pre><p>
            Add the above commands to the <code class="filename">/etc/rc.d/rc.local</code> script file and you'll not have to type it again the next time you reboot your system.
            </p><p>
            </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
            Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
            </p><pre class="programlisting">
            # Enable always defragging Protection
            net.ipv4.ip_always_defrag = 1
            </pre><p>
            
            You must restart your network for the change to take effect. The command to manually restart the network is the following:

            </p><pre class="screen">
            [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
            Setting network parameters	  [  OK  ]
            Bringing up interface lo	  [  OK  ]
            Bringing up interface eth0	  [  OK  ]
            Bringing up interface eth1	  [  OK  ]
            </pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4175"></a>30. Enable bad error message Protection</h2></div></div></div><p>
                </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
              This option will alert you to all bad error messages in your network.

              </p><pre class="screen">
              [root@deep] /#<span class="command"><strong>echo</strong></span> 1 &gt; /proc/sys/net/ipv4/icmp_ignore_bogus_error_responses
              </pre><p>
              Add the above commands to the <code class="filename">/etc/rc.d/rc.local</code> script file and you'll not have to type it again the next time you 
              reboot your system.
              </p><p>
              Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
              </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
             </p><pre class="programlisting">
              # Enable bad error message Protection
              net.ipv4.icmp_ignore_bogus_error_responses = 1
              </pre><p>
              
              You must restart your network for the change to take effect. The command to manually restart the network is the following:

              </p><pre class="screen">
              [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
              Setting network parameters 	[  OK  ]
              Bringing up interface lo		[  OK  ]
              Bringing up interface eth0	[  OK  ]
              Bringing up interface eth1	[  OK  ]
              </pre><p>
              </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4196"></a>31. Enable <acronym class="acronym">IP</acronym> spoofing protection</h2></div></div></div><p>
              The spoofing protection prevents your network from being the source of spoofed <abbr class="abbrev">i.e.</abbr> forged communications that are 
              often used in <acronym class="acronym">DoS</acronym> attacks.

              </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
              </p><pre class="programlisting">
              [root@deep] /# for f in /proc/sys/net/ipv4/conf/*/rp_filter; do
              &gt; echo 1 &gt; $f
              &gt; done
              </pre><p>
              </p><pre class="screen">
              [root@deep] /#
              </pre><p>
              
              Add the above commands to the <code class="filename">/etc/rc.d/rc.local</code> script file and you'll not have to type it again the next time 
              you reboot your system.
              </p><p>
              </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
              Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
              </p><pre class="programlisting">
              # Enable <acronym class="acronym">IP</acronym> spoofing protection, turn on Source Address Verification
              net.ipv4.conf.all.rp_filter = 1
              </pre><p>
              
              You must <span class="command"><strong>restart</strong></span> your network for the change to take effect. The command to manually restart the network 
              is the following:

              </p><pre class="screen">
              [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
              Setting network parameters	[  OK  ]
              Bringing up interface lo		[  OK  ]
              Bringing up interface eth0	[  OK  ]
              Bringing up interface eth1	[  OK  ]
              </pre><p>
              </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4222"></a>32. Log Spoofed, Source Routed and Redirect Packets</h2></div></div></div><p>
            This protection will log all Spoofed Packets, Source Routed Packets, and Redirect Packets to your log files.
            </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
            </p><pre class="programlisting">
            [root@deep] /# for f in /proc/sys/net/ipv4/conf/*/log_martians; do
            &gt; echo 1 &gt; $f
            &gt; done
            </pre><p>
            </p><pre class="screen">
            [root@deep] /#
            </pre><p>
           
            Add the above commands to the <code class="filename">/etc/rc.d/rc.local</code> script file and you'll not have to type it again the next time 
            you reboot your system.
            </p><p>
            </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
            Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
           </p><pre class="programlisting">
            # Log Spoofed Packets, Source Routed Packets, Redirect Packets
            net.ipv4.conf.all.log_martians = 1
            </pre><p>
            
            You must restart your network for the change to take effect. The command to manually restart the network is the following:

             </p><pre class="screen">
            [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
            Setting network parameters	     [  OK  ]
            Bringing up interface lo	     [  OK  ]
            Bringing up interface eth0	     [  OK  ]
            Bringing up interface eth1	     [  OK  ]
            </pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4243"></a>33. Unusual or hidden files</h2></div></div></div><p>
            It is important to not forget to look everywhere on the system for unusual or hidden files -files that start with a period and are normally not shown by 
            the <span class="command"><strong>ls</strong></span> command, as these can be used to hide tools and information password cracking programs, password files from other systems, etc.. 
            A common technique on UNIX systems is to put a hidden directory or file in a user's account with an unusual name, something like '...' or '.. ' -dot dot space 
            or <span class="keycap"><strong>..</strong></span>+<span class="keycap"><strong>^G</strong></span> -dot dot ctrl-G. 
            The find program can be used to look for hidden files.
            </p><div class="example"><a name="idm4250"></a><p class="title"><b>Example 5.5. Use find to find</b></p><div class="example-contents"><p>
              </p><pre class="screen">
            [root@deep] /# <span class="command"><strong>find</strong></span> / -name ".. " -print -xdev
            [root@deep] /# <span class="command"><strong>find</strong></span> / -name ".*" -print -xdev | cat -v
            </pre><p>
            </p></div></div><br class="example-break"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
            Files with names such as <code class="literal">.xx</code> and <code class="literal">.mail</code> have been used that is, files that might appear to be normal.
            </p></div><p>
            All <acronym class="acronym">SUID</acronym> and <acronym class="acronym">SGID</acronym> files that still exist on your system after we have removed those that won't absolutely require such privilege 
            are a potential security risk, and should be monitored closely. Because these programs grant special privileges to the user who is executing them, it is necessary to 
            ensure that insecure programs are not installed. 
            </p><p>
            A favorite trick of crackers is to exploit <acronym class="acronym">SUID</acronym> root programs, and leave a <acronym class="acronym">SUID</acronym> program as a backdoor to get in the next time. Find all <acronym class="acronym">SUID</acronym> 
            and <acronym class="acronym">SGID</acronym> programs on your system, and keep track of what they are so that you are aware of any changes, which could indicate a potential intruder.
            Use the following command to find all <acronym class="acronym">SUID/SGID</acronym> programs on your system:
            </p><pre class="screen">
            [root@deep] /# <span class="command"><strong>find</strong></span> / -type f \( -perm -04000 -o -perm -02000 \) \-exec ls -lg {} \;
            </pre><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
            See in this book under <a class="link" href="#prt5ch2ssmt" title="Chapter 14. Software -Security/Monitoring">Securities Software/Monitoring Tools</a> for more information about the software <a class="xref" href="#prt5ch2s1Xd" title="1. sXid">sXid</a>that will do the job for you automatically each day and report the results via mail.
            </p></div><p>
            Group and world writable files and directories particularly system files partitions, can be a security hole if a cracker gains access to your system and modifies them. Additionally, world-writable 
            directories are dangerous, since they allow a cracker to add or delete files as he or she wishes in these directories. In the normal course of operation, several files will be writable, including 
            some from the <code class="filename">/dev, /var/catman</code> directories, and all symbolic links on your system.
            To locate all group &amp; world-writable files on your system, use the command:
            </p><pre class="screen">
            [root@deep] /# <span class="command"><strong>find</strong></span> / -type f \( -perm -2 -o -perm -20 \) -exec ls -lg {} \;
            </pre><p>
            To locate all group &amp; world-writable directories on your system, use the command:
            </p><pre class="screen">
            [root@deep] /# <span class="command"><strong>find</strong></span> / -type d \( -perm -2 -o -perm -20 \) -exec ls -ldg {} \;
            </pre><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
            A file and directory integrity checker like Tripwire software can be used regularly to scan, manage and find modified group or world writable files and directories easily. See in this book under <a class="link" href="#prt5ch2ssmt" title="Chapter 14. Software -Security/Monitoring">Securities Software/Monitoring Tools</a> 
            for more information about Tripwire.
            </p></div><p>
            Don't permit any unowned file. Unowned files may also be an indication that an intruder has accessed your system. If you find unowned file or directory on your system, verify its integrity, and 
            if all looks fine, give it an owner name. Some time you may uninstall a program and get an unowned file or directory related to this software; in this case you can remove the file or directory safely.
            To locate files on your system that do not have an owner, use the following command:
            </p><pre class="screen">
            [root@deep] /#<span class="command"><strong>find</strong></span> / -nouser -o -nogroup
            </pre><p>
            Please Note Once again, files reported under <code class="filename">/dev</code> directory don't count.

            </p><p>
            Finding all the <code class="filename">.rhosts</code> files that could exist on your server should be a part of your regular system administration duties, as these files should not be permitted on your system. Remember that a cracker 
            only needs one insecure account to potentially gain access to your entire network.
            You can locate all <code class="filename">.rhosts</code> files on your system with the following command:
            </p><pre class="screen">
            [root@deep] /#<span class="command"><strong>find</strong></span> /home -name .rhosts
            </pre><p>
           
            You can also use a cron job to periodically check for, report the contents of, and delete <code class="filename">$HOME/.rhosts</code> files. Also, users should be made aware that you regularly perform this type 
            of audit, as directed by policy.
             </p><p>
            To use a cron job to periodically check and report via mail all <code class="filename">.rhosts</code> files, do the following:
            Create as root the <code class="filename">find_rhosts_files</code> script file under <code class="filename">/etc/cron.daily</code> directory <strong class="userinput"><code>touch</code></strong> <code class="filename">/etc/cron.daily/find_rhosts_files</code> and add the following 
            lines in this script file:
            </p><pre class="programlisting">
            #!/bin/sh
            /usr/bin/find /home -name .rhosts | (cat &lt;&lt;EOF
            This is an automated report of possible existent .rhosts files on the server
            deep.openna.com, generated by the find utility command.

            New detected <code class="filename">.rhosts</code> files under the <code class="filename">/home</code> directory include:
            EOF
            cat
            ) | /bin/mail -s "Content of .rhosts file audit report" root
            </pre><p>
            
            Now make this script file executable, verify the owner, and change the group to root.
            </p><pre class="screen">
            [root@deep] /#<span class="command"><strong>chmod</strong></span> 755 /etc/cron.daily/find_rhosts_files
            [root@deep] /#<span class="command"><strong>chown</strong></span> 0.0 /etc/cron.daily/find_rhosts_files
            </pre><p>
            Each day mail will be sent to root with a subject: Content of .rhosts file audit report containing potential new <code class="filename">.rhosts</code> files.
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4325"></a>34. System is compromised !</h2></div></div></div><p>
              If you believe that your system has been compromised, contact <acronym class="acronym">CERT</acronym>  Coordination Center or your representative in <acronym class="acronym">FIRST</acronym> -Forum of Incident Response and Security Teams.
              </p><div class="address"><p><br>
              Internet Email: <code class="email">&lt;<a class="email" href="mailto:cert@cert.org">cert@cert.org</a>&gt;</code><br>
              CERT Hotline:<span class="phone">(+1) 412-268-7090</span><br>
              Facsimile:    <span class="fax">(+1) 412-268-6989</span><br>
              </p></div><p>
              <span class="emphasis"><em>
              CERT/CC personnel answer 8:00 a.m. to 8:00 p.m. EST (GMT 5)/EDT (GMT 4)) 
              on working days; they are on call for emergencies during other hours and on weekends and 
              holidays.
              </em></span>
              </p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="pr3ch6lglc"></a>Chapter 6. Linux General Optimization</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm4340">1. The /etc/profile file</a></span></dt><dt><span class="section"><a href="#prt3ch2sc2br">2. Benchmark Results</a></span></dt><dt><span class="section"><a href="#idm4486">3. Benchmark results-i586</a></span></dt><dt><span class="section"><a href="#idm4501">4. Benchmark results -i486
               </a></span></dt><dt><span class="section"><a href="#idm4516">5. The bdflush parameters</a></span></dt><dt><span class="section"><a href="#idm4592">6. The buffermem parameters</a></span></dt><dt><span class="section"><a href="#idm4644">7. The ip_local_port_range parameters</a></span></dt><dt><span class="section"><a href="#idm4674">8. The <code class="filename">/etc/nsswitch.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm4692">9. 
          The file-max parameter
            </a></span></dt><dt><span class="section"><a href="#idm4733">10. The ulimit parameter</a></span></dt><dt><span class="section"><a href="#pr2ch6scntm">11. The atime and noatime attribute</a></span></dt><dt><span class="section"><a href="#idm4832">12. Tuning <acronym class="acronym">IDE</acronym> Hard Disk Performance</a></span></dt><dt><span class="section"><a href="#idm4895">13. Better manage your <acronym class="acronym">TCP/IP</acronym> resources</a></span></dt></dl></div><div class="highlights"><p>
                 At this stage of your configuration, you should now have a Linux server optimally configured and secured. Our server contains the most essential package and programs installed to be able to work properly and the most essential 
                 general security configuration. Before we continue and begin to install the services we want to share with our clients/users, it is important to now tune our Linux server. The tuning we will perform in the 
                 following chapter will be applied to the whole system. It also applies to present as well as future programs, such as services that we will later install. 
                 </p><p>
                 Generally, if you don't use a x386 Intel processor, Red Hat Linux out 
                 of the box is not optimized for your specific CPU architecture, most people now run Linux on a Pentium processor. The sections below will guide you through different steps to optimize your Linux server for your specific 
                 processor, memory, and network, as well as your file system.
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4340"></a>1. The /etc/profile file</h2></div></div></div><p>
               The <code class="filename">/etc/profile</code> file contains system wide environment stuff and startup programs. All customizations that you put in this file will apply for the entire environment variable on your system, so putting optimization 
               flags in this file is a good choice. To squeeze the most performance from your x86 programs, you can use full optimization when compiling with the <code class="literal">-O9</code> flag. Many programs contain <code class="literal">-O2</code> in 
               the Makefile. <code class="literal">-O9</code> is the highest level of optimization. It will increase the size of what it produces, but it runs faster.
               </p><p>
               Please Note it is not always true that the <code class="literal">-O9</code> flag will make the best performance for your processor. If you have an x686 and above processor, surely, but below x686, not necessarily.
               </p><p>
               When compiling, use the <code class="envar">-fomit-frame-pointer</code> switch for any kind of processor you may have. This will use the stack for accessing variables. Unfortunately, debugging is almost impossible with this option. You can also use 
               the <code class="envar">-mcpu=cpu_type</code> and <code class="envar">-march=cpu_type</code> switch to optimize the program for the <acronym class="acronym">CPU</acronym> listed to the best of <acronym class="acronym">GCC's</acronym> ability. However, the resulting code will only be run able on 
               the indicated <acronym class="acronym">CPU</acronym> or higher.
               </p><p>
               The optimization options apply only when we compile and install a new program in our server. These 
               optimizations don't play any role in our Linux base system; it just tells our compiler to optimize the new programs that we will install with the optimization flags we have specified in the <code class="filename">/etc/profile</code> file.
               </p><p>
                  Below are the optimization flags that we recommend you put in your <code class="filename">/etc/profile</code> file depending on your <acronym class="acronym">CPU</acronym> architecture.
                  </p><div class="procedure"><a name="idm4361"></a><p class="title"><b>Procedure 6.1. Recommended optimization flags</b></p><ol class="procedure" type="1"><li class="step"><p>
               For <acronym class="acronym">CPU</acronym> i686 or <span class="hardware">PentiumPro, Pentium II, Pentium III</span>
               In the <code class="filename">/etc/profile</code> file, put this line for a PentiumPro, Pentium II and III Pro Processor family:
               </p><pre class="screen">
               <code class="envar">CFLAGS=-O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions</code>
               </pre><p>
               </p><p>
               For <acronym class="acronym">CPU</acronym> <span class="hardware">i586</span> or Pentium:
               In the <code class="filename">/etc/profile</code> file, put this line for a Pentium Processor family:
               </p><pre class="screen">
               <code class="envar">CFLAGS=-O3 -march=pentium -mcpu=pentium -ffast-math -funroll-loops -fomit-frame-pointer -fforce-mem -fforce-addr -malign-double -fno-exceptions</code>
               </pre><p>
               </p><p>
               For <acronym class="acronym">CPU</acronym> <span class="hardware">i486</span>:
               In the <code class="filename">/etc/profile</code> file, put this line for a <span class="hardware">i486</span> Processor family:
               </p><pre class="screen">
               <code class="envar">CFLAGS=-O3  -funroll-all-loops -malign-double -mcpu=i486 -march=i486 -fomit-frame-pointer -fno-exceptions</code>
               </pre><p>
               </p></li><li class="step"><p>
               Now after the selection of your <acronym class="acronym"><acronym class="acronym">CPU</acronym></acronym> settings <span class="hardware">-i686, i586, or i486</span> a bit further down in the <code class="filename">/etc/profile</code> file, 
               add  <code class="envar">CFLAGS LANG LESSCHARSET</code> to the export line:
               </p><pre class="screen">
               <span class="command"><strong>export</strong></span> <code class="envar">PATH PS1 HOSTNAME HISTSIZE HISTFILESIZE USER LOGNAME MAIL INPUTRC CFLAGS LANG LESSCHARSET</code>
               </pre><p>
               </p></li><li class="step"><p>
               Log out and log  back in; after this, the new <code class="envar">CFLAGS</code> environment variable is set, and software and other configure tool will recognize that. 
               Pentium Pro/II/III optimizations will only work with egcs or pgcc compilers. The egcs compiler is already installed on your Server by default 
               so you don't need to worry about it.
               </p></li></ol></div><p>
               Below is the explanation of the different optimization options we use:
               </p><div class="glosslist"><dl><dt><span class="glossterm">
                <code class="envar">-funroll-loops</code>
               </span></dt><dd class="glossdef"><p>
               The <code class="envar">-funroll-loops</code> optimization option will perform the optimization of loop unrolling and will do it only for loops whose number of iterations can be 
               determined at compile time or run time.
               </p></dd><dt><span class="glossterm"><code class="envar">-funroll-all-loops</code>
               </span></dt><dd class="glossdef"><p>
               The <code class="envar">-funroll-all-loops</code> optimization option will also perform the optimization of loop unrolling and is done for all loops.
               </p></dd><dt><span class="glossterm"><code class="envar">-ffast-math</code>
                 </span></dt><dd class="glossdef"><p>
               The <code class="envar">-ffast-math</code> optimization option will allow the GCC compiler, in the interest of optimizing code for speed, to violate 
               some <acronym class="acronym">ANSI</acronym> or <acronym class="acronym">IEEE</acronym> rules/specifications.
               </p></dd><dt><span class="glossterm"><code class="envar">-malign-double</code>
                 </span></dt><dd class="glossdef"><p>
               The <code class="envar">-malign-double</code> optimization option will control whether the <acronym class="acronym">GCC</acronym> compiler aligns double, long double, and long long variables on a two-word boundary or a one-word 
               boundary. This will produce code that runs somewhat faster on a Pentium at the expense of more memory.
               </p></dd><dt><span class="glossterm"><code class="envar">-mcpu=cpu_type</code>
                 </span></dt><dd class="glossdef"><p>
               The <code class="envar">-mcpu=cpu_type</code> optimization option will set the default <acronym class="acronym"><acronym class="acronym">CPU</acronym></acronym> to use for the machine type when scheduling instructions.
               </p></dd><dt><span class="glossterm"><code class="envar">-fforce-mem</code>
                 </span></dt><dd class="glossdef"><p>
               The <code class="envar">-fforce-mem</code> optimization option will produce better code by forcing memory operands to be copied into registers before doing arithmetic on them and by making 
               all memory references potential common subexpressions.
               </p></dd><dt><span class="glossterm"><code class="envar">-fforce-addr</code>
               </span></dt><dd class="glossdef"><p>
               The <code class="envar">-fforce-addr</code> optimization option will produce better code by forcing memory address constants to be copied into registers before doing arithmetic on them.
               </p></dd><dt><span class="glossterm"><code class="envar">-fomit-frame-pointer</code>
               </span></dt><dd class="glossdef"><p>
               The <code class="envar">-fomit-frame-pointer</code> optimization option, one of the most interesting, will allow the program to not keep the frame pointer in a register for functions that don't need one. This 
               avoids the instructions to save, set up and restores frame pointers; it also makes an extra register available in many functions and makes debugging impossible on most machines.
               </p></dd></dl></div><p>
               </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
               All future optimizations that we will describe in this book refer by default to a Pentium II/III <acronym class="acronym">CPU</acronym> family. So you must, if required, adjust the compilation flags for your specific <acronym class="acronym"><acronym class="acronym">CPU</acronym></acronym> processor type in 
               the <code class="filename">/etc/profile</code> file and also during your compilation time.
               </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prt3ch2sc2br"></a>2. Benchmark Results</h2></div></div></div><p>
             Summaries by Architecture:
             Depending on your processor architecture and the version of your compiler <acronym class="acronym">GCC/EGCS</acronym>, optimization results may vary. The charts below will help you to choose 
             the best compilation flags for your compiler/<acronym class="acronym"><acronym class="acronym">CPU</acronym></acronym> architecture.
             The compiler version installed on your Red Hat Linux version 6.1 and 6.2 is egcs 2.91.66, but be sure to check it even so before choosing your compiler 
             optimization options.
             </p><p>
             To verify the compiler version installed on your system, use the command:
             </p><pre class="screen">
             [root@deep] /#  egcs --version
             egcs-2.91.66
             </pre><p>
             All benchmark results, and future results, can be retrieved from the <acronym class="acronym">GCC</acronym> home page at the following address: <a class="link" href="#prtinxfp6" title="Benchmark Results">http://egcs.cygnus.com/</a>
             </p><p>
             For a Pentium II/III <acronym class="acronym"><acronym class="acronym">CPU</acronym></acronym> <span class="hardware">i686</span> with compiler version egcs-2.91.66, the best optimization options 
             would be:
             </p><pre class="screen">
             <code class="envar">CFLAGS=-O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions</code>
             </pre><p>
             </p><div class="mediaobject"><img src="images/i686.gif" alt="Otimization chart for i686"><div class="caption"><p>
             Comparitive analysis chart with the above mentioned flags 
             </p></div></div><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4486"></a>3. Benchmark results-i586</h2></div></div></div><p>
                 For a Pentium <acronym class="acronym"><acronym class="acronym">CPU</acronym></acronym> <span class="hardware">i586</span> with compiler version egcs-2.91.66, the best optimization options 
             would be:
             </p><pre class="screen">
             <code class="envar">CFLAGS=-O3 -march=pentium -mcpu=pentium -ffast-math -funroll-loops -fomit-frame-pointer -fforce-mem -fforce-addr -malign-double -fno-exceptions</code>
             </pre><p>
               </p><div class="mediaobject"><img src="images/i586.gif" alt="Otimization chart for i586"><div class="caption"><p>
               Comparitive analysis chart with the above mentioned flags 
               </p></div></div><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4501"></a>4. Benchmark results -i486
               </h2></div></div></div><p>
                 For a <span class="hardware">i486</span> <acronym class="acronym"><acronym class="acronym">CPU</acronym></acronym> with compiler version egcs-2.91.66, the best optimization options 
             would be:
             </p><pre class="screen">
             <code class="envar">CFLAGS=-O3  -funroll-all-loops -malign-double -mcpu=i486 -march=i486 -fomit-frame-pointer -fno-exceptions</code>
             </pre><p>
                 </p><div class="mediaobject"><img src="images/i486.gif" alt="Otimization chart for i486"><div class="caption"><p>
               Comparitive analysis chart with the above mentioned flags 
               </p></div></div><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4516"></a>5. The bdflush parameters</h2></div></div></div><p>
          The bdflush file is closely related to the operation of the virtual memory <acronym class="acronym">VM</acronym> subsystem of the Linux kernel and has a little influence on disk usage. This 
          file <code class="filename">/proc/sys/vm/bdflush</code> controls the operation of the bdflush kernel daemon. We generally tune this file to improve file system performance. By changing some 
          values from the default as shown below, the system seems more responsive; e.g. it waits a little more to write to disk and thus avoids some disk access contention.
          </p><p>
          The default setup for the bdflush parameters under Red Hat Linux is:
          <code class="computeroutput">"40 500 64 256 500 3000 500 1884 2"</code>

          To change the values of bdflush, type the following command on your terminal:

          </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>echo</strong></span> "100 1200 128 512 15 5000 500 1884 2"&gt;/proc/sys/vm/bdflush
          </pre><p>
          You may add the above commands to the <code class="filename">/etc/rc.d/rc.local</code> script file and you'll not have to type it again the 
          next time you reboot your system.
          </p><p>
          </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
          Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
           </p><pre class="programlisting">
          # Improve file system performance
          vm.bdflush = 100 1200 128 512 15 5000 500 1884 2
          </pre><p>
          
          You must restart your network for the change to take effect. The command to manually restart the network is the following:

          </p><pre class="screen">
          [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
          </pre><p>
          </p><div class="literallayout"><p><code class="computeroutput"><br>
          Setting network parameters	 [  OK  ]<br>
          Bringing up interface lo	 [  OK  ]<br>
          Bringing up interface eth0	 [  OK  ]<br>
          Bringing up interface eth1	 [  OK  ]<br>
          </code></p></div><p>
          
          </p><p>
          In our example above, according to <code class="filename">the/usr/src/linux/Documentation/sysctl/vm.txt</code> file- 
          </p><div class="glosslist"><dl><dt><span class="glossterm">The first parameter 100 %</span></dt><dd class="glossdef"><p>
          governs the maximum number of 
          dirty buffers in the buffer cache. Dirty means that the contents of the buffer still have to be written to disk as opposed to a clean buffer, which can just be 
          forgotten about. Setting this to a high value means that Linux can delay disk writes for a long time, but it also means that it will have to do a lot of I/O at once 
          when memory becomes short. A low value will spread out disk I/O more evenly.
          </p></dd><dt><span class="glossterm">The second parameter 1200 <span class="emphasis"><em>ndirty</em></span></span></dt><dd class="glossdef"><p>
          This gives the maximum number of dirty buffers that bdflush can write to the disk in one time. A high value will mean delayed, bursty I/O, while a small value can 
          lead to memory shortage when bdflush isn't woken up often enough.
          </p></dd><dt><span class="glossterm">The third parameter 128 <span class="emphasis"><em>nrefill</em></span></span></dt><dd class="glossdef"><p>
          This is the number of buffers that bdflush will add to the list of free buffers when refill_freelist() is called. It is necessary to allocate free buffers 
          beforehand, since the buffers often are of a different size than memory pages and some bookkeeping needs to be done beforehand. The higher the number, the 
          more memory will be wasted and the less often refill_freelist() will need to run.
          </p></dd><dt><span class="glossterm"><span class="emphasis"><em>refill_freelist()</em></span> 512</span></dt><dd class="glossdef"><p>
          When this comes across more than nref_dirt dirty buffers, it will wake up bdflush.
          </p></dd><dt><span class="glossterm"><span class="emphasis"><em>age_buffer</em></span> <code class="literal">50*HZ</code>, <span class="emphasis"><em>age_super</em></span> parameters <code class="literal">5*HZ</code></span></dt><dd class="glossdef"><p>
          Finally, the <span class="emphasis"><em>age_buffer</em></span> <code class="literal">50*HZ</code> and <span class="emphasis"><em>age_super</em></span> parameters <code class="literal">5*HZ</code> govern the maximum time Linux waits before writing out a dirty buffer to disk. The value is expressed 
          in jiffies (clockticks); the number of jiffies per second is 100. <span class="emphasis"><em>Age_buffer</em></span> is the maximum age for data blocks, while <span class="emphasis"><em>age_super</em></span> is for file system metadata.
          </p></dd><dt><span class="glossterm">
          The fifth 15 and the last two parameters 1884 and 2
          </span></dt><dd class="glossdef"><p>
          These are unused by the system so we don't need to change the default ones.
          </p></dd></dl></div><p>
          </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
          Look at <code class="filename">/usr/src/linux/Documentation/sysctl/vm.txt</code> for more information on how to improve kernel parameters related to virtual memory.
          </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4592"></a>6. The buffermem parameters</h2></div></div></div><p>
            The buffermem file is also closely related to the operation of the virtual memory <acronym class="acronym">VM</acronym> subsystem of the Linux kernel. The value in this 
            file <code class="filename">/proc/sys/vm/buffermem</code> controls how much memory should be used for buffer memory in percentage. It is important to note that the percentage 
            is calculated as a percentage of total system memory.
            </p><p>
            The default setup for the buffermem parameters under Red Hat Linux is:
            <code class="computeroutput">"2 10 60"</code>
            </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
            To change the values of buffermem, type the following command on your terminal:

            </p><pre class="screen">
            [root@deep] /# <span class="command"><strong>echo</strong></span> "70 10 60" &gt;/proc/sys/vm/buffermem
            </pre><p>
            You may add the above commands to the <code class="filename">/etc/rc.d/rc.local</code> script file and you'll not have to type it again the next time you reboot your system.
            </p><p>
            </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
            
            Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
            </p><pre class="screen">
            # Improve virtual memory performance
            vm.buffermem = 70 10 60
            </pre><p>
            You must restart your network for the change to take effect. The command to manually restart the network is the following:
            </p><pre class="screen">
            [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
            </pre><p>            
            </p><div class="literallayout"><p><code class="computeroutput"><br>
            Setting network parameters	     [  OK  ]<br>
            Bringing up interface lo	     [  OK  ]<br>
            Bringing up interface eth0	     [  OK  ]<br>
            Bringing up interface eth1	     [  OK  ]<br>
            </code></p></div><p>
            
            According to the <code class="filename">/usr/src/linux/Documentation/sysctl/vm.txt</code> file, the first parameter 80 % means to use a minimum of 80 percent of memory for the buffer cache; the minimum percentage 
            of memory that should be spent on buffer memory.The last two parameters 10 and 60 are unused by the system so we dont need to change the defaults.
            </p><p>
            Depending of the amount of RAM you have in the server the value of 80% may vary. When your server is highly loaded and when all application are used, you can know in detail how much memory are required and 
            used by the system. 80 % for the buffermem parameters seem to be too much for systems under 256 MB of RAM. Doing a  <span class="command"><strong>free</strong></span> <code class="literal">-m</code> command on the prompt your system will 
            display amount of free and used memory in the system. Once you have executed this command <span class="command"><strong>free</strong></span> -m, check for <code class="computeroutput">-/+ buffers/cache:</code>values 
            and get the one related to the minimal (-) to set your value for buffermem.
            </p><div class="example"><a name="idm4625"></a><p class="title"><b>Example 6.1. For 128 MB of RAM</b></p><div class="example-contents"><p>
                </p><pre class="programlisting">
              128 * 80% = 102.4 MB
              128 - 102.4 = 25.6 MB
              </pre><p>
              
                </p><pre class="screen">
                [root@deep] /#<span class="command"><strong>free</strong></span> -m
                </pre><p>
                </p><pre class="literallayout"><code class="computeroutput">
                              total       used       free     shared    buffers       cached
                Mem:            124        121          3         30         43           48
                -/+ buffers/cache:          29         95
                Swap:           128          2        126
                </code></pre><p>
                The result shows us that the <code class="computeroutput">-/+ buffers/cache:</code> need 29 MB at minimum to run the system properly and with 128 MB of RAM set at 80% we have only 25.6 MB available. Hmmm! problem, i guess.
                so we go back to the calculator again and do this:
                </p><pre class="programlisting">
                128 * 70% = 89.6
                128 - 89.6 = 38.4 MB                
              </pre><p>
               well solved good!.
              
            </p></div></div><br class="example-break"><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
            Look at <code class="filename">/usr/src/linux/Documentation/sysctl/vm.txt</code> for more information on how to improve kernel parameters related to virtual memory.
            </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4644"></a>7. The ip_local_port_range parameters</h2></div></div></div><p>
            The <code class="filename">/proc/sys/net/ipv4/ip_local_port_range</code> defines the local port range that is used by <acronym class="acronym">TCP</acronym> and <acronym class="acronym">UDP</acronym> traffic to choose the local 
            port. You will see in the parameters of this file two numbers: The first number is the first local port allowed for <acronym class="acronym">TCP</acronym> and <acronym class="acronym">UDP</acronym> traffic on the server, the 
            second is the last local port number. For high-usage systems you may change its default parameters to 32768-61000 -first-last.
            </p><p>
            The default setup for the ip_local_port_range parameters under Red Hat Linux is:
            <code class="computeroutput">"1024 4999"</code>
            </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
            To change the values of ip_local_port_range, type the following command on your terminal:

            </p><pre class="screen">
            [root@deep] /# <span class="command"><strong>echo</strong></span> "32768 61000" &gt;/proc/sys/net/ipv4/ip_local_port_range
            </pre><p>
            Add the above commands to the <code class="filename">/etc/rc.d/rc.local</code> script file and you'll not have to type it again the next time you reboot your system.
            </p><p>
            </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
            
            Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
            </p><pre class="screen">
            # Allowed local port range
            net.ipv4.ip_local_port_range = 32768 61000
            </pre><p>
            You must restart your network for the change to take effect. The command to manually restart the network is the following:
            </p><pre class="screen">
            [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
            </pre><p>
            </p><div class="literallayout"><p><code class="computeroutput"><br>
            Setting network parameters	    [  OK  ]<br>
            Bringing up interface lo	    [  OK  ]<br>
            Bringing up interface eth0	    [  OK  ]<br>
            Bringing up interface eth1	    [  OK  ]<br>
           </code> </p></div><p>
            
            </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4674"></a>8. The <code class="filename">/etc/nsswitch.conf</code> file</h2></div></div></div><p>
            The <code class="filename">/etc/nsswitch.conf</code> file is used to configure which services are to be used to determine information such 
          as hostnames, password files, and group files. The last two ones, <code class="filename">password</code> files, and <code class="filename">group</code> 
          files in our case are not used, since we don't use <acronym class="acronym">NIS</acronym> services on our server. Thus, we will focus on the hosts line in this file.
          </p><p>
          Edit the <code class="filename">nsswitch.conf</code> file vi <code class="filename">/etc/nsswitch.conf</code> and change the hosts line to read:
          </p><pre class="screen">
          "hosts:      dns files"
          </pre><p>
          Which means, for programs that want to resolve an address. They should use the dns feature first, and the <code class="filename">/etc/hosts</code> 
          file if the <acronym class="acronym">DNS</acronym> servers are not available or can't resolve the address.
          </p><p>
          Also, we would recommend deleting all instances of <acronym class="acronym">NIS</acronym> services from each line of this file unless you are 
          using <acronym class="acronym">NIS!</acronym> The result should look like this:
          </p><pre class="programlisting">
            passwd:files
            shadow:files
            group:files
            hosts:dns files
            bootparams:files
            ethers:files
            netmasks:files
            networks:files
            protocols:files
            rpc:files
            services:files
            automount:files
            aliases:files           
          </pre><p>

          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4692"></a>9. 
          The file-max parameter
            </h2></div></div></div><p>
          The file-max file <code class="filename">/proc/sys/fs/file-max</code> sets the maximum number of file-handles that the Linux kernel will allocate. We generally 
          tune this file to improve the number of open files by increasing the value of <code class="filename">/proc/sys/fs/file-max</code> to something reasonable 
          like 256 for every 4M of <acronym class="acronym"><acronym class="acronym">RAM</acronym></acronym> we have: i.e. for a machine with 128 MB of <acronym class="acronym"><acronym class="acronym">RAM</acronym></acronym>, set it to 8192 - 128/4=32 32*256=8192.
          </p><p>
          The default setup for the file-max parameter under Red Hat Linux is:
          <code class="computeroutput"> "4096"</code>
          To adjust the value of file-max to 128 MB of <acronym class="acronym"><acronym class="acronym">RAM</acronym></acronym>, type the following on your terminal:
          </p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
          
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>echo</strong></span> "8192" &gt;/proc/sys/fs/file-max
          </pre><p>
          Add the above commands to the <code class="filename">/etc/rc.d/rc.local</code> script file and you'll not have to type it again the next time your server reboots.
          </p><p>
            </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
          
          Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
          </p><pre class="screen">
          # Improve the number of open files
          fs.file-max = 8192
          </pre><p>
          You must restart your network for the change to take effect. The command to manually restart the network is the following:
                                                                                                                                    
          </p><pre class="screen">
          [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
          </pre><p>
          </p><div class="literallayout"><p><code class="computeroutput"><br>
          Setting network parameters	  [  OK  ]<br>
          Bringing up interface lo	  [  OK  ]<br>
          Bringing up interface eth0	  [  OK  ]<br>
          Bringing up interface eth1	  [  OK  ]<br>
          </code></p></div><p>
          
          </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
          When you regularly receive from your server a lot of messages with errors about running out of open files, you might want to raise this 
          limit. The default value is 4096. A file server or web server needs a lot of open files.
          </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4733"></a>10. The ulimit parameter</h2></div></div></div><p>
          Linux itself has a Max Processes per user limit. This feature allows us to control the number of processes an existing user on the server may be authorized 
          to have. To improve performance, we can safely set the limit of processes for the super-user root to be unlimited.
          Edit the <code class="filename">.bashrc</code> file vi <code class="filename">/root/.bashrc</code> and add the following line:
          </p><pre class="screen">
          <span class="command"><strong>ulimit</strong></span> -u unlimited
          </pre><p>
          You must exit and re-login from your terminal for the change to take effect. 
          </p><div class="informalexample"><pre class="screen">
          [root@deep] /# <span class="command"><strong>ulimit</strong></span> -a
           </pre><pre class="programlisting">
          core file size (blocks) 	1000000
          data seg size (kbytes)  	unlimited
          file size (blocks)	        unlimited
          max memory size (kbytes)	unlimited
          stack size (kbytes)	        8192
          cpu time (seconds)	        unlimited
          max user processes	        unlimited  <a name="rhomp1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
          pipe size (512 bytes)	        8
          open files	                1024
          virtual memory (kbytes)	2105343
          </pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#rhomp1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
          Make sure that when you type as root the command <span class="command"><strong>ulimit</strong></span> <code class="literal">-a</code> on your terminal, it shows <code class="envar">unlimited</code> next to 
          max user processes.
          </p></td></tr></table></div></div><p>
          </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
          You may also do <span class="command"><strong>ulimit</strong></span> <code class="literal">-u</code> unlimited at the command prompt instead of adding it to the <code class="filename">/root/.bashrc</code> file.
          </p></div><p>
          Increases the system limit on open files for instance a process on Red Hat 6.0 with kernel 2.2.5 could open at least 31000 file descriptors this way and a process on kernel 2.2.12 can open at 
          least 90000 file descriptors this way. The upper bound seems to be available memory. To increases the number of open files to 90000 for the root account do the following:

          Edit the <code class="filename">.bashrc file</code> vi <code class="filename">/root/.bashrc</code> and add the following line:
          </p><pre class="screen">
          <span class="command"><strong>ulimit</strong></span> -n 90000
          </pre><p>
          You must exit from your terminal and re-login for the change to take effect. 
          
          </p><p>
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>ulimit</strong></span> -a
          </pre><p>
          
            </p><pre class="programlisting">
          core file size (blocks)	1000000
          data seg size (kbytes)	unlimited
          file size (blocks)	        unlimited
          max memory size (kbytes)	unlimited
          stack size (kbytes)	        8192
          cpu time (seconds)	        unlimited
          max user processes	        unlimited
          pipe size (512 bytes)	        8
          open files	                90000   <a name="rhopf1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
          virtual memory (kbytes)	2105343
           </pre><p>
          </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#rhopf1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
          Make sure that when you type as root the command ulimit -a on your terminal, it 
          shows 90000 next to open files.
          </p></td></tr></table></div><p>
          
          </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
          In older 2.2 kernels, though, the number of open files per process is still limited to 1024, even with the above changes.
          </p></div><p>
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr2ch6scntm"></a>11. The atime and noatime attribute</h2></div></div></div><p>
           Linux records information about when files were created and last modified as well as when it was last accessed. There is a cost associated with recording the last access 
           time. The ext2 file system of Linux has an attribute that allows the super-user to mark individual files such that their last access time is not recorded. This may lead 
           to significant performance improvements on often accessed frequently changing files such as the contents of the <code class="filename">/var/spool/news</code> directory.
           </p><p>
           To set the attribute to a file, use:
           
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>chattr</strong></span> +A filename	 <a name="sctult1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
           </pre><p>
           </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#sctult1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
           <span class="emphasis"><em>For a specific file</em></span>
           </p></td></tr></table></div><p>
           
           </p><p>
           For a whole directory tree, do something like:

           </p><pre class="screen">
           [root@deep /root]#<span class="command"><strong>chattr</strong></span> -R +A  /var/spool/	  <a name="sctult2"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
           [root@deep /root]#<span class="command"><strong>chattr</strong></span> -R +A  /cache/		  <a name="sctult3"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
           [root@deep /root]#<span class="command"><strong>chattr</strong></span> -R +A /home/httpd/ona/   <a name="sctult4"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
           </pre><p>
           </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#sctult2"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
             <span class="emphasis"><em>For a news and mail</em></span>
           </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#sctult3"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
           <span class="emphasis"><em>For a proxy caches</em></span>
           </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#sctult4"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>
           <span class="emphasis"><em>For a web pages</em></span>
           </p></td></tr></table></div><p>

           </p><p>
           Linux has a special mount option for file systems called <span class="emphasis"><em>noatime</em></span> that can be added to each line that addresses one file system in the <code class="filename">/etc/fstab</code> file. If 
           a file system has been mounted with this option, reading accesses to the file system will no longer result in an update to the atime information associated with the file like 
           we have explained above. The importance of the noatime setting is that it eliminates the need by the system to make writes to the file system for files which are simply 
           being read. Since writes can be somewhat expensive, this can result in measurable performance gains. Note that the write time information to a file will continue to be updated 
           anytime the file is written to. In our example below, we will set the noatime option to our <code class="filename">/chroot</code> file system.
           </p><p>
           Edit the <code class="filename">fstab</code> file vi <code class="filename">/etc/fstab</code> and add in the line that refer to <code class="filename">/chroot</code>file system the noatime option after the 
           defaults option as show below:
           </p><pre class="screen">
            /dev/sda7          /chroot          ext2          defaults,noatime          1  2
           </pre><p>
           </p><p>
           You need not reboot your system for the change to take effect, just make the Linux system aware about the modification you have made to the <code class="filename">/etc/fstab</code> file. This can be accomplished 
           with the following commands:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>mount</strong></span> -oremount /chroot/
           </pre><p>
           </p><p>
           Then test your results with the flowing command:
           </p><pre class="screen">
           [root@deep]# <span class="command"><strong>cat</strong></span> /proc/mounts
           </pre><p>
           </p><div class="literallayout"><p><code class="computeroutput"><br>
           /dev/root /             ext2         rw 0 0<br>
           /proc      /proc        proc         rw 0 0<br>
           /dev/sda1  /boot        ext2         rw 0 0<br>
           /dev/sda8  /cache       ext2         rw 0 0<br>
           /dev/sda7  /chroot      ext2 rw,noatime 0 0<br>
           /dev/sda6  /home        ext2         rw 0 0<br>
           /dev/sda11 /tmp         ext2         rw 0 0<br>
           /dev/sda5  /usr         ext2         rw 0 0<br>
           /dev/sda9  /var         ext2         rw 0 0<br>
           none       /dev/pts   devpts         rw 0 0<br>
           </code></p></div><p>
           If you see something like:<code class="computeroutput"> /dev/sda7 /chroot ext2 rw,noatime 0 0</code>, congratulations!
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4832"></a>12. Tuning <acronym class="acronym">IDE</acronym> Hard Disk Performance</h2></div></div></div><p>
             Putting your swap partitions near the beginning of your drive, see <a class="link" href="#pr1ch25lk1">This chart to get a better idea,</a> may give you some acceptable improvement. The beginning of the drive is physically located on the outer portion of the 
             cylinder, and the read/write head can cover much more ground per revolution. We typically see partitions placed at the end of the drive work 3MB/s slower using the <strong class="userinput"><code>hdparm -t</code></strong> command.

             </p><p>
             Performance increases have been reported on massive disk I/O operations by setting the <acronym class="acronym"><acronym class="acronym">IDE</acronym></acronym> drivers to use DMA, 32-bit transfers and multiple sector modes. The kernel seems to use more conservative settings 
             unless told otherwise. The magic command to change the setting of your drive is <span class="command"><strong>hdparm</strong></span>.

             To enable 32-bit I/O over the <acronym class="acronym">PCI</acronym> buses, use the command:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong> /sbin/hdparm</strong></span> -c1 /dev/hda <span class="emphasis"><em>or hdb, hdc etc</em></span>.
             </pre><p>
             This will usually, depending on your <acronym class="acronym">IDE</acronym> Disk Drive model, cut the timing buffered disk reads time by 2. The <span class="citerefentry"><span class="refentrytitle">hdparm</span>(8)</span> manpage says that you may need to use -c 3 for some chipsets. All (E)<acronym class="acronym">IDE</acronym>
             drives still have only a 16-bit connection over the ribbon cable from the interface card.

             To enable <acronym class="acronym">DMA</acronym>, use the command:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong> /sbin/hdparm</strong></span> -d1 /dev/hda <span class="emphasis"><em>or hdb, hdc etc</em></span>.
             </pre><p>
             This may depend on support for your motherboard chipset being compiled into your kernel. Also, this command will enable <acronym class="acronym">DMA</acronym> support for your hard drive, it will cut the timing buffered disk reads time and 
             will improve the performance by 2.

             To enable multiword <acronym class="acronym">DMA</acronym> mode 2 transfers, use the command:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>/sbin/hdparm</strong></span> -d1 -X34 /dev/hda <span class="emphasis"><em>or hdb, hdc etc</em></span>.
             </pre><p>
             This sets the <acronym class="acronym"><acronym class="acronym">IDE</acronym></acronym> transfer mode for newer <acronym class="acronym">(E)<acronym class="acronym">IDE</acronym>/ATA2</acronym> drives. check your hardware manual to see if you have it.

             To enable Ultra<acronym class="acronym">DMA</acronym> mode2 transfers, use the command:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong> /sbin/hdparm</strong></span> -d1 -X66 /dev/hda <span class="emphasis"><em>or hdb, hdc etc</em></span>.
             </pre><p>
             </p><p>
             You'll need to prepare the chipset for Ultra<acronym class="acronym">DMA</acronym> beforehand. Also, see your manual page about hdparm for more information. Use this with extreme caution!

             To set multiple sector mode I/O, use the command:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>/sbin/hdparm</strong></span> -m XX /dev/hda <span class="emphasis"><em>or hdb, hdc etc</em></span>.
             </pre><p>
             Where XX is the maximum setting supported by your drive. The  -i flag can be used to find the maximum setting supported by an installed drive: look for MaxMultSect in the output.
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>/sbin/hdparm</strong></span> -i /dev/hda <span class="emphasis"><em>or hdb, hdc etc</em></span>.
             </pre><p>
             </p><p>
               </p><div class="informalexample"><pre class="literallayout"><code class="computeroutput">
             /dev/hda:

             Model=Maxtor 7540 AV, FwRev=GA7X4647, SerialNo=L1007YZS
             Config={ HardSect NotMFM HdSw&gt;15uSec Fixed DTR&gt;5Mbs FmtGapReq }
             RawCHS=1046/16/63, TrkSize=0, SectSize=0, ECCbytes=11
             BuffType=3(DualPortCache), BuffSize=32kB, MaxMultSect=8, MultSect=8
             DblWordIO=yes, maxPIO=2(fast), DMA=yes, maxDMA=1(medium)
             CurCHS=523/32/63, CurSects=379584528, LBA=yes, LBA=yes, LBAsects=1054368
             tDMA={min:150,rec:150}, DMA modes: sword0 sword1 *sword2 *mword0
             IORDY=on/off, tPIO={min:240,w/IORDY:180}, PIO modes: mode3
             
             </code>
             </pre></div><p>
             </p><p>
             Multiple sector mode aka <acronym class="acronym">IDE</acronym> Block Mode, is a feature of most modern <acronym class="acronym">IDE</acronym> hard drives, permitting the transfer of multiple sectors per I/O 
             interrupt, rather than the usual one sector per interrupt. When this feature is enabled, it typically reduces operating system overhead for disk I/O  by 30-50%. On many systems 
             it also provides increased data throughput of anywhere from 5% to 50%.

             You can test the results of your changes by running hdparm in performance test mode: 
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>/sbin/hdparm</strong></span> -t /dev/hda <span class="emphasis"><em>or hdb, hdc etc</em></span>.
             </pre><p>
             </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
             Once you have a set of hdparm options, you can put the commands in your <code class="filename">/etc/rc.d/rc.local</code> file to run it every time you reboot the machine. 
             </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm4895"></a>13. Better manage your <acronym class="acronym">TCP/IP</acronym> resources</h2></div></div></div><p>
             This hack just make the time default values for <acronym class="acronym">TCP/IP</acronym> connection lower so that more connections can be handled by time on your TCP/IP protocol. The following 
             will decrease the amount of time your Linux box will try take to finish closing a connection and the amount of time before it will kill a stale connection. 
             This will also turn off some <acronym class="acronym">IP</acronym> extensions that aren't needed.             
             The default setup for the <acronym class="acronym">TCP/IP</acronym> parameters we'll change under Red Hat Linux are:
             </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
             For the tcp_fin_timeout <code class="literal">180</code>
             </p></li><li class="listitem"><p>
             For the tcp_keepalive_time <code class="literal">7200</code>
             </p></li><li class="listitem"><p>
             For the tcp_window_scaling <code class="literal">1</code>
             </p></li><li class="listitem"><p>
             For the tcp_sack <code class="literal">1</code>
             </p></li><li class="listitem"><p>
             For the tcp_timestamps <code class="literal">1</code>
             </p></li></ul></div><p>
             </p><p>
             To adjust the new <acronym class="acronym">TCP/IP</acronym> values, type the following commands on your terminal:
             </p><div class="mediaobject"><img src="images/Version6.1.gif"></div><p>
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>echo</strong></span> 30 &gt;/proc/sys/net/ipv4/tcp_fin_timeout 
             [root@deep] /#<span class="command"><strong>echo</strong></span> 1800 &gt;/proc/sys/net/ipv4/tcp_keepalive_time 
             [root@deep] /#<span class="command"><strong>echo</strong></span> 0  &gt;/proc/sys/net/ipv4/tcp_window_scaling 
             [root@deep] /#<span class="command"><strong>echo</strong></span> 0  &gt;/proc/sys/net/ipv4/tcp_sack 
             [root@deep] /#<span class="command"><strong>echo</strong></span> 0  &gt;/proc/sys/net/ipv4/tcp_timestamps
             </pre><p>
             Execute the above commands and put them in your <code class="filename">/etc/rc.d/rc.local</code> file so you don't need to type them again each time your system reboots.
             </p><p>
              </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
             Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following lines:
             </p><pre class="programlisting">
             # Decrease the time default value for tcp_fin_timeout connection
             net.ipv4.tcp_fin_timeout = 30
             # Decrease the time default value for tcp_keepalive_time connection
             net.ipv4.tcp_keepalive_time = 1800
             # Turn off the tcp_window_scaling
             net.ipv4.tcp_window_scaling = 0
             # Turn off the tcp_sack
             net.ipv4.tcp_sack = 0
             # Turn off the tcp_timestamps
             net.ipv4.tcp_timestamps = 0
             </pre><p>
             
             You must restart your network for the change to take effect. The command to manually restart the network is the following:
                          
             </p><pre class="screen">
             [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
             </pre><p>
             </p><div class="literallayout"><p><code class="computeroutput"><br>
             Setting network parameters	    [  OK  ]<br>
             Bringing up interface lo	    [  OK  ]<br>
             Bringing up interface eth0	    [  OK  ]<br>
             Bringing up interface eth1	    [  OK  ]<br>
             </code></p></div><p>
             </p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="pr3ch7lnke"></a>Chapter 7. Configuring and Building a Secure, Optimized Kernel</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#prt3ch3sc1pi">1. Pre-Install</a></span></dt><dd><dl><dt><span class="section"><a href="#idm5018">1.1. Make an emergency boot floppy</a></span></dt></dl></dd><dt><span class="section"><a href="#idm5045">2.  Uninstallation and Optimization</a></span></dt><dt><span class="section"><a href="#idm5155">3. Securing the kernel</a></span></dt><dt><span class="section"><a href="#idm5235">4. Compilation</a></span></dt><dt><span class="section"><a href="#prt2sct35kcon">5. Kernel configuration -Part "A"</a></span></dt><dt><span class="section"><a href="#idm5390">6. Kernel configuration -Part "B"</a></span></dt><dt><span class="section"><a href="#idm5471">7. Kernel configuration -Part "C"</a></span></dt><dt><span class="section"><a href="#idm5538">8. Kernel configuration -Part "D"</a></span></dt><dt><span class="section"><a href="#idm5590">9. Kernel configuration -Part "E"</a></span></dt><dt><span class="section"><a href="#idm5643">10. Installing the new kernel</a></span></dt><dt><span class="section"><a href="#idm5761">11. Delete programs, Edit files pertaining to modules</a></span></dt><dt><span class="section"><a href="#idm5828">12. Create a emergency Rescue and Boot floppy disk</a></span></dt></dl></div><div class="highlights"><p>
                 
               Well, our Linux server seems to be getting in shape now! But wait, what is the most important part of our server? Yes, it's the kernel. The Linux kernel is the core of our operating 
               system, and without it there is no Linux at all. So we must take care of our kernel and configure it to fit our needs and compile just features we really need. The first thing to do 
               next is to build a kernel that best suits your system. It's very simple to do but, in any case, refer to the README file in the /usr/src/linux/ directory. When configuring your kernel 
               only compile in code that you need and use. Few main reasons that come to mind are;
               </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
               The Kernel will be faster less code to run, 
               </p></li><li class="listitem"><p>
               You will have more memory, Kernel parts are NEVER swapped to the virtual memory, 
               </p></li><li class="listitem"><p>
               More stable. Try probing for a non-existent card?, 
               </p></li><li class="listitem"><p>
               Unnecessary parts can be used by an attacker to gain access to the 
               machine or other machines on the network. 
               </p></li><li class="listitem"><p>
               Modules are also slower than support compiled directly in the kernel.
               </p></li></ul></div><p>
               </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prt3ch3sc1pi"></a>1. Pre-Install</h2></div></div></div><p>
               In our configuration and compilation we will build a monolithic kernel. Monolithic kernel means to only answer <strong class="userinput"><code>Yes</code></strong> or <strong class="userinput"><code>No</code></strong> to the 
               questions, <span class="emphasis"><em>don't make anything modular and omit the steps</em></span>:
               </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
               make_modules
               </p></li><li class="listitem" style="list-style-type: disc"><p>
               make_modules_install. 
               </p></li></ul></div><p>
               Also, we will patch our new kernel with the buffer overflow protection from kernel patches. Patches for the Linux kernel exist, like Solar Designer's non-executable stack patch, which disallows the execution of 
               code on the stack, making a number of buffer overflow attacks harder - and defeating completely a number of current exploits used by "script kiddies" worldwide.
               </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
               Remember to only answer <strong class="userinput"><code>Yes</code></strong> or <strong class="userinput"><code>No</code></strong> to the questions when configuring your new kernel if you're intending to build a monolithic kernel. If you intend to use firewall masquerading functions or a dial-up ppp connection, you 
               cannot build a monolithic kernel, since these function require the build of some modules, by default. Build, instead, a modularized kernel.
               </p></div><p>
               </p><p>
               A new kernel is very specific to your computer hardware, in the kernel configuration part; <span class="emphasis"><em>we are using the following hardware for our example</em></span>. Of course you must change them to fit your system components.
               </p><table border="0" summary="Simple list" class="simplelist"><tr><td> 
               1 Pentium II 400 MHz (i686) processor</td></tr><tr><td>
               1 Motherboard <acronym class="acronym">SCSI</acronym></td></tr><tr><td>
               1 Hard Disk <acronym class="acronym">SCSI</acronym></td></tr><tr><td>
               1 <acronym class="acronym">SCSI</acronym> Controler Adaptec AIC 7xxx</td></tr><tr><td>
               1 CD-ROM ATAPI <acronym class="acronym">IDE</acronym></td></tr><tr><td>
               1 Floppy Disk</td></tr><tr><td>
               2 Ethernet Cards Intel EtherExpressPro 10/100</td></tr><tr><td>
               1 Mouse PS/2</td></tr></table><p>
               </p><p>
               These installation instructions assume
               </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
               Commands are Unix-compatible.</td></tr><tr><td>
               The source path is <code class="filename">/usr/src.</code></td></tr><tr><td>
               Installations were tested on Red Hat Linux 6.1 and 6.2.</td></tr><tr><td>
               All steps in the installation will happen in super-user account root.</td></tr><tr><td>
               Latest Kernel version number is 2.2.14</td></tr><tr><td>
               Latest Secure Linux Kernel Patches version number is 2_2_14-ow2</td></tr></table><p>
               </p><p>
               All these below mentioned Packages were available in the following sites as of this writing but we suggest you can get additional information regarding mirror 
               sites by searching on their respective home pages.
               </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
               Kernel Homepage:<a class="link" href="#prtinxfp7" title="Pre-install">http://www.kernelnotes.org/</a>
               </p><p>
               Be sure to download: linux-2_2_14_tar.gz
               </p><p>
               Kernel <acronym class="acronym">FTP</acronym> Site: 139.142.90.113
               </p></li><li class="listitem"><p>
               Secure Linux Kernel Patches Homepage:<a class="link" href="#prtinxfp71">http://www.openwall.com/linux/</a>
               </p><p>
               You must be sure to download: linux-2_2_14-ow2_tar.gz
               </p><p>
               Secure Linux Kernel Patches <acronym class="acronym">FTP</acronym> Site: 195.42.162.180
               </p></li></ul></div><p>
               </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm5018"></a>1.1. Make an emergency boot floppy</h3></div></div></div><p>
                 The first of the pre-install step is to make an emergency boot floppy. Linux has a small utility named mkbootdisk to simply do this. The first step is to find out what kernel version, you are currently using. Check 
                 out your <code class="filename">/etc/lilo.conf</code> file and see which image was booted from and from this image, we can find the kernel version we need to make our emergency boot floppy. 
                 </p><pre class="screen">
                 [root@deep] /#<span class="command"><strong>cat</strong></span> /etc/lilo.conf
                 </pre><p>
                 </p><p>
                   In 
                 my example, I have the following in the <code class="filename">lilo.conf</code> file:
                   </p><div class="informalexample"><pre class="programlisting">                       
                 boot=/dev/sda
                 map=/boot/map
                 install=/boot/boot.b
                 prompt
                 timeout=50
                 image=/boot/vmlinuz-2.2.12-20	  <a name="lilcnf1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>	 
                 label=linux	 		  <a name="lilcnf2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>	 
                 root=/dev/sda6
                 initrd=/boot/initrd-2.2.12-20.img
                 read-only
                 </pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#lilcnf1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
                 <span class="emphasis"><em>the kernel version</em></span>
                 </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#lilcnf2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
                 <span class="emphasis"><em>the image we booted from</em></span>
                 </p></td></tr></table></div></div><p>
                 </p><p>
                 Now you'll need to find the image that you booted from. On a standard new first install, it will be the one-labeled linux. In the above example we show that the machine booted using 
                 the <code class="filename">/boot/vmlinuz-2.2.12-20</code> original kernel version of the system. Now we simply need to put a formatted 1.44 floppy in our system and execute the following command as root:
                 </p><pre class="screen">
                 [root@deep] /#<span class="command"><strong>mkbootdisk</strong></span> --device /dev/fd0 2.2.12-20
                 </pre><p>
                 </p><div class="literallayout"><p><br>
                   <code class="computeroutput"><br>
                 Insert a disk in /dev/fd0. Any information on the disk will be lost.<br>
                 Press &lt;Enter&gt; to continue or <span class="keycap"><strong>^C</strong></span> to abort:<br>
                 </code><br>
                 </p></div><p>
                 Following these guidelines, you will now have a boot floppy with a known working kernel in case of problems with the upgrade. I recommend rebooting the system with the floppy to 
                 make sure that the floppy works correctly.
                 </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm5045"></a>2.  Uninstallation and Optimization</h2></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
               We must copy the archive file of the Kernel to the <code class="filename">/usr/src</code> directory and move to this directory.
               </p><pre class="screen">
               [root@deep] /#<span class="command"><strong>cp</strong></span> linux-version_tar.gz /usr/src/
               [root@deep] /#<span class="command"><strong>cd</strong></span> /usr/src/
               </pre><p>
                              
               These steps are required only if you already have installed a Linux kernel with a tar archive before. If it is a first, fresh install of Linux kernel, then instead uninstall 
               the kernel-headers-version.i386.rpm, kernel-version.i386.rpm package that are on your system.
               Remove the Linux symbolic link with the following command:
               </p><pre class="screen">
               [root@deep ] /src#<span class="command"><strong>rm</strong></span> -rf linux
               </pre><p>
               Remove the Linux kernel headers directory with the following command:
               </p><pre class="screen">
               [root@deep ] /src#<span class="command"><strong>rm</strong></span> -rf linux-2.2.xx
               </pre><p>
               Remove the Linux kernel modules directory with the following command:
               </p><pre class="screen">
               [root@deep ] /src#<span class="command"><strong>rm</strong></span> -rf /lib/modules/2.2.xx
               </pre><p>
               </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
                 Removing the old kernel modules is required only if you have installed a modularized kernel version before. If the modules directory doesn't exist under 
               the <code class="filename">/lib</code> directory it's because your old kernel version is not a modularized kernel.
               </p></div><p>
               
               If the original kernels <acronym class="acronym">RPM</acronym> package are installed on your system instead of the Linux kernel tar archive, because you have just finished installing your new Linux system, or 
               have used an <acronym class="acronym">RPM</acronym> package before to upgrade your Linux system, then use the following command to uninstall the Linux kernel:
               You can verify that a kernel <acronym class="acronym">RPM</acronym> package is installed on your system with the following command:
               </p><pre class="screen">
               [root@deep ] /src#<span class="command"><strong>rpm</strong></span> -qa |<span class="command"><strong>grep</strong></span> kernel
               </pre><p>
               </p><div class="literallayout"><p><code class="computeroutput"><br>
               kernel-headers-2.2.xx.i386.rpm<br>
               kernel-2.2.xx.i386.rpm<br>
               </code><br>
               </p></div><p>               
               To uninstall the linux kernel <acronym class="acronym">RPM</acronym>, use the following command:
               </p><pre class="screen">
               [root@deep ] /src#<span class="command"><strong>rpm</strong></span> -e --nodeps kernel-headers kernel
               </pre><p>
               </p><div class="literallayout"><p><br>
               <code class="computeroutput"><br>
               cannot remove /usr/src/linux-2.2.xx - directory not empty<br>
               cannot remove /lib/modules/2.2.xx - directory not empty<br>
               </code><br>
               </p></div><p>
               </p><pre class="screen">
               [root@deep ] /src#<span class="command"><strong>rm</strong></span> -rf /usr/src/linux-2.2.xx/
               [root@deep ] /src#<span class="command"><strong>rm</strong></span> -rf /lib/modules/2.2.xx/
               </pre><p>
               In the steps below, we remove manually the empty <code class="filename">/usr/src/linux-2.2.xx</code> and <code class="filename">/lib/modules/2.2.xx</code> directories 
               after the uninstallation of the kernels <acronym class="acronym">RPM</acronym>, the <acronym class="acronym">RPM</acronym> uninstall program will not completely remove those directories.
               </p></li><li class="step"><p>
               
               Now, we must decompress the tar archive of the kernel and remove the Linux tar archive from the system.
               </p><pre class="screen">
               [root@deep ] /src#<span class="command"><strong>tar</strong></span> xzpf linux-version_tar.gz
               [root@deep ] /src#<span class="command"><strong>rm</strong></span> -f  linux-version_tar.gz
               </pre><p>
               </p></li><li class="step"><p>
               
               
               To increase the number of tasks allowed the maximum number of processes per user, you may need to edit the <code class="filename">/usr/src/linux/include/linux/tasks.h</code> file and 
               change the following parameters.
               
               Edit the tasks.h file, vi +14 <code class="filename">/usr/src/linux/include/linux/tasks.h</code> and change the following parameters:
               <code class="envar">NR_TASKS</code> from <strong class="userinput"><code>512</code></strong> to <strong class="userinput"><code>3072</code></strong> and <code class="envar">MIN_TASKS_LEFT_FOR_ROOT</code> from <strong class="userinput"><code>4</code></strong> to <strong class="userinput"><code>24</code></strong>
               
               </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p> 
               The value in the <code class="envar">NR_TASKS</code> line denotes the maximum number of tasks (processes) handles that the Linux kernel will allocate per users. Increasing this number will allow you to handle more connections from clients 
               on your server, example: an <acronym class="acronym">HTTP</acronym> web server will be able to serve more client connections. 
               Please don't forget, Linux is protected from allocation of all process slots for normal users. There is a special parameter 
               line <code class="envar">MIN_TASKS_LEFT_FOR_ROOT</code> reserved especially for the super-user root that you may set for the number of process reserved to root <code class="literal">-24</code> is a good value.
               </p></div><p>
               </p></li><li class="step"><p>
                              
               To optimize the Linux kernel to fit your specific <acronym class="acronym"><acronym class="acronym">CPU</acronym></acronym> architecture and optimization flags you may need to edit the <code class="filename">/usr/src/linux/Makefile</code> file and change the following parameters.
                </p><ol type="a" class="substeps"><li class="step"><p>
               Edit the Makefile file (vi +18 /usr/src/linux/Makefile) and change the line:
               <code class="envar">HOSTCC =gcc </code> to read:
               </p><pre class="screen">
               <code class="envar">HOSTCC =egcs</code>.
               </pre><p>
               </p></li><li class="step"><p>
               Edit the Makefile file, vi +25 <code class="filename">/usr/src/linux/Makefile</code> and change the line:
               <code class="envar">CC =$(CROSS_COMPILE)gcc D__KERNEL__ -I$(HPATH) </code> to read:
               </p><pre class="screen">
               <code class="envar">CC =$(CROSS_COMPILE)egcs D__KERNEL__ -I$(HPATH)</code>.
               </pre><p>
               </p></li><li class="step"><p>
               Edit the Makefile file vi +90 <code class="filename">/usr/src/linux/Makefile</code> and change the line:
               <code class="envar">CFLAGS = -Wall -Wstrict-prototypes -O2 -fomit-frame-pointer</code> to read:
               </p><pre class="screen">
               <code class="envar">CFLAGS = -Wall -Wstrict-prototypes -O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions</code>
               </pre><p>
               </p></li><li class="step"><p>
               Edit the Makefile file vi +19 <code class="filename">/usr/src/linux/Makefile</code> and change the line:
               <code class="envar">HOSTCFLAGS =-Wall -Wstrict-prototypes -O2 -fomit-frame-pointer</code> to read:
               </p><pre class="screen">
               <code class="envar">HOSTCFLAGS =-Wall -Wstrict-prototypes -O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions</code>
               </pre><p>
               </p></li></ol></li></ol></div><p>
               </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Important"></span>
</h3><p>
               These changes turn on aggressive optimization tricks that may or may not work with all kernels. Please, if the optimization flags above, or the ones you have chosen for your <acronym class="acronym">CPU</acronym> architecture do not 
               work for you, don't try to absolutely force it to work. I wouldn't want to make your system unstable like Microsoft Windows.
               </p></div><p>
               </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm5155"></a>3. Securing the kernel</h2></div></div></div><p>
             The secure Linux kernel patches from the Openwall Project are a great way to prevent attacks like Stack Buffer Overflows, and others. The Openwall patch is a collection of security-related features 
             for the Linux kernel, all configurable via the new Security options configuration section that will be added to your new Linux kernel. This patch may change from version to version, and some may 
             contain various other security fixes.
             </p><p>
             New features of patch version linux-2_2_14-ow2_tar.gz are:
             </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
             Non-executable user stack area
             </p></li><li class="listitem"><p>
             Restricted links in <code class="filename">/tmp</code>
             </p></li><li class="listitem"><p>
             Restricted FIFOs in <code class="filename">/tmp</code>
             </p></li><li class="listitem"><p>
             Restricted <code class="filename">/proc</code>
             </p></li><li class="listitem"><p>
             Special handling of fd 0, 1, and 2
             </p></li><li class="listitem"><p>
             Enforce <code class="envar">RLIMIT_NPROC</code> on execve(2)
             </p></li><li class="listitem"><p>
             Destroy shared memory segments not in use
             </p></li></ul></div><p>
             </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
             When applying the linux-2_2_14-ow2 patch, a new Security options section will be added at the end of your kernel configuration. For more information and description of the different features 
             available with this patch, see the README file that come with the source code of the patch.
             </p></div><p>
             Applying the patch
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>cp</strong></span> linux-2_2_14-ow2_tar.gz /usr/src/ <a name="copy"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
             [root@deep] /#<span class="command"><strong>cd</strong></span> /usr/src/                         <a name="cdir"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
             [root@deep ]/src#<span class="command"><strong>tar</strong></span> xzpf linux.2_2_14-ow2_tar.gz <a name="dcprss"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
             [root@deep ]/src#<span class="command"><strong>cd</strong></span> linux-2.2.14-ow2/  <a name="rbck"></a><span><img src="images/callouts/4.png" alt="4" border="0"></span>
             [root@deep ] /linux-2.2.14-ow2#<span class="command"><strong>mv</strong></span> linux-2.2.14-ow2.diff /usr/src/  <a name="mvsrc"></a><span><img src="images/callouts/5.png" alt="5" border="0"></span>
             [root@deep ] /linux-2.2.14-ow2#<span class="command"><strong>cd ..</strong></span>                               <a name="cdir2"></a><span><img src="images/callouts/6.png" alt="6" border="0"></span>
             [root@deep ]/src#<span class="command"><strong>patch</strong></span> -p0 &lt;linux-2.2.14-ow2.diff     <a name="aptch"></a><span><img src="images/callouts/7.png" alt="7" border="0"></span>
             [root@deep ]/src#<span class="command"><strong>rm</strong></span> -rf linux-2.2.14-ow2                 <a name="rmasrc1"></a><span><img src="images/callouts/8.png" alt="8" border="0"></span>
             [root@deep ]/src#<span class="command"><strong>rm</strong></span> -f  linux-2.2.14-ow2.diff             <a name="rmasrc2"></a><span><img src="images/callouts/9.png" alt="9" border="0"></span>
             [root@deep ]/src#<span class="command"><strong>rm</strong></span> -f  linux-2_2_14-ow2_tar.gz           <a name="rmasrc3"></a><span><img src="images/callouts/10.png" alt="10" border="0"></span>
             </pre><p>
             </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#copy"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>First we copy the program archive to the <code class="filename">/usr/src</code> directory</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#cdir"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>then we move to the <code class="filename">/usr/src</code> directory</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#dcprss"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p> decompress the linux-2_2_14ow2_tar.gz archive</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#rbck"><span><img src="images/callouts/4.png" alt="4" border="0"></span></a> <a href="#mvsrc"><span><img src="images/callouts/5.png" alt="5" border="0"></span></a> </p></td><td valign="top" align="left"><p>We then move to the new uncompressed Linux patch, move the file linux-2.2.14-ow2.diff containing 
                  the patch to the <code class="filename">/usr/src</code></p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#cdir2"><span><img src="images/callouts/6.png" alt="6" border="0"></span></a> <a href="#aptch"><span><img src="images/callouts/7.png" alt="7" border="0"></span></a> </p></td><td valign="top" align="left"><p>return to <code class="filename">/usr/src</code> and patch our kernel with the file linux-2.2.14-ow2.diff</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#rmasrc1"><span><img src="images/callouts/8.png" alt="8" border="0"></span></a> <a href="#rmasrc2"><span><img src="images/callouts/9.png" alt="9" border="0"></span></a> <a href="#rmasrc3"><span><img src="images/callouts/10.png" alt="10" border="0"></span></a> </p></td><td valign="top" align="left"><p> Afterwards, we remove all files related to the patch.</p></td></tr></table></div><p>
             </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
             All security messages related to the linux-2.2.14-ow2 patch, like the non-executable stack part, should be logged to the log file <code class="filename">/var/log/messages</code>.
             </p></div><p>
             The step of patching your new kernel is completed. Now follow the rest of this installation to build the Linux kernel and reboot.
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm5235"></a>4. Compilation</h2></div></div></div><p>
             It is important to be sure that your <code class="filename">/usr/include/asm</code>, and <code class="filename">/usr/include/linux</code> subdirectories are just symlinks to the kernel sources.
             </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
             The asm, and linux subdirectories are a soft link to the real include kernel source header directories needed for our Linux architecture, for example <code class="filename">/usr/src/linux/include/asm-i386</code> for asm. Type the following
             commands on your terminal:
             </p><pre class="screen">
             [root@deep ]/src#<span class="command"><strong>cd</strong></span> /usr/include/
             [root@deep ] /include#<span class="command"><strong>rm</strong></span> -rf  asm linux
             [root@deep ] /include#<span class="command"><strong>ln</strong></span> -s  /usr/src/linux/include/asm-i386 asm
             [root@deep ] /include#<span class="command"><strong>ln</strong></span> -s  /usr/src/linux/include/linux  linux
             </pre><p>
             This is a very important part of the configuration; we remove the asm, and linux directories under <code class="filename"></code>/usr/include then build a new links that point to the same name directories 
             under the new Linux kernel source version directory. The include directory contains important header files needed by your Linux kernel and programs to be able to compile on your system.                       
             </p></li><li class="step"><p>
             Make sure you have no stale .o files and dependencies lying around.

             Type the following commands on your terminal:
             </p><pre class="screen">
             [root@deep ] /include#<span class="command"><strong>cd</strong></span> /usr/src/linux/
             [root@deep ] /linux#<span class="command"><strong>make</strong></span> mrproper
             </pre><p>
             </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
             These two steps above simply clean up anything that might have accidentally been left in the source tree by the development team.
             </p></div><p>
             You should now have the sources correctly installed. You can configure the Linux kernel in one of three ways. 
             </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
             The first method is to use the <span class="command"><strong>make config</strong></span> command. It provides you with a text-based interface for answering all the 
             configuration options. You are prompted for all the options you need to set up your kernel.
             </p></li><li class="listitem"><p>
             The second method is to use the <span class="command"><strong>make menuconfig</strong></span> command, which provides all the kernel options in an easy-to-use menu. 
             </p></li><li class="listitem"><p>
             The third is to use the <span class="command"><strong>make xconfig</strong></span> command, which provides a full graphical interface to all the kernel options.
             </p></li></ul></div><p>
             </p></li><li class="step"><p>
             For configuration, you will use the <span class="command"><strong>make config</strong></span> command because we have not installed the XFree86 window Interface on our Linux server.
             Type the following commands on your terminal to load the kernel configuration:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>cd</strong></span> /usr/src/linux/ (if you are not already in this directory).
             [root@deep ] /linux#<span class="command"><strong>make</strong></span> config
             rm -f include/asm
             ( cd include ; ln -sf asm-i386 asm)
             /bin/sh scripts/Configure arch/i386/config.in
             #
             # Using defaults found in arch/i386/defconfig
             #
             </pre><p>
             </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prt2sct35kcon"></a>5. Kernel configuration -Part "A"</h2></div></div></div><p>These are the options available for you to choose from the list of Kernel Configurable options as soon as you enter <span class="command"><strong>make config</strong></span> at the prompt as described in the previous section.As 
           soon as you enter make config at the prompt as described in the previous step, a list of Kernel configurable options will be displayed for you to choose to configure the Kernel, you must indicate what
           features and devices drivers you want to include in your Linux system and select how to include support for specific devices. Typically, for each configuration option, you have to respond with one of the following
           choices: We have used a simple convention for our example configuration:
           </p><div class="example"><a name="idm5283"></a><p class="title"><b>Example 7.1. SMP support</b></p><div class="example-contents"><p>
           </p><pre class="screen">
           Symmetric multi-processing support <code class="envar">(CONFIG_SMP)</code> <code class="literal">Y/M/N</code> <strong class="userinput"><code>N</code></strong>
           </pre><p>
           where 
             </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                 </p><pre class="programlisting">
           Symmetric multi-processing support <code class="envar">(CONFIG_SMP)</code> -is one of the choice
           </pre><p>
           <span class="emphasis"><em>We have choosen to say <strong class="userinput"><code>N</code></strong> in this case. </em></span>
           </p></li><li class="listitem"><p>
           <code class="literal">Y/M/N</code> - are the options you have i.e. you can say yes or no or choose as module.
           </p></li><li class="listitem"><p>
           <strong class="userinput"><code>[Y]</code></strong> -To compile into the kernel and always be loaded
           </p></li><li class="listitem"><p>           
           <strong class="userinput"><code>[M]</code></strong> -To use a module for that feature and load that segment of code on demand
           </p></li><li class="listitem"><p>
           <strong class="userinput"><code>[N]</code></strong> -To skip and excludes the support for that specific device from the Kernel
           </p></li></ul></div><p>
           </p></div></div><p><br class="example-break">
           </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
             It is important to note that majuscule letter of <strong class="userinput"><code>n</code></strong> or <strong class="userinput"><code>y</code></strong> mean the default choice. If a device does not have a modular device driver, you will not see the <strong class="userinput"><code>[M]</code></strong> option. Some 
             time an <strong class="userinput"><code>[?]</code></strong> option will appear in the choices. This mean that you can get more information about the feature when you type <span class="keycap"><strong>?</strong></span> + <span class="keycap"><strong>ENTER</strong></span> key. Choosing the <strong class="userinput"><code>[?]</code></strong> 
             help option will opens another terminal describing the option.         
           </p></div><p><b>Code maturity level options. </b>
             </p><pre class="screen">           
           Prompt for development and/or incomplete code/drivers <code class="envar">(CONFIG_EXPERIMENTAL)</code> <code class="literal">N/y/?</code>
           </pre><p>
           </p><p><b>Processor type and features. </b>           
             </p><pre class="screen">
               Processor family (386, 486/Cx486, 586/K5/5x86/6x86, Pentium/K6/TSC, PPro/6x86MX) <strong class="userinput"><code>[PPro/6x86MX]</code></strong>           
               Maximum Physical Memory (1GB, 2GB) <strong class="userinput"><code>[1GB]</code></strong>           
               Math emulation (CONFIG_MATH_EMULATION) <code class="literal">N/y/?</code>           
               <acronym class="acronym">MTRR</acronym> (Memory Type Range Register) support (CONFIG_MTRR) N/y/?           
               Symmetric multi-processing support (CONFIG_SMP) Y/n/? <strong class="userinput"><code>N</code></strong>
             </pre><p>

           </p><p><b>Loadable module support. </b>
              </p><pre class="screen">
                Enable loadable module support (CONFIG_MODULES) Y/n/? <strong class="userinput"><code>N</code></strong>
              </pre><p>
            </p><p><b>General setup. </b>
              </p><pre class="screen">
                Networking support (CONFIG_NET) Y/n/?
                PCI support (CONFIG_PCI) Y/n/?
                <acronym class="acronym">PCI</acronym> access mode (<acronym class="acronym">BIOS,</acronym> Direct, Any <strong class="userinput"><code>[Any]</code></strong>
                <acronym class="acronym">PCI</acronym> quirks (CONFIG_PCI_QUIRKS) Y/n/? <strong class="userinput"><code>N</code></strong>
                Backward-compatible /proc/pci (CONFIG_PCI_OLD_PROC) Y/n/? <strong class="userinput"><code>N</code></strong>
                <acronym class="acronym">MCA</acronym> support (CONFIG_MCA) N/y/?
                <acronym class="acronym">SGI</acronym> Visual Workstation support (CONFIG_VISWS) N/y/?
                System V <acronym class="acronym">IPC</acronym> (CONFIG_SYSVIPC) Y/n/?
                <acronym class="acronym">BSD</acronym> Process Accounting (CONFIG_BSD_PROCESS_ACCT) N/y/?
                Sysctl support (CONFIG_SYSCTL) Y/n/?
                Kernel support for a.out binaries (CONFIG_BINFMT_AOUT) Y/n/?
                Kernel support for <acronym class="acronym">ELF</acronym> binaries (CONFIG_BINFMT_ELF) Y/n/?
                Kernel support for <abbr class="abbrev">MISC.</abbr> binaries (CONFIG_BINFMT_MISC) Y/n/?           
                Parallel port support (CONFIG_PARPORT) N/y/?           
                Advanced Power Management <acronym class="acronym">BIOS</acronym> support (CONFIG_APM) N/y/?

              </pre><p>

           </p><p><b>Plug and Play support. </b>
               </p><pre class="screen">
           Plug and Play support (CONFIG_PNP) [N/y/?]    
               </pre><p>
             </p><p><b>Block devices. </b>
             </p><pre class="screen">
           Normal <acronym class="acronym">PC</acronym> floppy disk support (CONFIG_BLK_DEV_FD) Y/n/?
           Enhanced <acronym class="acronym">IDE/MFM/RLL</acronym> disk/cdrom/tape/floppy support (CONFIG_BLK_DEV_IDE) Y/n/?
           Use old disk-only driver on primary interface (CONFIG_BLK_DEV_HD_IDE)  N/y/?
           Include <acronym class="acronym">IDE/ATA-2</acronym> DISK support (CONFIG_BLK_DEV_IDEDISK)  Y/n/?
           Include <acronym class="acronym">IDE/ATAPI</acronym> CDROM support (CONFIG_BLK_DEV_IDECD)  Y/n/?
           Include <acronym class="acronym">IDE/ATAPI</acronym> TAPE support (CONFIG_BLK_DEV_IDETAPE)  N/y/?
           Include <acronym class="acronym">IDE/ATAPI</acronym> FLOPPY support (CONFIG_BLK_DEV_IDEFLOPPY)  N/y/?
           <acronym class="acronym">SCSI</acronym> emulation support (CONFIG_BLK_DEV_IDESCSI)  N/y/?
           CMD640 chipset bugfix/support (CONFIG_BLK_DEV_CMD640)  Y/n/? <strong class="userinput"><code>N</code></strong>
           RZ1000 chipset bugfix/support (CONFIG_BLK_DEV_RZ1000)  Y/n/? <strong class="userinput"><code>N</code></strong>
           Generic <acronym class="acronym">PCI</acronym> <acronym class="acronym">IDE</acronym> chipset support (CONFIG_BLK_DEV_IDEPCI)  Y/n/?
           Generic <acronym class="acronym">PCI</acronym> bus-master <acronym class="acronym">DMA</acronym> support (CONFIG_BLK_DEV_IDEDMA)  Y/n/?
           Boot off-board chipsets first support (CONFIG_BLK_DEV_OFFBOARD)  N/y/?
           Use DMA by default when available (CONFIG_IDEDMA_AUTO)  Y/n/?
           Other <acronym class="acronym">IDE</acronym> chipset support (CONFIG_IDE_CHIPSETS)  N/y/?
           Loopback device support (CONFIG_BLK_DEV_LOOP)  N/y/?
           Network block device support (CONFIG_BLK_DEV_NBD)  N/y/?
           Multiple devices driver support (CONFIG_BLK_DEV_MD)  N/y/?
           <acronym class="acronym">RAM</acronym> disk support (CONFIG_BLK_DEV_RAM)  N/y/?
           <acronym class="acronym">XT</acronym> hard disk support (CONFIG_BLK_DEV_XD)  N/y/?
           Mylex DAC960/DAC1100 <acronym class="acronym">PCI</acronym> <acronym class="acronym">RAID</acronym> Controller support (CONFIG_BLK_DEV_DAC960)  N/y/? (NEW)
           Parallel port <acronym class="acronym">IDE</acronym> device support (CONFIG_PARIDE)  N/y/?
           Compaq SMART2 support (CONFIG_BLK_CPQ_DA) [N/y/?] (NEW)
           </pre><p>
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm5390"></a>6. Kernel configuration -Part "B"</h2></div></div></div><p><b> Networking options. </b>
                 </p><pre class="screen">
               Packet socket (CONFIG_PACKET) Y/n/?
               Kernel/User netlink socket (CONFIG_NETLINK) N/y/?
               Network firewalls (CONFIG_FIREWALL) N/y/? <strong class="userinput"><code>Y</code></strong>
               Socket Filtering (CONFIG_FILTER) N/y/?
               Unix domain sockets (CONFIG_UNIX) Y/n/?
               <acronym class="acronym">TCP/IP</acronym> networking (CONFIG_INET) Y/n/?
               <acronym class="acronym">IP:</acronym> multicasting (CONFIG_IP_MULTICAST) N/y/?
               <acronym class="acronym">IP</acronym>: advanced router (CONFIG_IP_ADVANCED_ROUTER) N/y/?
               <acronym class="acronym">IP</acronym>: kernel level autoconfiguration (CONFIG_IP_PNP) N/y/?
               <acronym class="acronym">IP</acronym>: firewalling (CONFIG_IP_FIREWALL) N/y/? (NEW) <strong class="userinput"><code>Y</code></strong>
               <acronym class="acronym">IP</acronym>: transparent proxy support (CONFIG_IP_TRANSPARENT_PROXY) N/y/? (NEW)
               <acronym class="acronym">IP</acronym>: masquerading (CONFIG_IP_MASQUERADE) N/y/? (NEW)
               <acronym class="acronym">IP</acronym>: optimize as router not host (CONFIG_IP_ROUTER) N/y/?
               <acronym class="acronym">IP</acronym>: tunneling (CONFIG_NET_IPIP) N/y/?
               <acronym class="acronym">IP</acronym>: GRE tunnels over <acronym class="acronym">IP</acronym> (CONFIG_NET_IPGRE) N/y/?
               <acronym class="acronym">IP</acronym>: aliasing support (CONFIG_IP_ALIAS) N/y/?
               <acronym class="acronym">IP</acronym>: <acronym class="acronym">TCP</acronym> syncookie support (not enabled per default) (CONFIG_SYN_COOKIES) N/y/? <strong class="userinput"><code>Y</code></strong>
               <acronym class="acronym">IP</acronym>: Reverse <acronym class="acronym">ARP</acronym> (CONFIG_INET_RARP) N/y/?
               <acronym class="acronym"><acronym class="acronym">IP</acronym></acronym>: Allow large windows (not recommended if &gt;16Mb of memory) (CONFIG_SKB_LARGE) Y/n/?
               The <acronym class="acronym">IPX</acronym> protocol (CONFIG_IPX) N/y/?
               Appletalk <acronym class="acronym">DDP</acronym> (CONFIG_ATALK) N/y/?
               </pre><p>
               </p><p><b>Telephony support. </b>
                 </p><pre class="screen">
               Linux telephony support (CONFIG_PHONE) N/y/? (NEW)
               </pre><p>
               </p><p><b><acronym class="acronym"><acronym class="acronym">SCSI</acronym></acronym> support. </b>
                </p><pre class="screen">
                  <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI) Y/n/?
                  <acronym class="acronym">SCSI</acronym> disk support (CONFIG_BLK_DEV_SD) Y/n/?
                  <acronym class="acronym">SCSI</acronym> tape support (CONFIG_CHR_DEV_ST) N/y/?
                  <acronym class="acronym">SCSI</acronym> CD-ROM support (CONFIG_BLK_DEV_SR) N/y/?
                  <acronym class="acronym">SCSI</acronym> generic support (CONFIG_CHR_DEV_SG) N/y/?
                  Probe all LUNs on each <acronym class="acronym">SCSI</acronym> device (CONFIG_SCSI_MULTI_LUN) Y/n/? N
                  Verbose <acronym class="acronym">SCSI</acronym> error reporting (kernel size +=12K) (CONFIG_SCSI_CONSTANTS) Y/n/? N
                  <acronym class="acronym">SCSI</acronym> logging facility (CONFIG_SCSI_LOGGING) N/y/?
                </pre><p>

              </p><p><b><acronym class="acronym">SCSI</acronym> low-level drivers. </b>
               </p><pre class="screen">

                 7000FASST <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_7000FASST) N/y/?
                 ACARD <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_ACARD) N/y/?
                 Adaptec AHA152X/2825 support (CONFIG_SCSI_AHA152X) N/y/?
                 Adaptec AHA1542 support (CONFIG_SCSI_AHA1542) N/y/?
                 Adaptec AHA1740 support (CONFIG_SCSI_AHA1740) N/y/?
                 Adaptec AIC7xxx support (CONFIG_SCSI_AIC7XXX) N/y/? <strong class="userinput"><code>Y</code></strong>
                 Enable Tagged Command Queueing <acronym class="acronym">TCQ</acronym> by default N/y/? (NEW) <strong class="userinput"><code>Y</code></strong>
                 Maximum number of TCQ commands per device (CONFIG_AIC7XXX_CMDS_PER_DEVICE) [8] (NEW)
                 Collect statistics to report in /proc (CONFIG_AIC7XXX_PROC_STATS) N/y/? (NEW)
                 Delay in seconds after <acronym class="acronym">SCSI</acronym> bus reset (CONFIG_AIC7XXX_RESET_DELAY) [5] (NEW)
                 IBM ServeRAID support (CONFIG_SCSI_IPS) N/y/? (NEW)
                 AdvanSys <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_ADVANSYS) N/y/?
                 Always IN2000 <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_IN2000) N/y/?
                 AM53/79C974 PCI <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_AM53C974) N/y/?
                 AMI MegaRAID support (CONFIG_SCSI_MEGARAID) N/y/?
                 BusLogic <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_BUSLOGIC) N/y/?
                 DTC3180/3280 <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_DTC3280) N/y/?
                 EATA ISA/EISA/PCI (DPT and generic <acronym class="acronym">EATA/DMA</acronym>) support (CONFIG_SCSI_EATA) N/y/?
                 EATA-DMA [Obsolete] (DPT, NEC, AT&amp;T, SNI, AST, Olivetti, Alphatronix) support (CONFIG_SCSI_EATA_DMA) N/y/?
                 EATA-PIO (old DPT PM2001, PM2012A) support (CONFIG_SCSI_EATA_PIO) N/y/?
                 Future Domain 16xx <acronym class="acronym">SCSI</acronym>/AHA-2920A support (CONFIG_SCSI_FUTURE_DOMAIN) N/y/?
                 GDT <acronym class="acronym">SCSI</acronym> Disk Array Controller support (CONFIG_SCSI_GDTH) N/y/?
                 Generic NCR5380/53c400 <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_GENERIC_NCR5380) N/y/?
                 Initio 9100U(W) support (CONFIG_SCSI_INITIO) N/y/?
                 Initio INI-A100U2W support (CONFIG_SCSI_INIA100) N/y/?
                 NCR53c406a <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_NCR53C406A) N/y/?
                 symbios 53c416 <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_SYM53C416) N/y/?
                 Simple 53c710 <acronym class="acronym">SCSI</acronym> support (Compaq, NCR machines) (CONFIG_SCSI_SIM710) N/y/? (NEW)
                 NCR53c7,8xx <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_NCR53C7xx) N/y/?
                 NCR53C8XX <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_NCR53C8XX) N/y/?
                 SYM53C8XX <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_SYM53C8XX) Y/n/? N
                 PAS16 <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_PAS16) N/y/?
                 PCI2000 support (CONFIG_SCSI_PCI2000) N/y/?
                 PCI2220i support (CONFIG_SCSI_PCI2220I) N/y/?
                 PSI240i support (CONFIG_SCSI_PSI240I) N/y/?
                 Qlogic FAS <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_QLOGIC_FAS) N/y/?
                 Qlogic ISP <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_QLOGIC_ISP) N/y/?
                 Qlogic ISP FC <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_QLOGIC_FC) N/y/?
                 Seagate ST-02 and Future Domain TMC-8xx <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_SEAGATE) N/y/?
                 Tekram DC390(T) and Am53/79C974 <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_DC390T) N/y/?
                 Trantor T128/T128F/T228 <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_T128) N/y/?
                 UltraStor 14F/34F support (CONFIG_SCSI_U14_34F) N/y/?
                 UltraStor <acronym class="acronym">SCSI</acronym> support (CONFIG_SCSI_ULTRASTOR) N/y/?
               </pre><p>

             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm5471"></a>7. Kernel configuration -Part "C"</h2></div></div></div><p><b>Network device support. </b>
           </p><pre class="screen">           
           Network device support (CONFIG_NETDEVICES) Y/n/?
           </pre><p>
           </p><p><b>ARCnet devices. </b>
             </p><pre class="screen">          
               ARCnet support (CONFIG_ARCNET) N/y/?
               Dummy net driver support (CONFIG_DUMMY) Y/n/?
               EQL -serial line load balancing support (CONFIG_EQUALIZER) N/y/?
               General Instruments Surfboard 1000 (CONFIG_NET_SB1000) N/y/? (NEW)
             </pre><p>
           </p><p><b>Ethernet (10 or 100Mbit). </b>
             </p><pre class="screen">            
               Ethernet (10 or 100Mbit) (CONFIG_NET_ETHERNET) Y/n/?
               3COM cards (CONFIG_NET_VENDOR_3COM) N/y/?
               AMD LANCE and PCnet (AT1500 and NE2100) support (CONFIG_LANCE) N/y/?
               Western Digital/SMC cards (CONFIG_NET_VENDOR_SMC) N/y/?
               Racal-Interlan (Micom) NI cards (CONFIG_NET_VENDOR_RACAL) N/y/?
               Other ISA cards (CONFIG_NET_ISA) N/y/?
               <acronym class="acronym">EISA</acronym>, VLB, <acronym class="acronym">PCI</acronym> and on board controllers (CONFIG_NET_EISA) Y/n/?
               AMD PCnet32 (VLB and <acronym class="acronym">PCI</acronym>) support (CONFIG_PCNET32) N/y/?
               Apricot Xen-II on board Ethernet (CONFIG_APRICOT) N/y/?
               CS89x0 support (CONFIG_CS89x0) N/y/?
               DM9102 <acronym class="acronym">PCI</acronym> Fast Ethernet Adapter support (EXPERIMENTAL) (CONFIG_DM9102) N/y/? (NEW)
               Generic DECchip &amp; DIGITAL EtherWORKS <acronym class="acronym">PCI</acronym>/<acronym class="acronym">EISA</acronym> (CONFIG_DE4X5) N/y/?
               DECchip Tulip (dc21x4x) <acronym class="acronym">PCI</acronym> support (CONFIG_DEC_ELCP) N/y/?
               Old DECchip Tulip (dc21x4x) <acronym class="acronym">PCI</acronym> support (CONFIG_DEC_ELCP_OLD) N/y/? (NEW)
               Digi Intl. RightSwitch SE-X support (CONFIG_DGRS) N/y/?
               EtherExpressPro/100 support (CONFIG_EEXPRESS_PRO100) Y/n/?
               <acronym class="acronym">PCI</acronym> NE2000 support (CONFIG_NE2K_PCI) N/y/?
               TI ThunderLAN support (CONFIG_TLAN) N/y/?
               VIA Rhine support (CONFIG_VIA_RHINE) N/y/?
               SiS 900/7016 <acronym class="acronym">PCI</acronym> Fast Ethernet Adapter support (CONFIG_SIS900) N/y/? (NEW)
               Pocket and portable adaptors (CONFIG_NET_POCKET) N/y/?
             </pre><p>

           </p><p><b>Ethernet (1000 Mbit). </b>
             </p><pre class="screen">                
               SysKonnect SK-98xx support (CONFIG_SK98LIN) N/y/? (NEW)
               <code class="literal">FDDI</code> driver support (CONFIG_FDDI) N/y/?
               <code class="literal">PPP</code> (point-to-point) support (CONFIG_PPP) N/y/?
               <code class="literal">SLIP</code> (serial line) support (CONFIG_SLIP) N/y/?
               Wireless <code class="literal">LAN</code> (non-hamradio) (CONFIG_NET_RADIO) N/y/?
             </pre><p>

           </p><p><b>Token ring devices. </b>
           </p><pre class="screen">                
           Token Ring driver support (CONFIG_TR) N/y/?
           Fibre Channel driver support (CONFIG_NET_FC) N/y/? (NEW)
           </pre><p>
           </p><p><b>Wan interfaces. </b>
             </p><pre class="screen">                
               MultiGate (COMX) synchronous serial boards support (CONFIG_COMX) N/y/? (NEW)
               Frame relay DLCI support (CONFIG_DLCI) N/y/?
               WAN drivers (CONFIG_WAN_DRIVERS) N/y/?
               SBNI12-xx support (CONFIG_SBNI) N/y/? (NEW)
             </pre><p>

           </p><p><b>Amateur Radio support. </b>
           </p><pre class="screen">                
           Amateur Radio support (CONFIG_HAMRADIO) N/y/?
           </pre><p>
           </p><p><b>IrDA subsystem support. </b>
           </p><pre class="screen">                
           IrDA subsystem support (CONFIG_IRDA) N/y/?
           </pre><p>
           </p><p><b><acronym class="acronym">ISDN</acronym> subsystem. </b>
           </p><pre class="screen">
           
           <acronym class="acronym">ISDN</acronym> support (CONFIG_ISDN) N/y/?
           </pre><p>
           </p><p><b>Old CD-ROM drivers (not <acronym class="acronym">SCSI</acronym>, not <acronym class="acronym">IDE</acronym>). </b>
           </p><pre class="screen">                
           Support non-<acronym class="acronym">SCSI</acronym>/<acronym class="acronym">IDE</acronym>/ATAPI CDROM drives (CONFIG_CD_NO_IDESCSI) N/y/?
           </pre><p>
           </p><p><b>Character devices. </b>
             </p><pre class="screen">                
               Virtual terminal (CONFIG_VT) Y/n/?
               Support for console on virtual terminal (CONFIG_VT_CONSOLE) Y/n/?
               Standard/generic (dumb) serial support (CONFIG_SERIAL) Y/n/?
               Support for console on serial port (CONFIG_SERIAL_CONSOLE) N/y/?
               Extended dumb serial driver options (CONFIG_SERIAL_EXTENDED) N/y/?
               Non-standard serial port support (CONFIG_SERIAL_NONSTANDARD) N/y/?
               Unix98 <acronym class="acronym">PTY</acronym> support (CONFIG_UNIX98_PTYS) Y/n/?
               Maximum number of Unix98 PTYs in use (0-2048) (CONFIG_UNIX98_PTY_COUNT) [256] 128
               Mouse Support (not serial mice) (CONFIG_MOUSE) Y/n/?
             </pre><p>

           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm5538"></a>8. Kernel configuration -Part "D"</h2></div></div></div><p><b> Mice. </b>
             </p><pre class="screen">               
               ATIXL busmouse support (CONFIG_ATIXL_BUSMOUSE) N/y/?
               Logitech busmouse support (CONFIG_BUSMOUSE) N/y/?
               Microsoft busmouse support (CONFIG_MS_BUSMOUSE) N/y/?
               PS/2 mouse (aka "auxiliary device") support (CONFIG_PSMOUSE) N/y/?
               C&amp;T 82C710 mouse port support (as on TI Travelmate) (CONFIG_82C710_MOUSE) Y/n/? N
               PC110 digitizer pad support (CONFIG_PC110_PAD) N/y/?
             </pre><p>

           </p><p><b>Joystick support. </b>
             </p><pre class="screen">                
               Joystick support (CONFIG_JOYSTICK) N/y/?
               QIC-02 tape support (CONFIG_QIC02_TAPE) N/y/?
               Watchdog Timer Support (CONFIG_WATCHDOG) N/y/?
               <code class="filename">/dev/nvram</code> support (CONFIG_NVRAM) N/y/?
               Enhanced Real Time Clock Support (CONFIG_RTC) N/y/?
             </pre><p>

           </p><p><b> Video for Linux. </b>
           </p><pre class="screen">               
           Video For Linux (CONFIG_VIDEO_DEV) N/y/?
           Double Talk PC internal speech card support (CONFIG_DTLK) N/y/?
           </pre><p>
           </p><p><b> Ftape, the floppy tape device driver. </b>
           </p><pre class="screen">              
           Ftape (QIC-80/Travan) support (CONFIG_FTAPE) N/y/?
           </pre><p>
           </p><p><b>Filesystems. </b>
             </p><pre class="screen">                
               Quota support (CONFIG_QUOTA) N/y/? Y
               Kernel automounter support (CONFIG_AUTOFS_FS) Y/n/? N
               Amiga <acronym class="acronym">FFS</acronym> filesystem support (CONFIG_AFFS_FS) N/y/?
               Apple Macintosh filesystem support (experimental) (CONFIG_HFS_FS) N/y/?
               <acronym class="acronym">DOS</acronym> FAT fs support (CONFIG_FAT_FS) N/y/?
               ISO 9660 CDROM filesystem support (CONFIG_ISO9660_FS) Y/n/?
               Microsoft Joliet CDROM extensions (CONFIG_JOLIET) N/y/?
               Minix fs support (CONFIG_MINIX_FS) N/y/?
               <acronym class="acronym">NTFS</acronym> filesystem support (read only) (CONFIG_NTFS_FS) N/y/?
               OS/2 <acronym class="acronym">HPFS</acronym> filesystem support (read only) (CONFIG_HPFS_FS) N/y/?
               <code class="filename">/proc</code> filesystem support (CONFIG_PROC_FS) Y/n/?
               <code class="filename">/dev/p</code>ts filesystem for Unix98 PTYs (CONFIG_DEVPTS_FS) Y/n/?
               <acronym class="acronym">ROM</acronym> filesystem support (CONFIG_ROMFS_FS) N/y/?
               Second extended fs support (CONFIG_EXT2_FS) Y/n/?
               System V and Coherent filesystem support (CONFIG_SYSV_FS) N/y/?
               <acronym class="acronym">UFS</acronym> filesystem support (CONFIG_UFS_FS) N/y/?
             </pre><p>

           </p><p><b>Network File Systems. </b>
             </p><pre class="screen"> 
               Coda filesystem support (advanced network fs) (CONFIG_CODA_FS) N/y/?
               <acronym class="acronym">NFS</acronym> filesystem support (CONFIG_NFS_FS) Y/n/? N
               <acronym class="acronym">SMB</acronym> filesystem support (to mount WfW shares etc.) (CONFIG_SMB_FS) N/y/?
               NCP filesystem support (to mount NetWare volumes) (CONFIG_NCP_FS) N/y/?
             </pre><p>

           </p><p><b>Partition Types. </b>
             </p><pre class="screen">                
               <acronym class="acronym">BSD</acronym> disklabel (<acronym class="acronym">BSD</acronym> partition tables) support (CONFIG_BSD_DISKLABEL) N/y/?
               Macintosh partition map support (CONFIG_MAC_PARTITION) N/y/?
               SMD disklabel (Sun partition tables) support (CONFIG_SMD_DISKLABEL) N/y/?
               Solaris (x86) partition table support (CONFIG_SOLARIS_X86_PARTITION) N/y/?
             </pre><p>

           </p><p><b>Console drivers. </b>
           </p><pre class="screen">
           <acronym class="acronym">VGA</acronym> text console (CONFIG_VGA_CONSOLE) Y/n/?
           Video mode selection support (CONFIG_VIDEO_SELECT) N/y/?
           </pre><p>
           </p><p><b>
           Sound
           . </b>
           </p><pre class="screen">
           Sound card support (CONFIG_SOUND) N/y/?
           </pre><p>
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm5590"></a>9. Kernel configuration -Part "E"</h2></div></div></div><p><b>Security options. </b><span class="emphasis"><em>
             Security options will appear only if you have patched your kernel with the Openwall Project patch.
             </em></span>             
             </p><pre class="screen">                  
               Non-executable user stack area (CONFIG_SECURE_STACK) <strong class="userinput"><code>Y</code></strong>
               Autodetect and emulate GCC trampolines (CONFIG_SECURE_STACK_SMART) <strong class="userinput"><code>Y</code></strong>
               Restricted links in /tmp (CONFIG_SECURE_LINK) <strong class="userinput"><code>Y</code></strong>
               Restricted FIFOs in /tmp (CONFIG_SECURE_FIFO) <strong class="userinput"><code>Y</code></strong>
               Restricted <code class="filename">/proc</code> (CONFIG_SECURE_PROC) N <strong class="userinput"><code>Y</code></strong>
               Special handling of fd 0, 1, and 2 (CONFIG_SECURE_FD_0_1_2) <strong class="userinput"><code>Y</code></strong>
               Enforce RLIMIT_NPROC on execve(2) (CONFIG_SECURE_RLIMIT_NPROC) <strong class="userinput"><code>Y</code></strong>
               Destroy shared memory segments not in use (CONFIG_SECURE_SHM) N <strong class="userinput"><code>Y</code></strong>
             </pre><p>

             </p><p><b>
             Kernel hacking. </b>
             </p><pre class="screen">
             Magic SysRq key (CONFIG_MAGIC_SYSRQ) N/y/?
             </pre><p>
             </p><p>
           Now, return to the <code class="filename">/usr/src/linux/</code> directory, if you are not already in it. You need to compile the new kernel. You do so by using the following command:
            </p><pre class="screen">
           [root@deep ] /linux# <span class="command"><strong>make dep</strong></span>; <span class="command"><strong>make clean</strong></span>; <span class="command"><strong>make bzImage</strong></span>
           </pre><p>
           This line contains three commands in one.
           </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           The first one, <span class="command"><strong>make dep</strong></span>, actually takes your configuration and builds the corresponding dependency tree. This process determines what gets compiled and what doesn't. 
           </p></li><li class="listitem"><p>
           The next step, <span class="command"><strong>make clean</strong></span>, erase all previous traces of a compilation so as to avoid any mistakes in which version of a feature gets tied into the kernel. 
           </p></li><li class="listitem"><p>
           Finally, <span class="command"><strong>make bzImage</strong></span> does the full compilation of the kernel.
           </p></li></ul></div><p>
           </p><p>
           After the process is complete, the kernel is compressed and ready to be installed on your system. Before we can install the new kernel, we must know if we need to compile the 
           corresponding modules. This is required only if you said <strong class="userinput"><code>Yes</code></strong> to Enable loadable module support <code class="envar">CONFIG_MODULES</code> and have compiled some options in the kernel configuration above 
           as a module. In this case, you must execute the following commands:
           </p><pre class="screen">
           [root@deep ] /linux#<span class="command"><strong>make modules</strong></span>
           [root@deep ] /linux#<span class="command"><strong>make modules_install</strong></span>
           </pre><p>
           </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
           The <span class="command"><strong>make modules</strong></span> and <span class="command"><strong>make modules_install</strong></span> commands are required only if you say Yes to Enable loadable module support <code class="envar">CONFIG_MODULES</code> in your kernel configuration above.
           </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm5643"></a>10. Installing the new kernel</h2></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
             Copy the file <code class="filename">/usr/src/linux/arch/i386/boot/bzImage</code> from the kernel source tree to the <code class="filename">/boot</code> directory, and give it an 
             appropriate new name.
             </p><pre class="screen">
             [root@deep ] /linux#<span class="command"><strong>cp</strong></span> /usr/src/linux/arch/i386/boot/bzImage /boot/vmlinuz-kernel.version.number
             </pre><p>
             An appropriated or recommended new name is something like vmlinuz-2.2.14, this is important if you want a new rescue floppy or emergency boot floppy using the mkbootdisk program 
             that require some specific needs like for example: vmlinuz-2.2.14 instead of vmlinuz-2.2.14.a
             </p></li><li class="step"><p>
             Copy the file <code class="filename">/usr/src/linux/System.map</code> from the kernel source tree to the <code class="filename">/boot</code> directory, and give it an appropriate new name.
             </p><pre class="screen">
             [root@deep ] /linux#<span class="command"><strong>cp</strong></span> /usr/src/linux/System.map /boot/System.map-kernel.version.number
             </pre><p>
             </p></li><li class="step"><p>
             Move into the <code class="filename">/boot</code> directory and rebuild the links to <code class="filename">vmlinuz</code> and <code class="filename">System.map</code> with the following commands:
             </p><pre class="screen">
             [root@deep ] /linux#<span class="command"><strong>cd</strong></span> /boot
             [root@deep ] /boot#<span class="command"><strong>ln</strong></span> -fs vmlinuz-kernel.version.number vmlinuz
             [root@deep ] /boot#<span class="command"><strong>ln</strong></span> -fs System.map-kernel.version.number System.map
             </pre><p>
             We must rebuild the links of <code class="filename">vmlinuz</code> and <code class="filename">System.map</code> to point them to the new kernel version installed. Without 
             the new links <acronym class="acronym">LILO</acronym> program will look by default for the old version of your Linux kernel.
            </p></li><li class="step"><p>
             Remove obsolete and unnecessary files under the <code class="filename">/boot</code> directory to make space:
             </p><pre class="screen">
             [root@deep ] /boot#<span class="command"><strong>rm</strong></span> -f  module-info
             [root@deep ] /boot#<span class="command"><strong>rm</strong></span> -f  initrd-2.2.xx.img
             </pre><p>
             The <code class="filename">module-info</code> link point to the old modules directory of your original kernel. Since we have installed a brand new kernel, we don't need to keep this 
             broken link. The <code class="filename">initrd-2.2.xx</code> is a file that contains an initial <acronym class="acronym">RAM</acronym> disk image that serves as a system before the disk is available. This file is only 
             available and is installed from the Linux setup installation if your system has a <acronym class="acronym"><acronym class="acronym"><acronym class="acronym">SCSI</acronym></acronym></acronym> adapter present. If we use and have a <acronym class="acronym"><acronym class="acronym"><acronym class="acronym"><acronym class="acronym">SCSI</acronym></acronym></acronym></acronym> system, the driver now will be incorporated 
             into our new Linux kernel since we have build a monolithic kernel, so we can remove this file <code class="filename">initrd-2.2.xx.img</code> safely.
             </p></li><li class="step"><p>
              Create a new Linux kernel directory that will handle all header files related to Linux kernel for future compilation of other programs on your system. Recall, we had created two symlinks under the <code class="filename"></code>/usr/include
              directory that point to the Linux kernel to be able to compile it without receiving error and also be able to compile future programs.             
             
             
              The <code class="filename">/usr/include</code> directory is where all header files of your Linux system are kept for reference and dependencies when you compile and install new programs. The asm, and linux links 
              are used when program need to know some functions from compile-time specific to the kernel installed on your system. Programs call other headers in the include directory when they must know specific information, dependencies, 
              <abbr class="abbrev">etc.</abbr> of your system.             
             
              </p><pre class="screen">
              [root@deep] /#<span class="command"><strong>mkdir</strong></span> -p  /usr/src/linux-2.2.14/include
              [root@deep] /#<span class="command"><strong>cp</strong></span> -r  /usr/src/linux/include/asm-generic /usr/src/linux-2.2.14/include
              [root@deep] /#<span class="command"><strong>cp</strong></span> -r  /usr/src/linux/include/asm-i386 /usr/src/linux-2.2.14/include
              [root@deep] /#<span class="command"><strong>cp</strong></span> -r  /usr/src/linux/include/linux /usr/src/linux-2.2.14/include
              [root@deep] /#<span class="command"><strong>cp</strong></span> -r  /usr/src/linux/include/net /usr/src/linux-2.2.14/include
              [root@deep] /#<span class="command"><strong>cp</strong></span> -r  /usr/src/linux/include/video /usr/src/linux-2.2.14/include
              [root@deep] /#<span class="command"><strong>cp</strong></span> -r  /usr/src/linux/include/scsi /usr/src/linux-2.2.14/include
              [root@deep] /#<span class="command"><strong>rm</strong></span> -rf  /usr/src/linux
              [root@deep] /#<span class="command"><strong>cd</strong></span> /usr/src
              [root@deep ] /src#<span class="command"><strong>ln</strong></span> -s  /usr/src/linux-2.2.14 linux             
             </pre><p>
             
             First we create a new directory named <code class="filename">linux-2.2.14</code> based on the version of the kernel we have installed for easy interpretation, then we copy directories 
             asm-generic, asm-i386, linux, net, video, and scsi from <code class="filename">/usr/linux/include</code> to our new place <code class="filename">/usr/src/linux-2.2.14/include</code>. After
             We remove the entire source directory where we had compiled the new kernel, create a new symbolic link named <code class="filename">linux</code> under <code class="filename">/usr/src</code> that
             points to our new <code class="filename">/usr/src/linux-2.2.14/include</code> directory. With these steps, future compiled programs will know where to look for headers related to the kernel on your server.             
             
             </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
             This step will allow us to gain space on our hard drive and will reduce the risk of security. The Linux kernel source directory handles a of lot files and is about 75 MB in size when uncompressed. With the 
             procedure described above, our Linux kernel directory began approximately 3 MB in size so we save 72 MB for the same functionalities.
             </p></div><p>
             </p></li><li class="step"><p>
             Finally, you need to edit the <code class="filename">/etc/lilo.conf</code> file to make your new kernel one of the boot time options:
               </p><ol type="a" class="substeps"><li class="step"><p>
                   Edit the <code class="filename">lilo.conf</code> file - vi <code class="filename">/etc/lilo.conf</code> and make the appropriated change on the line that read <code class="envar">image=/boot/</code>.
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>vi</strong></span> /etc/lilo.conf
             </pre><p>
             </p><div class="literallayout"><p><br>
               <code class="computeroutput">  <br>
             boot=/dev/sda<br>
             map=/boot/map<br>
             install=/boot/boot.b<br>
             prompt<br>
             timeout=00<br>
             restricted<br>
             password=somepasswd<br>
             image=/boot/vmlinuz-kernel.version.number  #add your new kernel name file here.<br>
             label=linux<br>
             root=/dev/sda6<br>
             read-only<br>
             </code><br>
             </p></div><p>
             </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
             Don't forget to remove the line that read <code class="envar">initrd=/boot/initrd-2.2.12-20.img</code> in the <code class="filename">lilo.conf</code> file, since this line is not necessary now monolithic kernel doesn't need an initrd file.
             </p></div><p>
             </p></li><li class="step"><p>
             
             Once the name of the new kernel version has been put in the <code class="filename">lilo.conf</code> file as shown above, we update our <code class="filename">lilo.conf</code> file for the change to take effect 
             with the following command:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>/sbin/lilo</strong></span> -v
             </pre><p>
             </p><div class="literallayout"><p><br>
               <code class="computeroutput"><br>
             LILO version 21, [Copyright 1992-1998 Werner Almesberger<br>
             Reading boot sector from /dev/sda<br>
             Merging with /boot/boot.b<br>
             Boot image: /boot/vmlinuz-2.2.14<br>
             Added linux *<br>
             /boot/boot.0800 exits  no backup copy made.<br>
             Writing boot sector.<br>
             </code><br>
             </p></div><p>
             </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
             If you say <strong class="userinput"><code>NO</code></strong> to the configuration option Unix98 <acronym class="acronym">PTY</acronym> support <code class="envar">CONFIG_UNIX98_PTYS</code> during your kernel configuration, you must edit the <code class="filename">/etc/fstab</code> file and remove the line that read:
             </p><pre class="screen">
             none		/dev/pts		devpts		gid=5,mode=620	0 0

             </pre><p>
             </p></div><p>
             </p></li></ol></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm5761"></a>11. Delete programs, Edit files pertaining to modules</h2></div></div></div><p>
           By default when you install Red Hat Linux for the first time like we do, the kernel is built as a modularized kernel. This means that each device or function we need exists as modules and is controlled by 
           the Kernel Daemon program named kmod, which automatically loads some modules and functions support into memory as it is needed, and unloads it when it's no longer being used.
           </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
           kmod and other module management programs included in the modutils <acronym class="acronym">RPM</acronym> package use the <code class="filename">conf.modules</code> file located in the <code class="filename">/etc</code> directory to know, for example which Ethernet card you 
           have, if your Ethernet card requires special configuration and so on. Since we are not using any modules in our new compiled kernel, we can remove the <code class="filename">conf.modules</code> file and uninstall completely the 
           modutils package program.

           To remove the <code class="filename">conf.modules</code> file, use the command:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>rm</strong></span> -f  /etc/conf.modules
           </pre><p>
           To uninstall the modutils package, use the following command:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>rpm</strong></span> -e --nodeps modutils
           </pre><p>
           </p></li><li class="step"><p>
           
           One last thing to do is to edit the file <code class="filename">rc.sysinit</code> and comment out all the lines related to <span class="command"><strong>depmod</strong></span> -a by inserting a <code class="prompt">#</code> at 
           the beginning of the lines. This is needed since at boot time the system read the <code class="filename">rc.sysinit</code> script to find module dependencies in the kernel by default.
           </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
           
           Comment out the line 260 in the <code class="filename">rc.sysinit</code> file vi +260 <code class="filename">/etc/rc.d/rc.sysinit</code>:
           <strong class="userinput"><code>
           if [ -x /sbin/depmod -a -n "$USEMODULES" ]; then</code></strong>,
           To read:
           </p><pre class="screen">
           #if [ -x /sbin/depmod -a -n "$USEMODULES" ]; then
           </pre><p>

           Comment out the lines 272 to 277 in the <code class="filename">rc.sysinit</code> file vi +272 <code class="filename">/etc/rc.d/rc.sysinit</code>:
           </p><pre class="screen">
           if [ -L /lib/modules/default ]; then
           INITLOG_ARGS= action "Finding module dependencies" depmod -a default
           else
           INITLOG_ARGS= action "Finding module dependencies" depmod -a
           fi
           fi
           </pre><p>
           </p><pre class="screen">
           To read:
           #    if [ -L /lib/modules/default ]; then
           #        INITLOG_ARGS= action "Finding module dependencies" depmod -a default
           #    else
           #        INITLOG_ARGS= action "Finding module dependencies" depmod -a
           #    fi
           #fi
           </pre><p>
           </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
             The procedure described above relates to initscripts-4_70-1 package under Red Hat Linux version 6.1.
             </p></div><p>

           </p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
           Comment out the line 243 in the <code class="filename">rc.sysinit</code> file vi +243 <code class="filename">/etc/rc.d/rc.sysinit</code>:
           <strong class="userinput"><code>if [ -x /sbin/depmod -a -n "$USEMODULES" ]; then</code></strong>,
           To read:
           </p><pre class="screen">
           #if [ -x /sbin/depmod -a -n "$USEMODULES" ]; then
           </pre><p>

           Comment out the lines 255 to 260 in the <code class="filename">rc.sysinit</code> file vi +255 <code class="filename">/etc/rc.d/rc.sysinit</code>:
           </p><pre class="screen">
           if [ -L /lib/modules/default ]; then
           INITLOG_ARGS= action "Finding module dependencies" depmod -a default
           else
           INITLOG_ARGS= action "Finding module dependencies" depmod -a
           fi
           fi
           </pre><p>
           To read:
           </p><pre class="screen">
           
           #    if [ -L /lib/modules/default ]; then
           #        INITLOG_ARGS= action "Finding module dependencies" depmod -a default
           #    else
           #        INITLOG_ARGS= action "Finding module dependencies" depmod -a
           #    fi
           #fi
           </pre><p>
           Once again, all of this part Delete program, file and lines related to modules is required only if you said No to <strong class="userinput"><code>Enable loadable</code></strong> module support <code class="envar">CONFIG_MODULES</code> in your kernel configuration above.
           </p></li><li class="step"><p>
           
           Now you must Reboot your system and test your results.
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>reboot</strong></span>
           </pre><p>
           When the system is rebooted and you are logged in, verify the new version of your kernel with the following command:

           To verify the version of your new kernel, use the following command:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>uname</strong></span> -a
           </pre><p>
           </p><div class="literallayout"><p><br>
             <code class="computeroutput"><br>
           Linux deep.openna.com 2.2.14 #1 Mon Jan 10 10:40:35 EDT 2000 i686 unknown<br>
           [root@deep]#<br>
           </code><br>
           </p></div><p>
           </p></li></ol></div><p>
           <span class="emphasis"><em>
           Congratulation !.
           </em></span>
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm5828"></a>12. Create a emergency Rescue and Boot floppy disk</h2></div></div></div><p>
            After the reboot of your Linux server, you should have now a system with an upgraded kernel. Therefore, it's time is to make a new rescue image with the new kernel in case of future emergencies. To do this, follow 
            the simple step below;
             Login as root, and insert a new floppy, then execute the following command:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>mkbootdisk</strong></span> --device /dev/fd0 2.2.14
             </pre><p>
             </p><div class="literallayout"><p><br>
               <code class="computeroutput"><br>
             Insert a disk in <code class="filename">/dev/fd0</code>. Any information on the disk will be lost.<br>
             Press &lt;Enter&gt; --device <span class="keycap"><strong>^C</strong></span> to abort:<br>
             </code><br>
             </p></div><p>
              </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
              The mkbootdisk program runs only on modularized kernel. So you can't use it on a monolithic kernel; instead create an emergency boot floppy as shown below if you have a problem with your system in the future.
              </p></div><p>
             Because it is possible to create a rescue floppy only on modularized kernel, we must find another way to boot our Linux system if the Linux kernel on the hard disk is damaged. This is possible with a Linux emergency 
             boot floppy disk. You should immediately create it after you successfully start your system and log in as root.
             </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
             To create the emergency boot floppy disk, follow these steps:
             </p><ol type="a" class="substeps"><li class="step"><p>
             Insert a floppy disk and format it with the following command:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>fdformat</strong></span> /dev/fd0H1440
             </pre><p>
             </p><div class="literallayout"><p><br>
               <code class="computeroutput"><br>
             Double-sided, 80 tracks, 18 sec/track. Total capacity 1440 kB.<br>
             Formatting ... done<br>
             Verifying ... done<br>
             </code><br>
             </p></div><p>
             </p></li><li class="step"><p>
             Copy the file vmlinuz from the <code class="filename">/boot</code> directory to the floppy disk:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>cp</strong></span> /boot/vmlinuz /dev/fd0
             </pre><p>
             </p><div class="literallayout"><p><br>
               <code class="computeroutput"><br>
             cp: overwrite '/dev/fd0'? y<br>
             </code><br>
             </p></div><p>
             The <code class="filename">vmlinuz</code> file is a symbolic link that point to the real Linux kernel.
             </p></li><li class="step"><p>
             Determine the kernel's root device with the following command:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>rdev</strong></span>
             /dev/sda12 /
             </pre><p>
             The kernel's root device is the disk partition where the root file system is located. In this example, the root device is <code class="filename">dev/sda12</code>; the device name may be different on your system.
             </p></li><li class="step"><p>
             Set the kernel's root device with the following command:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>rdev</strong></span> /dev/fd0 /dev/sda12
             </pre><p>
             To set the kernel's root device, use the device reported by the rdev command utility in the previous step.
             </p></li><li class="step"><p>
             5.Mark the root device as read-only with the following command:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>rdev</strong></span> -R /dev/fd0 1
             </pre><p>
             This causes Linux initially to mount the root file system as read-only. By setting the root device as read-only, you avoid several warning and error messages.
             </p></li><li class="step"><p>
             Now put the boot floppy in the drive A: and reboot your system with the following command:
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>reboot</strong></span>
             </pre><p>
             </p></li></ol></li><li class="step"><p>
             Update your /dev entries:If you have added new devices to your system or have done recently a major kernel upgrade (a major kernel upgrade is for example when you pass from kernel version 2.2.9 to 2.2.15 directly), it may be 
             important to update your <code class="filename">/dev</code> entries to avoid problems related to missing devices. 
            
             We can accomplish this task with the <code class="filename">MAKEDEV</code> script utility that scan the <code class="filename">/dev</code> 
             directory where all devices that interfaces with drivers in the kernel are kept. A special option named update allow the MAKEDEV utility to create new devices that you have configured in your kernel and delete those which 
             are no longer configured.To update your <code class="filename">/dev</code> entries, execute the following commands:
            
             </p><pre class="screen">
             [root@deep] /#<span class="command"><strong>cd</strong></span> /dev
             [root@deep ] /dev#<span class="command"><strong>./MAKEDEV</strong></span> update
             </pre><p>
             </p></li></ol></div></div></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="idm5891"></a>Part 4. Networking -Management, Firewall, Masquerading and Forwarding</h1></div></div></div><div class="partintro"><div></div><div class="mediaobject" align="center"><img src="./resources/Annimals/Chapter10.gif" align="middle" alt="PIG"></div><div class="abstract"><p class="title"><b>Abstract</b></p><p>
               Until now, we have not tinkered with the networking capabilities of Linux. Linux is one of the best existing operating systems in the world for networking features. Most Internet sites around the world already know this, and have used it for 
               quite some time. Understanding your hardware network and all files related to it is very important if you want to have a full control of what happens on your server. Good knowledge of primary networking commands is vital. Network management 
               covers a wide variety of topics. In general, it includes gathering statistical data and status of parts of your network, and taking action as necessary to deal with failures and other changes.
             </p></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="chapter"><a href="#idm5901">8. <acronym class="acronym">TCP/IP</acronym> -Network Management</a></span></dt><dd><dl><dt><span class="section"><a href="#idm5906">1. Multiple Ethernet Card per Machine</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm5981">9. Files -Networking Functionality</a></span></dt><dd><dl><dt><span class="section"><a href="#idm5990">1. The <code class="filename">/etc/HOSTNAME</code> file</a></span></dt><dt><span class="section"><a href="#idm5998">2. The <code class="filename">/etc/sysconfig/network-scripts/ifcfg-ethN</code> files</a></span></dt><dt><span class="section"><a href="#idm6043">3. The <code class="filename">/etc/resolv.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm6059">4. The <code class="filename">/etc/host.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm6085">5. The <code class="filename">/etc/sysconfig/network</code> file</a></span></dt><dt><span class="section"><a href="#idm6129">6. The <code class="filename">/etc/sysctl.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm6160">7. The <code class="filename">/etc/hosts</code> file</a></span></dt><dt><span class="section"><a href="#idm6199">8. Config <acronym class="acronym">TCP/IP</acronym> Networking manually -command line</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr4ch4nfl">10. Networking -Firewall</a></span></dt><dd><dl><dt><span class="section"><a href="#idm6289">1. Policy, Guidelines <abbr class="abbrev">etc.</abbr></a></span></dt><dt><span class="section"><a href="#idm6306">2. The topology</a></span></dt><dt><span class="section"><a href="#idm6439">3. Build a kernel with <code class="literal">IPCHAINS</code> Firewall support</a></span></dt><dt><span class="section"><a href="#idm6448">4. Rules used in the Firewall script files</a></span></dt><dt><span class="section"><a href="#idm6542">5. Source Address Filtering</a></span></dt></dl></dd><dt><span class="chapter"><a href="#prt3chp4fscf">11. The firewall scripts files</a></span></dt><dd><dl><dt><span class="section"><a href="#pr3ch4fsfsc41">1. 
          Config <code class="filename">/etc/rc.d/init.d/firewall</code> script file  -Web Server</a></span></dt><dt><span class="section"><a href="#pr3ch4fsfsc42">2. Config <code class="filename">/etc/rc.d/init.d/firewall</code> script file - Mail Server</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr4ch12nfmf">12. Networking Firewall -Masquerading and Forwarding</a></span></dt><dd><dl><dt><span class="section"><a href="#idm6691">1. Build a kernel with Firewall Masquerading and Forwarding support</a></span></dt><dt><span class="section"><a href="#idm6810">2. Config <code class="filename">/etc/rc.d/init.d/firewall</code> script file -Gateway Server</a></span></dt><dt><span class="section"><a href="#idm6824">3. Configure script for Example Gateway Server</a></span></dt><dt><span class="section"><a href="#idm6886">4. Deny access to some address</a></span></dt><dt><span class="section"><a href="#idm6923">5. <code class="literal">IPCHAINS</code> Administrative Tools</a></span></dt></dl></dd></dl></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="idm5901"></a>Chapter 8. <acronym class="acronym">TCP/IP</acronym> -Network Management</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm5906">1. Multiple Ethernet Card per Machine</a></span></dt></dl></div><div class="highlights"><p>
               The most primitive technique for network monitoring is periodic pinging of critical hosts. More sophisticated network monitoring requires the ability to get specific status and statistical information from various devices on the network. These should 
               include various sorts of data gram counts, as well as counts of errors of various kinds. For these reasons, in this part we will try to answer fundamental questions about networking devices, files related to networking functionality, and essential 
               networking commands.   
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm5906"></a>1. Multiple Ethernet Card per Machine</h2></div></div></div><p>
             You can use Linux as a gateway between two Ethernet networks. In that case, you might have two Ethernet cards on your server. To eliminate problems at boot time, the Linux kernel doesn't detect multiple cards 
             automatically. If you happen to have two or more cards, you should specify the parameters of the cards in the <code class="filename">lilo.conf</code> file for a monolithic kernel or in the <code class="filename">conf.modules</code> file 
             for a modularized kernel. The following are problems you may encounter with your network cards.
             </p><p><b>Problem 1. </b>
             If the driver(s) of the card(s) is/are being used as a loadable module <span class="emphasis"><em>modularized kernel</em></span>, in the case of <acronym class="acronym">PCI</acronym> drivers, the module will typically detect all of the installed cards 
             automatically. For <acronym class="acronym"><acronym class="acronym">ISA</acronym></acronym> cards, you need to supply the <code class="literal">I/O</code> base address of the card so the module knows where to look. This information is stored in the file <code class="filename">/etc/conf.modules</code>.
             
             </p><div class="example"><a name="idm5920"></a><p class="title"><b>Example 8.1. Two ISA ethernet cards</b></p><div class="example-contents"><p>       

             Consider we have two <acronym class="acronym">ISA</acronym> <code class="literal">3c509</code> cards, one at <code class="literal">I/O</code> <code class="literal">0x300</code> and one at <code class="literal">I/O</code> <code class="literal">0x320</code>.

             For <acronym class="acronym">ISA</acronym> cards, edit the <code class="filename">conf.modules</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/conf.modules</code> and add:
             </p><pre class="programlisting">
             alias eth0 3c509
             alias eth1 3c509
             options 3c509 io=0x300,0x320
             </pre><p>
             
             This says that the <code class="literal">3c509</code> driver should be loaded for either <code class="literal">eth0</code> or <code class="literal">eth1</code> alias <code class="literal">eth0</code>, <code class="literal">eth1</code> and it should be loaded with 
             the options <code class="literal">io=0x300,0x320</code> so that the drivers knows where to look for the cards. Note that <code class="literal">0x</code> is important,  things like <code class="literal">300h</code> as commonly used in the <acronym class="acronym">DOS</acronym> world wont work.
             </p><p>
             For <acronym class="acronym">PCI</acronym> cards, you typically only need the alias lines to correlate the <code class="literal">ethN</code> interfaces with the appropriate driver name, since the <code class="literal">I/O</code> base of a <acronym class="acronym">PCI</acronym> card can be safely 
             detected.

             For <acronym class="acronym">PCI</acronym> cards, edit the <code class="filename">conf.modules</code> file <span class="command"><strong>vi</strong></span> <code class="filename">/etc/conf.modules</code> and add:
             </p><pre class="programlisting">
             alias eth0 3c509
             alias eth1 3c509
             </pre><p>
             </p></div></div><p><br class="example-break">
             </p><p><b>Problem 2. </b>
             If the drivers(s) of the card(s) is/are compiled into the kernel -<span class="emphasis"><em>monolithic kernel</em></span>, the <acronym class="acronym">PCI</acronym> probes will find all related cards automatically. <acronym class="acronym">ISA</acronym> cards 
             will also find all related cards automatically, but in some circumstance <acronym class="acronym">ISA</acronym> cards still need to do the following. This information is stored in the file <code class="filename">/etc/lilo.conf</code>. The method 
             is to pass boot-time arguments to the kernel, which is usually done by <code class="literal">LILO</code>.
             For <acronym class="acronym">ISA</acronym> cards, edit the <code class="filename">lilo.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/lilo.conf</code> and add:
             
             </p><pre class="programlisting">
             append=ether=0,0,eth1
             </pre><p>
             </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
             First test your <acronym class="acronym">ISA</acronym> cards without the boot-time arguments in the <code class="filename">lilo.conf</code> file, and if this fails, use the boot-time arguments.
             </p></div><p>
             
             In this case <code class="literal">eth0</code> and <code class="literal">eth1</code> will be assigned in the order that the cards are found at boot. Since we have recompiled the kernel, we must use the 
             second method. If the drivers(s) is/are compiled into the kernel to install our second Ethernet card on the system. Remember that this is required only in some circumstance 
             for <acronym class="acronym">ISA</acronym> cards, <acronym class="acronym">PCI</acronym> cards will be found automatically.
             
             </p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="idm5981"></a>Chapter 9. Files -Networking Functionality</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm5990">1. The <code class="filename">/etc/HOSTNAME</code> file</a></span></dt><dt><span class="section"><a href="#idm5998">2. The <code class="filename">/etc/sysconfig/network-scripts/ifcfg-ethN</code> files</a></span></dt><dt><span class="section"><a href="#idm6043">3. The <code class="filename">/etc/resolv.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm6059">4. The <code class="filename">/etc/host.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm6085">5. The <code class="filename">/etc/sysconfig/network</code> file</a></span></dt><dt><span class="section"><a href="#idm6129">6. The <code class="filename">/etc/sysctl.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm6160">7. The <code class="filename">/etc/hosts</code> file</a></span></dt><dt><span class="section"><a href="#idm6199">8. Config <acronym class="acronym">TCP/IP</acronym> Networking manually -command line</a></span></dt></dl></div><div class="highlights"><p>This chapter deals with all the basic files usually text files related to <acronym class="acronym">TCP/IP</acronym> networking.It's very important to know the configurations files related to <acronym class="acronym">TCP/IP</acronym> networking, so that you can 
               edit and configure the files if necessary. Remember that our server doesn't have an <code class="literal">Xwindow</code> interface to configure files via graphical interface. Even if you use a <acronym class="acronym">GUI</acronym> in your daily activities it 
               is important to know how to configure network in text mode. The following sections describe the basic <acronym class="acronym">TCP/IP</acronym> configuration files.  
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm5990"></a>1. The <code class="filename">/etc/HOSTNAME</code> file</h2></div></div></div><p>
           This file stores your system's host name, your system's fully qualified domain name <acronym class="acronym">-FQDN,</acronym> such as <code class="literal">deep.openna.com</code>.
           Following is a sample <code class="filename">/etc/HOSTNAME</code> file:
           </p><pre class="programlisting">
           deep.openna.com
           </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm5998"></a>2. The <code class="filename">/etc/sysconfig/network-scripts/ifcfg-ethN</code> files</h2></div></div></div><p>
           File configurations for each network device you may have or want to add on your system are located in the <code class="filename">/etc/sysconfig/network-scripts/</code> directory with Red Hat Linux 6.1 or 6.2 and 
           are named <code class="literal">ifcfg-eth0</code> for the first interface and <code class="literal">ifcfg-eth1</code> for the second, etc.
           Following is a example <code class="filename">/etc/sysconfig/network-scripts/ifcfg-eth0</code> file:
           </p><div class="informalexample"><pre class="programlisting">
           DEVICE=eth0
           IPADDR=208.164.186.1
           NETMASK=255.255.255.0
           NETWORK=208.164.186.0
           BROADCAST=208.164.186.255
           ONBOOT=yes
           BOOTPROTO=none
           USERCTL=no
           </pre></div><p>
           If you want to modify your network address manually, or add a new network on a new interface, edit this file -<code class="literal">ifcfg-ethN</code>, or create a new one and make the appropriate changes.
           </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           DEVICE=devicename, where devicename is the name of the physical network device.
               </p></li><li class="listitem"><p>
           IPADDR=ipaddr, where ipaddr is the IP address.
            </p></li><li class="listitem"><p>
           NETMASK=netmask, where netmask is the netmask IP value.
             </p></li><li class="listitem"><p>
           NETWORK=network, where network is the network IP address.
             </p></li><li class="listitem"><p>
           BROADCAST=broadcast, where broadcast is the broadcast IP address.
             </p></li><li class="listitem"><p>
           ONBOOT=answer, where answer is yes or no. <span class="emphasis"><em>Do the interface need to be active or inactive at boot time</em></span>.
           </p></li><li class="listitem"><p>
           BOOTPROTO=proto, where proto is one of the following :
                      </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
           none - No boot-time protocol should be used.
           </p></li><li class="listitem"><p>
           bootp - The bootp <span class="emphasis"><em>now pump</em></span>  protocol should be used.
           </p></li><li class="listitem"><p>
           dhcp - The dhcp protocol should be used.
           </p></li></ol></div><p>
            </p></li><li class="listitem"><p>
           USERCTL=answer, where answer is one of the following:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
           yes <span class="emphasis"><em>- Non-root users are allowed to control this device</em></span>.
           </p></li><li class="listitem"><p>
           no <span class="emphasis"><em>- Only the super-user root is allowed to control this device</em></span>.
           </p></li></ol></div><p>
           </p></li></ul></div><p>
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6043"></a>3. The <code class="filename">/etc/resolv.conf</code> file</h2></div></div></div><p>
           This file is another text file, used by the resolver a library that determines the <acronym class="acronym">IP</acronym> address for a host name.
           Following is a sample <code class="filename">/etc/resolv.conf</code> file:
           </p><pre class="programlisting">
           search openna.com
           nameserver 208.164.186.1
           nameserver 208.164.186.2
           </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
           Name servers are queried in the order they appear in the file <code class="literal">primary, secondary</code>.
           </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6059"></a>4. The <code class="filename">/etc/host.conf</code> file</h2></div></div></div><p>
           This file specifies how names are resolved. Linux uses a resolver library to obtain the <acronym class="acronym">IP</acronym> address corresponding to a host name.
           Following is a sample <code class="filename">/etc/host.conf</code> file:
           </p><pre class="programlisting">
           # Lookup names via DNS first then fall back to /etc/hosts.
           order bind,hosts    <a name="hs.cnf.co1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
           # We have machines with multiple addresses.
           multi on            <a name="hs.cnf.co2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
           # Check for <acronym class="acronym">IP</acronym> address spoofing.
           nospoof on          <a name="hs.cnf.co3"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>  
           </pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#hs.cnf.co1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
           The order option indicates the order of services. The sample entry specifies that the resolver library should first consult the name server (DNS) to resolve a name and then check the <code class="filename">/etc/hosts</code> file.
           </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#hs.cnf.co2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
           The multi option determines whether a host in the <code class="filename">/etc/hosts</code> file can have multiple <acronym class="acronym">IP</acronym> addresses multiple interface <code class="literal">ethN.</code> Hosts that have more than one <acronym class="acronym">IP</acronym> address are said to be multiomed, because the presence of multiple <acronym class="acronym"><acronym class="acronym">IP</acronym></acronym> addresses implies that host has several network interfaces.
           </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#hs.cnf.co3"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>
           The nospoof option indicates to take care of not permitting spoofing on this machine. <acronym class="acronym">IP</acronym>-Spoofing is a security exploit that works by tricking computers in a trust relationship that you are someone that you really aren't.
           </p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6085"></a>5. The <code class="filename">/etc/sysconfig/network</code> file</h2></div></div></div><p>
           The <code class="filename">/etc/sysconfig/network</code> file is used to specify information about the desired network configuration on your server.
           Following is a example <code class="filename">/etc/sysconfig/network</code> file:
          
           </p><div class="informalexample"><pre class="programlisting">
           NETWORKING=yes
           FORWARD_IPV4=yes
           HOSTNAME=deep. openna.com
           GATEWAY=0.0.0.0
           GATEWAYDEV=
           </pre></div><p>
           </p><p>
           The following values may be used:
           </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           <code class="envar">NETWORKING=answer</code>, where answer is yes or no -<span class="emphasis"><em>Configure networking or not to configure networking</em></span>.
           </p></li><li class="listitem"><p>
           <code class="envar">FORWARD_IPV4=answer</code>, where answer is yes or no -<span class="emphasis"><em>Perform <acronym class="acronym">IP</acronym> forwarding or not to perform <acronym class="acronym">IP</acronym> forwarding</em></span>.
           </p></li><li class="listitem"><p>
           <code class="envar">HOSTNAME=hostname</code>, where hostname is the hostname of your server.
           </p></li><li class="listitem"><p>
           <code class="envar">GATEWAY=gwip</code>, where gwip is the <acronym class="acronym">IP</acronym> address of the remote network gateway -<span class="emphasis"><em>if available</em></span>.
           </p></li><li class="listitem"><p>
           <code class="envar">GATEWAYDEV=gwdev</code>, where gwdev is the device name <code class="literal">eth#</code> you use to access the remote gateway.
           </p></li></ul></div><p>
           </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
           For compatibility with older software, the /etc/HOSTNAME file should contain the same value as <code class="envar">HOSTNAME= hostname</code> above. With the new version of Red Hat Linux 6.2 the <code class="envar">FORWARD_IPV4= parameter</code> is now 
           specified in the <code class="filename">/etc/sysctl.conf</code> file instead of the <code class="filename">/etc/sysconfig/network</code> file.
           </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6129"></a>6. The <code class="filename">/etc/sysctl.conf</code> file</h2></div></div></div><p>
           In Red Hat Linux 6.2, many kernel options related to networking security such as dropping packets that come in over interfaces they shouldn't or ignoring <code class="literal">ping/broadcasts</code> request, <abbr class="abbrev">etc.</abbr> can 
           be set in the new <code class="filename">/etc/sysctl.conf</code> file instead of the <code class="filename">/etc/rc.d/rc.local</code> file. One important consideration is the <code class="literal">IPv4</code> forwarding parameter which is now done via 
           the sysctl program, as opposed to being controlled by the contents of the file in <code class="filename">/etc/sysconfig/network</code>. The sysctl settings are stored in <code class="filename">/etc/sysctl.conf</code>, and are loaded at each 
           boot before the <code class="filename">/etc/rc.d/rc.local</code> file is loaded. We've already talked about all networking security parameters that we must set into the 
           server in <a class="link" href="#prt2ch1gss" title="Chapter 5. General System Security">General System Security</a>, and for this reason we'll focus only on the kernel option for <code class="literal">IPv4</code> forwarding.
           </p><p>
           To enable IPv4 forwarding on your RH 6.2 system, use the following command:
           Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
           </p><pre class="programlisting">
           # Enable packet forwarding
           net.ipv4.ip_forward = 1
           </pre><p>
           
           You must restart your network for the change to take effect. The command to restart the network is the following:
           </p><pre class="screen">
           [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
           </pre><p>
           </p><pre class="literallayout">
           <code class="computeroutput">
           Setting network parameters	        [  OK  ]
           Bringing up interface lo	        [  OK  ]
           Bringing up interface eth0	        [  OK  ]
           Bringing up interface eth1	        [  OK  ]
           </code>
           </pre><p>
           </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
           Enabling IPv4 forwarding via the <code class="filename">sysctl.conf</code> file is only valid for Red Hat Linux 6.2 users. Users with version 6.1 of Red Hat must set this parameter into the <code class="filename">/etc/sysconfig/network</code> file as 
           explained above.
           </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6160"></a>7. The <code class="filename">/etc/hosts</code> file</h2></div></div></div><p>
           As your machine gets started, it will need to know the mapping of some hostnames to <acronym class="acronym">IP</acronym> addresses before <acronym class="acronym">DNS</acronym> can be referenced. This mapping is kept in the <code class="filename">/etc/hosts</code> file. In the absence of a name server, any 
           network program on your system consults this file to determine the <acronym class="acronym">IP</acronym> address that corresponds to a host name.
           </p><p>
           Following is a sample <code class="filename">/etc/hosts</code> file:
           </p><pre class="programlisting">
           <acronym class="acronym">IP</acronym>Address     Hostname    		 Alias
           127.0.0.1			localhost	 	 deep.openna.com
           208.164.186.1		deep.openna.com		 deep
           208.164.186.2		mail.openna.com		 mail
           208.164.186.3		web.openna.com		 web
           </pre><p>
           The leftmost column is the <acronym class="acronym">IP</acronym> address to be resolved. The next column is that host's name. Any subsequent columns are alias for that host. In the second line, for example, the <acronym class="acronym">IP</acronym> address <code class="literal">208.164.186.1</code> is for 
           the host <code class="literal">deep.openna.com</code>. Another name for <code class="literal">deep.openna.com</code> is deep.
           </p><p>
           After you are finished configuring your networking files, don't forget to restart your network for the changes to take effect.
           </p><pre class="screen">           
           [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
           </pre><p>
           </p><pre class="literallayout">
             <code class="computeroutput">
           Setting network parameters		 [  OK  ]
           Bringing up interface lo		 [  OK  ]
           Bringing up interface eth0	         [  OK  ]
           Bringing up interface eth1	         [  OK  ]
           </code>
           </pre><p>
           </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
           Time out problems for telnet or ftp connection are often caused by the server trying to resolve the client <acronym class="acronym">IP</acronym> address to a <acronym class="acronym">DNS</acronym> name. Either <acronym class="acronym">DNS</acronym> isn't configured properly on your server or the client machines aren't known to <acronym class="acronym">DNS</acronym>. If you intend to run telnet or ftp services 
           on your server, and aren't using <acronym class="acronym">DNS</acronym>, don't forget to add the client machine name and <acronym class="acronym">IP</acronym> in your <code class="filename">/etc/hosts</code> file on the server or you can expect to wait several minutes for the <acronym class="acronym">DNS</acronym> lookup to time out, before you get a <code class="prompt">login:</code> prompt.
           </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6199"></a>8. Config <acronym class="acronym">TCP/IP</acronym> Networking manually -command line</h2></div></div></div><p>
         The ifconfig utility is the tool used to set up and configure your network card. You should understand this command in the event you need to configure the network by hand. An important note to take care with is when using ifconfig to configure your network devices; the settings will not survive a reboot.
         To assign the <code class="literal">eth0</code> interface the <acronym class="acronym">IP</acronym>-address of <code class="literal">208.164.186.2</code> use the command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>ifconfig</strong></span> eth0 208.164.186.2 netmask 255.255.255.0
         </pre><p>
         </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
         Usually, the pratice is to configure or change the <acronym class="acronym">TCP/IP</acronym> networking manually only to make some test on the server. If you want to keep your <acronym class="acronym">TCP/IP</acronym> values, it's preferable to set them in the files related to networking functionality.
         </p></div><p>
         </p><p>
         To display all the interfaces you have on your server, use the command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>ifconfig</strong></span>
         </pre><p>
         The output should look something like this:
         </p><pre class="literallayout">
           <code class="computeroutput">
         eth0	Link encap:Ethernet  HWaddr 00:E0:18:90:1B:56  
         inet addr:208.164.186.2  Bcast:208.164.186.255  Mask:255.255.255.0
         UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
         RX packets:1295 errors:0 dropped:0 overruns:0 frame:0
         TX packets:1163 errors:0 dropped:0 overruns:0 carrier:0
         collisions:0 txqueuelen:100 
         Interrupt:11 Base address:0xa800 

         lo	Link encap:Local Loopback  
         inet addr:127.0.0.1  Mask:255.0.0.0
         UP LOOPBACK RUNNING  MTU:3924  Metric:1
         RX packets:139 errors:0 dropped:0 overruns:0 frame:0
         TX packets:139 errors:0 dropped:0 overruns:0 carrier:0
         collisions:0 txqueuelen:0 
         </code>
         </pre><p>
         If the ifconfig tool is invoked without any parameters, it displays all interfaces you have configured. An option of  -a shows the inactive one as well.
         </p><p>
         To display all interfaces as well as inactive interfaces you may have, use the command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>ifconfig</strong></span> -a
         </pre><p>
         The output should look something like this:
         </p><pre class="literallayout">         
         <code class="computeroutput">
         eth0	Link encap:Ethernet  HWaddr 00:E0:18:90:1B:56  
         inet addr:208.164.186.2  Bcast:208.164.186.255  Mask:255.255.255.0
         UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
         RX packets:1295 errors:0 dropped:0 overruns:0 frame:0
         TX packets:1163 errors:0 dropped:0 overruns:0 carrier:0
         collisions:0 txqueuelen:100 
         Interrupt:11 Base address:0xa800 

         eth1	Link encap:Ethernet  HWaddr 00:E0:18:90:1B:56  
         inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
         UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
         RX packets:1295 errors:0 dropped:0 overruns:0 frame:0
         TX packets:1163 errors:0 dropped:0 overruns:0 carrier:0
         collisions:0 txqueuelen:100 
         Interrupt:5 Base address:0xa320

         lo	Link encap:Local Loopback  
         inet addr:127.0.0.1  Mask:255.0.0.0
         UP LOOPBACK RUNNING  MTU:3924  Metric:1
         RX packets:139 errors:0 dropped:0 overruns:0 frame:0
         TX packets:139 errors:0 dropped:0 overruns:0 carrier:0
         collisions:0 txqueuelen:0
         </code>
         </pre><p>
         It is important to note that the settings configured with the ifconfig toll for your network devices will not survive a reboot.
         </p><p>
         To assign the default gateway for <code class="literal">208.164.186.12</code> use the command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>route</strong></span> add default gw 208.164.186.1
         </pre><p>
         In this example, the default route is set up to go to <code class="literal">208.164.186.12</code>, your router. Once again, if you want to keep your default gateway value, it's preferable to set in it the files related 
         to networking functionality -<code class="filename">/etc/sysconfig/network</code>.
         </p><p>
         Verify that you can reach your hosts. Choose a host from your network, for instance <code class="literal">208.164.186.1</code>. Use the command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>ping</strong></span> 208.164.186.1
         </pre><p>
         The output should look something like this:
         </p><pre class="literallayout"><code class="computeroutput">
         [root@deep networking]# ping 208.164.186.1
         PING 208.164.186.1 (208.164.186.1) from 208.164.186.2 : 56 data bytes
         64 bytes from 208.164.186.2: icmp_seq=0 ttl=128 time=1.0 ms
         64 bytes from 208.164.186.2: icmp_seq=1 ttl=128 time=1.0 ms
         64 bytes from 208.164.186.2: icmp_seq=2 ttl=128 time=1.0 ms
         64 bytes from 208.164.186.2: icmp_seq=3 ttl=128 time=1.0 ms

         --- 208.164.186.1 ping statistics ---
         4 packets transmitted, 4 packets received, 0% packet loss
         round-trip min/avg/max = 1.0/1.0/1.0 ms
         </code>
         </pre><p>
         </p><p>
         You should now display the routing information with the command route to see if both hosts have the correct routing entry. Use the command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>route</strong></span> -n
         </pre><p>
         The output should look something like this:
         </p><pre class="literallayout"><code class="computeroutput">
         Kernel         IP                      routing table
         Destination	Gateway	Genmask	Flags	Metric	Ref 	Use	Iface
         208.164.186.2	0.0.0.0	255.255.255.255	UH	0	0	0	eth0
         208.164.186.0	208.164.186.2	255.255.255.0	UG	0	0	0	eth0
         208.164.186.0	0.0.0.0	255.255.255.0	U	0	0	0	eth0
         127.0.0.0	0.0.0.0	255.0.0.0	U	0	0	0	lo
         </code>
         </pre><p>
         </p><p>

         To check the status of the interfaces quickly, use the <span class="command"><strong>netstat</strong></span> -i command, as follows:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>netstat</strong></span> -i
         </pre><p>
         The output should look something like this:
         </p><pre class="literallayout"><code class="computeroutput">
         Kernel Interface table
         Iface	MTU	Met	RX-OK	RX-ERR	RX-DRP	RX-OVR	TX-OK	TX-ERR	TX-DRP	TX-OVR Flg
         eth0	1500	0	4236	0	0	0	3700	0	0	0	BRU	
         lo	3924	0	13300	0	0	0	13300	0	0	0	LRU
         ppp0	1500	0	14	1	0	0	16	0	0	0	PRU
         </code>
         </pre><p>
         </p><p>
         Another useful netstat option is  <code class="literal">-t</code>, which shows all active <acronym class="acronym">TCP</acronym> connections. Following is a typical result of netstat -t:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>netstat</strong></span> -t
         </pre><p>
         The output should look something like this:
         </p><pre class="literallayout"><code class="computeroutput">
         Active Internet connections (w/o servers)
         Proto	Recv-Q	Send-Q	Local Address	Foreign Address	State      
         Tcp	0	0	deep.openar:netbios-ssn	gate.openna.com:1045	ESTABLISHED 
         Tcp	0	0	localhost:1032	localhost:1033	ESTABLISHED 
         Tcp	0	0	localhost:1033	localhost:1032	ESTABLISHED 
         Tcp	0	0	localhost:1030	localhost:1034	ESTABLISHED 
         Tcp	0	0	localhost:1031	localhost:1030	ESTABLISHED 
         Tcp	0	0	localhost:1028	localhost:1029	ESTABLISHED 
         Tcp	0	0	localhost:1029	localhost:1028	ESTABLISHED 
         Tcp	0	0	localhost:1026	localhost:1027	ESTABLISHED 
         Tcp	0	0	localhost:1027	localhost:1026	ESTABLISHED 
         Tcp	0	0	localhost:1024	localhost:1025	ESTABLISHED 
         Tcp	0	0	localhost:1025	localhost:1024	ESTABLISHED 
         </code>
         </pre><p>
         </p><p>
         To shows all active and listen TCP connections, use the command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>netstat</strong></span> -vat
         </pre><p>
         The output should look something like this:
         </p><pre class="literallayout"><code class="computeroutput">
         Active Internet connections (servers and established)
         Proto Recv-Q Send-Q Local Address           	        Foreign Address                 State      
         tcp        0      0 deep.openna.co:domain 	        *:*                     	LISTEN      
         tcp        0      0 localhost:domain       	        *:*                    	        LISTEN      
         tcp        0      0 deep.openna.com:ssh   	        gate.openna.com:1682  	        ESTABLISHED 
         tcp        0      0 *:webcache              		*:*                     	LISTEN      
         tcp        0      0 deep.openar:netbios-ssn	        *:*                     	LISTEN      
         tcp        0      0 localhost:netbios-ssn  		*:*                     	LISTEN      
         tcp        0      0 localhost:1032          		localhost:1033          	ESTABLISHED 
         tcp        0      0 localhost:1033          		localhost:1032          	ESTABLISHED 
         tcp        0      0 localhost:1030          		localhost:1031          	ESTABLISHED 
         tcp        0      0 localhost:1031          		localhost:1030          	ESTABLISHED 
         tcp        0      0 localhost:1028          		localhost:1029          	ESTABLISHED 
         tcp        0      0 localhost:1029         		localhost:1028          	ESTABLISHED 
         tcp        0      0 localhost:1026          		localhost:1027          	ESTABLISHED 
         tcp        0      0 localhost:1027          		localhost:1026          	ESTABLISHED 
         tcp        0      0 localhost:1024          		localhost:1025          	ESTABLISHED 
         tcp        0      0 localhost:1025          		localhost:1024          	ESTABLISHED 
         tcp        0      0 deep.openna.com:www   	        *:*                    		LISTEN      
         tcp        0      0 deep.openna.com:https 	        *:*                    		LISTEN      
         tcp        0      0 *:389            	       		*:*                     	LISTEN      
         tcp        0      0 *:ssh       	            	*:*              		LISTEN      
         </code></pre><p>
         </p><p>
         To stop all network devices manually on your system, use the following command:
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>stop</strong></span>
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Shutting down interface eth0	         [  OK  ]
         Disabling IPv4 packet forwarding	 [  OK  ]
         </code></pre><p>
         </p><p>
         To start all network devices manually on your system, use the following command:
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>start</strong></span>

         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Enabling IPv4 packet forwarding	  [  OK  ]
         Bringing up interface lo		  [  OK  ]
         Bringing up interface eth0	          [  OK  ]
         </code></pre><p>
         </p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="pr4ch4nfl"></a>Chapter 10. Networking -Firewall</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm6289">1. Policy, Guidelines <abbr class="abbrev">etc.</abbr></a></span></dt><dt><span class="section"><a href="#idm6306">2. The topology</a></span></dt><dt><span class="section"><a href="#idm6439">3. Build a kernel with <code class="literal">IPCHAINS</code> Firewall support</a></span></dt><dt><span class="section"><a href="#idm6448">4. Rules used in the Firewall script files</a></span></dt><dt><span class="section"><a href="#idm6542">5. Source Address Filtering</a></span></dt></dl></div><div class="highlights"><p>
          Can someone tell me why I might want something like a commercial firewall product rather than simply using <code class="literal">Ipchains</code> and restricting certain packets? What am I losing by using <code class="literal">Ipchains</code>? Now, there is undoubtedly room 
          for debate on this-
          </p><p>
          <code class="literal">Ipchains</code> is as good, and most of the time better, than commercial firewall packages from a functionality and support standpoint. You will probably have more insight into what's going on in your 
          network using <code class="literal">Ipchains</code> than a commercial solution. That said, a lot of corporate types want to tell their shareholders, <acronym class="acronym">CEO,CTO</acronym> etc. that they have the backing of reputable security Software Company. The firewall 
          could be doing nothing more than passing through all traffic, and still the corporate type would be more comfortable than having to rely on the geeky guy in the corner cube who gets grumpy if you turn the light on before noon.
          </p><p>
          In the end, a lot of companies want to be able to turn around and demand some sort of restitution from a vendor if the network is breached, whether or not they'd actually get anything or even try. All they can typically 
          do with an open source solution is fire the guy that implemented it. At least some of the commercial firewalls are based on Linux or something similar. 
          </p><p>
          It's quite probable that <code class="literal">Ipchains</code> is secure enough for you but not 
          those engaging in serious amounts of high stakes bond trading. Doing a cost/benefit analysis and asking a lot of pertinent questions is recommended before spending serious money on a commercial firewall---otherwise you may 
          end up with something inferior to your <code class="literal">Ipchains</code> tool. Quite a few of the NT firewalls are likely to be no better than <code class="literal">Ipchains</code> and the general consensus on bugtraq and NT bugtraq are that <span class="emphasis"><em>NT is far too insecure to run a serious firewall</em></span>.
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6289"></a>1. Policy, Guidelines <abbr class="abbrev">etc.</abbr></h2></div></div></div><p>
          <span class="emphasis"><em>What is a Network Firewall Security Policy?</em></span>
          Network firewall security policy defines those services that will be explicitly allowed or denied, how these services will be used and the exceptions to these rules. An organization's overall 
          security policy must be determined according to security and business-need analysis. Since a firewall relates to network security alone, a firewall has little value unless the overall security 
          policy is properly defined. Every rule in the network firewall security policy should be implemented on a firewall. Generally, a firewall uses one of the following methods.
          </p><p>
          <span class="emphasis"><em>Everything not specifically permitted is denied.</em></span>
          This approach blocks all traffic between two networks except for those services and applications that are permitted. Therefore, each desired service and application should be implemented one 
          by one. No service or application that might be a potential hole on the firewall should be permitted. This is the most secure method, denying services and applications unless explicitly allowed 
          by the administrator. On the other hand, from the point of users, it might be more restrictive and less convenient. This is the method we will use in our Firewall configuration files in this book.
          </p><p><span class="emphasis"><em>
          Everything not specifically denied is permitted</em></span>
          This approach allows all traffic between two networks except for those services and applications that are denied. Therefore, each untrusted or potentially harmful service or application should be 
          denied one by one. Although this is a flexible and convenient method for the users, it could potentially cause some serious security problems.
          </p><p>
          <span class="emphasis"><em>What is Packet Filtering?</em></span>
          Packet Filtering is the type of firewall built into the Linux kernel. A filtering firewall works at the network level. Data is only allowed to leave the system if the firewall rules allow it. As 
          packets arrive they are filtered by their type, source address, destination address, and port information contained in each packet.
          Most of the time, packet filtering is accomplished by using a router that can forward packets according to filtering rules. When a packet arrives at the packet-filtering router, the router extracts 
          certain information from the packet header and makes decisions according to the filter rules as to whether the packet will pass through or be discarded.
          </p><p>
          The following information can be extracted from the packet header:
          </p><pre class="programlisting">
          
          Source IP address
          Destination IP address
          <acronym class="acronym">TCP/UDP</acronym> source port
          <acronym class="acronym">TCP/UDP</acronym> destination port
          <acronym class="acronym">ICMP</acronym> message type
          Encapsulated protocol information (TCP, UDP, ICMP or IP tunnel)
          
          </pre><p>
          Because very little data is analyzed and logged, filtering firewalls take less <acronym class="acronym">CPU</acronym> power and create less latency in your network. There are lots of ways to structure your network to protect your systems 
          using a firewall.
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6306"></a>2. The topology</h2></div></div></div><p>
          All servers should be configured to block at least the unused ports, even if there are not a firewall server. This is required for more security. Imagine someone gains access to your firewall gateway server: if 
          your neighborhoods servers are not configured to block unused ports, this is a serious network risk. The same is true for local connections; unauthorized employees can gain access from the inside to your other 
          servers in this manner.
          </p><p>
          In our configuration we will give you three different examples that can help you to configure your firewall rules depending on the type of the server you want to protect and the placement of these servers on your 
          network architecture. 
          </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
          The first example firewall rules file will be for a <code class="literal">Web Server</code>. 
          </td></tr><tr><td>
          The second for a <code class="literal">Mail Server</code>. 
          </td></tr><tr><td>
          The last for a <code class="literal">Gateway Server</code> that acts as proxy for the inside Wins, Workstations and Servers machines. 
          </td></tr></table><p>
          </p><p>
          See the graph below to get an idea:

          </p><div class="mediaobject"><img src="./images/Firewall-Schema.gif" alt="Firewall schematic representaion"><div class="caption"><p>
          The graph above shows you the ports that I enable on the different servers by default in my firewall scripts file in this book
            </p></div></div><p>
          </p><p><b>
          www.openna.com
          Caching Only DNS
          208.164.186.3
          . </b>
          </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
          Unlimited traffic on the loopback interface allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">ICMP</acronym> traffic allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">DNS</acronym> Caching and Client Server on port 53 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">SSH</acronym> Server on port 22 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">HTTP</acronym> Server on port 80 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">HTTPS</acronym> Server on port 443 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">SMTP</acronym> Client on port 25 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">FTP</acronym> Server on ports 20, 21 allowed
          </p></li><li class="listitem"><p>
          Outgoing traceroute request allowed
          </p></li></ol></div><p>
          </p><p><b>
          deep.openna.com
          Master DNS Server
          208.164.186.1
            . </b>
          </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
          Unlimited traffic on the loopback interface allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">ICMP</acronym> traffic allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">DNS</acronym> Server and Client on port 53 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">SSH</acronym> Server and Client on port 22 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">HTTP</acronym> Server and Client on port 80 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">HTTPS</acronym> Server and Client on port 443 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">WWW</acronym>-CACHE Client on port 8080 allowed
          </p></li><li class="listitem"><p>
          External <acronym class="acronym">POP</acronym> Client on port 110 allowed
          </p></li><li class="listitem"><p>
          External <acronym class="acronym">NNTP</acronym> NEWS Client on port 119 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">SMTP</acronym> Server and Client on port 25 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">IMAP</acronym> Server on port 143 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">IRC</acronym> Client on port 6667 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">ICQ</acronym> Client on port 4000 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">FTP</acronym> Client on port 20, 21 allowed
          </p></li><li class="listitem"><p>
          RealAudio / QuickTime Client allowed
          </p></li><li class="listitem"><p>
          Outgoing traceroute request allowed
          </p></li></ol></div><p>
          </p><p><b>
          mail.openna.com
          Slave DNS Server
          208.164.186.2
          . </b>
          </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
          Unlimited traffic on the loopback interface allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">ICMP</acronym> traffic allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">DNS</acronym> Server and Client on port 53 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">SSH</acronym> Server on port 22 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">SMTP</acronym> Server and Client on port 25 allowed
          </p></li><li class="listitem"><p>
          <acronym class="acronym">IMAP</acronym> Server on port 143 allowed
          </p></li><li class="listitem"><p>
          Outgoing traceroute request allowed
          </p></li></ol></div><p>
          </p><p>
          The list above shows you the ports that I enable on the different servers by default in my firewall scripts file in this book. Depending on what services must be available in the server for the outside, you 
          must configure your firewall script file to allow the traffic on the specified ports. 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">www.openna.com</code> is our Web Server, 
          </p></li><li class="listitem"><p>
          <code class="literal">mail.openna.com</code> is our Mail Hub Server for all the internal network, 
          </p></li><li class="listitem"><p>
          <code class="literal">deep.openna.com </code> is our Gateway Server 
          </p></li></ul></div><p>
          for all the examples explained later in this chapter.
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6439"></a>3. Build a kernel with <code class="literal">IPCHAINS</code> Firewall support</h2></div></div></div><p>
          The first thing you need to do is ensure that your kernel has been built with Network Firewall support enabled and Firewalling. Remember, all servers should be configured to block unused ports, even if 
          there are no firewall server. In the 2.2.14 kernel version you need to be sure that you have answered <strong class="userinput"><code>Y</code></strong> to the following questions:
          </p><pre class="programlisting">
          <strong class="userinput"><code>Networking options:</code></strong>
          
         
          Network firewalls (CONFIG_FIREFALL) [N] Y
          IP:Firewalling (CONFIG_IP_FIREWALL) [N] Y
          IP:TCP syncookie support (CONFIG_SYN_COOKIES) [N] Y
          
          </pre><p>
          If you have followed the Linux Kernel section and have recompiled your kernel, the options Network firewalls, <acronym class="acronym">IP</acronym>:Firewalling, and <acronym class="acronym">IP:TCP</acronym> syncookie support shown above are already set.
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6448"></a>4. Rules used in the Firewall script files</h2></div></div></div><p>
          The following is an explanation of a few of the rules that will be used in the Firewalling examples below. This is shown just as a reference, the firewall scripts are well commented and very easy to modify.
          Constants are used, in the firewall scripts files  for most values. The most basic constants are:
          </p><div class="glosslist"><dl><dt><span class="glossterm">
          <code class="literal">EXTERNAL_INTERFACE</code></span></dt><dd class="glossdef"><p>
          This is the name of the external network interface to the Internet. It's defined as eth0 in the examples.
          </p></dd><dt><span class="glossterm">
          <code class="literal">LOCAL_INTERFACE_1</code>
          </span></dt><dd class="glossdef"><p>
          This is the name of the internal network interface to the LAN, if any. It's defined as eth1 in the examples.
          </p></dd><dt><span class="glossterm">
          <code class="literal">LOOPBACK_INTERFACE</code>
          </span></dt><dd class="glossdef"><p>
          This is the name of the loopback interface. It's defined as lo in the examples.
          </p></dd><dt><span class="glossterm">
          <code class="literal">IPADDR</code></span></dt><dd class="glossdef"><p>
          This is the <acronym class="acronym">IP</acronym> address of your external interface. It's either a static <acronym class="acronym">IP</acronym> address registered with InterNIC, or else a dynamically assigned address from your <acronym class="acronym">ISP</acronym> (usually via DHCP).
          </p></dd><dt><span class="glossterm">
          <code class="literal">LOCALNET_1</code></span></dt><dd class="glossdef"><p>
          This is your LAN network address, if any - the entire range of <acronym class="acronym">IP</acronym> addresses used by the machines on your LAN. These may be statically assigned, or you might run a local DHCP server to assign them. In these examples, the range is 192.168.1.0/24, part of the Class C private address range.
          </p></dd><dt><span class="glossterm">
          <code class="literal">ANYWHERE</code></span></dt><dd class="glossdef"><p>
          Anywhere is a label for an address used by ipchains to match any (non-broadcast) address. Both programs provide any/0 as a label for this address, which is 0.0.0.0/0.
          </p></dd><dt><span class="glossterm">
          <code class="literal">NAMESERVER_1</code></span></dt><dd class="glossdef"><p>
          This is the <acronym class="acronym">IP</acronym> address of your Primary <acronym class="acronym">DNS</acronym> Server from your network or your <acronym class="acronym">ISP</acronym>.
          </p></dd><dt><span class="glossterm">
          <code class="literal">NAMESERVER_2</code></span></dt><dd class="glossdef"><p>
          This is the <acronym class="acronym">IP</acronym> address of your Secondary <acronym class="acronym">DNS</acronym> Server from your network or your <acronym class="acronym">ISP</acronym>.
          </p></dd><dt><span class="glossterm">
          <code class="literal">MY_ISP</code></span></dt><dd class="glossdef"><p>
          This is your <acronym class="acronym">ISP</acronym> &amp; <acronym class="acronym">NOC</acronym> address range. The value you specify here is used by the firewall to allow <acronym class="acronym">ICMP</acronym> ping request and traceroute. If you don't specify an <acronym class="acronym">IP</acronym> address 
          range, then you will not be able to ping the Internet from your internal network.
          </p></dd><dt><span class="glossterm">
          <code class="literal">LOOPBACK</code></span></dt><dd class="glossdef"><p>
          The loopback address range is <code class="literal">127.0.0.0/8</code>. The interface itself is addressed as <code class="literal">127.0.0.1</code> in <code class="filename">/etc/hosts</code>.
          </p></dd><dt><span class="glossterm">
          <code class="literal">PRIVPORTS</code></span></dt><dd class="glossdef"><p>
          The privileged ports, 0 through 1023, are usually referenced in total.
          </p></dd><dt><span class="glossterm">
          <code class="literal">UNPRIVPORTS</code></span></dt><dd class="glossdef"><p>
          The unprivileged ports, 1024 through 65535, are usually referenced in total. They are addresses dynamically assigned to the client side of a connection.
            </p></dd></dl></div><p>
          
          Please Note a firewall has a default policy and a collection of actions to take in response to specific message types. This means that if a given packet has not been selected by any other rule, then the default policy rule will be applied.
          
          </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
          People with dynamically assigned IPs from an <acronym class="acronym">ISP</acronym> may include the following two lines in their declarations for the firewall. The lines will determine the ppp0 <acronym class="acronym">IP</acronym> address, and the network of the remote ppp server.
          </p><pre class="programlisting">
          
          IPADDR=`/sbin/ifconfig | grep -A 4 ppp0 | awk '/inet/ { print $2 } ' | sed -e s/addr://`
          MY_ISP=`/sbin/ifconfig | grep -A 4 ppp0 | awk '/P-t-P/ { print $3 } ' | sed -e s/P-t-P:// | cut -d '.' -f 1-3`.0/24
          
          </pre><p>
          </p></div><p>
          You need to Enable Local Traffic since the default policies for all example firewall rule script files in this book are to deny everything, some of these rules must be unset. Local network services do not 
          go through the external network interface. They go through a special, private interface called the loopback interface. None of your local network programs will work until loopback traffic is allowed.
          </p><pre class="programlisting">
          
          # Unlimited traffic on the loopback interface.
          ipchains -A input  -i $LOOPBACK_INTERFACE -j ACCEPT
          ipchains -A output -i $LOOPBACK_INTERFACE -j ACCEPT
          
          </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6542"></a>5. Source Address Filtering</h2></div></div></div><p>
          All <acronym class="acronym">IP</acronym> packet headers contain the source and destination <acronym class="acronym">IP</acronym> addresses and the type of <acronym class="acronym">IP</acronym> protocol message; <acronym class="acronym">ICMP</acronym>, <acronym class="acronym">UDP</acronym> or <acronym class="acronym">TCP</acronym> this 
          packet contains. The only means of identification under the Internet Protocol - <acronym class="acronym">IP</acronym>) is the source address in the <acronym class="acronym">IP</acronym> packet header. This is a problem that opens the door to source address spoofing, where the 
          sender may replaces its address with either a nonexistent address, or the address of some other site.
          </p><pre class="programlisting">
          
          # Refuse spoofed packets pretending to be from the external address.
          ipchains -A input  -i $EXTERNAL_INTERFACE -s $IPADDR -l -j DENY
          
          </pre><p>
          </p><p>
          Also, there are at least seven sets of source addresses you should refuse on your external interface in all cases.
          These are incoming packets claiming to be from:
          </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
          Your external <acronym class="acronym">IP</acronym> address
          </p></li><li class="listitem"><p>
          <code class="literal">Class A</code> private <acronym class="acronym">IP</acronym> addresses
          </p></li><li class="listitem"><p>
          <code class="literal">Class B</code> private <acronym class="acronym">IP</acronym> addresses
          </p></li><li class="listitem"><p>
          <code class="literal">Class C</code> private <acronym class="acronym">IP</acronym> addresses
          </p></li><li class="listitem"><p>
          <code class="literal">Class D</code> multicast addresses
          </p></li><li class="listitem"><p>
          <code class="literal">Class E</code> reserved addresses
          </p></li><li class="listitem"><p>
          The loopback interface
          </p></li></ol></div><p>
          With the exception of your own <acronym class="acronym">IP</acronym> address, blocking outgoing packets containing these source addresses protects you from possible configuration errors on your part. 
          </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
          Don't forget to exclude your own <acronym class="acronym">IP</acronym> address from outgoing packets blocked. By default I choose to exclude the <code class="literal">Class C</code> private <acronym class="acronym">IP</acronym> addresses since it's the most used by the 
          majority of people at this time. If you used another class instead of the <code class="literal">Class C</code>, then you must comment out the lines that refer to your class under the SPOOFING &amp; BAD ADDRESSES section of the firewall.
          script file.
          </p></div><p>
          The rest of the rules used in the firewall scripts files are:
           </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Accessing a Service from the Outside World
          </p></li><li class="listitem"><p>
          Offering a Service to the Outside World
          </p></li><li class="listitem"><p>
          Masquerading the Internal Machines
          </p></li></ul></div><p>
          </p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="prt3chp4fscf"></a>Chapter 11. The firewall scripts files</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#pr3ch4fsfsc41">1. 
          Config <code class="filename">/etc/rc.d/init.d/firewall</code> script file  -Web Server</a></span></dt><dt><span class="section"><a href="#pr3ch4fsfsc42">2. Config <code class="filename">/etc/rc.d/init.d/firewall</code> script file - Mail Server</a></span></dt></dl></div><div class="highlights"><p>
          The tool <code class="literal">ipchains</code> allows you to set up firewalls, IP masquerading, etc. <code class="literal">Ipchains</code> talks to the kernel and tells it what packets to filter. Therefore all your firewall setups are stored in the kernel, and thus 
          will be lost on reboot. To avoid this, we recommend using the System <code class="literal">V</code> init scripts to make your rules permanent. To do this, create a firewall script file like shown over the next three sections in your 
          <code class="filename">/etc/rc.d/init.d/</code> directory for each servers you have. Of course, each server has different services to offer and needs a different firewall setup. For this reason, we 
          provide you three different firewall settings, which you can play with, and examine to fit your needs. Also I assume that you have a minimum knowledge on how filtering firewalls and firewall rules works.
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr3ch4fsfsc41"></a>1. 
          Config <code class="filename">/etc/rc.d/init.d/firewall</code> script file  -Web Server</h2></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Errata</h3><p>
              </p><div class="mediaobject"><img src="./images/Important.gif" alt="Important"></div><p>                   

              As i was giving the final look over on this book, Gerhard Mourani has released an errata for all firewall scripts
              and it is available here <a class="link" href="#prtinxfperrt1" title="Openna Errata">http://www.openna.com/books/errata.htm</a>
            </p></div><p>
          This is the configuration script file for our Web Server. This configuration allows unlimited traffic on the Loopback interface, <acronym class="acronym">ICMP</acronym>, <acronym class="acronym">DNS</acronym> Caching and Client Server (53), <acronym class="acronym">SSH</acronym> Server (22), <acronym class="acronym">HTTP</acronym> Server (80), 
          <acronym class="acronym">HTTPS</acronym> Server (443), <acronym class="acronym">SMTP</acronym> Client (25), <acronym class="acronym">FTP</acronym> Server (20, 21), and  OUTGOING TRACEROUTE requests by default.
          </p><p>

          If you don't want some services listed in the firewall rules files for the Web Server that I make <strong class="userinput"><code>ON</code></strong> by default, comment them out with a "#" at the beginning of the line. If you want some other services 
          that I commented out with a "#", then remove the "#" at the beginning of those  lines.
          Create the firewall script file, touch <code class="filename">/etc/rc.d/init.d/firewall</code> on your Web Server and add:
          </p><pre class="programlisting">
          #!/bin/sh
          #
          # ----------------------------------------------------------------------------
          # Last modified by Gerhard Mourani:  04-25-2000
          # ----------------------------------------------------------------------------
          # Copyright (C) 1997, 1998, 1999  Robert L. Ziegler
          #
          # Permission to use, copy, modify, and distribute this software and its
          # documentation for educational, research, private and non-profit purposes,
          # without fee, and without a written agreement is hereby granted. 
          # This software is provided as an example and basis for individual firewall
          # development.  This software is provided without warranty.
          #
          # Any material furnished by Robert L. Ziegler is furnished on an 
          # "as is" basis.  He makes no warranties of any kind, either expressed 
          # or implied as to any matter including, but not limited to, warranty 
          # of fitness for a particular purpose, exclusivity or results obtained
          # from use of the material.
          # ----------------------------------------------------------------------------
          #
          # Invoked from /etc/rc.d/init.d/firewall.
          # chkconfig: - 60 95
          # description: Starts and stops the IPCHAINS Firewall \
          #              used to provide Firewall network services.

          # Source function library.
          . /etc/rc.d/init.d/functions

          # Source networking configuration.
          . /etc/sysconfig/network

          # Check that networking is up.
          if [ ${NETWORKING} = "no" ]
          then
          exit 0
          fi

          if [ ! -x /sbin/ipchains ]; then
          exit 0
          fi

          # See how we were called.
          case "$1" in
          start)
          echo -n "Starting Firewalling Services: "

          # Some definitions for easy maintenance.

          # ----------------------------------------------------------------------------
          #  EDIT THESE TO SUIT YOUR SYSTEM AND ISP.

          EXTERNAL_INTERFACE="eth0"               	# Internet connected interface
          LOOPBACK_INTERFACE="lo"			# Your local naming convention
          IPADDR="my.ip.address"			# Your IP address
          ANYWHERE="any/0"				# Match any IP address
          NAMESERVER_1="my.name.server.1"		# Everyone must have at least one
          NAMESERVER_2="my.name.server.2"		# Your secondary name server
          MY_ISP="my.isp.address.range/24"       	# ISP &amp; NOC address range

          SMTP_SERVER="my.smtp.server" 			# Your Mail Hub Server.
          SYSLOG_SERVER="syslog.internal.server"  	# Your syslog internal server
          SYSLOG_CLIENT="sys.int.client.range/24" 	# Your syslog internal client range

          LOOPBACK="127.0.0.0/8"			# Reserved loopback address range
          CLASS_A="10.0.0.0/8"				# Class A private networks
          CLASS_B="172.16.0.0/12"			# Class B private networks
          CLASS_C="192.168.0.0/16"			# Class C private networks
          CLASS_D_MULTICAST="224.0.0.0/4"		# Class D multicast addresses
          CLASS_E_RESERVED_NET="240.0.0.0/5"	        # Class E reserved addresses
          BROADCAST_SRC="0.0.0.0"			# Broadcast source address
          BROADCAST_DEST="255.255.255.255"		# Broadcast destination address
          PRIVPORTS="0:1023"				# Well known, privileged port range
          UNPRIVPORTS="1024:65535"			# Unprivileged port range

          # ----------------------------------------------------------------------------

          # SSH starts at 1023 and works down to 513 for
          # each additional simultaneous incoming connection.
          SSH_PORTS="1022:1023"                   		# range for SSH privileged ports

          # traceroute usually uses -S 32769:65535 -D 33434:33523
          TRACEROUTE_SRC_PORTS="32769:65535"
          TRACEROUTE_DEST_PORTS="33434:33523"

          # ----------------------------------------------------------------------------
          # Default policy is DENY
          # Explicitly accept desired INCOMING &amp; OUTGOING connections

          # Remove all existing rules belonging to this filter
          ipchains -F

          # Clearing all current rules and user defined chains
          ipchains -X

          # Set the default policy of the filter to deny.
          # Don't even bother sending an error message back.
          ipchains -P input   DENY
          ipchains -P output  DENY
          ipchains -P forward DENY

          # ----------------------------------------------------------------------------
          # LOOPBACK

          # Unlimited traffic on the loopback interface.
          ipchains -A input  -i $LOOPBACK_INTERFACE -j ACCEPT 
          ipchains -A output -i $LOOPBACK_INTERFACE -j ACCEPT 

          # ----------------------------------------------------------------------------
          # Network Ghouls
          # Deny access to jerks

          # /etc/rc.d/rc.firewall.blocked contains a list of
          # ipchains -A input  -i $EXTERNAL_INTERFACE -s address -j DENY
          # rules to block from any access.

          # Refuse any connection from problem sites
          #if [ -f /etc/rc.d/rc.firewall.blocked ]; then
          #    . /etc/rc.d/rc.firewall.blocked
          #fi

          # ----------------------------------------------------------------------------
          # SPOOFING &amp; BAD ADDRESSES
          # Refuse spoofed packets.
          # Ignore blatantly illegal source addresses.
          # Protect yourself from sending to bad addresses.

          # Refuse spoofed packets pretending to be from the external address.
          ipchains -A input  -i $EXTERNAL_INTERFACE -s $IPADDR -j DENY -l

          # Refuse packets claiming to be to or from a Class A private network
          ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_A -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -d $CLASS_A -j DENY -l
          ipchains -A output -i $EXTERNAL_INTERFACE -s $CLASS_A -j REJECT -l
          ipchains -A output -i $EXTERNAL_INTERFACE -d $CLASS_A -j REJECT -l

          # Refuse packets claiming to be to or from a Class B private network
          ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_B -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -d $CLASS_B -j DENY -l
          ipchains -A output -i $EXTERNAL_INTERFACE -s $CLASS_B -j REJECT -l
          ipchains -A output -i $EXTERNAL_INTERFACE -d $CLASS_B -j REJECT -l

          # Refuse packets claiming to be to or from a Class C private network
          #    ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_C -j DENY -l
          #    ipchains -A input  -i $EXTERNAL_INTERFACE -d $CLASS_C -j DENY -l
          #    ipchains -A output -i $EXTERNAL_INTERFACE -s $CLASS_C -j REJECT -l
          #    ipchains -A output -i $EXTERNAL_INTERFACE -d $CLASS_C -j REJECT -l

          # Refuse packets claiming to be from the loopback interface
          ipchains -A input  -i $EXTERNAL_INTERFACE -s $LOOPBACK -j DENY -l
          ipchains -A output -i $EXTERNAL_INTERFACE -s $LOOPBACK -j REJECT -l

          # Refuse broadcast address SOURCE packets
          ipchains -A input  -i $EXTERNAL_INTERFACE -s $BROADCAST_DEST -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -d $BROADCAST_SRC -j DENY -l

          # Refuse Class D multicast addresses (in.h) (NET-3-HOWTO)
          # Multicast is illegal as a source address.
          # Multicast uses UDP.
          ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_D_MULTICAST -j DENY -l

          # Refuse Class E reserved IP  addresses
          ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_E_RESERVED_NET -j DENY -l

          # refuse addresses defined as reserved by the IANA
          # 0.*.*.*, 1.*.*.*, 2.*.*.*, 5.*.*.*, 7.*.*.*, 23.*.*.*, 27.*.*.*
          # 31.*.*.*, 37.*.*.*, 39.*.*.*, 41.*.*.*, 42.*.*.*, 58-60.*.*.*
          # 65-95.*.*.*, 96-126.*.*.*, 197.*.*.*, 201.*.*.* (?), 217-223.*.*.*
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 1.0.0.0/8  -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 2.0.0.0/8  -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 5.0.0.0/8  -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 7.0.0.0/8  -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 23.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 27.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 31.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 37.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 39.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 41.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 42.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 58.0.0.0/7 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 60.0.0.0/8 -j DENY -l

          #65: 01000001    - /3 includes 64 - need 65-79 spelled out
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 65.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 66.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 67.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 68.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 69.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 70.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 71.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 72.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 73.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 74.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 75.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 76.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 77.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 78.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 79.0.0.0/8 -j DENY -l

          #80: 01010000   - /4 masks 80-95
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 80.0.0.0/4 -j DENY -l

          # 96: 01100000    - /4 makses 96-111
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 96.0.0.0/4 -j DENY -l

          #126: 01111110    - /3 includes 127 - need 112-126 spelled out
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 112.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 113.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 114.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 115.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 116.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 117.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 118.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 119.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 120.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 121.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 122.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 123.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 124.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 125.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 126.0.0.0/8 -j DENY -l

          #217: 11011001    - /5 includes 216 - need 217-219 spelled out
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 217.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 218.0.0.0/8 -j DENY -l
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 219.0.0.0/8 -j DENY -l

          #223: 11011111    - /6 masks 220-223
          ipchains -A input  -i $EXTERNAL_INTERFACE -s 220.0.0.0/6 -j DENY -l

          # ----------------------------------------------------------------------------
          # ICMP

          #    To prevent denial of service attacks based on ICMP bombs, filter
          #    incoming Redirect (5) and outgoing Destination Unreachable (3).
          #    Note, however, disabling Destination Unreachable (3) is not
          #    advisable, as it is used to negotiate packet fragment size.

          # For bi-directional ping.
          #     Message Types:  Echo_Reply (0),  Echo_Request (8)
          #     To prevent attacks, limit the src addresses to your ISP range.
          # 
          # For outgoing traceroute.
          #     Message Types:  INCOMING Dest_Unreachable (3), Time_Exceeded (11)
          #     default UDP base: 33434 to base+nhops-1
          # 
          # For incoming traceroute.
          #     Message Types:  OUTGOING Dest_Unreachable (3), Time_Exceeded (11)
          #     To block this, deny OUTGOING 3 and 11

          #  0: echo-reply (pong)
          #  3: destination-unreachable, port-unreachable, fragmentation-needed, etc.
          #  4: source-quench
          #  5: redirect
          #  8: echo-request (ping)
          # 11: time-exceeded
          # 12: parameter-problem

          ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
          -s $ANYWHERE 0 -d $IPADDR -j ACCEPT 
          ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
          -s $ANYWHERE 3 -d $IPADDR -j ACCEPT 
          ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
          -s $ANYWHERE 4 -d $IPADDR -j ACCEPT 
          ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
          -s $ANYWHERE 11 -d $IPADDR -j ACCEPT 
          ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
          -s $ANYWHERE 12 -d $IPADDR -j ACCEPT 
          ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
          -s $MY_ISP 8 -d $IPADDR -j ACCEPT 

          ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
          -s $IPADDR 0 -d $MY_ISP -j ACCEPT 
          ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
          -s $IPADDR 3 -d $MY_ISP -j ACCEPT 
          ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
          -s $IPADDR 4 -d $ANYWHERE -j ACCEPT 
          ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
          -s $IPADDR 8 -d $ANYWHERE -j ACCEPT 
          ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
          -s $IPADDR 12 -d $ANYWHERE -j ACCEPT 
          ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
          -s $IPADDR 11 -d $MY_ISP -j ACCEPT 

          # ----------------------------------------------------------------------------
          # UDP INCOMING TRACEROUTE
          # traceroute usually uses -S 32769:65535 -D 33434:33523

          ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
          -s $MY_ISP $TRACEROUTE_SRC_PORTS \
          -d $IPADDR $TRACEROUTE_DEST_PORTS -j ACCEPT -l

          ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
          -s $ANYWHERE $TRACEROUTE_SRC_PORTS \
          -d $IPADDR $TRACEROUTE_DEST_PORTS -j DENY -l

          # ----------------------------------------------------------------------------
          # DNS forwarding, caching only nameserver (53)
          # --------------------------------------------

          # server to server query or response
          # Caching only name server only requires UDP, not TCP

          ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
          -s $NAMESERVER_1 53 \
          -d $IPADDR 53 -j ACCEPT 

          ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
          -s $IPADDR 53 \
          -d $NAMESERVER_1 53 -j ACCEPT 

          ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
          -s $NAMESERVER_2 53 \
          -d $IPADDR 53 -j ACCEPT 

          ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
          -s $IPADDR 53 \
          -d $NAMESERVER_2 53 -j ACCEPT 

          # DNS client (53)
          # ---------------
          ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
          -s $NAMESERVER_1 53 \
          -d $IPADDR $UNPRIVPORTS -j ACCEPT 

          ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
          -s $IPADDR $UNPRIVPORTS \
          -d $NAMESERVER_1 53 -j ACCEPT 

          ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
          -s $NAMESERVER_2 53 \
          -d $IPADDR $UNPRIVPORTS -j ACCEPT

          ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
          -s $IPADDR $UNPRIVPORTS \
          -d $NAMESERVER_2 53 -j ACCEPT

          # TCP client to server requests are allowed by the protocol 
          # if UDP requests fail. This is rarely seen. Usually, clients
          # use TCP as a secondary nameserver for zone transfers from
          # their primary nameservers, and as hackers.

          ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
          -s $NAMESERVER_1 53 \
          -d $IPADDR $UNPRIVPORTS -j ACCEPT 

          ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
          -s $IPADDR $UNPRIVPORTS \
          -d $NAMESERVER_1 53 -j ACCEPT 

          ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
          -s $NAMESERVER_2 53 \
          -d $IPADDR $UNPRIVPORTS -j ACCEPT 

          ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
          -s $IPADDR $UNPRIVPORTS \
          -d $NAMESERVER_2 53 -j ACCEPT 

          # ----------------------------------------------------------------------------
          # TCP accept only on selected ports
          # ---------------------------------
          # ------------------------------------------------------------------

          # SSH server (22)
          # ---------------

          ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
          -s $ANYWHERE $UNPRIVPORTS \
          -d $IPADDR 22 -j ACCEPT 

          ipchains -A output -i $EXTERNAL_INTERFACE -p tcp ! -y \
          -s $IPADDR 22 \
          -d $ANYWHERE $UNPRIVPORTS -j ACCEPT 

          ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
          -s $ANYWHERE $SSH_PORTS \
          -d $IPADDR 22 -j ACCEPT 

          ipchains -A output -i $EXTERNAL_INTERFACE -p tcp ! -y \
          -s $IPADDR 22 \
          -d $ANYWHERE $SSH_PORTS -j ACCEPT 


          # ------------------------------------------------------------------

          # HTTP server (80)
          # ----------------

          ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
          -s $ANYWHERE $UNPRIVPORTS \
          -d $IPADDR 80 -j ACCEPT 

          ipchains -A output -i $EXTERNAL_INTERFACE -p tcp ! -y \
          -s $IPADDR 80 \
          -d $ANYWHERE $UNPRIVPORTS -j ACCEPT 

          # ------------------------------------------------------------------

          # HTTPS server (443)
          # ------------------

          ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
          -s $ANYWHERE $UNPRIVPORTS \
          -d $IPADDR 443 -j ACCEPT 

          ipchains -A output -i $EXTERNAL_INTERFACE -p tcp ! -y \
          -s $IPADDR 443 \
          -d $ANYWHERE $UNPRIVPORTS -j ACCEPT 

          # ------------------------------------------------------------------

          # SYSLOG server (514)
          # -----------------

          # Provides full remote logging. Using  this feature you're able to
          # control all syslog messages on one host.

          #    ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
          #             -s $SYSLOG_CLIENT \
          #             -d $IPADDR 514 -j ACCEPT

          # SYSLOG client (514)
          # -----------------

          #    ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
          #             -s $IPADDR 514 \
          #             -d $SYSLOG_SERVER 514 -j ACCEPT

          # ------------------------------------------------------------------

          # AUTH server (113)
          # -----------------

          # Reject, rather than deny, the incoming auth port. (NET-3-HOWTO)

          ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
          -s $ANYWHERE \
          -d $IPADDR 113 -j REJECT 

          # ------------------------------------------------------------------

          # SMTP client (25)
          # ----------------
          ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
          -s $SMTP_SERVER 25 \
          -d $IPADDR $UNPRIVPORTS -j ACCEPT 

          ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
          -s $IPADDR $UNPRIVPORTS \
          -d $SMTP_SERVER 25 -j ACCEPT 

          # ------------------------------------------------------------------

          # FTP server (20, 21)
          # -------------------

          # incoming request

          ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
          -s $ANYWHERE $UNPRIVPORTS \
          -d $IPADDR 21 -j ACCEPT 

          ipchains -A output -i $EXTERNAL_INTERFACE -p tcp ! -y \
          -s $IPADDR 21 \
          -d $ANYWHERE $UNPRIVPORTS -j ACCEPT 

          # PORT MODE data channel responses
          # 
          ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
          -s $ANYWHERE $UNPRIVPORTS \
          -d $IPADDR 20 -j ACCEPT 

          ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
          -s $IPADDR 20 \
          -d $ANYWHERE $UNPRIVPORTS -j ACCEPT 

          # PASSIVE MODE data channel responses

          ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
          -s $ANYWHERE $UNPRIVPORTS \
          -d $IPADDR $UNPRIVPORTS -j ACCEPT 

          ipchains -A output -i $EXTERNAL_INTERFACE -p tcp ! -y \
          -s $IPADDR $UNPRIVPORTS \
          -d $ANYWHERE $UNPRIVPORTS -j ACCEPT 

          # ------------------------------------------------------------------
          # OUTGOING TRACEROUTE
          # -------------------
          ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
          -s $IPADDR $TRACEROUTE_SRC_PORTS \
          -d $ANYWHERE $TRACEROUTE_DEST_PORTS -j ACCEPT 

          # ----------------------------------------------------------------------------
          # Enable logging for selected denied packets

          ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
          -d $IPADDR -j DENY -l

          ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
          -d $IPADDR $PRIVPORTS -j DENY -l

          ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
          -d $IPADDR $UNPRIVPORTS -j DENY -l

          ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
          -s $ANYWHERE 5 -d $IPADDR -j DENY -l

          ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
          -s $ANYWHERE 13:255 -d $IPADDR -j DENY -l

          # ----------------------------------------------------------------------------

          ;;
          stop)
          echo -n "Shutting Firewalling Services: "

          # Remove all existing rules belonging to this filter
          ipchains -F

          # Delete all user-defined chain to this filter
          ipchains -X

          # Reset the default policy of the filter to accept.
          ipchains -P input  ACCEPT
          ipchains -P output ACCEPT
          ipchains -P forward ACCEPT

          ;;
          status)
          status firewall
          ;;
          restart|reload)
          $0 stop
          $0 start
          ;;
          *)
          echo "Usage: firewall {start|stop|status|restart|reload}"
          exit 1
          esac

          exit 0
            
          </pre><p>
          Now, make this script executable and change its default permissions:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>chmod</strong></span> 700 /etc/rc.d/init.d/firewall
          [root@deep] /# <span class="command"><strong>chown</strong></span> 0.0 /etc/rc.d/init.d/firewall
          </pre><p>
          </p><p>
          Create the symbolic rc.d links for your Firewall with the following command:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>chkconfig</strong></span> --add firewall
          [root@deep] /# <span class="command"><strong>chkconfig</strong></span> --level 345 firewall on
          </pre><p>
          </p><p>
          Now, your firewall rules are configured to use System V init (System V init is in charge of starting all the normal processes that need to run at boot time) and it will be automatically started each time your server reboots.

          To manually stop the firewall on your system, use the following command:
          </p><pre class="screen">
          [root@deep] /# /etc/rc.d/init.d/firewall <span class="command"><strong>stop</strong></span>
          </pre><p>
                    </p><pre class="literallayout"><code class="computeroutput">
          Shutting Firewalling Services:			[  OK  ]
          </code></pre><p>
          </p><p>
          To manually start the firewall on your system, use the following command:
          </p><pre class="screen">
          [root@deep] /# /etc/rc.d/init.d/firewall <span class="command"><strong>start</strong></span>
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
          Starting Firewalling Services:			[  OK  ]
          </code></pre><p>
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr3ch4fsfsc42"></a>2. Config <code class="filename">/etc/rc.d/init.d/firewall</code> script file - Mail Server</h2></div></div></div><p>
          This is the configuration script file for our Mail Server. This is configured to allows unlimited traffic on the Loopback interface, <acronym class="acronym">ICMP</acronym>, <acronym class="acronym">DNS</acronym> Server and Client (53), <acronym class="acronym">SSH</acronym> Server (22), SMTP Server and Client (25), <acronym class="acronym">IMAP</acronym> 
          server (143), and OUTGOING TRACEROUTE requests by default.
          If you don't want some services listed in the firewall rules files for the Mail Server that I make <strong class="userinput"><code>ON</code></strong> by default, comment them out with a "#" at the beginning of the line. If you want some other 
          services that I commented out with a "#", then remove the "#" at the beginning of their lines.
          Create the firewall script file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/rc.d/init.d/firewall</code> on your Mail Server and add:
          </p><pre class="programlisting">
            

            #!/bin/sh
            #
            # ----------------------------------------------------------------------------
            # Last modified by Gerhard Mourani:  04-25-2000
            # ----------------------------------------------------------------------------
            # Copyright (C) 1997, 1998, 1999  Robert L. Ziegler
            #
            # Permission to use, copy, modify, and distribute this software and its
            # documentation for educational, research, private and non-profit purposes,
            # without fee, and without a written agreement is hereby granted. 
            # This software is provided as an example and basis for individual firewall
            # development.  This software is provided without warranty.
            #
            # Any material furnished by Robert L. Ziegler is furnished on an 
            # "as is" basis.  He makes no warranties of any kind, either expressed 
            # or implied as to any matter including, but not limited to, warranty 
            # of fitness for a particular purpose, exclusivity or results obtained
            # from use of the material.
            # ----------------------------------------------------------------------------
            #
            # Invoked from /etc/rc.d/init.d/firewall.
            # chkconfig: - 60 95
            # description: Starts and stops the IPCHAINS Firewall \
            #              used to provide Firewall network services.

            # Source function library.
            . /etc/rc.d/init.d/functions

            # Source networking configuration.
            . /etc/sysconfig/network

            # Check that networking is up.
            if [ ${NETWORKING} = "no" ]
            then
            exit 0
            fi

            if [ ! -x /sbin/ipchains ]; then
            exit 0
            fi

            # See how we were called.
            case "$1" in
            start)
            echo -n "Starting Firewalling Services: "

            # Some definitions for easy maintenance.

            # ----------------------------------------------------------------------------
            #  EDIT THESE TO SUIT YOUR SYSTEM AND ISP.

            EXTERNAL_INTERFACE="eth0"               		# Internet connected interface
            LOOPBACK_INTERFACE="lo"                 		# Your local naming convention
            IPADDR="my.ip.address"                  		# Your IP address
            ANYWHERE="any/0"                        		# Match any IP address
            NAMESERVER_1="my.name.server.1"         	        # Everyone must have at least one
            NAMESERVER_2="my.name.server.2"         	        # Your secondary name server
            MY_ISP="my.isp.address.range/24"        		# ISP &amp; NOC address range

            SMTP_SERVER="my.smtp.server"            		# Your Mail Hub Server.
            SYSLOG_SERVER="syslog.internal.server"  	        # Your syslog internal server
            SYSLOG_CLIENT="sys.int.client.range/24" 	        # Your syslog internal client range
                                                                
            LOOPBACK="127.0.0.0/8"                  		# Reserved loopback address range
            CLASS_A="10.0.0.0/8"                    		# Class A private networks
            CLASS_B="172.16.0.0/12"                 		# Class B private networks
            CLASS_C="192.168.0.0/16"                		# Class C private networks
            CLASS_D_MULTICAST="224.0.0.0/4"         	        # Class D multicast addresses
            CLASS_E_RESERVED_NET="240.0.0.0/5"  	        # Class E reserved addresses
            BROADCAST_SRC="0.0.0.0"                 		# Broadcast source address
            BROADCAST_DEST="255.255.255.255"       	        # Broadcast destination address
            PRIVPORTS="0:1023"                      		# Well known, privileged port range
            UNPRIVPORTS="1024:65535"                		# Unprivileged port range

            # ----------------------------------------------------------------------------

            # SSH starts at 1023 and works down to 513 for
            # each additional simultaneous incoming connection.
            SSH_PORTS="1022:1023"          			# range for SSH privileged ports

            # traceroute usually uses -S 32769:65535 -D 33434:33523
            TRACEROUTE_SRC_PORTS="32769:65535"
            TRACEROUTE_DEST_PORTS="33434:33523"

            # ----------------------------------------------------------------------------
            # Default policy is DENY
            # Explicitly accept desired INCOMING &amp; OUTGOING connections

            # Remove all existing rules belonging to this filter
            ipchains -F

            # Clearing all current rules and user defined chains
            ipchains -X

            # Set the default policy of the filter to deny.
            # Don't even bother sending an error message back.
            ipchains -P input  DENY
            ipchains -P output DENY
            ipchains -P forward DENY

            # ----------------------------------------------------------------------------
            # LOOPBACK

            # Unlimited traffic on the loopback interface.
            ipchains -A input  -i $LOOPBACK_INTERFACE -j ACCEPT 
            ipchains -A output -i $LOOPBACK_INTERFACE -j ACCEPT 

            # ----------------------------------------------------------------------------
            # Network Ghouls
            # Deny access to jerks

            # /etc/rc.d/rc.firewall.blocked contains a list of
            # ipchains -A input  -i $EXTERNAL_INTERFACE -s address -j DENY
            # rules to block from any access.

            # Refuse any connection from problem sites
            #if [ -f /etc/rc.d/rc.firewall.blocked ]; then
            #    . /etc/rc.d/rc.firewall.blocked
            #fi

            # ----------------------------------------------------------------------------
            # SPOOFING &amp; BAD ADDRESSES
            # Refuse spoofed packets.
            # Ignore blatantly illegal source addresses.
            # Protect yourself from sending to bad addresses.

            # Refuse spoofed packets pretending to be from the external address.
            ipchains -A input  -i $EXTERNAL_INTERFACE -s $IPADDR -j DENY -l

            # Refuse packets claiming to be to or from a Class A private network
            ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_A -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -d $CLASS_A -j DENY -l
            ipchains -A output -i $EXTERNAL_INTERFACE -s $CLASS_A -j REJECT -l
            ipchains -A output -i $EXTERNAL_INTERFACE -d $CLASS_A -j REJECT -l

            # Refuse packets claiming to be to or from a Class B private network
            ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_B -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -d $CLASS_B -j DENY -l
            ipchains -A output -i $EXTERNAL_INTERFACE -s $CLASS_B -j REJECT -l
            ipchains -A output -i $EXTERNAL_INTERFACE -d $CLASS_B -j REJECT -l

            # Refuse packets claiming to be to or from a Class C private network
            #    ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_C -j DENY -l
            #    ipchains -A input  -i $EXTERNAL_INTERFACE -d $CLASS_C -j DENY -l
            #    ipchains -A output -i $EXTERNAL_INTERFACE -s $CLASS_C -j REJECT -l
            #    ipchains -A output -i $EXTERNAL_INTERFACE -d $CLASS_C -j REJECT -l

            # Refuse packets claiming to be from the loopback interface
            ipchains -A input  -i $EXTERNAL_INTERFACE -s $LOOPBACK -j DENY -l
            ipchains -A output -i $EXTERNAL_INTERFACE -s $LOOPBACK -j REJECT -l

            # Refuse broadcast address SOURCE packets
            ipchains -A input  -i $EXTERNAL_INTERFACE -s $BROADCAST_DEST -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -d $BROADCAST_SRC -j DENY -l

            # Refuse Class D multicast addresses (in.h) (NET-3-HOWTO)
            # Multicast is illegal as a source address.
            # Multicast uses UDP.
            ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_D_MULTICAST -j DENY -l

            # Refuse Class E reserved IP  addresses
            ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_E_RESERVED_NET -j DENY -l

            # refuse addresses defined as reserved by the IANA
            # 0.*.*.*, 1.*.*.*, 2.*.*.*, 5.*.*.*, 7.*.*.*, 23.*.*.*, 27.*.*.*
            # 31.*.*.*, 37.*.*.*, 39.*.*.*, 41.*.*.*, 42.*.*.*, 58-60.*.*.*
            # 65-95.*.*.*, 96-126.*.*.*, 197.*.*.*, 201.*.*.* (?), 217-223.*.*.*
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 1.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 2.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 5.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 7.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 23.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 27.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 31.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 37.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 39.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 41.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 42.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 58.0.0.0/7 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 60.0.0.0/8 -j DENY -l

            #65: 01000001    - /3 includes 64 - need 65-79 spelled out
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 65.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 66.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 67.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 68.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 69.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 70.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 71.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 72.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 73.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 74.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 75.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 76.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 77.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 78.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 79.0.0.0/8 -j DENY -l

            #80: 01010000   - /4 masks 80-95
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 80.0.0.0/4 -j DENY -l

            # 96: 01100000    - /4 makses 96-111
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 96.0.0.0/4 -j DENY -l

            #126: 01111110    - /3 includes 127 - need 112-126 spelled out
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 112.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 113.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 114.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 115.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 116.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 117.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 118.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 119.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 120.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 121.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 122.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 123.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 124.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 125.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 126.0.0.0/8 -j DENY -l

            #217: 11011001    - /5 includes 216 - need 217-219 spelled out
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 217.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 218.0.0.0/8 -j DENY -l
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 219.0.0.0/8 -j DENY -l

            #223: 11011111    - /6 masks 220-223
            ipchains -A input  -i $EXTERNAL_INTERFACE -s 220.0.0.0/6 -j DENY -l

            # ----------------------------------------------------------------------------
            # ICMP

            #    To prevent denial of service attacks based on ICMP bombs, filter
            #    incoming Redirect (5) and outgoing Destination Unreachable (3).
            #    Note, however, disabling Destination Unreachable (3) is not
            #    advisable, as it is used to negotiate packet fragment size.

            # For bi-directional ping.
            #     Message Types:  Echo_Reply (0),  Echo_Request (8)
            #     To prevent attacks, limit the src addresses to your ISP range.
            # 
            # For outgoing traceroute.
            #     Message Types:  INCOMING Dest_Unreachable (3), Time_Exceeded (11)
            #     default UDP base: 33434 to base+nhops-1
            # 
            # For incoming traceroute.
            #     Message Types:  OUTGOING Dest_Unreachable (3), Time_Exceeded (11)
            #     To block this, deny OUTGOING 3 and 11

            #  0: echo-reply (pong)
            #  3: destination-unreachable, port-unreachable, fragmentation-needed, etc.
            #  4: source-quench
            #  5: redirect
            #  8: echo-request (ping)
            # 11: time-exceeded
            # 12: parameter-problem

            ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
            -s $ANYWHERE 0 -d $IPADDR -j ACCEPT
            ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
            -s $ANYWHERE 3 -d $IPADDR -j ACCEPT
            ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
            -s $ANYWHERE 4 -d $IPADDR -j ACCEPT
            ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
            -s $ANYWHERE 11 -d $IPADDR -j ACCEPT
            ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
            -s $ANYWHERE 12 -d $IPADDR -j ACCEPT
            ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
            -s $MY_ISP 8 -d $IPADDR -j ACCEPT

            ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
            -s $IPADDR 0 -d $MY_ISP -j ACCEPT
            ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
            -s $IPADDR 3 -d $MY_ISP -j ACCEPT
            ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
            -s $IPADDR 4 -d $ANYWHERE -j ACCEPT
            ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
            -s $IPADDR 8 -d $ANYWHERE -j ACCEPT
            ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
            -s $IPADDR 12 -d $ANYWHERE -j ACCEPT
            ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
            -s $IPADDR 11 -d $MY_ISP -j ACCEPT

            # ----------------------------------------------------------------------------
            # UDP INCOMING TRACEROUTE
            # traceroute usually uses -S 32769:65535 -D 33434:33523

            ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
            -s $MY_ISP $TRACEROUTE_SRC_PORTS \
            -d $IPADDR $TRACEROUTE_DEST_PORTS -j ACCEPT -l

            ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
            -s $ANYWHERE $TRACEROUTE_SRC_PORTS \
            -d $IPADDR $TRACEROUTE_DEST_PORTS -j DENY -l

            # ----------------------------------------------------------------------------
            # DNS server
            # ----------

            # DNS: full server
            # server/client to server query or response

            ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
            -s $ANYWHERE $UNPRIVPORTS \
            -d $IPADDR 53 -j ACCEPT 

            ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
            -s $IPADDR 53 \
            -d $ANYWHERE $UNPRIVPORTS -j ACCEPT

            # DNS client &amp; Zone Transfers (53)
            # ---------------
            ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
            -s $NAMESERVER_1 53 \
            -d $IPADDR $UNPRIVPORTS -j ACCEPT 

            ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
            -s $IPADDR $UNPRIVPORTS \
            -d $NAMESERVER_1 53 -j ACCEPT 

            ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
            -s $NAMESERVER_1 53 \
            -d $IPADDR $UNPRIVPORTS -j ACCEPT 

            ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
            -s $IPADDR $UNPRIVPORTS \
            -d $NAMESERVER_1 53 -j ACCEPT 

            # ----------------------------------------------------------------------------
            # TCP accept only on selected ports
            # ---------------------------------
            # ------------------------------------------------------------------

            # SSH server (22)
            # ---------------

            ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
            -s $ANYWHERE $UNPRIVPORTS \
            -d $IPADDR 22 -j ACCEPT 

            ipchains -A output -i $EXTERNAL_INTERFACE -p tcp ! -y \
            -s $IPADDR 22 \
            -d $ANYWHERE $UNPRIVPORTS -j ACCEPT 

            ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
            -s $ANYWHERE $SSH_PORTS \
            -d $IPADDR 22 -j ACCEPT 

            ipchains -A output -i $EXTERNAL_INTERFACE -p tcp ! -y \
            -s $IPADDR 22 \
            -d $ANYWHERE $SSH_PORTS -j ACCEPT 

            # ------------------------------------------------------------------

            # AUTH server (113)
            # -----------------

            # Reject, rather than deny, the incoming auth port. (NET-3-HOWTO)

            ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
            -s $ANYWHERE \
            -d $IPADDR 113 -j REJECT 

            # ------------------------------------------------------------------

            # SYSLOG server (514)
            # -----------------

            # Provides full remote logging. Using  this feature you're able to
            # control all syslog messages on one host.

            #    ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
            #             -s $SYSLOG_CLIENT \
            #             -d $IPADDR 514 -j ACCEPT

            # SYSLOG client (514)
            # -----------------

            #    ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
            #             -s $IPADDR 514 \
            #             -d $SYSLOG_SERVER 514 -j ACCEPT

            # ------------------------------------------------------------------

            # SMTP server (25)
            # ----------------

            ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
            -s $ANYWHERE $UNPRIVPORTS \
            -d $IPADDR 25 -j ACCEPT 

            ipchains -A output -i $EXTERNAL_INTERFACE -p tcp ! -y \
            -s $IPADDR 25 \
            -d $ANYWHERE $UNPRIVPORTS -j ACCEPT 

            # SMTP client (25)
            # ----------------
            ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
            -s $ANYWHERE 25 \
            -d $IPADDR $UNPRIVPORTS -j ACCEPT

            ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
            -s $IPADDR $UNPRIVPORTS \
            -d $ANYWHERE 25 -j ACCEPT

            # ------------------------------------------------------------------

            # IMAP server (143)
            # -----------------

            ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
            -s $ANYWHERE $UNPRIVPORTS \
            -d $IPADDR 143 -j ACCEPT 

            ipchains -A output -i $EXTERNAL_INTERFACE -p tcp ! -y \
            -s $IPADDR 143 \
            -d $ANYWHERE $UNPRIVPORTS -j ACCEPT 

            # POP server (110)
            # -----------------
            #    ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
            #             -s $ANYWHERE $UNPRIVPORTS \
            #             -d $IPADDR 110 -j ACCEPT

            #    ipchains -A output -i $EXTERNAL_INTERFACE -p tcp ! -y \
            #             -s $IPADDR 110 \
            #             -d $ANYWHERE $UNPRIVPORTS -j ACCEPT

            # ------------------------------------------------------------------

            # OUTGOING TRACEROUTE
            # -------------------
            ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
            -s $IPADDR $TRACEROUTE_SRC_PORTS \
            -d $ANYWHERE $TRACEROUTE_DEST_PORTS -j ACCEPT 

            # ----------------------------------------------------------------------------
            # Enable logging for selected denied packets

            ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
            -d $IPADDR -j DENY -l

            ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
            -d $IPADDR $PRIVPORTS -j DENY -l

            ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
            -d $IPADDR $UNPRIVPORTS -j DENY -l

            ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
            -s $ANYWHERE 5 -d $IPADDR -j DENY -l

            ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
            -s $ANYWHERE 13:255 -d $IPADDR -j DENY -l

            # ----------------------------------------------------------------------------

            ;;
            stop)
            echo -n "Shutting Firewalling Services: "

            # Remove all existing rules belonging to this filter
            ipchains -F

            # Delete all user-defined chain to this filter
            ipchains -X

            # Reset the default policy of the filter to accept.
            ipchains -P input  ACCEPT
            ipchains -P output ACCEPT
            ipchains -P forward ACCEPT

            ;;
            status)
            status firewall
            ;;
            restart|reload)
            $0 stop
            $0 start
            ;;
            *)
            echo "Usage: firewall {start|stop|status|restart|reload}"
            exit 1
            esac

            exit 0         
          
          </pre><p>
          Now, make this script executable and change its default permissions:
          </p><pre class="screen">
          [root@deep] /#<span class="command"><strong>chmod</strong></span> 700 /etc/rc.d/init.d/firewall
          [root@deep] /#<span class="command"><strong>chown</strong></span> 0.0 /etc/rc.d/init.d/firewall
          </pre><p>
          </p><p>
          Create the symbolic rc.d links for your Firewall with the command:
          </p><pre class="screen">
          [root@deep] /#<span class="command"><strong>chkconfig</strong></span> --add firewall
          [root@deep] /#<span class="command"><strong>chkconfig</strong></span> --level 345 firewall on
          </pre><p>
          Now, your firewall rules are configured to use System <code class="literal">V</code> init (System V init is in charge of starting all the normal processes that need to run at boot time) and it will be automatically started each time if your server reboot.
          </p><p>
          To manually stop the firewall on your system, use the following command:
          </p><pre class="screen">
          [root@deep] /# /etc/rc.d/init.d/firewall <span class="command"><strong>stop</strong></span>
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
          Shutting Firewalling Services:			[  OK  ]
          </code>
          </pre><p>
          
          </p><p>
          To manually start the firewall on your system, use the following command:
          </p><pre class="screen">
          [root@deep] /# /etc/rc.d/init.d/firewall <span class="command"><strong>start</strong></span>
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
          Starting Firewalling Services:			[  OK  ]
          </code>
          </pre><p>
          
          </p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="pr4ch12nfmf"></a>Chapter 12. Networking Firewall -Masquerading and Forwarding</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm6691">1. Build a kernel with Firewall Masquerading and Forwarding support</a></span></dt><dt><span class="section"><a href="#idm6810">2. Config <code class="filename">/etc/rc.d/init.d/firewall</code> script file -Gateway Server</a></span></dt><dt><span class="section"><a href="#idm6824">3. Configure script for Example Gateway Server</a></span></dt><dt><span class="section"><a href="#idm6886">4. Deny access to some address</a></span></dt><dt><span class="section"><a href="#idm6923">5. <code class="literal">IPCHAINS</code> Administrative Tools</a></span></dt></dl></div><div class="highlights"><p>
         Unlike the example configurations in <a class="link" href="#prt3chp4fscf" title="Chapter 11. The firewall scripts files">The firewall scripts files</a>, configuring a Linux Server to masquerade and forward traffic generally from the inside private network that has unregistered <acronym class="acronym">IP</acronym> addresses 
         <abbr class="abbrev">i.e.</abbr> <code class="literal">192.168.1.0/24</code> to the outside network <abbr class="abbrev">i.e.</abbr> the Internet require a special setup of your kernel and of your firewall configuration scripts file. This kind 
         of setting is also known as a Gateway Server, <span class="emphasis"><em>a machine that serves as a gateway for internal traffic to external traffic</em></span>. This configuration must only be set if you have the intentions and the needs for this 
         kind of service and it's for this reason that the configuration of the script file for the Gateway Server is in its own chapter.        
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6691"></a>1. Build a kernel with Firewall Masquerading and Forwarding support</h2></div></div></div><p>
         Once again, the first thing you need to do is ensuring that your kernel has been built with Network Firewall support enabled and Firewalling. In the 2.2.14 kernel version you need to ensure that you have answered <strong class="userinput"><code>Y</code></strong> to the following questions:
         </p><pre class="programlisting">
         <strong class="userinput"><code>Networking options:</code></strong>
         
         Network firewalls (CONFIG_FIREFALL) [N] Y
         <acronym class="acronym">IP</acronym>:Firewalling (CONFIG_IP_FIREWALL) [N] Y
         <acronym class="acronym">IP</acronym>:<acronym class="acronym">TCP</acronym> syncookie support (CONFIG_SYN_COOKIES) [N] Y
         </pre><p>
         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         If you followed the Linux Kernel section and have recompiled your kernel, the options Network firewalls, <acronym class="acronym">IP</acronym>:Firewalling, and <acronym class="acronym">IP</acronym>:<acronym class="acronym">TCP</acronym> syncookies supports shown above are already set.
         </p></div><p>
         <acronym class="acronym">IP</acronym> Masquerading and <acronym class="acronym">IP</acronym> <acronym class="acronym">ICMP</acronym> Masquerading are requiring only for a Gateway Server.
         </p><pre class="programlisting">
         <acronym class="acronym">IP</acronym>:Masquerading (CONFIG_IP_MASQUERADE) [N] Y
         <acronym class="acronym">IP</acronym>:<acronym class="acronym">ICMP</acronym> Masquerading (CONFIG_IP_MASQUERADE_ICMP) [N] Y
         </pre><p>
         </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
         Only your Gateway Server needs to have <acronym class="acronym">IP</acronym>:Masquerading and <acronym class="acronym">IP</acronym>:<acronym class="acronym">ICMP</acronym> Masquerading kernel options enabled. This is required to masquerade your Internal Network to the outside.
         </p></div><p>
         Masquerade means that if one of the computers on your local network for which your Linux box (or gateway) acts as a firewall wants to send something to the outside, your box can <code class="literal">masquerade</code> as that 
         computer. In other words it forwards the traffic to the intended outside destination, but makes it look like it came from the firewall box itself. 
         </p><p>
         It works both ways: if the outside host replies, the Linux firewall will silently forward the traffic to the corresponding local computer. This way, the computers on your local net are completely invisible to the outside world, even 
         though they can reach the outside and can receive replies. This makes it possible to have the computers on the local network participate on the Internet even if they don't have officially registered <acronym class="acronym">IP</acronym> addresses.
         </p><p>
         The <acronym class="acronym">IP</acronym> masquerading code will only work if <acronym class="acronym">IP</acronym> forwarding is enabled on your system. This feature is by default disabled and you can enable it with the following command:
         </p><p>
         Under </p><div class="mediaobject"><img src="./images/Version6.1.gif" alt="Version 6.1 only"></div><p>
         To enable <acronym class="acronym">IP</acronym> forwarding feature on your server, execute the following command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>echo</strong></span> 1 &gt; /proc/sys/net/ipv4/ip_forward
         </pre><p>
         You can add the above line in your <code class="filename">/etc/rc.d/rc.local</code> script file so <acronym class="acronym">IP</acronym> forwarding is enabled automatically for you even if your server is rebooted. In Red Hat Linux 6.1 this can also be 
         accomplished by changing the line in <code class="filename">/etc/sysconfig/network</code> file from:
         </p><pre class="screen">
         FORWARD_IPV4="false"
         </pre><p>
         To read:
         </p><pre class="screen">
         FORWARD_IPV4="yes"
         </pre><p>
         </p><p>
         You must restart your network for the change to take effect:
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Bringing up interface lo	        [  OK  ]
         Bringing up interface eth0	        [  OK  ]
         Bringing up interface eth1	        [  OK  ]
         </code></pre><p>
         So you can either add the echo 1 &gt; /proc/sys/net/ipv4/ip_forward command line to your <code class="filename">rc.local</code> script file or you change the value of the line <code class="envar">FORWARD_IPV4=false</code> to <strong class="userinput"><code>yes</code></strong> in the network file to set this 
         feature to <code class="literal">ON</code>. Personally I prefer the second choice.
        </p><p>
         Under </p><div class="mediaobject"><img src="./images/Version6.2.gif" alt="Version 6.2 only"></div><p>
         To enable IPv4 forwarding on your RH 6.2 system, Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
         </p><pre class="programlisting">
         # Enable packet forwarding
         net.ipv4.ip_forward = 1
         </pre><p>
         You must restart your network for the change to take effect. The command to restart the network is the following:
         </p><p>
         To restart all network devices manually on your system, use the following command:
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Setting network parameters	       [  OK  ]
         Bringing up interface lo	       [  OK  ]
         Bringing up interface eth0	       [  OK  ]
         Bringing up interface eth1	       [  OK  ]
         </code></pre><p>
         </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
         The <acronym class="acronym">IP</acronym> forwarding line above is only required if you answered <strong class="userinput"><code>Yes</code></strong> to the kernel option IP:Masquerading (CONFIG_IP_MASQUERADE) and choose to have a server act as 
         a Gateway and masquerade for your inside network.
         </p></div><p>
         If you enabled <acronym class="acronym">IP</acronym> Masquerading, then the modules <code class="filename">ip_masq_ftp.o</code> for ftp file transfers, <code class="filename">ip_masq_irc.o</code> for irc chats, <code class="filename">ip_masq_quake.o</code> 
         <span class="emphasis"><em>you guessed it!</em></span>, <code class="filename">ip_masq_vdolive.o</code> for VDOLive video connections, <code class="filename">ip_masq_cuseeme.o</code> for CU-SeeMe broadcasts and <code class="filename">ip_masq_raudio.o</code> for RealAudio downloads 
         will automatically be compiled. They are needed to make masquerading for these protocols work. 
         </p><p>
         Also, don't forget that you'll need to build a modularized kernel and answer <strong class="userinput"><code>Yes</code></strong> to the Enable loadable module support (CONFIG_MODULES) 
         option instead of a monolithic kernel to be able to use masquerading functions and modules like <code class="filename">ip_masq_ftp.o</code> on your Gateway server <span class="emphasis"><em>see the <a class="link" href="#prt2sct35kcon" title='5. Kernel configuration -Part "A"'>Linux Kernel section</a> above in this book for more information</em></span>.
         </p><p>
         The basic masquerade code described for <acronym class="acronym">IP</acronym>: masquerading above only handles <acronym class="acronym">TCP</acronym> or <acronym class="acronym">UDP</acronym> packets and <acronym class="acronym">ICMP</acronym> errors for existing 
         connections. The <acronym class="acronym">IP</acronym>:<acronym class="acronym">ICMP</acronym> Masquerading option adds additional support for masquerading <acronym class="acronym">ICMP</acronym> packets, such as ping or the probes used by the 
         <span class="trademark">Windows 95</span>&#8482; tracer program.
         </p><p>
         Remember that other servers like the <a class="xref" href="#pr3ch4fsfsc41" title="1.  Config /etc/rc.d/init.d/firewall script file -Web Server">Web Server</a>  and <a class="xref" href="#pr3ch4fsfsc42" title="2. Config /etc/rc.d/init.d/firewall script file - Mail Server">Mail Server</a> examples don't need to have these options enabled since they either have a real <acronym class="acronym">IP</acronym> address assigned or don't act as a Gateway 
         for the inside network.
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6810"></a>2. Config <code class="filename">/etc/rc.d/init.d/firewall</code> script file -Gateway Server</h2></div></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Some Points to Consider</b></p></div></div></div><p>
         You can safely assume that you are potentially at risk if you connect your system to the Internet. Your gateway to the Internet is your greatest exposure, so we recommend the following:
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: opencircle; "><li class="listitem" style="list-style-type: circle"><p>
         The gateway should not run any more applications than are absolutely necessary.
         </p></li><li class="listitem" style="list-style-type: circle"><p>
         The gateway should strictly limit the type and number of protocols allowed to flow through it (protocols potentially provide security holes, such as <acronym class="acronym">FTP</acronym> and telnet).
         </p></li><li class="listitem" style="list-style-type: circle"><p>
         Any system containing confidential or sensitive information should not be directly accessible from the Internet.
         </p></li></ul></div><p>
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6824"></a>3. Configure script for Example Gateway Server</h2></div></div></div><p>
         This is the configuration script file for our Gateway Server. This configuration allows unlimited traffic on the Loopback interface, <acronym class="acronym">ICMP</acronym>, <acronym class="acronym">DNS</acronym> Server and Client (53), 
         <acronym class="acronym">SSH</acronym> Server and Client (22), <acronym class="acronym">HTTP</acronym> Server and Client (80), <acronym class="acronym">HTTPS</acronym> Server and Client (443), <acronym class="acronym">POP</acronym> Client (110), <acronym class="acronym">NNTP</acronym> NEWS 
         Client (119), <acronym class="acronym">SMTP</acronym> Server and Client (25), <acronym class="acronym">IMAP</acronym> Server (143), <acronym class="acronym">IRC</acronym> Client (6667), <acronym class="acronym">ICQ</acronym> Client (4000), <acronym class="acronym">FTP</acronym> Client (20, 21), 
         RealAudio / QuickTime Client, and OUTGOING TRACEROUTE requests by default.
         </p><p>
         If you don't want some services listed in the firewall rules files for the Gateway Server that I make ON by default, comment them out with a "#" at the beginning of the line. If you want some other services 
         that I commented out with a "#", then remove the "#" at the beginning of their lines. If you have configured Masquerading on your server, don't forget to uncomment the modules necessary to masquerade their 
         respective services that you need like <code class="filename">ip_masq_irc.o</code>, <code class="filename">ip_masq_raudio.o</code>, etc under the MODULES MASQUERADING section of the firewall script file.
         </p><p>
         Create the firewall script file <span class="command"><strong>touch</strong></span> <code class="filename">/etc/rc.d/init.d/firewall</code>, on your Gateway Server and add:
         </p><pre class="programlisting">
         #!/bin/sh
         #
         # ----------------------------------------------------------------------------
         # Last modified by Gerhard Mourani:  04-25-2000
         # ----------------------------------------------------------------------------
         # Copyright (C) 1997, 1998, 1999  Robert L. Ziegler
         #
         # Permission to use, copy, modify, and distribute this software and its
         # documentation for educational, research, private and non-profit purposes,
         # without fee, and without a written agreement is hereby granted. 
         # This software is provided as an example and basis for individual firewall
         # development.  This software is provided without warranty.
         #
         # Any material furnished by Robert L. Ziegler is furnished on an 
         # "as is" basis.  He makes no warranties of any kind, either expressed 
         # or implied as to any matter including, but not limited to, warranty 
         # of fitness for a particular purpose, exclusivity or results obtained
         # from use of the material.
         # ----------------------------------------------------------------------------
         #
         # Invoked from /etc/rc.d/init.d/firewall.
         # chkconfig: - 60 95
         # description: Starts and stops the IPCHAINS Firewall \
         #              used to provide Firewall network services.

         # Source function library.
         . /etc/rc.d/init.d/functions

         # Source networking configuration.
         . /etc/sysconfig/network

         # Check that networking is up.
         if [ ${NETWORKING} = "no" ]
         then
         exit 0
         fi

         if [ ! -x /sbin/ipchains ]; then
         exit 0
         fi

         # See how we were called.
         case "$1" in
         start)
         echo -n "Starting Firewalling Services: "

         # Some definitions for easy maintenance.

         # ----------------------------------------------------------------------------
         #  EDIT THESE TO SUIT YOUR SYSTEM AND ISP.

         EXTERNAL_INTERFACE="eth0"               		# Internet connected interface
         LOCAL_INTERFACE_1="eth1"				# Internal LAN interface
         LOOPBACK_INTERFACE="lo"                 		# Your local naming convention
         IPADDR="my.ip.address"                  		# Your <acronym class="acronym">IP</acronym> address
         LOCALNET_1="192.168.1.0/24"             		# Whatever private range you use
         IPSECSG="my.ipsecsg.address"     	                # Space separated list of remote VPN gateways
         FREESWANVI="ipsec0"              	                # Space separated list of virtual interfaces
         ANYWHERE="any/0"                        		# Match any <acronym class="acronym">IP</acronym> address
         NAMESERVER_1="my.name.server.1"		        # Everyone must have at least one
         NAMESERVER_2="my.name.server.2"		        # Your secondary name server
         MY_ISP="my.isp.address.range/24"        		# ISP <acronym class="acronym">&amp;</acronym> NOC address range
                                                                
         SMTP_SERVER="my.smtp.server"            		# Your Mail Hub Server.
         POP_SERVER="my.pop.server"          		        # External pop server, if any
         NEWS_SERVER="my.news.server"        		        # External news server, if any
         SYSLOG_SERVER="syslog.internal.server"  	        # Your syslog internal server

         LOOPBACK="127.0.0.0/8"                  		# Reserved loopback address range
         CLASS_A="10.0.0.0/8"                    		# Class A private networks
         CLASS_B="172.16.0.0/12"                 		# Class B private networks
         CLASS_C="192.168.0.0/16"                		# Class C private networks
         CLASS_D_MULTICAST="224.0.0.0/4"         	        # Class D multicast addresses
         CLASS_E_RESERVED_NET="240.0.0.0/5"  	                # Class E reserved addresses
         BROADCAST_SRC="0.0.0.0"                 		# Broadcast source address
         BROADCAST_DEST="255.255.255.255"      	                # Broadcast destination address
         PRIVPORTS="0:1023"                      		# Well known, privileged port range
         UNPRIVPORTS="1024:65535"                		# Unprivileged port range

         # ----------------------------------------------------------------------------

         # <acronym class="acronym">SSH</acronym> starts at 1023 and works down to 513 for
         # each additional simultaneous incoming connection.
         SSH_PORTS="1022:1023"             			# range for <acronym class="acronym">SSH</acronym> privileged ports

         # traceroute usually uses -S 32769:65535 -D 33434:33523
         TRACEROUTE_SRC_PORTS="32769:65535"
         TRACEROUTE_DEST_PORTS="33434:33523"

         # ----------------------------------------------------------------------------
         # Default policy is DENY
         # Explicitly accept desired INCOMING <acronym class="acronym">&amp;</acronym> OUTGOING connections

         # Remove all existing rules belonging to this filter
         ipchains -F

         # Clearing all current rules and user defined chains
         ipchains -X

         # Set the default policy of the filter to deny.
         # Don't even bother sending an error message back.
         ipchains -P input  DENY
         ipchains -P output DENY
         ipchains -P forward DENY

         # set masquerade timeout to 10 hours for tcp connections
         ipchains -M -S 36000 0 0

         # Don't forward fragments. Assemble before forwarding.
         ipchains -A output -f -i $LOCAL_INTERFACE_1 -j DENY

         # ----------------------------------------------------------------------------
         # MODULES MASQUERADING
         # Uncomment bellow all modules lines that you need

         # These modules are necessary to masquerade their respective services.
         /sbin/modprobe ip_masq_ftp
         /sbin/modprobe ip_masq_raudio ports=554,7070,7071,6970,6971
         /sbin/modprobe ip_masq_irc
         #/sbin/modprobe ip_masq_vdolive
         #/sbin/modprobe ip_masq_cuseeme
         #/sbin/modprobe ip_masq_quake

         # ----------------------------------------------------------------------------
         # LOOPBACK

         # Unlimited traffic on the loopback interface.
         ipchains -A input  -i $LOOPBACK_INTERFACE -j ACCEPT 
         ipchains -A output -i $LOOPBACK_INTERFACE -j ACCEPT 

         # ----------------------------------------------------------------------------
         # Network Ghouls
         # Deny access to jerks

         # /etc/rc.d/rc.firewall.blocked contains a list of
         # ipchains -A input  -i $EXTERNAL_INTERFACE -s address -j DENY
         # rules to block from any access.

         # Refuse any connection from problem sites
         #if [ -f /etc/rc.d/rc.firewall.blocked ]; then
         #    . /etc/rc.d/rc.firewall.blocked
         #fi

         # ----------------------------------------------------------------------------
         # SPOOFING <acronym class="acronym">&amp;</acronym> BAD ADDRESSES
         # Refuse spoofed packets.
         # Ignore blatantly illegal source addresses.
         # Protect yourself from sending to bad addresses.

         # Refuse spoofed packets pretending to be from the external address.
         ipchains -A input  -i $EXTERNAL_INTERFACE -s $IPADDR -j DENY -l

         # Refuse packets claiming to be to or from a Class A private network
         ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_A -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -d $CLASS_A -j DENY -l
         ipchains -A output -i $EXTERNAL_INTERFACE -s $CLASS_A -j REJECT -l
         ipchains -A output -i $EXTERNAL_INTERFACE -d $CLASS_A -j REJECT -l

         # Refuse packets claiming to be to or from a Class B private network
         ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_B -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -d $CLASS_B -j DENY -l
         ipchains -A output -i $EXTERNAL_INTERFACE -s $CLASS_B -j REJECT -l
         ipchains -A output -i $EXTERNAL_INTERFACE -d $CLASS_B -j REJECT -l

         # Refuse packets claiming to be to or from a Class C private network
         #    ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_C -j DENY -l
         #    ipchains -A input  -i $EXTERNAL_INTERFACE -d $CLASS_C -j DENY -l
         #    ipchains -A output -i $EXTERNAL_INTERFACE -s $CLASS_C -j REJECT -l
         #    ipchains -A output -i $EXTERNAL_INTERFACE -d $CLASS_C -j REJECT -l

         # Refuse packets claiming to be from the loopback interface
         ipchains -A input  -i $EXTERNAL_INTERFACE -s $LOOPBACK -j DENY -l
         ipchains -A output -i $EXTERNAL_INTERFACE -s $LOOPBACK -j REJECT -l

         # Refuse broadcast address SOURCE packets
         ipchains -A input  -i $EXTERNAL_INTERFACE -s $BROADCAST_DEST -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -d $BROADCAST_SRC -j DENY -l

         # Refuse Class D multicast addresses (in.h) (NET-3-HOWTO)
         # Multicast is illegal as a source address.
         # Multicast uses UDP.
         ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_D_MULTICAST -j DENY -l

         # Refuse Class E reserved <acronym class="acronym">IP</acronym>  addresses
         ipchains -A input  -i $EXTERNAL_INTERFACE -s $CLASS_E_RESERVED_NET -j DENY -l

         # refuse addresses defined as reserved by the IANA
         # 0.*.*.*, 1.*.*.*, 2.*.*.*, 5.*.*.*, 7.*.*.*, 23.*.*.*, 27.*.*.*
         # 31.*.*.*, 37.*.*.*, 39.*.*.*, 41.*.*.*, 42.*.*.*, 58-60.*.*.*
         # 65-95.*.*.*, 96-126.*.*.*, 197.*.*.*, 201.*.*.* (?), 217-223.*.*.*
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 1.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 2.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 5.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 7.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 23.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 27.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 31.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 37.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 39.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 41.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 42.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 58.0.0.0/7 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 60.0.0.0/8 -j DENY -l

         #65: 01000001    - /3 includes 64 - need 65-79 spelled out
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 65.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 66.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 67.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 68.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 69.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 70.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 71.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 72.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 73.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 74.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 75.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 76.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 77.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 78.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 79.0.0.0/8 -j DENY -l

         #80: 01010000   - /4 masks 80-95
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 80.0.0.0/4 -j DENY -l

         # 96: 01100000    - /4 makses 96-111
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 96.0.0.0/4 -j DENY -l

         #126: 01111110    - /3 includes 127 - need 112-126 spelled out
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 112.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 113.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 114.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 115.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 116.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 117.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 118.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 119.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 120.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 121.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 122.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 123.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 124.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 125.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 126.0.0.0/8 -j DENY -l

         #217: 11011001    - /5 includes 216 - need 217-219 spelled out
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 217.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 218.0.0.0/8 -j DENY -l
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 219.0.0.0/8 -j DENY -l

         #223: 11011111    - /6 masks 220-223
         ipchains -A input  -i $EXTERNAL_INTERFACE -s 220.0.0.0/6 -j DENY -l

         # ----------------------------------------------------------------------------
         # <acronym class="acronym">ICMP</acronym>

         #    To prevent denial of service attacks based on <acronym class="acronym">ICMP</acronym> bombs, filter
         #    incoming Redirect (5) and outgoing Destination Unreachable (3).
         #    Note, however, disabling Destination Unreachable (3) is not
         #    advisable, as it is used to negotiate packet fragment size.

         # For bi-directional ping.
         #     Message Types:  Echo_Reply (0),  Echo_Request (8)
         #     To prevent attacks, limit the src addresses to your ISP range.
         # 
         # For outgoing traceroute.
         #     Message Types:  INCOMING Dest_Unreachable (3), Time_Exceeded (11)
         #     default UDP base: 33434 to base+nhops-1
         # 
         # For incoming traceroute.
         #     Message Types:  OUTGOING Dest_Unreachable (3), Time_Exceeded (11)
         #     To block this, deny OUTGOING 3 and 11

         #  0: echo-reply (pong)
         #  3: destination-unreachable, port-unreachable, fragmentation-needed, etc.
         #  4: source-quench
         #  5: redirect
         #  8: echo-request (ping)
         # 11: time-exceeded
         # 12: parameter-problem

         ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
         -s $ANYWHERE 0 -d $IPADDR -j ACCEPT
         ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
         -s $ANYWHERE 3 -d $IPADDR -j ACCEPT
         ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
         -s $ANYWHERE 4 -d $IPADDR -j ACCEPT
         ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
         -s $ANYWHERE 11 -d $IPADDR -j ACCEPT
         ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
         -s $ANYWHERE 12 -d $IPADDR -j ACCEPT
         ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
         -s $MY_ISP 8 -d $IPADDR -j ACCEPT

         ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
         -s $IPADDR 0 -d $MY_ISP -j ACCEPT
         ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
         -s $IPADDR 3 -d $MY_ISP -j ACCEPT
         ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
         -s $IPADDR 4 -d $ANYWHERE -j ACCEPT
         ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
         -s $IPADDR 8 -d $ANYWHERE -j ACCEPT
         ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
         -s $IPADDR 12 -d $ANYWHERE -j ACCEPT
         ipchains -A output -i $EXTERNAL_INTERFACE -p icmp \
         -s $IPADDR 11 -d $MY_ISP -j ACCEPT

         # ----------------------------------------------------------------------------
         # UDP INCOMING TRACEROUTE
         # traceroute usually uses -S 32769:65535 -D 33434:33523

         ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
         -s $MY_ISP $TRACEROUTE_SRC_PORTS \
         -d $IPADDR $TRACEROUTE_DEST_PORTS -j ACCEPT -l

         ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
         -s $ANYWHERE $TRACEROUTE_SRC_PORTS \
         -d $IPADDR $TRACEROUTE_DEST_PORTS -j DENY -l

         # ----------------------------------------------------------------------------
         # <acronym class="acronym">DNS</acronym> server
         # ----------

         # <acronym class="acronym">DNS</acronym>: full server
         # server/client to server query or response

         ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
         -s $ANYWHERE $UNPRIVPORTS \
         -d $IPADDR 53 -j ACCEPT

         ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
         -s $IPADDR 53 \
         -d $ANYWHERE $UNPRIVPORTS -j ACCEPT

         # <acronym class="acronym">DNS</acronym> client (53)
         # ---------------
         ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
         -s $NAMESERVER_1 53 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT

         ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
         -s $IPADDR $UNPRIVPORTS \
         -d $NAMESERVER_1 53 -j ACCEPT

         ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
         -s $NAMESERVER_2 53 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT

         ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
         -s $IPADDR $UNPRIVPORTS \
         -d $NAMESERVER_2 53 -j ACCEPT

         # TCP client to server requests are allowed by the protocol
         # if UDP requests fail. This is rarely seen. Usually, clients
         # use TCP as a secondary nameserver for zone transfers from
         # their primary nameservers, and as hackers.

         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $NAMESERVER_1 53 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $UNPRIVPORTS \
         -d $NAMESERVER_1 53 -j ACCEPT

         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $NAMESERVER_2 53 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $UNPRIVPORTS \
         -d $NAMESERVER_2 53 -j ACCEPT

         # ----------------------------------------------------------------------------
         # TCP accept only on selected ports
         # ---------------------------------
         # ------------------------------------------------------------------

         # <acronym class="acronym">SSH</acronym> server (22)
         # ---------------

         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
         -s $ANYWHERE $UNPRIVPORTS \
         -d $IPADDR 22 -j ACCEPT 

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $IPADDR 22 \
         -d $ANYWHERE $UNPRIVPORTS -j ACCEPT 

         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
         -s $ANYWHERE $SSH_PORTS \
         -d $IPADDR 22 -j ACCEPT 

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $IPADDR 22 \
         -d $ANYWHERE $SSH_PORTS -j ACCEPT 

         # <acronym class="acronym">SSH</acronym> client (22)
         # ---------------
         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $ANYWHERE 22 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $UNPRIVPORTS \
         -d $ANYWHERE 22 -j ACCEPT 

         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $ANYWHERE 22 \
         -d $IPADDR $SSH_PORTS -j ACCEPT 

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $SSH_PORTS \
         -d $ANYWHERE 22 -j ACCEPT 

         # ------------------------------------------------------------------

         # <acronym class="acronym">HTTP</acronym> client (80)
         # ----------------
         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $ANYWHERE 80 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $UNPRIVPORTS \
         -d $ANYWHERE 80 -j ACCEPT 

         # ------------------------------------------------------------------

         # <acronym class="acronym">HTTPS</acronym> client (443)
         # ------------------
         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $ANYWHERE 443 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $UNPRIVPORTS \
         -d $ANYWHERE 443 -j ACCEPT 

         # ------------------------------------------------------------------

         # POP client (110)
         # ----------------
         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $POP_SERVER 110 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $UNPRIVPORTS \
         -d $POP_SERVER 110 -j ACCEPT 

         # ------------------------------------------------------------------

         # NNTP NEWS client (119)
         # ----------------------
         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $NEWS_SERVER 119 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $UNPRIVPORTS \
         -d $NEWS_SERVER 119 -j ACCEPT 

         # ------------------------------------------------------------------

         # FINGER client (79)
         # ------------------
         #    ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         #             -s $ANYWHERE 79 \
         #             -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         #    ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         #             -s $IPADDR $UNPRIVPORTS \
         #             -d $ANYWHERE 79 -j ACCEPT 

         # ------------------------------------------------------------------

         # SYSLOG client (514)
         # -----------------

         #    ipchains -A output -i $LOCAL_INTERFACE_1 -p udp \
         #             -s $IPADDR 514 \
         #             -d $SYSLOG_SERVER 514 -j ACCEPT

         # ------------------------------------------------------------------

         # AUTH server (113)
         # -----------------

         # Reject, rather than deny, the incoming auth port. (NET-3-HOWTO)

         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
         -s $ANYWHERE \
         -d $IPADDR 113 -j REJECT 

         # AUTH client (113)
         # -----------------
         #    ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         #             -s $ANYWHERE 113 \
         #             -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         #    ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         #             -s $IPADDR $UNPRIVPORTS \
         #             -d $ANYWHERE 113 -j ACCEPT 

         # ------------------------------------------------------------------

         # SMTP client (25)
         # ----------------
         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $ANYWHERE 25 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $UNPRIVPORTS \
         -d $ANYWHERE 25 -j ACCEPT 

         # ------------------------------------------------------------------

         # IRC client (6667)
         # -----------------
         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $ANYWHERE 6667 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $UNPRIVPORTS \
         -d $ANYWHERE 6667 -j ACCEPT 

         # ------------------------------------------------------------------

         # ICQ client (4000)
         # -----------------
         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $ANYWHERE 2000:4000 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $UNPRIVPORTS \
         -d $ANYWHERE 2000:4000 -j ACCEPT 

         ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
         -s $ANYWHERE 4000 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
         -s $IPADDR $UNPRIVPORTS \
         -d $ANYWHERE 4000 -j ACCEPT 

         # ------------------------------------------------------------------

         # FTP client (20, 21)
         # -------------------

         # outgoing request
         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $ANYWHERE 21 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $UNPRIVPORTS \
         -d $ANYWHERE 21 -j ACCEPT 

         # NORMAL mode data channel
         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
         -s $ANYWHERE 20 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         # NORMAL mode data channel responses
         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $IPADDR $UNPRIVPORTS \
         -d $ANYWHERE 20 -j ACCEPT 

         # PASSIVE mode data channel creation
         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $UNPRIVPORTS \
         -d $ANYWHERE $UNPRIVPORTS -j ACCEPT 

         # PASSIVE mode data channel responses
         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $ANYWHERE $UNPRIVPORTS \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         # ------------------------------------------------------------------

         # RealAudio / QuickTime client
         # ----------------------------

         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $ANYWHERE 554 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $UNPRIVPORTS \
         -d $ANYWHERE 554 -j ACCEPT


         # TCP is a more secure method:  7070:7071

         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         -s $ANYWHERE 7070:7071 \
         -d $IPADDR $UNPRIVPORTS -j ACCEPT

         ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         -s $IPADDR $UNPRIVPORTS \
         -d $ANYWHERE 7070:7071 -j ACCEPT


         # UDP is the preferred method:  6970:6999
         # For LAN machines, UDP requires the RealAudio masquerading module and
         # the ipmasqadm third-party software.

         ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
         -s $ANYWHERE $UNPRIVPORTS \
         -d $IPADDR 6970:6999 -j ACCEPT

         ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
         -s $IPADDR $UNPRIVPORTS \
         -d $ANYWHERE $UNPRIVPORTS -j ACCEPT

         # ------------------------------------------------------------------

         # WHOIS client (43)
         # -----------------
         #    ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp ! -y \
         #             -s $ANYWHERE 43 \
         #             -d $IPADDR $UNPRIVPORTS -j ACCEPT 

         #    ipchains -A output -i $EXTERNAL_INTERFACE -p tcp \
         #             -s $IPADDR $UNPRIVPORTS \
         #             -d $ANYWHERE 43 -j ACCEPT 

         # ------------------------------------------------------------------

         # OUTGOING TRACEROUTE
         # -------------------
         ipchains -A output -i $EXTERNAL_INTERFACE -p udp \
         -s $IPADDR $TRACEROUTE_SRC_PORTS \
         -d $ANYWHERE $TRACEROUTE_DEST_PORTS -j ACCEPT 

         # ----------------------------------------------------------------------------
         # Unlimited traffic within the local network.

         # All internal machines have access to the firewall machine.

         ipchains -A input  -i $LOCAL_INTERFACE_1 -s $LOCALNET_1 -j ACCEPT 
         ipchains -A output -i $LOCAL_INTERFACE_1 -d $LOCALNET_1 -j ACCEPT 

         # ----------------------------------------------------------------------------
         # FreeS/WAN IPSec VPN
         # -------------------

         # If you are using the FreeSWAN IPSec VPN, you will need to fill in the
         # addresses of the gateways in the IPSECSG and the virtual interfaces for
         # FreeS/Wan IPSEC in the FREESWANVI parameters. Look at the beginning of
         # this firewall script rules file to set the parameters.

         # IPSECSG is a Space separated list of remote gateways. FREESWANVI is a
         # Space separated list of virtual interfaces for FreeS/Wan IPSEC
         # implementation. Only include those that are actually used.

         # Allow IPSEC protocol from remote gateways on external interface
         # IPSEC uses three main types of packet:
         # IKE uses the UDP protocol and port 500,
         # ESP use the protocol number 50, and
         # AH use the protocol number 51

         #    ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
         #             -s $IPSECSG -j ACCEPT

         #    ipchains -A output  -i $EXTERNAL_INTERFACE -p udp \
         #             -d $IPSECSG -j ACCEPT

         #    ipchains -A input  -i $EXTERNAL_INTERFACE -p 50 \
         #             -s $IPSECSG -j ACCEPT

         #    ipchains -A output  -i $EXTERNAL_INTERFACE -p 50 \
         #             -d $IPSECSG -j ACCEPT

         #    ipchains -A input  -i $EXTERNAL_INTERFACE -p 51 \
         #             -s $IPSECSG -j ACCEPT

         #    ipchains -A output  -i $EXTERNAL_INTERFACE -p 51 \
         #             -d $IPSECSG -j ACCEPT

         # Allow all traffic to FreeS/WAN Virtual Interface
         #    ipchains -A input  -i $FREESWANVI \
         #             -s $ANYWHERE \
         #             -d $ANYWHERE -j ACCEPT

         #    ipchains -A output  -i $FREESWANVI \
         #             -s $ANYWHERE \
         #             -d $ANYWHERE -j ACCEPT

         # Forward anything from the FreeS/WAN virtual interface IPSEC tunnel
         #    ipchains -A forward  -i $FREESWANVI \
         #             -s $ANYWHERE \
         #             -d $ANYWHERE -j ACCEPT

         # Disable <acronym class="acronym">IP</acronym> spoofing protection to allow IPSEC to work properly
         #    echo 0 &gt; /proc/sys/net/ipv4/conf/ipsec0/rp_filter
         #    echo 0 &gt; /proc/sys/net/ipv4/conf/eth0/rp_filter

         # ----------------------------------------------------------------------------
         # Masquerade internal traffic.

         # All internal traffic is masqueraded externally.

         ipchains -A forward -i $EXTERNAL_INTERFACE -s $LOCALNET_1 -j MASQ

         # ----------------------------------------------------------------------------
         # Enable logging for selected denied packets

         ipchains -A input  -i $EXTERNAL_INTERFACE -p tcp \
         -d $IPADDR -j DENY -l

         ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
         -d $IPADDR $PRIVPORTS -j DENY -l

         ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
         -d $IPADDR $UNPRIVPORTS -j DENY -l

         ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
         -s $ANYWHERE 5 -d $IPADDR -j DENY -l

         ipchains -A input  -i $EXTERNAL_INTERFACE -p icmp \
         -s $ANYWHERE 13:255 -d $IPADDR -j DENY -l

         # ----------------------------------------------------------------------------

         ;;
         stop)
         echo -n "Shutting Firewalling Services: "

         # Remove all existing rules belonging to this filter
         ipchains -F

         # Delete all user-defined chain to this filter
         ipchains -X

         # Reset the default policy of the filter to accept.
         ipchains -P input  ACCEPT
         ipchains -P output ACCEPT
         ipchains -P forward ACCEPT

         ;;
         status)
         status firewall
         ;;
         restart|reload)
         $0 stop
         $0 start
         ;;
         *)
         echo "Usage: firewall {start|stop|status|restart|reload}"
         exit 1
         esac

         exit 0
         </pre><p>
         </p><p>
         Now, make this script executable and change its default permissions:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>chmod</strong></span> 700 /etc/rc.d/init.d/firewall
         [root@deep] /#<span class="command"><strong>chown</strong></span> 0.0 /etc/rc.d/init.d/firewall
         </pre><p>
         </p><p>
         Create the symbolic <code class="filename">rc.d</code> links for your Firewall with the command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>chkconfig</strong></span> --add firewall
         [root@deep] /#<span class="command"><strong>chkconfig</strong></span> --level 345 firewall on
         </pre><p>
         Now, your firewall rules are configured to use System <code class="literal">V</code> init -System <code class="literal">V</code> <span class="emphasis"><em>init is in charge of starting all the normal processes that need to run at boot time</em></span> and it will 
         be automatically started each time your server reboots.
         </p><p>
         To manually stop the firewall on your system, use the following command:
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/firewall <span class="command"><strong>stop</strong></span>
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Shutting Firewalling Services:			[  OK  ]
         </code></pre><p>
         </p><p>
         To manually start the firewall on your system, use the following command:
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/firewall <span class="command"><strong>start</strong></span>
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Starting Firewalling Services:			[  OK  ]
         </code></pre><p>
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6886"></a>4. Deny access to some address</h2></div></div></div><p>
         Sometimes you'll know an address that you would like to block from having any access at all to  your server. You can do that by creating 
         the <code class="filename">rc.firewall.blocked</code> file under <code class="filename">/etc/rc.d/</code> directory and uncomment the following 
         lines in your firewall rules scripts file:
         </p><p>
         Edit your firewall scripts file <span class="command"><strong>vi</strong></span> <code class="filename">/etc/rc.d/init.d/firewall</code> and uncomment the following lines:
         </p><pre class="programlisting">
         if [ -f /etc/rc.d/rc.firewall.blocked ]; then
         . /etc/rc.d/rc.firewall.blocked
         fi
         
         </pre><p>
         </p><p>
         Create the rc.firewall.blocked file <span class="command"><strong>touch</strong></span> /etc/rc.d/rc.firewall.blocked and add inside this file all the <acronym class="acronym">IP</acronym> addresses that you want to block from having any access to your 
         server at all:
         For example, I put the following IP addresses in this file:
         </p><div class="example"><a name="idm6898"></a><p class="title"><b>Example 12.1. <code class="filename">rc.firewall.blocked</code></b></p><div class="example-contents"><p> 
         </p><pre class="programlisting">
         204.254.45.9
         187.231.11.5
         </pre><p>
         </p></div></div><br class="example-break"><p>
         Further documentation, more details, there are several man pages you can read:
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: open circle; "><li class="listitem" style="list-style-type: open circle"><p>
         <span class="citerefentry"><span class="refentrytitle">ipchains</span>(8)</span>	- <acronym class="acronym">IP</acronym> firewall administration
         </p></li><li class="listitem" style="list-style-type: open circle"><p>
         <span class="citerefentry"><span class="refentrytitle">ipchains-restore</span>(8)</span>	- restore <acronym class="acronym">IP</acronym> firewall chains from stdin
         </p></li><li class="listitem" style="list-style-type: open circle"><p>
         <span class="citerefentry"><span class="refentrytitle">ipchains-save</span>(8)</span>	- save <acronym class="acronym">IP</acronym> firewall chains to stdout
         </p></li></ul></div><p>
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6923"></a>5. <code class="literal">IPCHAINS</code> Administrative Tools</h2></div></div></div><p>
         The commands listed below are some tools that we use often, but many more exist, and you should check the man page and documentation for more details and information. The ipchains tool is used for 
         the firewall administration of the Linux system. We can use it to set up a firewall rules file, as we are doing in this book. Once firewall rules have been created we can play 
         with its many commands to maintain, and inspect its rules in the Linux kernel.
         </p><p>
         To list all rules in the selected chain, use the command:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>ipchains</strong></span> -L
         </pre><p>
         This command will list all rules in the selected chain. If no chain is selected, all chains are listed.
         </p><p>
         To list all input rules in the selected chain, use the command:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>ipchains</strong></span>  -L input
         </pre><p>
         This command will list all input rules we have configured in the selected chain.
         </p><p>
         To list all output rules in the selected chain, use the command:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>ipchains</strong></span>  -L output
         </pre><p>
         This command will list all output rules we have configured in the selected chain.
         </p><p>
         To list all forward rules in the selected chain, use the command:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>ipchains</strong></span>  -L forward
         </pre><p>
         This command will list all forward rules in the selected chain. This of course works only if you have configured Masquerading on your server. <span class="emphasis"><em>for gateway servers in general</em></span>.
         </p><p>
         To list all masquerades rules in the selected chain, use the command:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>ipchains</strong></span> -ML
         </pre><p>
         This option allows viewing of the currently masqueraded connections. You must have configured Masquerading on your server for this command to work, <span class="emphasis"><em>once again, only for gateway servers</em></span>.
         </p><p>
         To list all rules in numeric output in the selected chain, use the command:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>ipchains</strong></span> -nL
         </pre><p>
         This command will list all rules in numeric output. All the <acronym class="acronym">IP</acronym> addresses and port numbers will be printed in numeric format.
         </p></div></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="idm6948"></a>Part 5. Software -Security</h1></div></div></div><div class="partintro"><div></div><div class="mediaobject" align="center"><img src="./resources/Annimals/Chapter21.gif" align="middle" alt="Spoonbill"></div><div class="abstract"><p class="title"><b>Abstract</b></p><p>
         The next Two parts will exclusively deal with the Software other than the one's which the Linux distribution, <span class="emphasis"><em>in our case Redhat Linux,</em></span> may or may not provide as a part of its core distribution. In 
         some cases it may be provided as an extra but may come as pre-compiled binary which may not exactly suit your purpose. Hence we have in most cases used source packages usually packed as tar gzipped -<code class="literal">*.tar.gz</code> 
         or in some recent case in tar bzipped -<code class="literal">*.tar.bz2</code> format. This gives us the maximum available choices to tweak, choose and delete the options within these Softwares. Just a word about the <code class="literal">*.tar.gz</code> 
         and <code class="literal">*.tar.bz2</code>, the contents are same except that the compression used is different and the <code class="literal">bz2</code> extention is smaller in size as compressed format.

         </p></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="chapter"><a href="#idm6964">13. Linux -The Compiler functionality</a></span></dt><dd><dl><dt><span class="section"><a href="#idm6968">1. The necessary packages</a></span></dt><dt><span class="section"><a href="#idm7103">2. Why choose <code class="literal">tarballs</code>?</a></span></dt><dd><dl><dt><span class="section"><a href="#idm7127">2.1. Compiling software on your system</a></span></dt></dl></dd><dt><span class="section"><a href="#idm7164">3. Build, Install software on your system</a></span></dt><dd><dl><dt><span class="section"><a href="#idm7244">3.1. Edit files with the vi editor</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#prt5ch2ssmt">14. Software -Security/Monitoring</a></span></dt><dd><dl><dt><span class="section"><a href="#prt5ch2s1Xd">1. sXid</a></span></dt><dt><span class="section"><a href="#idm7400">2. Configure and Optimize sXid</a></span></dt><dd><dl><dt><span class="section"><a href="#idm7427">2.1. Configure the <code class="filename">/etc/sxid.conf</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#pr5ch2sc3lc">3. Logcheck</a></span></dt><dt><span class="section"><a href="#idm7569">4. Configure and Optimize Logcheck</a></span></dt><dt><span class="section"><a href="#prt5ch2sc5PS">5. PortSentry</a></span></dt><dt><span class="section"><a href="#idm7748">6. Configure and Optimise Portsentry</a></span></dt><dt><span class="section"><a href="#idm7774">7. Test fire your PortSentry</a></span></dt></dl></dd></dl></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="idm6964"></a>Chapter 13. Linux -The Compiler functionality</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm6968">1. The necessary packages</a></span></dt><dt><span class="section"><a href="#idm7103">2. Why choose <code class="literal">tarballs</code>?</a></span></dt><dd><dl><dt><span class="section"><a href="#idm7127">2.1. Compiling software on your system</a></span></dt></dl></dd><dt><span class="section"><a href="#idm7164">3. Build, Install software on your system</a></span></dt><dd><dl><dt><span class="section"><a href="#idm7244">3.1. Edit files with the vi editor</a></span></dt></dl></dd></dl></div><div class="highlights"><p>
         We are, now at one of the most interesting point, here we will compile and install all the services that we wish to offer in our Linux server. Before we begin to explain how to compile and install server software 
         with all the necessary securities and optimizations that we will need on our server, it is important to know the commands and programs we'll use often to do the job. First of all, we must ensure that we have the 
         necessary packages needed to make compilations on our system. These packages must be installed on your server or you'll not be able to compile programs.
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm6968"></a>1. The necessary packages</h2></div></div></div><p>
         The following are the necessary packages needed to be able to compile the other software programs on your system after recompilation of your kernel. This software is on your Red Hat Linux 6.1 or 6.2 Part 1 CD-ROM under RedHat/RPMS directory if they 
         are not already installed.
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>mount</strong></span> /dev/cdrom /mnt/cdrom/
         [root@deep] /#<span class="command"><strong>cd</strong></span> /mnt/cdrom/RedHat/RPMS/
         </pre><p>
         </p><p>
           </p><div class="mediaobject"><img src="./images/Version6.1.gif" alt="Version 6.1 only"></div><p>
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">autoconf-2.13-5.noarch.rpm</code></td><td><code class="filename">ctags-3.2-1.i386.rpm</code></td></tr><tr><td><code class="filename">m4-1.4-12.i386.rpm</code></td><td><code class="filename">egcs-1.1.2-24.i386.rpm</code></td></tr><tr><td><code class="filename">automake-1.4-5.noarch.rpm</code></td><td><code class="filename">ElectricFence-2.1-1.i386.rpm</code></td></tr><tr><td><code class="filename">dev86-0.14.9-1.i386.rpm</code></td><td><code class="filename">flex-2.5.4a-7.i386.rpm</code></td></tr><tr><td><code class="filename">bison-1.28-1.i386.rpm</code></td><td><code class="filename">gdb-4.18-4.i386.rpm</code></td></tr><tr><td><code class="filename">byacc-1.9-11.i386.rpm</code></td><td><code class="filename">kernel-headers-2.2.12-20.i386.rpm</code></td></tr><tr><td><code class="filename">cdecl-2.5-9.i386.rpm</code></td><td><code class="filename">glibc-devel-2.1.2-11.i386.rpm</code></td></tr><tr><td><code class="filename">cpp-1.1.2-24.i386.rpm</code></td><td><code class="filename">make-3.77-6.i386.rpm</code></td></tr><tr><td><code class="filename">cproto-4.6-2.i386.rpm</code></td><td><code class="filename">patch-2.5-9.i386.rpm</code></td></tr></table><p>
         </p><p>
           </p><div class="mediaobject"><img src="./images/Version6.2.gif" alt="Version 6.2 only"></div><p>
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">autoconf-2.13-5.noarch.rpm</code></td><td><code class="filename">ctags-3.4-1.i386.rpm</code></td></tr><tr><td><code class="filename">m4-1.4-12.i386.rpm</code></td><td><code class="filename">egcs-1.1.2-30.i386.rpm</code></td></tr><tr><td><code class="filename">automake-1.4-6.noarch.rpm</code></td><td><code class="filename">ElectricFence-2.1-3.i386.rpm</code></td></tr><tr><td><code class="filename">dev86-0.15.0-2.i386.rpm</code></td><td><code class="filename">flex-2.5.4a-9.i386.rpm</code></td></tr><tr><td><code class="filename">bison-1.28-2.i386.rpm</code></td><td><code class="filename">gdb-4.18-11.i386.rpm</code></td></tr><tr><td><code class="filename">byacc-1.9-12.i386.rpm</code></td><td><code class="filename">kernel-headers-2.2.14-5.0.i386.rpm</code></td></tr><tr><td><code class="filename">cdecl-2.5-10.i386.rpm</code></td><td><code class="filename">glibc-devel-2.1.3-15.i386.rpm</code></td></tr><tr><td><code class="filename">cpp-1.1.2-30.i386.rpm</code></td><td><code class="filename">make-3.78.1-4.i386.rpm</code></td></tr><tr><td><code class="filename">cproto-4.6-3.i386.rpm</code></td><td><code class="filename">patch-2.5-10.i386.rpm</code></td></tr></table><p>
        </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
         It is better to install the software described above all together if you don't want to receive  dependency error messages during <acronym class="acronym">RPM</acronym> install. If you have followed all the steps 
         in <a class="link" href="#pr1ch2" title="Chapter 3. Installation of your Linux Server">Installation of your Linux Server</a>, then all of these packages are already installed on your system and you don't need to reinstall them again.
         </p></div><p>
         The <acronym class="acronym">RPM</acronym> command to install a <acronym class="acronym">RPM</acronym> package on your system is:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>rpm</strong></span> -Uvh foo-1.0-2.i386.rpm
         </pre><p>
         The <acronym class="acronym">RPM</acronym> command to verify that a package is or is not installed on your system is:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>rpm</strong></span> -q foo
         </pre><p>
         </p><p>
         Once again, after installation and compilation of all programs that you need on your server, its important to uninstall all sharp objects compilers, <abbr class="abbrev">etc.</abbr> describe above. This will protect your system from unauthorized users trying to compile programs on your server without authorization.
         </p><p>
         Another thing to do is to move the rpm binary program to a safe place like a floppy disk for the same reasons listed above. Imagine somebody with dark intentions trying to compile programs on your server and realizing that compilers are not available. They will switch to import programs RPM on the server 
         and install it with the <acronym class="acronym">RPM</acronym> commands. Whoops, Heh! Heh! surprised! <acronym class="acronym">RPM</acronym> commands are not available either. 
         </p><p>
         Of course, in future if you need to install new software on your server,  all you have to do is to replace it from the floppy disk.
         To move the <acronym class="acronym">RPM</acronym> binary in the floppy disk, use the command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>mount</strong></span> /dev/fd0 /mnt/floppy/
         [root@deep] /#<span class="command"><strong>mv</strong></span> /bin/rpm /mnt/floppy
         [root@deep] /#<span class="command"><strong>umount</strong></span> /mnt/floppy/
         </pre><p>
         To put the <acronym class="acronym">RPM</acronym> binary to its original directory, use the command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>mount</strong></span> /dev/fd0 /mnt/floppy/
         [root@deep] /#<span class="command"><strong>cp</strong></span> /mnt/floppy/rpm /bin/
         [root@deep] /#<span class="command"><strong>umount</strong></span> /mnt/floppy/
         </pre><p>
         </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Warning.gif" alt="Warning"></span>
</h3><p>
         Never uninstall the <acronym class="acronym">RPM</acronym> program completely from your system or you will be unable to reinstall it again later since to install RPM or other software you need to have RPM commands available.
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm7103"></a>2. Why choose <code class="literal">tarballs</code>?</h2></div></div></div><p>
         All the programs in Red Hat distributions of Linux are provided as <acronym class="acronym">RPM</acronym> files. An <acronym class="acronym">RPM</acronym> file, also known, as a package, is a way of distributing software so that it can be easily installed, upgraded, queried, and deleted. 
         However, in Unix world, the defacto-standard for package distribution continues to be by way of so-called <code class="literal">tarballs</code>. Tarballs are simply compressed files that can be readable and uncompressed with the tar utility. Installing 
         from tar is usually significantly more tedious than using <acronym class="acronym">RPM</acronym>. So why would we choose to do so?
         </p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>
         Unfortunately, it takes a few weeks for developers and coders to get the latest version of a package converted to <acronym class="acronym">RPM</acronym>s because many developers first release them as <code class="literal">tarballs</code>.
         </p></li><li class="listitem"><p>
         When developers and vendors release a new <acronym class="acronym">RPM</acronym>, they include a lot of options that often are not necessary. Those organization and companies don't know what options you will need and what you will not, so they include the most used to fit the needs of everyone.
         </p></li><li class="listitem"><p>
         Often <acronym class="acronym">RPM</acronym>s are not optimized for your specific processors; companies like Red Hat Linux build <acronym class="acronym">RPM</acronym>s based on a standard PC. This permit their <acronym class="acronym">RPM</acronym> packages to be installed on all sorts of computers since compiling programs for an i386 machine can fit on all systems.
         </p></li><li class="listitem"><p>
         Sometimes you download and install <acronym class="acronym">RPM</acronym>, which other people around the world are building and make available for your purposes. This can pose conflicts in certain cases depending how this individual built the package, such as errors, security and all the other problems described above.
         </p></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm7127"></a>2.1. Compiling software on your system</h3></div></div></div><p>
         A program is something a computer can execute. Originally, somebody wrote the source code in a programming language he/she could understand <abbr class="abbrev">e.g.</abbr>, C, C++. The program source code also makes sense to a compiler that converts the instructions into a binary file suited to whatever processor is 
         wanted <abbr class="abbrev">e.g.</abbr> a 386 or similar. A modern file format for these executable programs is Elf. The programmer compiles his source using the compiler and gets a result of some sort. It's not at all uncommon that early attempts fail to compile, or having compiled, fail to act as expected. Half of programming 
         is tracking down and fixing these problems debugging.
         </p><p>
         For the beginners there are more aspect and new words relating to compilation of a source code that you must know, these includes but are not limited to:
         </p><div class="glosslist"><dl><dt><span class="glossterm">
         The Multiple Files
         </span></dt><dd class="glossdef"><p>
         One-file programs are quite rare. Usually there are a number of files say <code class="literal">*.c</code>, <code class="literal">*.cpp</code>, <abbr class="abbrev">etc.</abbr> that are each compiled into object files <code class="literal">*.o</code> and then linked into an executable. The compiler is usually used to perform the linking and calls the ld program behind the scenes.
         </p></dd><dt><span class="glossterm">
         The Makefiles
         </span></dt><dd class="glossdef"><p>
         The Makefiles are intended to aid you in building your program the same way each time. They also often help with speed. The make program uses dependencies in the Makefile to decide what parts of the program need to be recompiled. If you change one source file out of fifty 
         you hope to get away with one compile and one link step, instead of starting from scratch.
         </p></dd><dt><span class="glossterm">
         The Libraries
         </span></dt><dd class="glossdef"><p>
         Programs can be linked not only to object files <code class="literal">*.o</code> but also to libraries that are collections of object files. There are two forms of linking to libraries: 
         static, where the code goes in the executable file, and dynamic, where the code is collected when the program starts to run.
         </p></dd><dt><span class="glossterm">
         The Patches
         </span></dt><dd class="glossdef"><p>
         It was common before for executable files to be given corrections without recompiling them. Now this practice has died out; in modern days, people changes a small proportion of the whole source code, putting a change into a file called a patch. Where different versions of a 
         program are required, small changes to code can be released this way, saving the trouble of having two large distributions.
         </p></dd><dt><span class="glossterm">
         The Errors in Compilation and Linking
         </span></dt><dd class="glossdef"><p>
         Errors in compilation and linking are often typos, omissions, and misuse of the language. Check that the right includes files are used for the functions you are calling. Unreferenced symbols are the sign of an incomplete link step. Also checks if the necessary development 
         libraries GLIBC or tools GCC, DEV86, AUTOMAKE, <abbr class="abbrev">etc.</abbr> are installed on your system.
         </p></dd><dt><span class="glossterm">
         The Debugging
         </span></dt><dd class="glossdef"><p>
         Debugging is a large topic. It usually helps to have statements in the code that inform you of what is happening. To avoid drowning in output you might sometimes get them to print out only the first 3 passes in a loop. Checking that variables have passed correctly between 
         modules often helps. Get familiar with your debugging tools.
         </p></dd></dl></div><p>
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm7164"></a>3. Build, Install software on your system</h2></div></div></div><p>
         You will see from the next chapter right  through Part 6  that we use many different compile commands to build and install programs on the server. These commands are UNIX compatible and are used on all variant 
         off <code class="literal">*nix</code> machines to compile and install software.
         </p><p>
         The procedures to compile and install software tarballs on your server follow:
         </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
         First of all, you must download the tarball from your trusted software archive site. Usually from the main site of the software you hope to install.
         </p></li><li class="step"><p>
         After downloading the tarball change to the <code class="filename">/var/tmp/</code> directory, note that other paths are possible, as personal discretion and untar the archive by typing the commands as root as in the 
         following example:
         </p><div class="example"><a name="idm7175"></a><p class="title"><b>Example 13.1. Using tar</b></p><div class="example-contents"><p>
           </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>tar</strong></span> xzpf foo.tar.gz
         </pre><p>

         The above command will extract all files from the example foo.tar.gz compressed archive and will create a new directory for them with the name of this software from the path where you are executing the command.

         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">The <code class="literal">x</code> option</span></dt><dd><p>
          tells tar to extract all files from the archive.
          </p></dd><dt><span class="term">The <code class="literal">z</code> option</span></dt><dd><p>
          tells tar that the archive is compressed with gzip.
          </p></dd><dt><span class="term">The <code class="literal">p</code> option</span></dt><dd><p>
         maintains the original and permissions the files had as the archive was created.
         </p></dd><dt><span class="term">The <code class="literal">f</code> option</span></dt><dd><p>
          tells tar that the very next argument is the file name.
          </p></dd></dl></div><p>
         </p></div></div><p><br class="example-break">
         </p></li></ol></div><p>
         Once the tarball has been decompressed into the appropriate directory, you will almost certainly find a <code class="filename">README</code> and/or an <code class="filename">INSTALL</code> file included with the newly decompressed 
         files, with further instructions on how to build and compile the software package for use. You will need to enter commands similar to the following example:
         </p><pre class="programlisting">
         <span class="command"><strong>./configure</strong></span>
         <span class="command"><strong>make</strong></span>
         <span class="command"><strong>make install</strong></span>
         </pre><p>
         </p><p>
         The above commands;
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         <span class="command"><strong>./configure</strong></span> will configure the software to ensure your system has the necessary functionality and libraries to successfully compile the package 
         </td></tr><tr><td>
         <span class="command"><strong>make</strong></span> will compile all the source files into executable binaries. 
         </td></tr><tr><td>
         Finally, <span class="command"><strong>make install</strong></span> will install the binaries and any supporting files into the appropriate locations. 
         </td></tr></table><p>
         Other specifics commands that you'll see in our book for compilation and installation procedure will be:
         </p><pre class="programlisting">
         <span class="command"><strong>make depend</strong></span>
         <span class="command"><strong>strip</strong></span>
         <span class="command"><strong>chown</strong></span>
         </pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <span class="command"><strong>make depend</strong></span></span></dt><dd><p>
         command will build and make the necessary dependencies for different files. 
         </p></dd><dt><span class="term">
         <span class="command"><strong>strip</strong></span></span></dt><dd><p>
         command will discard all symbols from the object files. This means that our binary file will be smaller in size, will improve a bit the performance hit to the program since there will be fewer lines to read 
         by the system when it executes the binary. 
         </p></dd><dt><span class="term">
         <span class="command"><strong>chown</strong></span> </span></dt><dd><p>
         command will set the correct files owner and group permission for the binaries.
         </p></dd></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         More commands when necessary will be explained in the concerned installation procedure.
         </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm7244"></a>3.1. Edit files with the vi editor</h3></div></div></div><p>
         The vi program is a text editor that you can use to edit any text and particularly programs. During installation of software, the user will often have to edit text files like <code class="filename">Makefiles</code> or 
         configuration files to make and fit they changes. The following are some of the most important keystroke commands to get around in vi.
         </p><div class="glosslist"><dl><dt><span class="glossterm"><span class="command"><strong>i</strong></span></span></dt><dd class="glossdef"><p>
         To insert text before the cursor.
         </p></dd><dt><span class="glossterm"><span class="command"><strong>a</strong></span></span></dt><dd class="glossdef"><p>
         To append text after the cursor.
         </p></dd><dt><span class="glossterm"><span class="command"><strong>dd</strong></span></span></dt><dd class="glossdef"><p>
         To delete the current line.
         </p></dd><dt><span class="glossterm"><span class="command"><strong>x</strong></span></span></dt><dd class="glossdef"><p>
         To delete the current character.
           </p></dd><dt><span class="glossterm"><span class="command"><strong>Esc</strong></span></span></dt><dd class="glossdef"><p>
         To end the insert or append mode.
         </p></dd><dt><span class="glossterm"><span class="command"><strong>u</strong></span></span></dt><dd class="glossdef"><p>
         To undo the last command.
         </p></dd><dt><span class="glossterm"><span class="command"><strong><span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>f</strong></span></strong></span></span></dt><dd class="glossdef"><p>
         Scroll up one page.
         </p></dd><dt><span class="glossterm"><span class="command"><strong><span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>b</strong></span></strong></span></span></dt><dd class="glossdef"><p>
         Scroll down one page.
         </p></dd><dt><span class="glossterm"><span class="command"><strong>/string</strong></span></span></dt><dd class="glossdef"><p>
         Search forward for string.
         </p></dd><dt><span class="glossterm"><span class="command"><strong>:f</strong></span></span></dt><dd class="glossdef"><p>
         Display filename and current line nmber.
         </p></dd><dt><span class="glossterm"><span class="command"><strong>:q</strong></span></span></dt><dd class="glossdef"><p>
           Quit editor.
         </p></dd><dt><span class="glossterm"><span class="command"><strong>:q!</strong></span></span></dt><dd class="glossdef"><p>
         Quit editor without saving changes.
         </p></dd><dt><span class="glossterm"><span class="command"><strong>:wq</strong></span></span></dt><dd class="glossdef"><p>
         Save changes and exit editor.
         </p></dd></dl></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Warning.gif" alt="Warning"></span>
</h3><p>
         Before proceeding to read the rest of this book, it should be noted that the text assumes that certain files are placed in certain directories. Where they have been specified, the conventions we adopt here for 
         locating these files are those of the Red Hat Linux distribution. If you are using a distribution of Linux or some other operating system that chooses to distribute these files in a different way, you should be 
         careful when copying examples directly from the text.
         </p></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="prt5ch2ssmt"></a>Chapter 14. Software -Security/Monitoring</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#prt5ch2s1Xd">1. sXid</a></span></dt><dt><span class="section"><a href="#idm7400">2. Configure and Optimize sXid</a></span></dt><dd><dl><dt><span class="section"><a href="#idm7427">2.1. Configure the <code class="filename">/etc/sxid.conf</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#pr5ch2sc3lc">3. Logcheck</a></span></dt><dt><span class="section"><a href="#idm7569">4. Configure and Optimize Logcheck</a></span></dt><dt><span class="section"><a href="#prt5ch2sc5PS">5. PortSentry</a></span></dt><dt><span class="section"><a href="#idm7748">6. Configure and Optimise Portsentry</a></span></dt><dt><span class="section"><a href="#idm7774">7. Test fire your PortSentry</a></span></dt></dl></div><div class="highlights"><p>
         At this part of our book, all software-listed on chapter 14 through chapter 32 are optional and depends on what you want to install or do on your server. e.g., What kind of tasks will your server do, and for 
         which part of your network Intranet/Internet? In other parts it may be important for you to replace the Telnet program with SSH for secure remote administration. Another interesting program is Tripwire that 
         aids system administrators and users in monitoring a designated set of files for any changes.
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prt5ch2s1Xd"></a>1. sXid</h2></div></div></div><p>
         <abbr class="abbrev">SUID/SGID</abbr> files can be a security hazard. To reduce the risks, we have previously already removed the <code class="literal">s</code> bits from root-owned programs that won't absolutely require such privilege, but future and existing 
         files may be set with these <code class="literal">s</code> bits enabled without your notification. 
         </p><p>
         sXid is an all in one <code class="literal">suid/sgid</code> monitoring program designed to be run from cron on a regular basis. Basically it tracks any changes in 
         your <code class="literal">s[ug]id</code> files and folders. If there are any new ones, ones that aren't set any more, or they have changed bits or other modes then it reports the changes in an easy to read format via email or on the 
         command line. sXid will automate the task to find all <abbr class="abbrev">SUID/SGID</abbr> on your server and report them to you. Once installed you can forget it and it will do the job for you.
         </p><p>
         These installation instructions assume the following:
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Commands are Unix-compatible.
         </p></li><li class="listitem"><p>
         The source path is <code class="filename">/var/tmp</code> other paths are possible.
         </p></li><li class="listitem"><p>
         Installations were tested on Red Hat Linux 6.1 and 6.2.
         </p></li><li class="listitem"><p>
         All steps in the installation will happen in super-user account <code class="literal">root</code>.
         </p></li><li class="listitem"><p>
         sXid version number as of this writing is <code class="literal">4.0.1</code> 
         </p></li></ul></div><p>
         Packages can be dowloaded from the sXid <acronym class="acronym">FTP</acronym> Site:<a class="link" href="#prtinxfp8" title="Chapter 14, Software -Security/Monitoring">ftp://marcus.seva.net/pub/sxid/</a> and You must be sure to download: sxid_4.0.1.tar.gz or whatever the latest version is.
         </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Warning.gif" alt="Warning"></span>
</h3><p>
         The instructions explained here in this book are applicable to the version number mentioned and you need to consult the <code class="filename">README</code> and/or <code class="filename">INSTALL</code> with in the tarball of the version you have downloaded for any changes, additions and deletions <abbr class="abbrev">etc.</abbr>. 
         </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
         It is a good idea to make a list of files on the system before you install sXid, and one afterwards, and then compare them using diff to find out what file it placed where. Simply run <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; sXid1</code></strong> before 
         and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; sXid2</code></strong> after you install the software, and use <strong class="userinput"><code>diff sXid1 sXid2 &gt; sXid-Installed</code></strong> to get a list of what changed.
         </p></div><p>        
         Decompress the tarball <code class="literal">tar.gz</code>.
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>cp</strong></span> sxid_version.tar.gz /var/tmp/
         [root@deep] /#<span class="command"><strong>cd</strong></span> /var/tmp
         [root@deep ] /tmp#<span class="command"><strong>tar</strong></span> xzpf sxid_version.tar.gz
         </pre><p>
         </p><p>
         To Compile and Optimize move into the new sXid directory and type the following commands on your terminal:
         </p><pre class="screen">
         [root@deep tmp]#<span class="command"><strong>cd</strong></span> sxid-4.0.1
         [root@deep ] /sxid-4.0.1#<span class="command"><strong>make install</strong></span>
         </pre><p>
         The above commands will configure the software to ensure your system has the necessary functionality and libraries to successfully compile the package, compile all source files into executable binaries, and then install the binaries and any 
         supporting files into the appropriate locations. Please do a cleanup later:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>cd</strong></span> /var/tmp
         [root@deep ] /tmp#<span class="command"><strong>rm</strong></span> -rf sxid-version/ sxid_version_tar.gz
         </pre><p>
         The <span class="command"><strong>rm</strong></span> command as used above will remove all the source files we have used to compile and install sXid. It will also remove the sXid compressed archive from the <code class="filename">/var/tmp</code> directory.

         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm7400"></a>2. Configure and Optimize sXid</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
             You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
             for respective software. For example <em class="wordasword">sXid</em> configuration file are organised like this:
             </p><pre class="literallayout"><code class="computeroutput">
               total 4
               -rw-r--r--    1 harrypotter    harrypotter        1586 Jun  8 13:00 sxid.conf
             </code></pre><p>
             You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
             responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
           </p></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
         To run sXid, the following file from the floppy.tgz archive is required and must be created or copied to the appropriate directory on your server. Copy the sxid.conf file to the <code class="filename">/etc/</code> directory.
         or alternatively you can copy and paste directly from this book to the concerned file.
         </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm7427"></a>2.1. Configure the <code class="filename">/etc/sxid.conf</code> file</h3></div></div></div><p>
         The configuration file for sXid <code class="filename">/etc/sxid.conf</code> allows you to set options that modify the operation of the program. It is well commented and very basic.
         </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
         Edit the sxid.conf file <span class="command"><strong>vi</strong></span> <code class="filename">/etc/sxid.conf</code> and set your needs:
         </p><pre class="programlisting">
         # Configuration file for sXid
         # Note that all directories must be absolute with no trailing /'s

         # Where to begin our file search
         SEARCH = "/"

         # Which subdirectories to exclude from searching
         EXCLUDE = "/proc /mnt /cdrom /floppy"

         # Who to send reports to
         EMAIL = "root"

         # Always send reports, even when there are no changes?
         ALWAYS_NOTIFY = "no"

         # Where to keep interim logs. This will rotate 'x' number of
         # times based on KEEP_LOGS below
         LOG_FILE = "/var/log/sxid.log"

         # How many logs to keep
         KEEP_LOGS = "5"

         # Rotate the logs even when there are no changes?
         ALWAYS_ROTATE = "no"

         # Directories where +s is forbidden (these are searched
         # even if not explicitly in SEARCH), EXCLUDE rules apply
         FORBIDDEN = "/home /tmp"

         # Remove (-s) files found in forbidden directories?
         ENFORCE = "yes"

         # This implies ALWAYS_NOTIFY. It will send a full list of
         # entries along with the changes
         LISTALL = "no"

         # Ignore entries for directories in these paths
         # (this means that only files will be recorded, you
         # can effectively ignore all directory entries by
         # setting this to "/"). The default is /home since
         # some systems have /home g+s.
         IGNORE_DIRS = "/home"

         # File that contains a list of (each on it's own line)
         # of other files that sxid should monitor. This is useful
         # for files that aren't +s, but relate to system
         # integrity (tcpd, inetd, apache...).
         # EXTRA_LIST = "/etc/sxid.list"

         # Mail program. This changes the default compiled in
         # mailer for reports. You only need this if you have changed
         # it's location and don't want to recompile sxid.
         # MAIL_PROG = "/usr/bin/mail"
         </pre><p>
         </p></li><li class="step"><p>
         Place an entry into root's crontabs to make sXid run as a cronjob. sXid will run from crond; basically it tracks any changes in your <code class="literal">s[ug]id</code> files and folders. If there are any new 
         ones, ones that aren't set any more, or they have changed bits or other modes then it reports the changes. To add sxid in your cronjob you must edit the crontab and add the following line:
         To edit the crontab, use the command <span class="emphasis"><em>as root</em></span>:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>crontab</strong></span> -e
         </pre><p>
         </p><pre class="programlisting">
         # Sample crontab entry to run every day at 4am
         0 4 * * * /usr/bin/sxid
         </pre><p>
         </p></li></ol></div><p>
         Further documentation for more details, there are some man pages you can read <span class="citerefentry"><span class="refentrytitle">sxid.conf</span>(5)</span> -<span class="emphasis"><em>configuration settings for sxid</em></span> 
         and  <span class="citerefentry"><span class="refentrytitle">sxid</span>(1)</span> - <span class="emphasis"><em>check for changes in s[ug]id files and directories</em></span>
         </p><p>
         sXid as administrative tool is meant to run as a cronjob. It must run once a day, but busy shell boxes may want to run it twice a day. You can also run this manually for spot-checking.
         To run sxid manually, use the command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>sxid</strong></span> -k
         </pre><p>
         </p><div class="literallayout"><p><code class="computeroutput"><br>
         sXid Vers  : 4.0.1<br>
         Check run  : Wed Dec 29 12:40:32 1999<br>
         This host  : mail.openna.com<br>
         Spotcheck  : /home/admin<br>
         Excluding  : /proc /mnt /cdrom /floppy<br>
         Ignore Dirs: /home<br>
         Forbidden  : /home /tmp<br>
         <br>
         </code></p></div><p>

         <span class="emphasis"><em>No changes found!</em></span>
         
         This checks for changes by recursing the current working directory. Log files will not be rotated 
         and no email sent. All output will go to stdout.
         </p><p>
         These are the Installed files on your system by the program sXid.
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">
         /etc/sxid.conf
         </code>
         </td></tr><tr><td>
         <code class="filename">
         /usr/bin/sxid
         </code>
         </td></tr><tr><td>
         <code class="filename">
         /usr/man/man1/sxid.1
         </code>
         </td></tr><tr><td>
         <code class="filename">
         /usr/man/man5/sxid.conf.5
         </code>
         </td></tr></table><p>
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr5ch2sc3lc"></a>3. Logcheck</h2></div></div></div><p>
           One important task in the security world is to regularly check the log files. Often the daily activities of an administrator don't allow him the time to do this task and this can bring about  problems.
           </p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Extracted from [<span class="citation">Logcheck abstract</span>]:</b></p></div></div></div><p>
           Auditing and logging system events is important! What is more important is that system administrators be aware of these events so they can prevent problems that will inevitably occur if you have a system 
           connected to the Internet. Unfortunately for most Unices it doesn't matter how much you log activity if nobody ever checks the logs, which is often the case. This is where logcheck will help. Logcheck automates 
           the auditing process and weeds out <span class="emphasis"><em>normal</em></span> log information to give you a condensed look at problems and potential troublemakers mailed to wherever you please. Logcheck is a software package 
           that is designed to automatically run and check system log files for security violations and unusual activity. Logcheck utilizes a program called logtail that remembers the last position it read from in a log 
           file and uses this position on subsequent runs to process new information.
           </p></div><p>
           These installation instructions assume
           </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           Commands are Unix-compatible.
           </p></li><li class="listitem"><p>
           The source path is <code class="filename">/var/tmp</code> <span class="emphasis"><em>other paths are possible</em></span>.
           </p></li><li class="listitem"><p>
           Installations were tested on Red Hat Linux 6.1 and 6.2.
           </p></li><li class="listitem"><p>
           All steps in the installation will happen in super-user account root.
           </p></li><li class="listitem"><p>
           Logcheck version number is <code class="literal">1.1.1</code>
           </p></li></ul></div><p>
           </p><p>
           These are the packages available at Logcheck Homepage Site: <a class="link" href="#prtinxfp8" title="Chapter 14, Software -Security/Monitoring">http://www.psionic.com/abacus/logcheck/</a>,
           and you must be sure to download: logcheck-1.1.1.tar.gz available as of this writing.
           </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
           Please do not forget to read the <code class="filename">README</code> and/or <code class="filename">INSTALL</code> with in the tarball you have downloaded if the version number is not the same as we have suggested and follow the instructions
           since there are chances of some changes either bythe way of additions or deletions are likely to be there.
           </p></div><p>
           Before you uncompress and install from the tarballs it is a good idea to make a list of files on the system before you install Logcheck, and one afterwards, and then compare them using diff to find out what files 
           were placed where. Simply run <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Logcheck1</code></strong> before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Logcheck2</code></strong> after you install the software, and 
           use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>Logcheck1 Logcheck2 &gt; Logcheck-Installed</code></strong> to get a list of what changed.
           </p><p>
           To compile, you need to decompress the tarball (tar.gz).
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>cp</strong></span> logcheck-version.tar.gz /var/tmp/
           [root@deep] /#<span class="command"><strong>cd</strong></span> /var/tmp
           [root@deep ]/tmp#<span class="command"><strong>tar</strong></span> xzpf logcheck-version.tar.gz
           </pre><p>
           </p><p>
           To Compile and Optimize you must modify the <code class="filename">Makefile</code> file of Logcheck to specify installation paths, compilation flags, and optimizations for your system. We must modify this file to be compliant with Red Hat's file 
           system structure and install Logcheck script files under our <code class="envar">PATH</code> Environment variable.
           </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
           Move into the new Logcheck directory and edit the <code class="filename">Makefile</code>, <span class="command"><strong>vi</strong></span> <code class="filename">Makefile</code> and change the following lines by type the following commands on your terminal:
           </p><ol type="a" class="substeps"><li class="step"><p>
           </p><pre class="programlisting">
           CC = cc
           </pre><p>
            To read:
           </p><pre class="programlisting">
           CC = egcs
           </pre><p>
           </p></li><li class="step"><p>
           </p><pre class="programlisting">
           CFLAGS = -O
           </pre><p>
           To read:
           </p><pre class="programlisting">             
           CFLAGS = -O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions
           </pre><p>
           </p></li><li class="step"><p>
           </p><pre class="programlisting">
           INSTALLDIR = /usr/local/etc
           </pre><p>
           To read:
           </p><pre class="programlisting">
           INSTALLDIR = /etc/logcheck
           </pre><p>
           </p></li><li class="step"><p>
           </p><pre class="programlisting">
           INSTALLDIR_BIN = /usr/local/bin
           </pre><p>
           To read:
           </p><pre class="programlisting">
           INSTALLDIR_BIN = /usr/bin
           </pre><p>
           </p></li><li class="step"><p>
           </p><pre class="programlisting">
           INSTALLDIR_SH = /usr/local/etc
           </pre><p>
           To read:
           </p><pre class="programlisting">
           INSTALLDIR_SH = /usr/bin
           </pre><p>
           </p></li><li class="step"><p>
           </p><pre class="programlisting">
           TMPDIR = /usr/local/etc/tmp
           </pre><p>
           To read:
           </p><pre class="programlisting">
           TMPDIR = /etc/logcheck/tmp
           </pre><p>
           </p></li><li class="step"><p>
           The above changes will configure the software to use <span class="application">egcs</span> compiler, optimization flags specific to our system, and locate all files related to Logcheck software to 
           the destination target directories we have chosen to be compliant with the Red Hat file system structure.
           </p></li></ol></li><li class="step"><p>
           
           Edit the Makefile file <span class="command"><strong>vi</strong></span> +67 <code class="filename">Makefile</code> and change the following line:
           </p><pre class="programlisting">
           @if [ ! -d $(TMPDIR) ]; then /bin/mkdir $(TMPDIR); fi
           </pre><p>
           To read:
           </p><pre class="programlisting">
           @if [ ! -d $(TMPDIR) ]; then /bin/mkdir -p $(TMPDIR); fi
           </pre><p>
           The above change  -p will allow the installation program to create parent directories as needed.
           </p></li><li class="step"><p>
           
           Install Logcheck on your system.
           </p><pre class="screen">
           [root@deep ]/logcheck-1.1.1#<span class="command"><strong>make</strong></span> linux
           </pre><p>
           The above command will configure the software for the Linux operating system, compile all source files into executable binaries, and then install the binaries and any supporting 
           files into the appropriate locations. Please don't forget to cleanup later:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>cd</strong></span> /var/tmp
           [root@deep ]/tmp#<span class="command"><strong>rm</strong></span> -rf logcheck-version/ logcheck-version_tar.gz
           </pre><p>
           The <span class="command"><strong>rm</strong></span> command as used above will remove all the source files we have used to compile and install Logcheck. It will also remove the Logcheck compressed archive from 
           the <code class="filename">/var/tmp</code> directory.
           </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm7569"></a>4. Configure and Optimize Logcheck</h2></div></div></div><p>
         You need to configure the <code class="filename">/usr/bin/logcheck.sh</code> script file, Since we are using an alternate path for the files <abbr class="abbrev">i.e.</abbr> <span class="emphasis"><em>not</em></span> <code class="filename">/usr/local/etc</code>, we need to change the path 
         entries for <code class="filename">logcheck.hacking</code>, <code class="filename">logcheck.violations</code>, <code class="filename">logcheck.ignore</code>, <code class="filename">logcheck.violations.ignore</code>, and <code class="filename">logtail</code> in the main <code class="filename">logcheck.sh</code> 
         script. The script file for Logcheck <code class="filename">/usr/bin/logcheck.sh</code> allows you to set these options that modify the path entries and operation of the program. It is well commented and very basic.
         </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
         Edit the logcheck.sh file <span class="command"><strong>vi</strong></span> <code class="filename">/usr/bin/logcheck.sh</code> and change the following:
         </p><ol type="a" class="substeps"><li class="step"><p>
           </p><pre class="programlisting">
         LOGTAIL=/usr/local/bin/logtail
         </pre><p>
         To read:
         </p><pre class="programlisting">
         LOGTAIL=/usr/bin/logtail
         </pre><p>
         </p></li><li class="step"><p>
           </p><pre class="programlisting">
         TMPDIR=/usr/local/etc/tmp
         </pre><p>
         To read:
         </p><pre class="programlisting">
         TMPDIR=/etc/logcheck/tmp
         </pre><p>
         </p></li><li class="step"><p>
           </p><pre class="programlisting">
         HACKING_FILE=/usr/local/etc/logcheck.hacking
         </pre><p>
         To read:
         </p><pre class="programlisting">
         HACKING_FILE=/etc/logcheck/logcheck.hacking
         </pre><p>
         </p></li><li class="step"><p>
         </p><pre class="programlisting">
         VIOLATIONS_FILE=/usr/local/etc/logcheck.violations
         </pre><p>
         To read:
         </p><pre class="programlisting">
         VIOLATIONS_FILE=/etc/logcheck/logcheck.violations
         </pre><p>
         </p></li><li class="step"><p>
           </p><pre class="programlisting">
         VIOLATIONS_IGNORE_FILE=/usr/local/etc/logcheck.violations.ignore
         </pre><p>
         To read:
         </p><pre class="programlisting">
         VIOLATIONS_IGNORE_FILE=/etc/logcheck/logcheck.violations.ignore
         </pre><p>
         </p></li><li class="step"><p>
         </p><pre class="programlisting">
         IGNORE_FILE=/usr/local/etc/logcheck.ignore
         </pre><p>
         To read:
         </p><pre class="programlisting">
         IGNORE_FILE=/etc/logcheck/logcheck.ignore
         </pre><p>
         </p></li></ol></li><li class="step"><p>
         
         After installing Logcheck, place an entry into root's crontabs to make Logcheck run as a cronjob, you should edit your local crontab file for root and set Logcheck to run once per hour recommended, although you 
         can do it more frequently, or less frequently. To add Logcheck in your cronjob you must edit the crontab and add the following line as root:
         
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>crontab</strong></span> -e
         </pre><p>
         </p><pre class="programlisting">
         # Hourly check Log files for security violations and unusual activity.
         00 * * * * /usr/bin/logcheck.sh
         </pre><p>
         </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         Remember, Logcheck does not report anything via email if it has nothing useful to say.
         </p></div><p>
         These are the files Installed by the program Logcheck on your sytem, for your future referance.
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">
          /etc/logcheck
          </code></td><td><code class="filename">
          /usr/bin/logcheck.sh
          </code></td></tr><tr><td><code class="filename">
          /etc/logcheck/tmp
          </code></td><td><code class="filename">
          /usr/bin/logtail
          </code></td></tr><tr><td><code class="filename">
          /etc/logcheck/logcheck.hacking
          </code></td><td><code class="filename">
          /var/log/messages.offset
          </code></td></tr><tr><td><code class="filename">
          /etc/logcheck/logcheck.violations
          </code></td><td><code class="filename">
          /var/log/secure.offset
          </code></td></tr><tr><td><code class="filename">
          /etc/logcheck/logcheck.violations.ignore
          </code></td><td><code class="filename">
          /var/log/maillog.offset
          </code></td></tr><tr><td><code class="filename">
          /etc/logcheck/logcheck.ignore
          </code></td><td> </td></tr></table><p>
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prt5ch2sc5PS"></a>5. PortSentry</h2></div></div></div><p>
         Firewalls help us to protect our network from unsolicited intrusions. Using them we can choose which ports we want to be open and which one's we dont. Information is kept private by your organization and responsibility of individuals asociated. 
         Nobody from the outside implicitly knows this information, but attackers know as well as spammers, that for some kind of attacks you can use a special program to scan all the ports on a server to glean this valuable information <abbr class="abbrev">i.e.</abbr> what is open and what is not.
         </p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>From the [<span class="citation">PortSentry introduction</span>]:</b></p></div></div></div><p>
         A port scan is a symptom of a larger problem coming your way. It is often the pre-cursor for an attack and is a critical piece of information for properly defending your information resources. PortSentry is a program designed 
         to detect and respond to port scans against a target host in real-time and has a number of options to detect port scans. When it finds one it can react in the following ways:
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         A log indicating the incident is made via syslog().
         </td></tr><tr><td>
         The target host is automatically dropped into <code class="filename">/etc/hosts.deny</code> for <acronym class="acronym">TCP</acronym> Wrappers.
         </td></tr><tr><td>
         The local host is automatically re-configured to route all traffic to the target to a dead host to make the target system disappear.
         </td></tr><tr><td>
         The local host is automatically re-configured to drop all packets from the target via a local packet filter.
         </td></tr><tr><td>
         The purpose of this is to give an admin a heads up that their host is being probed.
         </td></tr></table><p>
         </p></div><p>
         These installation instructions assume:
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Commands are Unix-compatible.
         </p></li><li class="listitem"><p>
         The source path is <code class="filename">/var/tmp</code> <span class="emphasis"><em>other paths are possible</em></span>.
         </p></li><li class="listitem"><p>
         Installations were tested on Red Hat Linux 6.1 and 6.2.
         </p></li><li class="listitem"><p>
         All steps in the installation will happen in super-user account root.
         </p></li><li class="listitem"><p>
         Portsentry version number is <code class="literal">1.0</code>
         </p></li></ul></div><p>
         </p><p>
         These are the Package(s) you have to download and Portsentry Homepage:<a class="link" href="#prtinxfp10" title="PortSentry">http://www.psionic.com/abacus/portsentry/</a>
         You must be sure to download: portsentry-1.0.tar.gz
         </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
         Please do not forget to read the <code class="filename">README</code> and/or <code class="filename">INSTALL</code> with in the tarball you have downloaded if the version number is not the same as we have suggested and follow the instructions
         since there are chances of some changes either by the way of additions or deletions are likely to be there.         
         </p></div><p>
         When you install from Tarball(s), it is always better to make a list of files on the system before you install Portsentry, and one afterwards, and then compare them using diff to find out what file is placed 
         where.A Simple step <strong class="userinput"><code><span class="command"><strong>find</strong></span> /* &gt; Portsentry1</code></strong> before and <strong class="userinput"><code><span class="command"><strong>find</strong></span> /* &gt; Portsentry2</code></strong> after you install the software, and 
         use <strong class="userinput"><code><span class="command"><strong>diff</strong></span> Portsentry1 Portsentry2 &gt; PortSentry-Installed</code></strong> to get a list of what changed.
         </p><p>
         You need to Compile so Decompress the tarball <code class="literal">*.tar.gz</code>.
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>cp</strong></span> portsentry-version.tar.gz /var/tmp/
         [root@deep] /#<span class="command"><strong>cd</strong></span> /var/tmp
         [root@deep ]/tmp#<span class="command"><strong>tar</strong></span> xzpf portsentry-version.tar.gz
         </pre><p>
         </p><div class="procedure"><a name="idm7706"></a><p class="title"><b>Procedure 14.1. Optimize to compile</b></p><ol class="procedure" type="1"><li class="step"><p>
         You must modify the <code class="filename">Makefile</code> file for Portsentry to specify installation paths, compilation flags, and optimizations for your system. We must also modify this file to be compliant with Red Hat file's system structure.
         Move into the new Portsentry directory and with the following commands on your terminal edit the <code class="filename">Makefile</code> file <span class="command"><strong>vi</strong></span> <code class="filename">Makefile</code> and change the following lines:
         </p><ol type="a" class="substeps"><li class="step"><p>
             </p><pre class="programlisting">
         CC = cc         
         </pre><p>
         To read:
         </p><pre class="programlisting">
         CC = egcs
         </pre><p>
         </p></li><li class="step"><p>
           </p><pre class="programlisting">
         CFLAGS = -O -Wall
         </pre><p>
         
         To read:
         </p><pre class="programlisting">
         CFLAGS = -O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions -Wall
         </pre><p>
         </p></li><li class="step"><p>
           </p><pre class="programlisting">
         INSTALLDIR = /usr/local/psionic
         </pre><p>
         To read:
         </p><pre class="programlisting">
         INSTALLDIR = /usr/psionic
         </pre><p>
         </p></li><li class="step"><p>
         The above changes will configure the software to use egcs compiler, optimization flags specific to our system, and locate all files related to Portsentry software to the target directories we have chosen.
         </p></li></ol></li><li class="step"><p>
         Since we are using an alternate path for the files <abbr class="abbrev">i.e.</abbr> <span class="emphasis"><em>not</em></span> <code class="filename">/usr/local/psionic</code>, we need to change the path to the PortSentry configuration file in the main portsentry_config.h header file. Move into the new 
         PortSentry directory and edit the portsentry_config.h file <span class="command"><strong>vi</strong></span> <code class="filename">portsentry_config.h</code> and change the following line:
         </p><pre class="programlisting">
         #define CONFIG_FILE "/usr/local/psionic/portsentry/portsentry.conf"
         </pre><p>
         To read:
         </p><pre class="programlisting">
         #define CONFIG_FILE "/usr/psionic/portsentry/portsentry.conf"
         </pre><p>
         </p></li><li class="step"><p>
         Step 3
         Install Portsentry on your system.
         </p><pre class="screen">
         [root@deep ]/portsentry-1.0#<span class="command"><strong>make</strong></span> linux
         [root@deep ]/portsentry-1.0#<span class="command"><strong>make install</strong></span>
         </pre><p>
         The above commands will configure the software to the Linux operating system, compile, build, and then finally install files into the appropriate locations.
         </p></li></ol></div><p>
         Please do a cleanup later:
         </p><pre class="screen">
         [root@deep] /# cd /var/tmp
         [root@deep ]/tmp#<span class="command"><strong>rm</strong></span> -rf portsentry-version/ portsentry-version_tar.gz
         </pre><p>
         The <span class="command"><strong>rm</strong></span> command will remove all the source files we have used to compile and install PortSentry. It will also remove the PortSentry compressed archive from the <code class="filename">/var/tmp</code> directory.
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm7748"></a>6. Configure and Optimise Portsentry</h2></div></div></div><p>
         You have to configure the the <code class="filename">/usr/psionic/portsentry/portsentry.conf</code> file which is the main configuration file for the PortSentry Software; you can specify which ports you want to listen 
         to, which <acronym class="acronym">IP</acronym> addresses are denied, monitor, ignore, disable automatic responses, and so on. For more information read the <code class="filename">README.install</code> file under the PortSentry source directory.
         Edit the <code class="filename">portsentry.conf file</code>, <span class="command"><strong>vi</strong></span> <code class="filename">/usr/psionic/portsentry.conf</code> and check/change the following options to fit your needs:
         </p><pre class="programlisting">
         # PortSentry Configuration
         #
         # $Id$
         #
         # IMPORTANT NOTE: You CAN NOT put spaces between your port arguments.
         # 
         # The default ports will catch a large number of common probes
         #
         # All entries must be in quotes.


         #######################
         # Port Configurations #
         #######################
         #
         #
         # Some example port configs for classic and basic Stealth modes
         #
         # I like to always keep some ports at the "low" end of the spectrum.
         # This will detect a sequential port sweep really quickly and usually
         # these ports are not in use (i.e. tcpmux port 1)
         #
         # ** X-Windows Users **: If you are running X on your box, you need to be sure
         # you are not binding PortSentry to port 6000 (or port 2000 for OpenWindows users). 
         # Doing so will prevent the X-client from starting properly. 
         #
         # These port bindings are *ignored* for Advanced Stealth Scan Detection Mode.
         #

         # Un-comment these if you are really anal:
         #TCP_PORTS="1,7,9,11,15,70,79,80,109,110,111,119,138,139,143,512,513,514,515,540,635,1080,1524,2000,2001,4000,4001,5742,6000,6001,6667,12345,12346,20034,30303,32771,32772,32773,32774,31337,40421,40425,49724,54320"
         #UDP_PORTS="1,7,9,66,67,68,69,111,137,138,161,162,474,513,517,518,635,640,641,666,700,2049,32770,32771,32772,32773,32774,31337,54321"
         #
         # Use these if you just want to be aware:
         TCP_PORTS="1,11,15,79,111,119,143,540,635,1080,1524,2000,5742,6667,12345,12346,20034,31337,32771,32772,32773,32774,40421,49724,54320"
         UDP_PORTS="1,7,9,69,161,162,513,635,640,641,700,32770,32771,32772,32773,32774,31337,54321"
         #
         # Use these for just bare-bones
         #TCP_PORTS="1,11,15,110,111,143,540,635,1080,524,2000,12345,12346,20034,32771,32772,32773,32774,49724,54320"
         #UDP_PORTS="1,7,9,69,161,162,513,640,700,32770,32771,32772,32773,32774,31337,54321"

         ###########################################
         # Advanced Stealth Scan Detection Options #
         ###########################################
         #
         # This is the number of ports you want PortSentry to monitor in Advanced mode.
         # Any port *below* this number will be monitored. Right now it watches 
         # everything below 1023. 
         # 
         # On many Linux systems you cannot bind above port 61000. This is because
         # these ports are used as part of IP masquerading. I don't recommend you
         # bind over this number of ports. Realistically: I DON'T RECOMMEND YOU MONITOR 
         # OVER 1023 PORTS AS YOUR FALSE ALARM RATE WILL ALMOST CERTAINLY RISE. You've been
         # warned! Don't write me if you have have a problem because I'll only tell
         # you to RTFM and don't run above the first 1023 ports.
         #
         #
         ADVANCED_PORTS_TCP="1023"
         ADVANCED_PORTS_UDP="1023"
         #
         # This field tells PortSentry what ports (besides listening daemons) to
         # ignore. This is helpful for services like ident that services such 
         # as FTP, SMTP, and wrappers look for but you may not run (and probably 
         # *shouldn't* IMHO). 
         #
         # By specifying ports here PortSentry will simply not respond to
         # incoming requests, in effect PortSentry treats them as if they are
         # actual bound daemons. The default ports are ones reported as 
         # problematic false alarms and should probably be left alone for
         # all but the most isolated systems/networks.
         #
         # Default TCP ident and NetBIOS service
         ADVANCED_EXCLUDE_TCP="113,139"
         # Default UDP route (RIP), NetBIOS, bootp broadcasts.
         ADVANCED_EXCLUDE_UDP="520,138,137,67"


         ######################
         # Configuration Files#
         ######################
         #
         # Hosts to ignore
         IGNORE_FILE="/usr/psionic/portsentry/portsentry.ignore"
         # Hosts that have been denied (running history)
         HISTORY_FILE="/usr/psionic/portsentry/portsentry.history"
         # Hosts that have been denied this session only (temporary until next restart)
         BLOCKED_FILE="/usr/psionic/portsentry/portsentry.blocked"

         ###################
         # Response Options#
         ###################
         # Options to dispose of attacker. Each is an action that will 
         # be run if an attack is detected. If you don't want a particular
         # option then comment it out and it will be skipped.
         #
         # The variable $TARGET$ will be substituted with the target attacking
         # host when an attack is detected. The variable $PORT$ will be substituted
         # with the port that was scanned. 
         #
         ##################
         # Ignore Options #
         ##################
         # These options allow you to enable automatic response
         # options for UDP/TCP. This is useful if you just want
         # warnings for connections, but don't want to react for  
         # a particular protocol (i.e. you want to block TCP, but
         # not UDP). To prevent a possible Denial of service attack
         # against UDP and stealth scan detection for TCP, you may 
         # want to disable blocking, but leave the warning enabled. 
         # I personally would wait for this to become a problem before
         # doing though as most attackers really aren't doing this.
         # The third option allows you to run just the external command
         # in case of a scan to have a pager script or such execute
         # but not drop the route. This may be useful for some admins
         # who want to block TCP, but only want pager/e-mail warnings
         # on UDP, etc.
         #
         # 
         # 0 = Do not block UDP/TCP scans.
         # 1 = Block UDP/TCP scans.
         # 2 = Run external command only (KILL_RUN_CMD)

         BLOCK_UDP="1"
         BLOCK_TCP="1"

         ###################
         # Dropping Routes:#
         ###################
         # This command is used to drop the route or add the host into
         # a local filter table. 
         #
         # The gateway (333.444.555.666) should ideally be a dead host on 
         # the *local* subnet. On some hosts you can also point this at
         # localhost (127.0.0.1) and get the same effect. NOTE THAT
         # 333.444.555.66 WILL *NOT* WORK. YOU NEED TO CHANGE IT!!
         #
         # All KILL ROUTE OPTIONS ARE COMMENTED OUT INITIALLY. Make sure you
         # uncomment the correct line for your OS. If you OS is not listed
         # here and you have a route drop command that works then please
         # mail it to me so I can include it. ONLY ONE KILL_ROUTE OPTION
         # CAN BE USED AT A TIME SO DON'T UNCOMMENT MULTIPLE LINES.
         #
         # NOTE: The route commands are the least optimal way of blocking
         # and do not provide complete protection against UDP attacks and
         # will still generate alarms for both UDP and stealth scans. I
         # always recommend you use a packet filter because they are made
         # for this purpose.
         #

         # Generic 
         #KILL_ROUTE="/sbin/route add $TARGET$ 333.444.555.666"

         # Generic Linux 
         #KILL_ROUTE="/sbin/route add -host $TARGET$ gw 333.444.555.666"

         # Newer versions of Linux support the reject flag now. This 
         # is cleaner than the above option.
         KILL_ROUTE="/sbin/route add -host $TARGET$ reject"

         # Generic BSD (BSDI, OpenBSD, NetBSD, FreeBSD)
         #KILL_ROUTE="/sbin/route add $TARGET$ 333.444.555.666"

         # Generic Sun 
         #KILL_ROUTE="/usr/sbin/route add $TARGET$ 333.444.555.666 1"

         # NEXTSTEP
         #KILL_ROUTE="/usr/etc/route add $TARGET$ 127.0.0.1 1"

         # FreeBSD (Not well tested.)
         #KILL_ROUTE="route add -net $TARGET$ -netmask 255.255.255.255 127.0.0.1 -blackhole"

         # Digital UNIX 4.0D (OSF/1 / Compaq Tru64 UNIX)
         #KILL_ROUTE="/sbin/route add -host -blackhole $TARGET$ 127.0.0.1"

         # Generic HP-UX
         #KILL_ROUTE="/usr/sbin/route add net $TARGET$ netmask 255.255.255.0 127.0.0.1"

         ##
         # Using a packet filter is the preferred method. The below lines
         # work well on many OS's. Remember, you can only uncomment *one*
         # KILL_ROUTE option.
         ##

         ###############
         # TCP Wrappers#
         ###############
         # This text will be dropped into the hosts.deny file for wrappers
         # to use. There are two formats for TCP wrappers:
         #
         # Format One: Old Style - The default when extended host processing
         # options are not enabled.
         #
         KILL_HOSTS_DENY="ALL: $TARGET$"
         #
         # Format Two: New Style - The format used when extended option
         # processing is enabled. You can drop in extended processing
         # options, but be sure you escape all '%' symbols with a backslash
         # to prevent problems writing out (i.e. \%c \%h )
         #
         #KILL_HOSTS_DENY="ALL: $TARGET$ : DENY"

         ###################
         # External Command#
         ###################
         # This is a command that is run when a host connects, it can be whatever
         # you want it to be (pager, etc.). This command is executed before the 
         # route is dropped. I NEVER RECOMMEND YOU PUT IN RETALIATORY ACTIONS
         # AGAINST THE HOST SCANNING YOU. TCP/IP is an *unauthenticated protocol*
         # and people can make scans appear out of thin air. The only time it
         # is reasonably safe (and I *never* think it is reasonable) to run
         # reverse probe scripts is when using the "classic" -tcp mode. This
         # mode requires a full connect and is very hard to spoof.
         #
         #KILL_RUN_CMD="/some/path/here/script $TARGET$ $PORT$"


         #####################
         # Scan trigger value#
         #####################
         # Enter in the number of port connects you will allow before an 
         # alarm is given. The default is 0 which will react immediately.
         # A value of 1 or 2 will reduce false alarms. Anything higher is 
         # probably not necessary. This value must always be specified, but
         # generally can be left at 0. 
         #
         # NOTE: If you are using the advanced detection option you need to
         # be careful that you don't make a hair trigger situation. Because
         # Advanced mode will react for *any* host connecting to a non-used
         # below your specified range, you have the opportunity to really 
         # break things. (i.e someone innocently tries to connect to you via 
         # SSL [TCP port 443] and you immediately block them). Some of you
         # may even want this though. Just be careful.
         #

         SCAN_TRIGGER="0"

         ######################
         # Port Banner Section#
         ######################
         #
         # Enter text in here you want displayed to a person tripping the PortSentry.
         # I *don't* recommend taunting the person as this will aggravate them.
         # Leave this commented out to disable the feature
         #
         # Stealth scan detection modes don't use this feature
         #
         PORT_BANNER="** UNAUTHORIZED ACCESS PROHIBITED *** YOUR CONNECTION ATTEMPT HAS BEEN LOGGED. GO AWAY."

         # EOF
         </pre><p>
         Now, we must check/change its default permission for security reasons:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>chmod</strong></span> 600 /usr/psionic/portsentry/portsentry.conf
         </pre><p>
         </p><p>
         You need to configure the <code class="filename">/usr/psionic/portsentry/portsentry.ignore</code> file, where you add in any host you want to have ignored if it connects to a tripwired port. This should always contain at least the 
         localhost <code class="literal">127.0.0.1</code> and the <acronym class="acronym">IP</acronym>'s of the local interfaces <code class="literal">lo</code>. It is not recommend that you put in every <acronym class="acronym">IP</acronym> on your network.

         Edit the <code class="filename">portsentry.ignore file</code>, <span class="command"><strong>vi</strong></span> <code class="filename">/usr/psionic/portsentry.ignore</code> and add in any host you want to have ignored if it connects to a tripwired port:
         </p><pre class="programlisting">
         # Put hosts in here you never want blocked. This includes the IP addresses
         # of all local interfaces on the protected host (i.e virtual host, mult-home)
         # Keep 127.0.0.1 and 0.0.0.0 to keep people from playing games.

         127.0.0.1
         0.0.0.0
         </pre><p>
         Now, we must check/change its default permission for security reasons:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>chmod</strong></span> 600 /usr/psionic/portsentry/portsentry.ignore
         </pre><p>
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm7774"></a>7. Test fire your PortSentry</h2></div></div></div><p>
         The PortSentry program can be configured in six different modes of operation, but be aware that only one protocol mode type can be started at a time. To be more accurate, you can start one <acronym class="acronym">TCP</acronym> mode and one <acronym class="acronym">UDP</acronym> mode, so 
         two <acronym class="acronym">TCP</acronym> modes and one <acronym class="acronym">UDP</acronym> modes, for example, doesn't work. The available modes are:
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <span class="command"><strong>portsentry</strong></span> -tcp</span></dt><dd><p>
         basic port-bound <acronym class="acronym">TCP</acronym> mode
         </p></dd><dt><span class="term">
         <span class="command"><strong>portsentry</strong></span> -udp</span></dt><dd><p>
         basic port-bound <acronym class="acronym">UDP</acronym> mode
         </p></dd><dt><span class="term">
         <span class="command"><strong>portsentry</strong></span> -stcp</span></dt><dd><p>
         Stealth <acronym class="acronym">TCP</acronym> scan detection
         </p></dd><dt><span class="term">
         <span class="command"><strong>portsentry</strong></span> -atcp</span></dt><dd><p>
         Advanced <acronym class="acronym">TCP</acronym> stealth scan detection
         </p></dd><dt><span class="term">
         <span class="command"><strong>portsentry</strong></span> -sudp</span></dt><dd><p>
         Stealth <acronym class="acronym">UDP</acronym> scan detection
         </p></dd><dt><span class="term">
         <span class="command"><strong>portsentry</strong></span> -audp</span></dt><dd><p>
         Advanced Stealth <acronym class="acronym">UDP</acronym> scan detection
         </p></dd></dl></div><p>
         </p><p>
         In my case I prefer to start <acronym class="acronym">TCP</acronym> in Advanced <acronym class="acronym">TCP</acronym> stealth scan detection protocol mode and <acronym class="acronym">UDP</acronym> in Stealth <acronym class="acronym">UDP</acronym> scan detection protocol 
         mode. For information about the other protocol modes, please refer to the <code class="filename">README.install</code> and <code class="filename">README.stealth</code> file under the PortSentry source directory.
         For <acronym class="acronym">TCP</acronym> mode I choose:
         </p><div class="glosslist"><dl><dt><span class="glossterm">
          -atcp
         </span></dt><dd class="glossdef"><p>
         Advanced <acronym class="acronym">TCP</acronym> stealth scan detection mode
         </p></dd></dl></div><p>
         With the Advanced <acronym class="acronym">TCP</acronym> stealth scan detection mode  -atcp protocol mode type, PortSentry will first check to see what ports you have running on your server, then remove 
         these ports from monitoring and will begin watching the remaining ports. This is very powerful and reacts exceedingly quickly for port scanners. It also uses very little <acronym class="acronym">CPU</acronym> time.
         </p><p>
         For <acronym class="acronym">UDP</acronym> mode I choose:
         </p><div class="glosslist"><dl><dt><span class="glossterm">
          -sudp
         </span></dt><dd class="glossdef"><p>
         Stealth <acronym class="acronym">UDP</acronym> scan detection mode
         </p></dd></dl></div><p>
         With the Stealth <acronym class="acronym">UDP</acronym> scan detection mode  -sudp protocol mode type, the <acronym class="acronym">UDP</acronym> ports will be listed and then monitored.
         </p><p>
         To start PortSentry in the two modes selected above, use the commands:
         </p><pre class="screen">
         [root@deep] /#  /usr/psionic/portsentry/portsentry -atcp
         [root@deep] /#  /usr/psionic/portsentry/portsentry -sudp
         </pre><p>
         </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
         You can add the above lines to your <code class="filename">/etc/rc.d/rc.local</code> script file and PortSentry software will be automatically started if you reboot your system.
         </p></div><p>
         These are the files Installed by Portsentry on your system:
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">
         /usr/psionic
         </code></td></tr><tr><td><code class="filename">
         /usr/psionic/portsentry
         </code></td></tr><tr><td><code class="filename">
         /usr/psionic/portsentry/portsentry.conf
         </code></td></tr><tr><td><code class="filename">
         /usr/psionic/portsentry/portsentry.ignore
         </code></td></tr><tr><td><code class="filename">
         /usr/psionic/portsentry/portsentry
         </code></td></tr></table><p>
         </p></div></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="idm7867"></a>Part 6. Software -Networking</h1></div></div></div><div class="partintro"><div></div><div class="mediaobject" align="center"><img src="./resources/Annimals/Chapter16.gif" align="middle" alt="Two ducks!"></div><div class="abstract"><p class="title"><b>Abstract</b></p><p>
         Linux being a product of the net revolution is a natural choice for a web server, mail server, a file and print server; if it is a part of your intranet  environement, among various other roles it can perform superbly well.
         In this part we take a look at various avatars it can assume and serve your organisation for a long time to come. All distributions of linux whether be it RedHat or SuSe do provide in binary format tools/software for your linux to 
         act as a Web server or a Mail server to mention a few, but the amount of advancements which happen in linux world are beyond the grasp of these companies for it to catch up. The situation is if something can be achieved, it will be done 
         in shortest possible time hence we have used always source tarballs downloaded from the respective websites of the software(s) used as example in this book. This affords us the capability to configure, choose and optimise according 
         to our needs. This part attempts to highlight the capablities of linux to act as a full fledged Web server, Mail server, a file and print server, as a B2B e-commerce point where the need of the hour is secure environement, <abbr class="abbrev">etc.</abbr> <span class="emphasis"><em>Enjoy!</em></span>
         </p></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="chapter"><a href="#prt6ch15ssh">15. Software -Securities</a></span></dt><dd><dl><dt><span class="section"><a href="#prt6ch1sc1ossh">1. OpenSSH</a></span></dt><dt><span class="section"><a href="#idm7998">2. Configure and optimise Openssh</a></span></dt><dt><span class="section"><a href="#idm8037">3. Configure the <code class="filename">/etc/ssh/ssh_config file</code></a></span></dt><dt><span class="section"><a href="#idm8173">4. Configure the <code class="filename">/etc/ssh/sshd_config file</code></a></span></dt><dt><span class="section"><a href="#idm8326">5. Configure OpenSSH to use TCP-Wrappers/inetd super server</a></span></dt><dt><span class="section"><a href="#idm8430">6. OpenSSH Per-User Configuration</a></span></dt><dt><span class="section"><a href="#idm8480">7. OpenSSH Users Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm8495">7.1. scp</a></span></dt></dl></dd><dt><span class="section"><a href="#idm8536">8. Installed files</a></span></dt><dd><dl><dt><span class="section"><a href="#idm8578">8.1. Free SSH clients for Windows</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#idm8590">16. Software -Securties(commercial)</a></span></dt><dd><dl><dt><span class="section"><a href="#prt6ch2sc1ssh">1. Linux SSH2 Client/Server</a></span></dt><dt><span class="section"><a href="#idm8669">2. Configure and Optimise SSH2</a></span></dt><dt><span class="section"><a href="#idm8707">3. Configure the <code class="filename">/etc/ssh2/ssh2_config</code> file</a></span></dt><dt><span class="section"><a href="#idm8822">4. Configure the <code class="filename">/etc/ssh2/sshd2_config</code> file</a></span></dt><dt><span class="section"><a href="#idm9020">5. Configure sshd2 to use tcp-wrappers/inetd super server</a></span></dt><dt><span class="section"><a href="#idm9082">6. Configuration of the <code class="filename">/etc/pam.d/ssh</code> file</a></span></dt><dt><span class="section"><a href="#idm9130">7. Ssh2 Per-User Configuration</a></span></dt><dt><span class="section"><a href="#idm9179">8. SSH2 Users Tools</a></span></dt><dt><span class="section"><a href="#idm9208">9. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr6ch17SSSI">17. Software -Securities/System Integrity</a></span></dt><dd><dl><dt><span class="section"><a href="#prt6ch3sc1trwr">1. Linux Tripwire 2.2.1</a></span></dt><dt><span class="section"><a href="#idm9368">2. Configure the <code class="filename">/var/tmp/install.cfg</code> file</a></span></dt><dt><span class="section"><a href="#idm9423">3. Configuration files</a></span></dt><dt><span class="section"><a href="#idm9454">4. Configure the <code class="filename">/usr/TSS/policy/twpol.txt</code> file</a></span></dt><dt><span class="section"><a href="#idm9482">5. Securing Tripwire for Linux</a></span></dt><dd><dl><dt><span class="section"><a href="#idm9547">5.1. Often used Commands</a></span></dt></dl></dd><dt><span class="section"><a href="#idm9566">6. Integrity or Interactive Check Mode</a></span></dt><dt><span class="section"><a href="#idm9608">7. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr6ch4sc1ltp">18. Linux Tripwire ASR 1.3.1</a></span></dt><dd><dl><dt><span class="section"><a href="#idm9682">1. Install, Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm9796">2. Configurations</a></span></dt><dt><span class="section"><a href="#idm9824">3. Configure the <code class="filename">/etc/tw.config</code> file</a></span></dt><dt><span class="section"><a href="#idm9844">4. Configure the <code class="filename">/etc/cron.daily/tripwire.verify</code> script</a></span></dt><dd><dl><dt><span class="section"><a href="#idm9860">4.1. Security Issue</a></span></dt></dl></dd><dt><span class="section"><a href="#idm9889">5. Tripwire in <code class="literal">Interactive Checking Mode</code></a></span></dt><dt><span class="section"><a href="#pr6ch4sc5trp">6. Run Tripwire in <em class="wordasword">Database Update Mode</em></a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch4sc51tri">6.1. Installed Files</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#idm9985">19. Software -Securities/Management &amp; Limitation</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch19sgpgp">1. Linux GnuPG</a></span></dt><dt><span class="section"><a href="#idm10052">2. Often used Commands</a></span></dt><dt><span class="section"><a href="#idm10071">3. Importing keys</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10084">3.1. Key signing</a></span></dt></dl></dd><dt><span class="section"><a href="#idm10104">4. Encrypt and decrypt</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10144">4.1. Exporting your public key</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#idm10190">20. Set Limits using Qouta</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10192">1. Qouta</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10214">1.1. Modify the <code class="filename">/etc/fstab</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm10283">2. Create of the <code class="filename">quota.user</code> and <code class="filename">quota.group</code> </a></span></dt><dt><span class="section"><a href="#idm10348">3. edquota </a></span></dt><dd><dl><dt><span class="section"><a href="#idm10390">3.1. The <code class="literal">grace period</code> parameter</a></span></dt></dl></dd><dt><span class="section"><a href="#idm10411">4. Assign quota for a particular group</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10421">4.1. Assign quota for groups of users with the same value</a></span></dt></dl></dd><dt><span class="section"><a href="#idm10481">5. Often used Commands</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr6ch21Sonet">21. Software -Networking</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch7sc1dbs">1. Linux <acronym class="acronym">DNS</acronym> and <acronym class="acronym">BIND</acronym> Server</a></span></dt><dt><span class="section"><a href="#idm10608">2. Configure</a></span></dt><dt><span class="section"><a href="#idm10707">3. <code class="literal">Caching-only</code> name Server</a></span></dt><dt><span class="section"><a href="#idm10804">4. Primary <code class="literal">master</code> name Server</a></span></dt><dt><span class="section"><a href="#idm10913">5. <code class="literal">Secondary</code> slave name Server</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10964">5.1. <code class="filename">/etc/rc.d/init.d/named script </code></a></span></dt></dl></dd><dt><span class="section"><a href="#idm10999">6. Run <acronym class="acronym">ISC</acronym>  <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> in a chroot jail</a></span></dt><dt><span class="section"><a href="#idm11151">7. The syslog daemon</a></span></dt><dt><span class="section"><a href="#idm11242">8. Clean-up and Test the new chrooted jail</a></span></dt><dt><span class="section"><a href="#idm11414">9. DNS Administrative Tools</a></span></dt><dt><span class="section"><a href="#idm11447">10. <acronym class="acronym">DNS</acronym> Users Tools</a></span></dt><dt><span class="section"><a href="#idm11519">11. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr6ch22SSMn">22. Software -Server/Mail Network</a></span></dt><dd><dl><dt><span class="section"><a href="#idm11678">1. Linux Sendmail Server</a></span></dt><dt><span class="section"><a href="#idm11743">2. Compile and optimize</a></span></dt><dt><span class="section"><a href="#idm11916">3. Configurations</a></span></dt><dt><span class="section"><a href="#idm11977">4. The <code class="filename">/etc/sendmail.mc</code> file /Central Mail Hub</a></span></dt><dt><span class="section"><a href="#idm12145">5. Build and Tweak Sendmail</a></span></dt><dd><dl><dt><span class="section"><a href="#idm12162">5.1. The <code class="filename">null.mc</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm12262">6. The <code class="filename">/etc/mail/access</code> and <code class="filename">access.db</code> files </a></span></dt><dt><span class="section"><a href="#idm12298">7. The <code class="filename">/etc/mail/aliases</code> and <code class="filename">aliases.db</code> files</a></span></dt><dd><dl><dt><span class="section"><a href="#idm12333">7.1. The <code class="filename">/etc/mail/</code> Directory</a></span></dt></dl></dd><dt><span class="section"><a href="#idm12384">8. The <code class="filename">/etc/mail/local-host-names</code> file </a></span></dt><dd><dl><dt><span class="section"><a href="#idm12420">8.1. Configure the <code class="filename">/etc/sysconfig/sendmail</code> file </a></span></dt></dl></dd><dt><span class="section"><a href="#idm12442">9. The <code class="filename">/etc/rc.d/init.d/sendmail</code> script file</a></span></dt><dt><span class="section"><a href="#idm12474">10. Secure Sendmail using <span class="command"><strong>smrsh</strong></span></a></span></dt><dt><span class="section"><a href="#idm12577">11. The <code class="filename">/etc/mail/aliases</code> file</a></span></dt><dt><span class="section"><a href="#idm12660">12. Limit queue processing to <code class="literal">root</code></a></span></dt><dd><dl><dt><span class="section"><a href="#idm12681">12.1. The <acronym class="acronym">SMTP</acronym> greeting message</a></span></dt></dl></dd><dt><span class="section"><a href="#idm12780">13. Sendmail Administrative Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm12823">13.1. Sendmail Users Tools</a></span></dt></dl></dd><dt><span class="section"><a href="#idm12842">14. Installed  files: Sendmail -Central Mail Hub</a></span></dt><dt><span class="section"><a href="#idm12932">15. Installed files: Sendmail -Local server/client</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm12988">23. Linux <acronym class="acronym">IMAP</acronym> &amp; <acronym class="acronym">POP</acronym> Server</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch23sc1ip">1. Configure and Compile</a></span></dt><dt><span class="section"><a href="#idm13186">2. Configure to tweak</a></span></dt><dd><dl><dt><span class="section"><a href="#idm13224">2.1. The <code class="filename">/etc/pam.d/imap</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm13258">3. Enable <acronym class="acronym">IMAP</acronym> or <acronym class="acronym">POP</acronym> via the tcp-wrappers inetd super server</a></span></dt><dd><dl><dt><span class="section"><a href="#idm13306">3.1. Securing <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym></a></span></dt></dl></dd><dt><span class="section"><a href="#idm13367">4. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr6ch24SoNE">24. Software -Networking/Encryption</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch24sc1ossl">1. Linux OPENSSL Server</a></span></dt><dt><span class="section"><a href="#idm13648">2. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm13782">3. Configure OpenSSL to optimise</a></span></dt><dt><span class="section"><a href="#idm13820">4. The <code class="filename">/etc/ssl/openssl.cnf</code> file</a></span></dt><dt><span class="section"><a href="#idm13846">5. Create the <code class="filename">/usr/bin/sign.sh</code> program file</a></span></dt><dt><span class="section"><a href="#idm13874">6. Commands -often used</a></span></dt><dt><span class="section"><a href="#idm14003">7. Securing OpenSSL</a></span></dt><dt><span class="section"><a href="#idm14021">8. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm14399">25. Linux FreeS/WAN VPN</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch25sc1fsw">1. IPSEC/VPN -FreeS/WAN</a></span></dt><dt><span class="section"><a href="#idm14485">2. Compile, insert FreeS/WAN into the kernel</a></span></dt><dt><span class="section"><a href="#idm14621">3. Reconfigure and install the kernel with FreeS/WAN VPN support</a></span></dt><dt><span class="section"><a href="#idm14699">4. Configure to optimise</a></span></dt><dt><span class="section"><a href="#idm14737">5. Automatic or Manual Key connections</a></span></dt><dt><span class="section"><a href="#idm14792">6. The <code class="filename">/etc/ipsec.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm14954">7. The <code class="filename">/etc/ipsec.secrets</code> file</a></span></dt><dt><span class="section"><a href="#idm15018">8. Configure <acronym class="acronym">RSA</acronym> private keys secrets</a></span></dt><dt><span class="section"><a href="#idm15198">9. Required network setup for IPSec</a></span></dt><dt><span class="section"><a href="#idm15370">10. Testing the installation</a></span></dt><dt><span class="section"><a href="#idm15416">11. Further documentation</a></span></dt><dt><span class="section"><a href="#idm15892">12. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm16038">26. Linux OpenLDAP Server</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch26sccmi">1. Compile ans Install</a></span></dt><dt><span class="section"><a href="#idm16093">2. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm16204">3. Configurations</a></span></dt><dt><span class="section"><a href="#idm16241">4. Configure the <code class="filename">/etc/ldap/slapd.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm16303">5. Configure the <code class="filename">/etc/rc.d/init.d/ldap</code> script file</a></span></dt><dt><span class="section"><a href="#idm16326">6. Securing OpenLDAP</a></span></dt><dt><span class="section"><a href="#idm16450">7. OpenLDAP Creation and Maintenance Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm16469">7.1. <acronym class="acronym">LDMB</acronym> backend database off-line </a></span></dt></dl></dd><dt><span class="section"><a href="#idm16505">8. Create the LDMB backend database on-line</a></span></dt><dd><dl><dt><span class="section"><a href="#idm16544">8.1. ldapmodify</a></span></dt></dl></dd><dt><span class="section"><a href="#idm16571">9. OpenLDAP Users Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm16593">9.1. The Netscape Address Book client for <acronym class="acronym">LDAP</acronym></a></span></dt></dl></dd><dt><span class="section"><a href="#idm16638">10. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm17110">27. Linux PostgreSQL Database Server</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch27scpsql">1. Install PostgreSQL</a></span></dt><dt><span class="section"><a href="#idm17174">2. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm17277">3. Database installation using superuser account</a></span></dt><dt><span class="section"><a href="#idm17319">4. Configuration files</a></span></dt><dt><span class="section"><a href="#idm17352">5. Configure the <code class="filename">/etc/rc.d/init.d/postgresql</code> script file</a></span></dt><dt><span class="section"><a href="#idm17370">6. Commands often used</a></span></dt><dt><span class="section"><a href="#idm17438">7. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr6sserprnt">28. Software -Server/Proxy Network</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch28scsps">1. Linux Squid Proxy Server</a></span></dt><dt><span class="section"><a href="#idm17930">2. Configure and Optimize</a></span></dt><dt><span class="section"><a href="#idm18014">3. Improve performance Using GNU malloc library </a></span></dt><dt><span class="section"><a href="#idm18048">4. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm18123">5. Configurations</a></span></dt><dt><span class="section"><a href="#pr6ch28scsqcnf">6. Configure the <code class="filename">/etc/squid/squid.conf</code> file -in <code class="literal">httpd-accelerator mode</code></a></span></dt><dt><span class="section"><a href="#idm18345">7. Configure of the <code class="filename">/etc/squid/squid.conf</code> file -/proxy-caching mode</a></span></dt><dt><span class="section"><a href="#idm18388">8. Configure the <code class="filename">/etc/rc.d/init.d/squid</code> script file -/all configurations</a></span></dt><dt><span class="section"><a href="#idm18419">9. Configure the <code class="filename">/etc/logrotate.d/squid</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm18428">9.1. Securing and Immunize Squid</a></span></dt></dl></dd><dt><span class="section"><a href="#idm18456">10. Optimizing Squid</a></span></dt><dd><dl><dt><span class="section"><a href="#idm18464">10.1. The cachemgr.cgi </a></span></dt></dl></dd><dt><span class="section"><a href="#idm18503">11. Netscape Proxies Configuration</a></span></dt><dt><span class="section"><a href="#idm18550">12. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pr6ch29wapch">29. Software -Network Server, web/Apache</a></span></dt><dd><dl><dt><span class="section"><a href="#prt6ch29scmm">1. Linux MM Shared Memory Library </a></span></dt><dt><span class="section"><a href="#idm18766">2. Compile</a></span></dt><dd><dl><dt><span class="section"><a href="#idm18801">2.1. Installed files</a></span></dt></dl></dd><dt><span class="section"><a href="#prt6ch29sapws">3. Linux Apache Web Server</a></span></dt><dt><span class="section"><a href="#idm18910">4. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm18970">5. Configure and apply <acronym class="acronym">PHP4</acronym> to Apache source</a></span></dt><dt><span class="section"><a href="#idm19032">6. Apply mod_perl to Apache source tree </a></span></dt><dt><span class="section"><a href="#idm19118">7. Install Apache</a></span></dt><dt><span class="section"><a href="#idm19184">8. Post install Configuration</a></span></dt><dt><span class="section"><a href="#idm19232">9. Configure the <code class="filename">/etc/httpd/conf/httpd.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm19392">10. Configure the <code class="filename">/etc/logrotate.d/apache</code> file</a></span></dt><dt><span class="section"><a href="#idm19414">11. Configure the <code class="filename">/etc/rc.d/init.d/httpd</code> script file</a></span></dt><dt><span class="section"><a href="#idm19437">12. <acronym class="acronym">PHP4</acronym> server-side scripting</a></span></dt><dt><span class="section"><a href="#pr6ch29sappsy">13. Perl module Devel::Symdump</a></span></dt><dd><dl><dt><span class="section"><a href="#idm19531">13.1. Installed files</a></span></dt></dl></dd><dt><span class="section"><a href="#pr6ch29sapcgi">14. CGI.pm Perl library</a></span></dt><dd><dl><dt><span class="section"><a href="#idm19579">14.1. Installed files</a></span></dt></dl></dd><dt><span class="section"><a href="#pr6ch29apscr">15. Securing Apache</a></span></dt><dt><span class="section"><a href="#idm19622">16. users authentication with <code class="filename">.dbmpasswd</code> password file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm19672">16.1. Immunize configuration files like <code class="filename">httpd.conf</code></a></span></dt></dl></dd><dt><span class="section"><a href="#idm19679">17. Apache in a chroot jail</a></span></dt><dt><span class="section"><a href="#idm19800">18. Apache to use shared libraries</a></span></dt><dt><span class="section"><a href="#idm19849">19. The <code class="filename">/chroot/etc</code> directory</a></span></dt><dt><span class="section"><a href="#idm19936">20. Test the new chrooted jail</a></span></dt><dt><span class="section"><a href="#idm19965">21. Configure the new <code class="filename">/etc/logrotate.d/apache</code> file</a></span></dt><dt><span class="section"><a href="#pr6ch29sapo">22. Optimizing Apache</a></span></dt><dt><span class="section"><a href="#idm20023">23. Installed files for Apache Web Server</a></span></dt><dt><span class="section"><a href="#idm20209">24. Installed files /PHP4</a></span></dt><dt><span class="section"><a href="#idm20445">25. Installed files by mod_perl</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm20873">30. Optional component to install with Apache</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch30swblzr">1. Linux Webalizer</a></span></dt><dt><span class="section"><a href="#idm20959">2. Compile</a></span></dt><dd><dl><dt><span class="section"><a href="#idm20986">2.1. Configurations</a></span></dt></dl></dd><dt><span class="section"><a href="#idm21018">3. Configure the <code class="filename">/etc/webalizer.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm21094">4. Make Apache aware of Webalizer output directory</a></span></dt><dd><dl><dt><span class="section"><a href="#idm21112">4.1. Running Webalizer manually first time</a></span></dt></dl></dd><dt><span class="section"><a href="#idm21128">5. Run Webalizer automatically with a cron job</a></span></dt><dd><dl><dt><span class="section"><a href="#idm21134">5.1. Installed files</a></span></dt></dl></dd><dt><span class="section"><a href="#pr6ch30scfqmtc">6. Linux FAQ-O-Matic</a></span></dt><dt><span class="section"><a href="#idm21203">7. Compile and install FAQ-O-Matic</a></span></dt><dt><span class="section"><a href="#idm21263">8. Make Apache aware Faq-O-Matic file's location</a></span></dt><dt><span class="section"><a href="#idm21281">9. Configure your FAQ-O-Matic</a></span></dt><dt><span class="section"><a href="#idm21343">10. Installed files</a></span></dt><dt><span class="section"><a href="#pr6ch30swmlimp">11. Linux Webmail IMP</a></span></dt><dt><span class="section"><a href="#pr6ch30sphplb">12. Set up PHPLib </a></span></dt><dt><span class="section"><a href="#idm21572">13. Compile to install Webmail IMP</a></span></dt><dt><span class="section"><a href="#idm21628">14. Configure and create Webmail IMP SQL database</a></span></dt><dt><span class="section"><a href="#idm21708">15. Configure your <code class="filename">php.ini</code> from PHP4</a></span></dt><dd><dl><dt><span class="section"><a href="#idm21728">15.1. Configure Apache to recognize Webmail IMP</a></span></dt></dl></dd><dt><span class="section"><a href="#idm21743">16. Configure Webmail <acronym class="acronym">IMP</acronym> via your web browser</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm21783">31. Software -Server/File Sharing-Network</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch31slss">1. Linux Samba Server</a></span></dt><dt><span class="section"><a href="#idm21840">2. Configure Samba</a></span></dt><dt><span class="section"><a href="#idm21889">3. Compile and optimize</a></span></dt><dt><span class="section"><a href="#idm21961">4. Configurations</a></span></dt><dt><span class="section"><a href="#idm22007">5. Configuration of the <code class="filename">/etc/smb.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm22266">6. Configure the <code class="filename">/etc/lmhosts</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm22283">6.1. Configure the <code class="filename">/etc/pam.d/samba</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm22302">7. Encrypted Samba password file for clients</a></span></dt><dt><span class="section"><a href="#idm22359">8. Optimizing Samba</a></span></dt><dd><dl><dt><span class="section"><a href="#idm22366">8.1. Tuning the buffer cache</a></span></dt></dl></dd><dt><span class="section"><a href="#idm22401">9. Tuning the buffermem</a></span></dt><dt><span class="section"><a href="#idm22430">10. Further documentation</a></span></dt><dt><span class="section"><a href="#idm22539">11. Samba Administrative Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm22548">11.1. Samba Users Tools</a></span></dt></dl></dd><dt><span class="section"><a href="#idm22563">12. The <code class="filename">/etc/rc.d/init.d/smb</code> script file</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch31ssmb">12.1. Securing Samba</a></span></dt></dl></dd><dt><span class="section"><a href="#idm22595">13. Installed files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idm22763">32. Linux <code class="literal">FTP</code> Server</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch32sftp">1. chroot'd Guest FTP access</a></span></dt><dt><span class="section"><a href="#idm22819">2. Setup an <code class="literal">FTP</code> user account minus shells</a></span></dt><dt><span class="section"><a href="#idm22888">3. Setup a chroot user environment</a></span></dt><dt><span class="section"><a href="#idm23080">4. Configurations</a></span></dt><dt><span class="section"><a href="#idm23132">5. Configure the <code class="filename">/etc/ftphosts</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm23156">5.1. Configure the <code class="filename">/etc/ftpusers</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm23175">6. Configure the <code class="filename">/etc/ftpconversions</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm23192">6.1. Configure the <code class="filename">/etc/pam.d/ftp</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm23199">7. Configure the <code class="filename">/etc/logrotate.d/ftpd</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm23206">7.1. Configure ftpd to use tcp-wrappers inetd</a></span></dt></dl></dd><dt><span class="section"><a href="#idm23228">8. <acronym class="acronym">FTP</acronym> Administrative Tools</a></span></dt><dt><span class="section"><a href="#idm23250">9. Securing <code class="literal">FTP</code></a></span></dt><dt><span class="section"><a href="#idm23313">10. The special file <code class="filename">.notar</code></a></span></dt><dt><span class="section"><a href="#idm23372">11. Installed files</a></span></dt></dl></dd></dl></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="prt6ch15ssh"></a>Chapter 15. Software -Securities</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#prt6ch1sc1ossh">1. OpenSSH</a></span></dt><dt><span class="section"><a href="#idm7998">2. Configure and optimise Openssh</a></span></dt><dt><span class="section"><a href="#idm8037">3. Configure the <code class="filename">/etc/ssh/ssh_config file</code></a></span></dt><dt><span class="section"><a href="#idm8173">4. Configure the <code class="filename">/etc/ssh/sshd_config file</code></a></span></dt><dt><span class="section"><a href="#idm8326">5. Configure OpenSSH to use TCP-Wrappers/inetd super server</a></span></dt><dt><span class="section"><a href="#idm8430">6. OpenSSH Per-User Configuration</a></span></dt><dt><span class="section"><a href="#idm8480">7. OpenSSH Users Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm8495">7.1. scp</a></span></dt></dl></dd><dt><span class="section"><a href="#idm8536">8. Installed files</a></span></dt><dd><dl><dt><span class="section"><a href="#idm8578">8.1. Free SSH clients for Windows</a></span></dt></dl></dd></dl></div><div class="highlights"><p>
         As illustrated in <a class="link" href="#pr1ch2" title="Chapter 3. Installation of your Linux Server">Installation of your Linux Server</a>, many network services including, but not limited, to telnet, rsh, rlogin, or rexec are vulnerable to electronic eavesdropping. As a consequence, anyone 
         who has access to any machine connected to the network can listen in on their communication and get your password, as well as any other private information that goes over the network in plain text. Currently the Telnet 
         program is indispensable for daily administration task, but is insecure since it transmits your password in plain text over the network and allows any listener to thereby use your account to do anything  he likes. To 
         solve this problem we must find another way, or program, to replace it. Fortunately OpenSSH is a truly seamless and secure replacement of old, insecure and obsolete remote login programs such as telnet, rlogin, rsh, rdist, 
         or rcp.
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prt6ch1sc1ossh"></a>1. OpenSSH</h2></div></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>The official [<span class="citation">OpenSSH README</span>] file says:</b></p></div></div></div><p>         
         Ssh <em class="wordasword">Secure Shell</em> is a program to log into another computer over a network, to execute commands in a remote machine, and to move files from one machine to another. It provides strong authentication and 
         secure communications over insecure channels. It is intended as a replacement for rlogin, rsh, rcp, and rdist.
         </p></div><p>
         In our configuration we have configured OpenSSH to support tcp-wrappers; the inetd super server, to improve the security of this already secure program and to avoid always running its daemon in the background of the server. This 
         way, the program will run only when client connections arrive and will redirect them through the <acronym class="acronym">TCP</acronym>-WRAPPERS daemon for authentication and authorization before allowing the connection in the server. 
         </p><p>
         OpenSSH is a free replacement and improvement of SSH1 with all patent-encumbered algorithms removed to external libraries, all known security bugs fixed, new features reintroduced and many other clean-ups. It 
         is recommended that you use OpenSSH <span class="emphasis"><em>free and security bug fixed</em></span> instead of SSH1 <span class="emphasis"><em>free, buggy, and old</em></span> or SSH2 that was originally free but now under a commercial 
         license. For peoples that use SSH2 from Datafellows Company, we'll provide in this book both versions, beginning with OpenSSH, since it is the new SSH program which everyone, we suggest, must move to in the future.
         </p><p>
         These installation instructions assume:
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Commands are Unix-compatible.
         </p></li><li class="listitem"><p>
         The source path is <code class="filename">/var/tmp</code> -<span class="emphasis"><em>other paths are possible</em></span>.
                  </p></li><li class="listitem"><p>
         Installations were tested on Red Hat Linux 6.1 and 6.2.
                  </p></li><li class="listitem"><p>
         All steps in the installation will happen in super-user account root.
                  </p></li><li class="listitem"><p>
         OpenSSH version number is 1.2.3
                  </p></li></ul></div><p>
         </p><p>
         These are the Packages you can download from OpenSSH Homepage:<a class="link" href="#prtinxfp11" title="OpenSSh">http://www.openssh.com</a> and be sure to download: openssh-1.2.3.tar.gz <span class="emphasis"><em>as of this writing</em></span>
         </p><p>
         There are some Prerequisites you need to take care of before installing OpenSSH since it requires that the zlib-devel package, which contains the header files and libraries needed to 
         develop programs that use the zlib compression and decompression library, be already installed on your system. If this is not the case, you must install it from your Red Hat Linux 6.1 
         or 6.2 CD-ROM.

         To verify that the zlib-devel package is installed on your Linux system, use the following command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>rpm</strong></span> -qi zlib-devel
         </pre><p>
         </p><div class="literallayout"><p><code class="computeroutput"><br>
         package zlib-devel is not installed<br>
         </code></p></div><p>
         </p><p>
         To install the zlib-devel package on your Linux system, use the following command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>mount</strong></span> /dev/cdrom /mnt/cdrom/
         [root@deep] /#<span class="command"><strong>cd</strong></span> /mnt/cdrom/RedHat/RPMS/
         [root@deep ]/RPMS#<span class="command"><strong>rpm</strong></span> -Uvh zlib-devel-version.i386.rpm
         </pre><p>
         </p><div class="literallayout"><p><code class="computeroutput"><br>
         gd                          ##################################################<br>
         </code></p></div><p>
         </p><pre class="screen">
         [root@deep ]/RPMS#<span class="command"><strong>rpm</strong></span> -Uvh gd-devel-version.i386.rpm
         </pre><p>
         </p><div class="literallayout"><p><code class="computeroutput"><br>
         zlib-devel                  ##################################################<br>
         </code></p></div><p>
         </p><pre class="screen">
         [root@deep ]/RPMS# cd /; umount /mnt/cdrom/
         </pre><p>
         </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
         OpenSSL, which enables support for SSL functionality, must already be installed on your system to be able to use the OpenSSH software.For more information on OpenSSL server, see its related chapter in this book. Even if you don't 
         need to use OpenSSL software to create or hold encrypted key files, it's important to note that OpenSSH program require its libraries files to be able to work properly on your system.
         </p></div><p>
         you need to decompress and unpack the Tarballs but it is a good idea to make a list of files on the system before you install OpenSSH, and one afterwards, and then compare them using diff to find out what files it placed where. Simply 
         run <span class="command"><strong>find</strong></span><strong class="userinput"><code>/* &gt; OpenSSH1</code></strong> before and <span class="command"><strong>find</strong></span><strong class="userinput"><code>/* &gt; OpenSSH2</code></strong> after you install the software, and use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>OpenSSH1 OpenSSH2 &gt; OpenSSH-Installed</code></strong> 
         to get a list of what changed.
         </p><p>
         To Compile,Decompress the tarball <code class="literal">tar.gz</code> and:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>cp</strong></span> openssh-version.tar.gz /var/tmp
         [root@deep] /#<span class="command"><strong>cd</strong></span> /var/tmp
         [root@deep ]/tmp#<span class="command"><strong>tar</strong></span> <strong class="userinput"><code>xzpf</code></strong> openssh-version.tar.gz
         </pre><p>
         </p><p>
         You need to Compile and Optimize:
         </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
         Move into the new OpenSSH directory and type the following commands on your terminal:
         </p><pre class="screen">
         CC="egcs" \
         CFLAGS="-O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions" \
         ./configure \
         --prefix=/usr \
         --sysconfdir=/etc/ssh \
         --with-tcp-wrappers \
         --with-ipv4-default \
         --with-ssl-dir=/usr/include/openssl
         </pre><p>
         This tells OpenSSH to set itself up for this particular hardware setup with:
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         - Compiled-in libwrap and enabled <acronym class="acronym">TCP</acronym> Wrappers <code class="filename">/etc/hosts.allow|deny</code> support.
         </td></tr><tr><td>
         - Disabled long delays in name resolution under Linux/glibc-2.1.2 to improve connection time.
         </td></tr><tr><td>
         - Specified locations of OpenSSL libraries required by OpenSSH program to work.
         </td></tr></table><p>
         </p></li><li class="step"><p>
         Now, we must compile and install OpenSSH on the Server:
         </p><pre class="screen">
         [root@deep ]/openssh-1.2.3#<span class="command"><strong>make</strong></span>
         [root@deep ]/openssh-1.2.3#<span class="command"><strong>make install</strong></span>
         [root@deep ]/openssh-1.2.3#<span class="command"><strong>make</strong></span> host-key
         [root@deep ]/openssh-1.2.3#<span class="command"><strong>install</strong></span> -m644 contrib/redhat/sshd.pam /etc/pam.d/sshd
         </pre><p>
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>make</strong></span></span></dt><dd><p>
         command will compile all source files into executable binaries, 
         </p></dd><dt><span class="term"><span class="command"><strong>make install</strong></span></span></dt><dd><p>
           will install the binaries and any supporting files into the appropriate locations. 
           </p></dd><dt><span class="term">
         <span class="command"><strong>make</strong></span> host-key </span></dt><dd><p>
         command will generate a host key.
         </p></dd><dt><span class="term"><span class="command"><strong>install</strong></span></span></dt><dd><p>
         command will install the PAM support for Red Hat Linux, which is now more functional than the popular packages of commercial ssh-1.2.x.
         </p></dd></dl></div><p>
         </p></li><li class="step"><p>
         please do a Cleanup later:
          </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>cd</strong></span> /var/tmp
         [root@deep ]/tmp#<span class="command"><strong>rm</strong></span> -rf openssh-version/ openssh-version.tar.gz
         </pre><p>
         The <span class="command"><strong>rm</strong></span> command as used above will remove all the source files we have used to compile and install OpenSSH. It will also remove the OpenSSH compressed archive from the <code class="filename">/var/tmp</code> directory.
         </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm7998"></a>2. Configure and optimise Openssh</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
              You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
              for respective software. For example <em class="wordasword">Openssh</em> configuration file are organised like this:
              </p><pre class="literallayout"><code class="computeroutput">
                total 16
                -rw-r--r--    1 harrypotter    harrypotter         275 Jun  8 13:00 Compile-OpenSSH
                drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 pam.d/
                -rw-r--r--    1 harrypotter    harrypotter         372 Jun  8 13:00 ssh_config
                -rw-r--r--    1 harrypotter    harrypotter         467 Jun  8 13:00 sshd_config
              </code></pre><p>
              You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
              responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
            </p></div><p>
          To run OpenSSH Client/Server, the following files are required and must be created or copied to the appropriate directories on your server.
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Copy the ssh_config file to the <code class="filename">/etc/ssh/</code> directory.
          </p></li><li class="listitem"><p>
          Copy the sshd_config file to the <code class="filename">/etc/ssh/</code> directory.
          </p></li><li class="listitem"><p>
          Copy the sshd file to the <code class="filename">/etc/pam.d/</code> directory.
          </p></li></ul></div><p>
          </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
          You can obtain the configuration files listed in the next sections on our <code class="filename">floppy.tgz</code> archive. Copy the following files from the decompressed 
          <code class="filename">floppy.tgz</code> archive to the appropriate places, or copy them directly from this book to the concerned file.
          </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm8037"></a>3. Configure the <code class="filename">/etc/ssh/ssh_config file</code></h2></div></div></div><p>
          The <code class="filename">/etc/ssh/ssh_config</code> file is the system-wide configuration file for OpenSSH which allows you to set options that modify the operation of the client programs. The file 
          contains keyword-value pairs, one per line, with keywords being case insensitive. Here are the most important keywords to configure your ssh for top security; a complete listing and/or special 
          requirements are available in the man page for <span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span>.
          </p><p>
          Edit <code class="filename">the ssh_config</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/ssh/ssh_config</code> and add/or change, if necessary the following parameters:
          </p><pre class="programlisting">
          # Site-wide defaults for various options

          Host *
          ForwardAgent no
          ForwardX11 no
          RhostsAuthentication no
          RhostsRSAAuthentication no
          RSAAuthentication yes
          PasswordAuthentication yes
          FallBackToRsh no
          UseRsh no
          BatchMode no
          CheckHostIP yes
          StrictHostKeyChecking no
          IdentityFile ~/.ssh/identity
          Port 22
          Cipher blowfish
          EscapeChar ~
          </pre><p>
          
          This tells ssh_config file to set itself up for this particular configuration setup with:
          </p><div class="glosslist"><dl><dt><span class="glossterm">
          <code class="envar">Host *</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">Host</code> restricts all forwarded declarations and options in the configuration file to be only for those hosts that match one of the patterns given after the keyword. The 
          pattern <code class="literal">*</code> means for all hosts up to the next Host keyword. With this option you can set different declarations for different hosts in the same <code class="filename">ssh_config</code> file.
          </p></dd><dt><span class="glossterm">
          <code class="envar">ForwardAgent no</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">ForwardAgent</code> specifies which connection authentication agent <span class="emphasis"><em>if any</em></span> should be forwarded to the remote machine.
          </p></dd><dt><span class="glossterm">
          <code class="envar">ForwardX11 no</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">ForwardX11</code> is for people that use the <code class="literal">Xwindow</code> <acronym class="acronym">GUI</acronym> and want to automatically redirect <code class="literal">X11</code> sessions to the remote machine. Since we setup a server 
          and don't have <acronym class="acronym">GUI</acronym> installed on it, we can safely turn this option off.
          </p></dd><dt><span class="glossterm">
          <code class="envar">RhostsAuthentication no</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">RhostsAuthentication</code> specifies whether we can try to use rhosts based authentication. Because rhosts authentication is insecure you shouldn't use this option.
          </p></dd><dt><span class="glossterm">
          <code class="envar">RhostsRSAAuthentication no</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">RhostsRSAAuthentication</code> specifies whether or not to try rhosts authentication in concert with <acronym class="acronym">RSA</acronym> host authentication.
          </p></dd><dt><span class="glossterm">
          <code class="envar">RSAAuthentication yes</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">RSAAuthentication</code> specifies whether to try <acronym class="acronym">RSA</acronym> authentication. This option must be set to <strong class="userinput"><code>yes</code></strong> for better security on your sessions. <acronym class="acronym">RSA</acronym> uses public and private keys pair created with 
          the ssh-keygen1utility for authentication purposes.
          </p></dd><dt><span class="glossterm">
          <code class="envar">PasswordAuthentication yes</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">PasswordAuthentication</code> specifies whether we should use password-based authentication. For strong security, this option must always be set to <strong class="userinput"><code>yes</code></strong>.
          </p></dd><dt><span class="glossterm">
          <code class="envar">FallBackToRsh no</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">FallBackToRsh</code> specifies that if a connection with ssh daemon fails rsh should automatically be used instead. Recalling that rsh service is insecure, this option must always be set to <strong class="userinput"><code>no</code></strong>.
          </p></dd><dt><span class="glossterm">
          <code class="envar">UseRsh no</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">UseRsh</code> specifies that rlogin/rsh services should be used on this host. As with the <code class="envar">FallBackToRsh</code> option, it must be set to <strong class="userinput"><code>no</code></strong> for obvious reasons.
          </p></dd><dt><span class="glossterm">
          <code class="envar">BatchMode no</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">BatchMode</code> specifies whether a username and password querying on connect will be disabled. This option is useful when you create scripts and dont want to supply the password. <abbr class="abbrev">e.g.</abbr> Scripts 
          that use the scp command to make backups over the network.
          </p></dd><dt><span class="glossterm">
          <code class="envar">CheckHostIP yes</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">CheckHostIP</code> specifies whether or not ssh will additionally check the host <acronym class="acronym">IP</acronym> address that connect to the server to detect <acronym class="acronym">DNS</acronym> spoofing. It's recommended that you set this option 
          to <strong class="userinput"><code>yes</code></strong>.
          </p></dd><dt><span class="glossterm"><code class="envar">StrictHostKeyChecking no</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">StrictHostKeyChecking</code> specifies whether or not ssh will automatically add new host keys to the <code class="prompt">$</code><code class="filename">HOME/.ssh/known_hosts</code> file, or never automatically add new 
          host keys to the host file. This option, when set to <strong class="userinput"><code>yes</code></strong>, provides maximum protection against Trojan horse attacks. One interesting procedure with this option is to set it to <strong class="userinput"><code>no</code></strong> 
          at the beginning, allow ssh to add automatically all common hosts to the host file as they are connected to, and then return to set it to <strong class="userinput"><code>yes</code></strong> to take advantage of this feature.
          </p></dd><dt><span class="glossterm">
          <code class="envar">IdentityFile ~/.ssh/identity</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">IdentityFile</code> specifies an alternate <acronym class="acronym">RSA</acronym> authentication identity file to read. Also,  multiple identity files may be specified in the configuration file <code class="filename">ssh_config</code>.
          </p></dd><dt><span class="glossterm">
          <code class="envar">Port 22</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">Port</code> specifies on which port number ssh connects to on the remote host. The default port is 22.
          </p></dd><dt><span class="glossterm">
          <code class="envar">Cipher blowfish</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">Cipher</code> specifies what cipher should be used for encrypting sessios. The blowfish use 64-bit blocks and keys of up to 448 bits.
          </p></dd><dt><span class="glossterm">
          <code class="envar">EscapeChar ~</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">EscapeChar</code> specifies the session escape character for suspension.
          </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm8173"></a>4. Configure the <code class="filename">/etc/ssh/sshd_config file</code></h2></div></div></div><p>
          The <code class="filename">/etc/ssh/sshd_config</code> file is the system-wide configuration file for OpenSSH which allows you to set options that modify the operation of the daemon. This file contains keyword-value pairs, one 
          per line, with keywords being case insensitive. Here are the most important keywords to configure your sshd for top security; a complete listing and/or special requirements are available in the man page 
          for <span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span>.
          </p><p>
          Edit the <code class="filename">sshd_config</code> file, vi <code class="filename">/etc/ssh/sshd_config</code> and add/or change, if necessary, the following parameters:
          </p><pre class="programlisting">
          # This is ssh server systemwide configuration file.

          Port 22
          ListenAddress 192.168.1.1
          HostKey /etc/ssh/ssh_host_key
          ServerKeyBits 1024
          LoginGraceTime 600
          KeyRegenerationInterval 3600
          PermitRootLogin no
          IgnoreRhosts yes
          IgnoreUserKnownHosts yes
          StrictModes yes
          X11Forwarding no
          PrintMotd yes
          SyslogFacility AUTH
          LogLevel INFO
          RhostsAuthentication no
          RhostsRSAAuthentication no
          RSAAuthentication yes
          PasswordAuthentication yes
          PermitEmptyPasswords no
          AllowUsers admin
          </pre><p>
          </p><p>
          This tells sshd_config file to set itself up for this particular configuration setup with:
          </p><div class="glosslist"><dl><dt><span class="glossterm">
          <code class="envar">Port 22</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">Port</code> specifies on which port number ssh daemon listens for incoming connections. The default port is 22.
          </p></dd><dt><span class="glossterm">
          <code class="envar">ListenAddress 192.168.1.1</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">ListenAddress</code> specifies the <acronym class="acronym">IP</acronym> address of the interface network on which the ssh daemon server socket is bind. The default is <code class="literal">0.0.0.0</code>; to improve security you may specify only the required ones to limit possible addresses.
          </p></dd><dt><span class="glossterm">
          <code class="envar">HostKey /etc/ssh/ssh_host_key</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">HostKey</code> specifies the location containing the private host key.
          </p></dd><dt><span class="glossterm">
          <code class="envar">ServerKeyBits 1024</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">ServerKeyBits</code> specifies how many bits to use in the server key. These bits are used when the daemon starts to generate its <acronym class="acronym">RSA</acronym> key.
          </p></dd><dt><span class="glossterm">
          <code class="envar">LoginGraceTime 600</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">LoginGraceTime</code> specifies how long in seconds after a connection request the server will wait before disconnecting if the user has not successfully logged in.
          </p></dd><dt><span class="glossterm">
          <code class="envar">KeyRegenerationInterval 3600</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">KeyRegenerationInterval</code> specifies how long in seconds the server should wait before automatically regenerated its key. This is a security feature to prevent decrypting captured sessions.
          </p></dd><dt><span class="glossterm">
          <code class="envar">PermitRootLogin no</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">PermitRootLogin</code> specifies whether root can log in using ssh. Never say <code class="filename">yes</code> to this option.
          </p></dd><dt><span class="glossterm">
          <code class="envar">IgnoreRhosts yes</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">IgnoreRhosts</code> specifies whether rhosts or shosts files should not be used in authentication. For security reasons it is <span class="emphasis"><em>recommended to no use rhosts or shosts files for authentication</em></span>.
          </p></dd><dt><span class="glossterm">
          <code class="envar">IgnoreUserKnownHosts yes</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">IgnoreUserKnownHosts</code> specifies whether the ssh daemon should ignore the user's <code class="prompt">$</code><code class="filename">HOME/.ssh/known_hosts</code> during RhostsRSAAuthentication.
          </p></dd><dt><span class="glossterm">
          <code class="envar">StrictModes yes</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">StrictModes</code> specifies whether ssh should check user's permissions in their home directory and rhosts files before accepting login. This option must always be set to <strong class="userinput"><code>yes</code></strong> because sometimes users may accidentally leave their directory or files world-writable.
          </p></dd><dt><span class="glossterm">
          <code class="envar">X11Forwarding no</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">X11Forwarding</code> specifies whether <code class="literal">X11</code> forwarding should be enabled or not on this server. Since we setup a server without <acronym class="acronym">GUI</acronym> installed on it, we can safely turn this option off.
          </p></dd><dt><span class="glossterm">
          <code class="envar">PrintMotd yes</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">PrintMotd</code> specifies whether the ssh daemon should print the contents of the <code class="filename">/etc/motd</code> file when a user logs in interactively. The <code class="filename">/etc/motd</code> file is also known as the <em class="wordasword">message of the day</em>.
          </p></dd><dt><span class="glossterm">
          <code class="envar">SyslogFacility AUTH</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">SyslogFacility</code> specifies the facility code used when logging messages from sshd. The facility specifies the subsystem that produced the message--in our case, AUTH.
          </p></dd><dt><span class="glossterm">
          <code class="envar">LogLevel INFO</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">LogLevel</code> specifies the level that is used when logging messages from sshd. INFO is a good choice. See the man page for sshd for more information on other possibilities.
          </p></dd><dt><span class="glossterm">
          <code class="envar">RhostsAuthentication no</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">RhostsAuthentication</code> specifies whether sshd can try to use rhosts based authentication. Because rhosts authentication is insecure you shouldn't use this option.
          </p></dd><dt><span class="glossterm">
          <code class="envar">RhostsRSAAuthentication no</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">RhostsRSAAuthentication</code> specifies whether to try rhosts authentication in concert with <acronym class="acronym">RSA</acronym> host authentication.
          </p></dd><dt><span class="glossterm">
          <code class="envar">RSAAuthentication yes</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">RSAAuthentication</code> specifies whether to try <acronym class="acronym">RSA</acronym> authentication. This option must be set to <strong class="userinput"><code>yes</code></strong> for better security in your sessions. <acronym class="acronym">RSA</acronym> use 
          public and private key pairs created with the ssh-keygen1utility for authentication purposes.
          </p></dd><dt><span class="glossterm">
          <code class="envar">PasswordAuthentication yes</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">PasswordAuthentication</code> specifies whether we should use password-based authentication. For strong security, this option must always be set to <strong class="userinput"><code>yes</code></strong>.
          </p></dd><dt><span class="glossterm">
          <code class="envar">PermitEmptyPasswords no</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">PermitEmptyPasswords</code> specifies whether the server allows logging in to accounts with a null password. If you intend to use the scp utility to make automatic backups over the network, you must set this option to <strong class="userinput"><code>yes</code></strong>.
          </p></dd><dt><span class="glossterm">
          <code class="envar">AllowUsers admin</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">AllowUsers</code> specifies and controls which users can access ssh services. Multiple users can be specified, separated by spaces.
          </p></dd></dl></div><p>
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm8326"></a>5. Configure OpenSSH to use TCP-Wrappers/inetd super server</h2></div></div></div><p>
          Tcp-Wrappers should be enabled to start and stop our OpenSSH server. Upon execution, inetd reads its configuration information from a configuration file which, by default, is <code class="filename">/etc/inetd.conf</code>. There must 
          be an entry for each field of the configuration file, with entries for each field separated by a tab or a space.
          </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
          
          Edit the <code class="filename">inetd.conf</code> file <span class="command"><strong>vi</strong></span> <code class="filename">/etc/inetd.conf</code> and add the line:
          </p><pre class="programlisting">
          ssh	stream	tcp	nowait	root	/usr/sbin/tcpd	sshd -i
          </pre><p>
          </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
         
          The  -i parameter is important since it's specifies that sshd is being run from inetd. Also, update your <code class="filename">inetd.conf</code> file by sending a <span class="command"><strong>SIGHUP</strong></span> signal <span class="command"><strong>killall</strong></span><strong class="userinput"><code>-HUP inetd</code></strong> after 
          adding the above line to the file.
          </p></div><p>
          To update your <code class="filename">inetd.conf file</code>, use the following command:
          </p><pre class="screen">
          [root@deep] /#<span class="command"><strong>killall</strong></span> -HUP inetd
          </pre><p>
          </p></li><li class="step"><p>
                   
          Edit the <code class="filename">hosts.allow</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/hosts.allow</code> and add the line:
          </p><pre class="programlisting">
          sshd: 192.168.1.4 win.openna.com
          </pre><p>
          Which mean client <acronym class="acronym">IP</acronym> <code class="literal">192.168.1.4</code> with host name <code class="literal">win.openna.com</code> is allowed to ssh in to the server.
          </p></li></ol></div><p>
          These daemon strings for tcp-wrappers are in use by sshd:
          </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
          sshdfwd-X11</span></dt><dd><p>
          if you want to allow/deny X11-forwarding
          </p></dd><dt><span class="term">
          sshdfwd-&lt;port-number&gt;</span></dt><dd><p>for tcp-forwarding</p></dd><dt><span class="term">
          sshdfwd-&lt;port-name&gt;</span></dt><dd><p>port-name defined in <code class="filename">/etc/services</code>. Used in tcp-forwarding</p></dd></dl></div><p>
          </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
          If you do decide to switch to using ssh, make sure you install and use it on all your servers. Having ten secure servers and one insecure is a waste of time.
          </p></div><p>
          For more details, there are several man pages you can read:
          </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
          <span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></span></dt><dd><p>OpenSSH secure shell client <span class="emphasis"><em>remote login program</em></span></p></dd><dt><span class="term">
          <span class="citerefentry"><span class="refentrytitle">ssh [slogin]</span>(1)</span></span></dt><dd><p>OpenSSH secure shell client <span class="emphasis"><em>remote login program</em></span></p></dd><dt><span class="term">
          <span class="citerefentry"><span class="refentrytitle">ssh-add</span>(1)</span></span></dt><dd><p>adds identities for the authentication agent</p></dd><dt><span class="term">
          <span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></span></dt><dd><p>authentication agent</p></dd><dt><span class="term">
          <span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></span></dt><dd><p>authentication key generation</p></dd><dt><span class="term">
          <span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></span></dt><dd><p>secure shell daemon</p></dd></dl></div><p>
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm8430"></a>6. OpenSSH Per-User Configuration</h2></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
          Create your private &amp; public keys of local, by executing:
          </p><pre class="screen">
          [root@deep] /#<span class="command"><strong>su</strong></span> admin
          [admin@deep /]$<span class="command"><strong>ssh-keygen</strong></span>
          </pre><p>
          The result should look like the following example:
          </p><pre class="literallayout"><code class="computeroutput">
          
          Initializing random number generator...
          Generating p:  ............................++ (distance 430)
          Generating q:  ......................++ (distance 456)
          Computing the keys...
          Testing the keys...
          Key generation complete.
          Enter file in which to save the key (<code class="filename">/home/admin/.ssh/identity</code>): [Press <span class="keycap"><strong>Enter</strong></span>]
          Enter passphrase: 
          Enter the same passphrase again: 
          Your identification has been saved in /home/admin/.ssh/identity.
          Your public key is:
          1024 37 14937757511251955533691120318477293862290049394715136511145806108870001764378494676831297577843158532
          2723612061006231460440536487184367748423324091941848098890786099717524446977589647127757030728779973708569993
          017043141563536333068888944038178461608592483844590202154102756903055846534063365635584899765402181 
          </code></pre><p>
          </p><pre class="screen">
          admin@deep.openna.com
          Your public key has been saved in /home/admin/.ssh/identity.pub
          </pre><p>
          </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
          If you have multiple accounts you might want to create a separate key on each of them. You may want to have separate keys for:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Your Mail server
          </p></li><li class="listitem"><p>
          Your Web server
          </p></li><li class="listitem"><p>
          Your GW server
          </p></li></ul></div><p>
          This allows you to limit access between these servers, e.g. not allowing the Mail account to access your Web account or the machines in the GW. This enhances the overall security in the case any of your authentication 
          keys are compromised for any reason.
          </p></div><p>
          </p></li><li class="step"><p>          
          Copy your local public keys <code class="filename">identity.pub</code> to the <code class="filename">/home/admin/.ssh</code> directory remotely under the name, say, <code class="filename">authorized_keys</code>.
          </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
          One way to copy the file is to use the ftp command or you might need to send your public key in electronic mail to the administrator of the system. Just include the contents of the <code class="filename">~/.ssh/identity.pub</code> file 
          in the message.
          </p></div><p>
          </p></li></ol></div><p>
          You might feel the need to Change your pass-phrase for various reason and can do so at any time by using the  -p option of ssh-keygen.
          To change the pass-phrase, use the command:
          </p><pre class="screen">
          [root@deep] /#<span class="command"><strong>su</strong></span> admin
          [admin@deep /]$<span class="command"><strong>ssh-keygen</strong></span> -p
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
          Enter file key is in <code class="filename">/home/admin/.ssh/identity</code>: [Press <span class="keycap"><strong>ENTER</strong></span>]
          Enter old passphrase:
          Key has comment 'admin@deep.openna.com'
          Enter new passphrase:
          Enter the same passphrase again:
          Your identification has been saved with the new passphrase.
          </code>
          </pre><p>
          
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm8480"></a>7. OpenSSH Users Tools</h2></div></div></div><p>
          The commands listed belows are some that we use often in our regular use, but many more exist, and you should check the man page and documentation for more details. The <code class="literal">ssh</code> Secure Shell command 
          provides secure encrypted communications between two untrusted hosts over an insecure network. It is a program for logging securely into a remote machine and executing commands from there. It is a suitable replacement 
          for insecure programs like telnet, rlogin, rcp, rdist, and rsh.
          </p><p>
          To login to a remote machine, use the command:
          </p><pre class="screen">
          [root@deep] /#<span class="command"><strong>ssh</strong></span> -l &lt;login_name&gt; &lt;hostname&gt;
          </pre><p>
          </p><div class="example"><a name="idm8487"></a><p class="title"><b>Example 15.1. Remote login using ssh</b></p><div class="example-contents"><p>
          </p><pre class="screen">
          [root@deep] /#<span class="command"><strong>ssh</strong></span> -l admin www.openna.com
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
          admin@deep.openna.coms password:
          Last login: Tue Oct 19 1999 18:13:00 -0400 from deep.openna.com
          No mail.          
          </code>
          </pre><p>
          
          </p><pre class="screen">
          [admin@www ]/admin$
          </pre><p>

          Where &lt;login_name&gt; is the name you use to connect to the ssh server and &lt;hostname&gt; is the remote address of your ssh server.
          </p></div></div><br class="example-break"><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm8495"></a>7.1. scp</h3></div></div></div><p>
          The scp Secure Copy utility copies files from the local system to a remote system or vice versa, or even between two remote systems using the scp command. To copy files from remote to local system, use 
          the following command:
          </p><pre class="screen">
          [root@deep] /#<span class="command"><strong>su</strong></span> admin
          [admin@deep /]$<span class="command"><strong>scp</strong></span> -p &lt;login_name@hostname&gt;:/dir/for/file localdir/to/filelocation
          </pre><p>
          </p><div class="example"><a name="idm8501"></a><p class="title"><b>Example 15.2. scp Secure Copy utility</b></p><div class="example-contents"><p>
            </p><pre class="screen">
          [admin@deep /]$ scp1 -p admin@mail:/etc/test1 /tmp
          </pre><p>
          </p><div class="literallayout"><p><code class="computeroutput"><br>
          Enter passphrase for RSA key 'admin@mail.openna.com':<br>
          test1                       |          2 KB |   2.0 kB/s | ETA: 00:00:00 | 100%<br>
          </code></p></div><p>
          </p></div></div><br class="example-break"><p>
          To copy files from local to remote system, use the following command:
          </p><pre class="screen">
          [root@deep] /#<span class="command"><strong>su</strong></span> admin
          [admin@deep /]$<span class="command"><strong>scp</strong></span> -p localdir/to/filelocation &lt;username@hostname&gt;:/dir/for/file
          </pre><p>
           </p><div class="example"><a name="idm8511"></a><p class="title"><b>Example 15.3. local to remote</b></p><div class="example-contents"><p>
            </p><pre class="screen">
          [admin@deep /]$<span class="command"><strong>scp1</strong></span> -p /usr/bin/test2 admin@mail:/var/tmp
          </pre><p>
          </p><div class="literallayout"><p><code class="computeroutput"><br>
          admin@mail's password:<br>
          test2                     |          7 KB |   7.9 kB/s | ETA: 00:00:00 | 100%<br>
          </code></p></div><p>
          </p></div></div><br class="example-break"><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
          The  -p option indicates that the modification and access times, as well as modes of the source file, should be preserved on the copy. This is usually desirable.
          </p></div><p>
          Some possible uses of OpenSSH softwareare:
          </p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>
          Replace telnet, rlogin, rsh, rdist, and rcp.
          </p></li><li class="listitem"><p>
          Make secure backups over the network.
          </p></li><li class="listitem"><p>
          Execute remote commands.
          </p></li><li class="listitem"><p>
          Access to corporate resources over the Internet.
          </p></li></ol></div><p>
          </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm8536"></a>8. Installed files</h2></div></div></div><p>
          These are files Installed by the software program Openssh:
          </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">
              /etc/ssh
            </code></td><td><code class="filename">
              /usr/bin/slogin
            </code></td></tr><tr><td><code class="filename">
              /etc/ssh/ssh_config
            </code></td><td><code class="filename">
              /usr/man/man1/ssh.1
            </code></td></tr><tr><td><code class="filename">
              /etc/ssh/sshd_config
            </code></td><td><code class="filename">
              /usr/man/man1/scp.1
            </code></td></tr><tr><td><code class="filename">
              /etc/ssh_host_key
            </code></td><td><code class="filename">
              /usr/man/man1/ssh-add.1
            </code></td></tr><tr><td><code class="filename">
              /etc/ssh_host_key.pub
            </code></td><td><code class="filename">
              /usr/man/man1/ssh-agent.1
            </code></td></tr><tr><td><code class="filename">
              /usr/bin/ssh
            </code></td><td><code class="filename">
              /usr/man/man1/ssh-keygen.1
            </code></td></tr><tr><td><code class="filename">
              /usr/bin/scp
            </code></td><td><code class="filename">
              /usr/man/man1/slogin.1
            </code></td></tr><tr><td><code class="filename">
              /usr/bin/ssh-add
            </code></td><td><code class="filename">
              /usr/man/man8/sshd.8
            </code></td></tr><tr><td><code class="filename">
              /usr/bin/ssh-agent
            </code></td><td><code class="filename">
              /usr/sbin/sshd
            </code></td></tr><tr><td><code class="filename">
              /usr/bin/ssh-keygen
            </code></td><td> </td></tr></table><p>
          </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm8578"></a>8.1. Free SSH clients for Windows</h3></div></div></div><p>
          Check out this free SSH clients for windows; so that you can provide the same services on your windows machine, if your networked environement is likely to have windows indtalled machines.
          </p><p><a name="prt6ch1sc8pty"></a><b>
          Putty. </b>
          And this is Putty Homepage:<a class="link" href="#prtinxfp12" title="Putty">http://www.chiark.greenend.org.uk/~sgtatham/putty.html</a>
          </p><p><a name="prt6ch1sc8ttsh"></a><b>Tera Term Pro and TTSSH. </b>
          The Tera Term Pro can be found here on its Homepage:<a class="link" href="#prtinxfp13" title="Tera Term Pro and TTSSH">http://hp.vector.co.jp/authors/VA002416/teraterm.html</a>,
          and TTSSH Homepage is:<a class="link" href="#prtinxfp13" title="Tera Term Pro and TTSSH">http://www.zip.com.au/~roca/download.html</a>.
          </p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="idm8590"></a>Chapter 16. Software -Securties(commercial)</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#prt6ch2sc1ssh">1. Linux SSH2 Client/Server</a></span></dt><dt><span class="section"><a href="#idm8669">2. Configure and Optimise SSH2</a></span></dt><dt><span class="section"><a href="#idm8707">3. Configure the <code class="filename">/etc/ssh2/ssh2_config</code> file</a></span></dt><dt><span class="section"><a href="#idm8822">4. Configure the <code class="filename">/etc/ssh2/sshd2_config</code> file</a></span></dt><dt><span class="section"><a href="#idm9020">5. Configure sshd2 to use tcp-wrappers/inetd super server</a></span></dt><dt><span class="section"><a href="#idm9082">6. Configuration of the <code class="filename">/etc/pam.d/ssh</code> file</a></span></dt><dt><span class="section"><a href="#idm9130">7. Ssh2 Per-User Configuration</a></span></dt><dt><span class="section"><a href="#idm9179">8. SSH2 Users Tools</a></span></dt><dt><span class="section"><a href="#idm9208">9. Installed files</a></span></dt></dl></div><div class="highlights"><p>
           Its now clear that all Linux users must use OpenSSH instead of SSH2 from Datafellows Company. However, for the users or organizations that want to use the non-free version of this software, we provide 
           here steps to follow. This is the SSH2 commercial version of SSH software. In our configuration we have also configured sshd2 to support tcp-wrappers <span class="emphasis"><em>the inetd super server</em></span> for security reason.
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prt6ch2sc1ssh"></a>1. Linux SSH2 Client/Server</h2></div></div></div><p>
             Since Linux is all about choices we have provided as an alternative the commercial verion of OpenSSH, The SSH2 and these installation instructions assume
             </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           Commands are Unix-compatible.
           </p></li><li class="listitem"><p>
           The source path is <code class="filename">/var/tmp</code>, <span class="emphasis"><em>other paths are possible</em></span>.
           </p></li><li class="listitem"><p>
           Installations were tested on Red Hat Linux 6.1 and 6.2.
           </p></li><li class="listitem"><p>
           All steps in the installation will happen in super-user account root.
           </p></li><li class="listitem"><p>
           SSH2 version number is <code class="literal">2.0.13</code>
           </p></li></ul></div><p>
           </p><p>
           Packages that you need can be downloaded from:
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
           SSH2 Homepage:<a class="link" href="#prtinxfp14" title="Linux SSH2 Client/Server">http://www.ssh.org/</a>
           </td></tr><tr><td>
           You must be sure to download: <code class="literal">ssh-2.0.13.tar.gz</code>
           </td></tr></table><p>
           </p><p>
           once you have got the Tarballs, It is a good idea to make a list of files on the system before you install ssh2, and one afterwards, and then compare them using diff to find out what file it placed where. Simply run 
           <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; SSH1</code></strong> before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; SSH2</code></strong> after you install the software, and use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>SSH1 SSH2 &gt; SSH-Installed</code></strong> 
           to get a list of what changed.
           </p><p>
           Before you Compile, you need to decompress the tarball <code class="literal">tar.gz</code>.
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>cp</strong></span> ssh-version.tar.gz /var/tmp
           [root@deep] /#<span class="command"><strong>cd</strong></span> /var/tmp
           [root@deep ]/tmp#<span class="command"><strong>tar</strong></span> xzpf ssh-version.tar.gz
           </pre><p>
           </p><p>
           You need to Compile and Optimize so move into the new SSH2 directory and type the following commands on your terminal:

           </p><pre class="programlisting">
           CC="egcs" \
           CFLAGS="-O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions" \
           ./configure \
           --prefix=/usr \
           --without-ssh-agent1-compat \
           --disable-suid-ssh-signer \
           --disable-tcp-port-forwarding \
           --disable-X11-forwarding \
           --enable-tcp-nodelay \
           --with-libwrap
           </pre><p>
           </p><p>
           This tells SSH2 to set itself up for this particular hardware setup as follows:
           </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           Leave out ssh-agent1 compatibility.
           </p></li><li class="listitem"><p>
           Install ssh-signer without suid bit.
           </p></li><li class="listitem"><p>
           Disable port forwarding support.
           </p></li><li class="listitem"><p>
           Disable <code class="literal">X11</code> forwarding support.
           </p></li><li class="listitem"><p>
           Enable <code class="envar">TCP_NODELAY</code> socket option.
           </p></li><li class="listitem"><p>
           Compile in libwrap <code class="literal">tcp_wrappers</code> support.
           </p></li></ul></div><p>
           </p><p>
           </p><pre class="screen">
           [root@deep ]/ssh-2.0.13#<span class="command"><strong>make clean</strong></span> 
           [root@deep ]/ssh-2.0.13#<span class="command"><strong> make</strong></span> 
           [root@deep ]/ssh-2.0.13#<span class="command"><strong> make install</strong></span> 
           [root@deep ]/ssh-2.0.13#<span class="command"><strong>rm</strong></span> -f  /usr/bin/ssh-askpass
           </pre><p>
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
           The <span class="command"><strong>make clean</strong></span>, command erase all previous traces of a compilation so as to avoid any mistakes, 
           </td></tr><tr><td>
           The <span class="command"><strong>make</strong></span> command compiles all source files into executable binaries, 
           </td></tr><tr><td>
           The <span class="command"><strong>make install</strong></span> command installs the binaries and any supporting files into the appropriate locations.
           </td></tr></table><p>
           </p><p>
           Please don't forget to cleanup after work:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>cd</strong></span> /var/tmp
           [root@deep ]/tmp#<span class="command"><strong>rm</strong></span> -rf ssh-version/ ssh-version.tar.gz
           </pre><p>
           The <span class="command"><strong>rm</strong></span> command as used above will remove all the source files we have used to compile and install SSH2. It will also remove the SSH2 compressed archive from 
           the <code class="filename">/var/tmp</code> directory.
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm8669"></a>2. Configure and Optimise SSH2</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
             You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
             for respective software. For example <em class="wordasword">SSH2</em> configuration file are organised like this:
             </p><pre class="literallayout"><code class="computeroutput">
               total 16
               -rw-r--r--    1 harrypotter    harrypotter         326 Jun  8 13:00 Compile-SSH2
               drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 pam.d/
               -rw-r--r--    1 harrypotter    harrypotter         462 Jun  8 13:00 ssh2_config
               -rw-r--r--    1 harrypotter    harrypotter         799 Jun  8 13:00 sshd2_config
             </code></pre><p>
             You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
             responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
           </p></div><p>
         To run the SSH2 Client/Server, the following files are required, and must be created or copied to the appropriate directories on your server.
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Copy the sshd2_config file to the <code class="filename">/etc/ssh2/</code> directory.
         </p></li><li class="listitem"><p>
         Copy the ssh2_config file to the <code class="filename">/etc/ssh2/</code> directory.
         </p></li><li class="listitem"><p>
         Copy the ssh file to the <code class="filename">/etc/pam.d/</code> directory.
         </p></li></ul></div><p>
         </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
         You can obtain the configuration files listed in the following section on our <code class="filename">floppy.tgz</code> archive. Copy the following files from the decompressed floppy.tgz archive to the appropriate places, or copy them directly from this book to the concerned file.
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm8707"></a>3. Configure the <code class="filename">/etc/ssh2/ssh2_config</code> file</h2></div></div></div><p>
         The configuration file for ssh2 <code class="filename">/etc/ssh2/ssh2_config</code> allows you to set options that modify the operation of the client programs. The files contain keyword-value pairs, one per line, with keywords 
         being case insensitive. Here are the more important keywords; a complete listing is available in the man page for <span class="citerefentry"><span class="refentrytitle">ssh2</span>(1)</span>.
         </p><p>
         Edit the <code class="filename">ssh2_config</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/ssh2/ssh2_config</code> and add or change, if necessary:
         </p><pre class="programlisting">
         # ssh2_config
         # SSH 2.0 Client Configuration File

         *:Port                            	22
         Ciphers                         	blowfish 
         Compression                     	yes
         IdentityFile                    	identification
         AuthorizationFile               	authorization
         RandomSeedFile		                random_seed
         VerboseMode                     	no
         ForwardAgent                    	no
         ForwardX11                      	no
         PasswordPrompt		                "%U's password: "
         Ssh1Compatibility               	no
         Ssh1AgentCompatibility	                none
         NoDelay                         	yes
         KeepAlive                       	yes
         QuietMode                       	no
         </pre><p>
         This tells ssh2_config file to set itself up for this particular configuration setup with:
         </p><div class="glosslist"><dl><dt><span class="glossterm">
         <code class="envar">Port 22</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">Port</code> specifies on which port number ssh connects to on the remote host. The default port is 22.
         </p></dd><dt><span class="glossterm">
         <code class="envar">Ciphers blowfish</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">Ciphers</code> specifies what cipher should be used for encrypting sessions. The blowfish uses 64-bit blocks and keys of up to 448 bits.
         </p></dd><dt><span class="glossterm">
         <code class="envar">Compression yes</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">Compression</code> specifies whether to use compression during sessions. Compression will improve communication speed and files transfers.
         </p></dd><dt><span class="glossterm">
         <code class="envar">IdentityFile identification</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">IdentityFile</code> specifies an alternate name for the user's identification file.
         </p></dd><dt><span class="glossterm">
         <code class="envar">AuthorizationFile authorization</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">AuthorizationFile</code> specifies an alternate name for the user's authorization file.
         </p></dd><dt><span class="glossterm">
         <code class="envar">RandomSeedFile random_seed</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">RandomSeedFile</code> specifies an alternate name for the user's random seed file.
         </p></dd><dt><span class="glossterm">
         <code class="envar">VerboseMode no</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">VerboseMode</code> instructs ssh2 to print debugging messages about its progress. This option is helpful in debugging connection, authentication, and configuration problems.
         </p></dd><dt><span class="glossterm">
         <code class="envar">ForwardAgent no</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">ForwardAgent</code> specifies which connection authentication agent <span class="emphasis"><em>if any</em></span> should be forwarded to the remote machine.
         </p></dd><dt><span class="glossterm">
         <code class="envar">ForwardX11 no</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">ForwardX11</code> is for people that use the <code class="literal">Xwindow</code> <acronym class="acronym">GUI</acronym> and want to automatically redirect <code class="literal">X11</code> sessions to the remote machine. Since 
         we've set up a server and do not have a <acronym class="acronym">GUI</acronym> installed on it, we can safely turn this option off.
         </p></dd><dt><span class="glossterm">
         <code class="envar">PasswordPrompt "%U's password: "</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">PasswordPrompt</code> specifies the password prompt that will be displayed for the user when connecting to a host. Variables <code class="prompt">%</code>U and <code class="prompt">%</code>H give the user's login name and host, respectively.
         </p></dd><dt><span class="glossterm">
         <code class="envar">Ssh1Compatibility no</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">Ssh1Compatibility</code> specifies whether or not to use SSH1 compatibility code with SSH2 for ssh1 users.
         </p></dd><dt><span class="glossterm">
         <code class="envar">Ssh1AgentCompatibility none</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">Ssh1AgentCompatibility</code> specifies whether or not to also forward SSH1 agent connections with SSH2 for ssh1 users.
         </p></dd><dt><span class="glossterm">
         <code class="envar">NoDelay yes</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">NoDelay</code> specifies if the socket option <code class="envar">TCP_NODELAY</code> should be enabled. It is recommended that you set this option to <strong class="userinput"><code>yes</code></strong> to improve network performance.
         </p></dd><dt><span class="glossterm">
         <code class="envar">KeepAlive yes</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">KeepAlive</code> specifies whether the system should send keep alive messages to the remote server. If set to <strong class="userinput"><code>yes</code></strong> then the death of the connection or crash of remote machines will be properly noticed.
         </p></dd><dt><span class="glossterm">
         <code class="envar">QuietMode no</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">QuietMode</code> specifies whether the system runs in quiet mode. This option must be set to <strong class="userinput"><code>no</code></strong> because in quiet mode, nothing is logged in the system log except for fatal errors. Since we 
         want to have information about users sessions it is preferable to disable this option.
         </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm8822"></a>4. Configure the <code class="filename">/etc/ssh2/sshd2_config</code> file</h2></div></div></div><p>
         The configuration file for sshd2 <code class="filename">/etc/ssh2/sshd2_config</code> allows you to set options that modify the operation of the daemon. The files contain keyword-value pairs, one per line, with keywords 
         being case insensitive. Here are the more important keywords; a complete listing is available in the man page for <span class="citerefentry"><span class="refentrytitle">sshd2</span>(8)</span>.
         </p><p>
         Edit the <code class="filename">sshd2_config</code> file (vi <code class="filename">/etc/ssh2/sshs2_config</code> and add or change, if necessary:
         </p><pre class="programlisting">
         # sshd2_config
         # SSH 2.0 Server Configuration File

         *:Port	                                22
         ListenAddress	                        192.168.1.1
         Ciphers	                        blowfish
         IdentityFile	                        identification
         AuthorizationFile	                authorization
         HostKeyFile                     	hostkey
         PublicHostKeyFile	                hostkey.pub
         RandomSeedFile	                        random_seed
         ForwardAgent	                        no
         ForwardX11	                        no
         PasswordGuesses	                3
         MaxConnections	                        5 
         PermitRootLogin	                no
         AllowedAuthentications	                publickey,password
         RequiredAuthentications	        publickey,password
         VerboseMode	                        no
         PrintMotd	                        yes
         CheckMail	                        yes
         UserConfigDirectory	                "%D/.ssh2"
         SyslogFacility                  	DAEMON
         Ssh1Compatibility               	no
         NoDelay                         	yes
         KeepAlive                       	yes
         UserKnownHosts	                        yes
         AllowHosts	                        192.168.1.4
         DenyHosts	                        *
         QuietMode                       	no

         # subsystem definitions

         subsystem-sftp                  	sftp-server
         </pre><p>
         This tells sshd2_config file to set itself up for this particular configuration setup with:
         </p><div class="glosslist"><dl><dt><span class="glossterm">
         <code class="envar">Port 22</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">Port</code> specifies which port number the ssh2 daemon listens to for ssh incoming connection. The default port is 22.
         </p></dd><dt><span class="glossterm">
         <code class="envar">ListenAddress 192.168.1.1</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">ListenAddress</code> specifies the <acronym class="acronym">IP</acronym> address of the interface network on which the ssh2 daemon server socket is bound. The default is <code class="literal">0.0.0.0</code>; to improve security you may 
         specify only the required ones to limit possible addresses.
         </p></dd><dt><span class="glossterm">
         <code class="envar">Ciphers blowfish</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">Ciphers</code> specifies what cipher should be used for encrypting sessions. The blowfish uses 64-bit blocks and keys of up to 448 bits.
         </p></dd><dt><span class="glossterm">
         <code class="envar">IdentityFile identification</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">IdentityFile</code> specifies an alternate name for the user's identification file.
         </p></dd><dt><span class="glossterm">
         <code class="envar">AuthorizationFile authorization</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">AuthorizationFile</code> specifies an alternate name for the user's authorization file.
         </p></dd><dt><span class="glossterm">
         <code class="envar">HostKeyFile hostkey</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">HostKeyFile</code> specifies an alternate file containing the private host key. The default is <code class="filename">/etc/ssh2/hostkey</code>.
         </p></dd><dt><span class="glossterm">
         <code class="envar">PublicHostKeyFile hostkey.pub</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">PublicHostKeyFile</code> specifies an alternate file containing the public host key. The default is <code class="filename">/etc/ssh2/hostkey.pub</code>.
         </p></dd><dt><span class="glossterm">
         <code class="envar">RandomSeedFile random_seed</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">RandomSeedFile</code> specifies an alternate name for the user's random seed file.
         </p></dd><dt><span class="glossterm">
         <code class="envar">ForwardAgent no</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">ForwardAgent</code> specifies which connection authentication agent <span class="emphasis"><em>if any</em></span> should be forwarded to the remote machine.
         </p></dd><dt><span class="glossterm">
         <code class="envar">ForwardX11 no</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">ForwardX11</code> is for people that use the <code class="literal">Xwindow</code> <acronym class="acronym">GUI</acronym> and want to automatically redirect <code class="literal">X11</code> sessions to the remote machine. Since we set up a server and don't have 
         a <acronym class="acronym">GUI</acronym> installed on it, we can safely turn this option off.
         </p></dd><dt><span class="glossterm">
         <code class="envar">PasswordGuesses 3</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">PasswordGuesses</code> specifies how many tries the user has when using password authentication.
         </p></dd><dt><span class="glossterm">
         <code class="envar">MaxConnections 5</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">MaxConnections</code> specifies what the maximum number of connections that ssh2 daemon will handle simultaneously is.
         </p></dd><dt><span class="glossterm">
         <code class="envar">PermitRootLogin no</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">PermitRootLogin</code> specifies whether root can log in using ssh. Never say, <strong class="userinput"><code>yes</code></strong> to this option.
         </p></dd><dt><span class="glossterm">
         <code class="envar">AllowedAuthentications publickey,password</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">AllowedAuthentications</code> specifies which authentication methods are allowed to be used. With this option the administrator can force users to complete several authentications before 
         they are considered authenticated.
         </p></dd><dt><span class="glossterm">
         <code class="envar">RequiredAuthentications publickey,password</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">RequiredAuthentications</code> related to <code class="envar">AllowedAuthentications</code>, specifies which authentication methods the users must complete before continuing. This parameter must be the same as 
         for the <code class="envar">AllowedAuthentications</code> option or the server will denies connection every time.
         </p></dd><dt><span class="glossterm">
         <code class="envar">VerboseMode no</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">VerboseMode</code> instructs the ssh2 daemon to print debugging messages about its progress. This option is helpful in debugging connection, authentication, and configuration problems.
         </p></dd><dt><span class="glossterm">
         <code class="envar">PrintMotd yes</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">PrintMotd</code> specifies whether the ssh2 daemon should print the content of the <code class="filename">/etc/motd</code> file when a user logs in interactively. The <code class="filename">/etc/motd</code> file is also 
         know as the <span class="emphasis"><em>message of the day</em></span>.
         </p></dd><dt><span class="glossterm">
         <code class="envar">CheckMail yes</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">CheckMail</code> specifies whether the ssh2 daemon should print information about new mail you may have.
         </p></dd><dt><span class="glossterm">
         <code class="envar">UserConfigDirectory "%D/.ssh2"</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">UserConfigDirectory</code> specifies the default location for user-specific configuration data.
         </p></dd><dt><span class="glossterm">
         <code class="envar">SyslogFacility DAEMON</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">SyslogFacility</code> specifies the facility code used when logging messages from the ssh2 daemon. The facility specifies the subsystem that produced the message, in our case <code class="envar">DAEMON</code>.
         </p></dd><dt><span class="glossterm">
         <code class="envar">Ssh1Compatibility no</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">Ssh1Compatibility</code> specifies whether or not to use SSH1 compatibility code with SSH2 for ssh1 users.
         </p></dd><dt><span class="glossterm">
         <code class="envar">NoDelay yes</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">NoDelay</code> specifies if the socket option TCP_NODELAY should be enabled. It is recommended that you set this option to <strong class="userinput"><code>yes</code></strong> to improve network performance.
         </p></dd><dt><span class="glossterm">
         <code class="envar">KeepAlive yes</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">KeepAlive</code> specifies whether the system should send keep alive messages to the remote server. If set to <strong class="userinput"><code>yes</code></strong> then the death of the connection or crash of 
         remote machines will be properly noticed.
         </p></dd><dt><span class="glossterm">
         <code class="envar">UserKnownHosts yes</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">UserKnownHosts</code> specifies whether the default user's home directory <code class="prompt">$</code><code class="filename">HOME/.ssh2/knownhosts/</code> can be used to get hosts public keys when using <em class="wordasword">hostbased-authentication</em>.
         </p></dd><dt><span class="glossterm">
         <code class="envar">AllowHosts 192.168.1.4</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">AllowHosts</code> specifies and control which hosts can access ssh2 services. Multiple hosts can be specified separated by spaces.
         </p></dd><dt><span class="glossterm">
         <code class="envar">DenyHosts *</code></span></dt><dd class="glossdef"><p>
         The option <code class="envar">DenyHosts</code> specifies and controls which hosts cannot access ssh2 services. Multiple hosts can be specified separated by spaces. The default pattern <code class="literal">*</code> mean all hosts.
         </p></dd><dt><span class="glossterm">
         <code class="envar">QuietMode no</code>
         </span></dt><dd class="glossdef"><p>
         The option <code class="envar">QuietMode</code> specifies whether the system runs in quiet mode. This option must be set to <strong class="userinput"><code>no</code></strong>, because in quiet mode nothing is logged in the system log except for fatal 
         errors. Since we want to have information about user sessions it is preferable to disable this option.
         </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9020"></a>5. Configure sshd2 to use tcp-wrappers/inetd super server</h2></div></div></div><p>
         Tcp-wrappers shoud be enabled to start and stop the sshd2 server. Upon execution, inetd reads its configuration information from a configuration file which, by default, is <code class="filename">/etc/inetd.conf</code>. There 
         must be an entry for each field of the configuration file, with entries for each field separated by a tab or a space.
         </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
         
         Edit the <code class="filename">inetd.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/inetd.conf</code> and add the line:
         </p><pre class="programlisting">
         ssh	stream	tcp	nowait	root	/usr/sbin/tcpd	sshd -i
         </pre><p>
         </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
         The  -i parameter is important since it specifies that sshd is being run from inetd. Also, update your <code class="filename">inetd.conf</code> file by sending a SIGHUP signal, <span class="command"><strong>killall</strong></span>  -HUP inetd 
         after adding the above line into the file.
         </p></div><p>
         To update your <code class="filename">inetd.conf</code> file, use the following command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>killall</strong></span>  -HUP inetd
         </pre><p>
         </p></li><li class="step"><p>
         
         Edit the <code class="filename">hosts.allow file</code>, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/hosts.allow</code> and add the line:
         </p><pre class="programlisting">
         sshd: 192.168.1.4 win.openna.com
         </pre><p>
         Which means client <code class="literal">192.168.1.4</code> with host name <code class="literal">win.openna.com</code> is allowed to ssh on the server.
         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
           These <code class="literal">daemon</code> strings for tcp-wrappers are in use by sshd2:
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         sshd, sshd2</span></dt><dd><p>
         The name sshd2 was called with usually <em class="wordasword">sshd</em>.
         </p></dd><dt><span class="term">
         sshdfwd-X11</span></dt><dd><p>
         if you want to allow/deny X11-forwarding.
         </p></dd><dt><span class="term">
         sshdfwd-&lt;port-number&gt;</span></dt><dd><p>
         for tcp-forwarding.
         </p></dd><dt><span class="term">
         sshdfwd-&lt;port-name&gt;</span></dt><dd><p>
         port-name defined in <code class="filename">/etc/services</code>. Used in tcp-forwarding.
         </p></dd></dl></div><p>
         </p></div><p>
         
         </p></li></ol></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
         If you do decide to switch to using ssh, make sure you install and use it on all your servers. Having ten secure servers and one insecure is a waste of time.
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9082"></a>6. Configuration of the <code class="filename">/etc/pam.d/ssh</code> file</h2></div></div></div><p>
         For better security of your ssh2 server, you can configure it to use pam authentication. To do that, you must create the <code class="filename">/etc/pam.d/ssh</code> file.
         </p><p>
         Create the ssh file <span class="command"><strong>touch</strong></span> <code class="filename">/etc/pam.d/ssh</code> and add or change, if necessary:
         </p><pre class="programlisting">
         #<code class="prompt">%</code>PAM-1.0
         auth	        required     /lib/security/pam_pwdb.so shadow
         auth	        required     /lib/security/pam_nologin.so
         account	required     /lib/security/pam_pwdb.so
         password	required     /lib/security/pam_cracklib.so
         password	required     /lib/security/pam_pwdb.so use_authtok nullok md5 shadow
         session	required     /lib/security/pam_pwdb.so
         </pre><p>
         </p><p>
         For Further documentation and more details, there are several man pages you can read:
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <span class="citerefentry"><span class="refentrytitle">ssh-add2</span>(1)</span></span></dt><dd><p>
         - adds identities for the authentication agent
         </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ssh-agent2</span>(1)</span></span></dt><dd><p>
         - authentication agent
         </p></dd><dt><span class="term">
         <span class="citerefentry"><span class="refentrytitle">ssh-keygen2</span>(1)</span></span></dt><dd><p>
         - authentication key pair generation
         </p></dd><dt><span class="term">
         <span class="citerefentry"><span class="refentrytitle">ssh2</span>(1)</span></span></dt><dd><p>
         - secure shell client <span class="emphasis"><em>remote login program</em></span>
         </p></dd><dt><span class="term">
         <span class="citerefentry"><span class="refentrytitle">sshd2</span>(8)</span></span></dt><dd><p>
         - secure shell daemon
         </p></dd></dl></div><p>
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9130"></a>7. Ssh2 Per-User Configuration</h2></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>         
         Create your private &amp; public keys of local, by executing:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>su</strong></span> admin
         [admin@deep /]$ ssh-keygen2
         </pre><p>
         </p><pre class="programlisting">
         Generating 1024-bit dsa key pair
         6 Oo..oOo.oOo.
         Key generated.
         1024-bit dsa, admin@deep.openna.com, Sun Feb 13 2000 05:33:38 -0500
         Passphrase :
         Again      :
         Private key saved to /home/admin/.ssh2/id_dsa_1024_a
         Public key saved to /home/admin/.ssh2/id_dsa_1024_a.pub
         </pre><p>
         </p></li><li class="step"><p>
         
         Create an <code class="filename">identification</code> file in your <code class="filename">~/.ssh2</code> home directory on local:
         </p><pre class="screen">
         [admin@deep]$<span class="command"><strong>cd</strong></span> ~/.ssh2
         [admin@deep ]/.ssh2$<span class="command"><strong>echo</strong></span> "IdKey id_dsa_1024_a" &gt; identification
         </pre><p>
         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         It's optional to create an identification file on Remote. The identification file contains the name of the private key that is to be used in authentication.
         </p></div><p>
         </p></li><li class="step"><p>
         Copy your public key of Local <em class="wordasword">id_dsa_1024_a.pub</em> to <code class="filename">~/.ssh2</code> home directory of remote under the name, say, <code class="filename">Local.pub</code>.
         </p></li><li class="step"><p>         
         Create an <code class="filename">authorization file</code> in your <code class="filename">~/.ssh2</code> home directory on remote:
         </p><pre class="screen">
         [admin@remote ]/.ssh2$<span class="command"><strong>touch</strong></span> authorization
         </pre><p>
         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         The <code class="filename">~/</code> means the user home directory.
         </p></div><p>
         </p></li><li class="step"><p>         
         Add the following one line to the <code class="filename">authorization</code> file on the remote host:
         </p><pre class="screen">
         [admin@remote ]/.ssh2$<span class="command"><strong>vi</strong></span> authorization
         </pre><p>
         </p><pre class="programlisting">
         key                     Local.pub
         </pre><p>
         </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9179"></a>8. SSH2 Users Tools</h2></div></div></div><p>
         The commands listed below are some that we use often in our regular use, but many more exist, and you should check the man page and documentation for more details.
         </p><p><b>ssh2. </b>
         Ssh2, Secure Shell provides secure encrypted communications between two untrusted hosts over an insecure network. It is a program for logging securely into a remote machine and executing commands from there. It 
         is a suitable replacement for insecure program like telnet, rlogin, rcp, rdist, and rsh.

         To login to a remote machine, use the command:
         </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>ssh2</strong></span> -l &lt;login_name&gt; &lt;hostname&gt;         
         </pre><p>

         
         </p><div class="example"><a name="idm9187"></a><p class="title"><b>Example 16.1. login to a remote using ssh2</b></p><div class="example-contents"><p>
           </p><pre class="screen">
         [root@deep] /#<span class="command"><strong>ssh2</strong></span> -l admin www.openna.com
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Passphrase for key "/home/admin/.ssh2/id_dsa_1024_a" with comment "1024-bit dsa, admin@deep.openna.com, Tue Oct 19 1999 14:31:40 -0400":
         admin's password: 
         Last login: Tue Oct 19 1999 18:13:00 -0400 from deep.openna.com
         No mail.
         </code></pre><p>
         </p><pre class="screen">
         [admin@www ]/admin$
         </pre><p>
         </p></div></div><p><br class="example-break">
         Where &lt;login_name&gt; is the name you use to connect to the ssh2 remote server and &lt;hostname&gt; is the address of your ssh2 remote server.
         </p><p><b>sftp2. </b>
         The sftp2, Secure File Transfer utility is an ftp-like client that provides file transfers over the network. You must already be connected with ssh2 before using the sftp2 utility.

         To ftp over ssh2, use the following command:
         </p><pre class="screen">
         [admin@deep /]$<span class="command"><strong>sftp2</strong></span> &lt;hostname&gt;
         </pre><p>
         
         </p><div class="example"><a name="idm9200"></a><p class="title"><b>Example 16.2. sftp2, Secure File Transfer</b></p><div class="example-contents"><p>
           </p><pre class="screen">
         [admin@deep /]$<span class="command"><strong>sftp2</strong></span> www.openna.com
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         local path  : /home/admin
         Passphrase for key "/home/admin/.ssh2/id_dsa_1024_a" with comment "1024-bit dsa, admin@deep.openna.com, Tue Oct 19 1999 14:31:40 -0400":
         admin's password: 
         admin's password: 
         remote path : /home/admin
         </code></pre><p>
         </p><pre class="screen">
         sftp&gt;
         </pre><p>
         </p></div></div><p><br class="example-break">
         Where &lt;hostname&gt; is the name of the remote server you want to sftp.
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9208"></a>9. Installed files</h2></div></div></div><p>These are the files Installed by Ssh2 software on your machine:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/pam.d/ssh</code></td><td><code class="filename">
          /usr/man/man1/sftp2.1
          </code></td><td><code class="filename">
          /usr/bin/ssh-keygen2
          </code></td></tr><tr><td><code class="filename">/etc/ssh2</code></td><td><code class="filename">
          /usr/man/man1/ssh.1
          </code></td><td><code class="filename">
          /usr/bin/ssh-signer2
          </code></td></tr><tr><td><code class="filename">
          /etc/ssh2/hostkey
          </code></td><td><code class="filename">
          /usr/man/man1/ssh-add.1
          </code></td><td><code class="filename">
          /usr/bin/ssh-add2
          </code></td></tr><tr><td><code class="filename">
          /etc/ssh2/hostkey.pub
          </code></td><td><code class="filename">
          /usr/man/man1/ssh-agent.1
          </code></td><td><code class="filename">
          /usr/bin/ssh
          </code></td></tr><tr><td><code class="filename">
          /etc/ssh2/sshd2_config
          </code></td><td><code class="filename">
          /usr/man/man1/ssh-keygen.1
          </code></td><td><code class="filename">
          /usr/bin/ssh-agent
          </code></td></tr><tr><td><code class="filename">
          /etc/ssh2/ssh2_config
          </code></td><td><code class="filename">
          /usr/man/man1/scp.1
          </code></td><td><code class="filename">
          /usr/bin/ssh-add
          </code></td></tr><tr><td><code class="filename">
          /root/.ssh2
          </code></td><td><code class="filename">
          /usr/man/man1/sftp.1
          </code></td><td><code class="filename">
          /usr/bin/ssh-askpass
          </code></td></tr><tr><td><code class="filename">
          /root/.ssh2/random_seed
          </code></td><td><code class="filename">
          /usr/man/man8/sshd2.8
          </code></td><td><code class="filename">
          /usr/bin/ssh-keygen
          </code></td></tr><tr><td><code class="filename">
          /root/ssh2
          </code></td><td><code class="filename">
          /usr/man/man8/sshd.8
          </code></td><td><code class="filename">
          /usr/bin/scp
          </code></td></tr><tr><td><code class="filename">
          /usr/man/man1/ssh2.1
          </code></td><td><code class="filename">
          /usr/bin/ssh2     
          </code></td><td><code class="filename">
          /usr/bin/sftp
          </code></td></tr><tr><td><code class="filename">
          /usr/man/man1/ssh-keygen2.1
          </code></td><td><code class="filename">
          /usr/bin/scp2
          </code></td><td><code class="filename">
          /usr/bin/sftp-server
          </code></td></tr><tr><td><code class="filename">
          /usr/man/man1/ssh-add2.1
          </code></td><td><code class="filename">
          /usr/bin/sftp2
          </code></td><td><code class="filename">
          /usr/bin/ssh-signer
          </code></td></tr><tr><td><code class="filename">
          /usr/man/man1/ssh-agent2.1
          </code></td><td><code class="filename">
          /usr/bin/sftp-server2
          </code></td><td><code class="filename">
          /usr/sbin/sshd2
          </code></td></tr><tr><td><code class="filename">
          /usr/man/man1/scp2.1
          </code></td><td><code class="filename">
          /usr/bin/ssh-agent2
          </code></td><td><code class="filename">
          /usr/sbin/sshd
          </code></td></tr></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="pr6ch17SSSI"></a>Chapter 17. Software -Securities/System Integrity</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#prt6ch3sc1trwr">1. Linux Tripwire 2.2.1</a></span></dt><dt><span class="section"><a href="#idm9368">2. Configure the <code class="filename">/var/tmp/install.cfg</code> file</a></span></dt><dt><span class="section"><a href="#idm9423">3. Configuration files</a></span></dt><dt><span class="section"><a href="#idm9454">4. Configure the <code class="filename">/usr/TSS/policy/twpol.txt</code> file</a></span></dt><dt><span class="section"><a href="#idm9482">5. Securing Tripwire for Linux</a></span></dt><dd><dl><dt><span class="section"><a href="#idm9547">5.1. Often used Commands</a></span></dt></dl></dd><dt><span class="section"><a href="#idm9566">6. Integrity or Interactive Check Mode</a></span></dt><dt><span class="section"><a href="#idm9608">7. Installed files</a></span></dt></dl></div><div class="highlights"><p>
            A typical Red Hat Linux server installation handles approximately 30,400 files. At their busiest times, administrators can't check the integrity of all system files, and if a cracker has accessed your 
            server, he or she can install or modify files without your knowledge with some effort. Since such a possibility exists a few programs have been created to respond to this kind of activity.
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prt6ch3sc1trwr"></a>1. Linux Tripwire 2.2.1</h2></div></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>According to the official [<span class="citation">Tripwire site</span>]:</b></p></div></div></div><p>
           Tripwire works at the most fundamental layer, protecting the servers and workstations that make up the corporate network. Tripwire works by first scanning a computer and creating a database of system files, a compact 
           digital <em class="wordasword">snapshot</em> of the system in a known secure state. The user can configure Tripwire very precisely, specifying individual files and directories on each machine to monitor, or creating a 
           standard template that can be used on all machines in an enterprisewide environement.
           </p><p>
           Once this baseline database is created, a system administrator can use Tripwire to check the integrity of a system at any time. By scanning the current system and comparing that information with the data stored 
           in the database, Tripwire detects and reports any additions, deletions, or changes to the system outside of the specified boundaries. If these changes are valid, the administrator can update the baseline database 
           with the new information.  If malicious changes are found, the system administrator will instantly know exactly which part, which component <abbr class="abbrev">etc.</abbr> of the network have been affected.
           </p></div><p>
           This version of Tripwire has significant product enhancements over previous versions of Tripwire. Some of the enhancements include:
           </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           Multiple levels of reporting allow you to choose different levels of report detail.
           </p></li><li class="listitem"><p>
           Syslog option sends information about database initialization, database update, policy update and integrity check to the syslog.
                      </p></li><li class="listitem"><p>
           Database performance has been optimized to increase the efficiency of integrity checks.
                      </p></li><li class="listitem"><p>
           Individual email recipients can be sent certain sections of a report.
                      </p></li><li class="listitem"><p>
           SMTP email reporting support.
                      </p></li><li class="listitem"><p>
           Email test mode enables you to verify that the email settings are correct.
                      </p></li><li class="listitem"><p>
           Ability to create multiple sections within a policy file to be executed separately.
                      </p></li></ul></div><p>
           </p><p>

           These installation instructions assume:
           </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           Commands are Unix-compatible.
           </p></li><li class="listitem"><p>
           The source path is <code class="filename">/var/tmp</code> -<span class="emphasis"><em>other paths are possible</em></span>.
                      </p></li><li class="listitem"><p>
           Installations were tested on Red Hat Linux 6.1 and 6.2.
                      </p></li><li class="listitem"><p>
           All steps in the installation will happen in super-user account root.
                      </p></li><li class="listitem"><p>
           Tripwire version number is <code class="literal">2.2.1</code>
                      </p></li></ul></div><p>
           </p><p>
           These are the Package(s) you need to install:
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
           Tripwire Homepage: <a class="link" href="#prtinxfp15" title="Linux Tripwire 2.2.1">http://www.tripwiresecurity.com/</a>
           </td></tr><tr><td>
           You must be sure to download: Tripwire_221_for_Linux_x86_tar.gz
           </td></tr></table><p>
           </p><p>
           To Compile Tripwire-2.2.1, you do need to Decompress the tarball <code class="literal">tar.gz</code>.:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>cp</strong></span> Tripwire_version_for_Linux_x86_tar.gz /var/tmp
           [root@deep] /#<span class="command"><strong>cd</strong></span> /var/tmp
           [root@deep ]/tmp# <span class="command"><strong>tar</strong></span>  xzpf Tripwire_version_for_Linux_x86_tar.gz
           </pre><p>
           </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
           After the decompression of Tripwire you will see the following files in your <code class="filename">/var/tmp</code> directory related to Tripwire software: 
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
           License.txt
           </td></tr><tr><td>
           README
                      </td></tr><tr><td>
           Release_Notes
                      </td></tr><tr><td>
           install.cfg
                      </td></tr><tr><td>
           install.sh
                      </td></tr><tr><td>
           package directory 
                      </td></tr><tr><td>
           Tripwire tar.gz file Tripwire_version_for_Linux_x86_tar.gz.
                      </td></tr></table><p>
           </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9368"></a>2. Configure the <code class="filename">/var/tmp/install.cfg</code> file</h2></div></div></div><p>
           Recall that Tripwire version <code class="literal">2.2.1</code> is not open source, so you cannot compile and install it like other archives source files, instead you must modify the <code class="filename">install.cfg</code> file of tripwire that will install 
           automatically Tripwire software for you to specify installation paths for your system. We must modify this file to be compliant with Red Hats file system structure and install Tripwire binaries under 
           our <code class="envar">PATH</code> Environment Variable.
           </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
           Edit the <code class="filename">install.cfg</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">install.cfg</code> and change this file to look like:
           </p><pre class="programlisting">
           #
           # install.cfg
           #
           # default install.cfg for:
           # Tripwire(R) 2.2.1 for Unix
           #
           # NOTE:  This is a Bourne shell script that stores installation
           #        parameters for your installation.  The installer will
           #        execute this file to generate your config file and also to
           #        locate any special configuration needs for your install.
           #        Protect this file, because it is possible for
           #        malicious code to be inserted here
           #
           # To set your Root directory for install, set TWROOT= to something
           # other than /usr/TSS as necessary.
           #
           #=======================================================

           # If CLOBBER is true, then existing files are overwritten.
           # If CLOBBER is false, existing files are not overwritten.
           CLOBBER=false

           # The root of the TSS directory tree.
           TWROOT="/usr"

           # Tripwire binaries are stored in TWBIN.
           TWBIN="${TWROOT}/bin"

           # Tripwire policy files are stored in TWPOLICY.
           TWPOLICY="${TWROOT}/TSS/policy"

           # Tripwire manual pages are stored in TWMAN.
           TWMAN="${TWROOT}/man"

           # Tripwire database files are stored in TWDB.
           TWDB="${TWROOT}/TSS/db"

           # The Tripwire site key files are stored in TWSITEKEYDIR.
           TWSITEKEYDIR="${TWROOT}/TSS/key"

           # The Tripwire local key files are stored in TWLOCALKEYDIR.
           TWLOCALKEYDIR="${TWROOT}/TSS/key"

           # Tripwire report files are stored in TWREPORT.
           TWREPORT="${TWROOT}/TSS/report"

           # This sets the default text editor for Tripwire.
           TWEDITOR="/bin/vi"

           # TWLATEPROMTING controls the point when tripwire asks for a password.
           TWLATEPROMPTING=false

           # TWLOOSEDIRCHK selects whether the directory should be monitored for 
           # properties that change when files in the directory are monitored.
           TWLOOSEDIRCHK=false

           # TWMAILNOVIOLATIONS determines whether Tripwire sends a no violation 
           # report when integrity check is run with --email-report but no rule
           # violations are found.  This lets the admin know that the integrity 
           # was run, as opposed to having failed for some reason.
           TWMAILNOVIOLATIONS=true

           # TWEMAILREPORTLEVEL determines the verbosity of e-mail reports.
           TWEMAILREPORTLEVEL=3

           # TWREPORTLEVEL determines the verbosity of report printouts.
           TWREPORTLEVEL=3

           # TWSYSLOG determines whether Tripwire will log events to the system log
           TWSYSLOG=false

           #####################################
           # Mail Options - Choose the appropriate
           # method and comment the other section
           #####################################

           #####################################
           # SENDMAIL options - DEFAULT
           #
           # Either SENDMAIL or SMTP can be used to send reports via TWMAILMETHOD.
           # Specifies which sendmail program to use.
           #####################################

           TWMAILMETHOD=SENDMAIL
           TWMAILPROGRAM="/usr/lib/sendmail -oi -t"

           #####################################
           # SMTP options
           #
           # TWSMTPHOST selects the SMTP host to be used to send reports.
           # SMTPPORT selects the SMTP port for the SMTP mail program to use.
           #####################################

           # TWMAILMETHOD=SMTP
           # TWSMTPHOST="mail.domain.com"
           # TWSMTPPORT=25

           ################################################################################
           # Copyright (C) 1998-2000 Tripwire (R) Security Systems, Inc. Tripwire (R) is a
           # registered trademark of the Purdue Research Foundation and is licensed
           # exclusively to Tripwire (R) Security Systems, Inc.
           ################################################################################
           </pre><p>
           </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
           The file <code class="filename">install.cfg</code> is a Bourne shell script used by the installer to set configuration variables. These variables specify the target directories where the installer will copy files and what the 
           installer should do if the installation process would overwrite existing Tripwire software files.
           </p></div><p>
           </p></li><li class="step"><p>           
           Now we must run the installation script to install Tripwire binaries and related files on to our system according to whether you are using default or custom configuration values. To run the installation 
           script and install Tripwire, use the following command:
           </p><pre class="screen">
           [root@deep ]/tmp#<span class="command"><strong>./install.sh</strong></span>
           </pre><p>

           </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
           The install.sh file is the installation script which you run to begin installation of Tripwire. During the installation procedure, you will:
           </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
           Answer some questions related to the installation.
           </p></li><li class="listitem"><p>
           Specify two pass phrases to be assigned for your site and local keys.
           </p></li></ol></div><p>
           </p></div><p>
           </p></li><li class="step"><p>
           When Tripwire is installed in our system it will copy <code class="filename">License.txt</code>, <code class="filename">README</code>, and <code class="filename">Release_Notes</code> files under <code class="filename">/usr</code> directory. Of 
           course after finishing reading those files you can safely remove them from your <code class="filename">/usr</code> directory with the following command:

           To remove these files from your system, use the following command:
           </p><pre class="screen">
           [root@deep ]/usr# <span class="command"><strong>rm</strong></span> -f  /usr/License.txt README Release_Notes
           </pre><p>
           </p></li></ol></div><p>
           Dont forget to clean up later:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>cd</strong></span> /var/tmp
           [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf License.txt README Release-Notes install.cfg install.sh pkg/ Tripwire_version_for_Linux_x86_tar.gz
           </pre><p>
           The <span class="command"><strong>rm</strong></span> command as used above will remove all related files and directories we have used to install Tripwire for Linux. It will also remove the Tripwire for Linux compressed archive 
           from the <code class="filename">/var/tmp</code> directory.
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9423"></a>3. Configuration files</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
               You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
               for respective software. For example <em class="wordasword">Tripwire-2.2.1</em> configuration file are organised like this:
               </p><pre class="literallayout"><code class="computeroutput">
                 total 16
                 -rw-r--r--    1 harrypotter    harrypotter        3312 Jun  8 13:00 install.cfg
                 -rw-r--r--    1 harrypotter    harrypotter       10152 Jun  8 13:00 twpol.txt
               </code></pre><p>
               You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
               responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
             </p></div><p>
           To run Tripwire for Linux, the following file is required and must be created or copied to the appropriate directory on your server.

           Copy the <code class="filename">twpol.txt</code> file to the <code class="filename">/usr/TSS/policy</code> directory.
           </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
           You can obtain the configuration file listed below on our <code class="filename">floppy.tgz</code> archive. Copy the following file from the decompressed <code class="filename">floppy.tgz</code> archive to the appropriate place, or 
           copy and paste it directly from this book to the concerned file.
           </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9454"></a>4. Configure the <code class="filename">/usr/TSS/policy/twpol.txt</code> file</h2></div></div></div><p>
           The <code class="filename">/usr/TSS/policy/twpol.txt</code> is the text policy file of Tripwire where you specify what files and directories, to check. Note that extensive testing and experience are necessary when editing this policy file 
           before you get a working file report. The following is a working example from where you can start your own customization.
           </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
           You must modify the default policy file, or create your own. The <code class="filename">policyguide.txt</code> file under <code class="filename">/usr/TSS/policy</code> directory can help you. Open the policy 
           file <code class="filename">twpol.txt</code> with a text editor, <span class="command"><strong>vi</strong></span> <code class="filename">/usr/TSS/policy/twpol.txt</code> and change it to fit your needs:
           </p><pre class="programlisting">
           @@section GLOBAL
           TWROOT="/usr";
           TWBIN="/usr/bin";
           TWPOL="/usr/TSS/policy";
           TWDB="/usr/TSS/db";
           TWSKEY="/usr/TSS/key";
           TWLKEY="/usr/TSS/key";
           TWREPORT="/usr/TSS/report";
           HOSTNAME=deep.openna.com;

           @@section FS
           SEC_CRIT      	= $(IgnoreNone)-SHa;	# Critical files - we can't afford to miss any changes.
           SEC_SUID      	= $(IgnoreNone)-SHa;	# Binaries with the SUID or SGID flags set.
           SEC_TCB       	= $(ReadOnly);	# Members of the Trusted Computing Base.
           SEC_BIN       	= $(ReadOnly);	# Binaries that shouldn't change
           SEC_CONFIG	= $(Dynamic);	# Config files that are changed infrequently but accessed often.
           SEC_LOG       	= $(Growing);	# Files that grow, but that should never change ownership.
           SEC_INVARIANT = +pug;	# Directories that should never change permission or ownership.
           SIG_LOW       	= 33;	# Non-critical files that are of minimal security impact
           SIG_MED       	= 66;	# Non-critical files that are of significant security impact
           SIG_HI        	= 100;	# Critical files that are significant points of vulnerability


           # Tripwire Binaries
           (emailto = admin@openna.com, rulename = "Tripwire Binaries", severity = $(SIG_HI))
           {
           $(TWBIN)/siggen   	-&gt; $(ReadOnly);
           $(TWBIN)/tripwire 	-&gt; $(ReadOnly);
           $(TWBIN)/twadmin  	-&gt; $(ReadOnly);
           $(TWBIN)/twprint  	-&gt; $(ReadOnly);
           }

           # Tripwire Data Files - Configuration Files, Policy Files, Keys, Reports, Databases
           (emailto = admin@openna.com, rulename = "Tripwire Data Files", severity = $(SIG_HI))
           {
           # NOTE: Removing the inode attribute because when Tripwire creates a backup
           # it does so by renaming the old file and creating a new one (which will
           # have a new inode number).  Leaving inode turned on for keys, which shouldn't
           # ever change.

           # NOTE: this rule will trigger on the first integrity check after database
           # initialization, and each integrity check afterward until a database update 
           # is run, since the database file will not exist before that point.
           $(TWDB)                           		-&gt; $(Dynamic) -i;
           $(TWPOL)/tw.pol                   		-&gt; $(SEC_BIN) -i;
           $(TWBIN)/tw.cfg                   		-&gt; $(SEC_BIN) -i;
           $(TWLKEY)/$(HOSTNAME)-local.key   -&gt; $(SEC_BIN) ;
           $(TWSKEY)/site.key                		-&gt; $(SEC_BIN) ;

           #don't scan the individual reports
           $(TWREPORT)		-&gt; $(Dynamic) (recurse=0);  
           }

           # These files are critical to a correct system boot.
           (emailto = admin@openna.com, rulename = "Critical system boot files", severity = 100)
           {
           /boot                                 		-&gt; $(SEC_CRIT)  ;
           !/boot/System.map			;
           !/boot/module-info			;
           }

           # These files change the behavior of the root account
           (emailto = admin@openna.com, rulename = "Root config files", severity = 100)
           {
           /root                                 		-&gt; $(SEC_CRIT)   ;
           /root/.bash_history		-&gt; $(SEC_LOG)    ;
           }

           # Commonly accessed directories that should remain static with regards to owner and group
           (emailto = admin@openna.com, rulename = "Invariant Directories", severity = $(SIG_MED))
           {
           /       						-&gt; $(SEC_INVARIANT) (recurse = 0);
           /home   						-&gt; $(SEC_INVARIANT) (recurse = 0); 
           /etc    						-&gt; $(SEC_INVARIANT) (recurse = 0);
           /chroot 						-&gt; $(SEC_INVARIANT) (recurse = 0);
           /cache						-&gt; $(SEC_INVARIANT) (recurse = 0);
           }

           (emailto = admin@openna.com, rulename = "Shell Binaries")
           {
           /bin/bsh            		-&gt; $(SEC_BIN);
           /bin/csh            		-&gt; $(SEC_BIN);
           /bin/sh             		-&gt; $(SEC_BIN);
           }

           # Rest of critical system binaries
           (emailto = admin@openna.com, rulename = "OS executables and libraries", severity = $(SIG_HI))
           {
           /bin                                  		-&gt; $(ReadOnly)   ;
           /lib                                  		-&gt; $(ReadOnly)   ;
           }

           # Local files
           (emailto = admin@openna.com, rulename = "User binaries", severity = $(SIG_MED))
           {
           /sbin                       		-&gt; $(SEC_BIN) (recurse = 1);
           /usr/sbin                   		-&gt; $(SEC_BIN) (recurse = 1);
           /usr/bin                    		-&gt; $(SEC_BIN) (recurse = 1);
           }

           # Temporary directories
           (emailto = admin@openna.com, rulename = "Temporary directories", recurse = false, severity = $(SIG_LOW))
           {
           /usr/tmp                    		-&gt; $(SEC_INVARIANT);
           /var/tmp                    		-&gt; $(SEC_INVARIANT);
           /tmp                        		-&gt; $(SEC_INVARIANT);
           }

           # Libraries
           (emailto = admin@openna.com, rulename = "Libraries", severity = $(SIG_MED))
           {
           /usr/lib 						-&gt; $(SEC_BIN);
           }

           # Include
           (emailto = admin@openna.com, rulename = "OS Development Files", severity = $(SIG_MED))
           {
           /usr/include 					-&gt; $(SEC_BIN);
           }

           # Shared
           (emailto = admin@openna.com, rulename = "OS Shared Files", severity = $(SIG_MED))
           {
           /usr/share 					-&gt; $(SEC_BIN);
           }

           # Kernel headers files
           (emailto = admin@openna.com, rulename = "Kernel Headers Files", severity = $( SIG_HI))
           {
           /usr/src/linux-2.2.14 				-&gt; $(SEC_BIN);
           }

           # setuid/setgid root programs
           (emailto = admin@openna.com, rulename = "setuid/setgid", severity = $(SIG_HI))
           {
           /bin/su 						-&gt; $(SEC_SUID);
           /sbin/pwdb_chkpwd 			-&gt; $(SEC_SUID);
           /sbin/dump 					-&gt; $(SEC_SUID);
           /sbin/restore 					-&gt; $(SEC_SUID);
           /usr/bin/at 					-&gt; $(SEC_SUID);
           /usr/bin/passwd 				-&gt; $(SEC_SUID);
           /usr/bin/suidperl 				-&gt; $(SEC_SUID);
           /usr/bin/crontab 				-&gt; $(SEC_SUID);
           /usr/sbin/sendmail 				-&gt; $(SEC_SUID);
           /usr/bin/man 					-&gt; $(SEC_SUID);
           /usr/bin/sperl5.00503 			-&gt; $(SEC_SUID);
           /usr/bin/slocate 				-&gt; $(SEC_SUID);
           /usr/sbin/utempter 				-&gt; $(SEC_SUID);
           /sbin/netreport 				-&gt; $(SEC_SUID);
           }

           (emailto = admin@openna.com, rulename = "Configuration Files")
           {
           /etc/hosts                 		-&gt; $(SEC_CONFIG);
           /etc/inetd.conf            		-&gt; $(SEC_CONFIG);
           /etc/initlog.conf		-&gt; $(SEC_CONFIG);
           /etc/inittab               		-&gt; $(SEC_CONFIG);
           /etc/resolv.conf           		-&gt; $(SEC_CONFIG);
           /etc/syslog.conf           		-&gt; $(SEC_CONFIG);
           }

           (emailto = admin@openna.com, rulename = "Security Control")
           {
           /etc/group                		-&gt; $(SEC_CRIT);
           /etc/security/            		-&gt; $(SEC_CRIT);
           /lib/security/            		-&gt; $(SEC_CRIT);
           /var/spool/cron           		-&gt; $(SEC_CRIT);
           }

           (emailto = admin@openna.com, rulename = "Login Scripts")
           {
           /etc/csh.login                         		-&gt; $(SEC_CONFIG);
           /etc/profile                           		-&gt; $(SEC_CONFIG);
           }

           # These files change every time the system boots
           (emailto = admin@openna.com, rulename = "System boot changes", severity = $(SIG_HI))
           {
           /dev/log                              		-&gt; $(Dynamic)   ;
           /dev/cua0                             		-&gt; $(Dynamic)   ;
           /dev/console                          		-&gt; $(Dynamic)   ;
           /dev/tty2                             		-&gt; $(Dynamic)   ; # tty devices
           /dev/tty3                             		-&gt; $(Dynamic)   ; # are extremely
           /dev/tty4                             		-&gt; $(Dynamic)   ; # variable
           /dev/tty5                             		-&gt; $(Dynamic)   ;
           /dev/tty6                             		-&gt; $(Dynamic)   ;
           /dev/urandom                          		-&gt; $(Dynamic)   ;
           /dev/initctl                          		-&gt; $(Dynamic)   ;
           /var/lock/subsys                      		-&gt; $(Dynamic)   ;
           /var/run                              		-&gt; $(Dynamic)   ; # daemon PIDs
           /var/log                              		-&gt; $(Dynamic)   ;
           /etc/ioctl.save                       		-&gt; $(Dynamic)   ;
           /etc/.pwd.lock                        		-&gt; $(Dynamic)   ;
           /etc/mtab                             		-&gt; $(Dynamic)   ;
           /lib/modules                          		-&gt; $(Dynamic)   ;
           }

           # Critical configuration files
           (emailto = admin@openna.com, rulename = "Critical configuration files", severity = $(SIG_HI))
           {
           /etc/conf.modules                    	 	-&gt; $(ReadOnly)   ;
           /etc/crontab                          		-&gt; $(ReadOnly)   ;
           /etc/cron.hourly                      		-&gt; $(ReadOnly)   ;
           /etc/cron.daily                       		-&gt; $(ReadOnly)   ;
           /etc/cron.weekly                      		-&gt; $(ReadOnly)   ;
           /etc/cron.monthly                     		-&gt; $(ReadOnly)   ;
           /etc/default                          		-&gt; $(ReadOnly)   ;
           /etc/fstab                            		-&gt; $(ReadOnly)   ;
           /etc/group-         		-&gt; $(ReadOnly) 	  ;  # changes should be infrequent
           /etc/host.conf                        		-&gt; $(ReadOnly)   ;
           /etc/hosts.allow                      		-&gt; $(ReadOnly)   ;
           /etc/hosts.deny                       		-&gt; $(ReadOnly)   ;
           /etc/lilo.conf		-&gt; $(ReadOnly)   ;
           /etc/logrotate.conf		-&gt; $(ReadOnly)   ;
           /etc/pwdb.conf		-&gt; $(ReadOnly)   ;
           /etc/securetty		-&gt; $(ReadOnly)   ;
           /etc/sendmail.cf		-&gt; $(ReadOnly)   ;
           /etc/protocols                        		-&gt; $(ReadOnly)   ;
           /etc/services                         		-&gt; $(ReadOnly)   ;
           /etc/rc.d/init.d                      		-&gt; $(ReadOnly)   ;
           /etc/rc.d                             		-&gt; $(ReadOnly)   ;
           /etc/motd                             		-&gt; $(ReadOnly)   ;
           /etc/passwd                           		-&gt; $(ReadOnly)   ;
           /etc/passwd-                          		-&gt; $(ReadOnly)   ;
           /etc/profile.d                        		-&gt; $(ReadOnly)   ;
           /etc/rpc                              		-&gt; $(ReadOnly)   ;
           /etc/sysconfig                        		-&gt; $(ReadOnly)   ;
           /etc/shells		-&gt; $(ReadOnly)   ;
           /etc/nsswitch.conf                    		-&gt; $(ReadOnly)   ;
           }

           # Critical devices
           (emailto = admin@openna.com, rulename = "Critical devices", severity = $(SIG_HI), recurse = false)
           {
           /dev/kmem                             		-&gt; $(Device)   ;
           /dev/mem                              		-&gt; $(Device)   ;
           /dev/null                             		-&gt; $(Device)   ;
           /dev/zero                             		-&gt; $(Device)   ;
           /proc/devices                         		-&gt; $(Device)   ;
           /proc/net                             		-&gt; $(Device)   ;
           /proc/tty		-&gt; $(Device)   ;
           /proc/sys                             		-&gt; $(Device)   ;
           /proc/cpuinfo                         		-&gt; $(Device)   ;
           /proc/modules                         		-&gt; $(Device)   ;
           /proc/mounts                          		-&gt; $(Device)   ;
           /proc/dma                             		-&gt; $(Device)   ;
           /proc/filesystems                     		-&gt; $(Device)   ;
           /proc/ide		-&gt; $(Device)   ;
           /proc/interrupts                      		-&gt; $(Device)   ;
           /proc/ioports                         		-&gt; $(Device)   ;
           /proc/scsi                            		-&gt; $(Device)   ;
           /proc/kcore                           		-&gt; $(Device)   ;
           /proc/self                            		-&gt; $(Device)   ;
           /proc/kmsg                            		-&gt; $(Device)   ;
           /proc/stat                            		-&gt; $(Device)   ;
           /proc/ksyms                           		-&gt; $(Device)   ;
           /proc/loadavg                         		-&gt; $(Device)   ;
           /proc/uptime                          		-&gt; $(Device)   ;
           /proc/locks                           		-&gt; $(Device)   ;
           /proc/version                         		-&gt; $(Device)   ;
           /proc/meminfo                         		-&gt; $(Device)   ;
           /proc/cmdline                         		-&gt; $(Device)   ;
           /proc/misc                            		-&gt; $(Device)   ;
           }
           </pre><p>
           </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
           This is an example policy file we provide you; of course, you must modify this file to fit your system files and specific needs.
           </p></div><p>
          </p></li><li class="step"><p>
             Once you are ready to use your policy file for the first time, install it with the following command:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>twadmin</strong></span> --create-polfile /usr/TSS/policy/twpol.txt
           </pre><p>
           </p><pre class="literallayout"><code class="computeroutput">
           Please enter your site passphrase:
           Wrote policy file: /usr/TSS/policy/tw.pol
           </code></pre><p>
           </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9482"></a>5. Securing Tripwire for Linux</h2></div></div></div><p>
           It is important to make sure that the integrity of the system you are running has not been already compromised. For maximum confidence in your baseline database, you should generate operating system and application 
           files from a clean installation and original media. Also, it is recommended that you delete the plain text copy of the Tripwire configuration file named <code class="filename">twcfg.txt</code> located under the <code class="filename">/usr/bin</code>
           directory to hide the location of Tripwire's files and prevent anyone from creating a second, or alternate, configuration file.

           To delete the plain text copy of the tripwire configuration file, use the following command:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>rm</strong></span> -f  /usr/bin/twcfg.txt
           </pre><p>
           </p><p>
           Further documentation for more details, there are several man pages you can read:
           </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <span class="citerefentry"><span class="refentrytitle">siggen</span>(8)</span></span></dt><dd><p>
           - signature gathering routine for Tripwire
           </p></dd><dt><span class="term">
           <span class="citerefentry"><span class="refentrytitle">tripwire</span>(8)</span></span></dt><dd><p>
           - a file integrity checker for UNIX systems
           </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">twadmin</span>(8)</span></span></dt><dd><p>
             - Tripwire administrative and utility tool
             </p></dd><dt><span class="term">
           <span class="citerefentry"><span class="refentrytitle">twconfig</span>(4)</span></span></dt><dd><p>
           - Tripwire configuration file reference
           </p></dd><dt><span class="term">
           <span class="citerefentry"><span class="refentrytitle">twfiles</span>(5)</span></span></dt><dd><p>
           - overview of files used by Tripwire and file backup process
           </p></dd><dt><span class="term">
           <span class="citerefentry"><span class="refentrytitle">twintro</span>(8)</span></span></dt><dd><p>
           - introduction to Tripwire software
           </p></dd><dt><span class="term">
           <span class="citerefentry"><span class="refentrytitle">twpolicy</span>(4)</span></span></dt><dd><p>
           - Tripwire policy file reference
           </p></dd><dt><span class="term">
           <span class="citerefentry"><span class="refentrytitle">twprint</span>(8)</span></span></dt><dd><p>
           - Tripwire database and report printer
           </p></dd></dl></div><p>
           </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm9547"></a>5.1. Often used Commands</h3></div></div></div><p>
           The commands listed below are some that we use often in our regular use, but many more exist. Check the man page for more details.
           Creating the database for the first time; once your policy file has been installed, it is time to build and initialize your database 
           of file system objects, based on the rules from your policy file. This database will serve as the baseline for later integrity checks.
           </p><p>
           The syntax for Database Initialization mode is:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>tripwire</strong></span> --init
           </pre><p>
           </p><p>
           To initialize your database file, use the following command:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>tripwire</strong></span> --init
           </pre><p>
           </p><pre class="literallayout"><code class="computeroutput">
           Please enter your local passphrase:
           Parsing policy file: /usr/TSS/policy/tw.pol
           Generating the database...
           *** Processing Unix File System ***
           Wrote database file: /usr/TSS/db/deep.openna.com.twd
           The database was successfully generated.
           </code></pre><p>
           </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
           When this command has executed, the database is ready and you can check system integrity and review the report file.
           </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9566"></a>6. Integrity or Interactive Check Mode</h2></div></div></div><p>
           Tripwire has a feature called <em class="wordasword">Integrity Check Mode</em>. Now that our database has been built, we can run this feature to compare the current file system objects with their properties as recorded 
           in the Tripwire database. All violations of files will be printed to <code class="literal">stdout</code>, the report-generated file will be saved and can later be accessed by the twprint utility.
           The syntax for integrity check mode is:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>tripwire</strong></span> --check
           </pre><p>
           To run the integrity check mode, use the command:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>tripwire</strong></span> --check
           </pre><p>
           </p><p>
           Tripwire can also be run in <em class="wordasword">Interactive Check Mode</em>. In this mode you can automatically update your changes via the terminal.

           To run in interactive check mode, use the command:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>tripwire</strong></span> --check --interactive
           </pre><p>
           </p><p>
           An email option exists with Tripwire and allows you to send email. This option will specify that reports be emailed to the recipients designated in the policy file.

           To run in integrity check mode and send email to the recipient, use the command:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>tripwire</strong></span> --check --email-report
           </pre><p>
           </p><p>
           Updating the database after an integrity check
           If you have decided to use the <em class="wordasword">Integrity Check Mode</em> of Tripwire instead of the <em class="wordasword">Interactive Check Mode</em>, you must update the Tripwire database with 
           the <em class="wordasword">Database Update Mode</em> feature. This update process allows you to save time by updating the database without having to regenerate it, and it also enables selective 
           updating, which cannot be done through regeneration.

           The syntax for database update mode is:
           </p><pre class="screen">
           [root@deep] /# tripwire --update -r
           </pre><p>

           To update the database, use the command:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>tripwire</strong></span> --update -r /usr/TSS/report/deep.openna.com-200001-021854.twr
           </pre><p>
           Where  -r read the specified report file <code class="filename">deep.openna.com-200001-021854.twr</code>. This option is required since the <code class="envar">REPORTFILE</code> variable in the current 
           configuration file uses <code class="prompt">$</code>(DATE).
           </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
           In Database Update Mode or Interactive Check Mode, Tripwire software displays the report in your terminal with a ballot box next to each policy violation. You can approve a change to the file system by 
           leaving the x next to each policy violation or remove the x from the ballot box and the database will not be updated with the new value(s) for that object. After you exit the editor and provide the local pass 
           phrase, Tripwire software will update and save your changes.
           </p></div><p>
           Updating the policy file
           Some times you want to change the rules in your policy file to reflect new file locations or policy rules. A special command exists to do the work and update the database without requiring a complete 
           re-initialization of the policy file. This can save a significant amount of time and preserves security by keeping the policy file synchronized with the database it uses.

           The syntax for policy update mode is:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>tripwire</strong></span> --update-policy /path/to/new/policy/file
           </pre><p>

           To update the policy file, use the command:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>tripwire</strong></span> --update-policy /usr/TSS/policy/newtwpol.txt
           </pre><p>
           </p><p>
           The policy Update mode runs with the  --secure-mode high option by default. You may encounter errors when running with this option if the file system has changed since the last database update, and 
           if the changes cause a violation in the new policy. After determining that all of the violations reported in high security mode are authorized, you can update the policy file in low security mode to solve this situation:

           To update the policy file in low security mode, use the command:
           </p><pre class="screen">
           [root@deep] /#<span class="command"><strong>tripwire</strong></span> --update-policy --secure-mode low /usr/TSS/policy/newtwpol.txt
           </pre><p>
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9608"></a>7. Installed files</h2></div></div></div><p>
           These are the files Installed by Tripwire:
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">
               /usr/TSS
             </code></td><td><code class="filename">
               /usr/TSS/policy/tw.pol
             </code></td><td><code class="filename">
               /usr/man/man5
             </code></td></tr><tr><td><code class="filename">
               /usr/bin
             </code></td><td><code class="filename">
               /usr/TSS/policy/twpol.txt.bak
             </code></td><td><code class="filename">
               /usr/man/man5/twfiles.5
             </code></td></tr><tr><td><code class="filename">
               /usr/bin/siggen
             </code></td><td><code class="filename">
               /usr/TSS/report
             </code></td><td><code class="filename">
               /usr/man/man8
             </code></td></tr><tr><td><code class="filename">
               /usr/bin/twprint
             </code></td><td><code class="filename">
               /usr/TSS/db
             </code></td><td><code class="filename">
               /usr/man/man8/siggen.8
             </code></td></tr><tr><td><code class="filename">
               /usr/bin/twadmin
             </code></td><td><code class="filename">
               /usr/TSS/key
             </code></td><td><code class="filename">
               /usr/man/man8/tripwire.8
             </code></td></tr><tr><td><code class="filename">
               /usr/bin/tripwire
             </code></td><td><code class="filename">
               /usr/TSS/key/site.key
             </code></td><td><code class="filename">
               /usr/man/man8/twadmin.8
             </code></td></tr><tr><td><code class="filename">
               /usr/bin/twcfg.txt
             </code></td><td><code class="filename">
               /usr/TSS/key/deep.openna.com-local.key
             </code></td><td><code class="filename">
               /usr/man/man8/twintro.8
             </code></td></tr><tr><td><code class="filename">
               /usr/bin/tw.cfg
             </code></td><td><code class="filename">
               /usr/man
             </code></td><td><code class="filename">
               /usr/man/man8/twprint.8
             </code></td></tr><tr><td><code class="filename">
               /usr/TSS/policy
             </code></td><td><code class="filename">
               /usr/man/man4
             </code></td><td><code class="filename">
               /usr/README
             </code></td></tr><tr><td><code class="filename">
               /usr/TSS/policy/policyguide.txt
             </code></td><td><code class="filename">
               /usr/man/man4/twconfig.4
             </code></td><td><code class="filename">
               /usr/Release_Notes
             </code></td></tr><tr><td><code class="filename">
               /usr/TSS/policy/twpol.txt
             </code></td><td><code class="filename">
               /usr/man/man4/twpolicy.4
             </code></td><td><code class="filename">
               /usr/License.txt
             </code></td></tr></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="pr6ch4sc1ltp"></a>Chapter 18. Linux Tripwire ASR 1.3.1</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm9682">1. Install, Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm9796">2. Configurations</a></span></dt><dt><span class="section"><a href="#idm9824">3. Configure the <code class="filename">/etc/tw.config</code> file</a></span></dt><dt><span class="section"><a href="#idm9844">4. Configure the <code class="filename">/etc/cron.daily/tripwire.verify</code> script</a></span></dt><dd><dl><dt><span class="section"><a href="#idm9860">4.1. Security Issue</a></span></dt></dl></dd><dt><span class="section"><a href="#idm9889">5. Tripwire in <code class="literal">Interactive Checking Mode</code></a></span></dt><dt><span class="section"><a href="#pr6ch4sc5trp">6. Run Tripwire in <em class="wordasword">Database Update Mode</em></a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch4sc51tri">6.1. Installed Files</a></span></dt></dl></dd></dl></div><div class="highlights"><p>
          Tripwire ASR 1.3.1 is the Academic Source Release (ASR) of Tripwire software. Personally, I prefer the 1.3.1 version of the software rather than the 2.2.1 version because it can compile and be installed without any 
          compatibility problems on all versions of Linux systems.
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9682"></a>1. Install, Compile and Optimize</h2></div></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>As explained in the [<span class="citation">Tripwire ASR goals</span>]:</b></p></div></div></div><p>
          With the advent of increasingly sophisticated and subtle account break-ins on Unix systems, the need for tools to aid in the detection of unauthorized modification of files becomes clear. Tripwire is a tool that 
          aids system administrators and users in monitoring a designated set of files for any changes. Used with system files on a regular (e.g., daily) basis, Tripwire can notify system administrators of corrupted or 
          tampered files, so damage control measures can be taken in a timely manner.
          </p></div><p>
          Tripwire is a file and directory integrity checker, a utility that compares a designated set of files and directories against information stored in a previously generated database.  Any differences are flagged 
          and logged, including added or deleted entries.  When run against system files on a regular basis, any changes in critical system files will be spotted -- and appropriate damage control measures can be taken 
          immediately. With Tripwire, system administrators can conclude with a high degree of certainty that a given set of files remain free of unauthorized modifications if Tripwire reports no changes.
          </p><p>
          These installation instructions assume:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Commands are Unix-compatible.
          </p></li><li class="listitem"><p>
          The source path is <code class="filename">/var/tmp</code> <span class="emphasis"><em>-other paths are possible</em></span>.
          </p></li><li class="listitem"><p>
          Installations were tested on Red Hat Linux 6.1 and 6.2.
          </p></li><li class="listitem"><p>
          All steps in the installation will happen in super-user account root.
          </p></li><li class="listitem"><p>
          Tripwire version number is <code class="literal">1.3.1-1</code>
          </p></li></ul></div><p>
          </p><p>
          These are the package(s) required and Tripwire Homepage: 
          </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
          <a class="link" href="#prtinxfp16" title="Linux Tripwire ASR 1.3.1">http://www.tripwiresecurity.com/</a>
          </td></tr></table><p>
          You must be sure to download: Tripwire-1.3.1-1.tar.gz
          </p><p>
          You need to decompress the Tarballs, It is a good idea to make a list of files on the system before you install it, and one afterwards, and then compare them using diff to find out what file it placed where. Simply 
          run <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Tripwire1</code></strong> before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Tripwire2</code></strong> after you install the tarball, and use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>Tripwire1 Tripwire2 &gt; Tripwire-Installed</code></strong> 
          to get a list of what changed.
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>cp</strong></span> Tripwire-version.tar.gz /var/tmp
          [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
          [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf Tripwire-version.tar.gz
          </pre><p>
          </p><p>
          Move into the new Tripwire directory and  Edit the utils.c file (vi +462 src/utils.c) and change the line:
                    
          </p><p>
          </p><pre class="programlisting">
          else if (iscntrl(*pcin)) {
          </pre><p>
          To read:
          </p><pre class="programlisting">
          else if (!(*pcin &amp; 0x80) &amp;&amp; iscntrl(*pcin)) {
          </pre><p>
          </p><p>
          Edit the <code class="filename">config.parse.c</code> file, <span class="command"><strong>vi</strong></span> +356 <code class="filename">src/config.parse.c</code> and change the line:
          </p><pre class="programlisting">
          rewind(fpout);
          </pre><p>
          To read:
          </p><pre class="programlisting">
          else {
          rewind(fpin);
          }
          </pre><p>
          </p><p>
          Edit the <code class="filename">config.h</code> file, <span class="command"><strong>vi</strong></span> +106 <code class="filename">include/config.h</code> and change the line:
          </p><pre class="programlisting">
          #define CONFIG_PATH     "/usr/local/bin/tw"
          #define DATABASE_PATH   "/var/tripwire"
          </pre><p>
          To read: 
          </p><pre class="programlisting">
          #define CONFIG_PATH     "/etc"
          #define DATABASE_PATH   "/var/spool/tripwire"
          </pre><p>

          </p><p>
         Edit the <code class="filename">config.h</code> file, <span class="command"><strong>vi</strong></span> +165 <code class="filename">include/config.h</code> and change the line:
          </p><pre class="programlisting">
          #define TEMPFILE_TEMPLATE "/tmp/twzXXXXXX"
          </pre><p>
          To read:
          </p><pre class="programlisting">
          #define TEMPFILE_TEMPLATE "/var/tmp/.twzXXXXXX"
          </pre><p>
          </p><p>
          Edit the <code class="filename">config.pre.y</code> file <span class="command"><strong>vi</strong></span> +66 <code class="filename">src/config.pre.y</code> and change the line:
          </p><pre class="programlisting">
          #ifdef TW_LINUX
          </pre><p>
          To read:
          </p><pre class="programlisting">
          #ifdef TW_LINUX_UNDEF
          </pre><p>
          </p><p>
          Edit the <code class="filename">Makefile</code>, <span class="command"><strong>vi</strong></span> +13 <code class="filename">Makefile</code> and change the line:
          </p><pre class="programlisting">
          DESTDIR = /usr/local/bin/tw
          </pre><p>
          To read:
          </p><pre class="programlisting">
          DESTDIR = /usr/sbin
          </pre><p>
          </p><pre class="programlisting">
          DATADIR = /var/tripwire
          </pre><p>
          To read:
          </p><pre class="programlisting">
          DATADIR = /var/spool/tripwire
          </pre><p>
          
          </p><pre class="programlisting">
          LEX     = lex
          </pre><p>
          To read:
          </p><pre class="programlisting">
          LEX     = flex
          </pre><p>
          </p><pre class="programlisting">
          CC=gcc
          </pre><p>
          To read:
          </p><pre class="programlisting">
          CC=egcs
          </pre><p>
          </p><pre class="programlisting">
          CFLAGS = -O
          </pre><p>
          To read:
          </p><pre class="programlisting">
          CFLAGS = -O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions
          </pre><p>
          </p><p>
            </p><pre class="screen">
          [root@deep ]/tw_ASR_1.3.1_src# <span class="command"><strong>make</strong></span>
          [root@deep ]/tw_ASR_1.3.1_src# <span class="command"><strong>make install</strong></span>
            </pre><p>
            </p><pre class="screen">
          [root@deep ]/tw_ASR_1.3.1_src# <span class="command"><strong>chmod</strong></span> 700  /var/spool/tripwire/
          [root@deep ]/tw_ASR_1.3.1_src# <span class="command"><strong>chmod</strong></span> 500 /usr/sbin/tripwire
          [root@deep ]/tw_ASR_1.3.1_src# <span class="command"><strong>chmod</strong></span> 500 /usr/sbin/siggen
          [root@deep ]/tw_ASR_1.3.1_src# <span class="command"><strong>rm</strong></span> -f  /usr/sbin/tw.config
          </pre><p>
          </p><p>
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The above commands <span class="command"><strong>make</strong></span> and <span class="command"><strong>make install</strong></span> will configure the software to ensure your system has the necessary functionality and libraries to successfully compile the package, compile all source files into 
          executable binaries, and then install the binaries and any supporting files into the appropriate locations.
          </p></li><li class="listitem"><p>
          The <span class="command"><strong>chmod</strong></span> command will change the default mode of <code class="filename">tripwire</code> directory to be <code class="literal">700 drwx------</code> only readable, writable, and executable by the super-user root. It will make 
          the binary <code class="filename">/usr/sbin/tripwire</code> only readable, and executable by the super-user <code class="literal">root -r-x------</code> and finally make the siggen program under <code class="filename">/usr/sbin</code> directory only executable 
          and readable by root.
          </p></li><li class="listitem"><p>
          The <span class="command"><strong>rm</strong></span> command as used above will remove the file <code class="filename">tw.config</code> under <code class="filename">/usr/sbin</code>. We don't need this file since we will create a new one under <code class="filename">/etc</code> 
          directory later.
          </p></li></ul></div><p>
          </p><p>
          Do Cleanup later:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
          [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf tw_ASR_version/ Tripwire-version.tar.gz
          </pre><p>
          The <span class="command"><strong>rm</strong></span> command as used above will remove all the source files we have used to compile and install Tripwire. It will also remove the Tripwire compressed archive from the <code class="filename">/var/tmp</code> directory.
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9796"></a>2. Configurations</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
              You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
              for respective software. For example <em class="wordasword">Tripwire-1.3.1.</em> configuration file are organised like this:
              </p><pre class="literallayout"><code class="computeroutput">
                total 8
                -rwx------    1 harrypotter    harrypotter         504 Jun  8 13:00 tripwire.verify*
                -rw-------    1 harrypotter    harrypotter         611 Jun  8 13:00 tw.config
              </code></pre><p>
              You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
              responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
            </p></div><p>
          To run Tripwire, the following files are required and must be created or copied to their appropriate directories on your server.
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          Copy the <code class="filename">tw.config</code> file to the <code class="filename">/etc</code> directory.
            </p></li><li class="listitem"><p>
          Copy the <code class="filename">tripwire.verify</code> script to the <code class="filename">/etc/cron.daily</code> directory.
          </p></li></ol></div><p>
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9824"></a>3. Configure the <code class="filename">/etc/tw.config</code> file</h2></div></div></div><p>
          The <code class="filename">/etc/tw.config</code> file is the Tripwire configuration file where you decide and set which system files and directories that you want monitored. Note that extensive testing and experience 
          are necessary when editing this file before you get working file reports. The following is a working example from where you can start you own customization.
          </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
          
          Create the <code class="filename">tw.config</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/tw.config</code> and add in this file all files and directories that you want monitored. The format of the configuration 
          file is described in its header and in the man page <span class="citerefentry"><span class="refentrytitle">tw.config</span>(5)</span>:
          </p><pre class="programlisting">
          # Gerhard Mourani: gmourani@videotron.ca
          # last updated: 1999/11/12 

          #  First, root's "home"
          /root	R
          !/root/.bash_history
          /	R

          # OS itself
          /boot/vmlinuz	R

          # critical boot resources
          /boot	R

          # Critical directories and files
          /chroot	R
          /etc	R
          /etc/inetd.conf	R
          /etc/nsswitch.conf	R
          /etc/rc.d	R
          /etc/mtab	L
          /etc/motd	L
          /etc/group	R
          /etc/passwd	L

          # other popular filesystems
          /usr	R
          /usr/local	R
          /dev	L-am
          /usr/etc	R

          # truncate home
          =/home	R

          # var tree
          =/var/spool	L
          /var/log	L
          /var/lib	L
          /var/spool/cron	L
          !/var/lock

          # unusual directories
          =/proc	E
          =/tmp
          =/mnt/cdrom
          =/mnt/floppy
          </pre><p>
          </p></li><li class="step"><p>
          
          Now, for security reasons, change the mode of this file to be <code class="literal">0600</code> with the following command:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>chmod</strong></span> 600  /etc/tw.config
          </pre><p>
          </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9844"></a>4. Configure the <code class="filename">/etc/cron.daily/tripwire.verify</code> script</h2></div></div></div><p>
          The <code class="filename">tripwire.verify</code> file is a small script executed by the crond program of your server each day to scan your hard disk for possible changed files or directories and mail the results to 
          the system administrator. This script will automate the procedure of integrity checking for you. If you intend to automate this task, follow the simple steps below.
          </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
          
          Create the <code class="filename">tripwire.verify</code> script file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/cron.daily/tripwire.verify</code> and add in this script:
          </p><pre class="programlisting">
          #!/bin/sh
          /usr/sbin/tripwire -loosedir -q | (cat &lt;&lt;EOF
          This is an automated report of possible file integrity changes, generated by
          the Tripwire integrity checker. To tell Tripwire that a file or entire
          directory tree is valid, as root run:

          /usr/sbin/tripwire -update [pathname|entry]

          If you wish to enter an interactive integrity checking and verification
          session, as root run:

          /usr/sbin/tripwire -interactive

          Changed files/directories include:
          EOF
          cat
          ) | /bin/mail -s "File integrity report" root
          </pre><p>
          </p></li><li class="step"><p>          
          Now, make this script executable and change its mode to be 0700 with the following command:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>chmod</strong></span> 700  /etc/cron.daily/tripwire.verify
          </pre><p>
          </p></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm9860"></a>4.1. Security Issue</h3></div></div></div><p>
          It is recommended for better security that the database <code class="filename">tw.db_[hostname]</code> file of Tripwire be moved someplace <abbr class="abbrev">e.g.</abbr> floppy, where it cannot be modified. This is important 
          because data from Tripwire is only as trustworthy as its database.
          It is also recommend that you make a hardcopy printout of the database contents right away. In the event that you become suspicious of the integrity of the database, you will be able to manually compare 
          information against this hardcopy.
          </p><p>
          For more details, Further documentation, there are several man pages you can read:
          </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
         <span class="citerefentry"><span class="refentrytitle">siggen</span>(8)</span></span></dt><dd><p>
         - signature generation routine for Tripwire
         </p></dd><dt><span class="term">
          <span class="citerefentry"><span class="refentrytitle">tripwire</span>(8)</span></span></dt><dd><p>
          - a file integrity checker for UNIX systems
          </p></dd><dt><span class="term">
          <span class="citerefentry"><span class="refentrytitle">tw.config</span>(5)</span></span></dt><dd><p>
          - configuration file for Tripwire
          </p></dd></dl></div><p>
          </p><p>
          The commands listed in the next section are some that we use often in regular use, but many more exist. Check the man pages for more details.
          </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm9889"></a>5. Tripwire in <code class="literal">Interactive Checking Mode</code></h2></div></div></div><p>
          In <code class="literal">Interactive Checking Mode</code> feature, Tripwire verifies files or directories that have been added, deleted, or changed from the original database and asks the user whether the database entry 
          should be updated. This mode is the most convenient way of keeping your database up-to-date, but it requires that the user be <em class="wordasword">at the console</em>. If you intend to use this mode, then follow 
          the simple steps below.
          </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
          
          Tripwire must have a database to compare against so we first create the file information database. This action will create a file called <code class="filename">tw.db_[hostname]</code> in the directory you specified to hold your 
          databases where <code class="literal">[hostname]</code> will be replaced with your machine hostname.

          To create the file information database for Tripwire, use the command:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>cd</strong></span> /var/spool/tripwire/
          [root@deep ]/tripwire# /usr/sbin/tripwire --initialize
          </pre><p>
          We move to the directory we specified to hold our database, and then we create the file information database, which is used for all subsequent Integrity Checking.

          </p></li><li class="step"><p>
          Once the file information database of Tripwire has been created, we can now run Tripwire in <code class="literal">Interactive Checking Mode</code>. This mode will prompt the user for whether or not each changed entry on the 
          system should be updated to reflect the current state of the file.
          To run in Interactive Checking Mode, use the command:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>cd</strong></span> /var/spool/tripwire/database/
          [root@deep ]/database# <span class="command"><strong>cp</strong></span> tw.db_myserverhostname /var/spool/tripwire/          
          [root@deep ]/database# <span class="command"><strong>cd ..</strong></span>          
          [root@deep ]/tripwire# <span class="command"><strong>/usr/sbin/tripwire</strong></span> --interactive
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
          Tripwire(tm) ASR (Academic Source Release) 1.3.1
          File Integrity Assessment Software
          (c) 1992, Purdue Research Foundation, (c) 1997, 1999 Tripwire
          Security Systems, Inc. All Rights Reserved. Use Restricted to
          Authorized Licensees.
          ### Phase 1:   	Reading configuration file
          ### Phase 2:   	Generating file list
          ### Phase 3:   	Creating file information database
          ### Phase 4:   	Searching for inconsistencies
          ###
          ###                   Total files scanned:   	15722
          ###                   Files added:   		34
          ###                   Files deleted: 		42
          ###                   Files changed:         	321
          ### 
          ###                   Total file violations: 	397
          ### added:   -rwx------ root        22706 Dec 31 06:25:02 1999 /root/tmp/firewall
          ---&gt; File: '/root/tmp/firewall'
          ---&gt; Update entry?  [YN(y)nh?]
          </code>
          </pre><p>
          </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
          In interactive mode, Tripwire first reports all added, deleted, and changed files, then allows the user to update the entry in the database.
          </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch4sc5trp"></a>6. Run Tripwire in <em class="wordasword">Database Update Mode</em></h2></div></div></div><p>
            Running Tripwire in <em class="wordasword">Database Update Mode</em> mixed with the <code class="filename">tripwire.verify</code> script file that mails the results to the system administrator, will reduce the time of 
            scanning the system. Instead of running Tripwire in <em class="wordasword">Interactive Checking Mode</em> and waiting for the long scan to finish, the script file <code class="filename">tripwire.verify</code> will scan 
            the system and report via mail the result, then you run Tripwire in <em class="wordasword">Database Update Mode</em> and update only single files or directories that has changed.
            </p><div class="example"><a name="idm9929"></a><p class="title"><b>Example 18.1. Usage of Tripwire</b></p><div class="example-contents"><p>
            If a single file has changed, you can:
            </p><pre class="screen">
            [root@deep] /# <span class="command"><strong>tripwire</strong></span> -update /etc/newly.installed.file
            </pre><p>
            </p><p>
            Or, if an entire set of files or directories has changed, you can run:
            </p><pre class="screen">
            [root@deep] /# <span class="command"><strong>tripwire</strong></span> -update /usr/lib/Package_Dir
            </pre><p>

            In either case, Tripwire regenerates the database entries for every specified file. A backup of the old database is created in the <code class="filename">./databases</code> directory.
            </p></div></div><br class="example-break"><p>
            These are Some possible uses of Tripwire software
            </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            Check the integrity of your files system.
            </p></li><li class="listitem"><p>
            Get a list of new installed or removed files on your system.
            </p></li></ol></div><p>
            </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="pr6ch4sc51tri"></a>6.1. Installed Files</h3></div></div></div><p>

            These are the files Installed by the software TripWire ASR on your system:
            </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">
             /etc/cron.daily/tripwire.verify
             </code></td></tr><tr><td><code class="filename">
             /etc/tw.config
             </code></td></tr><tr><td><code class="filename">
             /usr/man/man5/tw.config.5
             </code></td></tr><tr><td><code class="filename">
             /usr/man/man8/siggen.8
             </code></td></tr><tr><td><code class="filename">
             /usr/man/man8/tripwire.8
             </code></td></tr><tr><td><code class="filename">
             /usr/sbin/tripwire
             </code></td></tr><tr><td><code class="filename">
             /usr/sbin/siggen
             </code></td></tr><tr><td><code class="filename">
             /var/spool/tripwire
             </code></td></tr><tr><td><code class="filename">
             /var/spool/tripwire/tw.db_TEST
             </code></td></tr></table><p>
            </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="pr6ch4sc52tri"></a>6.1.1. Alternatives to Tripwire</h4></div></div></div><p>
            These are some of the alternatives to Tripwire:
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">ViperDB</span></dt><dd><p>
            ViperDB Homepage: <a class="link" href="#prtinxfp17" title="Alternatives to Tripwire:">http://www.resentment.org/projects/viperdb/</a>
            </p></dd><dt><span class="term">FCHECK</span></dt><dd><p>
            FCHECK Homepage:<a class="link" href="#prtinxfp17" title="Alternatives to Tripwire:">http://sites.netscape.net/fcheck/fcheck.html</a>
            </p></dd><dt><span class="term">Sentinel</span></dt><dd><p>
            Sentinel Homepage:<a class="link" href="#prtinxfp17" title="Alternatives to Tripwire:">http://zurk.netpedia.net/zfile.html</a>
            </p></dd></dl></div><p>
            </p></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="idm9985"></a>Chapter 19. Software -Securities/Management &amp; Limitation</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#pr6ch19sgpgp">1. Linux GnuPG</a></span></dt><dt><span class="section"><a href="#idm10052">2. Often used Commands</a></span></dt><dt><span class="section"><a href="#idm10071">3. Importing keys</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10084">3.1. Key signing</a></span></dt></dl></dd><dt><span class="section"><a href="#idm10104">4. Encrypt and decrypt</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10144">4.1. Exporting your public key</a></span></dt></dl></dd></dl></div><div class="highlights"><p>
          Encryption of data sources is an invaluable feature that gives us a high degree of confidentiality for our work. A tool like GnuPG does much more than just encryption of mail messages. It can be used for all kinds 
          of data encryptions, and its utilization can only be stopped by the imagination. GnuPG <acronym class="acronym">RPM</acronym> package comes already installed on you computer, but this version is not up to date and it is recommended 
          to install the latest release available to fit our needs and <acronym class="acronym">CPU</acronym> architecture.
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch19sgpgp"></a>1. Linux GnuPG</h2></div></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>According to the [<span class="citation">official GnuPG README</span>] file:</b></p></div></div></div><p>
          GnuPG is GNU's tool for secure communication and data storage. It can be used to encrypt data and to create digital signatures. It includes an advanced key management facility and is compliant with the proposed OpenPGP 
          Internet standard as described in RFC2440.
          Because GnuPG does not use any patented algorithm it cannot be compatible with PGP2 versions. PGP 2.x uses only <acronym class="acronym">IDEA</acronym> (which is patented worldwide) and <acronym class="acronym"> RSA</acronym> (which is patented in the United 
          States until Sep 20, 2000).
          </p></div><p>
          These installation instructions assume:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Commands are Unix-compatible.
          </p></li><li class="listitem"><p>
          The source path is <code class="filename">/var/tmp</code> -<span class="emphasis"><em>other paths are possible</em></span>.
          </p></li><li class="listitem"><p>
          Installations were tested on Red Hat Linux 6.1 and 6.2.
          </p></li><li class="listitem"><p>
          All steps in the installation will happen in super-user account root.
          </p></li><li class="listitem"><p>
          GnuPG version number is 1.0.1
          </p></li></ul></div><p>
          </p><p>
          These are the Package(s) you must be sure to download:
          </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
          GnuPG Homepage:<a class="link" href="#prtinxfp19er" title="Linux GnuPG"> http://www.gnupg.org/</a>
          </td></tr><tr><td>
          Package to download: gnupg-1.0.1.tar.gz
          </td></tr></table><p>
          </p><p>
          You must decompress the tarball to compile, it is a good idea to make a list of files on the system before you install it, and one afterwards, and then compare them using diff to find out what file it placed where. Simply 
          run <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; GnuPG1</code></strong> before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; GnuPG2</code></strong> after you install the tarball, and use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>GnuPG1 GnuPG2 &gt; GnuPG-Installed</code></strong> 
          to get a list of what changed.          
          Decompress the tarball (tar.gz):
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>cp</strong></span> gnupg-version.tar.gz /var/tmp
          [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
          [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf gnupg-version.tar.gz
          </pre><p>
          </p><p>
          You need to Compile and Optimize, move into the new GnuPG dir and type the following on your terminal:
          </p><pre class="programlisting">
          CC="egcs" \
          CFLAGS="-O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions" \
          ./configure \
          --prefix=/usr \
          --enable-shared
          </pre><p>
          </p><pre class="screen">
          [root@deep ]/gnupg-1.0.1# <span class="command"><strong>make</strong></span>
          [root@deep ]/gnupg-1.0.1# <span class="command"><strong>make check</strong></span>
          [root@deep ]/gnupg-1.0.1# <span class="command"><strong>make install</strong></span>
          [root@deep ]/gnupg-1.0.1# <span class="command"><strong>strip</strong></span> /usr/bin/gpg
          </pre><p>
          </p><p>
            </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
          The <span class="command"><strong>make</strong></span> command compiles all source files into executable binaries, 
          </td></tr><tr><td>
          The <span class="command"><strong>make check</strong></span> will run any self-tests that come with the package 
          </td></tr><tr><td>
          finally, the <span class="command"><strong>make install</strong></span> command installs the binaries and any supporting files into the appropriate locations. 
          </td></tr><tr><td>
          The <span class="command"><strong>strip</strong></span> command will reduce the size of the gpg binary for better performance.
          </td></tr></table><p>
          </p><p>
          Cleanup after work
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
          [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf gnupg-version/ gnupg-version.tar.gz
          </pre><p>
          The <span class="command"><strong>rm</strong></span> command as used above will remove all the source files we have used to compile and install GnuPG. It will also remove the GnuPG compressed archive from the <code class="filename">/var/tmp</code> directory.
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm10052"></a>2. Often used Commands</h2></div></div></div><p>
          The commands listed below are some that we use often, but many more exist. Check the man page for more details and information.
          </p><p>
          First of all, we must create a new key-pair (public and private) if this is a first use of the GnuPG software to be able to use its encryption features.
          </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
          To create a new key-pair, use the following command:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>gpg</strong></span> --gen-key
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
          gpg (GnuPG) 1.0.1; Copyright (C) 1999 Free Software Foundation, Inc.
          This program comes with ABSOLUTELY NO WARRANTY.
          This is free software, and you are welcome to redistribute it
          under certain conditions. See the file COPYING for details.

          gpg: /root/.gnupg: directory created
          gpg: /root/.gnupg/options: new options file created
          gpg: you have to start GnuPG again, so it can read the new options file
          This asks some questions and then starts key generation.
          </code></pre><p>
          </p></li><li class="step"><p>
            We start GnuPG again with the following command:
            </p><pre class="screen">
            [root@deep] /# <span class="command"><strong>gpg</strong></span> --gen-key
            </pre><p>
            </p><pre class="literallayout"><code class="computeroutput">              
          gpg (GnuPG) 1.0.1; Copyright (C) 1999 Free Software Foundation, Inc.
          This program comes with ABSOLUTELY NO WARRANTY.
          This is free software, and you are welcome to redistribute it
          under certain conditions. See the file COPYING for details.

          gpg: /root/.gnupg/secring.gpg: keyring created
          gpg: /root/.gnupg/pubring.gpg: keyring created
          Please select what kind of key you want:
          (1) DSA and ElGamal (default)
          (2) DSA (sign only)
          (4) ElGamal (sign and encrypt)
          Your selection? 1
          DSA keypair will have 1024 bits.
          About to generate a new ELG-E keypair.
          minimum keysize is  768 bits
          default keysize is 1024 bits
          highest suggested keysize is 2048 bits
          What keysize do you want? (1024) 2048
          Do you really need such a large keysize? y
          Requested keysize is 2048 bits
          Please specify how long the key should be valid.
          0 = key does not expire
          &lt;n&gt;  = key expires in n days
            &lt;n&gt;w = key expires in n weeks
              &lt;n&gt;m = key expires in n months
                &lt;n&gt;y = key expires in n years
                  Key is valid for? (0) 0
                  correct (y/n)? y

                  You need a User-ID to identify your key; the software constructs the user id
                  from Real Name, Comment and Email Address in this form:
                  "Heinrich Heine (Der Dichter) &lt;heinrichh@duesseldorf.de&gt;"

                  Real name: Gerhard Mourani
                  Email address: gmourani@videotron.ca
                  Comment: [Press Enter]
                  You selected this USER-ID:
                  "Gerhard Mourani &lt;gmourani@videotron.ca&gt;"

                  Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? o
                  You need a Passphrase to protect your secret key.

                  We need to generate a lot of random bytes. It is a good idea to perform
                  some other action (type on the keyboard, move the mouse, utilize the
                  disks) during the prime generation; this gives the random number
                  generator a better chance to gain enough entropy.
                  +++++..+++++++++++++++..+++++.++++++++++++++++++++++++++++++++++++++++..+++++++
                  +++.+++++++++++++++++++++++++.+++++++++++++++...+++++++++++++++++++++++++.+++++
                  ..+++++&gt;+++++...+++++++++++++++&gt;+++++.......&gt;+++++.......&gt;+++++................
                  ..........+++++^^^^
                  public and secret key created and signed.
                  </code></pre><p>
                  </p></li></ol></div><p>
                  A new key-pair is created (secret and public key) in the root home directory <code class="filename">~/root</code>.
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm10071"></a>3. Importing keys</h2></div></div></div><p>
          Once our own key-pair is created, we can begin to put into our public keyring database of all keys we have from some trusted third partly in order to be able to use his/her keys for future encryption and authentication 
          communication. To import Public Keys to your keyring, use the following command:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>gpg</strong></span> --import &lt;file&gt;
          </pre><p>
          </p><div class="example"><a name="idm10076"></a><p class="title"><b>Example 19.1. Importing using gpg</b></p><div class="example-contents"><p>
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>gpg</strong></span> --import redhat2.asc
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
          gpg: key DB42A60E: public key imported
          gpg: /root/.gnupg/trustdb.gpg: trustdb created
          gpg: Total number processed: 1
          gpg:               imported: 1
          </code></pre><p>
          The above command will append all new keys to our keyring database and will update all already existing keys. It is important to note that GnuPG does not import keys that are not self-signed. In the above example 
          we import the Public Key file <code class="filename">redhat2.asc</code> from the company Red Hat Linux, downloadable from the Red Hat Internet site, into our keyring.
          </p></div></div><br class="example-break"><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm10084"></a>3.1. Key signing</h3></div></div></div><p>
          When you import keys into your public keyring database and are sure that trusted third party is really the person they claim, you can start signing his/her keys. Signing a key certifies that you know the owner of the keys.

          To sign a key for the company RedHat that we have added on our keyring above, use the following command:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>gpg</strong></span> --sign-key &lt;UID&gt;
          </pre><p>
          </p><div class="example"><a name="idm10089"></a><p class="title"><b>Example 19.2. Signing key</b></p><div class="example-contents"><p>
          [root@deep] /# <span class="command"><strong>gpg</strong></span> --sign-key RedHat
          </p><pre class="literallayout"><code class="computeroutput">
          pub  1024D/DB42A60E  created: 1999-09-23 expires: never      trust: -/q
          sub  2048g/961630A2  created: 1999-09-23 expires: never
          (1)  Red Hat, Inc &lt;security@redhat.com&gt;


          pub  1024D/DB42A60E  created: 1999-09-23 expires: never      trust: -/q
          Fingerprint: CA20 8686 2BD6 9DFC 65F6  ECC4 2191 80CD DB42 A60E

          Red Hat, Inc &lt;security@redhat.com&gt;

          Are you really sure that you want to sign this key
          with your key: "Gerhard Mourani &lt;gmourani@videotron.ca&gt;"

          Really sign? y

          You need a passphrase to unlock the secret key for
          user: "Gerhard Mourani &lt;gmourani@videotron.ca&gt;"
          1024-bit DSA key, ID E92D6C97, created 1999-12-30

          Enter passphrase:
          </code></pre><p>
          </p></div></div><br class="example-break"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
          You should only sign a key as being authentic when you are <span class="emphasis"><em>Absolutely sure</em></span> that the key is really authentic! You should never sign a key based on any assumption.
          </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm10104"></a>4. Encrypt and decrypt</h2></div></div></div><p>
          After installing, importing, signing and configuring everything in the way that we want, we can start on encrypting and decrypting our work.

          To encrypt and sign data for the user RedHat that we have added on our keyring above, use the following command:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>gpg</strong></span> -sear RedHat &lt;file&gt;
          </pre><p>
          </p><div class="example"><a name="idm10109"></a><p class="title"><b>Example 19.3. Encrypting</b></p><div class="example-contents"><p>
            </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>gpg</strong></span> -sear RedHat message-to-RedHat.txt
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
          You need a passphrase to unlock the secret key for
          user: "Gerhard Mourani (Open Network Architecture) &lt;gmourani@videotron.ca&gt;"
          1024-bit DSA key, ID BBB4BA9B, created 1999-10-26
          Enter passphrase:
          </code></pre><p>
          Of the arguments passed, 
          </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
          The <code class="literal">s</code> is for signing 
          </td></tr></table><p>
          To avoid the risk that somebody else claims to be you, it is very useful to sign everything you encrypt, 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          e for encrypting, 
          </p></li><li class="listitem"><p>
          a to create <acronym class="acronym">ASCII</acronym> armored output .asc ready for sending by mail, 
          </p></li><li class="listitem"><p>
          r to encrypt the user id name 
          </p></li><li class="listitem"><p>
          &lt;file&gt; is the message you want to encrypt.
          </p></li></ul></div><p>
          </p></div></div><br class="example-break"><p>
          To decrypt data, use the following command:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>gpg</strong></span> -d &lt;file&gt;
          </pre><p>
          </p><div class="example"><a name="idm10132"></a><p class="title"><b>Example 19.4. Decrypting</b></p><div class="example-contents"><p>
            </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>gpg</strong></span> -d message-to-Gerhard.asc
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
          You need a passphrase to unlock the secret key for
          user: "Gerhard Mourani (Open Network Architecture) &lt;gmourani@videotron.ca&gt;"
          2048-bit ELG-E key, ID 71D4CC44, created 1999-10-26 (main key ID BBB4BA9B)
          Enter passphrase:
          </code></pre><p>
          Where 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           -d is for decrypting 
          </p></li><li class="listitem"><p>
          &lt;file&gt; is the message you want to decrypt. 
          </p></li></ul></div><p>
          It is important that the public key of the sender of the message we want to decrypt be in our public keyring 
          database. or of course nothing will work.          
          </p></div></div><br class="example-break"><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm10144"></a>4.1. Exporting your public key</h3></div></div></div><p>
          You can spread your wings by exporting and distributing your public key to the world. This can be done by publishing it on your homepage, through an available key server on the Internet, or any other available 
          method. GnuPG has some useful options to help you publish your public keys.

          To extract your public key in ASCII armored output, use the following command:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>gpg</strong></span> --export --armor &gt; Public-key.asc
          </pre><p>

          where 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           --export is for extracting your Public-key from your pubring encrypted file, 
          </p></li><li class="listitem"><p>
           --armor is to create ASCII armored output that you can mail, publish or put it on a web page 
          </p></li><li class="listitem"><p>
          &gt; <code class="filename">Public-key.asc</code> is to put the result in a file that you've named <code class="filename">Public-key.asc</code>.
          </p></li></ul></div><p>
          </p><p>
          You need to Check the signature, once you have extracted your public key and exported it, everyone who knows or gets your public key should be able to check whether encrypted data from you is also really signed by you.

          To check the signature of encrypted data, use the following command:
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>gpg</strong></span> --verify &lt;Data&gt;
          </pre><p>
          The  --verify option will check the signature where &lt;Data&gt; is the encrypted data/file you want to verify.
          </p><p>
          Some possible uses of GnuPG software
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          Send encrypted mail massage.
          </p></li><li class="listitem"><p>
          Encrypt backup files before transmission over the network.
          </p></li><li class="listitem"><p>
          Encrypt individual sensitive files <abbr class="abbrev">i.e.</abbr> a file that handle all your passwords.
          </p></li></ol></div><p>
          </p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>
          Installed files </b></p></div></div></div><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">
          /usr/bin/gpg
          </code></td></tr><tr><td><code class="filename">
          /usr/lib/gnupg
          </code></td></tr><tr><td><code class="filename">
          /usr/lib/gnupg/rndunix
          </code></td></tr><tr><td><code class="filename">
          /usr/lib/gnupg/rndegd
          </code></td></tr><tr><td><code class="filename">
          /usr/lib/gnupg/tiger
          </code></td></tr><tr><td><code class="filename">
          /usr/man/man1/gpg.1
          </code></td></tr><tr><td><code class="filename">
          /usr/share/gnupg
          </code></td></tr><tr><td><code class="filename">
          /usr/share/gnupg/options.skel
          </code></td></tr></table><p>
          </p></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="idm10190"></a>Chapter 20. Set Limits using Qouta</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm10192">1. Qouta</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10214">1.1. Modify the <code class="filename">/etc/fstab</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm10283">2. Create of the <code class="filename">quota.user</code> and <code class="filename">quota.group</code> </a></span></dt><dt><span class="section"><a href="#idm10348">3. edquota </a></span></dt><dd><dl><dt><span class="section"><a href="#idm10390">3.1. The <code class="literal">grace period</code> parameter</a></span></dt></dl></dd><dt><span class="section"><a href="#idm10411">4. Assign quota for a particular group</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10421">4.1. Assign quota for groups of users with the same value</a></span></dt></dl></dd><dt><span class="section"><a href="#idm10481">5. Often used Commands</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm10192"></a>1. Qouta</h2></div></div></div><div class="highlights"><p>
              Quota is a system administration tools for monitoring and limiting users and/or groups disk usage, per file system. Two features of disk storage with quota are available to set limits:                         
              </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The first is the number of inodes number of files a user or a group of users may possess. 
              </p></li><li class="listitem"><p>
              The second is the number of disk blocks amount of space in kilobytes that may be allocated to a user or a group of users. 
              </p></li></ul></div><p>
              With quota, the users are forced by the system administrator to not consume unlimited disk space on a system. This program is handled on per user, per file system basis and must be set for each file system 
              separately.
            </p></div><p>
              The first thing you need to do is ensure that your kernel has been built with Quota support enabled. In the 2.2.14 kernel version you need ensure that you have answered <strong class="userinput"><code>Y</code></strong> to the following questions:
              </p><pre class="programlisting">
                <span class="command"><strong>Filesystems</strong></span>
                Quota support (CONFIG_QUOTA) [N/y/?] <strong class="userinput"><code>Y</code></strong>
              </pre><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
              If you have followed the Linux Kernel chapter in this book and have recompiled your kernel, the option Quota support shown above is already set.
            </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm10214"></a>1.1. Modify the <code class="filename">/etc/fstab</code> file</h3></div></div></div><p>
                The <code class="filename">/etc/fstab</code> file contains information about the various file systems installed on your Linux server. Quota must be enabled in the fstab file before you can use it. Since Quota must be set 
                for each file system separately, and because in the fstab file, each file system is described on a separate line, quota must be set on each of the separate lines in the fstab for which you want to enable quota support.
              </p><p>
                With the program quota, depending on your intentions, needs, etc, you can enable quota only for <span class="token">users</span>, <span class="token">groups</span> or both <span class="token">users</span> and <span class="token">groups</span>. For all examples below, we'll 
                use the <code class="filename">/home</code> directory on the <code class="filename">/dev/sda6</code> partition and shows you the three possibilities.
              </p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Possibility 1</b></p></div></div></div><p>
                  To enable user quota support on a specific file system, edit your fstab file <span class="command"><strong>vi</strong></span> <code class="filename">/etc/fstab</code> and add the <code class="literal">usrquota</code> option to the fourth field after 
                  the word <em class="wordasword">defaults</em> or any other options you may have set for this specific file system.
                  </p><div class="example"><a name="idm10233"></a><p class="title"><b>Example 20.1. <code class="literal">usrquota</code></b></p><div class="example-contents"><p>
                    change:
                    
                      </p><pre class="programlisting">
                        /dev/sda6             /home                   ext2    defaults        1 2  <a name="dflts1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
                        /dev/sda6             /home                   ext2    nosuid,nodev    1 2   <a name="dflts2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
                      </pre><p>
                      </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#dflts1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>as an example: the word defaults</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#dflts2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>as an example: any other options you have set</p></td></tr></table></div><p>
                    

                    To read:
                    </p><pre class="programlisting">
                      /dev/sda6               /home                   ext2    defaults,usrquota       1 2
                      /dev/sda6               /home                   ext2    nosuid,nodev,usrquota   1 2
                    </pre><p>
                  </p></div></div><p><br class="example-break">
                </p></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Possibility 2</b></p></div></div></div><p>
                  To enable group quota support on a file system, edit your fstab file <span class="command"><strong>vi</strong></span> <code class="filename">/etc/fstab</code> and add <code class="literal">grpquota</code> to the fourth field after the 
                  word <code class="literal">defaults</code> or any other options you may have set for this specific file system.
                  </p><div class="example"><a name="idm10253"></a><p class="title"><b>Example 20.2. <code class="literal">grpquota</code></b></p><div class="example-contents"><p>
                    change:
                    </p><pre class="programlisting">
                      /dev/sda6               /home                   ext2    defaults        1 2   <a name="dflts3"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
                      /dev/sda6               /home                   ext2    nosuid,nodev    1 2     <a name="dflts4"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
                    </pre><p>
                    </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#dflts3"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>as an example: the word defaults</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#dflts4"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>as an example: any other options you have set</p></td></tr></table></div><p>

                    

                    To read:
                    </p><pre class="programlisting">
                      /dev/sda6               /home                   ext2    defaults,grpquota       1 2
                      /dev/sda6               /home                   ext2    nosuid,nodev,grpquota   1 2
                    </pre><p>
                  </p></div></div><p><br class="example-break">
                </p></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Possibility 3</b></p></div></div></div><p>
                    To enable both users quota and group quota support on a file system, edit your fstab file <span class="command"><strong>vi</strong></span> <code class="filename">/etc/fstab</code> and add <code class="literal">usrquota,grpquota</code> to the 
                    fourth field after the word <code class="literal">defaults</code> or any other options you may have set for this specific file system.
                    Change:
                    
                      </p><pre class="programlisting">
                        /dev/sda6               /home                   ext2    defaults        1 2 <a name="dflts5"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
                        /dev/sda6               /home                   ext2    nosuid,nodev    1 2   <a name="dflts6"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
                      </pre><p>
                      </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#dflts5"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>as an example: the word <code class="literal">defaults</code></p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#dflts6"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>as an example: any other options you have set</p></td></tr></table></div><p>
                    

                    To read:
                    </p><pre class="programlisting">
                      /dev/sda6               /home                   ext2    defaults,usrquota,grpquota       1 2
                      /dev/sda6               /home                   ext2    nosuid,nodev,usrquota,grpquota   1 2
                    </pre><p>
                  </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm10283"></a>2. Create of the <code class="filename">quota.user</code> and <code class="filename">quota.group</code> </h2></div></div></div><p>
              After the modification of your <code class="filename">/etc/fstab</code> file, in order for quotas to be established on a file system, the root directory of the file system <abbr class="abbrev">i.e.</abbr> <code class="filename">/home</code> in 
              our example must contain a file, owned by root, called <code class="filename">quota.user</code> if you want to use user quota, <code class="filename">quota.group</code> if you want to use group quota, or both if you want to use users and group quota.
            </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>


                Create the <code class="filename">quota.user</code> and/or <code class="filename">quota.group</code> files, as root go to the root of the partition you wish to enable quota <abbr class="abbrev">i.e.</abbr> <code class="filename">/home</code> doing:
                </p><pre class="screen">
                  [root@deep] /# <span class="command"><strong>touch</strong></span> /home/quota.user 
                  [root@deep] /# <span class="command"><strong>touch</strong></span> /home/quota.group 
                  [root@deep] /# <span class="command"><strong>chmod</strong></span> 600  /home/quota.user 
                  [root@deep] /# <span class="command"><strong>chmod</strong></span> 600  /home/quota.group
                </pre><p>
                The <span class="command"><strong>touch</strong></span> command will create new empty files under the <code class="filename">home</code> directory named <code class="filename">quota.user</code> and <code class="filename">quota.group</code>. The <span class="command"><strong>chmod</strong></span> 
                command will set the mode of these files to be read-write only by the super-user root.
                </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
                  Both quota record files, <code class="filename">quota.user</code> and <code class="filename">quota.group</code>, should be owned by root, with read-write permission for root and none for anybody else.
                </p></div><p>
              </p></li><li class="step"><p>

                Now we must initialize the files <code class="filename">quota.user</code> and <code class="filename">quota.group</code> in the root directory of the file system in order to not receive an error messages about quota 
                during the reboot of our server.

                To initialize <code class="filename">quota.user</code> and/or <code class="filename">quota.group</code> files, use the following commands:
                </p><pre class="screen">
                  [root@deep] /# <span class="command"><strong>edquota</strong></span> -u wahib
                  [root@deep] /# <span class="command"><strong>edquota</strong></span> -g wahib
                </pre><p>
                The steps above are necessary just to initialize the files <code class="filename">quota.user</code> and/or <code class="filename">quota.group</code>; the command <span class="command"><strong>edquota</strong></span>  -u will edit 
                the quota for the user wahib and  -g will edit the quota for the group wahib. Note that you must edit an existing <acronym class="acronym">UID/GID</acronym> on your system to initialize the files successfully.
              </p></li><li class="step"><p>

                After you have finished setting the appropriate options for your quota program in the <code class="filename">/etc/fstab</code> file, and created and initialized the <code class="filename">quota.users</code>, 
                and/or <code class="filename">quota.group</code> files, you must reboot the system for the changes you have made in the <code class="filename">/etc/fstab</code> file and/or the 
                files <code class="filename">quota.user</code>, <code class="filename">quota.group</code> to take effect.

                To reboot your system, use the following command:
                </p><pre class="screen">
                  [root@deep] /# <span class="command"><strong>reboot </strong></span>
                </pre><p>
              </p></li></ol></div><p>          
              After your system has been rebooted you can assign quotas to users or groups of users on your system. This operation is performed with the <span class="command"><strong>edquota</strong></span> 
              command. See man page <span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span>
            </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm10348"></a>3. edquota </h2></div></div></div><p>
              The edquota program is a quota editor that creates a temporary file of the current disk quotas used by the super-user root to set quotas for users or group of users in the system. The example below shows 
              you how to setup quotas for users or groups on your system.
            </p><p>
              Consider, for example, that you have a user with the login id <em class="wordasword">wahib</em> on your system. The following command opens the editor vi to edit and set quotas for user wahib on each partition that has quotas enabled:
            </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
                  To edit and modify quota for user <em class="wordasword">wahib</em>, use the following command:
                  </p><pre class="screen">
                    [root@deep] /# <span class="command"><strong>edquota</strong></span> -u wahib
                  </pre><p>
                  </p><pre class="literallayout"><code class="computeroutput">
                    Quotas for user wahib:
                    /dev/sda6: blocks in use: 6, limits (soft = 0, hard = 0)
                    inodes in use: 5, limits (soft = 0, hard = 0)
                  </code></pre><p>
                  After the execution of the above command, you will see the following lines related to the user <em class="wordasword">wahib</em> appear on the screen. 
                  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
                    The blocks in use:</span></dt><dd><p>
                      display the total number of blocks in kilobytes the user has consumed on a partition. 
                    </p></dd><dt><span class="term">
                    The inodes in use:</span></dt><dd><p>
                      display the total number of files the user has on a partition. 
                    </p></dd></dl></div><p>
                  These parameters <code class="literal">blocks in use</code>, and <code class="literal">inodes in use</code> are controlled and set automatically by the system and you don't need to set or change them.
                </p></li><li class="step"><p>
                  To assign 5<acronym class="acronym">MB</acronym> of quota for user <em class="wordasword">wahib</em>, change the following parameters in the vi editor:
                  </p><pre class="programlisting">
                    Quotas for user wahib:
                    /dev/sda6: blocks in use: 6, limits (soft = 0, hard = 0)
                    inodes in use: 5, limits (soft = 0, hard = 0)
                  </pre><p>
                  To read:
                  </p><pre class="programlisting">
                    Quotas for user wahib:
                    /dev/sda6: blocks in use: 6, limits (soft = 5000, hard = 0)
                    inodes in use: 5, limits (soft = 0, hard = 0)
                  </pre><p>
                </p></li></ol></div><table border="0" summary="Simple list" class="simplelist"><tr><td>
                The soft limit (soft =) specifies the maximum amount of disk usage a quota user is allowed to have.
              </td></tr><tr><td>
              The hard limit (hard =) specifies the absolute limit on the disk usage a quota user can't go beyond it. 
              </td></tr></table><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
                Take a note that the hard limit value works only when the grace period parameter is set.
              </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm10390"></a>3.1. The <code class="literal">grace period</code> parameter</h3></div></div></div><p>
              The <code class="literal">grace period</code> parameter allow you to set a time limit before the soft limit value is enforced on a file system with quota enabled, <span class="emphasis"><em>see the soft limit above for more information</em></span>. For example 
              this parameter can be used to warn your users about a new policy that will set a quota of 5<acronym class="acronym">MB</acronym> of disk space in their home directory in 7 days. You can set the 0 days default part of this parameter to any length of 
              time you feel reasonable.
            </p><p>
              The changes of this setting require two steps as follows, in my example I assume 7 days.
              </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
                  Edit the default grace period parameter, by using the following command:
                  </p><pre class="screen">
                    [root@deep] /# <span class="command"><strong>edquota</strong></span> -t
                  </pre><p>
                  </p><pre class="literallayout"><code class="computeroutput">
                    Time units may be: days, hours, minutes, or seconds
                    Grace period before enforcing soft limits for users:
                    /dev/sda6: block grace period: 0 days, file grace period: 0 days
                  </code>
                  </pre><p>
                </p></li><li class="step"><p>
                  Modify the grace period to 7 days. Change or set the following parameters in the vi editor:
                  </p><pre class="programlisting">
                    Time units may be: days, hours, minutes, or seconds
                    Grace period before enforcing soft limits for users:
                    /dev/sda6: block grace period: 0 days, file grace period: 0 days
                  </pre><p>
                  To read:
                  </p><pre class="programlisting">
                    Time units may be: days, hours, minutes, or seconds
                    Grace period before enforcing soft limits for users:
                    /dev/sda6: block grace period: 7 days, file grace period: 7 days
                  </pre><p>
                </p></li></ol></div><p>
              The command <span class="command"><strong>edquota</strong></span> -t edits the soft time limits for each file system with quotas enabled.
            </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm10411"></a>4. Assign quota for a particular group</h2></div></div></div><p>
              Consider, for example, you have a group with the <span class="token">group id webusers</span> on your system. The following command takes you into the vi editor to edit quotas for the <span class="token">group webusers</span> on each partition that has 
              quotas enabled:

              To edit and modify quota for group webusers, use the following command:
              </p><pre class="screen">
                [root@deep] /# <span class="command"><strong>edquota</strong></span> -g webusers
              </pre><p>
              </p><pre class="literallayout"><code class="computeroutput">
                Quotas for group webusers:
                /dev/sda6: blocks in use: 6, limits (soft = 0, hard = 0)
                inodes in use: 6, limits (soft = 0, hard = 0)
              </code></pre><p>
              The procedure is the same as for assigning quotas for a particular user; as described above, you must modify the parameter of <code class="literal">soft =</code> and save your change.
            </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm10421"></a>4.1. Assign quota for groups of users with the same value</h3></div></div></div><p>

                The edquota program has a special option  -p that assign quotas for groups of users with the same value assigned to an initial user. Assuming that you want to assign users starting 
                at <code class="literal">UID 500</code> on the system the same value as the user <em class="wordasword">wahib</em>, we would first edit and set wahib's quota information, then execute:
                To assign quota for group of users with the same value, use the following command:
                </p><pre class="screen">
                  [root@deep] /# <span class="command"><strong>edquota</strong></span> -p wahib `awk -F: '$3 &gt; 499 {print $1}' /etc/passwd`
                </pre><p>
                The edquota program will duplicate the quota that we have set for the user wahib to all users in the <code class="filename">/etc/passwd</code> file that begin after <code class="literal">UID 499</code>.
              </p><p>
              Further documentation for more details, please consult man pages:
              </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
              <span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></span></dt><dd><p>
              - edit user quotas
              </p></dd><dt><span class="term">
               <span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></span></dt><dd><p>
               - display disk usage and limits
               </p></dd><dt><span class="term">
               <span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></span></dt><dd><p>
               - scan a file system for disk usages
               </p></dd><dt><span class="term">
               <span class="citerefentry"><span class="refentrytitle">quotactl</span>(2)</span></span></dt><dd><p>
               - manipulate disk quotas
               </p></dd><dt><span class="term">
               <span class="citerefentry"><span class="refentrytitle">quotaon, quotaoff</span>(8)</span></span></dt><dd><p>
               - turn file system quotas on and off
               </p></dd><dt><span class="term">
               <span class="citerefentry"><span class="refentrytitle">repquota</span>(8)</span></span></dt><dd><p>
               - summarize quotas for a file system
               </p></dd><dt><span class="term">
               <span class="citerefentry"><span class="refentrytitle">rquota</span>(3)</span></span></dt><dd><p>
               - implement quotas on remote machines
               </p></dd></dl></div><p>
               </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm10481"></a>5. Often used Commands</h2></div></div></div><p>
              The commands listed below are some that we use often, but many more exist. Check the man page for more details and information.
            </p><p><b>Quota. </b>

                Quota displays users' disk usage and limits on a file system.
                To display user disk usage and limits, use the command:
                </p><pre class="screen">
                  [root@deep] /# <span class="command"><strong>quota</strong></span> -u wahib
                </pre><p>
                </p><pre class="literallayout"><code class="computeroutput">
                  Disk quotas for user wahib (uid 501):
                  Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
                  /dev/sda6    6001*   6000       0    none       7       0       0
                </code></pre><p>
              </p><p>
                To display group quotas for the group of which the user is a member, use the command:
                </p><pre class="screen">
                  [root@deep] /# <span class="command"><strong>quota</strong></span> -g wahib
                </pre><p>
                </p><pre class="literallayout"><code class="computeroutput">
                  Disk quotas for group wahib (gid 501):
                  Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
                  /dev/sda6    5995*   5000       0    none       1       0       0
                </code></pre><p>
                If the group quota is not set for the user specified, you will receive the following message: 
                </p><pre class="literallayout"><code class="computeroutput">
                  Disk quotas for group wahib (gid 501): none
                </code></pre><p>
              </p><p><b>Repquota . </b>
                Repquota produces summarized quota information of the disk usage and quotas for the specified file systems. Also, it prints for each user the current number of files and amount of space used (in kilobytes).

                Here is a sample output repquota gives <span class="emphasis"><em>you results may vary</em></span>:
                </p><pre class="screen">
                  [root@deep] /# <span class="command"><strong>repquota</strong></span> -a
                </pre><p>
                </p><pre class="literallayout"><code class="computeroutput">
                             Block limits               				File limits
                  User        	    	used    	soft    	hard  	grace  	used  	soft    	hard		grace
                  Roo		--	21       	0       	0       4    	0   	0
                  Named	        --	6               0       	0       5     	0       0
                  Admin	        --  	388657	        0       	0       21      21      0     		0
                  Wahib	        --    	6001            0       	0       7     	0     	0

                             Block limits               				File limits
                  User      	      	used    	soft    	hard  	grace    	used  	soft	hard  	        grace
                  root      	--      21       	0       	0       4     	        0	0
                  named     	--      6       	0       	0       5     	        0       0
                  admin     	--  	388657	        0       	0       2121            0       0
                  wahib     	--    	6001    	6000       	0   	none            7	0   	0
                </code></pre><p>
              </p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="pr6ch21Sonet"></a>Chapter 21. Software -Networking</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#pr6ch7sc1dbs">1. Linux <acronym class="acronym">DNS</acronym> and <acronym class="acronym">BIND</acronym> Server</a></span></dt><dt><span class="section"><a href="#idm10608">2. Configure</a></span></dt><dt><span class="section"><a href="#idm10707">3. <code class="literal">Caching-only</code> name Server</a></span></dt><dt><span class="section"><a href="#idm10804">4. Primary <code class="literal">master</code> name Server</a></span></dt><dt><span class="section"><a href="#idm10913">5. <code class="literal">Secondary</code> slave name Server</a></span></dt><dd><dl><dt><span class="section"><a href="#idm10964">5.1. <code class="filename">/etc/rc.d/init.d/named script </code></a></span></dt></dl></dd><dt><span class="section"><a href="#idm10999">6. Run <acronym class="acronym">ISC</acronym>  <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> in a chroot jail</a></span></dt><dt><span class="section"><a href="#idm11151">7. The syslog daemon</a></span></dt><dt><span class="section"><a href="#idm11242">8. Clean-up and Test the new chrooted jail</a></span></dt><dt><span class="section"><a href="#idm11414">9. DNS Administrative Tools</a></span></dt><dt><span class="section"><a href="#idm11447">10. <acronym class="acronym">DNS</acronym> Users Tools</a></span></dt><dt><span class="section"><a href="#idm11519">11. Installed files</a></span></dt></dl></div><div class="highlights"><p>
            Once we have installed all the necessary security software in our Linux server, it's time to finetune the network part of our server. <acronym class="acronym">DNS</acronym> is the MOST important network service for <acronym class="acronym">IP</acronym> networks communication, and for 
            this reason, all Linux client machines should be configured to perform caching functions as a minimum.
            </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch7sc1dbs"></a>1. Linux <acronym class="acronym">DNS</acronym> and <acronym class="acronym">BIND</acronym> Server</h2></div></div></div><div class="highlights"><p>
          
          Setting up a caching server for client local machines will reduce the load on the site's primary server. A caching only name server will find the answer to name queries and remember the answer the next time we 
          need it. This will shorten the waiting time the next time significantly. For security reasons, it is very important that <acronym class="acronym">DNS</acronym> doesn't exist between hosts on the corporate network and external hosts; it is far 
          safer to simply use <acronym class="acronym">IP</acronym> addresses to connect to external machines from the corporate network and vice-versa.
          </p></div><p>
          In our configuration and installation we'll run <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> as non root-user and in a chrooted environment. We also provide you three different configurations; 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          one for a simple caching name server only <em class="wordasword">client</em> 
          </p></li><li class="listitem"><p>
          one for a slave <em class="wordasword">secondary server</em> 
          </p></li><li class="listitem"><p>
          one for a master name server <em class="wordasword">primary server</em>.
          </p></li></ul></div><p>
          </p><p>
          The simple <code class="literal">caching</code> name server configuration will be used for your servers that don't act as a <span class="token">master</span> or <span class="token">slave</span> name server, and the <span class="token">slave</span> and <span class="token">master</span> configurations 
          will be used for your servers that act as a <span class="token">master</span> name server and <span class="token">slave</span> name server. Usually one of your servers acts as <span class="token">master</span>, another one acts as <span class="token">slave</span> and the rest act as simple <code class="literal">caching</code> client 
          name server.
          </p><p>
          This is a graphical representation of the <acronym class="acronym">DNS</acronym> configuration we use in this book. We try to show you different settings 
          </p><div class="mediaobject"><img src="./images/DNS-Schema.gif" alt="DNS caching name server"></div><p>
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Caching Only <acronym class="acronym">DNS</acronym>
          </p></li><li class="listitem"><p>
          Master <acronym class="acronym">DNS</acronym>
          </p></li><li class="listitem"><p>
          Slave <acronym class="acronym">DNS</acronym>
          </p></li></ul></div><p>
          on different servers. A lot of possibilities exist, and depend on your needs, and network architecture.
          </p><p>
          These installation instructions assume
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Commands are Unix-compatible.
          </p></li><li class="listitem"><p>
          The source path is <code class="filename">/var/tmp</code>. <span class="emphasis"><em>other paths are possible</em></span>.
          </p></li><li class="listitem"><p>
          Installations were tested on Red Hat Linux 6.1 and 6.2.
          </p></li><li class="listitem"><p>
          All steps in the installation will happen in super-user account root.
          </p></li><li class="listitem"><p>
          ISC <acronym class="acronym">BIND</acronym> version number is 8.2.2-patchlevel5
          </p></li></ul></div><p>
          </p><p>
          These are the Package(s) required:
          </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
          ISC <acronym class="acronym">BIND</acronym> Homepage:<a class="link" href="#prtinxfp18" title="Linux DNS and BIND Server">http://www.isc.org/</a> 
          </td></tr><tr><td>
          ISC <acronym class="acronym">BIND</acronym> FTP Site: <a class="link" href="#prtinxfp18" title="Linux DNS and BIND Server"><code class="literal">204.152.184.27</code></a>
          </td></tr></table><p>
          You must be sure to download: <code class="filename">bind-contrib.tar.gz, bind-doc.tar.gz, bind-src.tar.gz</code>
          </p><p>
          Before you decompress Tarballs and install, it is a good idea to make a list of files on the system before you install <acronym class="acronym">BIND</acronym>, and one afterwards, and then compare them using diff to find out what file it placed where. Simply 
          run <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; DNS1</code></strong> before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; DNS2</code></strong> after you install the software, and use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>DNS1 DNS2 &gt; DNS-Installed</code></strong> to 
          get a list of what changed.
          </p><p>
          Compile and Decompress the tarball (tar.gz).
          </p><pre class="screen">
          [root@deep] /# <span class="command"><strong>mkdir</strong></span> /var/tmp/bind
          [root@deep] /# <span class="command"><strong>cp</strong></span> bind-contrib.tar.gz /var/tmp/bind/
          [root@deep] /# <span class="command"><strong>cp</strong></span> bind-doc.tar.gz /var/tmp/bind/
          [root@deep] /# <span class="command"><strong>cp</strong></span> bind-src.tar.gz /var/tmp/bind/
          </pre><p>
          We create a directory named bind to handle the tar archives and copy them to this new directory.
          </p><p>
          Move into the new bind directory <span class="command"><strong>cd</strong></span> <code class="filename">/var/tmp/bind</code> and decompress the tar files:
          </p><pre class="screen">
          [root@deep ]/bind# <span class="command"><strong>tar</strong></span> xzpf bind-contrib.tar.gz
          [root@deep ]/bind# <span class="command"><strong>tar</strong></span> xzpf bind-doc.tar.gz
          [root@deep ]/bind# <span class="command"><strong>tar</strong></span> xzpf bind-src.tar.gz
          </pre><p>
          </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm10608"></a>2. Configure</h2></div></div></div><p>
 Configuration files for different services are very specific depending on your needs and your network architecture. People can install <acronym class="acronym">DNS</acronym> Servers at home as a <code class="literal">caching-only</code> server, though companies may install it 
 with <code class="literal">primary</code>, <code class="literal">secondary</code> and <code class="literal">caching</code> <acronym class="acronym">DNS</acronym> servers.
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
    You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
    for respective software. For example <em class="wordasword">BIND-DNS</em> configuration file are organised like this:
    </p><pre class="literallayout"><code class="computeroutput">
    total 24
drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 Caching-Only-DNS/
-rw-r--r--    1 harrypotter    harrypotter         484 Jun  8 13:00 Compile-BIND
drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 Primary-Master-DNS/
drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 Secondary-Slave-DNS/
-rwx------    1 harrypotter    harrypotter         300 Jun  8 13:00 bind.sh*
drwxr-xr-x    3 harrypotter    harrypotter        4096 Jun  8 13:00 init.d/
    </code></pre><p>
    You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
    responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
  </p></div><p>
 To run a <code class="literal">caching-only</code> name server, the following files are required and must be created or copied to the appropriate directories on your server.
 </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
 Copy the <code class="filename">named.conf</code> file to the <code class="filename">/etc/</code> directory.
 </p></li><li class="listitem"><p>
 Copy the <code class="filename">db.127.0.0</code> file to the <code class="filename">/var/named/</code> directory.
 </p></li><li class="listitem"><p>
 Copy the <code class="filename">db.cache</code> file to the <code class="filename">/var/named/</code> directory.
 </p></li><li class="listitem"><p>
 Copy the <code class="filename">named</code> script file to the <code class="filename">/etc/rc.d/init.d/</code> directory.
 </p></li></ol></div><p>
 </p><p>
 To run a <code class="literal">master</code> name server, the following files are required and must be created or copied to the appropriate directories on your server.
</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
 Copy the <code class="filename">named.conf</code> file to the <code class="filename">/etc/</code> directory.
 </p></li><li class="listitem"><p>
 Copy the <code class="filename">db.127.0.0</code> file to the <code class="filename">/var/named/</code> directory.
 </p></li><li class="listitem"><p>
 Copy the <code class="filename">db.cache</code> file to the <code class="filename">/var/named/</code> directory.
 </p></li><li class="listitem"><p>
 Copy the <code class="filename">db.208.164.186</code> file to the <code class="filename">/var/named/</code> directory.
 </p></li><li class="listitem"><p>
 Copy the <code class="filename">db.openna</code> file to the <code class="filename">/var/named/</code> directory.
 </p></li><li class="listitem"><p>
 Copy the <code class="filename">named</code> script file to the <code class="filename">/etc/rc.d/init.d/</code> directory.
 </p></li></ol></div><p>
 </p><p>
 To run a slave name server, the following files are required and must be created or copied to the appropriate directories on your server.
 </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
 Copy the <code class="filename">named.conf</code> file to the <code class="filename">/etc/</code> directory.
 </p></li><li class="listitem"><p>
 Copy the <code class="filename">db.127.0.0</code> file to the <code class="filename">/var/named/</code> directory.
 </p></li><li class="listitem"><p>
 Copy the <code class="filename">db.cache</code> file to the <code class="filename">/var/named/</code> directory.
 </p></li><li class="listitem"><p>
 Copy the <code class="filename">named</code> script file to the <code class="filename">/etc/rc.d/init.d/</code> directory.
 </p></li></ol></div><p>
 </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
 You can obtain the configuration files listed over the next few sections on the <code class="filename">floppy.tgz</code> archive. Copy the following files from the decompressed <code class="filename">floppy.tgz</code> archive to the 
 appropriate places, or copy them directly from this book to the concerned file.
 </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm10707"></a>3. <code class="literal">Caching-only</code> name Server</h2></div></div></div><p>
 Caching-only name servers are servers not authoritative for any domains except <code class="literal">0.0.127.in-addr.arpa</code>, the localhost. A <code class="literal">caching-only</code> name server can look up names inside and outside 
 your zone, as can <span class="token">primary</span> and <span class="token">slave</span> name servers. The difference is that when a <code class="literal">caching-only</code> name server initially looks up a name within your zone, it ends up asking one 
 of the <span class="token">primary</span> or <span class="token">slave</span> names servers for your zone for the answer.
 </p><p>
 The necessary files to setup a simple caching name server are:
 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
 <code class="filename">named.conf</code>
 </p></li><li class="listitem"><p>
 <code class="filename">db.127.0.0</code>
 </p></li><li class="listitem"><p>
 <code class="filename">db.cache</code>
 </p></li><li class="listitem"><p>
 <code class="filename">named script</code>
 </p></li></ol></div><p>
 </p><p>
 To configure the <code class="filename">/etc/named.conf</code> file for a simple caching name server, use this for all servers that dont act as a <code class="literal">master</code> or <code class="literal">slave</code> name server. Setting up 
 a simple caching server for local client machines will reduce the load on the network's primary server. Many users on dialup connections may use this configuration along with bind for such a purpose.

 Create the <code class="filename">named.conf</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/named.conf</code> and add the following lines to the file:
 
 </p><pre class="programlisting">
 options {
 directory "/var/named";
 forwarders { 208.164.186.1; 208.164.186.2; };<a name="frwdrs1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
 forward only;
 };

 //
 // a caching only nameserver config
 zone "." in {
 type hint;
 file "db.cache";
 };

 zone "0.0.127.in-addr.arpa" in {
 type master;
 file "db.127.0.0";
 };
 </pre><p>
 </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#frwdrs1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
 In the forwarders line, <code class="literal">208.164.186.1</code> and <code class="literal">208.164.186.2</code> are the <acronym class="acronym">IP</acronym> addresses of your <code class="literal">Primary</code> <span class="emphasis"><em>Master</em></span> and <code class="literal">Secondary</code> <span class="emphasis"><em>Slave</em></span> 
 <acronym class="acronym"><acronym class="acronym">DNS</acronym></acronym> server. They can also be the <acronym class="acronym">IP</acronym> addresses of your <acronym class="acronym">ISP</acronym>s <acronym class="acronym">DNS</acronym> server and another <acronym class="acronym">DNS</acronym> server, respectively. 
 </p></td></tr></table></div><p>
 
 </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
To improve the security of your BIND/<acronym class="acronym">DNS</acronym> server you can stop it from even trying to contact an off-site server if their forwarder is down or doesn't respond. With the 
 <code class="envar">forward only</code> option set in your <code class="filename">named.conf</code> file, the name server doesn't try to contact other servers to find out information if the forwarder doesn't give 
 it an answer.
 </p></div><p>
 To configure the <code class="filename">/var/named/db.127.0.0</code> file for a simple caching name server,you can use this configuration for all machines on your network that don't act as a <span class="token">master</span> or <span class="token">slave</span> name server. 
 The <code class="filename">db.127.0.0</code> file covers the loopback network. Create the following files in <code class="filename">/var/named/</code>, <span class="command"><strong>touch</strong></span> <code class="filename">/var/named/db.127.0.0</code> and 
 add the following lines in the file:
 </p><pre class="programlisting">
 $TTL 345600
 @       IN      SOA     localhost. root.localhost.  (
 00	; Serial
 86400	; Refresh
 7200	; Retry
 2592000	; Expire
 345600 )	; Minimum
 IN      NS      localhost.

 1        IN      PTR     localhost.
 </pre><p>
 </p><p>
 Configure the <code class="filename">/var/named/db.cache</code> file for a simple caching name server before starting your <acronym class="acronym">DNS</acronym> server. You must take a copy of <code class="filename">db.cache</code> file 
 and copy this file to the <code class="filename">/var/named/</code> directory. The <code class="filename">db.cache</code> tells your server where the servers for the <span class="token">root</span> zone are.
 </p><p>
 Use the following commands on another Unix computer in your organization to query a new <code class="filename">db.cache</code> file for your <acronym class="acronym">DNS</acronym> Server or pick one from your 
 Red Hat Linux <span class="hardware">CD-ROM</span> source distribution: 
 </p><pre class="screen">
 [root@deep]# <span class="command"><strong>dig</strong></span> @.aroot-servers.net . ns &gt; db.cache
 </pre><p>
 Don't forget to copy the <code class="filename">db.cache</code> file to the <code class="filename">/var/named/</code> directory on your server where you're installing <acronym class="acronym">DNS</acronym> server 
 after retrieving it over the Internet.
 </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
 Internal addresses like <code class="literal">192.168.1/24</code> are not included in the <acronym class="acronym">DNS</acronym> configuration files for security reasons. It is very important that <acronym class="acronym">DNS</acronym> doesn't exist between hosts on the corporate network and external hosts.
 </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm10804"></a>4. Primary <code class="literal">master</code> name Server</h2></div></div></div><p>
 A primary <code class="literal">master</code> name server for a zone reads the data for the zone from a file on it's host and are authoritative for that zone.The necessary files to setup a primary master name server are:
 </p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>
 <code class="filename">named.conf</code>
 </p></li><li class="listitem"><p>
 <code class="filename">db.127.0.0</code>
 </p></li><li class="listitem"><p>
 <code class="filename">db.208.164.186</code>
 </p></li><li class="listitem"><p>
 <code class="filename">db.openna</code>
 </p></li><li class="listitem"><p>
 <code class="filename">db.cache</code>
 </p></li><li class="listitem"><p>
 <code class="filename">named script</code>
 </p></li></ol></div><p>
 </p><p>
 To configure the <code class="filename">/etc/named.conf</code> file for a <code class="literal">master</code> name server, use this configuration for the server on your network that acts as a <span class="token">master</span> name server. After compiling 
 <acronym class="acronym">DNS</acronym>, you need to set up a <code class="literal">primary</code> domain name for your server. We'll use <code class="literal">openna.com</code> as an example domain, and assume you are using <acronym class="acronym">IP</acronym> network address 
 of <code class="literal">208.164.186.0.</code> To do this, add the following lines to your <code class="filename">/etc/named.conf</code>.

 Create the <code class="filename">named.conf</code> file <span class="command"><strong>touch</strong></span> <code class="filename">/etc/named.conf</code> and add:
 
 </p><pre class="programlisting">
 options {
 directory "/var/named";
 fetch-glue no;                    <a name="ftgl1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
 recursion no;                     <a name="rcsn1"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
 allow-query { 208.164.186/24; 127.0.0/8; };  <a name="alqr1"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
 allow-transfer { 208.164.186.2; };           <a name="altr1"></a><span><img src="images/callouts/4.png" alt="4" border="0"></span>
 transfer-format many-answers;
 };

 // These files are not specific to any zone
 zone "." in {
 type hint;
 file "db.cache";
 };

 zone "0.0.127.in-addr.arpa" in {
 type master;
 file "db.127.0.0";
 };

 // These are our primary zone files
 zone "openna.com" in {
 type master;
 file "db.openna ";
 };

 zone "186.164.208.in-addr.arpa" in {
 type master;
 file "db.208.164.186";
 };
 </pre><p>
 </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ftgl1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> <a href="#rcsn1"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
 The <code class="envar">fetch-glue</code> no option can be used in conjunction with the option <code class="envar">recursion no</code> to prevent the server's cache from growing or becoming corrupted. Also, disabling recursion puts your name servers 
 into a passive mode, telling it never to send queries on behalf of other name servers or resolvers. A non-recursive name server is very difficult to spoof, since it doesn't send queries, and hence doesn't cache any data.
 </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#alqr1"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>
 In the allow-query line, 208.164.186/24 and 127.0.0/8 are the <acronym class="acronym">IP</acronym> addresses allowed to ask ordinary questions to the server.
 </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#altr1"><span><img src="images/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>
 In the allow-transfer line, 208.164.186.2 is the <acronym class="acronym">IP</acronym> address allowed to receive zone transfers from the server. You must ensure that only your real slave name servers can transfer zones from your name serve,
 as the information provided is often used by spammers and <acronym class="acronym">IP</acronym> spoofers.
 </p></td></tr></table></div><p>
 
 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
 The options <code class="envar">recursion no</code>, <code class="envar">allow-query</code>, and <code class="envar">allow-transfer</code> in the <code class="filename">named.conf</code> file above are security features.
 </p></div><p>
 To configure the <code class="filename">/var/named/db.127.0.0</code> file for a <span class="token">master</span> and <span class="token">slave</span> name server, you can use this configuration file by both a master name server and a slave name server. 
 The <code class="filename">db.127.0.0</code> file covers the loopback network. Create the following files in <code class="filename">/var/named/</code>.
 </p><p>
 Create the <code class="filename">db.127.0.0</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/var/named/db.127.0.0</code> and add:
 </p><pre class="programlisting">
 ; Revision History: April 22, 1999 - admin@mail.openna.com
 ; Start of Authority (SOA) records.
 $TTL 345600
 @  IN  SOA  deep.openna.com. admin.mail.openna.com.  (
 00	; Serial
 86400	; Refresh
 7200	; Retry
 2592000	; Expire
 345600 )	; Minimum

 ; Name Server (NS) records.
 NS   deep.openna.com.
 NS   mail.openna.com.

 ; only One PTR record.
 1      PTR  localhost.
 </pre><p>
 </p><p>
 To configure the <code class="filename">/var/named/db.208.164.186</code> file for a master name server, Use this configuration for the server on your network that acts as a master name server. The file <code class="filename">db.208.164.186</code> maps 
 host names to addresses. Create the following files in <code class="filename">/var/named/</code>.
 </p><p>
 Create the <code class="filename">db.208.164.186</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/var/named/db.208.164.186</code> and add:
 </p><pre class="programlisting">
 ; Revision History: April 22, 1999 - admin@mail.openna.com
 ; Start of Authority (SOA) records.
 $TTL 345600
 @  IN  SOA  deep.openna.com. admin.mail.openna.com.  (
 00	; Serial
 86400	; Refresh
 7200	; Retry
 2592000	; Expire
 345600 )	; Minimum

 ; Name Server (NS) records.
 NS   deep.openna.com.
 NS   mail.openna.com.

 ; Addresses Point to Canonical Names (PTR) for Reverse lookups
 1  PTR      deep.openna.com.
 2  PTR      mail.openna.com.
 3  PTR      www.openna.com.
 </pre><p>
 </p><p>
 To configure of the <code class="filename">/var/named/db.openna</code> file for a master name server, use this configuration for the server on your network that acts as a master name server. The file <code class="filename">db.openna</code> maps 
 addresses to host names. Create the following file in <code class="filename">/var/named/</code>.
 </p><p>
 Create the <code class="filename">db.openna</code> file <span class="command"><strong>touch</strong></span> <code class="filename">/var/named/db.openna</code> and add:
 </p><pre class="programlisting">
 ; Revision History: April 22, 1999 - admin@mail.openna.com
 ; Start of Authority (SOA) records.
 $TTL 345600
 @  IN  SOA  deep.openna.com. admin.mail.openna.com.  (
 00	; Serial
 86400	; Refresh
 7200	; Retry
 2592000	; Expire
 345600 )	; Minimum

 ; Name Server (NS) records.
 NS   deep.openna.com.
 NS   mail.openna.com.

 ; Mail Exchange (MX) records.
 MX   0  mail.openna.com.

 ; Address (A) records.
 localhost	A       127.0.0.1
 deep	A       208.164.186.1
 mail	A       208.164.186.2
 www	A       208.164.186.3

 ; Aliases in Canonical Name (CNAME) records.
 ;www                           CNAME  deep.openna.com.

 </pre><p>
 </p><p>
 To configure the <code class="filename">/var/named/db.cache</code> file for a master and slave name servers  Before starting your <acronym class="acronym">DNS</acronym> server you must take a copy of the <code class="filename">db.cache</code> file and copy it into 
 the <code class="filename">/var/named/</code> directory. The <code class="filename">db.cache</code> tells your server where the servers for the root zone are.
 </p><p>
 Use the following command on another Unix computer in your organization to query a new <code class="filename">db.cache</code> file for your <acronym class="acronym">DNS</acronym> Server or pick one from your Red Hat Linux CD-ROM source distribution:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>dig</strong></span> @.aroot-servers.net . ns &gt; db.cache
 </pre><p> 
 
 Don't forget to copy the <code class="filename">db.cache</code> file to the <code class="filename">/var/named/</code> directory on your server where you're installing <acronym class="acronym">DNS</acronym> server after retrieving it over the Internet.
 </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm10913"></a>5. <code class="literal">Secondary</code> slave name Server</h2></div></div></div><p>
   The purpose of a <code class="literal">slave</code> name server is to share the load with the <code class="literal">master</code> server, or handle the entire load if the <code class="literal">master</code> server is down. A <code class="literal">slave</code> name server loads its data over the network from another name 
   server <span class="emphasis"><em>usually the <code class="literal">master</code> name server, but it can load from another <code class="literal">slave</code> name server too</em></span>. This process is called a <span class="token">zone</span> transfer.

   Necessary files to setup a secondary slave name server are:
   </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
   named.conf
   </p></li><li class="listitem"><p>
   db.127.0.0
   </p></li><li class="listitem"><p>
   db.cache
   </p></li><li class="listitem"><p>
   named script
   </p></li></ol></div><p>
   To configure the <code class="filename">/etc/named.conf</code> file for a <code class="literal">slave</code> name server, use this configuration for the server on your network that acts as a <span class="token">slave</span> name server. You must modify the <code class="filename">named.conf</code> 
   file on the <span class="token">slave</span> name server host. Change every occurrence of primary to secondary except for <code class="filename">0.0.127.in-addr.arpa</code> and add a masters line with the <acronym class="acronym">IP</acronym> address of the <code class="literal">master</code> server as shown below.
   </p><p>
   Create the named.conf file (touch /etc/named.conf) and add:
   </p><pre class="programlisting">
   options {
   directory "/var/named";
   fetch-glue no;
   recursion no;
   allow-query { 208.164.186/24; 127.0.0/8; };
   allow-transfer { 208.164.186.1; };
   transfer-format many-answers;
   };

   // These files are not specific to any zone
   zone "." in {
   type hint;
   file "db.cache";
   };

   zone "0.0.127.in-addr.arpa" in {
   type master;
   file "db.127.0.0";
   };

   // These are our slave zone files
   zone "openna.com" in {
   type slave;
   file "db.openna";
   masters { 208.164.186.1; };
   };

   zone "186.164.208.in-addr.arpa" in {
   type slave;
   file "db.208.164.186";
   masters { 208.164.186.1; };
   };
   </pre><p>

   This tells the name server that it is a <span class="token">slave</span> for the zone <code class="literal">openna.com</code> and should track the version of this zone that is being kept on the host <code class="literal">208.164.186.1</code>.
   </p><p>
   A <code class="literal">slave</code> name server doesn't need to retrieve all of its database (db) files over the network because these db files <code class="filename">db.127.0.0</code> and <code class="filename">db.cache</code> are the same as 
   on a <code class="literal">primary</code> master, so you can keep a local copy of these files on the slave name server.
   </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
   Copy the <code class="filename">db.127.0.0</code>file from <code class="literal">master</code> name server to <code class="literal">slave</code> name server.
   </p></li><li class="listitem"><p>
   Copy the <code class="filename">db.cache</code> file from <code class="literal">master</code> name server to <code class="literal">slave</code> name server.
   </p></li></ol></div><p>
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm10964"></a>5.1. <code class="filename">/etc/rc.d/init.d/named script </code></h3></div></div></div><p>
   Configure your <code class="filename">/etc/rc.d/init.d/named</code> script file to start and stop the <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> daemon on your Server. This configuration script file can 
   by used for all type of name server <code class="literal">caching</code>, <code class="literal">master</code> or <code class="literal">slave</code>.
   </p><p>
   Create the named script file <span class="command"><strong>touch</strong></span> <code class="filename">/etc/rc.d/init.d/named</code> and add:
   </p><pre class="programlisting">
   #!/bin/sh
   #
   # named           This shell script takes care of starting and stopping
   #                 named (BIND <acronym class="acronym">DNS</acronym> server).
   #
   # chkconfig: - 55 45
   # description: named (BIND) is a Domain Name Server (<acronym class="acronym">DNS</acronym>) \
   # that is used to resolve host names to <acronym class="acronym">IP</acronym> addresses.
   # probe: true

   # Source function library.
   . /etc/rc.d/init.d/functions

   # Source networking configuration.
   . /etc/sysconfig/network

   # Check that networking is up.
   [ ${NETWORKING} = "no" ] &amp;&amp; exit 0

   [ -f /usr/sbin/named ] || exit 0

   [ -f /etc/named.conf ] || exit 0

   RETVAL=0

   # See how we were called.
   case "$1" in
   start)
   # Start daemons.
   echo -n "Starting named: "
   daemon named
   RETVAL=$?
   [ $RETVAL -eq 0 ] &amp;&amp; touch /var/lock/subsys/named
   echo
   ;;
   stop)
   # Stop daemons.
   echo -n "Shutting down named: "
   killproc named
   RETVAL=$?
   [ $RETVAL -eq 0 ] &amp;&amp; rm -f /var/lock/subsys/named
   echo
   ;;
   status)
   /usr/sbin/ndc status
   exit $?
   ;;
   restart)
   $0 stop
   $0 start
   ;;
   reload)
   /usr/sbin/ndc reload
   exit $?
   ;; 
   probe)
   # named knows how to reload intelligently; we don't want linuxconf
   # to offer to restart every time
   /usr/sbin/ndc reload &gt;/dev/null 2&gt;&amp;1 || echo start
   exit 0
   ;;

   *)
   echo "Usage: named {start|stop|status|restart}"
   exit 1
   esac

   exit $RETVAL
   </pre><p>
   </p><p>
   Now, make this script executable and change its default permissions:
   </p><pre class="screen">
   [root@deep]# <span class="command"><strong>chmod</strong></span> 700  /etc/rc.d/init.d/named
   </pre><p>
   Create the symbolic <code class="filename">rc.d</code> links for <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> with the command:
   </p><pre class="screen">
   [root@deep]# <span class="command"><strong>chkconfig</strong></span> --add named
   </pre><p>
   </p><p>
   The <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> script will not automatically start the named daemon when you reboot the server. You can change its default by executing the following command:
   </p><pre class="screen">
   [root@deep]# <span class="command"><strong>chkconfig</strong></span> --level 345 named on
   </pre><p>
   Start your <acronym class="acronym">DNS</acronym> Server manually with the following command:
   </p><pre class="screen">
   [root@deep]# /etc/rc.d/init.d/named <span class="command"><strong>start</strong></span>
   </pre><p>
   </p><pre class="literallayout"><code class="computeroutput">
   Starting named:                                            [  OK  ]
   </code></pre><p>
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm10999"></a>6. Run <acronym class="acronym">ISC</acronym>  <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> in a chroot jail</h2></div></div></div><div class="highlights"><p>
 The main benefit of a chroot jail is that the jail will limit the portion of the file system the <acronym class="acronym">DNS</acronym> daemon program can see to the root directory of the jail. Additionally, since the jail only needs to support <acronym class="acronym">DNS</acronym>, the programs related 
 to <acronym class="acronym">ISC</acronym>  <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> available in the jail can be extremely limited. Most importantly, there is no need for setuid-root programs, which can be used to gain root access and break out of the jail.
 </p></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Securing <acronym class="acronym">ISC</acronym>  <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym></b></p></div></div></div><p>
 This part focuses on preventing <acronym class="acronym">ISC</acronym>  <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> from being used as a point of break-in to the system hosting it. Since <acronym class="acronym">ISC</acronym>  <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> 
 performs a relatively large and complex function, the potential for bugs that affect security is rather high with this software. In fact, there have been exploitable bugs in the past that allowed a remote attacker to obtain root access to hosts 
 running <acronym class="acronym">ISC</acronym>  <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym>. To minimize this risk, <acronym class="acronym">ISC</acronym>  <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> can be run as a non-root user, which will limit any damage to what can 
 be done as a normal user with a local shell. Of course, this is not enough for the security requirements of most <acronym class="acronym">DNS</acronym> servers, so an additional step can be taken - that is, running <acronym class="acronym">ISC</acronym>  <acronym class="acronym">BIND</acronym> 
 in a chroot jail.
 </p><div class="mediaobject"><img src="./images/DNS-Chroot.gif" alt="DNS in chroot"></div><p>
 </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
 The named binary program must be in a directory listed within your <code class="envar">PATH</code> environment variable for this to work. For the rest of the documentation, I'll assume the path of your original named program 
 is <code class="filename">/usr/sbin/named</code>.
 </p></div><p>
 The following are the necessary steps to run <acronym class="acronym">ISC</acronym> <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> software in a chroot jail:
 </p><p>
 We must find the shared library dependencies of named, <span class="emphasis"><em>named is the <acronym class="acronym">DNS</acronym> daemon</em></span>. These will need to be copied into the chroot jail later.
 </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
 To find the shared library dependencies of named, execute the following command:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>ldd</strong></span> /usr/sbin/named
 libc.so.6 =&gt; /lib/libc.so.6 (0x40017000)
 /lib/ld-linux.so.2 =&gt; /lib/ld-linux.so.2 (0x40000000) 
 </pre><p>
 </p></li><li class="step"><p>
 Make a note of the files listed above; you will need these later in our steps.
 </p></li></ol></div><p> 
 Now we must set up the chroot environment, and create the root directory of the jail. We've chosen <code class="filename">/chroot/named</code> because we want to put this on its own separate file system to prevent file system attacks. Early 
 in our Linux installation procedure we created a special partition <code class="filename">/chroot</code> for this purpose.
 </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
   </p><pre class="screen">
     [root@deep] /# /etc/rc.d/init.d/named stop <a name="nmd1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span> 
 </pre><p>
 </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#nmd1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
 Require only if an existing named daemon is running.
 </p></td></tr></table></div><p>
 </p><pre class="literallayout"><code class="computeroutput">
 Shutting down named:                              [  OK  ]
 </code></pre><p>
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>mkdir</strong></span> -p /chroot/named
 </pre><p>
 </p></li><li class="step"><p>
 Next, create the rest of directories as follows:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>mkdir</strong></span> /chroot/named/dev
 [root@deep] /# <span class="command"><strong>mkdir</strong></span> /chroot/named/lib
 [root@deep] /# <span class="command"><strong>mkdir</strong></span> /chroot/named/etc
 [root@deep] /# <span class="command"><strong>mkdir</strong></span> -p /chroot/named/usr/sbin
 [root@deep] /# <span class="command"><strong>mkdir</strong></span> -p /chroot/named/var/run
 [root@deep] /# <span class="command"><strong>mkdir</strong></span> /chroot/named/var/named
 </pre><p>
 </p></li><li class="step"><p>
 Now copy the main configuration file, the zone files, the <span class="symbol">named</span> and the named-xfer programs into the appropriate places in the chroot jail directory:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>cp</strong></span> /etc/named.conf /chroot/named/etc/
 [root@deep] /# <span class="command"><strong>cd</strong></span> /var/named ; cp -a . /chroot/named/var/named/
 [root@deep] /# <span class="command"><strong>mknod</strong></span> /chroot/named/dev/null c 1 3
 [root@deep] /# <span class="command"><strong>chmod</strong></span> 666 /chroot/named/dev/null
 [root@deep] /# <span class="command"><strong>cp</strong></span> /usr/sbin/named /chroot/named/usr/sbin/
 [root@deep] /# <span class="command"><strong>cp</strong></span> /usr/sbin/named-xfer /chroot/named/usr/sbin/
 </pre><p>
 </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
 The owner of the <code class="filename">/chroot/named/var/named</code> directory and all files in this directory must be the process name <span class="symbol">named</span> under the <code class="literal">slave</code> server and only 
 the <code class="literal">slave</code> server or you wouldn't be able to make a <code class="literal">zone</code> transfer.
 </p></div><p>
 </p></li><li class="step"><p>
 To make the <code class="filename">named</code> directory and all its files own by the <span class="symbol">named</span> process name under the <code class="literal">slave</code> server, use the command:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>chown</strong></span> -R named.named /chroot/named/var/named/
 </pre><p>
 </p></li></ol></div><p>
 Copy the shared libraries identified above to the chrooted lib directory:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>cp</strong></span> /lib/libc.so.6 /chroot/named/lib/
 [root@deep] /# <span class="command"><strong>cp</strong></span> /lib/ld-linux.so.2 /chroot/named/lib/
 </pre><p>
 </p><p>
 Copy the <code class="filename">localtime</code> and <code class="filename">nsswitch.conf</code> files to the chrooted <code class="filename">etc</code> directory so that log entries are adjusted for your local 
 timezone properly:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>cp</strong></span> /etc/localtime /chroot/named/etc/
 [root@deep] /# <span class="command"><strong>cp</strong></span> /etc/nsswitch.conf /chroot/named/etc/
 </pre><p>
 </p><p>
 We must set some files under the <code class="filename">/chroot/named/etc</code> directory with the immutable bit enabled for better security:
 </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
 Set the immutable bit on <code class="filename">nsswitch.conf</code> file:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>cd</strong></span> /chroot/named/etc/
 [root@deep etc]# <span class="command"><strong>chattr</strong></span>  +i nsswitch.conf
 </pre><p>
 </p></li><li class="step"><p>
 Set the immutable bit on <code class="filename">named.conf</code> file:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>cd</strong></span> /chroot/named/etc/
 [root@deep etc]# <span class="command"><strong>chattr</strong></span>  +i named.conf
 </pre><p>
 A file with the   +i attribute cannot be modified, deleted or renamed; no link can be created to this file and no data can be written to it. Only the superuser can set or clear this attribute.
 </p></li></ol></div><p>
 Add a new <span class="symbol">UID</span> and a new <span class="symbol">GID</span> for running the daemon <code class="literal">named</code> if this is not already set. This is important because running it as root defeats 
 the purpose of the jail, and using a different user id that already exists on the system can allow your services to access each others' resources.

 Check the <code class="filename">/etc/passwd</code> and <code class="filename">/etc/group</code> files for a free UID/GID number available. In our example we'll use the number <span class="symbol">53</span> and the name <span class="symbol">named</span>.
 </p><pre class="screen">
 [root@deep] /#<span class="command"><strong>useradd</strong></span> -c DNS Server -u 53 -s /bin/false -r -d /chroot/named named 2&gt;/dev/null || :
 </pre><p>
 </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm11151"></a>7. The syslog daemon</h2></div></div></div><p>
 We must tell syslogd <span class="emphasis"><em>the syslog daemon program</em></span> about the new chrooted service, since normally, processes talk to syslogd through <code class="filename">/dev/log</code>. As a result of the chroot 
 jail, this won't be possible, so syslogd needs to be told to listen to <code class="filename">/chroot/named/dev/log</code> instead of the default <code class="filename">dev/log</code>. To do this, edit the syslog startup script file to specify 
 additional places to listen.
 </p><p>
 Edit the <code class="filename">syslog</code> script file <span class="command"><strong>vi</strong></span> +24 <code class="filename">/etc/rc.d/init.d/syslog</code> and change the line:
 </p><pre class="programlisting">
 daemon syslogd -m 0
 </pre><p>
 To read:
 </p><pre class="programlisting">
 daemon syslogd -m 0 -a /chroot/named/dev/log
 </pre><p>
 </p><p>
 The default named script file of <acronym class="acronym">ISC</acronym> <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> starts the daemon <code class="literal">named</code> outside the chroot jail. We must change it to start named from the 
 chroot jail. Edit the named script file <span class="command"><strong>vi</strong></span> <code class="filename">/etc/rc.d/init.d/named</code> and change the lines:
 </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
     </p><pre class="programlisting">
 [ -f /usr/sbin/named ] || exit 0
 </pre><p>
 To read:
 </p><pre class="programlisting">
 [ -f /chroot/named/usr/sbin/named ] || exit 0
 </pre><p>
 </p></li><li class="step"><p>
   </p><pre class="programlisting">
 [ -f /etc/named.conf ] || exit 0
 </pre><p>
 To read:
 </p><pre class="programlisting">
 [ -f /chroot/named/etc/named.conf ] || exit 0
 </pre><p>
 </p></li><li class="step"><p>
   </p><pre class="programlisting">
 daemon named
 </pre><p>
 To read:
 </p><pre class="programlisting">
 daemon /chroot/named/usr/sbin/named -t /chroot/named/ -unamed -gnamed
 </pre><p>
 </p></li></ol></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">The  -t </span></dt><dd><p>
 option tells <code class="literal">named</code> to start up using the new chroot environment.
 </p></dd><dt><span class="term">The  -u </span></dt><dd><p>
 option specifies the user to run as.
 </p></dd><dt><span class="term">The  -g </span></dt><dd><p>
 option specifies the group to run as.
 </p></dd></dl></div><p>
 In <acronym class="acronym">BIND</acronym> 8.2 version, the <span class="command"><strong>ndc</strong></span> command of <acronym class="acronym">ISC</acronym> <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> software became a binary file; before, it was a script file, which 
 renders the shipped <span class="command"><strong>ndc</strong></span> useless in this setting. To fix it, the <acronym class="acronym">ISC</acronym> <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> package must be compiled again from source.

 To do this, in the top level of <acronym class="acronym">ISC</acronym> <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> source directory.
  </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
 For ndc utility:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>cp</strong></span> bind-src.tar.gz /vat/tmp
 [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp/
 [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf bind-src.tar.gz
 [root@deep ]/tmp# <span class="command"><strong>cd</strong></span> src
 [root@deep ]/src# <span class="command"><strong>cp</strong></span> port/linux/Makefile.set port/linux/Makefile.set-orig
 </pre><p>
 </p></li><li class="step"><p>
 Edit the <code class="filename">Makefile.set file</code>, <span class="command"><strong>vi</strong></span> <code class="filename">port/linux/Makefile.set</code> to make the changes listed below:
 </p><pre class="programlisting">
 'CC=egcs -D_GNU_SOURCE'
 'CDEBUG=-O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions -g
 'DESTBIN=/usr/bin'
 'DESTSBIN=/chroot/named/usr/sbin'
 'DESTEXEC=/chroot/named/usr/sbin'
 'DESTMAN=/usr/man'
 'DESTHELP=/usr/lib'
 'DESTETC=/etc'
 'DESTRUN=/chroot/named/var/run'
 'DESTLIB=/usr/lib/bind/lib'
 'DESTINC=/usr/lib/bind/include'
 'LEX=flex -8 -I'
 'YACC=yacc -d'
 'SYSLIBS=-lfl'
 'INSTALL=install'
 'MANDIR=man'
 'MANROFF=cat'
 'CATEXT=$$N'
 'PS=ps p'
 'AR=ar crus'
 'RANLIB=:'
  </pre><p>
  </p></li><li class="step"><p>
 The difference between the Makefile we used before and this one is that we modify the <code class="envar">DESTSBIN=</code>, <code class="envar">DESTEXEC=</code>, and <code class="envar">DESTRUN=</code> lines to point to the chrooted directory 
 of <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym>. With this modification, the <span class="command"><strong>ndc</strong></span> program knows where to find <code class="literal">named</code>.
 </p><pre class="screen"> 
 [root@deep ]/src# <span class="command"><strong>make clean</strong></span>
 [root@deep ]/src# <span class="command"><strong>make</strong></span>
 [root@deep ]/src# <span class="command"><strong>cp</strong></span> bin/ndc/ndc /usr/sbin/
 [root@deep ]/src# <span class="command"><strong>cp</strong></span>: overwrite `/usr/sbin/ndc'? y
 [root@deep ]/src# <span class="command"><strong>strip</strong></span> /usr/sbin/ndc 
 </pre><p>
 We build the binary file, then copy the result of ndc program to <code class="filename">/usr/sbin</code> and overwrite the old one. We dont forget to strip our new ndc binary for better performance.
 </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm11242"></a>8. Clean-up and Test the new chrooted jail</h2></div></div></div><p>
 Remove the unnecessary files and directory.
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>rm</strong></span> -f  /usr/sbin/named
 [root@deep] /# <span class="command"><strong>rm</strong></span> -f  /usr/sbin/named-xfer
 [root@deep] /# <span class="command"><strong>rm</strong></span> -f  /etc/named.conf
 [root@deep] /# <span class="command"><strong>rm</strong></span> -rf /var/named/
 </pre><p>
 We remove the <code class="literal">named</code> and <code class="literal">named-xfer</code> binaries from the <code class="filename">/usr/sbin</code> directory, since the ones we'll work with now on a daily basis are located under the 
 chroot directory. The same applies for the <code class="filename">named.conf</code> file and <code class="filename">/var/named</code> directory.
 </p><p>
 We must test the new chrooted jail configuration of our <acronym class="acronym">ISC</acronym> <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> software.

 </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
   The first thing to do is to restart our syslogd daemon with the following command:
  </p><pre class="screen">
 [root@deep] /# /etc/rc.d/init.d/syslog <span class="command"><strong>restart</strong></span>
 </pre><p>
 </p><pre class="literallayout"><code class="computeroutput">
 Shutting down kernel logger:                               	[  OK  ]
 Shutting down system logger:                               	[  OK  ]
 Starting system logger:                                    	[  OK  ]
 Starting kernel logger:                               		[  OK  ]
 </code></pre><p>
 </p></li><li class="step"><p>
 Now, start the new chrooted jail <acronym class="acronym">ISC</acronym> <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> with the following command:
 </p><pre class="screen">
 [root@deep] /# /etc/rc.d/init.d/named start
 </pre><p>
 </p><pre class="literallayout"><code class="computeroutput">
 Starting named:                                            		[  OK  ]
 </code></pre><p>
 </p></li><li class="step"><p>
 Make sure it's running as user <code class="literal">named</code> and with the new arguments.

 To verify that <acronym class="acronym">ISC</acronym> <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> is running as user <code class="literal">named</code> with the new arguments, use the following command:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>ps</strong></span> auxw | <span class="command"><strong>grep</strong></span> named
 </pre><p>
 </p><pre class="literallayout"><code class="computeroutput">
 named 11446 0.0 1.2 2444 1580 ? S 23:09 0:00 /chroot/named/usr/sbin/named -t /chroot/named/ -unamed -gnamed
 </code></pre><p>
 The first column should be <code class="literal">named</code>, which is the <acronym class="acronym">UID</acronym> named daemon is running under. The end of the line should be <span class="command"><strong>named</strong></span> -t /chroot/named/ -unamed -gnamed, which 
 are the new arguments.
 </p></li><li class="step"><p>
 Please dont forget to cleanup:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>rm</strong></span> -rf /var/tmp/src bind-src.tar.gz
 </pre><p>
 This will remove the source file and tar archive we used to compile and install <acronym class="acronym">ISC</acronym> <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym>.
 </p></li></ol></div><p>
 Further documentation, for more details there are several man pages you can read:
 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">dnsdomainname</span>(1)</span></span></dt><dd><p>
  - show the system's <acronym class="acronym">DNS</acronym> domain name
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">dnskeygen</span>(1)</span></span></dt><dd><p>
  - generate public, private, and shared secret keys for <acronym class="acronym">DNS</acronym> Security
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">dnsquery</span>(1)</span></span></dt><dd><p>
  - query domain name servers using resolver
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">named</span>(8)</span></span></dt><dd><p>
  - Internet domain name server <acronym class="acronym">DNS</acronym>
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">hesiod_to_bind [hesiod]</span>(3)</span></span></dt><dd><p>
  - Hesiod name server interface library
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ldconfig</span>(8)</span></span></dt><dd><p>
  - determine run-time link bindings
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">lesskey</span>(1)</span></span></dt><dd><p>
  - specify key bindings for less
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">raw</span>(8)</span></span></dt><dd><p>
  - bind a Linux raw character device
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">mkfifo</span>(1)</span></span></dt><dd><p>
  - make FIFOs <span class="emphasis"><em>named pipes</em></span>
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">named-bootconf</span>(8)</span></span></dt><dd><p>
  - convert name server configuration files
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">named-xfer</span>(8)</span></span></dt><dd><p>
  - ancillary agent for inbound zone transfers
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">named.conf [named]</span>(5)</span></span></dt><dd><p>
  - configuration file for
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">Opcode</span>(3)</span></span></dt><dd><p>
  - Disable named opcodes when compiling perl code
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">dig</span>(1)</span></span></dt><dd><p>
  - send domain name query packets to name servers
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">nslookup</span>(8)</span></span></dt><dd><p>
  - query Internet name servers interactively
  </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ndc</span>(8)</span></span></dt><dd><p>
  - name daemon control program
  </p></dd></dl></div><p>
 </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm11414"></a>9. DNS Administrative Tools</h2></div></div></div><p>
 The commands listed belows are some that we use often, but many more exist. Check the man pages and documentation for more details and information.
 </p><p><b>dig. </b>
 The <span class="command"><strong>dig</strong></span> command utility <span class="emphasis"><em>domain information groper</em></span> can be used to update your <code class="filename">db.cache</code> file by telling your server where the servers for the <code class="literal">root zone</code> 
 are. When the server knows about the location of these zones, it queries a new db.cache from it. The root name servers do not change very often, but they do change. A good practice is to update your <code class="filename">db.cache</code> 
 file every month or two.
 </p><p>
 Use the following command to query a new <code class="filename">db.cache</code> file for your <acronym class="acronym">DNS</acronym> Server:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>dig</strong></span> @.aroot-servers.net . ns &gt; db.cache
 </pre><p>
 Copy the db.cache file to /var/named/ after retrieving it.
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>cp</strong></span> db.cache /var/named/
 </pre><p>
 Where @a.root-servers.net is the address of the root server for querying the new <code class="filename">db.cache</code> file and <code class="filename">db.cache</code> file is the name of your new <code class="filename">db.cache</code> file.
 </p><p><b>ndc. </b>
 The <span class="command"><strong>ndc</strong></span> command utility of <acronym class="acronym">ISC</acronym>   <acronym class="acronym">BIND</acronym>/<acronym class="acronym">DNS</acronym> allows the system administrator to control interactively via a terminal the operation of a name server.
 
 Type <span class="command"><strong>ndc</strong></span> on your terminal and then help to see help on different command.
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>ndc</strong></span>
 </pre><p>
 </p><pre class="literallayout"><code class="computeroutput">
 Type   help  -or-   /h   if you need help.
 ndc&gt; help
 getpid
 status
 stop
 exec
 reload [zone] ...
 reconfig (just sees new/gone zones)
 dumpdb
 stats
 trace [level]
 notrace
 querylog
 qrylog
 help
 quit
 ndc&gt; /e
 </code></pre><p>
 </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm11447"></a>10. <acronym class="acronym">DNS</acronym> Users Tools</h2></div></div></div><p>
 The commands listed belows are some that we use often, but many more exist. Check the man pages and documentation for more details and information.
 </p><p><b>nslookup. </b>
 The <span class="command"><strong>nslookup</strong></span> program allows the user to query Internet domain name servers interactively or non-interactively. In interactive mode the user can query name servers for information about various hosts 
 and domains, and print a list of hosts in a domain. In non-interactive mode the user can just print the name and request information for a host or domain.

 Interactive mode has a lot of options and commands; it is recommended that you see the man page for nslookup, or the help under nslookup Interactive mode.
 </p><p>
 To enter under nslookup Interactive mode, use the command:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>nslookup</strong></span>
 </pre><p>
 </p><pre class="literallayout"><code class="computeroutput">
 Default Server:  deep.openna.com
 Address:  208.164.186.1

 &gt; help
 $Id$

 Commands:	(identifiers are shown in uppercase, [] means optional)
 NAME	- print info about the host/domain NAME using default server
 NAME1 NAME2	- as above, but use NAME2 as server
 help or ?	- print info on common commands; see nslookup(1) for details
 set OPTION	- set an option
 all	- print options, current server and host
 [no]debug	- print debugging information
 [no]d2	- print exhaustive debugging information
 </code></pre><p>
 </p><p>
 To run in non-interactive mode, use the command:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>nslookup</strong></span> www.redhat.com
 </pre><p>
 </p><pre class="literallayout"><code class="computeroutput">
 Server:  deep.openna.com
 Address:  208.164.186.1

 Non-authoritative answer:
 Name:    www.portal.redhat.com
 Addresses:  206.132.41.202, 206.132.41.203
 Aliases:  www.redhat.com
 </code></pre><p>
 Where <code class="literal">www.redhat.com</code> is the host name or Internet address of the name server to be looked up.
 </p><p><b>dnsquery. </b>
 The dnsquery program queries domain name servers via the resolver library calls <code class="filename">/etc/resolv.conf</code>.

 To query domain name servers using resolver, use the command:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>dnsquery</strong></span> &lt;host&gt;
 </pre><p>
 </p><div class="example"><a name="idm11472"></a><p class="title"><b>Example 21.1. dnsquery</b></p><div class="example-contents"><p>
   </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>dnsquery</strong></span> www.redhat.com
 </pre><p>
 </p><pre class="literallayout"><code class="computeroutput">
 ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 40803
 ;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 4, ADDITIONAL: 4
 ;;      www.redhat.com, type = ANY, class = IN
 www.redhat.com.         	2h19m46s IN CNAME  www.portal.redhat.com.
 redhat.com.             	2h18m13s IN NS  	ns.redhat.com.
 redhat.com.             	2h18m13s IN NS  	ns2.redhat.com.
 redhat.com.             	2h18m13s IN NS  	ns3.redhat.com.
 redhat.com.             	2h18m13s IN NS  	speedy.redhat.com.
 ns.redhat.com.          	1d2h18m8s IN A  	207.175.42.153
 ns2.redhat.com.         	1d2h18m8s IN A  	208.178.165.229
 ns3.redhat.com.         	1d2h18m8s IN A  	206.132.41.213
 speedy.redhat.com.      	2h18m13s IN A   	199.183.24.251
 </code></pre><p>

 Where &lt;host&gt; is the name of the host you want to query.
 </p></div></div><br class="example-break"><p><b>host. </b>
 The host program looks up host names using <acronym class="acronym">DNS</acronym>.

 To look up host names using domain server, use the command:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>host</strong></span> &lt;FQDN, domain names, host names, or host numbers&gt;
 </pre><p>
 </p><div class="example"><a name="idm11485"></a><p class="title"><b>Example 21.2. Look up host names</b></p><div class="example-contents"><p>
   </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>host</strong></span> redhat.com
 </pre><p>
 </p><pre class="literallayout"><code class="computeroutput">
 redhat.com has address 207.175.42.154
 </code></pre><p>
 Where &lt;FQDN, domain names, host names, or host numbers&gt; is either FDQN <code class="literal">www.redhat.com</code>, domain names <code class="literal">redhat.com</code>, host names <code class="literal">www</code> or host numbers <code class="literal">207.175.42.154</code>.
 </p></div></div><br class="example-break"><p>
 To find all of the information about a host maintained by the <acronym class="acronym">DNS</acronym>, use the command:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>host</strong></span> -a &lt;domain names &gt;
 </pre><p>
 </p><div class="example"><a name="idm11500"></a><p class="title"><b>Example 21.3. Using host</b></p><div class="example-contents"><p>
   </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>host</strong></span> -a redhat.com
 </pre><p>
 </p><pre class="literallayout"><code class="computeroutput">
 Trying null domain
 rcode = 0 (Success), ancount=6
 The following answer is not authoritative:
 The following answer is not verified as authentic by the server:
 redhat.com      8112 IN NS      ns.redhat.com
 redhat.com      8112 IN NS      ns2.redhat.com
 redhat.com      8112 IN NS      ns3.redhat.com
 redhat.com      8112 IN NS      speedy.redhat.com
 redhat.com      8112 IN A        207.175.42.154
 redhat.com      11891 IN         SOA     ns.redhat.com noc.redhat.com(
 2000021402	;serial (version)
 3600    	;refresh period
 1800    	;retry refresh this often
 604800  	;expiration period
 86400   	;minimum TTL
 )
 For authoritative answers, see:
 redhat.com      8112 IN NS      ns.redhat.com
 redhat.com      8112 IN NS      ns2.redhat.com
 redhat.com      8112 IN NS      ns3.redhat.com
 redhat.com      8112 IN NS      speedy.redhat.com
 Additional information:
 ns.redhat.com   94507	IN        	A       207.175.42.153
 ns2.redhat.com  94507 	IN	A       208.178.165.229
 ns3.redhat.com  94507 	IN        	A       206.132.41.213
 speedy.redhat.com       	8112 IN 	A       199.183.24.251
 </code></pre><p>
 This option can be used to find all of the information that is maintained by the domain server about this host, in our example <code class="literal">redhat.com</code>.
 </p></div></div><br class="example-break"><p>
 To list a complete domain, use the command:
 </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>host</strong></span> -l &lt;domain names &gt;
 </pre><p>
 </p><div class="example"><a name="idm11511"></a><p class="title"><b>Example 21.4. List a complete domain</b></p><div class="example-contents"><p>
   </p><pre class="screen">
 [root@deep] /# <span class="command"><strong>host</strong></span> -l openna.com
 </pre><p>
 </p><pre class="literallayout"><code class="computeroutput">
 openna.com name server deep.openna.com
 openna.com name server mail.openna.com
 localhost.openna.com has address 127.0.0.1
 deep.openna.com has address 208.164.186.1
 mail.openna.com has address 208.164.186.2
 www.openna.com has address 208.164.186.3
 </code></pre><p>
 This option, in the official master file format, will give a complete download of the zone data for the domain name <code class="literal">openna.com</code>. This command should be used only if it is absolutely necessary.
 </p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm11519"></a>11. Installed files</h2></div></div></div><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/rc.d/init.d/named</code></td><td><code class="filename">/usr/lib/bind/include/hesiod.h</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc0.d/K45named</code></td><td><code class="filename">/usr/lib/bind/include/sys</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc1.d/K45named</code></td><td><code class="filename">/usr/lib/bind/include/net</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc2.d/K45named</code></td><td><code class="filename">/usr/lib/bind/lib</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc3.d/K45named</code></td><td><code class="filename">/usr/lib/bind/lib/libbind.a</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc4.d/K45named</code></td><td><code class="filename">/usr/lib/bind/lib/libbind_r.a</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc5.d/K45named</code></td><td><code class="filename">/usr/lib/nslookup.help</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc6.d/K45named</code></td><td><code class="filename">/usr/man/man1/dig.1</code></td></tr><tr><td><code class="filename">/etc/named.conf</code></td><td><code class="filename">/usr/man/man1/host.1</code></td></tr><tr><td><code class="filename">/usr/bin/addr</code></td><td><code class="filename">/usr/man/man1/dnsquery.1</code></td></tr><tr><td><code class="filename">/usr/bin/nslookup</code></td><td><code class="filename">/usr/man/man1/dnskeygen.1</code></td></tr><tr><td><code class="filename">/usr/bin/dig</code></td><td><code class="filename">/usr/man/man3/hesiod.3</code></td></tr><tr><td><code class="filename">/usr/bin/dnsquery</code></td><td><code class="filename">/usr/man/man3/gethostbyname.3</code></td></tr><tr><td><code class="filename">/usr/bin/host</code></td><td><code class="filename">/usr/man/man3/inet_cidr.3</code></td></tr><tr><td><code class="filename">/usr/bin/nsupdate</code></td><td><code class="filename">/usr/man/man3/resolver.3</code></td></tr><tr><td><code class="filename">/usr/bin/mkservdb</code></td><td><code class="filename">/usr/man/man3/getnetent.3</code></td></tr><tr><td><code class="filename">/usr/lib/bind</code></td><td><code class="filename">/usr/man/man3/tsig.3</code></td></tr><tr><td><code class="filename">/usr/lib/bind/include</code></td><td><code class="filename">/usr/man/man3/getaddrinfo.3</code></td></tr><tr><td><code class="filename">/usr/lib/bind/include/arpa</code></td><td><code class="filename">/usr/man/man3/getipnodebyname.3</code></td></tr><tr><td><code class="filename">/usr/lib/bind/include/arpa/inet.h</code></td><td><code class="filename">/usr/man/man5/resolver.5</code></td></tr><tr><td><code class="filename">/usr/lib/bind/include/arpa/nameser.h</code></td><td><code class="filename">/usr/man/man5/irs.conf.5</code></td></tr><tr><td><code class="filename">/usr/lib/bind/include/arpa/nameser_compat.h</code></td><td><code class="filename">/usr/man/man5/named.conf.5</code> </td></tr><tr><td><code class="filename">/usr/lib/bind/include/isc</code></td><td><code class="filename">/usr/man/man7/hostname.7</code> </td></tr><tr><td><code class="filename">/usr/lib/bind/include/isc/eventlib.h</code></td><td><code class="filename">/usr/man/man7/mailaddr.7</code> </td></tr><tr><td><code class="filename">/usr/lib/bind/include/isc/misc.h</code></td><td><code class="filename">/usr/man/man8/named.8</code> </td></tr><tr><td><code class="filename">/usr/lib/bind/include/isc/tree.h</code></td><td><code class="filename">/usr/man/man8/ndc.8</code> </td></tr><tr><td><code class="filename">/usr/lib/bind/include/isc/logging.h</code></td><td><code class="filename">/usr/man/man8/named-xfer.8</code> </td></tr><tr><td><code class="filename">/usr/lib/bind/include/isc/heap.h</code></td><td><code class="filename">/usr/man/man8/named-bootconf.8</code> </td></tr><tr><td><code class="filename">/usr/lib/bind/include/isc/memcluster.h</code></td><td><code class="filename">/usr/man/man8/nslookup.8</code> </td></tr><tr><td><code class="filename">/usr/lib/bind/include/isc/assertions.h</code></td><td><code class="filename">/usr/man/man8/nsupdate.8</code> </td></tr><tr><td><code class="filename">/usr/lib/bind/include/isc/list.h</code></td><td><code class="filename">/usr/sbin/ndc</code> </td></tr><tr><td><code class="filename">/usr/lib/bind/include/isc/dst.h</code></td><td><code class="filename">/usr/sbin/named</code> </td></tr><tr><td><code class="filename">/usr/lib/bind/include/isc/irpmarshall.h</code></td><td><code class="filename">/usr/sbin/named-xfer</code> </td></tr><tr><td><code class="filename">/usr/lib/bind/include/netdb.h</code></td><td><code class="filename">/usr/sbin/irpd</code> </td></tr><tr><td><code class="filename">/usr/lib/bind/include/resolv.h</code></td><td><code class="filename">/usr/sbin/dnskeygen</code> </td></tr><tr><td><code class="filename">/usr/lib/bind/include/res_update.h</code></td><td><code class="filename">/usr/sbin/named-bootconf</code></td></tr><tr><td><code class="filename">/usr/lib/bind/include/irs.h</code></td><td><code class="filename">/var/named</code></td></tr><tr><td><code class="filename">/usr/lib/bind/include/irp.h</code></td><td> </td></tr></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="pr6ch22SSMn"></a>Chapter 22. Software -Server/Mail Network</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm11678">1. Linux Sendmail Server</a></span></dt><dt><span class="section"><a href="#idm11743">2. Compile and optimize</a></span></dt><dt><span class="section"><a href="#idm11916">3. Configurations</a></span></dt><dt><span class="section"><a href="#idm11977">4. The <code class="filename">/etc/sendmail.mc</code> file /Central Mail Hub</a></span></dt><dt><span class="section"><a href="#idm12145">5. Build and Tweak Sendmail</a></span></dt><dd><dl><dt><span class="section"><a href="#idm12162">5.1. The <code class="filename">null.mc</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm12262">6. The <code class="filename">/etc/mail/access</code> and <code class="filename">access.db</code> files </a></span></dt><dt><span class="section"><a href="#idm12298">7. The <code class="filename">/etc/mail/aliases</code> and <code class="filename">aliases.db</code> files</a></span></dt><dd><dl><dt><span class="section"><a href="#idm12333">7.1. The <code class="filename">/etc/mail/</code> Directory</a></span></dt></dl></dd><dt><span class="section"><a href="#idm12384">8. The <code class="filename">/etc/mail/local-host-names</code> file </a></span></dt><dd><dl><dt><span class="section"><a href="#idm12420">8.1. Configure the <code class="filename">/etc/sysconfig/sendmail</code> file </a></span></dt></dl></dd><dt><span class="section"><a href="#idm12442">9. The <code class="filename">/etc/rc.d/init.d/sendmail</code> script file</a></span></dt><dt><span class="section"><a href="#idm12474">10. Secure Sendmail using <span class="command"><strong>smrsh</strong></span></a></span></dt><dt><span class="section"><a href="#idm12577">11. The <code class="filename">/etc/mail/aliases</code> file</a></span></dt><dt><span class="section"><a href="#idm12660">12. Limit queue processing to <code class="literal">root</code></a></span></dt><dd><dl><dt><span class="section"><a href="#idm12681">12.1. The <acronym class="acronym">SMTP</acronym> greeting message</a></span></dt></dl></dd><dt><span class="section"><a href="#idm12780">13. Sendmail Administrative Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm12823">13.1. Sendmail Users Tools</a></span></dt></dl></dd><dt><span class="section"><a href="#idm12842">14. Installed  files: Sendmail -Central Mail Hub</a></span></dt><dt><span class="section"><a href="#idm12932">15. Installed files: Sendmail -Local server/client</a></span></dt></dl></div><div class="highlights"><p>
                    The Sendmail program is one of the most widely used Internet Mail Transport Agents <acronym class="acronym">-MTA</acronym>s in the world. The purpose of an <acronym class="acronym">MTA</acronym> is to send mail from one machine to another, and nothing 
                    else. Sendmail is not a client program, which you use to read your e-mail. Instead, it actually moves your email over networks, or the Internet, to where you want it to go. Sendmail has been an easy target for system 
                    crackers to exploit in the past, but with the advent of Sendmail version 8, this has become much more difficult.
                    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm11678"></a>1. Linux Sendmail Server</h2></div></div></div><p>
         In our configuration and installation we'll provide you two different configurations that you can set up for Sendmail; 
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Central Mail Hub Relay, </span></dt><dd><p>
          The Central Mail Hub Relay Server configuration will be used for your server where the assigned task is to send, receive and relay all mail for all local or neighbor client and server mail machines you may have on your network. 
          </p></dd><dt><span class="term">local or neighbor clients and servers.</span></dt><dd><p>
         A local or neighbor client and server refer to all other local server or client machines on your network that run Sendmail and send all outgoing mail to the Central Mail Hub for future delivery. 
         This kind of internal client never receives mail directly via the Internet; Instead, all mail from the Internet for those computers is kept on the Mail Hub server. 
         </p></dd></dl></div><p>
         It is a good idea to run one Central Mail Hub Server for all computers on your network; this architecture will limit the task managements on the server and client machines, and improve the security of your site.
         </p><p>
         You can configure the neighbor Sendmail so that it accepts only mail that is generated locally, thus insulating neighbor machines for easier security. The Gateway server outside the firewall, or part of it acts as a 
         proxy and accepts external mail via its Firewall rules file that is destined for internal delivery from the outside, and forwards it to the Central Mail Hub Server. Also note that the Gateway server is configured like 
         a neighbor Sendmail server to never accept incoming mail from the outside the <code class="literal">Internet</code>.
         </p><p>
         Here is a graphical representation of the Sendmail configuration used in this book, with different settings: 

         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Central Mail Hub Relay, 
         </p></li><li class="listitem"><p>
         local or neighbor <span class="emphasis"><em>client and servers</em></span> on different servers. 
         </p></li></ul></div><p>
         Lots of possibilities exist, and depends on your need and network architecture.
         </p><div class="mediaobject"><img src="./images/Sendmail-Schema.gif" alt="Sendmail configuration examples"></div><p>
         </p><p>
         These installation instructions assume
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Commands are Unix-compatible.
         </p></li><li class="listitem"><p>
         The source path is <code class="filename">/var/tmp</code>, <span class="emphasis"><em>other paths are possible</em></span>.
         </p></li><li class="listitem"><p>
         Installations were tested on Red Hat Linux 6.1 and 6.2.
         </p></li><li class="listitem"><p>
         All steps in the installation will happen in super-user account root.
         </p></li><li class="listitem"><p>
         Sendmail version number is 8.10.1
         </p></li></ul></div><p>
         </p><p><a name="pr6ch22sc1snml"></a>
         These are the package(s) you need to download and they are available here
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         Sendmail Homepage: <a class="link" href="#prtinxfp19" title="Sendmail">http://www.sendmail.org/</a>
         </td></tr><tr><td>
         Sendmail FTP Sire: <a class="link" href="#prtinxfp19" title="Sendmail">204.152.184.34</a>
         </td></tr><tr><td>
         You must be sure to download: sendmail.8.10.1.tar.gz
         </td></tr></table><p>
         </p><p>
         Before you decompress the tarballs, it is a good idea to make a list of files on the system before you install Sendmail, and one afterwards, and then compare them using diff to find out what file it placed 
         where. Simply run <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Sendmail1</code></strong> before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Sendmail2</code></strong> after you install the software, and 
         use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>Sendmail1 Sendmail2 &gt; Sendmail-Installed</code></strong> to get a list of what changed.
         </p><p>
         You need to compile, so decompress the tarball (tar.gz). which you have downloaded:d
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>cp</strong></span> sendmail.version.tar.gz /var/tmp
         [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
         [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf sendmail.version.tar.gz
         </pre><p>
         </p><p>
         Before you compile it is always better to configure to your needs, move into the new Sendmail directory and edit the <code class="filename">smrsh.c</code> file <span class="command"><strong>vi</strong></span> +77 <code class="filename">smrsh/smrsh.c</code> and change the line:
         </p><pre class="programlisting">
         # define CMDDIR         "/usr/adm/sm.bin"
         </pre><p>
         To read:
         </p><pre class="programlisting">
         # define CMDDIR        "/etc/smrsh"
         </pre><p>
         This modification specifies the default search path for commands runs by smrsh program. It allows us to limit the location where these programs may reside.
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm11743"></a>2. Compile and optimize</h2></div></div></div><p>
         The Build script of Sendmail uses by default a site configuration file that correspond to your operating system type to get information about definitions for system installation and various compilation values. This 
         file is located under the subdirectory named <code class="filename">devtools/OS</code> and if you're running a Linux system, it'll be named <code class="literal">Linux</code>. We'll rebuild this site configuration file 
         to suit our Linux system installation and put it in the default <code class="filename">devtools/OS</code> sub-directory of the  Sendmail source distribution since the Build script will look for the default 
         site configuration file in this directory during compile time of Sendmail.
         </p><p>
         Move into the new Sendmail directory, edit the Linux file, <span class="command"><strong>vi</strong></span> <code class="filename">devtools/OS/Linux</code>, and remove all predefined lines then add the following lines inside the file:
         </p><pre class="programlisting">
         define(`confENVDEF', `-DPICKY_QF_NAME_CHECK -DXDEBUG=0')
         define(`confCC', `egcs')
         define(`confOPTIMIZE', `-O9 -funroll-loops -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions')
         define(`confLIBS', `-lnsl')
         define(`confLDOPTS', `-s')
         define(`confMANROOT', `/usr/man/man')
         define(`confMANOWN', `root')
         define(`confMANGRP', `root')
         define(`confMANMODE', `644')
         define(`confMAN1SRC', `1')
         define(`confMAN5SRC', `5')
         define(`confMAN8SRC', `8')
         define(`confDEPEND_TYPE', `CC-M')
         define(`confNO_HELPFILE_INSTALL)
         define(`confSBINGRP', `root')
         define(`confSBINMODE', `6755')
         define(`confUBINOWN', `root')
         define(`confUBINGRP', `root')
         define(`confEBINDIR', `/usr/sbin')
         </pre><p>
         </p><p>
         This tells Linux file to set itself up for this particular configuration setup with:
          </p><div class="glosslist"><dl><dt><span class="glossterm">define(`confENVDEF', `-DPICKY_QF_NAME_CHECK -DXDEBUG=0')</span></dt><dd class="glossdef"><p>
         This macro option is used primarily to specify code that should either be specially included or excluded. With <code class="envar">-DPICKY_QF_NAME_CHECK</code> defined, Sendmail will log an error if the name of the <code class="filename">qf</code> file 
         is incorrectly formed and will rename the <code class="filename">qf</code> file into a <code class="filename">Qf</code> file. The  <code class="literal">-DXDEBUG=0</code> argument disables the step of additional internal checking during compile time.
         </p></dd><dt><span class="glossterm">define(`confCC', `egcs')</span></dt><dd class="glossdef"><p>
         This macro option defines the C compiler to use for compilation of Sendmail. In our case we use the egcs C compiler for better optimization.
         </p></dd><dt><span class="glossterm">define(`confOPTIMIZE', `-O9 -funroll-loops -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions')</span></dt><dd class="glossdef"><p>
         This macro option defines the flags passed to CC for optimization related to our specific CPU architecture.
         </p></dd><dt><span class="glossterm">define(`confLIBS', `-lnsl')</span></dt><dd class="glossdef"><p>
         This macro option defines the  -l flags passed to ld.
         </p></dd><dt><span class="glossterm">define(`confLDOPTS', `-s')</span></dt><dd class="glossdef"><p>
         This macro option defines the linker options passed to ld.
         </p></dd><dt><span class="glossterm">define(`confMANROOT', `/usr/man/man')</span></dt><dd class="glossdef"><p>
         This macro option defines the location to install the Sendmail man pages.
         </p></dd><dt><span class="glossterm">define(`confMANOWN', `root')</span></dt><dd class="glossdef"><p>
         This macro option defines the owner for all Sendmail installed man pages.
         </p></dd><dt><span class="glossterm">define(`confMANGRP', `root')</span></dt><dd class="glossdef"><p>
         This macro option defines the group for all Sendmail installed man pages.
         </p></dd><dt><span class="glossterm">define(`confMANMODE', `644')</span></dt><dd class="glossdef"><p>
         This macro option defines the mode for all Sendmail installed man pages.
         </p></dd><dt><span class="glossterm">define(`confMAN1SRC', `1')</span></dt><dd class="glossdef"><p>
         This macro option defines the source for man pages installed in confMAN1.
         </p></dd><dt><span class="glossterm">define(`confMAN5SRC', `5')</span></dt><dd class="glossdef"><p>
         This macro option defines the source for man pages installed in confMAN5.
         </p></dd><dt><span class="glossterm">define(`confMAN8SRC', `8')</span></dt><dd class="glossdef"><p>
         This macro option defines the source for man pages installed in confMAN8.
         </p></dd><dt><span class="glossterm">define(`confDEPEND_TYPE', `CC-M')</span></dt><dd class="glossdef"><p>
         This macro option specifies how to build dependencies with Sendmail.
         </p></dd><dt><span class="glossterm">define(`confNO_HELPFILE_INSTALL')</span></dt><dd class="glossdef"><p>
         This macro option specifies to not install the Sendmail help file by default. Some experienced administrators recommend it, for better security.
         </p></dd><dt><span class="glossterm">define(`confSBINGRP', `root')</span></dt><dd class="glossdef"><p>
         This macro option defines the group for all Sendmail setuid binaries.
         </p></dd><dt><span class="glossterm">define(`confSBINMODE', `6755')</span></dt><dd class="glossdef"><p>
         This macro option defines the mode for all Sendmail setuid binaries.
         </p></dd><dt><span class="glossterm">define(`confUBINOWN', `root')</span></dt><dd class="glossdef"><p>
         This macro option defines the owner for Sendmail binaries.
         </p></dd><dt><span class="glossterm">define(`confUBINGRP', `root')</span></dt><dd class="glossdef"><p>
         This macro option defines the group for Sendmail binaries.
         </p></dd><dt><span class="glossterm">define(`confEBINDIR', `/usr/sbin')</span></dt><dd class="glossdef"><p>
         This macro option defines where to install binaries executed from other binaries. On Red Hat Linux the path must be set to the <code class="filename">/usr/sbin</code> directory.
         </p></dd></dl></div><p>
         </p><p>
         Now we must compile and install Sendmail in the server:
         
         </p><pre class="screen">
         [root@deep ]/sendmail-8.10.1# <span class="command"><strong>cd</strong></span> sendmail
         [root@deep ]/sendmail# <span class="command"><strong>sh Build</strong></span>
         [root@deep ]/sendmail# <span class="command"><strong>sh Build install</strong></span>
         [root@deep ]/sendmail# <span class="command"><strong>cd</strong></span> ..
         [root@deep ]/sendmail-8.10.1# <span class="command"><strong>cd</strong></span> mailstats
         [root@deep ]/mailstats# <span class="command"><strong>sh Build install</strong></span>
         [root@deep ]/mailstats# <span class="command"><strong>cd</strong></span> ..
         [root@deep ]/sendmail-8.10.1# <span class="command"><strong>cd</strong></span> smrsh
         [root@deep ]/smrsh# <span class="command"><strong>sh Build install</strong></span>
         [root@deep ]/smrsh# <span class="command"><strong>cd</strong></span> ..
         [root@deep ]/sendmail-8.10.1# <span class="command"><strong>cd</strong></span> makemap <a name="sndmmp"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span> 
         [root@deep ]/makemap# <span class="command"><strong>sh Build install</strong></span>   <a name="sndmmpbi"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span> 
         [root@deep ]/makemap# <span class="command"><strong>cd</strong></span> ..
         [root@deep ]/sendmail-8.10.1# <span class="command"><strong>cd</strong></span> praliases <a name="sndpral"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
         [root@deep ]/praliases# <span class="command"><strong>sh Build install</strong></span> <a name="sndpralbi"></a><span><img src="images/callouts/4.png" alt="4" border="0"></span>
         [root@deep ]/praliases# <span class="command"><strong>cd</strong></span> ..
         [root@deep ]/sendmail-8.10.1# <span class="command"><strong>ln</strong></span> -fs /usr/sbin/sendmail /usr/lib/sendmail
         [root@deep ]/sendmail-8.10.1# <span class="command"><strong>chmod</strong></span> 511 /usr/sbin/smrsh
         [root@deep ]/sendmail-8.10.1# <span class="command"><strong>install</strong></span> -d -m 755 /var/spool/mqueue
         [root@deep ]/sendmail-8.10.1# <span class="command"><strong>chown</strong></span> root.mail /var/spool/mqueue
         [root@deep ]/sendmail-8.10.1# <span class="command"><strong>mkdir</strong></span> /etc/smrsh
         </pre><p>
         </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#sndmmp"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            Required only for Mail Hub configuration
         </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#sndmmpbi"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
         Required only for Mail Hub configuration
         </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#sndpral"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>
         Required only for Mail Hub configuration
         </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#sndpralbi"><span><img src="images/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>
         Required only for Mail Hub configuration
         </p></td></tr></table></div><p>
         
         </p><p>
           </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         The <span class="command"><strong>sh Build</strong></span> command would build and make the necessary dependencies for the different binary files required by Sendmail before installation on your system.
         </p></li><li class="listitem"><p>
         The <span class="command"><strong>sh Build install</strong></span> command would install sendmail, mailstats, makemap, praliases, smrsh binaries as well as the corresponding man pages on your system if compiled with this command.
         </p></li><li class="listitem"><p>
         The <span class="command"><strong>ln</strong></span> -fs command would make a symbolic link of the sendmail binary to the <code class="filename">/usr/lib</code> directory. This is required, since 
         some programs hope to find the sendmail binary in this directory <code class="filename">/usr/lib</code>.
         </p></li><li class="listitem"><p>
         The <span class="command"><strong>install</strong></span> command would create the directory <code class="filename">mqueue</code> with permission 755 under <code class="filename">/var/spool</code>. A mail message 
         can be temporarily undeliverable for a wide variety of reasons. To ensure that such messages are eventually delivered, Sendmail stores them in its queue directory until they can be delivered successfully.
         </p></li><li class="listitem"><p>
         The <span class="command"><strong>chown</strong></span> command would set <acronym class="acronym">UID</acronym> root and <acronym class="acronym">GID</acronym> mail for the <code class="filename">mqueue</code> directory.
         </p></li><li class="listitem"><p>
         The <span class="command"><strong>mkdir</strong></span> command would create the <code class="filename">/etc/smrsh</code> directory on your system. This directory is where we'll put all program mailers that we allow Sendmail 
         to be able to run.
         </p></li></ul></div><p>
         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         The programs <span class="command"><strong>makemap</strong></span>, and <span class="command"><strong>praliases</strong></span> must only be installed on the Central Mail Hub Server. makemap permits you to create a database map like the <code class="filename">/etc/mail/aliases.db</code> 
         or <code class="filename">/etc/mail/access.db</code> files, for Sendmail. The praliases display the system mail aliases, the content of <code class="filename">/etc/mail/aliases file</code>. Since it is better to only have one 
         place like our Central Mail Hub to handle and manage all the <code class="filename">db</code> files in our network, then it is not necessary to use the makemap, and praliases programs and build <code class="filename">db</code> files 
         on your other hosts in the network.
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm11916"></a>3. Configurations</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
               You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
               for respective software. For example <em class="wordasword">Sendmail</em> configuration file are organised like this:
               </p><pre class="literallayout"><code class="computeroutput">
        total 32
-rw-r--r--    1 harrypotter    harrypotter         684 Jun  8 13:00 Linux
-rw-r--r--    1 harrypotter    harrypotter        3648 Jun  8 13:00 access
-rw-r--r--    1 harrypotter    harrypotter         547 Jun  8 13:00 aliases
drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 init.d/
-rw-r--r--    1 harrypotter    harrypotter         137 Jun  8 13:00 local-host-names
-rw-r--r--    1 harrypotter    harrypotter         109 Jun  8 13:00 null.mc
-rw-r--r--    1 harrypotter    harrypotter         685 Jun  8 13:00 sendmail.mc
drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 sysconfig/
               </code></pre><p>
               You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
               responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
             </p></div><p>
         To run a Central Mail Hub Server, the following files are required and must be created or copied to the appropriate directories on your server.
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Copy the sendmail file in the <code class="filename">/etc/sysconfig</code> directory.
         </p></li><li class="listitem"><p>
         Copy the sendmail script file in the <code class="filename">/etc/rc.d/init.d/</code> directory.
         </p></li><li class="listitem"><p>
         Copy the local-host-names file in the <code class="filename">/etc/mail</code> directory.
         </p></li><li class="listitem"><p>
         Copy the access file in the <code class="filename">/etc/mail</code> directory.
         </p></li><li class="listitem"><p>
         Copy the aliases file in the <code class="filename">/etc/mail</code> directory.
         </p></li></ul></div><p>
         Create the <code class="filename">virtusertable</code>, <code class="filename">domaintable</code>, <code class="filename">mailertable</code> and <code class="filename">.db</code> files in <code class="filename">/etc/mail</code> directory.
         </p><p>
         To run a Local or Neighbor Client, Server, the following files are required and must be created or copied to the appropriate directories on your server.
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Copy the sendmail file in the <code class="filename">/etc/sysconfig</code> directory.
         </p></li><li class="listitem"><p>
         Copy the sendmail script file in the <code class="filename">/etc/rc.d/init.d/</code> directory.
         </p></li><li class="listitem"><p>
         Copy the local-host-names file in the <code class="filename">/etc/mail</code> directory.
         </p></li></ul></div><p>
         </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
         You can obtain the configuration files listed below on our <code class="filename">floppy.tgz</code> archive. Copy the following files from the decompressed <code class="filename">floppy.tgz</code> archive to the appropriate places or copy and paste them directly from this book to the concerned file.
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm11977"></a>4. The <code class="filename">/etc/sendmail.mc</code> file /Central Mail Hub</h2></div></div></div><p>
         The <code class="filename">/etc/sendmail.mc</code> file for the Central Mail Hub, instead of having each individual server or workstation in a network handle its own mail, it can be advantageous to have powerful central server that handles 
         all mail. Such a server is called a Mail Hub. The advantage of a Central Mail Hub is:
         </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
         All incoming mail is sent to the hub, and no mail is sent directly to a client machine.
         </p></li><li class="listitem"><p>
         All outgoing mail from clients is sent to the Hub, and the Hub then forwards that mail to its ultimate destination.
         </p></li><li class="listitem"><p>
         All outgoing mail appears to come from a single server and no client's name needs to be known to the outside world.
         </p></li><li class="listitem"><p>
         No client needs to run a sendmail daemon to listen for mail.
         </p></li></ol></div><p>
         </p><p>
         The sendmail.cf is the first file reading by Sendmail when it runs and one of the most important for Sendmail. Among the many items contained in that file are the locations of all the other files, the default permissions for those files and 
         directories that Sendmail needs. The m4 macro preprocessor program of Linux is used by Sendmail V8 to produce a Sendmail configuration file. This macro program will produce the <code class="filename">/etc/mail/sendmail.cf</code> configuration file 
         by processing a file whose name ends in <code class="filename">.mc</code>. 
         </p><p>
         For this reason, we'll create this file <code class="filename">sendmail.mc</code> and put the necessary macro values in it to allow the m4 program to process, <span class="emphasis"><em>read</em></span> its 
         input and gathers definitions of macros, and then replaces those macros with their values and output the result to create our <code class="filename">sendmail.cf</code> file. Please refer to the Sendmail documentation and README file under the 
         <code class="filename">cf</code> subdirectory of the V8 Sendmail source distribution for more information.
         </p><p>
         Create the sendmail.mc file, <span class="command"><strong>touch</strong></span> <code class="filename">/var/tmp/sendmail-version/cf/cf/sendmail.mc</code> and add the following lines:
         </p><pre class="programlisting">
         define(`confDEF_USER_ID',``8:12'')dnl
         OSTYPE(`linux')dnl
         DOMAIN(`generic')dnl
         define(`confTRY_NULL_MX_LIST',true)dnl
         define(`confDONT_PROBE_INTERFACES',true)dnl
         define(`PROCMAIL_MAILER_PATH',`/usr/bin/procmail')dnl
         define(`LOCAL_MAILER_FLAGS', `ShPfn')dnl
         define(`LOCAL_MAILER_ARGS', `procmail -a $h -d $u')dnl
         FEATURE(`smrsh',`/usr/sbin/smrsh')dnl
         FEATURE(`mailertable')dnl
         FEATURE(`virtusertable',`hash -o /etc/mail/virtusertable')dnl
         FEATURE(`redirect')dnl
         FEATURE(`always_add_domain')dnl
         FEATURE(`use_cw_file')dnl
         FEATURE(`local_procmail')dnl
         FEATURE(`access_db')dnl
         FEATURE(`blacklist_recipients')dnl
         FEATURE(`dnsbl')dnl
         MAILER(`local')dnl
         MAILER(`smtp')dnl
         MAILER(`procmail')dnl
         </pre><p>
         </p><p>
         This tells the sendmail.mc file to set itself up for this particular configuration with:
         </p><div class="glosslist"><a name="pr6ch22sc3gls"></a><dl><dt><span class="glossterm">define(`confDEF_USER_ID',``8:12'')dnl</span></dt><dd class="glossdef"><p>
         This configuration option specifies the default user id. In our case the <code class="literal">user mail</code> and <code class="literal">group mail</code>, which correspond to ID number <code class="literal">8:12</code> <span class="emphasis"><em>see 
         the <code class="filename">/etc/passwd</code> and <code class="filename">/etc/group</code> file</em></span>.
         </p></dd><dt><span class="glossterm">OSTYPE(`linux')dnl</span></dt><dd class="glossdef"><p>
         This configuration option specifies the default operating system Sendmail wil bel running on; in our case the <code class="literal">linux</code> system. This item is one of the minimal pieces of information required by the <code class="filename">mc</code> file.
         </p></dd><dt><span class="glossterm">DOMAIN(`generic')dnl</span></dt><dd class="glossdef"><p>
         This configuration option will specify and describe a particular domain appropriated for your environment.
         </p></dd><dt><span class="glossterm">define(`confTRY_NULL_MX_LIST',true)dnl</span></dt><dd class="glossdef"><p>
         This configuration option specifies whether the receiving server is the best <code class="literal">MX</code> for a host and if so, try connecting to that host directly.
         </p></dd><dt><span class="glossterm">define(`confDONT_PROBE_INTERFACES',true)dnl</span></dt><dd class="glossdef"><p>
         This configuration option, if set to true, means Sendmail will _not_insert the names and addresses of any local interfaces into the <code class="envar">$=w</code> class, <span class="emphasis"><em>list of known equivalent addresses</em></span>.
         </p></dd><dt><span class="glossterm">define(`PROCMAIL_MAILER_PATH',`/usr/bin/procmail')dnl</span></dt><dd class="glossdef"><p>
         This configuration option sets the path to the procmail program installed in your server. Since the path in Red Hat Linux differs from other Linux versions, we must specify the new path with this macro. It's important 
         to note that this macro is also used by <code class="envar">FEATURE(`local_procmail')</code> as defined later in this file.
         </p></dd><dt><span class="glossterm">define(`LOCAL_MAILER_FLAGS', `ShPfn')dnl</span></dt><dd class="glossdef"><p>
         This configuration option defines the flags that must be used by the local mailer (procmail). See your Sendmail documentation for more information of each one.
         </p></dd><dt><span class="glossterm">define(`LOCAL_MAILER_ARGS', `procmail -a $h -d $u')dnl</span></dt><dd class="glossdef"><p>
         This configuration option defines the arguments that must be passed to the local mailer (procmail). See your Sendmail documentation for more information on each one.
         </p></dd><dt><span class="glossterm">FEATURE(`smrsh',`/usr/sbin/smrsh')dnl</span></dt><dd class="glossdef"><p>
         This m4 macro enables the use of <span class="command"><strong>smrsh</strong></span>, <span class="emphasis"><em>the sendmail restricted shell</em></span>, instead of the default <code class="filename">/bin/sh</code> for mailing programs. With this feature 
         you can control what program gets run via e-mail through the <code class="filename">/etc/mail/aliases</code> and <code class="filename">~/.forward</code> files. The default location for the <span class="command"><strong>smrsh</strong></span> program is <code class="filename">/usr/libexec/smrsh</code>.
         Since we have installed <span class="command"><strong>smrsh</strong></span> in another location, we need to add an argument to the smrsh feature to indicate the new placement <code class="filename">/usr/sbin/smrsh</code>. The use of <span class="command"><strong>smrsh</strong></span> is recommended 
         by <acronym class="acronym">CERT</acronym>, so you are encouraged to use this feature as often as possible.
         </p></dd><dt><span class="glossterm">FEATURE(`mailertable')dnl</span></dt><dd class="glossdef"><p>
         This m4 macro enables the use of <code class="literal">mailertable</code> <span class="emphasis"><em>database selects new delivery agents</em></span>. A mailertable is a database that maps <code class="literal">host.domain</code> names to special delivery agent and new 
         domain name pairs. With this feature, mail can be delivered through the use of a specified or particular delivery agent to a new domain name. Usually, this feature must be available only on a Central Mail Hub server.
         </p></dd><dt><span class="glossterm">FEATURE(`virtusertable',`hash -o /etc/mail/virtusertable')dnl</span></dt><dd class="glossdef"><p>
         This m4 macro enables the use of <code class="literal">virtusertable</code>, <span class="emphasis"><em>support for virtual domains</em></span>, which allow multiple virtual domains to be hosted on one machine. A virtusertable is a database that maps virtual domains into new 
         addresses. With this feature, mail for virtual domains can be delivered to a local, remote, or single user address. Usually this feature must be available only on a Central Mail Hub server.
         </p></dd><dt><span class="glossterm">FEATURE(`redirect')dnl</span></dt><dd class="glossdef"><p>
         This m4 macro enables the use of <code class="literal">redirect</code> <span class="emphasis"><em>support for</em></span> <code class="literal">address.REDIRECT</code>. With this feature, mail addressed to a retired user account <code class="literal">wahib</code>, for example, will be bounced with an indication of the new forwarding address. The retired 
         accounts must be set up in the aliases file on the mail server. Usually this feature must be available only on a Central Mail Hub server.
         </p></dd><dt><span class="glossterm">FEATURE(`always_add_domain')dnl</span></dt><dd class="glossdef"><p>
         This m4 macro enables the use of <code class="envar">always_add_domain</code>, <span class="emphasis"><em>add the local domain even on local mail</em></span>. With this feature, all addresses that are locally delivered will be fully qualified. It is safe and recommended to set this feature for security reasons.
         </p></dd><dt><span class="glossterm">FEATURE(`use_cw_file')dnl</span></dt><dd class="glossdef"><p>
         This m4 macro enables the use of <code class="envar">use_cw_file</code>, use <code class="filename">/etc/mail/local-host-names</code> file for local hostnames. With this feature you can declare a list of hosts in the <code class="filename">/etc/mail/local-host-names</code> file for 
         which the local host is acting as the <code class="literal">MX</code> recipient. In other word this feature causes the file <code class="filename">/etc/mail/local-host-names</code> to be read to obtain alternative names for the local host.
         </p></dd><dt><span class="glossterm">FEATURE(`local_procmail')dnl</span></dt><dd class="glossdef"><p>
         This m4 macro enables the use of <code class="envar">local_procmail</code> <span class="emphasis"><em>use procmail as local delivery agent</em></span>. With this feature you can use procmail as a Sendmail delivery agent.
         </p></dd><dt><span class="glossterm">FEATURE(`access_db')dnl</span></dt><dd class="glossdef"><p>
         This m4 macro enables the access database feature. With this feature you have the ability through the access db to allow or refuse to accept mail from specified domains. Usually this feature must be available 
         only in a Central Mail Hub server.
         </p></dd><dt><span class="glossterm">FEATURE(`blacklist_recipients')dnl</span></dt><dd class="glossdef"><p>
         This m4 macro enables the ability to block incoming mail for certain recipient usernames, hostnames, or addresses. With this feature you can, for example, block incoming mail 
         to <code class="literal">user nobody</code>, <code class="literal">host foo.mydomain.com</code>, or <code class="literal">guest@bar.mydomain.com.</code>
         </p></dd><dt><span class="glossterm">FEATURE(`dnsbl')dnl</span></dt><dd class="glossdef"><p>
         This m4 macro enables Sendmail to reject mail from any site in the Realtime Blackhole List database <code class="literal">rbl.maps.vix.com</code>. The <acronym class="acronym">DNS</acronym> based rejection is a database maintained 
         in <acronym class="acronym">DNS</acronym> of spammers. For details, see <a class="link" href="#prtinxfp19" title="Sendmail">http://maps.vix.com/rbl/</a>.
         </p></dd><dt><span class="glossterm">MAILER(`local'), MAILER(`smtp'), and MAILER(`procmail')dnl</span></dt><dd class="glossdef"><p>
         This m4 macro enables the use of local, smtp, and procmail as delivery agents <span class="emphasis"><em>in Sendmail by default, delivery agents are not automatically declared</em></span>. With this feature, you can specify which ones you want to support 
         and which ones to ignore. The MAILER(`local'), MAILER(`smtp'), and MAILER(`procmail') options cause support for local, smtp, esmtp, smtp8, relay delivery agents and procmail to be included. It's important to note that MAILER(`smtp') should 
         always precede MAILER(`procmail').
         </p></dd></dl></div><p>
         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         Sometimes, a domain with which you wish to continue communications may end up in the <acronym class="acronym">RBL</acronym> list. In this case, Sendmail allows you to override these domains to allow their e-mail to be received. To do this, simply 
         edit the <code class="filename">/etc/mail/access</code> file and add the appropriate domain information.
         </p></div><div class="example"><a name="idm12140"></a><p class="title"><b>Example 22.1. Overriding <acronym class="acronym">RBL</acronym></b></p><div class="example-contents"><p>
           </p><pre class="programlisting">
         blacklisted.domain      OK
         </pre><p>
         </p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm12145"></a>5. Build and Tweak Sendmail</h2></div></div></div><p>
           Now that our macro configuration file <code class="filename">sendmail.mc</code> is created, we can build the sendmail configuration file <code class="filename">sendmail.cf</code> from these statements with the following commands:
           </p><pre class="screen">
           [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp/sendmail-version/cf/cf/
           [root@deep ]/cf# <span class="command"><strong>m4</strong></span> ../m4/cf.m4 sendmail.mc &gt; /etc/mail/sendmail.cf
           </pre><p>
           </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
           Here, the <code class="filename">../m4/cf.m4</code> tells m4 program where to look for its default configuration file information.
           </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm12162"></a>5.1. The <code class="filename">null.mc</code> file</h3></div></div></div><p>
           Since our local clients machines never receive mail directly from the outside world, and relay, <span class="emphasis"><em>send</em></span> all their mail through the Mail Hub server, we will create a special file 
           called <code class="filename">null.mc</code> which, when later processed, will create a customized <code class="filename">sendmail.cf</code> configuration file that responds to this special setup for our neighbour 
           or local server client machines. This m4 macro file is simple to create and configure because it doesn't need a lot of features, as the configuration file <code class="filename">-sendmail.mc,</code> for 
           the Central Mail Hub server did.</p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Caution.gif" alt="Caution"></span>
</h3><p>
           The <code class="filename">null.mc</code> file is for the local or neighbour client and server machines only
           </p></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
           Create the <code class="filename">null.mc</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/var/tmp/sendmail-version/cf/cf/null.mc</code> and add the following lines:
           
           </p><pre class="programlisting">
             OSTYPE(`linux')dnl                        <a name="ostln"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
           DOMAIN(`generic')dnl                        <a name="dmgen"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
           FEATURE(`nullclient',`mail.openna.com')dnl  <a name="fnlclt"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
           undefine(`ALIAS_FILE')dnl                   <a name="undalf"></a><span><img src="images/callouts/4.png" alt="4" border="0"></span>
           </pre><p>
           </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ostln"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
           This configuration option specifies the default operating system Sendmail will be running on, in our case, the <code class="literal">linux</code> system. This item is one of the minimal pieces of  information 
           required by the <code class="filename">mc</code> file.
           </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#dmgen"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
           This configuration option will specify and describe a particular domain appropriated for your environment.
           </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#fnlclt"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>
           This m4 macro sets your clients machines to never receive mail directly, to send their mail to a Central Mail Hub, and relay all mail through that server rather than sending directly. This feature creates a 
           stripped down configuration file containing nothing but support for forwarding all mail to a Mail Hub via a local SMTP-based network. The argument <code class="envar">`mail.openna.com'</code> included in this feature is the canonical 
           name of that Mail Hub. You should, of course, change this canonical name to reflect your Mail Hub Server for example: <code class="envar">FEATURE(`nullclient',` my.mailhub.com')</code>.
           </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#undalf"><span><img src="images/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>
           This configuration option prevents the nullclient version of Sendmail from trying to access <code class="filename">/etc/mail/aliases</code> and <code class="filename">/etc/mail/aliases.db</code> files. With the adding of this 
           line in the <code class="filename">.mc</code> file, you don't need to have an <code class="filename">aliases</code> file on all your internal neighbor client Sendmail machines. Aliases files are required only on the Mail Hub Server 
           for all server and client aliases on the network.</p></td></tr></table></div><p>
           
           </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
           We advice that with this kind of configuration, no mailers should be defined, and no aliasing or forwarding is done.
           </p></div><p>
           </p></li><li class="step"><p>
           Now that our macro configuration file <code class="filename">null.mc</code> is created, we can build the Sendmail configuration file <code class="filename">sendmail.cf</code> from these statements in all our neighbor servers, and client 
           machines with the following commands:
           </p><pre class="screen">
           [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp/sendmail-version/cf/cf/
           [root@deep ]/cf# <span class="command"><strong>m4</strong></span> ../m4/cf.m4 null.mc &gt; /etc/mail/sendmail.cf
           </pre><p>
           </p></li><li class="step"><p>
           No mail should ever again be delivered to your local machine. Since there will be no incoming mail connections, you no longer needed to run a Sendmail daemon on your neighbor or local server, client machines.
           To stop the Sendmail daemon from running on your neighbor or local server, or client machines, edit or create the <code class="filename">/etc/sysconfig/sendmail</code> file and change/add the lines that read:
           </p><pre class="programlisting">
           DAEMON=yes
           To read:
           DAEMON=no
           And:
           QUEUE=1h
           </pre><p>
           </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
           The <code class="envar">QUEUE=1h</code> under <code class="filename">/etc/sysconfig/sendmail</code> file causes Sendmail to process the queue once every 1 hour. We leave that line in place because Sendmail still needs to process 
           the queue periodically in case the Mail Hub is down.
           </p></div><p>
           </p></li><li class="step"><p>           

           Remove the following files from your system, use the following command:
           </p><pre class="screen">
           [root@client /]# <span class="command"><strong>rm</strong></span>  -f  /usr/bin/newaliases
           [root@client /]# <span class="command"><strong>rm</strong></span>  -f  /usr/man/man1/newaliases.1
           [root@client /]# <span class="command"><strong>rm</strong></span>  -f  /usr/man/man5/aliases.5
           </pre><p>
           </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
           Local machines never use aliases, access, or other maps database. Since all map file databases are located and used on the Central Mail Hub Server for all local machines we may have on the network, we can safety remove the following commands and man pages from all our local machines.
           </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           /usr/bin/newaliases
           </p></li><li class="listitem"><p>
           /usr/man/man1/newaliases.1
           </p></li><li class="listitem"><p>
           /usr/man/man5/aliases.5
           </p></li></ul></div><p>
           </p></div><p>
           </p></li><li class="step"><p>
           Remove the unnecessary Procmail program from your entire local Sendmail server or client. Since local machines send all internal and outgoing mail to the mail Hub Server for future delivery, we don't need to use a complex local delivery agent program like Procmail to do the job. Instead we 
           can use the default <code class="filename">/bin/mail</code> program.

           To remove Procmail from your system, use the following command:
           </p><pre class="screen">
           [root@client ]# <span class="command"><strong>rpm</strong></span> -e procmail
           </pre><p>
           </p></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm12262"></a>6. The <code class="filename">/etc/mail/access</code> and <code class="filename">access.db</code> files </h2></div></div></div><p>
           The <code class="filename">access</code> database file can be created to accept or reject mail from selected domains. For example, you may choose to reject all mail originating from known spammers, or to accept to 
           relay all mail from your local network since now relaying is denied by default with Sendmail -<span class="emphasis"><em>this is an Anti-Spam feature</em></span>. In the <code class="filename">access</code> file example below, we'll 
           allow relaying from localhost and all local network addresses beginning with the <acronym class="acronym">IP</acronym> address <code class="literal">192.168.1</code>. 
           </p><p>
           The files <code class="filename">access</code> and <code class="filename">access.db</code> are not required for Local or Neighbor Client setups. It is required only if you decide to set up a Central Mail Hub to handle all your mail. Also note 
           that the use of a Central Mail Hub will improve the security and the management of other servers and clients on your network that run Sendmail.
            </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
               Create the access file <span class="command"><strong>touch</strong></span> <code class="filename">/etc/mail/access</code> and add the following lines:
           </p><pre class="programlisting">
           # Description showing bellow for the format of this file comes from
           # the Sendmail source distribution under "cf/README" file.
           #
           # The table itself uses e-mail addresses, domain names, and network
           # numbers as keys. For example,
           #
           #        spammer@aol.com         	REJECT
           #        cyberspammer.com        	REJECT
           #        192.168.212             		REJECT
           #
           # would refuse mail from spammer@aol.com, any user from cyberspammer.com
           # (or any host within the cyberspammer.com domain), and any host on the
           # 192.168.212.* network.
           #
           # The value part of the map can contain:
           #
           #        OK           Accept mail even if other rules in the
           #                        running ruleset would reject it, for example,
           #                        if the domain name is unresolvable.
           #        RELAY   Accept mail addressed to the indicated domain or
           #                        received from the indicated domain for relaying
           #                        through your SMTP server.  RELAY also serves as
           #                        an implicit OK for the other checks.
           #        REJECT  Reject the sender or recipient with a general
           #                        purpose message.
           #        DISCARD    Discard the message completely using the
           #                        $#discard mailer.  This only works for sender
           #                        addresses (i.e., it indicates that you should
           #                        discard anything received from the indicated
           #                        domain).
           #        ### any text    where ### is an RFC 821 compliant error code
           #                        and "any text" is a message to return for
           #                        the command.
           #
           # For example:
           #
           #        cyberspammer.com        550 We don't accept mail from spammers
           #        okay.cyberspammer.com   	OK
           #        sendmail.org            		OK
           #        128.32                  		RELAY
           #
           # would accept mail from okay.cyberspammer.com, but would reject mail
           # from all other hosts at cyberspammer.com with the indicated message.
           # It would allow accept mail from any hosts in the sendmail.org domain,
           # and allow relaying for the 128.32.*.* network.
           #
           # You can also use the access database to block sender addresses based on
           # the username portion of the address. For example:
           #
           #        FREE.STEALTH.MAILER@    550 Spam not accepted
           #
           # Note that you must include the @ after the username to signify that
           # this database entry is for checking only the username portion of the
           # sender address.
           #
           # If you use like we do in our "sendmail.mc macro configuration:
           #
           #        FEATURE(`blacklist_recipients')
           #
           # then you can add entries to the map for local users, hosts in your
           # domains, or addresses in your domain which should not receive mail:
           #
           #        badlocaluser            550 Mailbox disabled for this username
           #        host.mydomain.com       550 That host does not accept mail
           #        user@otherhost.mydomain.com     550 Mailbox disabled for this recipient
           #
           # This would prevent a recipient of badlocaluser@mydomain.com, any
           # user at host.mydomain.com, and the single address
           # user@otherhost.mydomain.com from receiving mail. Enabling this
           # feature will keep you from sending mails to all addresses that
           # have an error message or REJECT as value part in the access map.
           # Taking the example from above:
           #
           #        spammer@aol.com        	REJECT
           #        cyberspammer.com        	REJECT
           #
           # Mail can't be sent to spammer@aol.com or anyone at cyberspammer.com.
           #
           # Now our configuration of access file,
           # by default we allow relaying from localhost...
           localhost.localdomain   	RELAY
           localhost               		RELAY
           127.0.0.1               		RELAY
           192.168.1				RELAY
           </pre><p>
          
           </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
            Don't forget to specify in this file <code class="literal">access</code> your private <acronym class="acronym">IP</acronym> address range you want to relay or you'll be unable to send mail from your internal network.
           </p></div><p>
           </p></li><li class="step"><p>
           Create the access.db file, remember, since <code class="filename">/etc/mail/access</code> is a database, after creating the text file as described above, you must use the <span class="command"><strong>makemap</strong></span> utility 
           program to create the database map.

           To create the <code class="filename">access database map</code>, use the following command:
           </p><pre class="screen">
           [root@deep] /# <span class="command"><strong>makemap</strong></span> hash /etc/mail/access.db &lt; /etc/mail/access
            </pre><p>
           </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm12298"></a>7. The <code class="filename">/etc/mail/aliases</code> and <code class="filename">aliases.db</code> files</h2></div></div></div><p>
         Aliasing is the process of converting one local recipient name on the system into another -<span class="emphasis"><em>aliasing occurs only on local names</em></span>. Example uses are to convert a generic name -such as root, into a 
         real username on the system, or to convert one name into a list of many names -<span class="emphasis"><em>for mailing lists</em></span>. For every envelope that lists a local user as a recipient, Sendmail looks up that recipient's name 
         in the <code class="filename">aliases</code> file. Because Sendmail may have to search through thousands of names in the <code class="filename">aliases</code> file, a copy of the file is stored in a separate <code class="literal">db</code> database 
         format file to significantly improve lookup speed. If you configure your Sendmail to use a Central Server <code class="literal">Mail Hub</code> to handles all mail, you don't need to install the <code class="filename">aliases</code> and <code class="filename">aliases.db</code> 
         files on the neighbor server or client machines.
         </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
         Create the <code class="literal">aliases</code> file <span class="command"><strong>touch</strong></span> <code class="filename">/etc/mail/aliases</code> and add the following lines by default:
         </p><pre class="programlisting">
         #
         #       @(#)aliases     8.2 (Berkeley) 3/5/94
         #
         #  Aliases in this file will NOT be expanded in the header from
         #  Mail, but WILL be visible over networks or from /bin/mail.
         #
         #       &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      	The program "newaliases" must be run after
         #       &gt;&gt; NOTE &gt;&gt;      	this file is updated for any changes to
         #       &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      	show through to sendmail.
         #

         # Basic system aliases -- these MUST be present.
         MAILER-DAEMON:  	postmaster
         postmaster:     		root

         # General redirections for pseudo accounts.
         bin:            	root
         daemon:         	root
         nobody:         	root

         # Person who should get root's mail
         #root:          	admin
         </pre><p>
         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         Your aliases file will be probably far more complex, but even so, note how the example shows the minimum form of aliases.
         </p></div><p>
         </p></li><li class="step"><p>
         Since <code class="filename">/etc/mail/aliases</code> is a database, after creating the text file as described above, you must use the <span class="command"><strong>makemap</strong></span> program to create the database map.

         To create the <code class="filename">aliases database map</code>, use the following command:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>makemap</strong></span> hash /etc/mail/aliases.db &lt; /etc/mail/aliases
         </pre><p>
         </p></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm12333"></a>7.1. The <code class="filename">/etc/mail/</code> Directory</h3></div></div></div><p>
         The 
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         <code class="filename">/etc/mail/virtusertable, </code>
         </p></li><li class="listitem"><p>
         <code class="filename">domaintable</code>  
         </p></li><li class="listitem"><p>
         <code class="filename">mailertable</code>  
         </p></li></ul></div><p>
           and 
           </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           <code class="filename">virtusertable.db, </code> 
           </p></li><li class="listitem"><p>
         <code class="filename">domaintable.db, </code>
         </p></li><li class="listitem"><p>
         <code class="filename">mailertable.db</code>
         </p></li></ul></div><p>
         All of these files relate to particular features of Sendmail that can be tuned by the system administrator. Once again, these features are usually required only in the Central Mail Hub server. The following is the explanation of each one.
         </p><div class="glosslist"><dl><dt><span class="glossterm">The <code class="filename">virtusertable</code> &amp; <code class="filename">virtusertable.db</code> files</span></dt><dd class="glossdef"><p>
         A virtusertable is a database that maps virtual domains into news addresses. With this feature, mail for virtual domain on your network can be delivered to local, remote, or a single user address.
         </p></dd><dt><span class="glossterm">The <code class="filename">domaintable</code> &amp; <code class="filename">domaintable.db</code> files</span></dt><dd class="glossdef"><p>
         A domaintable is a database that maps old domain to a new one. With this feature, multiple domain names on your network can be rewritten from the old domain to the new.
         </p></dd><dt><span class="glossterm">The <code class="filename">mailertable</code> &amp; <code class="filename">mailertable.db</code> files</span></dt><dd class="glossdef"><p>
         A mailertable is a database that maps <code class="literal">host.domain</code> names to special delivery agent and new domain name pairs. With this feature mail on your network can be delivered through the use of a particular 
         delivery agent to a new local or remote domain name.
         </p></dd></dl></div><p>
         To create the <code class="filename">virtusertable, domaintable, mailertable</code>, and their corresponding <code class="filename">.db</code> files into <code class="filename">/etc/mail</code> directory, use the following commands:
         </p><pre class="screen">
         [root@deep] /# for map in virtusertable domaintable mailertable
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         &gt; do
         &gt; touch /etc/mail/${map}
         &gt; chmod 0644 /etc/mail/${map}
         &gt; makemap hash /etc/mail/${map}.db &lt; /etc/mail/${map}
         &gt; chmod 0644 /etc/mail/${map}.db
         &gt; done
         </code></pre><p>
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm12384"></a>8. The <code class="filename">/etc/mail/local-host-names</code> file </h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         Please note that the <code class="filename">/etc/mail/local-host-names</code> file is for all type of configuration.
         </p></div><p>
         The <code class="filename">/etc/mail/local-host-names</code> file is read to obtain alternative names for the local host. One use for such a file might be to declare a list of hosts in your network for which the 
         local host is acting as the <code class="literal">MX</code> recipient. On that machine we simply need to add the names of machines for which it i.e. <code class="literal">mail.openna.com</code>, will handle mail to <code class="filename">/etc/mail/local-host-names</code>. 
         Here is an example:
         </p><div class="example"><a name="idm12401"></a><p class="title"><b>Example 22.2. Alternative names</b></p><div class="example-contents"><p>
         Create the local-host-names file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/mail/local-host-names</code> and add the following line:
         </p><pre class="programlisting">
         # local-host-names - include all aliases for your machine here.
         openna.com
         deep.openna.com
         www.openna.com
         win.openna.com
         mail.openna.com
         </pre><p>
         With this type of configuration, all mail sent will appear as if it were sent from <code class="literal">openna.com</code>, and any mail sent to <code class="literal">www.openna.com</code> or the other hosts will be delivered to <code class="literal">mail.openna.com</code> our mail Hub.
         </p></div></div><br class="example-break"><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Caution.gif" alt="Caution"></span>
</h3><p>
         Please be aware that if you configure your system to masquerade as another, any e-mail sent from your system to your system will be sent to the machine you are masquerading as. For example, in the above illustration, log 
         files that are periodically sent to <code class="email">&lt;<a class="email" href="mailto:root@www.openna.com">root@www.openna.com</a>&gt;</code> by the cron daemon of Linux would be sent to <code class="email">&lt;<a class="email" href="mailto:root@mail.openna.com">root@mail.openna.com</a>&gt;</code> our Mail Hub.
         </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm12420"></a>8.1. Configure the <code class="filename">/etc/sysconfig/sendmail</code> file </h3></div></div></div><p>
         The <code class="filename">/etc/sysconfig/sendmail</code> file is used to specify <code class="literal">SENDMAIL</code> configuration information, such as if sendmail should run as a daemon, if it should listen for mail or not, and how much time 
         to wait before sending a warning if messages in the queue directory have not been delivered.
         </p><p>
         Create the sendmail file <span class="command"><strong>touch</strong></span> <code class="filename">/etc/sysconfig/sendmail</code> and add in this file:
         
         </p><pre class="programlisting">
         DAEMON=yes    <a name="dmys"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
         QUEUE=1h      <a name="qeys"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
         </pre><p>
         </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#dmys"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
         The <code class="envar">DAEMON=yes</code> option instructs Sendmail to run as a daemon. This line is useful when Sendmail client machines are configured to not accept mail directly from outside in favor of forwarding all local mail to a 
         Central Hub, <span class="emphasis"><em>not running a daemon also improves security</em></span>. If you have configured your server or client machines in this way, all you have to do is to replace the <code class="envar">DAEMON=yes</code> to <code class="envar">DAEMON=no</code>.
         </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#qeys"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
         Mail is usually placed into the queue because it could not be transmitted immediately. The <code class="envar">QUEUE=1h</code> sets the time interval before sends a warning to the sender if the messages has not been delivered.
         </p></td></tr></table></div><p>
         
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm12442"></a>9. The <code class="filename">/etc/rc.d/init.d/sendmail</code> script file</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         Please note that the <code class="filename">/etc/rc.d/init.d/sendmail</code> file is for all type of configuration.
         </p></div><p>
         To configure your <code class="filename">/etc/rc.d/init.d/sendmail</code> script file to start and stop the Sendmail daemon, You have to create the sendmail script file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/rc.d/init.d/sendmail</code> and add:
         </p><p>
         </p><pre class="programlisting">
         #!/bin/sh
         #
         # sendmail      This shell script takes care of starting and stopping
         #               sendmail.
         #
         # chkconfig: 2345 80 30
         # description: Sendmail is a Mail Transport Agent, which is the program \
         #              that moves mail from one machine to another.
         # processname: sendmail
         # config: /etc/sendmail.cf
         # pidfile: /var/run/sendmail.pid

         # Source function library.
         . /etc/rc.d/init.d/functions

         # Source networking configuration.
         . /etc/sysconfig/network

         # Source sendmail configuration.
         if [ -f /etc/sysconfig/sendmail ] ; then
         . /etc/sysconfig/sendmail
         else
         DAEMON=yes
         QUEUE=1h
         fi

         # Check that networking is up.
         [ ${NETWORKING} = "no" ] &amp;&amp; exit 0

         [ -f /usr/sbin/sendmail ] || exit 0

         RETVAL=0

         # See how we were called.
         case "$1" in
         start)
         # Start daemons.

         echo -n "Starting sendmail: "
         /usr/bin/newaliases &gt; /dev/null 2&gt;&amp;1
         for i in virtusertable access domaintable mailertable ; do
         if [ -f /etc/mail/$i ] ; then
         makemap hash /etc/mail/$i &lt; /etc/mail/$i
         fi
         done
         daemon /usr/sbin/sendmail $([ "$DAEMON" = yes ] &amp;&amp; echo -bd) \
         $([ -n "$QUEUE" ] &amp;&amp; echo -q$QUEUE)
         RETVAL=$?
         echo
         [ $RETVAL -eq 0 ] &amp;&amp; touch /var/lock/subsys/sendmail
         ;;
         stop)
         # Stop daemons.
         echo -n "Shutting down sendmail: "
         killproc sendmail
         RETVAL=$?
         echo
         [ $RETVAL -eq 0 ] &amp;&amp; rm -f /var/lock/subsys/sendmail
         ;;
         restart|reload)
         $0 stop
         $0 start
         RETVAL=$?
         ;;
         status)
         status sendmail
         RETVAL=$?
         ;;
         *)
         echo "Usage: sendmail {start|stop|restart|status}"
         exit 1
         esac

         exit $RETVAL
         </pre><p>
         </p><p>
         Now, make this script executable and change its default permissions:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>chmod</strong></span> 700  /etc/rc.d/init.d/sendmail
         </pre><p>
         Create the symbolic rc.d links for Sendmail with the command:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>chkconfig</strong></span> --add sendmail
         </pre><p>
         Start your Sendmail Server manually with the following command:
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/sendmail start
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Starting sendmail:                                         [  OK  ]
         </code></pre><p>
         </p><p>
         Please do a cleanup as always later:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
         [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf sendmail-version/ sendmail.version.tar.gz
         </pre><p>
         The <span class="command"><strong>rm</strong></span> command as used above will remove all the source files we have used to compile and install Sendmail. It will also remove the Sendmail compressed archive from 
         the <code class="filename">/var/tmp</code> directory.
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm12474"></a>10. Secure Sendmail using <span class="command"><strong>smrsh</strong></span></h2></div></div></div><p>
         The <span class="command"><strong>smrsh</strong></span> program is intended as a replacement for <code class="filename">/bin/sh</code> in the program mailer definition of Sendmail. It's a restricted shell utility that provides the ability 
         to specify, through the <code class="filename">/etc/smrsh</code> directory, an explicit list of executable programs available to Sendmail. To be more accurate, even if somebody with malicious intentions
         can get Sendmail to run a program without going through an aliases or forward file, smrsh limits the set of programs that he or she can execute. When used in conjunction with Sendmail, smrsh effectively limits Sendmail's 
         scope of program execution to only those programs specified in smrsh's directory. If you have followed what we did above, smrsh program is already compiled and installed on your computer under <code class="filename">/usr/sbin/smrsh</code>.
         </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
         The first thing we need to do is to determine the list of commands that <span class="command"><strong>smrsh</strong></span> should allow Sendmail to run.
         By default we include, but are not limited to:
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         <code class="filename">/bin/mail</code> -<span class="emphasis"><em>if you have it installed on your system</em></span>
         </p></li><li class="listitem"><p>
         <code class="filename">/usr/bin/procmail</code> -<span class="emphasis"><em>if you have it installed on your system</em></span>
         </p></li></ul></div><p>
         </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Warning.gif" alt="Warning"></span>
</h3><p>
         <span class="emphasis"><em>You should not include interpreter programs</em></span> such as <span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span>, <span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span>,
         <span class="citerefentry"><span class="refentrytitle">perl</span>(1)</span>, <span class="citerefentry"><span class="refentrytitle">uudecode</span>(1)</span> or <span class="citerefentry"><span class="refentrytitle">sed</span>(1)</span> -the stream editor, in your list of acceptable commands.
         </p></div><p>
         </p></li><li class="step"><p>
         You will next need to populate the <code class="filename">/etc/smrsh</code> directory with the programs that are allowable for Sendmail to execute. To prevent duplicate programs, and do a nice job, it is better 
         to establish links to the allowable programs from <code class="filename">/etc/smrsh</code> rather than copy programs to this directory.
                  
         To allow the mail program <code class="filename">/bin/mail</code>, use the following commands:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>cd</strong></span> /etc/smrsh
         [root@deep ]/smrsh# <span class="command"><strong>ln</strong></span> -s /bin/mail mail
         </pre><p>
         To allow the procmail program <code class="filename">/usr/bin/procmail</code>, use the following commands:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>cd</strong></span> /etc/smrsh
         [root@deep ]/smrsh# <span class="command"><strong>ln</strong></span> -s /usr/bin/procmail procmail
         </pre><p>
         This will allow the mail and procmail programs to be run from a user's <code class="filename">.forward</code> file or an <code class="filename">aliases</code> file which uses the program syntax.
         </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
  <span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>

</h3><p>
         Procmail is required only in Mail Hub Server and not in Local Client Mail Server. If you've configured your system like a Mail Hub Server then make the link with procmail as explained above, if you've configured 
         your system as a Local Client Server then skip the procmail step above.
         </p></div><p>
         </p></li><li class="step"><p>
         We can now configure Sendmail to use the restricted shell. The program mailer is defined by a single line in the Sendmail configuration file, <code class="filename">/etc/mail/sendmail.cf</code>. You must modify this single 
         line Mprog definition in the <code class="filename">sendmail.cf</code> file, by replacing the /bin/sh specification with <code class="filename">/usr/sbin/smrsh</code>.
                                         
         Edit the <code class="filename">sendmail.cf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/mail/sendmail.cf</code> and change the line:

         </p><div class="example"><a name="idm12549"></a><p class="title"><b>Example 22.3. <code class="filename">sendmail.cf</code></b></p><div class="example-contents"><p>
           </p><pre class="programlisting">
         Mprog,  P=/bin/sh, F=lsDFMoqeu9, S=10/30, R=20/40, D=$z:/, T=X-Unix, A=sh -c $u
         </pre><p>
         Which should be changed to:
         </p><pre class="programlisting">
         Mprog,  P=/usr/sbin/smrsh, F=lsDFMoqeu9, S=10/30, R=20/40, D=$z:/, T=X-Unix, A=sh -c $u
         </pre><p>
         </p></div></div><p><br class="example-break">
         </p></li><li class="step"><p>
         Now re-start the sendmail process manually with the following command:
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/sendmail <span class="command"><strong>restart</strong></span>
         </pre><p>

         </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         In our <code class="filename">sendmail.mc</code> configuration file for the Mail Hub Server above, we have already configured this line Mprog to use the restricted shell <code class="filename">/usr/sbin/smrsh</code> 
         with the m4 macro <code class="envar">FEATURE(`smrsh',`/usr/sbin/smrsh')</code>, so don't be surprised if the <code class="filename">/usr/sbin/smrsh</code>specification is already set in your <code class="filename">/etc/mail/sendmail.cf</code> 
         file for the Mail Hub relay. 
         </p><p>
         Instead, use the technique shown above for other <code class="filename">/etc/mail/sendmail.cf</code> files in your network like the <span class="emphasis"><em>one for the nullclient local or neighbor client and servers</em></span> that use the <code class="filename">null.mc</code> macro configuration file to generate the <code class="filename">/etc/mail/sendmail.cf</code> file.
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm12577"></a>11. The <code class="filename">/etc/mail/aliases</code> file</h2></div></div></div><p>
         A poorly or carelessly administered <code class="filename">aliases</code> file can easily be used to gain privileged status. For example, many vendors ship systems with a <code class="literal">decode</code> alias in the <code class="filename">/etc/mail/aliases</code>
         file. The intention is to provide an easy way for users to transfer binary files using mail. At the sending site the user converts the binary to <acronym class="acronym">ASCII</acronym> with <code class="literal">uuencode</code>, then mails the result to the <code class="literal">decode</code> 
         alias at the receiving site. That alias pipes the mail message through the <code class="filename">/usr/bin/uuencode</code> program, which converts the <acronym class="acronym">ASCII</acronym> back into the original binary file.
         </p><p>
         Remove the <code class="envar">decode</code> alias line from your <code class="filename">/etc/mail/aliases</code> file. Similarly, every alias that executes a program that you did not place there yourself and check completely should be 
         questioned and probably removed.

         Edit the <code class="filename">aliases</code> file <span class="command"><strong>vi</strong></span> <code class="filename">/etc/mail/aliases</code> and remove the following lines:
         
           </p><pre class="programlisting">
         # Basic system aliases -- these MUST be present.
         MAILER-DAEMON:  postmaster
         postmaster:	root

         # General redirections for pseudo accounts.
         bin:			root
         daemon:		root
         games:		        root  <a name="gmsrt"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
         ingres:		root  <a name="inrt"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
         nobody:		root
         system:		root  <a name="sysrt"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
         toor:			root  <a name="trtgr"></a><span><img src="images/callouts/4.png" alt="4" border="0"></span>
         uucp:		        root  <a name="uugr"></a><span><img src="images/callouts/5.png" alt="5" border="0"></span>

         # Well-known aliases.
         manager:		root  <a name="mngr"></a><span><img src="images/callouts/6.png" alt="6" border="0"></span>
         dumper:		root  <a name="dmgr"></a><span><img src="images/callouts/7.png" alt="7" border="0"></span>
         operator:		root  <a name="opgr"></a><span><img src="images/callouts/8.png" alt="8" border="0"></span>

         # trap decode to catch security attacks
         decode:		root  <a name="dcgr"></a><span><img src="images/callouts/9.png" alt="9" border="0"></span>

         # Person who should get root's mail
         #root:		marc
         </pre><p>
         </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#gmsrt"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> <a href="#inrt"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> <a href="#sysrt"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> <a href="#trtgr"><span><img src="images/callouts/4.png" alt="4" border="0"></span></a> <a href="#uugr"><span><img src="images/callouts/5.png" alt="5" border="0"></span></a> <a href="#mngr"><span><img src="images/callouts/6.png" alt="6" border="0"></span></a> <a href="#dmgr"><span><img src="images/callouts/7.png" alt="7" border="0"></span></a> <a href="#opgr"><span><img src="images/callouts/8.png" alt="8" border="0"></span></a> <a href="#dcgr"><span><img src="images/callouts/9.png" alt="9" border="0"></span></a> </p></td><td valign="top" align="left"><p>Remove all these lines</p></td></tr></table></div><p>
         
         </p><p>
         For the changes to take effect you will need to run:
         </p><pre class="screen">
         [root@deep] /# /usr/bin/newaliases
         </pre><p>
         </p><p>
         You need to prevent your Sendmail being abused by unauthorized users, Sendmail now includes powerful Anti-Spam features, which can help prevent your mail server from being abused by unauthorized users. To do 
         this, make a change to the configuration file to block off spammers. Edit the <code class="filename">sendmail.cf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/mail/sendmail.cf</code> and change the line:
         </p><pre class="programlisting">
         O PrivacyOptions=authwarnings
         </pre><p>
         To read:
         </p><pre class="programlisting">
         O PrivacyOptions=authwarnings,goaway
         </pre><p>
         Setting the <code class="envar">goaway</code> option causes Sendmail to disallow all <acronym class="acronym">SMTP</acronym> <span class="command"><strong>EXPN</strong></span> commands, it also causes it to reject all <acronym class="acronym">SMTP</acronym> <span class="command"><strong>VERB</strong></span> commands and to 
         disallow all <acronym class="acronym">SMTP</acronym> <span class="command"><strong>VRFY</strong></span> commands. These changes prevent spammers from using the <span class="command"><strong>EXPN</strong></span> and <span class="command"><strong>VRFY</strong></span> commands in Sendmail.
         </p><p>
         You have to restrict who can examine the queues contents, ordinarily, anyone may examine the mail queue's contents by using the <span class="command"><strong>mailq</strong></span> command. To restrict who may examine the queues contents, you 
         must specify the <code class="envar">restrictmailq</code> option in the <code class="filename">/etc/mail/sendmail.cf</code> file. With this option, Sendmail allows only users who are in the same group as the group ownership of the queue 
         directory <code class="literal">root</code> to examine the contents. This allows the queue directory to be fully protected with mode <code class="literal">0700</code>, while selected users are still able to see the contents.
         </p><p>
         Edit the <code class="filename">sendmail.cf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/mail/sendmail.cf</code> and change the line:
         </p><pre class="programlisting">
         O PrivacyOptions=authwarnings,goaway
         </pre><p>
         To read:
         </p><pre class="programlisting">
         O PrivacyOptions=authwarnings,goaway,restrictmailq
         </pre><p>
         Now we change the mode of our queue directory to be fully protected:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>chmod</strong></span> 0700 /var/spool/mqueue
         </pre><p>
         </p><p>
         Now re-start the sendmail process manually for the change to take effect:
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/sendmail <span class="command"><strong>restart</strong></span>
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Shutting down sendmail:                                    	[  OK  ]
         Starting sendmail:                                    		[  OK  ]
         </code></pre><p>
         </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
         We have already added the <code class="envar">goaway</code> option to the line <code class="envar">PrivacyOptions=</code> in <code class="filename">sendmail.cf</code> file. Now we can just add the <code class="envar">restrictmailq</code> option to this line.
         </p></div><p>
         Any non-privileged user who attempts to examine the mail queue content will get this message:
         </p><pre class="screen">
         [user@deep /]$ /usr/bin/mailq
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         You are not permitted to see the queue
         </code></pre><p>
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm12660"></a>12. Limit queue processing to <code class="literal">root</code></h2></div></div></div><p>
         Ordinarily, anyone may process the queue with the  -q switch. To limit queue processing to <code class="literal">root</code> and the owner of the queue directory, you must specify 
         the <code class="envar">restrictqrun</code> option in the <code class="filename">/etc/mail/sendmail.cf</code> file.
         </p><p>
         Edit the <code class="filename">sendmail.cf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/mail/sendmail.cf</code> and change the line:
         </p><pre class="programlisting">
         O PrivacyOptions=authwarnings,goaway,restrictmailq
         </pre><p>
         To read:
         </p><pre class="programlisting">
         O PrivacyOptions=authwarnings,goaway,restrictmailq,restrictqrun
         </pre><p>
         </p><p>
         Now re-start the sendmail process manually for the change to take effect:
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/sendmail <span class="command"><strong>restart</strong></span>
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Shutting down sendmail:                                    	[  OK  ]
         Starting sendmail:                                    		[  OK  ]
         </code></pre><p>
         Any non-privileged user who attempts to process the queue will get this message:
         </p><pre class="screen">
         [user@deep /]$ /usr/sbin/sendmail -q
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         You do not have permission to process the queue
         </code></pre><p>
         </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm12681"></a>12.1. The <acronym class="acronym">SMTP</acronym> greeting message</h3></div></div></div><p>
         When Sendmail accepts an incoming <acronym class="acronym">SMTP</acronym> connection it sends a greeting message to the other host. This message identifies the local machine and is the first thing it sends to say it is ready.
         </p><p>
         Edit the <code class="filename">sendmail.cf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/mail/sendmail.cf</code> and change the line:
         </p><pre class="programlisting">
         O SmtpGreetingMessage=$j Sendmail $v/$Z; $b
         </pre><p>
         To read:
         </p><pre class="programlisting">
         O SmtpGreetingMessage=$j
         </pre><p>
         Now re-start the sendmail process manually for the change to take effect:
         </p><pre class="screen">
         [root@deep] /# /etc/rc.d/init.d/sendmail <span class="command"><strong>restart</strong></span>
         </pre><p>
         </p><pre class="literallayout">
         Shutting down sendmail:                                    	[  OK  ]
         Starting sendmail:                                    		[  OK  ]
         <code class="computeroutput"></code></pre><p>
         </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
         This change doesn't actually affect anything, but was recommended by folks in the <code class="literal">news.admin.net-abuse.email</code> newsgroup as a legal precaution. It modifies the banner, which Sendmail displays upon receiving a connection.
         </p></div><p>
         Do set the immutable bit on important Sendmail files, important Sendmail files can be set immutable for better security with the <span class="command"><strong>chattr</strong></span> command of Linux. A file with the <code class="literal">+i</code> attribute 
         cannot be modified, deleted or renamed. No link can be created to this file, and no data can be written to the file. Only the super-user can set or clear this attribute.
         </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
         Set the immutable bit on the <code class="filename">sendmail.cf</code> file:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>chattr</strong></span>  +i /etc/mail/sendmail.cf
         </pre><p>
          </p></li><li class="step"><p>
         Set the immutable bit on the <code class="filename">local-host-names</code> file:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>chattr</strong></span>  +i /etc/mail/local-host-names
         </pre><p>
         </p></li><li class="step"><p>
         Set the immutable bit on the <code class="filename">aliases</code> file:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>chattr</strong></span>  +i /etc/mail/aliases
         </pre><p>
         </p></li><li class="step"><p>
         Set the immutable bit on the <code class="filename">access</code> file:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>chattr</strong></span>  +i /etc/mail/access
         </pre><p>
         </p></li></ol></div><p>
         Further documentation and for more details, there are several man pages you can read:
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">aliases</span>(5)</span></span></dt><dd><p>
         - aliases file for sendmail
         </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">makemap</span>(8)</span></span></dt><dd><p>
         - create database maps for sendmail
         </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">sendmail</span>(8)</span></span></dt><dd><p>
         - an electronic mail transport agent
         </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">mailq</span>(1)</span></span></dt><dd><p>
         - print the mail queue
         </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">newaliases</span>(1)</span></span></dt><dd><p>
         - rebuild the data base for the mail aliases file
         </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">mailstats</span>(8)</span></span></dt><dd><p>
         - display mail statistics
         </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">praliases</span>(8)</span></span></dt><dd><p>
         - display system mail aliases
         </p></dd></dl></div><p>
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm12780"></a>13. Sendmail Administrative Tools</h2></div></div></div><p>
         The commands listed below are some that we use often, but many more exist. Check the man page and documentation for more details and information.
         </p><p><b>newaliases. </b>
         The purpose of the <code class="filename">newaliases</code> program utility of Sendmail is to rebuild and update the random access database for the mail aliases file <code class="filename">/etc/mail/aliases</code>. It must be 
         run each time you change the contents of this file in order for the changes to take effect.
         
         To update the aliases file with the <code class="filename">newaliases</code> utility, use the following command:
         </p><pre class="screen">
         [root@deep] /# /usr/bin/newaliases
         </pre><p>
         </p><p><b>makemap. </b>
         The purpose of the <span class="command"><strong>makemap</strong></span> program utility is to create the database maps in Sendmail. The <span class="command"><strong>makemap</strong></span> command must be used only when you need to create a new database for file like 
         <code class="filename">aliases, access</code>, or <code class="filename">domaintable, mailertable</code>, and <code class="filename">virtusertable</code>.
         
         To run makemap to create a new database for access, use the following command:
         </p><pre class="screen">
         [root@deep] /# makemap hash /etc/mail/access.db &lt; /etc/mail/access
         </pre><p>
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Where &lt;hash&gt; is the database format, makemap can handles up to three different database formats;  they may be <code class="literal">hash</code>, <code class="literal">btree</code> or <code class="literal">dbm</code>. 
         </p></li><li class="listitem"><p>
         The <code class="filename">/etc/mail/access.db</code> is the location and the name of the new database that will be created. 
         </p></li><li class="listitem"><p>
         The <code class="filename">/etc/mail/access</code> is the location of the file from where makemap will read from the standard input file. 
         </p></li></ul></div><p>
         In our example, we have created a new <code class="filename">access.db</code> file with the makemap command above. To create a database for other files like <code class="filename">aliases, domaintable, mailertable</code>, and <code class="filename">virtusertable</code>, 
         you must indicate the location and name of the corresponding file in the <span class="command"><strong>makemap</strong></span> command.
         </p><p><b>mailq. </b>
         The purpose of the <span class="command"><strong>mailq</strong></span> program utility is to print a summary of the mail messages queued for future delivery.
         
         To print a summary of the mail messages queued, use the following command:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>mailq</strong></span>
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Mail queue is empty
         </code></pre><p>
         </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm12823"></a>13.1. Sendmail Users Tools</h3></div></div></div><p>
         The commands listed below are some that we use often, but many more exist. Check the man page and documentation for more details and information.
         </p><p><b>mailstats. </b>
         The purpose of the <span class="command"><strong>mailstats</strong></span> program utility is to displays contents of the current mail statistics.
         
         To displays the current mail statistics, use the following command:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>mailstats</strong></span>
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Statistics from Tue Dec 14 20:31:48 1999
         M   msgsfr  bytes_from   msgsto    bytes_to  msgsrej msgsdis  Mailer
         5        0          0K        1          3K        0       0  esmtp
         8     1259      19618K     1259      19278K        0       0  local
         =============================================================
         T     1259      19618K     1260      19281K        0       0
         </code></pre><p>
         </p><p><b>praliases. </b>
         The purpose of the <span class="command"><strong>praliases</strong></span> program utility is to display one per line, in no particular order the contents of the current system mail aliases.
         
         To displays the current system aliases, use the following command:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>praliases</strong></span>
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         postmaster:root
         daemon:root
         root:admin
         @:@
         mailer-daemon:postmaster
         bin:root
         nobody:root
         webadmin:admin
         www:root
         </code></pre><p>
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm12842"></a>14. Installed  files: Sendmail -Central Mail Hub</h2></div></div></div><p>
           Files Installed for Sendmail Central Mail Hub configuration are:
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/rc.d/init.d/sendmail</code></td><td><code class="filename">/etc/mail/local-host-names</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc0.d/K30sendmail</code></td><td><code class="filename">/etc/smrsh</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc1.d/K30sendmail</code></td><td><code class="filename">/usr/bin/newaliases</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc2.d/S80sendmail</code></td><td><code class="filename">/usr/bin/mailq</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc3.d/S80sendmail</code></td><td><code class="filename">/usr/bin/hoststat</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc4.d/S80sendmail</code></td><td><code class="filename">/usr/bin/purgestat</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc5.d/S80sendmail</code></td><td><code class="filename">/usr/lib/sendmail</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc6.d/K30sendmail</code></td><td><code class="filename">/usr/man/man1/mailq.1</code></td></tr><tr><td><code class="filename">/etc/sysconfig/sendmail</code></td><td><code class="filename">/usr/man/man1/newaliases.1</code></td></tr><tr><td><code class="filename">/etc/mail</code></td><td><code class="filename">/usr/man/man5/aliases.5</code></td></tr><tr><td><code class="filename">/etc/mail/statistics</code></td><td><code class="filename">/usr/man/man8/sendmail.8</code></td></tr><tr><td><code class="filename">/etc/mail/sendmail.cf</code></td><td><code class="filename">/usr/man/man8/mailstats.8</code></td></tr><tr><td><code class="filename">/etc/mail/access</code></td><td><code class="filename">/usr/man/man8/makemap.8</code></td></tr><tr><td><code class="filename">/etc/mail/access.db</code></td><td><code class="filename">/usr/man/man8/praliases.8</code></td></tr><tr><td><code class="filename">/etc/mail/aliases</code></td><td><code class="filename">/usr/man/man8/smrsh.8</code></td></tr><tr><td><code class="filename">/etc/mail/aliases.db</code></td><td><code class="filename">/usr/sbin/sendmail</code></td></tr><tr><td><code class="filename">/etc/mail/virtusertable</code></td><td><code class="filename">/usr/sbin/mailstats</code></td></tr><tr><td><code class="filename">/etc/mail/virtusertable.db</code></td><td><code class="filename">/usr/sbin/makemap</code></td></tr><tr><td><code class="filename">/etc/mail/domaintable</code></td><td><code class="filename">/usr/sbin/praliases</code></td></tr><tr><td><code class="filename">/etc/mail/domaintable.db</code></td><td><code class="filename">/usr/sbin/smrsh</code></td></tr><tr><td><code class="filename">/etc/mail/mailertable</code></td><td><code class="filename">/var/spool/mqueue</code></td></tr><tr><td><code class="filename">/etc/mail/mailertable.db</code></td><td> </td></tr></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm12932"></a>15. Installed files: Sendmail -Local server/client</h2></div></div></div><p>
         Files installed for Sendmail local server or client configuration:
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/rc.d/init.d/sendmail</code></td><td><code class="filename">/etc/smrsh</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc0.d/K30sendmail</code></td><td><code class="filename">/usr/bin/mailq</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc1.d/K30sendmail</code></td><td><code class="filename">/usr/bin/hoststat</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc2.d/S80sendmail</code></td><td><code class="filename">/usr/bin/purgestat</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc3.d/S80sendmail</code></td><td><code class="filename">/usr/lib/sendmail</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc4.d/S80sendmail</code></td><td><code class="filename">/usr/man/man1/mailq.1</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc5.d/S80sendmail</code></td><td><code class="filename">/usr/man/man8/sendmail.8</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc6.d/K30sendmail</code></td><td><code class="filename">/usr/man/man8/mailstats.8</code></td></tr><tr><td><code class="filename">/etc/sysconfig/sendmail</code></td><td><code class="filename">/usr/man/man8/smrsh.8</code></td></tr><tr><td><code class="filename">/etc/mail</code></td><td><code class="filename">/usr/sbin/sendmail</code></td></tr><tr><td><code class="filename">/etc/mail/statistics</code></td><td><code class="filename">/usr/sbin/mailstats</code></td></tr><tr><td><code class="filename">/etc/mail/sendmail.cf</code></td><td><code class="filename">/usr/sbin/smrsh</code></td></tr><tr><td><code class="filename">/etc/mail/local-host-names</code></td><td><code class="filename"> /var/spool/mqueue</code></td></tr></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="idm12988"></a>Chapter 23. Linux <acronym class="acronym">IMAP</acronym> &amp; <acronym class="acronym">POP</acronym> Server</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#pr6ch23sc1ip">1. Configure and Compile</a></span></dt><dt><span class="section"><a href="#idm13186">2. Configure to tweak</a></span></dt><dd><dl><dt><span class="section"><a href="#idm13224">2.1. The <code class="filename">/etc/pam.d/imap</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm13258">3. Enable <acronym class="acronym">IMAP</acronym> or <acronym class="acronym">POP</acronym> via the tcp-wrappers inetd super server</a></span></dt><dd><dl><dt><span class="section"><a href="#idm13306">3.1. Securing <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym></a></span></dt></dl></dd><dt><span class="section"><a href="#idm13367">4. Installed files</a></span></dt></dl></div><div class="highlights"><p>
         If you have configured Sendmail as a Central Mail Hub Server, you must install <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> software or you'll not be able to take advantage of your Linux Mail server since Sendmail 
         is just software that sends mail from one machine to another, and nothing else. A mail server is a server that is running one or more of the following: 
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         An <acronym class="acronym">IMAP</acronym> server 
         </td></tr><tr><td>
         A <acronym class="acronym">POP3</acronym> server 
         </td></tr><tr><td>
         A <acronym class="acronym">POP2</acronym> server
         </td></tr><tr><td>
         or an <acronym class="acronym">SMTP</acronym> server. 
         </td></tr></table><p>
         An example of <acronym class="acronym">SMTP</acronym> server is Sendmail that must be already installed on your Linux server as a Central Mail Hub before you continue reading this part of the book. For now, we are going to cover installing 
         <acronym class="acronym">IMAP4</acronym>, <acronym class="acronym">POP3</acronym>, and <acronym class="acronym">POP2</acronym>, which all come in a single package.
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch23sc1ip"></a>1. Configure and Compile</h2></div></div></div><p>
           With <acronym class="acronym">IMAP</acronym> &amp; <acronym class="acronym">POP</acronym> software, a remote <code class="literal">client</code> email program can access message stores on the Linux mail server as if they were local. For example, email received and 
         stored on an <acronym class="acronym">IMAP</acronym> server for a user can be manipulated from his/her computer at home, office, etc, without the need to transfer messages or files back and forth between these computers.
         </p><p>
         <acronym class="acronym">POP</acronym> stands for <code class="literal">Post Office Protocol</code> and simply allows you to list messages, retrieve them, and delete them. <acronym class="acronym">IMAP</acronym> is <acronym class="acronym">POP</acronym> on steroids. It allows you to 
         easily maintain multiple accounts, have multiple people access one account, leave mail on the server, just download the headers, or bodies, no attachments, and so on. <acronym class="acronym">IMAP</acronym> is ideal for anyone on the go, or 
         with serious email needs. The default <acronym class="acronym">POP</acronym> and <acronym class="acronym">IMAP</acronym> servers that most distributions ship fulfill most needs.
         </p><div class="mediaobject"><img src="./images/IMAP-Client-Schema.gif" alt="IMAP client"></div><p>
         </p><p>
         These installation instructions assume:
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Commands are Unix-compatible.
         </p></li><li class="listitem"><p>
         The source path is <code class="filename">/var/tmp</code> -<span class="emphasis"><em>other paths are possible</em></span>.
         </p></li><li class="listitem"><p>
         Installations were tested on Red Hat Linux 6.1 and 6.2.
         </p></li><li class="listitem"><p>
         All steps in the installation will happen in super-user account root.
         </p></li><li class="listitem"><p>
         <acronym class="acronym">IMAP</acronym> version number is 4.7c
         </p></li></ul></div><p>
         </p><p>
         These are the Package(s) needed and should be available here:
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> Homepage: <a class="link" href="#prtinxfp20" title="Linux IMAP &amp; POP Server">http://www.washington.edu/imap/</a>
         </td></tr><tr><td>
         <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> FTP Site: <a class="link" href="#prtinxfp20" title="Linux IMAP &amp; POP Server">140.142.3.227</a> or <a class="link" href="#prtinxfp20" title="Linux IMAP &amp; POP Server">140.142.4.227</a>
         </td></tr><tr><td>
         You must be sure to download: imap.tar.Z
         </td></tr></table><p>
         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         These are a few Prerequisites you have to keep in mind, sendmail server should be already installed on your system to be able to use <acronym class="acronym">IMAP</acronym> &amp; <acronym class="acronym">POP</acronym> software.
         For more information on the required software, see the related chapters in this book.
         </p></div><p>
         You need to decompress the tarballs to compile, so it is a good idea to make a list of files on the system before you install Imap, and one afterwards, and then compare them using diff to find out what 
         file it placed where. Simply run <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Imap1</code></strong> before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Imap2</code></strong> after you install the software, and 
         use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>Imap1 Imap2 &gt; Imap-Installed</code></strong> to get a list of what changed.
         </p><p>
         Before Compilation you need to decompress the tarball (tar.Z).:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>cp</strong></span> imap.tar.Z /var/tmp
         [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
         [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf imap.tar.Z
         </pre><p>
         </p><p>
         Optimize before you Compile, move into the new <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> directory and edit the <code class="filename">Makefile</code> file <span class="command"><strong>vi</strong></span> <code class="filename">src/osdep/unix/Makefile</code> 
         and change these lines:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>         
         </p><pre class="programlisting">
         sh -c '(test -f /usr/include/sys/statvfs.h -a $(OS) != sc5 -a $(OS) != sco) &amp;&amp; $(LN) flocksun.c flockbsd.c || $(LN) flocksv4.c flockbsd.c'
         </pre><p>
         To read:
         </p><pre class="programlisting">
         sh -c '(test -f /usr/include/sys/statvfs.h -a $(OS) != sc5 -a $(OS) != sco -a $(OS) != lnx) &amp;&amp; $(LN) flocksun.c flockbsd.c || $(LN) flocksv4.c flockbsd.c'
         </pre><p>
         This modification will change the <code class="filename">sys/stavfs</code> file. This file, with the new glibc 2.1 of Linux, is different from what is available on Sun.
         </p></li><li class="step"><p>        
         </p><pre class="programlisting">
         BASECFLAGS="-g -fno-omit-frame-pointer -O6 -DNFSKLUDGE" \
         </pre><p>
         To read:
         </p><pre class="programlisting">
         BASECFLAGS="-g -fno-omit-frame-pointer -O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions -DNFSKLUDGE" \
         </pre><p>
         These are our optimization flags for the compilation of <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> software on the server.
         </p></li><li class="step"><p>         
         </p><pre class="programlisting">
         ACTIVEFILE=/usr/lib/news/active
         </pre><p>
         To read:
         </p><pre class="programlisting">
         ACTIVEFILE=/var/lib/news/active
         </pre><p>
         </p><pre class="programlisting">
         SPOOLDIR=/usr/spool
         </pre><p>
         To read:
         </p><pre class="programlisting">
         SPOOLDIR=/var/spool
         </pre><p>
         </p><pre class="programlisting">
         RSHPATH=/usr/ucb/rsh
         </pre><p>
         To read:
         </p><pre class="programlisting">
         RSHPATH=/usr/bin/rsh
         </pre><p>
         </p><pre class="programlisting">
         LOCKPGM=/etc/mlock
         </pre><p>
         To read:
         </p><pre class="programlisting">
         #LOCKPGM=/etc/mlock
         </pre><p>
         The <code class="envar">ACTIVEFILE=</code> line specifies the path of the <code class="filename">active</code> directory for <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym>, the <code class="envar">SPOOLDIR=</code> is where we put 
         the <code class="filename">spool</code> directory of Linux <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym>, and the <code class="envar">RSHPATH=</code> specify the path of <code class="filename">rsh</code> directory 
         on our system. It's important to note that we don't use rsh services on our server, but even so, we specify the right directory to <code class="filename">rsh</code>.
         </p></li><li class="step"><p>
           </p><pre class="programlisting">
         CC=cc
         </pre><p>
         To read:
         </p><pre class="programlisting">
         CC=egcs
         </pre><p>
         This line represents the name of our <acronym class="acronym">GCC</acronym> compiler we will use to compile <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> software, in our case, egcs).
         </p></li></ol></div><p>
         Now, we must compile and <span class="command"><strong>install</strong></span> <acronym class="acronym">IMAP</acronym> &amp; <acronym class="acronym">POP</acronym> on the Mail Server:
         </p><pre class="screen">
         [root@deep ]/imap-4.7c# <span class="command"><strong>make</strong></span> lnp
         [root@deep ]/imap-4.7c# <span class="command"><strong>install</strong></span> -m 644 ./src/ipopd/ipopd.8c /usr/man/man8/ipopd.8c
         [root@deep ]/imap-4.7c# <span class="command"><strong>install</strong></span> -m 644 ./src/imapd/imapd.8c /usr/man/man8/imapd.8c
         [root@deep ]/imap-4.7c# <span class="command"><strong>install</strong></span> -s -m 755 ./ipopd/ipop2d /usr/sbin
         [root@deep ]/imap-4.7c# <span class="command"><strong>install</strong></span> -s -m 755 ./ipopd/ipop3d /usr/sbin
         [root@deep ]/imap-4.7c# <span class="command"><strong>install</strong></span> -s -m 755 ./imapd/imapd /usr/sbin
         [root@deep ]/imap-4.7c# <span class="command"><strong>install</strong></span> -m 644 ./c-client/c-client.a /usr/lib
         [root@deep ]/imap-4.7c# <span class="command"><strong>ln</strong></span> -fs /usr/lib/c-client.a /usr/lib/libimap.a
         [root@deep ]/imap-4.7c# <span class="command"><strong>mkdir</strong></span> -p /usr/include/imap
         [root@deep ]/imap-4.7c# <span class="command"><strong>install</strong></span> -m 644 ./c-client/*.h /usr/include/imap
         [root@deep ]/imap-4.7c# <span class="command"><strong>install</strong></span> -m 644 ./src/osdep/tops-20/shortsym.h /usr/include/imap
         [root@deep ]/imap-4.7c# <span class="command"><strong>chown</strong></span> root.mail /usr/sbin/ipop2d
         [root@deep ]/imap-4.7c# <span class="command"><strong>chown</strong></span> root.mail /usr/sbin/ipop3d
         [root@deep ]/imap-4.7c# <span class="command"><strong>chown</strong></span> root.mail /usr/sbin/imapd
         </pre><p>
          </p><p>
         The above commands will configure the software to ensure your system has the necessary functionality and libraries to successfully compile the package, compile all source files into executable binaries, and 
         then <span class="command"><strong>install</strong></span> the binaries and any supporting files into the appropriate locations.

           </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Note that the <span class="command"><strong>make lnp</strong></span> command above will configure your Linux system with Pluggable Authentication Modules -<acronym class="acronym">PAM</acronym> capability for better security.
         </p></li><li class="listitem"><p>
         The <span class="command"><strong>mkdir</strong></span> command will create a new directory named <code class="filename">imap</code> under <code class="filename">/usr/include</code>. This new directory <code class="filename">imap</code> 
         will keep all header files related to the imapd program <code class="filename">c-client/*</code>, and <code class="filename">shortsym.h</code> files.
         </p></li><li class="listitem"><p>
         The <span class="command"><strong>chown</strong></span> command will change the ownership of the binary programs ipop2d, ipop3d, and imapd to be owned by the super-user <code class="literal">root</code>, be group owner by the user <code class="literal">mail</code>.
         </p></li><li class="listitem"><p>
         The <span class="command"><strong>ln</strong></span> -fs command would create a symbolic link from <code class="filename">c-client.a</code> file to <code class="filename">libimap.a</code> link which may be require by some third party program you may install in the future.
         </p></li></ul></div><p>
         </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
  <span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>

</h3><p>
         For security reasons, if you use only imapd services, remove the ipop2d and ipop3d binaries from your mail server. The same applies for ipopd; if you use only ipopd services, remove the imapd binary from your mail server. If you intend to 
         use imapd and ipopd services then keep both binaries.
         </p></div><p>
         Please do cleanup later:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
         [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf imap-version/ imap.tar.Z
         </pre><p>
         The <span class="command"><strong>rm</strong></span> command as used above will remove all the source files we have used to compile and install <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym>. It will also remove the <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> 
         compressed archive from the <code class="filename">/var/tmp</code> directory.
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm13186"></a>2. Configure to tweak</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
             You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
             for respective software. For example <em class="wordasword">IMAP/POP</em> configuration file are organised like this:
             </p><pre class="literallayout"><code class="computeroutput">
total 8
-rwx------    1 harrypotter    harrypotter         685 Jun  8 13:00 imap.sh*
drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 pam.d/
             </code></pre><p>
             You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
             responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
           </p></div><p>
         To run the <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> server, the following files are required and must be created or copied to the appropriate directories on your server.
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Copy the imap file to the <code class="filename">/etc/pam.d/</code> directory if you intend to use imapd service.
         </p></li><li class="listitem"><p>
         Copy the pop file to the <code class="filename">/etc/pam.d/</code> directory if you intend to use popd service.
         </p></li></ul></div><p>         
         </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
         You can obtain the configuration files listed below on our <code class="literal">floppy.tgz</code> archive. Copy the following files from the decompressed <code class="literal">floppy.tgz</code> archive to the appropriate places or copy and paste them 
         directly from this book to the concerned file.
         </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm13224"></a>2.1. The <code class="filename">/etc/pam.d/imap</code> file</h3></div></div></div><p>
         Configure your <code class="filename">/etc/pam.d/imap</code> file to use pam authentication, create the imap file <span class="command"><strong>touch</strong></span> <code class="filename">/etc/pam.d/imap</code> and add:
         </p><pre class="programlisting">
         #%PAM-1.0
         auth       	required     /lib/security/pam_pwdb.so shadow nullok
         account    	required     /lib/security/pam_pwdb.so
         </pre><p>
         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         This file is only required if you intend to use <acronym class="acronym">IMAP</acronym> services.
         </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idm13241"></a>2.1.1. The <code class="filename">/etc/pam.d/pop</code> file</h4></div></div></div><p>
         Configure your <code class="filename">/etc/pam.d/pop</code> file to use pam authentication, create the pop file <span class="command"><strong>touch</strong></span> <code class="filename">/etc/pam.d/pop</code> and add:
         </p><pre class="programlisting">
         #%PAM-1.0
         auth       		required     /lib/security/pam_pwdb.so shadow nullok
         account    		required     /lib/security/pam_pwdb.so
         </pre><p>
         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         This file is only required if you intend to use <acronym class="acronym">POP</acronym> services.
         </p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm13258"></a>3. Enable <acronym class="acronym">IMAP</acronym> or <acronym class="acronym">POP</acronym> via the tcp-wrappers inetd super server</h2></div></div></div><p>
         Tcp-wrappers take cares to start and stop <acronym class="acronym">IMAP</acronym> or <acronym class="acronym">POP</acronym> server. Upon execution, inetd reads its configuration information from a configuration file which, by 
         default, is <code class="filename">/etc/inetd.conf</code>. There must be an entry for each field of the configuration file, with entries for each field separated by a <span class="keycap"><strong>tab</strong></span> or a <span class="keycap"><strong>space</strong></span>.
         </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
         Edit the <code class="filename">inetd.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/inetd.conf</code> and add or uncomment the line related to the service you want to enable. If you want to use <acronym class="acronym">IMAP</acronym> then 
         uncomment the line related to it, if is <acronym class="acronym">POP</acronym> that you want to use in your server, then uncomment it instead of <acronym class="acronym">IMAP</acronym>. In our example below we'll use <acronym class="acronym">IMAP</acronym> service.
         </p><pre class="programlisting">
         #pop-2   stream  tcp     nowait  root    /usr/sbin/tcpd ipop2d
         #pop-3   stream  tcp     nowait  root    /usr/sbin/tcpd ipop3d
         imap    stream  tcp     nowait  root    /usr/sbin/tcpd  imapd
         </pre><p>
         </p></li><li class="step"><p>
         Don't forget to update your <code class="filename">inetd.conf</code> file by sending a <code class="envar">SIGHUP</code> signal <span class="command"><strong>killall</strong></span>  -HUP inetd after adding or uncommenting the corresponding 
         line.
         </p><pre class="screen">
         [root@deep /root]# <span class="command"><strong>killall</strong></span>  -HUP inetd
         </pre><p>         
         </p></li><li class="step"><p>         
         If the <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> server you want to install is a private and limited server for wheel knows real <acronym class="acronym">IP</acronym> address clients, you can use the security feature of tcp-wrappers 
         to control, which can connect, to your server and from where. If you intended to offer mail service to a dial-up clients or a Webmail service for example, then you cannot use this feature.
         Edit the <code class="filename">hosts.deny</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/hosts.deny</code> and add the line:
         </p><pre class="programlisting">
         ALL: ALL@ALL, PARANOID
         </pre><p>
         Which means all services, all locations, so any service not explicitly allowed is then blocked, unless they are permitted access by entries in the <code class="filename">hosts.allow</code> file.
         </p></li><li class="step"><p>
         Edit the <code class="filename">hosts.allow</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/hosts.allow</code> and add the line:
         </p><pre class="programlisting">
         imapd: 216.209.228.34 my.domain.com
         </pre><p>
         Which mean only client <acronym class="acronym">IP</acronym> <code class="literal">216.209.228.34</code> with host name <code class="literal">my.domain.com</code> is allowed to connect and use <acronym class="acronym">IMAP</acronym> service on the server.
         </p></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm13306"></a>3.1. Securing <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym></h3></div></div></div><div class="qandaset"><a name="idm13310"></a><dl><dt>3.1.1. <a href="#idm13311">
         Do you really need IMAP/POP service?
         </a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="idm13311"></a><a name="idm13312"></a><p><b>3.1.1.</b></p></td><td align="left" valign="top"><p>
         Do you really need <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> service?
         </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>
         Be aware that <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> programs use plain text passwords by default. Anyone running a sniffer program along your network path can grab your username/password and use them 
         to log in as you. It's not because you use an <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> mail reader on your LINUX system that you need to run an <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> server locally. 
         Check your configuration, and if you use a remote/external <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> server then uninstall <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> on your system.
         
         </p><div class="mediaobject"><img src="./images/IMAP-Sniffer-Schema.gif" alt="Sniffer attack?"></div><p>
         </p></td></tr></tbody></table></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Using <acronym class="acronym">SSL</acronym> capabilities over <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym></b></p></div></div></div><p>
         Unfortunately, due to US government export restrictions, the <acronym class="acronym">IMAP</acronym> toolkit with <acronym class="acronym">SSL</acronym> capability is 
         currently not available. There are packages available from third parties that allow <acronym class="acronym">IMAP</acronym> and POP3 sessions through SSL. One of these packages is WebMail IMP, a web interface that permits you to read your mail via 
         the Internet with a web browser. WebMail IMP uses the <acronym class="acronym">SSL</acronym> protocol to encrypt the communication with the <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> server. See part IV,  Software's-Related Reference, in Chapter 19, 
         Servers Software (Web Network Services) for more information on the topic.

         </p><div class="mediaobject"><img src="./images/Webmail-IMP.gif" alt="Webmail-IMP web browser interface"></div><p>
         </p></div><p>
         With WebMail IMP, communications from the mail server through to the client machine are encrypted with the SSL protocol using a web browser.
         </p><p>
         Further documentation, for more details, there are several man pages you can read:
         </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">imapd</span>(8C)</span></span></dt><dd><p>
         - Internet Message Access Protocol server
         </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipopd</span>(8C)</span></span></dt><dd><p>
         - Post Office Protocol server
         </p></dd></dl></div><p>
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm13367"></a>4. Installed files</h2></div></div></div><p>
         These are the files installed by <acronym class="acronym">IMAP/POP</acronym> software:
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/pam.d/imap</code></td><td><code class="filename">/etc/pam.d/pop</code></td><td><code class="filename">/usr/include/imap</code></td></tr><tr><td><code class="filename">/usr/include/imap/dummy.h</code></td><td><code class="filename">/usr/include/imap/env.h</code></td><td><code class="filename">/usr/include/imap/env_unix.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/fdstring.h</code></td><td><code class="filename">/usr/include/imap/flstring.h</code></td><td><code class="filename">/usr/include/imap/fs.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/ftl.h</code></td><td><code class="filename">/usr/include/imap/imap4r1.h</code></td><td><code class="filename">/usr/include/imap/linkage.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/lockfix.h</code></td><td><code class="filename">/usr/include/imap/mail.h</code></td><td><code class="filename">/usr/include/imap/mbox.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/mbx.h</code></td><td><code class="filename">/usr/include/imap/mh.h</code></td><td><code class="filename">/usr/include/imap/misc.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/mmdf.h</code></td><td><code class="filename">/usr/include/imap/mtx.h</code></td><td><code class="filename">/usr/include/imap/mx.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/netmsg.h</code></td><td><code class="filename">/usr/include/imap/news.h</code></td><td><code class="filename">/usr/include/imap/newsrc.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/nl.h</code></td><td><code class="filename">/usr/include/imap/nntp.h</code></td><td><code class="filename">/usr/include/imap/os_a32.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/os_a41.h</code></td><td><code class="filename">/usr/include/imap/os_aix.h</code></td><td><code class="filename">/usr/include/imap/os_aos.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/os_art.h</code></td><td><code class="filename">/usr/include/imap/os_asv.h</code></td><td><code class="filename">/usr/include/imap/os_aux.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/os_bsd.h</code></td><td><code class="filename">/usr/include/imap/os_bsi.h</code></td><td><code class="filename">/usr/include/imap/os_cvx.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/os_d-g.h</code></td><td><code class="filename">/usr/include/imap/os_do4.h</code></td><td><code class="filename">/usr/include/imap/os_drs.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/os_dyn.h</code></td><td><code class="filename">/usr/include/imap/os_hpp.h</code></td><td><code class="filename">/usr/include/imap/os_isc.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/os_lnx.h</code></td><td><code class="filename">/usr/include/imap/os_lyn.h</code></td><td><code class="filename">/usr/include/imap/os_mct.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/os_mnt.h</code></td><td><code class="filename">/usr/include/imap/os_nxt.h</code></td><td><code class="filename">/usr/include/imap/os_os4.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/os_osf.h</code></td><td><code class="filename">/usr/include/imap/os_ptx.h</code></td><td><code class="filename">/usr/include/imap/os_pyr.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/os_qnx.h</code></td><td><code class="filename">/usr/include/imap/os_s40.h</code></td><td><code class="filename">/usr/include/imap/os_sc5.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/os_sco.h</code></td><td><code class="filename">/usr/include/imap/os_sgi.h</code></td><td><code class="filename">/usr/include/imap/os_shp.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/os_slx.h</code></td><td><code class="filename">/usr/include/imap/os_sol.h</code></td><td><code class="filename">/usr/include/imap/os_sos.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/os_sun.h</code></td><td><code class="filename">/usr/include/imap/os_sv2.h</code></td><td><code class="filename">/usr/include/imap/os_sv4.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/os_ult.h</code></td><td><code class="filename">/usr/include/imap/os_vu2.h</code></td><td><code class="filename">/usr/include/imap/osdep.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/phile.h</code></td><td><code class="filename">/usr/include/imap/pop3.h</code></td><td><code class="filename">/usr/include/imap/pseudo.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/rfc822.h</code></td><td><code class="filename">/usr/include/imap/smtp.h</code></td><td><code class="filename">/usr/include/imap/tcp.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/tcp_unix.h</code></td><td><code class="filename">/usr/include/imap/tenex.h</code></td><td><code class="filename">/usr/include/imap/unix.h</code></td></tr><tr><td><code class="filename">/usr/include/imap/utf8.h</code></td><td><code class="filename">/usr/include/imap/shortsym.h</code></td><td><code class="filename">/usr/lib/c-client.a</code></td></tr><tr><td><code class="filename">/usr/lib/libimap.a</code></td><td><code class="filename">/usr/man/man8/ipopd.8c</code></td><td><code class="filename">/usr/man/man8/imapd.8c</code></td></tr><tr><td><code class="filename">/usr/sbin/ipop2d</code></td><td><code class="filename">/usr/sbin/ipop3d</code></td><td><code class="filename">/usr/sbin/imapd</code></td></tr></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="pr6ch24SoNE"></a>Chapter 24. Software -Networking/Encryption</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#pr6ch24sc1ossl">1. Linux OPENSSL Server</a></span></dt><dt><span class="section"><a href="#idm13648">2. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm13782">3. Configure OpenSSL to optimise</a></span></dt><dt><span class="section"><a href="#idm13820">4. The <code class="filename">/etc/ssl/openssl.cnf</code> file</a></span></dt><dt><span class="section"><a href="#idm13846">5. Create the <code class="filename">/usr/bin/sign.sh</code> program file</a></span></dt><dt><span class="section"><a href="#idm13874">6. Commands -often used</a></span></dt><dt><span class="section"><a href="#idm14003">7. Securing OpenSSL</a></span></dt><dt><span class="section"><a href="#idm14021">8. Installed files</a></span></dt></dl></div><div class="highlights"><p>
         Most server software like <acronym class="acronym">IMAP</acronym> &amp; <acronym class="acronym">POP</acronym>, Samba, OpenLDAP, <acronym class="acronym">FTP</acronym>, Apache, and others that ask for users authentication before allowing services, by default transmit the user's 
         identification and password in plain text. Alternatively, encryption mechanisms like <acronym class="acronym">SSL</acronym> ensure safe and secure transactions. With this technology, data going over the network is point-to-point encrypted. Once OpenSSL 
         has been installed on your Linux server you can use it as a third party tool to enable other applications with <acronym class="acronym">SSL</acronym> functionality.
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch24sc1ossl"></a>1. Linux OPENSSL Server</h2></div></div></div><div class="epigraph"><p>
         The OpenSSL Project is a collaborative effort to develop a robust, commercial-grade, fully featured, and Open Source toolkit implementing the Secure Sockets Layer; <acronym class="acronym">SSL</acronym> v2/v3, and Transport Layer Security -<acronym class="acronym">TLS</acronym> v1 
         protocols with full-strength cryptography. The project is managed by a worldwide community of volunteers that use the Internet to communicate, plan, and develop the OpenSSL toolkit and its related documentation.
         </p><div class="mediaobject"><img src="./images/SSL-Schema.gif" alt="Cryptographic Technology"></div><p>
         </p><div class="attribution"><span>&#8212;<span class="attribution">From the [<span class="citation">OpenSSL web site</span>]</span></span></div></div><p>
         The main advantages gained by using encryption technology follow:
         </p><div class="variablelist"><p class="title"><b>Cryptography Advantages</b></p><dl class="variablelist"><dt><span class="term">Data Confidentiality</span></dt><dd><p>
         When a message is encrypted, the input plain text is transformed by an algorithm into enciphered text that hides the meaning of the message and can be sent via any public mechanism. This process involves a secret 
         key that is used to encrypt and later decrypt the data. Without the secret key, the encrypted data is meaningless.
         </p></dd><dt><span class="term">Data Integrity</span></dt><dd><p>
         A cryptographic checksum, called a message authentication code -<acronym class="acronym">MAC</acronym>, can be calculated on arbitrarily user-supplied text to protect the integrity of data. The result, text and <acronym class="acronym">MAC</acronym> 
         are then sent to the receiver which can verify the trial <acronym class="acronym">MAC</acronym> appended to a message by recalculating the <acronym class="acronym">MAC</acronym> for the message, using the appropriate secret key and verifying that 
         it exactly equals the trial <acronym class="acronym">MAC</acronym>.
         </p></dd><dt><span class="term">Authentication</span></dt><dd><p>
         Personal identification is another use of cryptography, where the user/sender knows a secret, which can serve to authenticate his/her identity.
         </p></dd><dt><span class="term">Electronic Signature</span></dt><dd><p>
         A digital signature assures the sender and receiver that the message is authentic and that only the owner of the key could have generated the digital signature.
         </p></dd></dl></div><p>
         </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a name="pr6ch24sc1wr"></a>Patents</h3><div class="mediaobject"><img src="./images/Warning.gif" alt="Warning"></div><p>
         Several legal issues exist for <acronym class="acronym">SSL</acronym> technology. If you intend to use OpenSSL for commercial purpose, you may need to obtain a license from <acronym class="acronym">RSA</acronym> regarding use of <acronym class="acronym">RSA</acronym> libraries.
         </p><p>
         Here's an excerpt from the README file of OpenSSL:
         Various companies hold various patents for various algorithms in various locations around the world. _YOU_ are responsible for ensuring that your use of any algorithms is legal by checking if there are any patents 
         in your country. This file contains some of the patents that we know about or are rumored to exist. This is not a definitive list.
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         <acronym class="acronym">RSA</acronym> Data Security holds software patents on the <acronym class="acronym">RSA</acronym> and <acronym class="acronym">RC5</acronym> algorithms. If their ciphers are used inside the USA and Japan?, you must contact <acronym class="acronym">RSA</acronym> 
         Data Security for licensing conditions. Their web page is <a class="link" href="#prtinxfp21" title="Patents">http://www.rsa.com/.</a>
         </p></li><li class="listitem"><p>
         <acronym class="acronym">RC4</acronym> is a trademark of <acronym class="acronym">RSA</acronym> Data Security, so use of this label should perhaps only be used with <acronym class="acronym">RSA</acronym> Data Security's permission.
         </p></li><li class="listitem"><p>
         The <acronym class="acronym">IDEA</acronym> algorithm is patented by Ascom in Austria, France, Germany, Italy, Japan, Netherlands, Spain, Sweden, Switzerland, UK and the USA. They should be contacted if that algorithm is to be 
         used; their web page is <a class="link" href="#prtinxfp21" title="Patents">http://www.ascom.ch/</a>
         </p></li></ul></div><p>
         </p></div><p>
         These installation instructions assume:
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Commands are Unix-compatible.
         </p></li><li class="listitem"><p>
         The source path is <code class="filename">/var/tmp</code> -<span class="emphasis"><em>other paths are possible</em></span>.
         </p></li><li class="listitem"><p>
         Installations were tested on Red Hat Linux 6.1 and 6.2.
         </p></li><li class="listitem"><p>
         All steps in the installation will happen in super-user account <code class="literal">root</code>.
         </p></li><li class="listitem"><p>
         OpenSSL version number is 0.9.5a
         </p></li></ul></div><p>
         </p><p>
         Before you decompress the tarballs, it is a good idea to make a list of files on the system before you install Openssl, and one afterwards, and then compare them using <span class="command"><strong>diff</strong></span> to find out what file it placed 
         where. Simply run <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; OpenSSL1</code></strong> before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; OpenSSL2</code></strong> after you install the software, and use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>OpenSSL1 OpenSSL2 &gt; OpenSSL-Installed</code></strong> 
         to get a list of what changed.
         </p><p>
         These are the Package(s) required:
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         OpenSSL Homepage: <a class="link" href="#prtinxfp22" title="OPENSSL">http://www.openssl.org/</a>
         </td></tr><tr><td>
         You must be sure to download: openssl-0.9.5a.tar.gz
         </td></tr></table><p>
         </p><p>
         To Compile, you need to decompress the tarball (tar.gz).
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>cp</strong></span> openssl-version.tar.gz /var/tmp
         [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
         [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf openssl-version.tar.gz
         </pre><p>
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm13648"></a>2. Compile and Optimize</h2></div></div></div><p>
         Move into the new Openssl directory and type the following commands on your terminal:
         </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
         Edit the <code class="filename">c_rehash</code> file, <span class="command"><strong>vi</strong></span> +11 <code class="filename">tools/c_rehash</code> and change the line:

         </p><pre class="programlisting">
         DIR=/usr/local/ssl
         </pre><p>
         To read:
         </p><pre class="programlisting">
         DIR=/usr
         </pre><p>
         The changed line above will build and install OpenSSL in the default location <code class="filename">/usr</code>.
         </p></li><li class="step"><p>
         By default, OpenSSL source files suppose that your Perl program directory is located under the <code class="filename">/usr/local/bin/perl</code> directory. We must modify the <span class="markup">#!/usr/local/bin/perl</span> line 
         in all scripts that rely on perl to reflect our Perl directory under Red Hat Linux to be <code class="filename">/usr/bin</code>.
         </p><pre class="screen">
           [root@deep ]/openssl-0.9.5a# <span class="command"><strong>perl</strong></span> util/perlpath.pl /usr/bin <a name="prssl"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
         </pre><p>
         </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#prssl"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
         where your perl program reside.
         </p></td></tr></table></div><p>
         </p></li><li class="step"><p>
         OpenSSL must know where to find the necessary OpenSSL source libraries to compile successfully its required files. With the command below, we set the <code class="literal">PATH</code> environment variable to the default directory where we 
         have uncompressed the OpenSSL source files.
         </p><pre class="screen">
         [root@deep ]/openssl-0.9.5a# <span class="command"><strong>export</strong></span> LD_LIBRARY_PATH=`pwd`
         </pre><p>
         </p></li><li class="step"><p>
         Now, we must configure OpenSSL for our system:
         </p><pre class="programlisting">
         CC="egcs" \
         ./Configure linux-elf -DSSL_FORBID_ENULL \ <a name="dsfrd"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
         --prefix=/usr  \
         --openssldir=/etc/ssl
         </pre><p>
         </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#dsfrd"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
         The <code class="envar">-DSSL_FORBID_ENULL</code> option is required for not allowing null encryption for security reasons.
         </p></td></tr></table></div><p>
         </p></li><li class="step"><p>         
         Edit the Makefile.ssl file  and change the following line:
         </p><ol type="a" class="substeps"><li class="step"><p>
         <span class="command"><strong>vi</strong></span> +50 <code class="filename">Makefile.ssl</code>
         </p><pre class="programlisting">
         CC= gcc
         </pre><p>
         To read:
         </p><pre class="programlisting">
         CC= egcs
         </pre><p>
         </p></li><li class="step"><p>
         Edit with <span class="command"><strong>vi</strong></span> +52 <code class="filename">Makefile.ssl</code> and add/change the following line:
         </p><pre class="programlisting">
         CFLAG= -DTHREADS -D_REENTRANT -DSSL_FORBID_ENULL -DL_ENDIAN -DTERMIO -O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions -Wall -DSHA1_ASM -DMD5_ASM -DRMD160_ASM
         </pre><p>
         </p></li><li class="step"><p>
         Edit with <span class="command"><strong>vi</strong></span> +79 <code class="filename">Makefile.ssl</code> and add the following value for a Pentium Pro processor:
         </p><pre class="programlisting">
         PROCESSOR=  686
         </pre><p>
         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         The three modifications we made above will set the optimization flag for compilation of OpenSSL software on the server. For the last modification <code class="envar">PROCESSOR=</code> above, if you use 
         <code class="literal">586</code> to denote a Pentium, use <code class="literal">686</code> to denote Pro/II/III, use <code class="literal">486</code> to denote a 486, depending on the type of processor you have. 
         </p></div><p>
         </p></li><li class="step"><p>
         Edit with <span class="command"><strong>vi</strong></span> +161 <code class="filename">Makefile.ssl</code> and change the following line:
         </p><pre class="programlisting">
         MANDIR=$(OPENSSLDIR)/man
         </pre><p>
         To read:
         </p><pre class="programlisting">
         MANDIR=/usr/man
         </pre><p>
         This step is necessary to set the directory for where the man pages of OpenSSL will be installed. With this modification, we install them under <code class="filename">/usr/man</code> directory.
         </p></li></ol></li></ol></div><p>
           Now we must compile and install OpenSSL on the server:
           </p><pre class="screen">
             [root@deep ]/openssl-0.9.5a# <span class="command"><strong>make</strong></span> -f  Makefile
             [root@deep ]/openssl-0.9.5a# <span class="command"><strong>make</strong></span> test
             [root@deep ]/openssl-0.9.5a# <span class="command"><strong>make</strong></span> install
             [root@deep ]/openssl-0.9.5a# <span class="command"><strong>mv</strong></span> /etc/ssl/misc/*  /usr/bin/
             [root@deep ]/openssl-0.9.5a# <span class="command"><strong>rm</strong></span> -rf  /etc/ssl/misc/
             [root@deep ]/openssl-0.9.5a# <span class="command"><strong>rm</strong></span> -rf  /etc/ssl/lib/
             [root@deep ]/openssl-0.9.5a# <span class="command"><strong>rm</strong></span> -f   /usr/bin/CA.pl
             [root@deep ]/openssl-0.9.5a# <span class="command"><strong>rm</strong></span> -f   /usr/bin/CA.sh
             [root@deep ]/openssl-0.9.5a# <span class="command"><strong>install</strong></span> -m 644 libRSAglue.a  /usr/lib/
             [root@deep ]/openssl-0.9.5a# <span class="command"><strong>install</strong></span> -m 644 rsaref/rsaref.h  /usr/include/openssl/
             [root@deep ]/openssl-0.9.5a# <span class="command"><strong>strip</strong></span> /usr/bin/openssl
             [root@deep ]/openssl-0.9.5a# <span class="command"><strong>mkdir</strong></span> -p /etc/ssl/crl
           </pre><p>
         </p><p>
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           The <span class="command"><strong>make</strong></span> -f  command will build the OpenSSL libraries, <code class="filename">libcrypto.a</code> and <code class="filename">libssl.a</code> and the OpenSSL binary openssl. The libraries 
           will be built in the top-level directory, and the binary will be in the <code class="filename">apps</code> directory.
         </p></li><li class="listitem"><p>
         After a successful build, the <span class="command"><strong>make test</strong></span> will test the libraries and finally the <span class="command"><strong>make install</strong></span> will create the installation directory and <span class="command"><strong>install</strong></span> OpenSSL.
         </p></li><li class="listitem"><p>
         The <span class="command"><strong>mv</strong></span> command will move all files under the <code class="filename">/etc/ssl/misc/</code> directory to the <code class="filename">/usr/bin/</code> directory. These 
         files are binary and must be located under <code class="filename">/usr/bin/</code> since in our system, all binary files are keep in this directory. Also putting these files in the <code class="filename">/usr/bin/</code> 
         directory will keep them in our <code class="literal">PATH</code> environment variable.
         </p></li><li class="listitem"><p>
         The <span class="command"><strong>rm</strong></span> command will remove the <code class="filename">/etc/ssl/misc/</code> and <code class="filename">/etc/ssl/lib/</code> directories from our system, since files that were in these directories are 
         now located in other places. Also, it will remove the <code class="filename">CA.pl</code> and <code class="filename">CA.sh</code> files, that are small scripts used to create your own CA certificates. Those scripts related to <span class="command"><strong>openssl ca</strong></span> 
         commands has some strange requirements,  and the default OpenSSL config doesn't allow one easily to use <span class="command"><strong>openssl ca</strong></span> directly. So we'll create the <code class="filename">sign.sh</code> script program later to replace them.
         </p></li></ul></div><p>
         </p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Caution.gif" alt="Caution"></span>
</h3><p>
           The <code class="literal">bc-1.05a-4.i386.rpm</code> package or higher must be already installed on your Linux server or you'll receive an error message during the library test of OpenSSL.
         </p></div><p>
           Please don't forget to cleanup later:
           </p><pre class="screen">
             [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
             [root@deep tmp]# <span class="command"><strong>rm</strong></span>  -rf openssl-version/ openssl-version.tar.gz
           </pre><p>
           The <span class="command"><strong>rm</strong></span> command will remove all the source files we have used to compile and install OpenSSL. It will also remove the OpenSSL compressed archive from th<code class="filename">/var/tmp</code> directory.
         </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm13782"></a>3. Configure OpenSSL to optimise</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
             You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
             for respective software. For example <em class="wordasword">OpenSSL</em> configuration file are organised like this:
             </p><pre class="literallayout"><code class="computeroutput">
             total 16
             -rw-r--r--    1 harrypotter    harrypotter        7002 Jun  8 13:00 openssl.cnf
             -rwxr-xr-x    1 harrypotter    harrypotter        1847 Jun  8 13:00 sign.sh*
             -rwx------    1 harrypotter    harrypotter         362 Jun  8 13:00 ssl.sh*
             </code></pre><p>
             You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
             responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
           </p></div><p>
         To run OpenSSL Server, the following files are required and must be created or copied to the appropriate directories on your server.
         </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
         Copy the <code class="filename">openssl.cnf</code> file to the <code class="filename">/etc/ssl/</code> directory.
         </p></li><li class="listitem"><p>
         Copy the <code class="filename">sign.sh</code> script file to the <code class="filename">/usr/bin/</code> directory.
         </p></li></ol></div><p>
         </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
         You can obtain the configuration files listed below on our <code class="filename">floppy.tgz</code> archive. Copy the following files from the decompressed <code class="filename">floppy.tgz</code> archive to the appropriate places or copy and 
         paste them directly from this book to the concerned file.
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm13820"></a>4. The <code class="filename">/etc/ssl/openssl.cnf</code> file</h2></div></div></div><p>
         This is the general configuration file for OpenSSL program where you can configure expiration date of your keys, the name of your organization, the address etc. The parameters you may change will be in the <code class="literal">[<span class="optional"> CA_default </span>]</code>
         and especially the <code class="literal">[<span class="optional"> req_distinguished_name </span>]</code> sections.

         Edit the <code class="filename">openssl.cnf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/ssl/openssl.cnf</code> and add or modify:
         </p><pre class="programlisting">
         # OpenSSL example configuration file.
         # This is mostly being used for generation of certificate requests.
         #

         RANDFILE	= $ENV::HOME/.rnd
         oid_file	= $ENV::HOME/.oid
         oid_section            	= new_oids

         # To use this configuration file with the "-extfile" option of the
         # "openssl x509" utility, name here the section containing the
         # X.509v3 extensions to use:
         # extensions            	= 
         # (Alternatively, use a configuration file that has only
         # X.509v3 extensions in its main [= default] section.)

         [ new_oids ]

         # We can add new OIDs in here for use by 'ca' and 'req'.
         # Add a simple OID like this:
         # testoid1=1.2.3.4
         # Or use config file substitution like this:
         # testoid2=${testoid1}.5.6

         ####################################################################
         [ ca ]
         default_ca      	= CA_default            	# The default ca section

         ####################################################################
         [ CA_default ]

         dir             	= /etc/ssl              		# Where everything is kept
         certs	= $dir/certs            	# Where the issued certs are kept
         crl_dir	= $dir/crl		# Where the issued crl are kept
         database	= $dir/ca.db.index  	# database index file.
         new_certs_dir   	= $dir/ca.db.certs      	# default place for new certs.

         certificate     	= $dir/certs/ca.crt     	# The CA certificate
         serial          	= $dir/ca.db.serial     	# The current serial number
         crl             	= $dir/crl.pem          	# The current CRL
         private_key     	= $dir/private/ca.key   	# The private key
         RANDFILE        	= $dir/ca.db.rand       	# private random number file

         x509_extensions = usr_cert              	# The extentions to add to the cert

         # Extensions to add to a CRL. Note: Netscape communicator chokes on V2 CRLs
         # so this is commented out by default to leave a V1 CRL.
         # crl_extensions = crl_ext

         default_days    	= 365                   		# how long to certify for
         default_crl_days	= 30                    		# how long before next CRL
         default_md      	= md5                   	# which md to use.
         Preserve	= no                    		# keep passed DN ordering

         # A few difference way of specifying how similar the request should look
         # For type CA, the listed attributes must be the same, and the optional
         # and supplied fields are just that :-)
         policy          	= policy_match

         # For the CA policy
         [ policy_match ]
         countryName             	= match
         stateOrProvinceName     	= match
         organizationName        	= match
         organizationalUnitName  	= optional
         commonName              	= supplied
         emailAddress            	= optional

         # For the 'anything' policy
         # At this point in time, you must list all acceptable 'object'
         # types.
         [ policy_anything ]
         countryName             	= optional
         stateOrProvinceName     	= optional
         localityName            	= optional
         organizationName        	= optional
         organizationalUnitName  	= optional
         commonName              	= supplied
         emailAddress            	= optional

         ####################################################################
         [ req ]
         default_bits            	= 1024
         default_keyfile         	= privkey.pem
         distinguished_name      	= req_distinguished_name
         attributes              	= req_attributes
         x509_extensions = v3_ca # The extentions to add to the self signed cert

         [ req_distinguished_name ]
         countryName                     	= Country Name (2 letter code)
         countryName_default             	= CA
         countryName_min                 	= 2
         countryName_max                 	= 2

         stateOrProvinceName             	= State or Province Name (full name)
         stateOrProvinceName_default	= Quebec

         localityName                    	= Locality Name (eg, city)
         localityName_default            	= Montreal

         0.organizationName              	= Organization Name (eg, company)
         0.organizationName_default      	= Open Network Architecture

         # we can do this but it is not needed normally :-)
         #1.organizationName             	= Second Organization Name (eg, company)
         #1.organizationName_default	= World Wide Web Pty Ltd

         organizationalUnitName          	= Organizational Unit Name (eg, section)
         organizationalUnitName_default	= Internet Department

         commonName                      	= Common Name (eg, YOUR name)
         commonName_default              	= www.openna.com
         commonName_max                  	= 64

         emailAddress                    	= Email Address
         emailAddress_default            	= admin@openna.com
         emailAddress_max                	= 40

         # SET-ex3                       	= SET extension number 3

         [ req_attributes ]
         challengePassword               	= A challenge password
         challengePassword_min           	= 4
         challengePassword_max           	= 20

         unstructuredName                	= An optional company name

         [ usr_cert ]

         # These extensions are added when 'ca' signs a request.

         # This goes against PKIX guidelines but some CAs do it and some software
         # requires this to avoid interpreting an end user certificate as a CA.

         basicConstraints=CA:FALSE

         # Here are some examples of the usage of nsCertType. If it is omitted
         # the certificate can be used for anything *except* object signing.

         # This is OK for an SSL server.
         # nsCertType                    = server

         # For an object signing certificate this would be used.
         # nsCertType = objsign

         # For normal client use this is typical
         # nsCertType = client, email

         # and for everything including object signing:
         # nsCertType = client, email, objsign

         # This is typical in keyUsage for a client certificate.
         # keyUsage = nonRepudiation, digitalSignature, keyEncipherment

         # This will be displayed in Netscape's comment listbox.
         nsComment                       = "OpenSSL Generated Certificate"

         # PKIX recommendations harmless if included in all certificates.
         subjectKeyIdentifier=hash
         authorityKeyIdentifier=keyid,issuer:always

         # This stuff is for subjectAltName and issuerAltname.
         # Import the email address.
         # subjectAltName=email:copy

         # Copy subject details
         # issuerAltName=issuer:copy

         #nsCaRevocationUrl              = http://www.domain.dom/ca-crl.pem
         #nsBaseUrl
         #nsRevocationUrl
         #nsRenewalUrl
         #nsCaPolicyUrl
         #nsSslServerName

         [ v3_ca]

         # Extensions for a typical CA


         # PKIX recommendation.

         subjectKeyIdentifier=hash

         authorityKeyIdentifier=keyid:always,issuer:always

         # This is what PKIX recommends but some broken software chokes on critical
         # extensions.
         #basicConstraints = critical,CA:true
         # So we do this instead.
         basicConstraints = CA:true

         # Key usage: this is typical for a CA certificate. However since it will
         # prevent it being used as an test self-signed certificate it is best
         # left out by default.
         # keyUsage = cRLSign, keyCertSign

         # Some might want this also
         # nsCertType = sslCA, emailCA

         # Include email address in subject alt name: another PKIX recommendation
         # subjectAltName=email:copy
         # Copy issuer details
         # issuerAltName=issuer:copy

         # RAW DER hex encoding of an extension: beware experts only!
         # 1.2.3.5=RAW:02:03
         # You can even override a supported extension:
         # basicConstraints= critical, RAW:30:03:01:01:FF

         [ crl_ext ]
         # CRL extensions.
         # Only issuerAltName and authorityKeyIdentifier make any sense in a CRL.

         # issuerAltName=issuer:copy
         authorityKeyIdentifier=keyid:always,issuer:always
         </pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
         The file <code class="filename">openssl.cnf</code> already exists on your server when you compile and install the OpenSSL program, and can be found under the <code class="filename">/etc/ssl/</code> directory. You 
         don't need to change all the default options set in this file; The configurations you may usually change will be in the <code class="literal">[<span class="optional"> CA_default </span>]</code> and <code class="literal">[<span class="optional"> req_distinguished_name </span>]</code> sections only.
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm13846"></a>5. Create the <code class="filename">/usr/bin/sign.sh</code> program file</h2></div></div></div><p>
         The <span class="command"><strong>openssl ca</strong></span> commands has some strange requirements and the default OpenSSL config doesn't allow one easily to use <span class="command"><strong>openssl ca</strong></span> directly. Therefore, well create this <code class="filename">sign.sh</code> 
         program to replace it.

         Create the <code class="filename">sign.sh</code> program file, <span class="command"><strong>touch</strong></span> <code class="filename">/usr/bin/sign.sh</code> and add to this file:
         </p><pre class="programlisting">
         #!/bin/sh
         ##
         ##  sign.sh -- Sign a SSL Certificate Request (CSR)
         ##  Copyright (c) 1998-1999 Ralf S. Engelschall, All Rights Reserved. 
         ##

         #   argument line handling
         CSR=$1
         if [ $# -ne 1 ]; then
         echo "Usage: sign.sign &lt;whatever&gt;.csr"; exit 1
         fi
         if [ ! -f $CSR ]; then
         echo "CSR not found: $CSR"; exit 1
         fi
         case $CSR in
         *.csr ) CERT="`echo $CSR | sed -e 's/\.csr/.crt/'`" ;;
         * ) CERT="$CSR.crt" ;;
         esac

         #   make sure environment exists
         if [ ! -d ca.db.certs ]; then
         mkdir ca.db.certs
         fi
         if [ ! -f ca.db.serial ]; then
         echo '01' &gt;ca.db.serial
         fi
         if [ ! -f ca.db.index ]; then
         cp /dev/null ca.db.index
         fi

         #   create an own SSLeay config
         cat &gt;ca.config &lt;&lt;EOT
         [ ca ]
         default_ca	= CA_own
         [ CA_own ]
         dir	= /etc/ssl
         certs	= /etc/ssl/certs
         new_certs_dir	= /etc/ssl/ca.db.certs
         database	= /etc/ssl/ca.db.index
         serial	= /etc/ssl/ca.db.serial
         RANDFILE	= /etc/ssl/ca.db.rand
         certificate	= /etc/ssl/certs/ca.crt
         private_key	= /etc/ssl/private/ca.key
         default_days	= 365
         default_crl_days	= 30
         default_md	= md5
         preserve	= no
         policy	= policy_anything
         [ policy_anything ]
         countryName	= optional
         stateOrProvinceName	= optional
         localityName	= optional
         organizationName	= optional
         organizationalUnitName	= optional
         commonName	= supplied
         emailAddress	= optional
         EOT

         #  sign the certificate
         echo "CA signing: $CSR -&gt; $CERT:"
         openssl ca -config ca.config -out $CERT -infiles $CSR
         echo "CA verifying: $CERT &lt;-&gt; CA cert"
         openssl verify -CAfile /etc/ssl/certs/ca.crt $CERT

         #  cleanup after SSLeay 
         rm -f ca.config
         rm -f ca.db.serial.old
         rm -f ca.db.index.old

         #  die gracefully
         exit 0
         </pre><p>
         Now, make this program executable, and change its default permissions:
         </p><pre class="screen">
         [root@deep] /# <span class="command"><strong>chmod</strong></span> 755 /usr/bin/sign.sh
         </pre><p>
         </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
         You can also find this program <code class="filename">sign.sh</code> in the mod_ssl distribution under the <code class="filename">mod_ssl-version/pkg.contrib/</code> subdirectory, or on our <code class="filename">floppy.tgz</code> 
         archive file. Also note that the section <code class="literal">[<span class="optional"> CA_own </span>]</code> must be changed to refect your own environment and don't forget to change the  openssl <code class="literal">verify -CAfile /etc/ssl/certs/ca.crt $CERT</code> line too.
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm13874"></a>6. Commands -often used</h2></div></div></div><p>
         The commands listed below are some that we use often, but many more exist. Check the man pages and documentation for more details and information.
         As an example, we'll show you how to create certificates for your Apache Web Server and/or your own <acronym class="acronym">CA</acronym> Certifying Authority to sign your Certificate Signing Request yourself.
         </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
  <span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>

</h3><p>
         All commands listed below are assumed to be made in the <code class="filename">/etc/ssl/</code> directory.
         </p></div><p>
         Create a RSA private key protected with a passphrase for your Apache Server.
         </p><pre class="screen">
         [root@deep ]/ssl#<span class="command"><strong>openssl</strong></span> genrsa -des3 -out server.key 1024
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Generating RSA private key, 1024 bit long modulus
         ......................+++++
         .....+++++
         e is 65537 (0x10001)
         Enter PEM pass phrase:
         Verifying password - Enter PEM pass phrase:

         Please backup this server.key file and remember the pass-phrase you had to enter at a secure location.
         </code></pre><p>
         </p><p>
         Generate a Certificate Signing Request <acronym class="acronym">CSR</acronym> with the server <acronym class="acronym">RSA</acronym> private key.
         </p><pre class="screen">
         [root@deep ]/ssl# <span class="command"><strong>openssl</strong></span> req -new -key server.key -out server.csr
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Using configuration from /etc/ssl/openssl.cnf
         Enter PEM pass phrase:
         You are about to be asked to enter information that will be incorporated
         into your certificate request.
         What you are about to enter is what is called a Distinguished Name or a DN.
         There are quite a few fields but you can leave some blank
         For some fields there will be a default value,
         If you enter '.', the field will be left blank.
         -----
         Country Name (2 letter code) [CA]:
         State or Province Name (full name) [Quebec]:
         Locality Name (eg, city) [Montreal]:
         Organization Name (eg, company) [Open Network Architecture]:
         Organizational Unit Name (eg, section) [Internet Department]:
         Common Name (eg, YOUR name) [www.openna.com]:
         Email Address [admin@openna.com]:

         Please enter the following 'extra' attributes
         to be sent with your certificate request
         A challenge password []:.
         An optional company name []:.
         </code></pre><p>
         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
         Make sure you enter the <acronym class="acronym">FQDN</acronym>, Fully Qualified Domain Name of the server when OpenSSL prompts you for the <code class="literal">CommonName</code>, i.e. when you generate a <acronym class="acronym">CSR</acronym> for a website which will be 
         later accessed via <code class="literal">https://www.mydomain.com/</code>, enter <code class="literal">www.mydomain.com</code> here.
         </p></div><p>
         After generation of your Certificate Signing Request; <acronym class="acronym">CSR</acronym>, you have two choices: 
         </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
         the first is to send this certificate to a commercial Certifying Authority (<acronym class="acronym">CA</acronym>) like Verisign or Thawte for signing. You usually have to post the <acronym class="acronym">CSR</acronym> into a web form, pay for the signing, await the signed Certificate and store 
         it into a <code class="filename">server.crt</code>  file. The result is then a real Certificate, which can be used for Apache.
         </p></li><li class="listitem"><p>
         Second, you can use your own <acronym class="acronym">CA</acronym> and now have to sign the <acronym class="acronym">CSR</acronym> yourself by this <acronym class="acronym">CA</acronym>. This solution is economical, and allows an organization to host their own <acronym class="acronym">CA</acronym> server and generate as many 
         certificates as they need for internal use without paying any cent to a commercial <acronym class="acronym">CA</acronym>. Unfortunately. using your own <acronym class="acronym">CA</acronym> to generate certificates cause problems in electronic commerce, because customers need to have some trust 
         in your organization by the use of recognized commercial <acronym class="acronym">CA</acronym>. 
         </p></li></ol></div><p>
         See below on how to sign a <acronym class="acronym">CSR</acronym> with your <acronym class="acronym">CA</acronym> yourself.
         </p><p>
         Create a <acronym class="acronym">RSA</acronym> private key for your <acronym class="acronym">CA</acronym>.
         </p><pre class="screen">
         [root@deep ]/ssl# <span class="command"><strong>openssl</strong></span> genrsa -des3 -out ca.key 1024
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Generating RSA private key, 1024 bit long modulus
         ...........................+++++
         ............................................+++++
         e is 65537 (0x10001)
         Enter PEM pass phrase:
         Verifying password - Enter PEM pass phrase:

         Please backup this ca.key file and remember the pass-phrase you had to enter at a secure location.
         </code></pre><p>
         </p><p>
         Create a self-signed <acronym class="acronym">CA</acronym> certificate <code class="literal">x509</code> structure with the <acronym class="acronym">RSA</acronym> key of the <acronym class="acronym">CA</acronym>.
         </p><pre class="screen">
         [root@deep ]/ssl# <span class="command"><strong>openssl</strong></span> req -new -x509 -days 365 -key ca.key -out ca.crt
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         Using configuration from /etc/ssl/openssl.cnf
         Enter PEM pass phrase:
         You are about to be asked to enter information that will be incorporated
         into your certificate request.
         What you are about to enter is what is called a Distinguished Name or a DN.
         There are quite a few fields but you can leave some blank
         For some fields there will be a default value,
         If you enter '.', the field will be left blank.
         -----
         Country Name (2 letter code) [CA]:
         State or Province Name (full name) [Quebec]:
         Locality Name (eg, city) [Montreal]:
         Organization Name (eg, company) [Open Network Architecture]:
         Organizational Unit Name (eg, section) [Internet Department]:CA Marketing
         Common Name (eg, YOUR name) [www.openna.com]:
         Email Address [admin@openna.com]:
         </code></pre><p>
         </p><pre class="screen">
         [root@deep ]/ssl# <span class="command"><strong>mv</strong></span> server.key private/
         [root@deep ]/ssl# <span class="command"><strong>mv</strong></span> ca.key private/
         [root@deep ]/ssl# <span class="command"><strong>mv</strong></span> ca.crt certs/
         </pre><p>
         </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
             <span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span>

           </h3><p>
        The <span class="command"><strong>req</strong></span> command creates a self-signed certificate when the <em class="parameter"><code>-x509</code></em> switch is used.
         </p></div><p>
         Signing a certificate request. We create and use our own Certificate Authority -<acronym class="acronym">CA</acronym>,

         Prepare the script for signing which is needed because the <span class="command"><strong>openssl ca</strong></span> command has some strange requirements, and the default OpenSSL config doesn't allow one easily to use <span class="command"><strong>openssl ca</strong></span> 
         directly. The script named <code class="filename">sign.sh</code> is distributed with the floppy disk under the openssl directory. Use this script for signing.

         Now you can use this <acronym class="acronym">CA</acronym> to sign server <acronym class="acronym">CSR</acronym>'s in order to create real SSL Certificates for use inside an Apache Webserver assuming you already have a server.csr at hand:
         </p><pre class="screen">
         [root@deep ]/ssl# /usr/bin/sign.sh server.csr
         </pre><p>
         </p><pre class="literallayout"><code class="computeroutput">
         CA signing: server.csr -&gt; server.crt:
         Using configuration from ca.config
         Enter PEM pass phrase:
         Check that the request matches the signature
         Signature ok
         The Subjects Distinguished Name is as follows
         countryName           	:PRINTABLE:'CA'
         stateOrProvinceName   	:PRINTABLE:'Quebec'
         localityName          	:PRINTABLE:'Montreal'
         organizationName      	:PRINTABLE:'Open Network Architecture'
         organizationalUnitName	:PRINTABLE:'Internet Department'
         commonName            	:PRINTABLE:'www.openna.com'
         emailAddress          	:IA5STRING:'admin@openna.com'
         Certificate is to be certified until Dec  1 14:59:29 2000 GMT (365 days)
         Sign the certificate? [y/n]:y


         1 out of 1 certificate requests certified, commit? [y/n]y
         Write out database with 1 new entries
         Data Base Updated
         CA verifying: server.crt &lt;-&gt; CA cert
         server.crt: OK
         </code></pre><p>
         </p><p>
         This signs the <acronym class="acronym">CSR</acronym> and results in a server.crt file.
         </p><pre class="screen">
         [root@deep ]/ssl# <span class="command"><strong>mv</strong></span> server.crt certs/
         </pre><p>
         Now you have two files: <code class="filename">server.key</code> and <code class="filename">server.crt.</code> These can now, for example, be used as follows, inside your Apache server's <code class="filename">httpd.conf</code> file:
         </p><pre class="programlisting">
         SSLCertificateFile    /etc/ssl/certs/server.crt	 <a name="srpu"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span> 
         SSLCertificateKeyFile /etc/ssl/private/server.key	 <a name="srprv"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span> 
         </pre><p>
         </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#srpu"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
         Our web server public key
         </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#srprv"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
         Our web server private key
         </p></td></tr></table></div><p>
         The <code class="filename">server.csr</code> file is no longer needed.
         </p><pre class="screen">
         [root@deep ]/ssl# <span class="command"><strong>rm</strong></span> -f server.csr
         </pre><p>
         </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
         If you receive error message during signature of the certificate, it's probably because you've entered the wrong <acronym class="acronym">FQDN</acronym>, Fully Qualified Domain Name for the server when OpenSSL prompted you for 
         the <code class="literal">CommonName</code>; the <code class="literal">CommonName</code> must be something like <code class="literal">my.domain.com</code> and not <code class="literal">domain.com</code>. Also, since you generate both the certificate 
         and the <acronym class="acronym">CA</acronym> certificate, it's important that at least one piece of information differs between both files, or you may encounter problems during the signature of the certificate request.
         </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm14003"></a>7. Securing OpenSSL</h2></div></div></div><p>
Make your keys <code class="literal">Read and Write</code> only by the super-user <code class="literal">root</code>. This is important because no one needs to touch these files.
use the following commands:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>chmod</strong></span> 600  /etc/ssl/certs/ca.crt
[root@deep] /# <span class="command"><strong>chmod</strong></span> 600  /etc/ssl/certs/server.crt
[root@deep] /# <span class="command"><strong>chmod</strong></span> 600  /etc/ssl/private/ca.key
[root@deep] /# <span class="command"><strong>chmod</strong></span> 600  /etc/ssl/private/server.key
</pre><p>
</p><p>
Some possible uses of OpenSSL software, for example OpenSSL can be used to:
</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
Create your own Certificate Server.
</p></li><li class="listitem"><p>
Provide data confidentiality, integrity, authentication, and electronic signature in transmission for the users.
</p></li><li class="listitem"><p>
Secure electronic commerce transactions.
</p></li></ol></div><p>
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm14021"></a>8. Installed files</h2></div></div></div><p>These are the files installed by OpenSSL software on your harddisk:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/ssl</code></td><td><code class="filename">/etc/ssl/crl</code></td><td><code class="filename">/etc/ssl/certs</code></td></tr><tr><td><code class="filename">/etc/ssl/private</code></td><td><code class="filename">/etc/ssl/openssl.cnf</code></td><td><code class="filename">/usr/bin/openssl</code></td></tr><tr><td><code class="filename">/usr/bin/c_rehash</code></td><td><code class="filename">/usr/bin/sign.sh</code></td><td><code class="filename">/usr/bin/c_hash</code></td></tr><tr><td><code class="filename">/usr/bin/c_info</code></td><td><code class="filename">/usr/bin/c_issuer</code></td><td><code class="filename">/usr/bin/c_name</code></td></tr><tr><td><code class="filename">/usr/bin/der_chop</code></td><td><code class="filename">/usr/include/openssl</code></td><td><code class="filename">/usr/include/openssl/e_os.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/e_os2.h</code></td><td><code class="filename">/usr/include/openssl/crypto.h</code></td><td><code class="filename">/usr/include/openssl/tmdiff.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/opensslv.h</code></td><td><code class="filename">/usr/include/openssl/opensslconf.h</code></td><td><code class="filename">/usr/include/openssl/ebcdic.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/md2.h</code></td><td><code class="filename">/usr/include/openssl/md5.h</code></td><td><code class="filename">/usr/include/openssl/sha.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/mdc2.h</code></td><td><code class="filename">/usr/include/openssl/hmac.h</code></td><td><code class="filename">/usr/include/openssl/ripemd.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/des.h</code></td><td><code class="filename">/usr/include/openssl/rc2.h</code></td><td><code class="filename">/usr/include/openssl/rc4.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/rc5.h</code></td><td><code class="filename">/usr/include/openssl/idea.h</code></td><td><code class="filename">/usr/include/openssl/blowfish.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/cast.h</code></td><td><code class="filename">/usr/include/openssl/bn.h</code></td><td><code class="filename">/usr/include/openssl/rsa.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/dsa.h</code></td><td><code class="filename">/usr/include/openssl/dh.h</code></td><td><code class="filename">/usr/include/openssl/buffer.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/bio.h</code></td><td><code class="filename">/usr/include/openssl/stack.h</code></td><td><code class="filename">/usr/include/openssl/safestack.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/lhash.h</code></td><td><code class="filename">/usr/include/openssl/rand.h</code></td><td><code class="filename">/usr/include/openssl/err.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/objects.h</code></td><td><code class="filename">/usr/include/openssl/evp.h</code></td><td><code class="filename">/usr/include/openssl/asn1.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/asn1_mac.h</code></td><td><code class="filename">/usr/include/openssl/pem.h</code></td><td><code class="filename">/usr/include/openssl/pem2.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/x509.h</code></td><td><code class="filename">/usr/include/openssl/x509_vfy.h</code></td><td><code class="filename">/usr/include/openssl/x509v3.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/conf.h</code></td><td><code class="filename">/usr/include/openssl/txt_db.h</code></td><td><code class="filename">/usr/include/openssl/pkcs7.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/pkcs12.h</code></td><td><code class="filename">/usr/include/openssl/comp.h</code></td><td><code class="filename">/usr/include/openssl/ssl.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/ssl2.h</code></td><td><code class="filename">/usr/include/openssl/ssl3.h</code></td><td><code class="filename">/usr/include/openssl/ssl23.h</code></td></tr><tr><td><code class="filename">/usr/include/openssl/tls1.h</code></td><td><code class="filename">/usr/include/openssl/rsaref.h</code></td><td><code class="filename">/usr/lib/libcrypto.a</code></td></tr><tr><td><code class="filename">/usr/lib/libssl.a</code></td><td><code class="filename">/usr/lib/libRSAglue.a</code></td><td><code class="filename">/usr/man/man1/CA.pl.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/asn1parse.1</code></td><td><code class="filename">/usr/man/man1/ca.1</code></td><td><code class="filename">/usr/man/man1/ciphers.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/crl.1</code></td><td><code class="filename">/usr/man/man1/crl2pkcs7.1</code></td><td><code class="filename">/usr/man/man1/dgst.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/dhparam.1</code></td><td><code class="filename">/usr/man/man1/dsa.1</code></td><td><code class="filename">/usr/man/man1/dsaparam.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/enc.1</code></td><td><code class="filename">/usr/man/man1/gendsa.1</code></td><td><code class="filename">/usr/man/man1/genrsa.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/nseq.1</code></td><td><code class="filename">/usr/man/man1/openssl.1</code></td><td><code class="filename">/usr/man/man1/pkcs12.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/pkcs7.1</code></td><td><code class="filename">/usr/man/man1/pkcs8.1</code></td><td><code class="filename">/usr/man/man1/req.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/rsa.1</code></td><td><code class="filename">/usr/man/man1/s_client.1</code></td><td><code class="filename">/usr/man/man1/s_server.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/sess_id.1</code></td><td><code class="filename">/usr/man/man1/smime.1</code></td><td><code class="filename">/usr/man/man1/speed.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/spkac.1</code></td><td><code class="filename">/usr/man/man1/verify.1</code></td><td><code class="filename">/usr/man/man1/version.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/x509.1</code></td><td><code class="filename">/usr/man/man3/BN_CTX_new.3</code></td><td><code class="filename">/usr/man/man3/BN_CTX_start.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/BN_add.3</code></td><td><code class="filename">/usr/man/man3/BN_add_word.3</code></td><td><code class="filename">/usr/man/man3/BN_bn2bin.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/BN_cmp.3</code></td><td><code class="filename">/usr/man/man3/BN_copy.3</code></td><td><code class="filename">/usr/man/man3/BN_generate_prime.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/BN_mod_inverse.3</code></td><td><code class="filename">/usr/man/man3/BN_mod_mul_montgomery.3</code></td><td><code class="filename">/usr/man/man3/BN_mod_mul_reciprocal.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/BN_new.3</code></td><td><code class="filename">/usr/man/man3/BN_num_bytes.3</code></td><td><code class="filename">/usr/man/man3/BN_rand.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/BN_set_bit.3</code></td><td><code class="filename">/usr/man/man3/BN_zero.3</code></td><td><code class="filename">/usr/man/man3/CRYPTO_set_ex_data.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/DH_generate_key.3</code></td><td><code class="filename">/usr/man/man3/DH_generate_parameters.3</code></td><td><code class="filename">/usr/man/man3/DH_get_ex_new_index.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/DH_new.3</code></td><td><code class="filename">/usr/man/man3/DH_set_method.3</code></td><td><code class="filename">/usr/man/man3/DH_size.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/DSA_SIG_new.3</code></td><td><code class="filename">/usr/man/man3/DSA_do_sign.3</code></td><td><code class="filename">/usr/man/man3/DSA_dup_DH.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/DSA_generate_key.3</code></td><td><code class="filename">/usr/man/man3/DSA_generate_parameters.3</code></td><td><code class="filename">/usr/man/man3/DSA_get_ex_new_index.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/DSA_new.3</code></td><td><code class="filename">/usr/man/man3/DSA_set_method.3</code></td><td><code class="filename">/usr/man/man3/DSA_sign.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/DSA_size.3</code></td><td><code class="filename">/usr/man/man3/ERR_GET_LIB.3</code></td><td><code class="filename">/usr/man/man3/ERR_clear_error.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ERR_error_string.3</code></td><td><code class="filename">/usr/man/man3/ERR_get_error.3</code></td><td><code class="filename">/usr/man/man3/ERR_load_crypto_strings.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ERR_load_strings.3</code></td><td><code class="filename">/usr/man/man3/ERR_print_errors.3</code></td><td><code class="filename">/usr/man/man3/ERR_put_error.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ERR_remove_state.3</code></td><td><code class="filename">/usr/man/man3/EVP_DigestInit.3</code></td><td><code class="filename">/usr/man/man3/EVP_EncryptInit.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/OPENSSL_VERSION_NUMBER.3</code></td><td><code class="filename">/usr/man/man3/OpenSSL_add_all_algorithms.3</code></td><td><code class="filename">/usr/man/man3/RAND_add.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/RAND_bytes.3</code></td><td><code class="filename">/usr/man/man3/RAND_cleanup.3</code></td><td><code class="filename">/usr/man/man3/RAND_egd.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/RAND_load_file.3</code></td><td><code class="filename">/usr/man/man3/RAND_set_rand_method.3</code></td><td><code class="filename">/usr/man/man3/RSA_blinding_on.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/RSA_check_key.3</code></td><td><code class="filename">/usr/man/man3/RSA_generate_key.3</code></td><td><code class="filename">/usr/man/man3/RSA_get_ex_new_index.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/RSA_new.3</code></td><td><code class="filename">/usr/man/man3/RSA_padding_add_PKCS1_type_1.3</code></td><td><code class="filename">/usr/man/man3/RSA_print.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/RSA_private_encrypt.3</code></td><td><code class="filename">/usr/man/man3/RSA_public_encrypt.3</code></td><td><code class="filename">/usr/man/man3/RSA_set_method.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/RSA_sign.3</code></td><td><code class="filename">/usr/man/man3/RSA_sign_ASN1_OCTET_STRING.3</code></td><td><code class="filename">/usr/man/man3/RSA_size.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/blowfish.3</code></td><td><code class="filename">/usr/man/man3/bn.3</code></td><td><code class="filename">/usr/man/man3/bn_internal.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/buffer.3</code></td><td><code class="filename">/usr/man/man3/crypto.3</code></td><td><code class="filename">/usr/man/man3/d2i_DHparams.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/d2i_RSAPublicKey.3</code></td><td><code class="filename">/usr/man/man3/dh.3</code></td><td><code class="filename">/usr/man/man3/dsa.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/err.3</code></td><td><code class="filename">/usr/man/man3/hmac.3</code></td><td><code class="filename">/usr/man/man3/lh_stats.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/lhash.3</code></td><td><code class="filename">/usr/man/man3/md5.3</code></td><td><code class="filename">/usr/man/man3/mdc2.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/rand.3</code></td><td><code class="filename">/usr/man/man3/rc4.3</code></td><td><code class="filename">/usr/man/man3/ripemd.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/rsa.3</code></td><td><code class="filename">/usr/man/man3/sha.3</code></td><td><code class="filename">/usr/man/man3/threads.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/SSL_get_error.3</code></td><td><code class="filename">/usr/man/man3/ssl.3</code></td><td><code class="filename">/usr/man/man5/config.5</code></td></tr><tr><td><code class="filename">/usr/man/man7/des_modes.7</code></td><td> </td><td> </td></tr></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="idm14399"></a>Chapter 25. Linux FreeS/WAN VPN</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#pr6ch25sc1fsw">1. IPSEC/VPN -FreeS/WAN</a></span></dt><dt><span class="section"><a href="#idm14485">2. Compile, insert FreeS/WAN into the kernel</a></span></dt><dt><span class="section"><a href="#idm14621">3. Reconfigure and install the kernel with FreeS/WAN VPN support</a></span></dt><dt><span class="section"><a href="#idm14699">4. Configure to optimise</a></span></dt><dt><span class="section"><a href="#idm14737">5. Automatic or Manual Key connections</a></span></dt><dt><span class="section"><a href="#idm14792">6. The <code class="filename">/etc/ipsec.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm14954">7. The <code class="filename">/etc/ipsec.secrets</code> file</a></span></dt><dt><span class="section"><a href="#idm15018">8. Configure <acronym class="acronym">RSA</acronym> private keys secrets</a></span></dt><dt><span class="section"><a href="#idm15198">9. Required network setup for IPSec</a></span></dt><dt><span class="section"><a href="#idm15370">10. Testing the installation</a></span></dt><dt><span class="section"><a href="#idm15416">11. Further documentation</a></span></dt><dt><span class="section"><a href="#idm15892">12. Installed files</a></span></dt></dl></div><div class="highlights"><p>
           Protection of client-to-server with <acronym class="acronym">SSL</acronym> solutions is an excellent choice but sometime for enterprise environments establishing secure communication channels, assuring full privacy, authenticity 
           and data integrity in between two firewalls over the Internet are vital. For this, <acronym class="acronym">IPSEC</acronym> has been created.
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch25sc1fsw"></a>1. IPSEC/VPN -FreeS/WAN</h2></div></div></div><p>
           <acronym class="acronym">IPSEC</acronym> is Internet Protocol SECurity. It uses strong cryptography to provide both authentication and encryption services. Authentication ensures that packets are from the right sender and have 
           not been altered in transit. Encryption prevents unauthorized reading of packet contents. <acronym class="acronym">IPSEC</acronym> can protect any protocol running above <acronym class="acronym">IP</acronym> and any medium used below 
           <acronym class="acronym">IP</acronym>. 
           </p><p>
           <acronym class="acronym">IPSEC</acronym> can also provide some security services <span class="emphasis"><em>in the background</em></span>, with no visible impact on users. More to the point, it can protect a mixture of protocols running over 
           a complex combination of media i.e. <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> etc. without having to change them in any ways, since the encryption occurs at the <acronym class="acronym">IP</acronym> level.
           </p><p>
           <acronym class="acronym">IPSEC</acronym> services allow you to build secure tunnels through untrusted networks. Everything passing through the untrusted net is encrypted by the <acronym class="acronym">IPSEC</acronym> gateway machine and decrypted 
           by the gateway at the other end. The result is Virtual Private Network or <acronym class="acronym">VPN</acronym>. This is a network, which is effectively private even though it includes machines at several different sites connected 
           by the insecure Internet.
           </p><div class="mediaobject"><img src="./images/FreeSWAN-Schema.gif" alt="FreeSWAN VPN"></div><p>
           </p><p>
           These installation instructions assume
           </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           Commands are Unix-compatible.
           </p></li><li class="listitem"><p>
           The source path is <code class="filename">/usr/src</code>
           </p></li><li class="listitem"><p>
           Installations were tested on Red Hat Linux 6.1 and 6.2.
           </p></li><li class="listitem"><p>
           All steps in the installation will happen in super-user account <code class="literal">root</code>
           </p></li><li class="listitem"><p>
           Kernel version number is 2.2.14
           </p></li><li class="listitem"><p>
           FreeS/WAN <acronym class="acronym">VPN</acronym> version number is 1.3
           </p></li></ul></div><p>
           </p><p>
           These are the Package(s) and available here
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
           Kernel Homepage: <a class="link" href="#prtinxfp23" title="IPSEC/VPN -FreeS/WAN">http://www.kernelnotes.org/</a>
           </td></tr><tr><td>
           You must be sure to download: linux-2_2_14_tar.gz
           </td></tr><tr><td>
           FreeS/WAN VPN Homepage Site: <a class="link" href="#prtinxfp23" title="IPSEC/VPN -FreeS/WAN">http://www.freeswan.org/</a>
           </td></tr><tr><td>
           FreeS/WAN VPN FTP Site: <a class="link" href="#prtinxfp23" title="IPSEC/VPN -FreeS/WAN">194.109.6.26</a>
           </td></tr><tr><td>
           You must be sure to download: freeswan-1.3.tar.gz
           </td></tr></table><p>
           </p><p>
           Before you decompress the tarballs, it is a good idea to make a list of files on the system before you install FreeS/WAN, and one afterwards, and then compare them using diff to find out what file it placed where. Simply 
           run <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Freeswan1</code></strong> before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Freeswan2</code></strong> after you install the software, and use 
           <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>Freeswan1 Freeswan2 &gt; Freeswan-Installed</code></strong> to get a list of what changed.
           </p><p>
           Some of the Prerequisites; the installation of <acronym class="acronym">IPSEC</acronym> FreeS/WAN Virtual Private Network software requires some modification of your original kernel since FreeS/WAN must be included and incorporated in 
           your kernel before you can use it. For this reason the first step in installing FreeS/WAN software is to go to the <a class="link" href="#pr3ch7lnke" title="Chapter 7. Configuring and Building a Secure, Optimized Kernel">Linux Kernel</a> section in this book and follow the instructions on how to 
           install the Linux Kernel on your system, <span class="emphasis"><em>even if you have already done this before</em></span> and come back to Linux FreeS/WAN VPN (this section) after you have executed the <span class="command"><strong>make dep</strong></span>; <span class="command"><strong>make clean</strong></span> 
           commands, but before the <span class="command"><strong>make bzImage</strong></span> command in the Linux Kernel section.
           </p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Caution.gif" alt="Caution"></span>
</h3><p>
           It is highly recommended that you not compile anything in the kernel with optimization flags if you intend to install the FreeSWAN software on your system. Any optimization flags added to the Linux kernel will produce errors messages in 
           the FreeSWAN <acronym class="acronym">IPSEC</acronym> software when it tries to run; this is an important warning you must note, or else nothing will work with  FreeSWAN. The optimization flags documented in <a class="link" href="#pr3ch7lnke" title="Chapter 7. Configuring and Building a Secure, Optimized Kernel">Configuring and Building a Secure, Optimized kernel </a>
           apply without any problems to all sections and chapters of this book with the single exception of the FreeSWAN <acronym class="acronym">IPSEC</acronym> software. Once again, I repeat, don't use or add any optimization options or flags into your Linux kernel when compiling 
           and patching it to support FreeSWAN.
           </p></div><p>
           To Compile FreeS/WAN you need to decompress the tarball (tar.gz).
           </p><pre class="screen">
           [root@deep] /# <span class="command"><strong>cp</strong></span> freeswan-version.tar.gz /usr/src/
           [root@deep] /# <span class="command"><strong>cd</strong></span> /usr/src
           [root@deep ]/src# <span class="command"><strong>tar</strong></span> xzpf freeswan-version.tar.gz
           [root@deep ]src# <span class="command"><strong>chown</strong></span> -R 0.0 /usr/src/freeswan-version
           </pre><p>
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm14485"></a>2. Compile, insert FreeS/WAN into the kernel</h2></div></div></div><p>
           You must modify the <code class="filename">Makefile</code> under the FreeS/WAN source directory and subdirectories named <code class="filename">utils</code>, <code class="filename">klips/utils</code>, <code class="filename">Pluto</code>, 
           and <code class="filename">lib</code> to specify installation paths. We must modify these files to be compliant with Red Hat's file system structure and install FreeS/WAN files under our <code class="envar">PATH</code> environment variable.
           </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
               Move to the top-level directory of the new FreeS/WAN distribution and type the following commands on your terminal:
               Edit the <code class="filename">Makefile</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">Makefile</code> and change the following lines:
               </p><ol type="a" class="substeps"><li class="step"><p>
                   </p><pre class="programlisting">
                     PUBDIR=/usr/local/sbin
                   </pre><p>
                   To read:
                   </p><pre class="programlisting">
                     PUBDIR=/usr/sbin
                   </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   PRIVDIR=/usr/local/lib/ipsec
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   PRIVDIR=/usr/lib/ipsec
                 </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   FINALPRIVDIR=/usr/local/lib/ipsec
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   FINALPRIVDIR=/usr/lib/ipsec
                 </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   MANTREE=/usr/local/man
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   MANTREE=/usr/man
                 </pre><p>
                 </p></li></ol></li><li class="step"><p>
               Edit the <code class="filename">Makefile</code> file of the subdirectory <code class="filename">utils</code>, <span class="command"><strong>vi</strong></span> <code class="filename">utils/Makefile</code> and change the following lines:
               </p><ol type="a" class="substeps"><li class="step"><p>
                 </p><pre class="programlisting">
                   PUBDIR=/usr/local/sbin
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   PUBDIR=/usr/sbin
                 </pre><p>
               </p></li><li class="step"><p>
               </p><pre class="programlisting">
                 PRIVDIR=/usr/local/lib/ipsec
               </pre><p>
               To read:
               </p><pre class="programlisting">
                 PRIVDIR=/usr/lib/ipsec
               </pre><p>
               </p></li><li class="step"><p>
               </p><pre class="programlisting">
                 FINALPRIVDIR=/usr/local/lib/ipsec
               </pre><p>
               To read:
               </p><pre class="programlisting">
                 FINALPRIVDIR=/usr/lib/ipsec
               </pre><p>
               </p></li><li class="step"><p>
               </p><pre class="programlisting">
                 MANTREE=/usr/local/man
               </pre><p>
               To read:
               </p><pre class="programlisting">
                 MANTREE=/usr/man
               </pre><p>
               </p></li></ol></li><li class="step"><p>
               Edit the <code class="filename">Makefile</code> file of the subdirectory <code class="filename">klips/utils</code>, <span class="command"><strong>vi</strong></span> <code class="filename">klips/utils/Makefile</code> and change the following lines:
               </p><ol type="a" class="substeps"><li class="step"><p>
                   </p><pre class="programlisting">
                     BINDIR=/usr/local/lib/ipsec
                   </pre><p>
                   To read:
                   </p><pre class="programlisting">
                     BINDIR=/usr/lib/ipsec
                   </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   MANTREE=/usr/local/man
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   MANTREE=/usr/man
                 </pre><p>
                 </p></li></ol></li><li class="step"><p>
               Edit the <code class="filename">Makefile</code> file of the subdirectory <code class="filename">pluto</code>, <span class="command"><strong>vi</strong></span> <code class="filename">pluto/Makefile</code> and change the following lines:
               </p><ol type="a" class="substeps"><li class="step"><p>
                   </p><pre class="programlisting">
                     BINDIR=/usr/local/lib/ipsec
                   </pre><p>
                   To read:
                   </p><pre class="programlisting">
                     BINDIR=/usr/lib/ipsec
                   </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   MANTREE=/usr/local/man
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   MANTREE=/usr/man
                 </pre><p>
                 </p></li></ol></li><li class="step"><p>
               Edit the <code class="filename">Makefile</code> file of the subdirectory <code class="filename">lib</code>, <span class="command"><strong>vi</strong></span> <code class="filename">lib/Makefile</code> and change the following lines:
               </p><pre class="programlisting">
                 MANTREE=/usr/local/man
               </pre><p>
               To read:
               </p><pre class="programlisting">
                 MANTREE=/usr/man
               </pre><p>
             </p></li><li class="step"><p>
               Edit the <code class="filename">Makefile</code> file of the subdirectory <code class="filename">libdes</code>, <span class="command"><strong>vi</strong></span> <code class="filename">libdes/Makefile</code> and change the following lines:
               </p><ol type="a" class="substeps"><li class="step"><p>
                   </p><pre class="programlisting">
                     LIBDIR=/usr/local/lib
                   </pre><p>
                   To read:
                   </p><pre class="programlisting">
                     LIBDIR=/usr/lib
                   </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   BINDIR=/usr/local/bin
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   BINDIR=/usr/bin
                 </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   INCDIR=/usr/local/include
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   INCDIR=/usr/include
                 </pre><p>
                 </p></li><li class="step"><p>
                 </p><pre class="programlisting">
                   MANDIR=/usr/local/man
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   MANDIR=/usr/man
                 </pre><p>
                 The above changes, from step1 to step 6, will locate all files related to the FreeS/WAN software to the destination target directories we have chosen in order to be compliant with the Red Hat file system structure.
                 </p></li></ol></li></ol></div><p>
             Now, we must compile and install FreeSWAN on the server:
             </p><pre class="screen">
               [root@deep ]/freeswan-1.3#  <span class="command"><strong>make insert</strong></span>
               [root@deep ]/freeswan-1.3#  <span class="command"><strong>make programs</strong></span>
               [root@deep ]/freeswan-1.3#  <span class="command"><strong>make install</strong></span>
             </pre><p>
             </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                 The <span class="command"><strong>make insert</strong></span> command creates a symbolic link <code class="filename">/usr/src/linux/net/ipsec</code>, pointing to the <acronym class="acronym">KLIPS</acronym> source directory. It patches some kernel files, where 
                 necessary, to know about <acronym class="acronym">KLIPS</acronym> and/or to fix bugs. It also adds its default configuration to the kernel configuration file, and finally, it makes the <acronym class="acronym">KLIPS</acronym> communication file, <code class="filename">/dev/ipsec</code>, 
                 if it's not already there.
               </p></li><li class="listitem"><p>
               The <span class="command"><strong>make programs</strong></span> command builds the libraries, Pluto, and various user-level utilities. 
               </p></li><li class="listitem"><p>
               The <span class="command"><strong>make install</strong></span> will install the Pluto daemon and user-level utilities, and set things up for boot-time startup.
               </p></li></ul></div><p>
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm14621"></a>3. Reconfigure and install the kernel with FreeS/WAN VPN support</h2></div></div></div><p>
Now, we must return to the <code class="filename">/usr/src/linux</code> directory and execute the following commands to reconfigure the kernel with FreeS/WAN support enable:
</p><pre class="screen">
[root@deep ]/freeswan-1.3#  <span class="command"><strong>cd</strong></span> /usr/src/linux
[root@deep ]/linux#  <span class="command"><strong>make config</strong></span>
</pre><p>
</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
The difference with the <span class="command"><strong>make config</strong></span> command we used before is that now a new section related to FreeS/WAN has been included in our kernel configuration, and for this reason we must reconfigure the kernel to customize 
the IPSec options to be part of your kernel.
</p></div><p>  
The first thing you need to do is ensure that your kernel has been built with FreeS/WAN support enabled. In the 2.2.14 kernel version, a new section related to frees/WAN VPN support named <code class="envar">IPSec options (FreeS/WAN)</code> 
should appear in your kernel configuration after you have patched the kernel with the FreeS/WAN program as descibed above. You need ensure that you have answered <strong class="userinput"><code>Y</code></strong> to the following questions under the 
new section: <code class="envar">IPSec options (FreeS/WAN).</code>
</p><pre class="programlisting">
IPSec options (FreeS/WAN)
IP Security Protocol (FreeS/WAN IPSEC) (CONFIG_IPSEC) <code class="literal">[<span class="optional">Y/n/?</span>]</code>
IPSEC: IP-in-IP encapsulation (CONFIG_IPSEC_IPIP) <code class="literal">[<span class="optional">Y/n/?</span>]</code>
IPSEC: PF_KEYv2 kernel/user interface (CONFIG_IPSEC_PFKEYv2) <code class="literal">[<span class="optional">Y/n/?</span>]</code>
IPSEC: Enable ICMP PMTU messages (CONFIG_IPSEC_ICMP) <code class="literal">[<span class="optional">Y/n/?</span>]</code>
IPSEC: Authentication Header (CONFIG_IPSEC_AH) <code class="literal">[<span class="optional">Y/n/?</span>]</code>
HMAC-MD5 authentication algorithm (CONFIG_IPSEC_AUTH_HMAC_MD5) <code class="literal">[<span class="optional">Y/n/?</span>]</code>
HMAC-SHA1 authentication algorithm (CONFIG_IPSEC_AUTH_HMAC_SHA1) <code class="literal">[<span class="optional">Y/n/?</span>]</code>
IPSEC: Encapsulating Security Payload (CONFIG_IPSEC_ESP) <code class="literal">[<span class="optional">Y/n/?</span>]</code>
3DES encryption algorithm (CONFIG_IPSEC_ENC_3DES) <code class="literal">[<span class="optional">Y/n/?</span>]</code>
IPSEC Debugging Option (DEBUG_IPSEC) <code class="literal">[<span class="optional">Y/n/?</span>]</code>
</pre><p>
</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
All the customizations you made to your kernel the first time you ran the <span class="command"><strong>make config</strong></span>, <span class="command"><strong>make dep</strong></span>, and <span class="command"><strong>make clean</strong></span> commands will be preserved, so you don't need to 
reconfigure every part of your kernel; Just the new section added by FreeS/WAN named <code class="envar">IPSec options (FreeS/WAN)</code> is required, as shown above.
</p></div><p>
Some networking options will get turned on automatically, even if you previously turned them off, this is because IPSEC needs them. Whichever configuration program you are using, you should pay careful attention to a few issues. 
In particular, <span class="emphasis"><em>do not disable any of the following under the</em></span> <code class="envar">Networking Options</code> <span class="emphasis"><em>of your kernel configuration</em></span>:
</p><pre class="programlisting">
Kernel/User netlink socket (CONFIG_NETLINK) <code class="literal">[<span class="optional">Y/n/?</span>]</code>
Netlink device emulation (CONFIG_NETLINK_DEV) <code class="literal">[<span class="optional">Y/n/?</span>]</code>
</pre><p>
</p><p>
You need to Compile and install the new kernel with FreeS/WAN, now that we have included in the kernel the support for FreeS/WAN VPN, 
Return to the <code class="filename">/usr/src/linux</code> directory and run the following commands again:
</p><pre class="screen">
[root@deep ]/linux#  <span class="command"><strong>make dep</strong></span>; <span class="command"><strong>make clean</strong></span>; <span class="command"><strong>make bzImage</strong></span>
</pre><p>
</p><p>
After execution of the commands above, follow the rest of the instructions in the Linux Kernel section of this book  <a class="link" href="#pr3ch7lnke" title="Chapter 7. Configuring and Building a Secure, Optimized Kernel">Configuring and Building a secure, optimized Kernel</a> as normal to install the kernel. At 
this point, after you have copied and installed your new kernel image, system.map, or modules, if necessary and set the lilo.conf file to load the new kernel, you must edit and customize the configuration files related to 
FreeS/WAN <code class="filename">ipsec.conf</code> and <code class="filename">ipsec.secrets</code> before rebooting your system.
</p><p>
Please don't forget to cleanup later:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /usr/src
[root@deep ]/src# <span class="command"><strong>rm</strong></span> -rf freeswan-version/ freeswan-version.tar.gz
</pre><p>
The <span class="command"><strong>rm</strong></span> command will remove all the source files we have used to compile and install FreeS/WAN. It will also remove the FreeS/WAN compressed archive from the <code class="filename">/usr/src</code> directory.
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm14699"></a>4. Configure to optimise</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
    You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
    for respective software. For example <em class="wordasword">FreeSWAN</em> configuration file are organised like this:
    </p><pre class="literallayout"><code class="computeroutput">
    total 8
    -rw-r--r--    1 harrypotter    harrypotter         998 Jun  8 13:00 ipsec.conf
    -rw-------    1 harrypotter    harrypotter        1838 Jun  8 13:00 ipsec.secrets
    </code></pre><p>
    You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
    responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
  </p></div><p>
To run FreeSWAN, the following files are required and must be created or copied to the appropriate directories on your server.
</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
Copy the <code class="filename">ipsec.conf</code> file to the <code class="filename">/etc/</code> directory.
</p></li><li class="listitem"><p>
Copy the <code class="filename">ipsec.secrets</code> file to the <code class="filename">/etc/</code> directory.
</p></li></ol></div><p>
</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
You can obtain the configuration files listed below on our <code class="filename">floppy.tgz</code> archive. Copy the following files from the decompressed <code class="filename">floppy.tgz</code> archive to the appropriate places or copy and paste them directly from this book to the concerned file.
</p></div><p>
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm14737"></a>5. Automatic or Manual Key connections</h2></div></div></div><p>
The configuration file for FreeS/WAN <code class="filename">/etc/ipsec.conf</code> allows you to configure your <acronym class="acronym">IPSEC</acronym> configurations, control information and connections types. <acronym class="acronym">IPSEC</acronym> currently 
supports two types of connections: 
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Manually keyed </span></dt><dd><p>
 Manually keyed connections use keys stored in the <code class="filename">/etc/ipsec.conf</code> file. This type of connection is less secure then automatically keyed. 
 </p></dd><dt><span class="term">Automatically keyed. </span></dt><dd><p>
Automatically keyed connections use keys automatically generated by the Pluto key negotiation daemon. The key negotiation protocol, used by default and named IKE, authenticates the other system using shared secrets stored in <code class="filename">/etc/ipsec.secrets</code> file. 

</p></dd></dl></div><p>
The difference is strictly in how they are keyed. For these reasons, we will use and show you the automatically keyed connection that is more secure then the manually keyed connection. <span class="emphasis"><em>Once again, it is highly recommended that 
you use the automatically keyed connection</em></span>.
</p><p>
In our example configuration below, we configure a sample tunnel with a firewall-penetrating tunnel, and we assume that firewalling is being done on the left and right side. We choose to show you this configuration 
since we assume it is what most users and companies will use. Also, it allows us to play with more options in the configuration file <code class="filename">ipsec.conf</code> for automatically keyed connections. Different 
configurations exist and you may consult the <code class="filename">doc/examples</code> file under the subdirectory <code class="filename">doc</code> of the frees/WAN source directory for more information and other 
possible configurations.
</p><pre class="programlisting">
SubnetDeep======Deep------Deepgate..........Mailgate-------Mail======SubnetMail
                                       Untrusted net

leftsubnet = SubnetDeep (192.168.1.0/24)
left = Deep (deep.openna.com)
leftnexthop = Deepgate (the first router in the direction or ISP router for deep.openna.com)
Internet = Untrusted net
rightnexthop = Mailgate (the first router in the direction or ISP router for mail.openna.com)
right = Mail (mail.openna.com)
rightsubnet = SubnetMail (192.168.1.0/24)
</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
    </p><div class="literallayout"><p><br>
       SubnetDeep<br>
  \ 192.168.1.0/24 /<br>
  +--------------------+<br>
                |<br>
</p></div><p>            
SubnetDeep is the <acronym class="acronym">IP</acronym> network address of your private internal network on the first gateway. eth1 is attached to the internal network.        
        </p></li><li class="listitem"><p>
  </p><div class="literallayout"><p><br>
            Deep<br>
   \ 208.164.186.1 /<br>
   +-------------------+<br>
                |<br>
</p></div><p>
Deep is the <acronym class="acronym">IP</acronym> address of your first Gateway. eth0 is attached to the Internet.
</p></li><li class="listitem"><p>
  </p><div class="literallayout"><p><br>
         Deepgate<br>
 \ 205.151.222.250 /<br>
 +----------------------+<br>
                |<br>
<br>
</p></div><p>
Deepgate is the <acronym class="acronym">IP</acronym> address of the first router in the direction of your second gateway <code class="literal">mail.openna.com</code> or your <acronym class="acronym">ISP</acronym> router.
</p></li><li class="listitem"><p>
  </p><div class="literallayout"><p><br>
 I  N  T  E  R  N  E  T<br>
                |<br>
<br>
</p></div><p>
INTERNET is the untrusted network.
</p></li><li class="listitem"><p>
  </p><div class="literallayout"><p><br>
          Mailgate<br>
 / 205.151.222.251 \<br>
+------------------------+<br>
                |<br>
</p></div><p>
Mailgate is the <acronym class="acronym">IP</acronym> address of the first router in the direction of your first gateway <code class="literal">deep.openna.com</code> or your <acronym class="acronym">ISP</acronym> router.
</p></li><li class="listitem"><p>
  </p><div class="literallayout"><p><br>
             Mail<br>
   / 208.164.186.2 \<br>
  +---------------------+<br>
                |<br>
<br>
</p></div><p> 
Mail is the <acronym class="acronym">IP</acronym> address of your second Gateway. eth0 is attached to the Internet.
</p></li><li class="listitem"><p>
  </p><div class="literallayout"><p><br>
       SubnetMail<br>
  / 192.168.1.0/24 \<br>
 +----------------------+<br>
</p></div><p>
SubnetMail is the <acronym class="acronym">IP</acronym> network address of your private internal network on the second gateway. eth1 is attached to the internal network.
</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm14792"></a>6. The <code class="filename">/etc/ipsec.conf</code> file</h2></div></div></div><p>
We must edit the <code class="filename">ipsec.conf</code> file <span class="command"><strong>vi</strong></span> <code class="filename">/etc/ipsec.conf</code> and change the default values to fit our specifications for <acronym class="acronym">IPSEC</acronym> configuration 
and communication. Currently there are two types of section in this file <code class="filename">/etc/ipsec.conf</code>:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
A <code class="literal">config</code> section which specifies general configuration information for <acronym class="acronym">IPSEC</acronym>, 
</p></li><li class="listitem"><p>
A <code class="literal">conn</code> section which specifies an <acronym class="acronym">IPSEC</acronym> connection. Its contents are not security-sensitive unless manual keying is being done, <span class="emphasis"><em>recall, manual keying is not recommended for security reasons</em></span>.
</p></li></ol></div><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
The first section type, called <code class="literal">config</code> setup, is the only config section known to the <acronym class="acronym">IPSEC</acronym> software containing overall setup parameters for <acronym class="acronym">IPSEC</acronym> that apply to all connections, and information 
used when the software is being started.
</p></li><li class="listitem"><p>
The second type, called <code class="literal">conn</code>, contains a connection specification defining a network connection to be made using <acronym class="acronym">IPSEC</acronym>. The name it is given is arbitrary, and is simply used to identify 
the connection to <span class="citerefentry"><span class="refentrytitle">ipsec_auto</span>(8)</span> and <span class="citerefentry"><span class="refentrytitle">ipsec_manual</span>(8)</span>.
</p></li></ul></div><p>
</p><pre class="programlisting">
# /etc/ipsec.conf - FreeS/WAN <acronym class="acronym">IPSEC</acronym> configuration file

# More elaborate and more varied sample configurations can be found
# in doc/examples.

# basic configuration
config setup
        interfaces="ipsec0=eth0"
        klipsdebug=none
        plutodebug=none
        plutoload=%search
        plutostart=%search

# sample connection
conn deep-mail
        left=208.164.186.1
        leftsubnet=192.168.1.0/24
        leftnexthop=205.151.222.250
        right=208.164.186.2
        rightsubnet=192.168.1.0/24
        rightnexthop=205.151.222.251
        keyingtries=0
        auth=ah
        auto=start
        </pre><p>
</p><p>             
This tells <code class="filename">ipsec.conf</code> file to set itself up for this particular configuration setup with:
</p><div class="glosslist"><dl><dt><span class="glossterm">interfaces="<code class="literal">ipsec0</code>=<code class="literal">eth0</code>"</span></dt><dd class="glossdef"><p>
This option specifies which appropriate virtual and physical interfaces for <acronym class="acronym">IPSEC</acronym> to use. The default setting, <code class="envar">interfaces=%defaultroute</code>, will look for your default connection 
to the Internet, or your corporate network. Also, you can name one or more specific interfaces to be used by FreeS/WAN. For example:
</p></dd><dt><span class="glossterm">interfaces="<code class="literal">ipsec0</code>=<code class="literal">eth0</code>"
interfaces="<code class="literal">ipsec0</code>=<code class="literal">eth0</code> ipsec1=ppp0"</span></dt><dd class="glossdef"><p>
Both set the <code class="literal">eth0</code> interface as <code class="literal">ipsec0</code>. The second one, however, also supports <acronym class="acronym">IPSEC</acronym> over a <acronym class="acronym">PPP</acronym> interface. If the default setting <code class="envar">interfaces=%defaultroute</code> 
is not used, then the specified interfaces will be the only ones this gateway machine can use to communicate with other <acronym class="acronym">IPSEC</acronym> gateways.
</p></dd><dt><span class="glossterm">klipsdebug=none</span></dt><dd class="glossdef"><p>
This option specifies the debugging output for <acronym class="acronym">KLIPS</acronym> -the kernel <acronym class="acronym">IPSEC</acronym> code. The default value none, means no debugging output and the value all means full output.
</p></dd><dt><span class="glossterm">plutodebug=none</span></dt><dd class="glossdef"><p>
This option specifies the debugging output for the Pluto key. The default value, none, means no debugging output, and the value all means full output.
</p></dd><dt><span class="glossterm">plutoload=%search</span></dt><dd class="glossdef"><p>
This option specifies which connections (by name) to load automatically into memory when Pluto starts. The default is none and the value %search loads all connections with auto=add or auto=start.
</p></dd><dt><span class="glossterm">plutostart=%search</span></dt><dd class="glossdef"><p>
This option specifies which connections (by name) to automatically negotiate when Pluto starts. The default is none and the value %search starts all connections with auto=start.
</p></dd><dt><span class="glossterm">conn deep-mail</span></dt><dd class="glossdef"><p>
This option specifies the name given to identify the connection specification to be made using <acronym class="acronym">IPSEC</acronym>. It's a good convention to name connections by their ends to avoid mistakes. For example, the link 
between <code class="literal">deep.openna.com</code> and <code class="literal">mail.openna.com</code> gateways server can be named  <code class="literal">deep-mail</code>, or the link between your Montreal and Paris offices, <code class="literal">montreal-paris</code>.
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
    <span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span>
  </h3><p>
Note that the names <code class="literal">deep-mail</code> or whatever you have chosen should be the same in the <code class="filename">ipsec.conf</code> file on both gateways. In other words, the only change you should make in 
the <code class="filename">/etc/ipsec.conf</code> file on the second gateway is changing the <code class="envar">interfaces=</code> line to match the interface the second gateway uses for <acronym class="acronym">IPSEC</acronym> connection, if, 
of course, it's different from the first gateway. For example, if the interface <code class="literal">eth0</code> is used on the both gateways for <acronym class="acronym">IPSEC</acronym> communication, you don't need to change the line <code class="envar">interfaces=</code> 
on the second gateway. On the other hand, if the first gateway use <code class="literal">eth0</code> and the second use eth1, you must change the line <code class="envar">interfaces=</code> on the second gateway to match the interface eth1.
</p></div><p>
</p></dd><dt><span class="glossterm">left=208.164.186.1</span></dt><dd class="glossdef"><p>
This option specifies the <acronym class="acronym">IP</acronym> address of the gateway's external interface used to talk to the other gateway.
</p></dd><dt><span class="glossterm">leftsubnet=192.168.1.0/24</span></dt><dd class="glossdef"><p>
This option specifies the <acronym class="acronym">IP</acronym> network or address of the private subnet behind the gateway.
</p></dd><dt><span class="glossterm">leftnexthop=205.151.222.250</span></dt><dd class="glossdef"><p>
This option specifies the <acronym class="acronym">IP</acronym> address of the first router in the appropriate direction or <acronym class="acronym">ISP</acronym> router.
</p></dd><dt><span class="glossterm">right=208.164.186.2</span></dt><dd class="glossdef"><p>
This is the same explanation as <code class="envar">left=</code> but for the right destination.
</p></dd><dt><span class="glossterm">rightsubnet=192.168.1.0/24</span></dt><dd class="glossdef"><p>
This is the same explanation as <code class="envar">leftsubnet=</code> but for the right destination.
</p></dd><dt><span class="glossterm">rightnexthop=205.151.222.251</span></dt><dd class="glossdef"><p>
This is the same explanation as <code class="envar">leftnexthop=</code> but for the right destination.
</p></dd><dt><span class="glossterm">keyingtries=0</span></dt><dd class="glossdef"><p>
This option specifies how many attempts (an integer) should be made in (re)keying negotiations. The default value 0 (retry forever) is recommended.
</p></dd><dt><span class="glossterm">auth=ah</span></dt><dd class="glossdef"><p>
This option specifies whether authentication should be done separately using AH (Authentication Header), or be included as part of the <acronym class="acronym">ESP</acronym> -Encapsulated Security Payload service. This is preferable when the <acronym class="acronym">IP</acronym> headers are exposed to prevent 
man-in-the-middle attacks.
</p></dd><dt><span class="glossterm">auto=start</span></dt><dd class="glossdef"><p>
This option specifies whether automatic startup operations should be done at <acronym class="acronym">IPSEC</acronym> startup.
</p></dd></dl></div><p>
</p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Caution.gif" alt="Caution"></span>
</h3><p>
A data mismatch anywhere in this configuration <code class="filename">ipsec.conf</code> will cause FreeS/WAN to fail and to log various error messages.
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm14954"></a>7. The <code class="filename">/etc/ipsec.secrets</code> file</h2></div></div></div><p>
The file <code class="filename">ipsec.secrets</code> stores the secrets used by the pluto daemon to authenticate communication between both gateways. Two different kinds of secrets can be configured in this file, which 
are preshared secrets and <acronym class="acronym">RSA</acronym> private keys. You must check the modes and permissions of this file to be sure that the super-user <code class="literal">root</code> owns the file, and its permissions are set to block all 
access by others.
 </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
An example secret is supplied in the <code class="filename">ipsec.secrets</code> file by default. You should change it by creating your own. With automatic keying you may have a shared secret up to 256 bits, which is 
then used during the key exchanges to make sure a man in the middle attack does not occur.
To create a new shared secret, use the following commands:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>ipsec</strong></span> ranbits 256  &gt; temp
</pre><p>
New, random keys are created with the ranbits(8) utility in the file named <code class="filename">temp.</code> The ranbits utility may pause for a few seconds if not enough entropy is available immediately.
</p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">  
<span class="inlinemediaobject"><img src="./images/Caution.gif" alt="Caution"></span>
</h3><p>
Dont forget to delete the temporary file as soon as you are done with it.
</p></div><p>
</p></li><li class="step"><p>
Now that our new shared secret key has been created in the <code class="filename">temp</code> file, we must put it in the <code class="filename">/etc/ipsec.secrets</code> file. When editing the <code class="filename">ipsec.secrets</code> 
file, you should see something like the following appearing in your text editor. Each line has the <acronym class="acronym">IP</acronym> addresses of the two gateways plus the secret. It should look something like this:
</p><pre class="programlisting">
# This file holds shared secrets which are currently the only inter-Pluto
# authentication mechanism.  See ipsec_pluto(8) manpage.  Each secret is
# (oversimplifying slightly) for one pair of negotiating hosts.

# The shared secrets are arbitrary character strings and should be both
# long and hard to guess.

# Note that all secrets must now be enclosed in quotes, even if they have
# no white space inside them.

10.0.0.1 11.0.0.1         "jxVS1kVUTTulkVRRTnTujSm444jRuU1mlkklku2nkW3nnVu
V2WjjRRnulmlkmU1Run5VSnnRT"

</pre><p>
</p><ol type="a" class="substeps"><li class="step"><p>
Edit the ipsec.secrets file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/ipsec.secrets</code> and change the default secrets keys:
</p><pre class="programlisting">
10.0.0.1 11.0.0.1  " jxVS1kVUTTulkVRRTnTujSm444jRuU1mlkklku2nkW3nnVu
V2WjjRRnulmlkmU1Run5VSnnRT "
</pre><p>
To read:
</p><pre class="programlisting">
208.164.186.1 208.164.186.2 "0x9748cc31_2e99194f_d230589b_cd846b57_dc070b01_74b66f34_19c40a1a_804906ed"
</pre><p>

Where <code class="literal">208.164.186.1</code> and <code class="literal">208.164.186.2</code> are the <acronym class="acronym">IP</acronym> addresses of the two gateways and <code class="literal">"0x9748cc31_2e99194f_d230589b_cd846b57_dc070b01_74b66f34_19c40a1a_804906ed"</code> 
<span class="emphasis"><em>note that the quotes are required</em></span> is the shared secret we have generated above with the command <strong class="userinput"><code>ipsec ranbits 256 &gt; temp</code></strong> in the <code class="filename">temp</code> file.
</p></li></ol></li><li class="step"><p>
The files <code class="filename">ipsec.conf</code> and <code class="filename">ipsec.secrets</code> must be copied to the second gateway machine so as to be identical on both ends. The only exception to this is the <code class="filename">ipsec.conf</code> file, which 
must have in it a section labeled by the line config setup with the correct interface settings for the second gateway, if they differ from the first. The <code class="filename">ipsec.secrets</code> file, contrary to the <acronym class="acronym">RSA</acronym> private key, 
should absolutely have the same-shared secrets on the two gateways.
</p></li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
The file <code class="filename">/etc/ipsec.secrets</code> should have permissions <code class="literal">rw------- </code>(600) and be owned by the super-user <code class="literal">root.</code> The file <code class="filename">/etc/ipsec.conf</code> is installed 
with permissions <code class="filename">rw-r--r</code> (644) and must be owned also by <code class="literal">root.</code>
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm15018"></a>8. Configure <acronym class="acronym">RSA</acronym> private keys secrets</h2></div></div></div><p>
Recall that currently with FreeSWAN software there are two kinds of secrets: 
</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
preshared secrets 
</p></li><li class="listitem"><p>
<acronym class="acronym">RSA</acronym> private keys. 
</p></li></ol></div><p>
The preshared secrets are what we have configured in our <code class="filename">ipsec.conf</code> and <code class="filename">ipsec.secrets</code> example, above. Some people may prefer to use <acronym class="acronym">RSA</acronym> private keys for authentication 
by the Pluto daemon of the other hosts. If you are in this situation, you will have to make some minor modifications to your <code class="filename">ipsec.conf</code> and <code class="filename">ipsec.secrets</code> files as described in the following steps:
</p><p>
You need to create a separate <acronym class="acronym">RSA</acronym> key for *each* gateway. Each one gets its private key in its own <code class="filename">ipsec.secrets</code> file, and the public keys go in <code class="filename">leftrsasigkey</code> 
and <code class="filename">rightrsasigkey</code> parameters in the conn description of <code class="filename">ipsec.conf</code> file, which goes to both.
</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
Create a separate <acronym class="acronym">RSA</acronym> key for *each* gateway:
</p><ol type="a" class="substeps"><li class="step"><p>
On the first gateway i.e. <code class="literal">deep</code>, use the following commands:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /
[root@deep] /# <span class="command"><strong>ipsec</strong></span> rsasigkey --verbose 1024 &gt; deep-keys
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
computing primes and modulus...
getting 64 random bytes from /dev/random
looking for a prime starting there
found it after 30 tries
getting 64 random bytes from /dev/random
looking for a prime starting there
found it after 230 tries
swapping primes so p is the larger
computing (p-1)*(q-1)...
computing d...
computing exp1, exp1, coeff...
output...
</code></pre><p>
</p></li><li class="step"><p>
On the second gateway i.e. <code class="literal">mail</code>, use the following commands:
</p><pre class="screen">
[root@mail /]# <span class="command"><strong>cd</strong></span> /
[root@mail /]# <span class="command"><strong>ipsec</strong></span> rsasigkey --verbose 1024 &gt; mail-keys
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
computing primes and modulus...
getting 64 random bytes from /dev/random
looking for a prime starting there
found it after 30 tries
getting 64 random bytes from /dev/random
looking for a prime starting there
found it after 230 tries
swapping primes so p is the larger
computing (p-1)*(q-1)...
computing d...
computing exp1, exp1, coeff...
output...
</code></pre><p>
The rsasigkey utility generates an <acronym class="acronym">RSA</acronym> public and private key pair of a 1024-bit signature, and puts it in the file <code class="filename">deep-keys</code>. <code class="filename">mail-keys</code> for the second command on the 
second gateway. The private key can be inserted verbatim into the <code class="filename">ipsec.secrets</code> file, and the public key into the <code class="filename">ipsec.conf</code> file.
</p></li></ol></li><li class="step"><p>
</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
The rsasigkey utility may pause for a few seconds if not enough entropy is available immediately. You may want to give it some bogus activity such as random mouse movements. The temporary <acronym class="acronym">RSA</acronym>.
<code class="filename">deep-keys</code> and <code class="filename">mail-keys</code> files should be deleted as soon as you are done with it. <span class="emphasis"><em>Don't forget to delete the <code class="filename">deep-keys</code> and <code class="filename">mail-keys</code> <acronym class="acronym">RSA</acronym> files</em></span>.
</p></div><p>
</p></li><li class="step"><p>
Modify your <code class="filename">/etc/ipsec.conf</code> files to use <acronym class="acronym">RSA</acronym> public keys in *each* gateway:
</p><ol type="a" class="substeps"><li class="step"><p>
Edit you original <code class="filename">ipsec.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/ipsec.conf</code> and add the following parameters related to <acronym class="acronym">RSA</acronym> in the conn desciption of your <code class="filename">ipsec.conf</code> file on both gateway:

</p><pre class="programlisting">
# sample connection
conn deep-mail
        left=208.164.186.1
        leftsubnet=192.168.1.0/24
        leftnexthop=205.151.222.250
        right=208.164.186.2
        rightsubnet=192.168.1.0/24
        rightnexthop=205.151.222.251
        keyingtries=0
        auth=ah
        authby=rsasig                              <a name="atfsw"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
        leftrsasigkey=&lt;Public key of deep&gt;   <a name="lskfsw"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
        rightrsasigkey=&lt;Public key of mail&gt;  <a name="rskfsw"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
        auto=start
</pre><p>
</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#atfsw"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
This parameter specifies how the two security gateways should authenticate each other. The default value is secret for shared secrets. We must specify rsasig for <acronym class="acronym">RSA</acronym> since we have decided to use <acronym class="acronym">RSA</acronym> digital signatures.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#lskfsw"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
This parameter specifies the left participant's public key for <acronym class="acronym">RSA</acronym> signature authentication. In our example, left is 208.164.186.1, and represents deep.openna.com, so we must put the <acronym class="acronym">RSA</acronym> public key for deep on this line.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#rskfsw"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>
This parameter specifies the right participant's public key for <acronym class="acronym">RSA</acronym> signature authentication. In our example, right is 208.164.186.2, and represents mail.openna.com, so we must put the <acronym class="acronym">RSA</acronym> public key of mail on this line.
</p></td></tr></table></div><p>
</p></li><li class="step"><p>
You can retrieve the public key of deep in the <acronym class="acronym">RSA</acronym> key file called <code class="filename">deep-keys,</code> and the public key of mail in the <acronym class="acronym">RSA</acronym> key file named <code class="filename">mail-keys,</code> that 
we have created in above step. These files will look like this:

<acronym class="acronym">RSA</acronym> keys for gateway deep (deep-keys):
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /
[root@deep] /# <span class="command"><strong>vi</strong></span> deep-keys
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
	# 1024 bits, Fri Feb  4 05:05:19 2000
	# for signatures only, UNSAFE FOR ENCRYPTION
	#pubkey=0x010395daee1be05f3038ae529ef2668afd79f5ff1b16203c9ceaef801cea9cb74bcfb51a6ecc08890d3eb4b5470c0fc35465c8ba2ce9d1145ff07b5427e04cf4a38ef98a7f29edcb4d7689f2da7a69199e4318b4c8d0ea25d33e4f084186a2a54f4b4cec12cca1a5deac3b19d561c16a76bab772888f1fd71aa08f08502a141b611f
	Modulus: 0x95daee1be05f3038ae529ef2668afd79f5ff1b16203c9ceaef801cea9cb74bcfb51a6ecc08890d3eb4b5470c0fc35465c8ba2ce9d1145ff07b5427e04cf4a38ef98a7f29edcb4d7689f2da7a69199e4318b4c8d0ea25d33e4f084186a2a54f4b4cec12cca1a5deac3b19d561c16a76bab772888f1fd71aa08f08502a141b611f
	PublicExponent: 0x03
	# everything after this point is secret
	PrivateExponent: 0x63e74967eaea2025c98c69f6ef0753a6a3ff6764157dbdf1f50013471324dd352366f48805b0b37f232384b2b52ce2ee85d173468b62eaa052381a9588a317b3a1324d01a531a41fa7add6c5efbdd88f4718feed2bc0246be924e81bb90f03e49ceedf7af0dd48f06f265b519600bd082c6e6bd27eaa71cc0288df1ecc3b062b
	Prime1: 0xc5b471a88b025dd09d4bd7b61840f20d182d9b75bb7c11eb4bd78312209e3aee7ebfe632304db6df5e211d21af7fee79c5d45546bea3ccc7b744254f6f0b847f
	Prime2: 0xc20a99feeafe79767122409b693be75f15e1aef76d098ab12579624aec708e85e2c5dd62080c3a64363f2f45b0e96cb4aef8918ca333a326d3f6dc2c72b75361
	Exponent1: 0x83cda11b0756e935be328fcebad5f6b36573bcf927a80bf2328facb6c0697c9eff2a9976cade79ea3ec0be1674fff4512e8d8e2f29c2888524d818df9f5d02ff
	Exponent2: 0x815c66a9f1fefba44b6c2b124627ef94b9411f4f9e065c7618fb96dc9da05f03ec83e8ec055d7c42ced4ca2e75f0f3231f5061086ccd176f37f9e81da1cf8ceb
	Coefficient: 0x10d954c9e2b8d11f4db1b233ef37ff0a3cecfffad89ba5d515449b007803f577e3bd7f0183ceddfd805466d62f767f3f5a5731a73875d30186520f1753a7e325
</code></pre><p>
</p></li><li class="step"><p>
<acronym class="acronym">RSA</acronym> keys for gateway mail -<code class="filename">mail-keys</code>:
</p><pre class="screen">
[root@mail /]# <span class="command"><strong>cd</strong></span> /
[root@mail /]# <span class="command"><strong>vi</strong></span> mail-keys
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
	# 1024 bits, Fri Feb  4 04:46:59 2000
	# for signatures only, UNSAFE FOR ENCRYPTION
	#pubkey=0x01037631b81f00d5e6f888c542d44dbb784cd3646f084ed96f942d341c7c4686cbd405b805dc728f8697475f11e8b1dd797550153a3f0d4ff0f2b274b70a2ebc88f073748d1c1c8821dc6be6a2f0064f3be7f8e4549f8ab9af64944f829b014788dd202cf7d2e320cab666f5e7a197e64efe0bfee94e92ce4dad82d5230c57b89edf
	Modulus: 0x7631b81f00d5e6f888c542d44dbb784cd3646f084ed96f942d341c7c4686cbd405b805dc728f8697475f11e8b1dd797550153a3f0d4ff0f2b274b70a2ebc88f073748d1c1c8821dc6be6a2f0064f3be7f8e4549f8ab9af64944f829b014788dd202cf7d2e320cab666f5e7a197e64efe0bfee94e92ce4dad82d5230c57b89edf
	PublicExponent: 0x03
	# everything after this point is secret
	PrivateExponent: 0x4ecbd014ab3944a5b08381e2de7cfadde242f4b03490f50d737812fd8459dd3803d003e84c5faf0f84ea0bf07693a64e35637c2a08dff5f721a324b1747db09f62c871d5e11711251b845ae76753d4ef967c494b0def4f5d0762f65da603bc04c41b4c6cab4c413a72c633b608267ae2889c162a3d5bc07ee083b1c6e038400b
	Prime1: 0xc7f7cc8feaaac65039c39333b878bffd8f95b0dc22995c553402a5b287f341012253e9f25b83983c936f6ca512926bebee3d5403bf9f4557206c6bbfd9aac899
	Prime2: 0x975015cb603ac1d488dc876132d8bc83079435d2d3395c03d5386b5c004eadd4d7b01b3d86aad0a2275d2d6b791a2abe50d7740b7725679811a32ca22db97637
	Exponent1: 0x854fddb5471c84357bd7b777d0507ffe5fb92092c1bb92e37801c3cc5aa22b5616e29bf6e7ad1028624a486e0c619d47f428e2ad2a6a2e3a159d9d2a911c85bb
	Exponent2: 0x64e00e87957c81385b3daf9621e5d302050d7937377b92ad38d04792aadf1e8de52012290471e06c1a3e1e47a61171d435e4f807a4c39a6561177316c9264ecf
	Coefficient: 0x6f087591becddc210c2ee0480e30beeb25615a3615203cd3cef65e5a1d476fd9602ca0ef10d9b858edb22db42c975fb71883a470b43433a7be57df7ace4a0a3f
        </code></pre><p>
</p></li><li class="step"><p>
Extract and copy the public <acronym class="acronym">RSA</acronym> key files of deep and mail to your <code class="filename">ipsec.conf</code> files as shown below. You can locate the line related to the public key by a sentence beginning with the commented-out: 
<code class="envar">#pubkey=</code> line.
</p><pre class="programlisting">
# sample connection
conn deep-mail
left=208.164.186.1
leftsubnet=192.168.1.0/24
leftnexthop=205.151.222.250
right=208.164.186.2
rightsubnet=192.168.1.0/24
rightnexthop=205.151.222.251
keyingtries=0
auth=ah
authby=rsasig
leftrsasigkey=0x010395daee1be05f3038ae529ef2668afd79f5ff1b16203c9ceaef801cea9cb74bcfb51a6ecc08890d3eb4b5470c0fc35465c8ba2ce9d1145ff07b5427e04cf4a38ef98a7f29edcb4d7689f2da7a69199e4318b4c8d0ea25d33e4f084186a2a54f4b4cec12cca1a5deac3b19d561c16a76bab772888f1fd71aa08f08502a141b611f
rightrsasigkey=0x01037631b81f00d5e6f888c542d44dbb784cd3646f084ed96f942d341c7c4686cbd405b805dc728f8697475f11e8b1dd797550153a3f0d4ff0f2b274b70a2ebc88f073748d1c1c8821dc6be6a2f0064f3be7f8e4549f8ab9af64944f829b014788dd202cf7d2e320cab666f5e7a197e64efe0bfee94e92ce4dad82d5230c57b89edf
auto=start
</pre><p>
</p></li></ol></li><li class="step"><p>
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
Don't forget that, in this example, 
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
The <code class="envar">leftrsasigkey=</code> parameter contains the public key of deep 
</p></li><li class="listitem"><p>
The <code class="envar">rightrsasigkey=</code> parameter contains the public key of mail.
</p></li></ul></div><p>
</p></div><p>
</p></li><li class="step"><p>

Modify your <code class="filename">/etc/ipsec.secrets</code> files to use <acronym class="acronym">RSA</acronym> private keys in *each* gateway:

Edit your original <code class="filename">ipsec.secrets</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/ipsec.secrets</code> and add the <acronym class="acronym">RSA</acronym> private key for authentication on both gateways:

The <code class="filename">ipsec.secrets</code> file for gateway deep:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>vi</strong></span> /etc/ipsec.secrets
</pre><p>
</p><pre class="programlisting">
208.164.186.1 208.164.186.2 "0x9748cc31_2e99194f_d230589b_cd846b57_dc070b01_74b66f34_19c40a1a_804906ed"
</pre><p>
You must change your original <code class="filename">ipsec.secrets</code> file as shown above to look like the following on both gateways. It is important to note that the private keys are not the same on both gateways,  <code class="literal">deep</code> and <code class="literal">mail</code>. 
The private key for <code class="literal">deep</code> comes from the <acronym class="acronym">RSA</acronym> key file <code class="filename">deep-keys,</code> while the private key for <code class="literal">mail</code> comes from the <acronym class="acronym">RSA</acronym> key file <code class="filename">mail-keys:</code>
</p><ol type="a" class="substeps"><li class="step"><p>
</p><pre class="programlisting">
208.164.186.1 208.164.186.2: <acronym class="acronym">RSA</acronym> {
        Modulus: 0x95daee1be05f3038ae529ef2668afd79f5ff1b16203c9ceaef801cea9cb74bcfb51a6ecc08890d3eb4b5470c0fc35465c8ba2ce9d1145ff07b5427e04cf4a38ef98a7f29edcb4d7689f2da7a69199e4318b4c8d0ea25d33e4f084186a2a54f4b4cec12cca1a5deac3b19d561c16a76bab772888f1fd71aa08f08502a141b611f
        PublicExponent: 0x03
        # everything after this point is secret
        PrivateExponent: 0x63e74967eaea2025c98c69f6ef0753a6a3ff6764157dbdf1f50013471324dd352366f48805b0b37f232384b2b52ce2ee85d173468b62eaa052381a9588a317b3a1324d01a531a41fa7add6c5efbdd88f4718feed2bc0246be924e81bb90f03e49ceedf7af0dd48f06f265b519600bd082c6e6bd27eaa71cc0288df1ecc3b062b
        Prime1: 0xc5b471a88b025dd09d4bd7b61840f20d182d9b75bb7c11eb4bd78312209e3aee7ebfe632304db6df5e211d21af7fee79c5d45546bea3ccc7b744254f6f0b847f
        Prime2: 0xc20a99feeafe79767122409b693be75f15e1aef76d098ab12579624aec708e85e2c5dd62080c3a64363f2f45b0e96cb4aef8918ca333a326d3f6dc2c72b75361
        Exponent1: 0x83cda11b0756e935be328fcebad5f6b36573bcf927a80bf2328facb6c0697c9eff2a9976cade79ea3ec0be1674fff4512e8d8e2f29c2888524d818df9f5d02ff
        Exponent2: 0x815c66a9f1fefba44b6c2b124627ef94b9411f4f9e065c7618fb96dc9da05f03ec83e8ec055d7c42ced4ca2e75f0f3231f5061086ccd176f37f9e81da1cf8ceb
        Coefficient: 0x10d954c9e2b8d11f4db1b233ef37ff0a3cecfffad89ba5d515449b007803f577e3bd7f0183ceddfd805466d62f767f3f5a5731a73875d30186520f1753a7e325
	}
</pre><p>
</p></li><li class="step"><p>
  The <code class="filename">ipsec.secrets</code> file for gateway mail:
  </p><pre class="screen">
    [root@mail ]/# <span class="command"><strong>vi</strong></span> /etc/ipsec.secrets
  </pre><p>
  </p><pre class="programlisting">
    208.164.186.1 208.164.186.2: RSA {
    Modulus: 0x95daee1be05f3038ae529ef2668afd79f5ff1b16203c9ceaef801cea9cb74bcfb51a6ecc08890d3eb4b5470c0fc35465c8ba2ce9d1145ff07b5427e04cf4a38ef98a7f29edcb4d7689f2da7a69199e4318b4c8d0ea25d33e4f084186a2a54f4b4cec12cca1a5deac3b19d561c16a76bab772888f1fd71aa08f08502a141b611f
    PublicExponent: 0x03
    # everything after this point is secret
    PrivateExponent: 0x63e74967eaea2025c98c69f6ef0753a6a3ff6764157dbdf1f50013471324dd352366f48805b0b37f232384b2b52ce2ee85d173468b62eaa052381a9588a317b3a1324d01a531a41fa7add6c5efbdd88f4718feed2bc0246be924e81bb90f03e49ceedf7af0dd48f06f265b519600bd082c6e6bd27eaa71cc0288df1ecc3b062b
    Prime1: 0xc5b471a88b025dd09d4bd7b61840f20d182d9b75bb7c11eb4bd78312209e3aee7ebfe632304db6df5e211d21af7fee79c5d45546bea3ccc7b744254f6f0b847f
    Prime2: 0xc20a99feeafe79767122409b693be75f15e1aef76d098ab12579624aec708e85e2c5dd62080c3a64363f2f45b0e96cb4aef8918ca333a326d3f6dc2c72b75361
    Exponent1: 0x83cda11b0756e935be328fcebad5f6b36573bcf927a80bf2328facb6c0697c9eff2a9976cade79ea3ec0be1674fff4512e8d8e2f29c2888524d818df9f5d02ff
    Exponent2: 0x815c66a9f1fefba44b6c2b124627ef94b9411f4f9e065c7618fb96dc9da05f03ec83e8ec055d7c42ced4ca2e75f0f3231f5061086ccd176f37f9e81da1cf8ceb
    Coefficient: 0x10d954c9e2b8d11f4db1b233ef37ff0a3cecfffad89ba5d515449b007803f577e3bd7f0183ceddfd805466d62f767f3f5a5731a73875d30186520f1753a7e325
    }
  </pre><p>

Authentication by <acronym class="acronym">RSA</acronym> Signatures requires that each host have its own private key. The key part of an entry may start with a token indicating the kind of key. <acronym class="acronym">RSA</acronym> signifies <acronym class="acronym">RSA</acronym> private key 
and <acronym class="acronym">PSK</acronym> -<span class="emphasis"><em>which is the default</em></span> signifies PreShared Key. Since <acronym class="acronym">PSK</acronym> is the default, we must specify <acronym class="acronym">RSA,</acronym> so that we'll be able to use <acronym class="acronym">RSA</acronym> private keys 
in this file <code class="filename">ipsec.secrets.</code> The super-user <code class="literal">root</code> should own the file <code class="filename">ipsec.secrets,</code> and its permissions should be set to block all access by others.
</p></li></ol></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm15198"></a>9. Required network setup for IPSec</h2></div></div></div><p>
There are some considerations you must ensure are correct before running FreeS/WAN software. These considerations are important if you don't want to receive error messages during start up of your <acronym class="acronym">VPN</acronym>. The following 
are required:
</p><p>
You will need to enable <acronym class="acronym">TCP</acronym>/<acronym class="acronym">IP</acronym> forwarding on the both gateway servers. In Red Hat Linux, this is accomplished by changing or adding the following line, depending on the Red Hat version you use:

</p><div class="mediaobject"><img src="images/Version6.1.gif" alt="Version 6.1 only"></div><p>
Edit the <code class="filename">network</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/sysconfig/network</code>, and change the following line:
</p><pre class="programlisting">
FORWARD_IPV4="false"
</pre><p>
To read:
</p><pre class="programlisting">
FORWARD_IPV4="yes"
</pre><p>
</p><p>
You must restart your network for the change to take effect:
</p><pre class="screen">
[root@deep] /# /etc/rc.d/init.d/network restart
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
Bringing up interface lo		[  OK  ]
Bringing up interface eth0	        [  OK  ]
Bringing up interface eth1	        [  OK  ]
</code></pre><p>
</p><div class="mediaobject"><img src="images/Version6.2.gif" alt="Version 6.2 only"></div><p>
To enable IPv4 forwarding on your RH 6.2 system, use the following command:

Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
</p><pre class="programlisting">
# Enable packet forwarding
net.ipv4.ip_forward = 1
</pre><p>
</p><p>
You must restart your network for the change to take effect. The command to restart the network is the following:
</p><pre class="screen">
[root@deep] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
Setting network parameters		[  OK  ]
Bringing up interface lo		[  OK  ]
Bringing up interface eth0	        [  OK  ]
Bringing up interface eth1	        [  OK  ]
</code></pre><p>
</p><p>
Recall that automatically keyed connections use keys automatically generated by the Pluto key negotiation daemon. The pluto daemon will start up, try to connect to the Pluto daemon at the other end of the tunnel, and establish a 
connection. For this reason, an IPSEC gateway should have packet filters rules <span class="emphasis"><em>in the firewall script file</em></span> permitting the following protocols to traverse the gateway when talking to other IPSEC gateway:
</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
UDP port 500 for IKE implemented by the Pluto daemon
</p></li><li class="listitem"><p>
Protocol 50 for ESP encryption and/or authentication
</p></li><li class="listitem"><p>
Protocol 51 for AH packet-level authentication
</p></li></ol></div><p>
</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
Edit the <code class="filename">firewall</code> script file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/rc.d/init.d/firewall</code> on both gateway machines, and add/check the following lines to allow IPSEC packets 
to traverse the remote network gateway to your network gateway and vice versa:
</p><pre class="programlisting">
    # FreeS/WAN IPSec <acronym class="acronym">VPN</acronym>
    # -------------------

    # If you are using the FreeSWAN IPSec <acronym class="acronym">VPN</acronym>, you will need to fill in the
    # addresses of the gateways in the IPSECSG and the virtual interfaces for
    # FreeS/Wan IPSEC in the FREESWANVI parameters. Look at the beginning of
    # this firewall script rules file to set the parameters.

    # IPSECSG is a Space separated list of remote gateways. FREESWANVI is a
    # Space separated list of virtual interfaces for FreeS/Wan IPSEC
    # implementation. Only include those that are actually used.

    # Allow IPSEC protocol from remote gateways on external interface
    # IPSEC uses three main types of packet:
    # IKE uses the UDP protocol and port 500,
    # ESP use the protocol number 50, and
    # AH use the protocol number 51

    ipchains -A input  -i $EXTERNAL_INTERFACE -p udp \
             -s $IPSECSG -j ACCEPT

    ipchains -A output  -i $EXTERNAL_INTERFACE -p udp \
             -d $IPSECSG -j ACCEPT

    ipchains -A input  -i $EXTERNAL_INTERFACE -p 50 \
             -s $IPSECSG -j ACCEPT

    ipchains -A output  -i $EXTERNAL_INTERFACE -p 50 \
             -d $IPSECSG -j ACCEPT

    ipchains -A input  -i $EXTERNAL_INTERFACE -p 51 \
             -s $IPSECSG -j ACCEPT

    ipchains -A output  -i $EXTERNAL_INTERFACE -p 51 \
             -d $IPSECSG -j ACCEPT

    # Allow all traffic to FreeS/WAN Virtual Interface
    ipchains -A input  -i $FREESWANVI \
             -s $ANYWHERE \
             -d $ANYWHERE -j ACCEPT

    ipchains -A output  -i $FREESWANVI \
             -s $ANYWHERE \
             -d $ANYWHERE -j ACCEPT

    # Forward anything from the FreeS/WAN virtual interface IPSEC tunnel
    ipchains -A forward  -i $FREESWANVI \
             -s $ANYWHERE \
             -d $ANYWHERE -j ACCEPT
</pre><p>
where
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">EXTERNAL_INTERFACE="eth0"</span></dt><dd><p>
 You external interface to the Internet.
 </p></dd><dt><span class="term">ANYWHERE="any/0"</span></dt><dd><p>
Mean everywhere 0.0.0.0/0.
</p></dd><dt><span class="term">IPSECSG=<code class="literal">208.164.186.2</code></span></dt><dd><p>
Space separated list of remote <acronym class="acronym">VPN</acronym> gateways.
</p></dd><dt><span class="term">FREESWANVI=<code class="literal">ipsec0</code></span></dt><dd><p>
Space separated list of virtual interfaces for FreeS/Wan.
</p></dd></dl></div><p>
</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
See <a class="link" href="#pr4ch4nfl" title="Chapter 10. Networking -Firewall">Networking Firewall</a>, for more information. Dont forget to add/check these firewall rules in the other gateway as well.
</p></div><p>
</p></li><li class="step"><p>

The <code class="literal">rp_filter</code> subsystem related to <acronym class="acronym">IP</acronym> spoofing protection must be turned off on both gateways for IPSEC to work properly. This is accomplished by checking if the value 0 (off) is set in 
the <code class="filename">/proc/sys/net/ipv4/conf/ipsec0/rp_filter</code> and <code class="filename">/proc/sys/net/ipv4/conf/eth0/rp_filter</code> files respectively:
</p><ol type="a" class="substeps"><li class="step"><p>
    To check if the value 0 (off) is set in the <code class="filename">rp_filter</code> files, use the commands:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cat</strong></span> /proc/sys/net/ipv4/conf/ipsec0/rp_filter
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
0
</code></pre><p>
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cat</strong></span> /proc/sys/net/ipv4/conf/eth0/rp_filter
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
0
</code></pre><p>
</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
The subdirectory <code class="filename">ipsec0</code> in our example will be created only after the reboot of your system. So you may check the value of the <code class="filename">rp_filter</code> file in the <code class="filename">ipsec0</code> 
directory after your system has been restarted.
</p></div><p>
</p></li><li class="step"><p>
To set the value 0 (off) in the both <code class="filename">rp_filter</code> files manually, use the command:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>echo</strong></span> 0 &gt; /proc/sys/net/ipv4/conf/ipsec0/rp_filter
[root@deep] /# <span class="command"><strong>echo</strong></span> 0 &gt; /proc/sys/net/ipv4/conf/eth0/rp_filter
</pre><p>
</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
Also you can put lines like the following in your firewall script files <code class="filename">/etc/rc.d/init.d/firewall</code> on the both gateways to automatically set these values to 0 (off) and avoid making them manually:
</p><pre class="programlisting">
    # Disable <acronym class="acronym">IP</acronym> spoofing protection to allow IPSEC to work properly
    <span class="command"><strong>echo</strong></span> 0 &gt; /proc/sys/net/ipv4/conf/ipsec0/rp_filter
    <span class="command"><strong>echo</strong></span> 0 &gt; /proc/sys/net/ipv4/conf/eth0/rp_filter
    </pre><p>
    </p></div><p>
    </p></li></ol></li><li class="step"><p>
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
In the example of the firewall script file above, we assume that <code class="literal">eth0</code> is the interface you use for your connection. Of course if you use <code class="literal">eth1</code> you must change <code class="literal">eth0</code> to <code class="literal">eth1</code>, and so on.
</p></div><p>
If you forget this step you will receive error messages on your terminal such as the following during the start up of FreeSWAN IPSEC:
</p><pre class="literallayout"><code class="computeroutput">
ipsec_setup: WARNING: ipsec0 has route filtering turned on, KLIPS may not work
ipsec_setup:  (/proc/sys/net/ipv4/conf/ipsec0/rp_filter = `1', should be 0)
ipsec_setup: WARNING: eth0 has route filtering turned on, KLIPS may not work
ipsec_setup:  (/proc/sys/net/ipv4/conf/eth0/rp_filter = `1', should be 0)
</code></pre><p>
</p></li><li class="step"><p>
It's important to note that any masquerading rules for internal networks that use IPSEC must come after the rules allowing IPSEC related traffic (The step 2 and 3 above), or the machine will try to masquerade the packets, instead of 
them being passed over to IPSEC.

Edit the <code class="filename">firewall</code> script file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/rc.d/init.d/firewall</code> on both gateway machines and add/check the following lines to allow masqueraded packets to traverse the 
remote network gateway to your network gateway and vice versa:
</p><pre class="programlisting">
# Masquerade internal traffic.

    # All internal traffic is masqueraded externally.

    ipchains -A forward -i $EXTERNAL_INTERFACE -s $LOCALNET_1 -j MASQ
</pre><p>
Where
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">EXTERNAL_INTERFACE="eth0"</span></dt><dd><p>
You external interface to the Internet.
</p></dd><dt><span class="term">LOCALNET_1=" 192.168.1.0/24"</span></dt><dd><p>
whatever private range you use.
</p></dd></dl></div><p>
</p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
See <a class="link" href="#pr4ch12nfmf" title="Chapter 12. Networking Firewall -Masquerading and Forwarding">Networking Firewall with Masquerading and Forwarding</a> support for more information.
</p></div><p>
Now, you can reboot your system, and the machines on Gateway A should be able to talk to the machines on Gateway B with no problems.
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm15370"></a>10. Testing the installation</h2></div></div></div><p>
Reboot the both gateways to get FreeS/WAN started. Examine the <code class="filename">/var/log/messages</code> file for any signs of trouble. If all goes well you should see something like this in 
the <code class="filename">/var/log/messages</code> file:
</p><pre class="literallayout"><code class="computeroutput">
Feb  2 05:22:35 deep ipsec_setup: Starting FreeS/WAN IPSEC snap2000jan31b...
Feb  2 05:22:35 deep ipsec_setup: KLIPS debug `none'
Feb  2 05:22:35 deep ipsec_setup: KLIPS ipsec0 on eth0 192.168.1.1/255.255.255.0 broadcast 192.168.1.255
Feb  2 05:22:36 deep ipsec_setup: Disabling core dumps:
Feb  2 05:22:36 deep ipsec_setup: Starting Pluto (debug `none'):
Feb  2 05:22:37 deep ipsec_setup: Loading Pluto database `deep-mail':
Feb  2 05:22:37 deep ipsec_setup: Enabling Pluto negotiation:
Feb  2 05:22:37 deep ipsec_setup: Routing for Pluto conns `deep-mail':
Feb  2 05:22:37 deep ipsec_setup: Initiating Pluto tunnel `deep-mail':
Feb  2 05:22:39 deep ipsec_setup: 102 "deep-mail" #1: STATE_MAIN_I1: initiate
Feb  2 05:22:39 deep ipsec_setup: 104 "deep-mail" #1: STATE_MAIN_I2: from STATE_MAIN_I1; sent MI2, expecting MR2
Feb  2 05:22:39 deep ipsec_setup: 106 "deep-mail" #1: STATE_MAIN_I3: from STATE_MAIN_I2; sent MI3, expecting MR3
Feb  2 05:22:39 deep ipsec_setup: 004 "deep-mail" #1: STATE_MAIN_I4: SA established
Feb  2 05:22:39 deep ipsec_setup: 110 "deep-mail" #2: STATE_QUICK_I1: initiate
Feb  2 05:22:39 deep ipsec_setup: 004 "deep-mail" #2: STATE_QUICK_I2: SA established
Feb  2 05:22:39 deep ipsec_setup: ...FreeS/WAN IPSEC started
</code></pre><p>
Examine the <code class="filename">/var/log/secure</code> file for any signs of trouble. If all goes well you should see something like the following:
</p><pre class="literallayout"><code class="computeroutput">
Feb 21 14:45:42 deep Pluto[432]: Starting Pluto (FreeS/WAN Version 1.3)
Feb 21 14:45:43 deep Pluto[432]: added connection description "deep-mail"
Feb 21 14:45:43 deep Pluto[432]: listening for IKE messages
Feb 21 14:45:43 deep Pluto[432]: adding interface ipsec0/eth0 192.168.1.1
Feb 21 14:45:43 deep Pluto[432]: loading secrets from "/etc/ipsec.secrets"
Feb 21 14:45:43 deep Pluto[432]: "deep-mail" #1: initiating Main Mode
Feb 21 14:45:44 deep Pluto[432]: "deep-mail" #1: ISAKMP SA established
Feb 21 14:45:44 deep Pluto[432]: "deep-mail" #2: initiating Quick Mode POLICY_RSASIG+POLICY_ENCRYPT+POLICY_AUTHENTICATE+POLICY_TUNNEL+POLICY_PFS
Feb 21 14:45:46 deep Pluto[432]: "deep-mail" #2: sent QI2, IPsec SA established
Feb 21 14:45:47 deep Pluto[432]: "deep-mail" #3: responding to Main Mode
Feb 21 14:45:49 deep Pluto[432]: "deep-mail" #3: sent MR3, ISAKMP SA established
Feb 21 14:45:49 deep Pluto[432]: "deep-mail" #4: responding to Quick Mode
Feb 21 14:45:50 deep Pluto[432]: "deep-mail" #4: IPsec SA established
</code></pre><p>
</p><p>
On both gateways, the following entries should now exist in the <code class="filename">/proc/net/</code> directory:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>ls</strong></span> -l /proc/net/ipsec_*
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
-r--r--r--   1 root     root            0 Feb  2 05:30 /proc/net/ipsec_eroute
-r--r--r--   1 root     root            0 Feb  2 05:30 /proc/net/ipsec_klipsdebug
-r--r--r--   1 root     root            0 Feb  2 05:30 /proc/net/ipsec_spi
-r--r--r--   1 root     root            0 Feb  2 05:30 /proc/net/ipsec_spigrp
-r--r--r--   1 root     root            0 Feb  2 05:30 /proc/net/ipsec_spinew
-r--r--r--   1 root     root            0 Feb  2 05:30 /proc/net/ipsec_tncfg
-r--r--r--   1 root     root            0 Feb  2 05:30 /proc/net/ipsec_version
</code></pre><p>
The <acronym class="acronym">IPSEC</acronym> interfaces should be attached on top of the specified physical interfaces. Confirm that with:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cat</strong></span> /proc/net/ipsec_tncfg
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
ipsec0 -&gt; eth0 mtu=16260 -&gt; 1500
ipsec1 -&gt; NULL mtu=0 -&gt; 0
ipsec2 -&gt; NULL mtu=0 -&gt; 0
ipsec3 -&gt; NULL mtu=0 -&gt; 0
</code></pre><p>
Now execute the following command to show minimal debugging information and see if the output looks something like this:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>ipsec</strong></span> look
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
deep.openna.com Fri Feb  4 17:25:17 EST 2000
============-============
192.168.1.1/32     -&gt; 192.168.1.2/32     =&gt; tun0x106@192.168.1.2 esp0x4450894d@192.168.1.2 ah0x4450894c@192.168.1.2
------------=------------
ah0x3350f551@192.168.1.1 AH_HMAC_MD5: dir=in ooowin=32 seq=115 bit=0xffffffff alen=128 aklen=16 life(c,s,h)=bytes(16140,0,0)add(51656,0,0)use(54068,0,0)packets(115,0,0) idle=499
ah0x4450894c@192.168.1.2 AH_HMAC_MD5: dir=out ooowin=32 seq=2828 alen=128 aklen=16 life(c,s,h)=bytes(449488,0,0)add(51656,0,0)use(51656,0,0)packets(2828,0,0) idle=6
esp0x3350f552@192.168.1.1 ESP_3DES: dir=in ooowin=32 seq=115 bit=0xffffffff eklen=24 life(c,s,h)=bytes(13380,0,0)add(51656,0,0)use(54068,0,0)packets(115,0,0) idle=499
esp0x4450894d@192.168.1.2 ESP_3DES: dir=out ooowin=32 seq=2828 eklen=24 life(c,s,h)=bytes(381616,0,0)add(51656,0,0)use(51656,0,0)packets(2828,0,0) idle=6
tun0x105@192.168.1.1 IPIP: dir=in 192.168.1.2 -&gt; 192.168.1.1 life(c,s,h)=add(51656,0,0)
tun0x106@192.168.1.2 IPIP: dir=out 192.168.1.1 -&gt; 192.168.1.2 life(c,s,h)=bytes(327581,0,0)add(51656,0,0)use(51656,0,0)packets(2828,0,0) idle=6
192.168.1.0     0.0.0.0         255.255.255.0   U         0 0          0 eth0
192.168.1.0     0.0.0.0         255.255.255.0   U         0 0          0 ipsec0
192.168.1.1     0.0.0.0         255.255.255.255 UH        0 0          0 eth0
192.168.1.2     192.168.1.2     255.255.255.255 UGH       0 0          0 ipsec0
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
</code></pre><p>
Try pinging <code class="literal">192.168.1.2</code> from the <code class="literal">192.168.1.1</code> client. If this works then you have set it up correctly. If it does not work check your network to make sure <code class="literal">208.164.186.1</code> can 
reach <code class="literal">208.164.186.2</code>, and that <acronym class="acronym">TCP</acronym>-<acronym class="acronym">IP</acronym> forwarding is enabled, and make sure that no firewall rules are blocking the packets, or trying to masquerade them before the rules allowing 
IPSec related traffic. For this test to work, it is important to use pings that go from one subnet to the other.
</p><pre class="literallayout"><code class="computeroutput">
  208.164.186.1 ---- 205.151.222.250 ---- 205.151.222.251 ---- 208.164.186.2
  |		   					  |
  192.168.1.0/24     		     			     192.168.1.0/24
  |						          |
  192.168.1.1					  	     192.168.1.2
</code></pre><p>

</p><p>
A last note about testing the installation of FreeSWAN <acronym class="acronym">IPSEC</acronym>, if you encounter a problem that you are unable to resolve, you can use the following command to view a collection of debugging information, 
<span class="emphasis"><em>contents of files, selections from logs, etc.</em></span> Anything related to the <acronym class="acronym">IPSEC</acronym> encryption/authentication system that you should send to the Linux-IPSEC Mailing List <code class="email">&lt;<a class="email" href="mailto:linux-ipsec@clinet.fi">linux-ipsec@clinet.fi</a>&gt;</code> to help you.

Use the following command to make an output of a collection of debugging information:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>ipsec</strong></span> barf &gt; result
</pre><p>
This command is primarily provided as a convenience for remote debugging; A single command which packages up -<span class="emphasis"><em>and labels</em></span> all information that might be relevant to diagnosing a problem in <acronym class="acronym">IPSEC</acronym>.
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm15416"></a>11. Further documentation</h2></div></div></div><p>
For more details, there are several man pages you can read:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<span class="citerefentry"><span class="refentrytitle">ipsec</span>(8)</span></span></dt><dd><p>
- invoke <acronym class="acronym">IPSEC</acronym> utilities
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec atoasr</span>(3)</span></span></dt><dd><p>
- convert <acronym class="acronym">ASCII</acronym> to Internet address, subnet, or range
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec atobytes, bytestoa</span>(3)</span></span></dt><dd><p>
- convert binary data bytes from and to <acronym class="acronym">ASCII</acronym> formats
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec atodata, datatoa </span>(3)</span></span></dt><dd><p>
- convert binary data from and to <acronym class="acronym">ASCII</acronym> formats
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec atosa, satoa </span>(3)</span></span></dt><dd><p>
- convert <acronym class="acronym">IPSEC</acronym> Security Association IDs to and from <acronym class="acronym">ASCII</acronym>
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec atosubnet, subnettoa </span>(3)</span></span></dt><dd><p>
- convert subnet/mask <acronym class="acronym">ASCII</acronym> form to and from addresses
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec atoul, ultoa </span>(3)</span></span></dt><dd><p>
- convert unsigned-long numbers to and from <acronym class="acronym">ASCII</acronym>
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec auto </span>(8)</span></span></dt><dd><p>
- control automatically-keyed <acronym class="acronym">IPSEC</acronym> connections
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec barf </span>(8)</span></span></dt><dd><p>
- spew out collected <acronym class="acronym">IPSEC</acronym> debugging information
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec bitstomask </span>(3)</span></span></dt><dd><p>
- convert bit count to Internet subnet mask
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec eroute </span>(8)</span></span></dt><dd><p>
- manipulate <acronym class="acronym">IPSEC</acronym> extended routing tables
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec goodmask </span>(3)</span></span></dt><dd><p>
- is this Internet subnet mask a valid one?
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec hostof </span>(3)</span></span></dt><dd><p>
- given Internet address and subnet mask, return host part
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec klipsdebug </span>(8)</span></span></dt><dd><p>
- set Klips -kernel <acronym class="acronym">IPSEC</acronym> support, debug features and level
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec look </span>(8)</span></span></dt><dd><p>
- show minimal debugging information
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec manual </span>(8)</span></span></dt><dd><p>
- take manually-keyed <acronym class="acronym">IPSEC</acronym> connections up and down
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec masktobits </span>(3)</span></span></dt><dd><p>
- convert Internet subnet mask to bit count
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec optionsfrom </span>(3)</span></span></dt><dd><p>
- read additional <code class="literal">command-line</code> options from file
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec pluto </span>(8)</span></span></dt><dd><p>
- IPsec IKE keying daemon
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec ranbits </span>(8)</span></span></dt><dd><p>
- generate random bits in <acronym class="acronym">ASCII</acronym> form
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec rangetoa </span>(3)</span></span></dt><dd><p>
- convert Internet address range to <acronym class="acronym">ASCII</acronym>
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec rsasigkey </span>(8)</span></span></dt><dd><p>
- generate RSA signature key
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec setup </span>(8)</span></span></dt><dd><p>
- control <acronym class="acronym">IPSEC</acronym> subsystem
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec spi </span>(8)</span></span></dt><dd><p>
- manage <acronym class="acronym">IPSEC</acronym> Security Associations
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec spigrp </span>(8)</span></span></dt><dd><p>
- group/ungroup <acronym class="acronym">IPSEC</acronym> Security Associations
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec subnetof </span>(3)</span></span></dt><dd><p>
- given Internet address and subnet mask, return subnet number
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec tncfg </span>(8)</span></span></dt><dd><p>
- associate <acronym class="acronym">IPSEC</acronym> virtual interface with real interface
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec whack </span>(8)</span></span></dt><dd><p>
- control interface for <acronym class="acronym">IPSEC</acronym> keying daemon
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec.conf </span>(5)</span></span></dt><dd><p>
- <acronym class="acronym">IPSEC</acronym> configuration and connections
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec.secrets </span>(5)</span></span></dt><dd><p>
- secrets for IKE/IPsec authentication
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec </span>(8)</span></span></dt><dd><p>
- invoke <acronym class="acronym">IPSEC</acronym> utilities
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec atoaddr, addrtoa </span>(3)</span></span></dt><dd><p>
- convert Internet addresses to and from <acronym class="acronym">ASCII</acronym>
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec atoasr </span>(3)</span></span></dt><dd><p>
- convert <acronym class="acronym">ASCII</acronym> to Internet address, subnet, or range
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec atobytes, bytestoa </span>(3)</span></span></dt><dd><p>
- convert binary data bytes from and to <acronym class="acronym">ASCII</acronym> formats
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec atodata, datatoa </span>(3)</span></span></dt><dd><p>
- convert binary data from and to <acronym class="acronym">ASCII</acronym> formats
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec atosa, satoa </span>(3)</span></span></dt><dd><p>
- convert <acronym class="acronym">IPSEC</acronym> Security Association IDs to and from <acronym class="acronym">ASCII</acronym>
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec atosubnet, subnettoa </span>(3)</span></span></dt><dd><p>
- convert subnet/mask <acronym class="acronym">ASCII</acronym> form to and from addresses
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec atoul, ultoa </span>(3)</span></span></dt><dd><p>
- convert unsigned-long numbers to and from <acronym class="acronym">ASCII</acronym>
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec auto </span>(8)</span></span></dt><dd><p>
- control automatically-keyed <acronym class="acronym">IPSEC</acronym> connections
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec barf </span>(8)</span></span></dt><dd><p>
- spew out collected <acronym class="acronym">IPSEC</acronym> debugging information
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec bitstomask </span>(3)</span></span></dt><dd><p>
- convert bit count to Internet subnet mask
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec eroute </span>(8)</span></span></dt><dd><p>
- manipulate <acronym class="acronym">IPSEC</acronym> extended routing tables
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec goodmask </span>(3)</span></span></dt><dd><p>
- is this Internet subnet mask a valid one?
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec hostof </span>(3)</span></span></dt><dd><p>
- given Internet address and subnet mask, return host part
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec klipsdebug </span>(8)</span></span></dt><dd><p>
- set Klips (kernel <acronym class="acronym">IPSEC</acronym> support) debug features and level
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec look </span>(8)</span></span></dt><dd><p>
- show minimal debugging information
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec manual </span>(8)</span></span></dt><dd><p>
- take manually-keyed <acronym class="acronym">IPSEC</acronym> connections up and down
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec masktobits </span>(3)</span></span></dt><dd><p>
- convert Internet subnet mask to bit count
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec optionsfrom </span>(3)</span></span></dt><dd><p>
- read additional <code class="literal">command-line</code> options from file
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec pluto </span>(8)</span></span></dt><dd><p>
- IPsec IKE keying daemon
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec ranbits </span>(8)</span></span></dt><dd><p>
- generate random bits in <acronym class="acronym">ASCII</acronym> form
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec rangetoa </span>(3)</span></span></dt><dd><p>
- convert Internet address range to <acronym class="acronym">ASCII</acronym>
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec rsasigkey </span>(8)</span></span></dt><dd><p>
- generate RSA signature key
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec setup </span>(8)</span></span></dt><dd><p>
- control <acronym class="acronym">IPSEC</acronym> subsystem
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec spi </span>(8)</span></span></dt><dd><p>
- manage <acronym class="acronym">IPSEC</acronym> Security Associations
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec spigrp </span>(8)</span></span></dt><dd><p>
- group/ungroup <acronym class="acronym">IPSEC</acronym> Security Associations
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec subnetof </span>(3)</span></span></dt><dd><p>
- given Internet address and subnet mask, return subnet number
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec tncfg </span>(8)</span></span></dt><dd><p>
- associate <acronym class="acronym">IPSEC</acronym> virtual interface with real interface
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec whack </span>(8)</span></span></dt><dd><p>
- control interface for <acronym class="acronym">IPSEC</acronym> keying daemon
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec.conf </span>(5)</span></span></dt><dd><p>
- <acronym class="acronym">IPSEC</acronym> configuration and connections
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ipsec.secrets </span>(5)</span></span></dt><dd><p>
- secrets for IKE/IPsec authentication
</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm15892"></a>12. Installed files</h2></div></div></div><p>These are the files installed on your system by the software program FreeS/WAN</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/rc.d/init.d/ipsec</code></td><td><code class="filename">/etc/rc.d/rc0.d/K68ipsec</code></td><td><code class="filename">/etc/rc.d/rc1.d/K68ipsec</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc2.d/S47ipsec</code></td><td><code class="filename">/etc/rc.d/rc3.d/S47ipsec</code></td><td><code class="filename">/etc/rc.d/rc4.d/S47ipsec</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc5.d/S47ipsec</code></td><td><code class="filename">/etc/rc.d/rc6.d/K68ipsec</code></td><td><code class="filename">/etc/ipsec.conf</code></td></tr><tr><td><code class="filename">/etc/ipsec.secrets</code></td><td><code class="filename">/usr/lib/ipsec</code></td><td><code class="filename">/usr/lib/ipsec/spi</code></td></tr><tr><td><code class="filename">/usr/lib/ipsec/eroute</code></td><td><code class="filename">/usr/lib/ipsec/spigrp</code></td><td><code class="filename">/usr/lib/ipsec/tncfg</code></td></tr><tr><td><code class="filename">/usr/lib/ipsec/klipsdebug</code></td><td><code class="filename">/usr/lib/ipsec/pluto</code></td><td><code class="filename">/usr/lib/ipsec/whack</code></td></tr><tr><td><code class="filename">/usr/lib/ipsec/ipsec</code></td><td><code class="filename">/usr/lib/ipsec/barf</code></td><td><code class="filename">/usr/lib/ipsec/manual</code></td></tr><tr><td><code class="filename">/usr/lib/ipsec/auto</code></td><td><code class="filename">/usr/lib/ipsec/look</code></td><td><code class="filename">/usr/lib/ipsec/showdefaults</code></td></tr><tr><td><code class="filename">/usr/lib/ipsec/_include</code></td><td><code class="filename">/usr/lib/ipsec/_confread</code></td><td><code class="filename">/usr/lib/ipsec/_keycensor</code></td></tr><tr><td><code class="filename">/usr/lib/ipsec/_secretcensor</code></td><td><code class="filename">/usr/lib/ipsec/_updown</code></td><td><code class="filename">/usr/lib/ipsec/ranbits</code></td></tr><tr><td><code class="filename">/usr/lib/ipsec/rsasigkey</code></td><td><code class="filename">/usr/lib/ipsec/setup</code></td><td><code class="filename">/usr/man/man3/ipsec_atoaddr.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ipsec_addrtoa.3</code></td><td><code class="filename">/usr/man/man3/ipsec_atosubnet.3</code></td><td><code class="filename">/usr/man/man3/ipsec_subnettoa.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ipsec_atoasr.3</code></td><td><code class="filename">/usr/man/man3/ipsec_rangetoa.3</code></td><td><code class="filename">/usr/man/man3/ipsec_atodata.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ipsec_atobytes.3</code></td><td><code class="filename">/usr/man/man3/ipsec_bytestoa.3</code></td><td><code class="filename">/usr/man/man3/ipsec_datatoa.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ipsec_atosa.3</code></td><td><code class="filename">/usr/man/man3/ipsec_satoa.3</code></td><td><code class="filename">/usr/man/man3/ipsec_atoul.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ipsec_ultoa.3</code></td><td><code class="filename">/usr/man/man3/ipsec_goodmask.3</code></td><td><code class="filename">/usr/man/man3/ipsec_masktobits.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ipsec_bitstomask.3</code></td><td><code class="filename">/usr/man/man3/ipsec_optionsfrom.3</code></td><td><code class="filename">/usr/man/man3/ipsec_subnetof.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ipsec_hostof.3</code></td><td><code class="filename">/usr/man/man3/ipsec_broadcastof.3</code></td><td><code class="filename">/usr/man/man5/ipsec.secrets.5</code></td></tr><tr><td><code class="filename">/usr/man/man5/ipsec.conf.5</code></td><td><code class="filename">/usr/man/man8/ipsec_spi.8</code></td><td><code class="filename">/usr/man/man8/ipsec.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/ipsec_eroute.8</code></td><td><code class="filename">/usr/man/man8/ipsec_spigrp.8</code></td><td><code class="filename">/usr/man/man8/ipsec_tncfg.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/ipsec_klipsdebug.8</code></td><td><code class="filename">/usr/man/man8/ipsec_pluto.8</code></td><td><code class="filename">/usr/man/man8/ipsec_whack.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/ipsec_barf.8</code></td><td><code class="filename">/usr/man/man8/ipsec_look.8</code></td><td><code class="filename">/usr/man/man8/ipsec_manual.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/ipsec_auto.8</code></td><td><code class="filename">/usr/man/man8/ipsec_setup.8</code></td><td><code class="filename">/usr/man/man8/ipsec_ranbits.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/ipsec_rsasigkey.8</code></td><td><code class="filename">/usr/sbin/ipsec</code></td><td> </td></tr></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="idm16038"></a>Chapter 26. Linux OpenLDAP Server</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#pr6ch26sccmi">1. Compile ans Install</a></span></dt><dt><span class="section"><a href="#idm16093">2. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm16204">3. Configurations</a></span></dt><dt><span class="section"><a href="#idm16241">4. Configure the <code class="filename">/etc/ldap/slapd.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm16303">5. Configure the <code class="filename">/etc/rc.d/init.d/ldap</code> script file</a></span></dt><dt><span class="section"><a href="#idm16326">6. Securing OpenLDAP</a></span></dt><dt><span class="section"><a href="#idm16450">7. OpenLDAP Creation and Maintenance Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm16469">7.1. <acronym class="acronym">LDMB</acronym> backend database off-line </a></span></dt></dl></dd><dt><span class="section"><a href="#idm16505">8. Create the LDMB backend database on-line</a></span></dt><dd><dl><dt><span class="section"><a href="#idm16544">8.1. ldapmodify</a></span></dt></dl></dd><dt><span class="section"><a href="#idm16571">9. OpenLDAP Users Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm16593">9.1. The Netscape Address Book client for <acronym class="acronym">LDAP</acronym></a></span></dt></dl></dd><dt><span class="section"><a href="#idm16638">10. Installed files</a></span></dt></dl></div><div class="highlights"><p>
             Until now, we have been talking about security and optimization in this book, so why would we talk about OpenLDAP? Well, the OpenLDAP directory server will expand our horizons through its many possibilities. We can use its replication 
             capability to centralize and consolidate different information on one server for all the others in our network. Imagine having the possibility of adding or disabling a Unix or NT account, setting access to a restricted Web server, and 
             adding a mail address or alias, all with a single operation available as an <acronym class="acronym">NIS</acronym> service, with the added security of <acronym class="acronym">SSL</acronym> encryption, and the speed of object-oriented hierarchies. Another interesting 
             use is to create an authoritative list of employees on one or more <acronym class="acronym">LDAP</acronym> servers that can be accessible from your private network, or over the Internet.
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch26sccmi"></a>1. Compile ans Install</h2></div></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>As per in the [<span class="citation">OpenLDAP web site</span>]:</b></p></div></div></div><p>
                 <acronym class="acronym">LDAP</acronym> -Lightweight Directory Access Protocol is an open-standard protocol for accessing information services. The protocol runs over Internet transport protocols, such as <acronym class="acronym">TCP</acronym>, and can be used to access 
                 stand-alone directory servers or X.500 directories.
               </p></div><div class="mediaobject"><img src="./images/LDAP-Schema.gif" alt="LDAP"></div><p>
               These installation instructions assume
               </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                   Commands are Unix-compatible.
                 </p></li><li class="listitem"><p>
                 The source path is <code class="filename">/var/tmp</code>, <span class="emphasis"><em>other paths are possible</em></span>.
                 </p></li><li class="listitem"><p>
                 Installations were tested on Red Hat Linux 6.1 and 6.2.
                 </p></li><li class="listitem"><p>
                 All steps in the installation will happen in super-user account <code class="literal">root</code>.
                 </p></li><li class="listitem"><p>
                 OpenLDAP version number is 1.2.10
                 </p></li></ul></div><p>
             </p><p>
               The Package(s) required are and available at:
               </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                   OpenLDAP Homepage:<a class="link" href="#prtinxfp25" title="Compile and Install">http://www.openldap.org/</a>
                 </td></tr><tr><td>
                 OpenLDAP FTP Site: <a class="link" href="#prtinxfp25" title="Compile and Install">204.152.186.57</a>
                 </td></tr><tr><td>
                 You must be sure to download: openldap-1.2.10.tgz
                 </td></tr></table><p>
             </p><p>
               Before you decompress tarballs, it is a good idea to make a list of files on the system before you install OpenLDAP, and one afterwards, and then compare them using diff to find out what file it placed where. Simply 
               run <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; OpenLDAP1</code></strong> before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; OpenLDAP2</code></strong> after you install the software, and use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>OpenLDAP1 OpenLDAP2 &gt; OpenLDAP-Installed</code></strong> 
               to get a list of what changed.
             </p><p>
               Compile and decompress the tarball, <code class="literal">tar.gz</code>.
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>cp</strong></span> openldap-version.tgz /var/tmp
                 [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp/
                 [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf openldap-version.tgz
               </pre><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm16093"></a>2. Compile and Optimize</h2></div></div></div><p>
               Move into the new OpenLDAP directory and type the following commands on your terminal:
             </p><p>
               It is important to note that you can configure three different kinds of backend databases with <acronym class="acronym">LDAP</acronym>. 
               </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
                   A high-performance, disk-based database called <code class="literal">LDBM</code> 
                 </p></li><li class="listitem"><p>
                 A database interface to arbitrary UNIX commands or shell scripts calledd <code class="literal">SHELL</code> 
                 </p></li><li class="listitem"><p>
                 A simple password file database named <code class="literal">PASSWD</code>
                 </p></li></ol></div><p>
             </p><div class="procedure"><ul class="procedure"><li class="step"><p>
                 The default installation of OpenLDAP assumes an <code class="literal">LDBM</code> backend database, so if you want to configure another type of backend database, you must specify it during the configuration and compile time. For a <code class="literal">SHELL</code> backend 
                 database you must add the <code class="literal">--enable-shell</code> option and for a <code class="literal">PASSWD</code> backend database used as replacement for <acronym class="acronym">NIS</acronym> service you must add the <code class="literal">--enable-passwd</code> option in your 
                 configuration lines.
                 </p><pre class="programlisting">
                   CC="egcs" \
                   CFLAGS="-O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions -D_REENTRANT" \
                   ./configure \
                   --prefix=/usr \
                   --libexecdir=/usr/sbin \
                   --localstatedir=/var/run \
                   --sysconfdir=/etc \
                   --enable-dns \
                   --enable-shared \
                   --with-gnu-ld \
                   --disable-debug
                 </pre><p>
                 This tells OpenLDAP to set itself up for this particular hardware setup as follows:
                 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                     Enable dns support.
                   </p></li><li class="listitem"><p>
                   Build shared libraries.
                   </p></li><li class="listitem"><p>
                   Assume the C compiler uses GNU ld.
                   </p></li></ul></div><p>
                 </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
                   The compile options above assume that you want to set up an <code class="literal">LDBM</code> backend database. For the other type of backend database, you must add the required option in your configuration lines above.
                 </p></div><p>
               </p></li></ul></div><p>
               Now, we must compile and install OpenLDAP in the server:
               </p><pre class="screen">
                 [root@deep openldap-1.2.10]# <span class="command"><strong>make depend</strong></span>
                 [root@deep openldap-1.2.10]# <span class="command"><strong>make</strong></span>
                 [root@deep openldap-1.2.10]# <span class="command"><strong>cd</strong></span> tests/
                 [root@deep tests]# <span class="command"><strong>make</strong></span>
                 [root@deep tests]# <span class="command"><strong>cd</strong></span> ..
                 [root@deep openldap-1.2.10]# <span class="command"><strong>make install</strong></span>
               </pre><p>
               </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                   The <span class="command"><strong>make depend</strong></span> command will build and make the necessary dependencies for different files, 
                 </p></li><li class="listitem"><p>
                 <span class="command"><strong>make</strong></span> compiles all source files into executable binaries, 
                 </p></li><li class="listitem"><p>
                 <span class="command"><strong>make install</strong></span> installs the binaries and any supporting files into the appropriate locations.
                 </p></li></ul></div><p>
             </p><p>
               The <span class="command"><strong>make</strong></span> command under <code class="filename">/test</code> subdirectory will do some important tests to verify the functionality of your <acronym class="acronym">LDAP</acronym> server before the installation. If some 
               tests fails, you'll need to fixes the problems before continuing the installation.
             </p><pre class="screen">
               [root@deep openldap-1.2.10]# <span class="command"><strong>install</strong></span> -d -m 700 /var/ldap
               [root@deep openldap-1.2.10]# echo localhost &gt; /etc/openldap/ldapserver
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/lib/liblber.so.1.0.0
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/lib/libldap.so.1.0.0
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/lib/libldap.a
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/lib/liblber.a
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/in.xfingerd
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/go500
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/go500gw
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/mail500
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/rp500
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/rcpt500
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/fax500
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/slapd
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/slurpd
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/ldif
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/ldif2ldbm
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/ldif2index
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/ldif2id2entry
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/ldif2id2children
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/ldbmcat
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/ldbmtest
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/sbin/centipede
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/bin/ud
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/bin/ldapadd
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/bin/ldapsearch
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/bin/ldapmodify
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/bin/ldapmodrdn
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/bin/ldappasswd
               [root@deep openldap-1.2.10]# <span class="command"><strong>strip</strong></span> /usr/bin/ldapdelete
             </pre><p>
               </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                 The <span class="command"><strong>install</strong></span> command above will create a new directory named <code class="filename">ldap</code> under <code class="filename">/var</code> directory and will set its mode to 
                 be readable, writable, and executable only by the super-user <code class="literal">root</code>, <code class="literal">700</code> for security reasons.
               </p></li><li class="listitem"><p>
               The <span class="command"><strong>strip</strong></span> command will discard all symbols from the object files. This means that our binary files will be smaller in size. This will improve the performance hit to the program since there 
               will be fewer lines to be read by the system when it executes the binary.
               </p></li></ul></div><p>
             </p><p>
               Please don't forget to cleanup later:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
                 [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf openldap-version/ openldap-version.tgz
               </pre><p>
               The <span class="command"><strong>rm</strong></span> command will remove all the source files we have used to compile and install OpenLDAP. It will also remove the OpenLDAP compressed archive from the <code class="filename">/var/tmp</code> directory.
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm16204"></a>3. Configurations</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
                   You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
                   for respective software. For example <em class="wordasword">OpenLDAP</em> configuration file are organised like this:
                   </p><pre class="literallayout"><code class="computeroutput">
                total 16
                -rw-r--r--    1 harrypotter    harrypotter         321 Jun  8 13:00 Compile-OpenLDAP
                drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 init.d/
                -rwx------    1 harrypotter    harrypotter         893 Jun  8 13:00 ldap.sh*
                -rw-------    1 harrypotter    harrypotter         922 Jun  8 13:00 slapd.conf

                   </code></pre><p>
                   You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
                   responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
                 </p></div><p>
                 To run OpenLDAP server, the following files are required and must be created or copied to the appropriate directories on your server.
                 </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
                   Copy the <code class="filename">slapd.conf</code> file in the <code class="filename">/etc/openldap/</code> directory.
                 </p></li><li class="listitem"><p>
                 Copy the ldap script file in the <code class="filename">/etc/rc.d/init.d/</code> directory.
                 </p></li></ol></div><p>
               </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
                 You can obtain the configuration files listed in the next few sections on our <code class="filename">floppy.tgz</code> archive. Copy the following files from the decompressed <code class="filename">floppy.tgz</code> archive to the appropriate places or copy 
                 and paste them directly from this book to the concerned file.
               </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm16241"></a>4. Configure the <code class="filename">/etc/ldap/slapd.conf</code> file</h2></div></div></div><p>
               The <code class="filename">/etc/openldap/slapd.conf</code> file is the main configuration file for the stand-alone <acronym class="acronym">LDAP</acronym> daemon. Options like: 
               <span class="simplelist">permission, password, database type, database location</span> and so on can be configured in this file and will apply to the <code class="literal">slapd</code> 
               daemon as a whole. In the example below we configure the <code class="filename">slapd.conf</code> file for an <acronym class="acronym">LDBM</acronym> backend database.
             </p><p>
               Edit the <code class="filename">slapd.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/openldap/slapd.conf</code> and add/adjust the following information:
               </p><pre class="programlisting">
                 #
                 # See slapd.conf(5) for details on configuration options.
                 # This file should NOT be world readable.
                 #
                 include	/etc/openldap/slapd.at.conf
                 include	/etc/openldap/slapd.oc.conf
                 schemacheck	off
                 #referral	ldap://ldap.itd.umich.edu

                 pidfile	/var/run/slapd.pid
                 argsfile	/var/run/slapd.args

                 #######################################################################
                 # ldbm database definitions
                 #######################################################################

                 database	ldbm
                 suffix	"o=openna, c=com"
                 directory	/var/ldap
                 rootdn	"cn=admin, o=openna, c=com"
                 rootpw	secret
                 # cleartext passwords, especially for the rootdn, should
                 # be avoid.  See slapd.conf(5) for details.

                 # ldbm indexed attribute definitions
                 index cn,sn,uid
                 index objectclass pres,eq
                 index default none
                 # ldbm access control definitions
                 defaultaccess read
                 access to attr=userpassword
                 by self write
                 by dn="cn=admin, o=openna, c=com" write
                 by * compare
               </pre><p>               
             </p><p>
               You should be sure to set the following options in your <code class="filename">slapd.conf</code> file above before starting the slapd daemon program:
               </p><div class="glosslist"><dl><dt><span class="glossterm">suffix	o=openna, c=com</span></dt><dd class="glossdef"><p>
                   This option specifies the DN of the root of the sub tree you are trying to create. In other words, it indicates what entries are to be held by this database.
                 </p></dd><dt><span class="glossterm">directory	/var/ldap</span></dt><dd class="glossdef"><p>
                 This option specifies the directory where the database and associated indexes files of <acronym class="acronym">LDAP</acronym> should reside. We must set this to <code class="filename">/var/ldap</code> because we created this directory 
                 earlier in the installation stage specifically to handle the backend database of <acronym class="acronym">LDAP</acronym>.
               </p></dd><dt><span class="glossterm">rootdn	cn=admin, o=openna, c=com</span></dt><dd class="glossdef"><p>
                 This option specifies the DN of an entry allowed to do anything on the <acronym class="acronym">LDAP</acronym> directory. The name entered here can be one that doesn't actually exist in your password file <code class="filename">/etc/passwd</code>.
                 </p></dd><dt><span class="glossterm">rootpw	secret</span></dt><dd class="glossdef"><p>
                 This option specifies the password that can be used to authenticate the <code class="literal">super-user</code> entry of the database. This is the password for the rootdn option above. Its important to not use clear text 
                 passwords here and to use a crypto password instead.
               </p></dd><dt><span class="glossterm">index cn,sn,uid | index objectclass pres,eq | index default none</span></dt><dd class="glossdef"><p>
                 These options specify the index definitions you want to build and maintain in the database definition. The options we specifies in our <code class="filename">slapd.conf</code> file example above, cause all indexes to be maintained for 
                 the <code class="literal">cn</code>, <code class="literal">sn</code>, and <code class="literal">uid</code> attributes; -<code class="literal">index cn,sn,uid</code>, presence and an equality indexes for the objectclass attribute -<code class="literal">index objectclass pres,eq</code>, 
                 and no indexes for all remaining attributes -<code class="literal">index default none</code>. See your user manual for more information.
               </p></dd></dl></div><p>
             </p><p>
               The last options in the file <code class="filename">slapd.conf</code> relate to access control in <acronym class="acronym">LDAP</acronym> directory.
               </p><pre class="programlisting">
                 defaultaccess read
                 access to attr=userpassword
                 by self write
                 by dn="cn=admin, o=openna, c=com" write
                 by * compare
               </pre><p>
               This example applies to entries in the <code class="literal">o=openna, c=com</code> sub tree. Read access is granted to everyone, and the entry itself can write all attributes, except for userpassword. The userpassword attribute is writable only by 
               the specified <code class="literal">cn</code> entry; <code class="literal">admin</code>, and comparable by everybody else. See your user manual for more information.
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm16303"></a>5. Configure the <code class="filename">/etc/rc.d/init.d/ldap</code> script file</h2></div></div></div><p>
               Configure your <code class="filename">/etc/rc.d/init.d/ldap</code> script file to start and stop <acronym class="acronym">LDAP</acronym> Server. Create the ldap script file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/rc.d/init.d/ldap</code> and add:
             </p><pre class="programlisting">
               #!/bin/sh
               #
               # ldap	This shell script takes care of starting and stopping
               #	ldap servers (slapd and slurpd).
               #
               # chkconfig: - 70 40
               # description: <acronym class="acronym">LDAP</acronym> stands for Lightweight Directory Access Protocol, used \
               #              for implementing the industry standard directory services.
               # processname: slapd
               # config: /etc/openldap/slapd.conf
               # pidfile: /var/run/slapd.pid

               # Source function library.
               . /etc/rc.d/init.d/functions

               # Source networking configuration.
               . /etc/sysconfig/network

               # Check that networking is up.
               [ ${NETWORKING} = "no" ] &amp;&amp; exit 0

               [ -f /usr/sbin/slapd ] || exit 0
               [ -f /usr/sbin/slurpd ] || exit 0

               RETVAL=0

               # See how we were called.
               case "$1" in
               start)
               # Start daemons.
               echo -n "Starting ldap: "
               daemon slapd
               RETVAL=$?
               if [ $RETVAL -eq 0 ]; then
               if grep -q "^replogfile" /etc/openldap/slapd.conf; then
               daemon slurpd
               RETVAL=$?
               [ $RETVAL -eq 0 ] &amp;&amp; pidof slurpd | cut -f 1 -d " " &gt; /var/run/slurpd
               fi
               fi
               echo
               [ $RETVAL -eq 0 ] &amp;&amp; touch /var/lock/subsys/ldap
               ;;
               stop)
               # Stop daemons.
               echo -n "Shutting down ldap: "
               killproc slapd
               RETVAL=$?
               if [ $RETVAL -eq 0 ]; then
               if grep -q "^replogfile" /etc/openldap/slapd.conf; then
               killproc slurpd
               RETVAL=$?
               fi
               fi
               echo
               if [ $RETVAL -eq 0 ]; then
               rm -f /var/lock/subsys/ldap
               rm -f /var/run/slapd.args
               fi
               ;;
               status)
               status slapd
               RETVAL=$?
               if [ $RETVAL -eq 0 ]; then
               if grep -q "^replogfile" /etc/openldap/slapd.conf; then
               status slurpd
               RETVAL=$?
               fi
               fi
               ;;
               restart)
               $0 stop
               $0 start
               RETVAL=$?
               ;;
               reload)
               killproc -HUP slapd
               RETVAL=$?
               if [ $RETVAL -eq 0 ]; then
               if grep -q "^replogfile" /etc/openldap/slapd.conf; then
               killproc -HUP slurpd
               RETVAL=$?
               fi
               fi
               ;;
               *)
               echo "Usage: $0 start|stop|restart|status}"
               exit 1
               esac

               exit $RETVAL
             </pre><p>
               Now, make this script executable and change its default permissions:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>chmod</strong></span> 700  /etc/rc.d/init.d/ldap
               </pre><p>
             </p><p>
               Create the symbolic rc.d links for OpenLDAP with the command:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>chkconfig</strong></span> --add ldap
               </pre><p>
             </p><p>
               The OpenLDAP script will not automatically start the slapd daemon when you reboot the server. You can change its defaults by executing the following command:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>chkconfig</strong></span> --level 345 ldap on
               </pre><p>
             </p><p>
             Start your OpenLDAP Server manually with the following command:
             </p><pre class="screen">
               [root@deep] /# /etc/rc.d/init.d/ldap start
             </pre><p>
             </p><pre class="literallayout"><code class="computeroutput">
               Starting ldap:                                             [  OK  ]
             </code></pre><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm16326"></a>6. Securing OpenLDAP</h2></div></div></div><p>
             Don't forget to immunize important configuration files. The immutable bit can be used to prevent one from accidentally deleting or overwriting a file that must be protected. It also prevents someone from creating a symbolic link 
             to this file. Once your <code class="filename">slapd.conf</code> file has been configured, it's a good idea to immunize it with command like:
             </p><pre class="screen">
               [root@deep] /# <span class="command"><strong>chattr</strong></span> +i /etc/openldap/slapd.conf
             </pre><p>
             </p><p>
               Further documentation, for more details there are several man pages you can read:
               </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ldapd</span>(8)</span></span></dt><dd><p>
                     <acronym class="acronym">LDAP</acronym> X.500 Protocol Daemon
                   </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ldapdelete</span>(1)</span></span></dt><dd><p>
                   ldap delete entry tool
                 </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ldapfilter.conf</span>(5)</span></span></dt><dd><p>
                   configuration file for <acronym class="acronym">LDAP</acronym> get filter routines
                 </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ldapfriendly</span>(5)</span></span></dt><dd><p>
                   data file for <acronym class="acronym">LDAP</acronym> friendly routines
                 </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ldapmodify, ldapadd</span>(1)</span></span></dt><dd><p>
                   ldap modify entry and ldap add entry tools
                 </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ldapmodrdn</span>(1)</span></span></dt><dd><p>
                   ldap modify entry RDN tool
                 </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ldappasswd</span>(1)</span></span></dt><dd><p>
                   change the password of an <acronym class="acronym">LDAP</acronym> entry
                 </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ldapsearch</span>(1)</span></span></dt><dd><p>
                   ldap search tool
                 </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ldapsearchprefs.conf</span>(5)</span></span></dt><dd><p>
                   configuration file for <acronym class="acronym">LDAP</acronym> search preference routines
                 </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ldaptemplates.conf</span>(5)</span></span></dt><dd><p>
                   configuration file for <acronym class="acronym">LDAP</acronym> display template routines
                 </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ldif</span>(5)</span></span></dt><dd><p>
                   <acronym class="acronym">LDAP</acronym> Data Interchange Format
                 </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">slapd</span>(8)</span></span></dt><dd><p>
                   Stand-alone <acronym class="acronym">LDAP</acronym> Daemon
                 </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">slapd.conf</span>(5)</span></span></dt><dd><p>
                   configuration file for slapd, the stand-alone <acronym class="acronym">LDAP</acronym> daemon
                 </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">slurpd</span>(8)</span></span></dt><dd><p>
                   Standalone <acronym class="acronym">LDAP</acronym> Update Replication Daemon
                 </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">ud</span>(1)</span></span></dt><dd><p>
                   interactive <acronym class="acronym">LDAP</acronym> Directory Server query program
                 </p></dd></dl></div><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm16450"></a>7. OpenLDAP Creation and Maintenance Tools</h2></div></div></div><p>
               To Create of the LDMB backend database, there are two methods to create a database for <acronym class="acronym">LDAP</acronym>, 
               </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                   The first is off-line with the <span class="command"><strong>ldif2ldbm</strong></span> command utility 
                 </p></li><li class="listitem"><p>
                 The other is on-line with the <span class="command"><strong>ldapadd</strong></span> command utility. 
                 </p></li></ol></div><p>
               Usually you use the off-line method when you have many thousands of entries to insert into your database and the on-line method when you have only a small number of entries to put into your database. It is also important to 
               note that 
               </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                   The off-line method requires that your <code class="literal">slapd</code> daemon is not running 
                 </p></li><li class="listitem"><p>
                 The on-line method requires that your <code class="literal">slapd</code> daemon of <acronym class="acronym">LDAP</acronym> is running.
                 </p></li></ul></div><p>
             </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm16469"></a>7.1. <acronym class="acronym">LDMB</acronym> backend database off-line </h3></div></div></div><p>
                 The first thing to do is to create an <acronym class="acronym">LDIF</acronym> input file containing a text representation of your entries. The text file named <code class="filename">my-data-file</code> below can be used as an example file. <span class="emphasis"><em>Of course, your 
                 real LDIF input file will handle much more information than this example</em></span>. When you install OpenLDAP for the first time and have big entries to put in your backend database, it's always a good idea to put all this information into 
                 a text file and add them into your backend database with the <span class="command"><strong>ldif2ldbm</strong></span> command utility.
               </p><div class="example"><a name="idm16477"></a><p class="title"><b>Example 26.1. <code class="filename">my-data-file</code></b></p><div class="example-contents"><p>
                      Create the  file, <span class="command"><strong>touch</strong></span> <code class="filename">/tmp/my-data-file</code> and add as an example in this file the following lines:
                 </p></div></div><br class="example-break"><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
                    
                       </p><pre class="programlisting">
                         dn: o=openna, c=com
                         o: openna
                         objectclass: organization

                         dn: cn=Gerhard Mourani, o=openna, c=com
                         cn: Gerhard Mourani
                         sn: Mourani
                         mail: gmourani@videotron.ca
                         title: Author
                         objectclass: person

                         dn: cn=Anthony Bay, o=openna, c=com
                         cn: Anthony Bay
                         sn: Bay
                         homephone: (444) 111-2233
                         mobile: (444) 555-6677
                         mail: abay@openna.com
                         objectclass: person

                         dn: cn=George Parker, o=openna, c=com
                         cn: George Parker
                         sn: Parker
                         telephonenumber: (555) 234-5678
                         fax: (543) 987-6543
                         mobile: (543) 321-4354
                         description: E-Commerce
                         objectclass: person
                       </pre><p>
                       The above example shows you how to convert your information into <acronym class="acronym">LDIF</acronym> files before adding them to your new backend directory. Consult your OpenLDAP documentation or book for more information.
                     </p></li><li class="step"><p>
                       Once the <acronym class="acronym">LDIF</acronym> input file containing our entries has been created, we must insert it in the <acronym class="acronym">LDAP</acronym> directory server.
                       To insert the LDIF input file and create the database off-line, use the following command:
                       </p><pre class="screen">
                         [root@deep ]/tmp# <span class="command"><strong>ldif2ldbm</strong></span> -i &lt;inputfile&gt;  -f &lt;slapdconfigfile&gt;
                         [root@deep ]/tmp# <span class="command"><strong>ldif2ldbm</strong></span> -i my-data-file -f /etc/openldap/slapd.conf
                       </pre><p>
                       The  -i option with the &lt;inputfile&gt; option specifies the location of the LDIF input file containing the entries in text form to add. The &lt;slapdconfigfile&gt; option specifies the location of the slapd configuration file, which specifies where to create the indexes, what indexes to create, etc.
                     </p></li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
                 It is important to note that the <span class="command"><strong>slapd</strong></span> daemon of <acronym class="acronym">LDAP</acronym> is not started in this mode of creation.
               </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm16505"></a>8. Create the LDMB backend database on-line</h2></div></div></div><p>
               If the entries in your directory server are already created or if you have only a small amount of information to insert into your backend database, you'll prefer to use the <span class="command"><strong>ldapadd</strong></span> command utility to do 
               your job on-line. For example, to add the <code class="literal">Europe Mourani</code> entry using the <span class="command"><strong>ldapadd</strong></span> tool, you could create a file called <code class="filename">newentry</code> in your <code class="filename">/tmp</code> 
               directory.
             </p><div class="example"><a name="idm16513"></a><p class="title"><b>Example 26.2. <acronym class="acronym">LDMB</acronym> backend</b></p><div class="example-contents"><p>
                     Create the <code class="filename">newentry</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/tmp/newentry</code> and add in this file the following contents:
               </p></div></div><br class="example-break"><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
                 
                     </p><pre class="programlisting">
                       cn=Europe Mourani, o=openna, c=com
                       cn=Europe Mourani
                       sn=Mourani
                       mail=emourani@old.com
                       description=Marketing relation
                       objectClass=person
                     </pre><p>
                   </p></li><li class="step"><p>
                     Once the file <code class="filename">newentry</code> has been created, we must add the entry into the <acronym class="acronym">LDAP</acronym> directory server.
                     To actually create the entry on-line in the backend database, use the following command:
                     </p><pre class="screen">
                       [root@deep] /# <span class="command"><strong>ldapadd</strong></span> -f  /tmp/newentry -D "cn=admin, o=openna, c=com" -W
                     </pre><p>
                     </p><pre class="literallayout"><code class="computeroutput">
                       Enter LDAP Password :
                     </code></pre><p>
                 The above command assumes that you have set rootdn to <code class="literal">cn=admin, o=openna, c=com</code> and rootpw to <code class="literal">secret</code>. You will be prompted to enter the password.
                   </p></li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
               It is important to note that the <span class="command"><strong>slapd</strong></span> daemon of <acronym class="acronym">LDAP</acronym> is started in this mode of creation.
             </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm16544"></a>8.1. ldapmodify</h3></div></div></div><p>
                 Contrary to relational databases where data is constantly changed, the directory server contains information that is rarely modified once inserted. But, some times you need to modify information, and the <span class="command"><strong>ldapmodify</strong></span> 
                 tool will help you in your tasks. The <span class="command"><strong>ldapmodify</strong></span> command allows you to add or modify entries on the backend directory server.
               </p><div class="example"><a name="idm16549"></a><p class="title"><b>Example 26.3. <code class="filename">modifyentry</code></b></p><div class="example-contents"><p>
                 Assuming that we want to replace the contents of the <code class="literal">Europe Mourani</code> entry's mail attribute with the new value <code class="literal">emourani@new.com,</code> the following steps will be require:
                 </p></div></div><br class="example-break"><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>

                     Create the <code class="filename">modifyentry</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/tmp/modifyentry</code> and add in this file the contents:
                     </p><pre class="programlisting">
                       cn=Europe Mourani, o=openna, c=com
                       - mail=emourani@old.com		# will delete the old mail address for Europe Mourani in the database.
                       +mail=emourani@new.com	        # will add the new mail address for Europe Mourani in the database.
                     </pre><p>
                   </p></li><li class="step"><p>
                     Once the <code class="filename">modifyentry</code> file has been created, we must replace the entry in the <acronym class="acronym">LDAP</acronym> directory server with the one contained in this file -<code class="filename">modifyentry</code>.
                     To modify the contents of backend database, use the following command:
                     </p><pre class="screen">
                       [root@deep] /# <span class="command"><strong>ladpmodify</strong></span> -D cn=Admin, o=openna, c=com -W  -f &lt;inputfile&gt;
                       [root@deep] /# <span class="command"><strong>ladpmodify</strong></span> -D cn=Admin, o=openna, c=com -W  -f modifyentry
                     </pre><p>
Where &lt;inputfile&gt; is the name of the file <code class="filename">modifyentry</code> we created in step 1 above.
                   </p></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm16571"></a>9. OpenLDAP Users Tools</h2></div></div></div><p>
               To Search on <acronym class="acronym">LDAP</acronym> directory server for entries, the ldapsearch utility searches through the backend database of <acronym class="acronym">LDAP</acronym> directory for information you have requested.
               You can use the following command:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>ldapsearch</strong></span> -b dn attrs
                 [root@deep] /# <span class="command"><strong>ldapsearch</strong></span> -b o=openna, c=com cn=europe*
               </pre><p>
               </p><pre class="literallayout"><code class="computeroutput">
                 cn=Europe Mourani, o=openna, c=com
                 cn=Europe Mourani
                 sn=Mourani
                 mail=emourani@old.com
                 description=Marketing relation
                 objectClass=person
               </code></pre><p>
               This command will retrieve all entries and values for the name europe and will print the result to standard output in your terminal.
             </p><p>
             Some possible uses of OpenLDAP software, for instance OpenLDAP can be used as:
             </p><div class="orderedlist"><ol class="orderedlist" type="I"><li class="listitem"><p>
                 Web Catalogue Server.
               </p></li><li class="listitem"><p>
               White Pages Server.
               </p></li><li class="listitem"><p>
               Certificate Server.
               </p></li><li class="listitem"><p>
               An Access Control Server.
               </p></li><li class="listitem"><p>
               Network Name Server.
               </p></li></ol></div><p>
             </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm16593"></a>9.1. The Netscape Address Book client for <acronym class="acronym">LDAP</acronym></h3></div></div></div><p>
                 If you have Netscape installed on a Linux workstation, or even another kind of operating system, you can use its Address Book features to access the <acronym class="acronym">LDAP</acronym> Directory Server you have just installed 
                 on Linux and query your directory server for information like you do with the <span class="command"><strong>ldapsearch</strong></span> command tool on Linux.
               </p><p>
                 If you are interested in doing that, follow the simple steps below:
                 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                     Open Netscape Communicator
                   </p></li><li class="listitem"><p>
                   Go to Communicator menu
                   </p></li><li class="listitem"><p>
                   Open the Address Book
                   </p></li><li class="listitem"><p>
                   Go to File menu
                   </p></li><li class="listitem"><p>
                   Click on New Directory 
                   </p></li><li class="listitem"><p>
                   Fill the boxes with your server information
                   </p></li></ol></div><p>
               </p><div class="example"><a name="idm16613"></a><p class="title"><b>Example 26.4. Address Book</b></p><div class="example-contents"><p>
                     </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                     <span class="guimenuitem">Description:</span> <strong class="userinput"><code>Open Network Architecture</code></strong>
                     </td></tr><tr><td>
                     <span class="guimenuitem">LDAP Server:</span> <strong class="userinput"><code>208.164.186.3</code></strong>
                     </td></tr><tr><td>
                     <span class="guimenuitem">Server Root:</span> <strong class="userinput"><code>o=openna, c=com</code></strong>
                     </td></tr></table><p>
                 </p></div></div><br class="example-break"><p>
                 Now all you have to do is to make some queries to your <acronym class="acronym">LDAP</acronym> Directory Server on Linux, by using the box named <span class="guimenu">Show names Containing:</span> to start your search, and clicking on 
                 the button <span class="guimenuitem">Search For:</span> to get the results.
                 </p><p>
                 </p><div class="mediaobject"><img src="./images/LDAP-AddressBook.gif" alt="Address Book"><div class="caption"><p>The Netscape Address Book Client Program.</p></div></div><p>
               </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm16638"></a>10. Installed files</h2></div></div></div><p>
               These are the files installed by the program OpenLDAP on your sytem.
             </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/openldap</code></td><td><code class="filename">/etc/openldap/ldap.conf</code></td></tr><tr><td><code class="filename">/etc/openldap/ldap.conf.default</code></td><td><code class="filename">/etc/openldap/ldapfilter.conf</code></td></tr><tr><td><code class="filename">/etc/openldap/ldapfilter.conf.default</code></td><td><code class="filename">/etc/openldap/ldaptemplates.conf</code></td></tr><tr><td><code class="filename">/etc/openldap/ldaptemplates.conf.default</code></td><td><code class="filename">/etc/openldap/ldapsearchprefs.conf</code></td></tr><tr><td><code class="filename">/etc/openldap/ldapsearchprefs.conf.default</code></td><td><code class="filename">/etc/openldap/slapd.conf</code></td></tr><tr><td><code class="filename">/etc/openldap/slapd.conf.default</code></td><td><code class="filename">/etc/openldap/slapd.at.conf</code></td></tr><tr><td><code class="filename">/etc/openldap/slapd.at.conf.default</code></td><td><code class="filename">/etc/openldap/slapd.oc.conf</code></td></tr><tr><td><code class="filename">/etc/openldap/slapd.oc.conf.default</code></td><td><code class="filename">/etc/openldap/ldapserver</code></td></tr><tr><td><code class="filename">/etc/rc.d/init.d/ldap</code></td><td><code class="filename">/etc/rc.d/rc0.d/K40ldap</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc1.d/K40ldap</code></td><td><code class="filename">/etc/rc.d/rc2.d/K40ldap</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc3.d/S70ldap</code></td><td><code class="filename">/etc/rc.d/rc4.d/S70ldap</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc5.d/S70ldap</code></td><td><code class="filename">/etc/rc.d/rc6.d/K40ldap</code></td></tr><tr><td><code class="filename">/usr/bin/ud</code></td><td><code class="filename">/usr/bin/ldapsearch</code></td></tr><tr><td><code class="filename">/usr/bin/ldapmodify</code></td><td><code class="filename">/usr/bin/ldapdelete</code></td></tr><tr><td><code class="filename">/usr/bin/ldapmodrdn</code></td><td><code class="filename">/usr/bin/ldappasswd</code></td></tr><tr><td><code class="filename">/usr/bin/ldapadd</code></td><td><code class="filename">/usr/include/ldap.h</code></td></tr><tr><td><code class="filename">/usr/include/lber.h</code></td><td><code class="filename">/usr/include/ldap_cdefs.h</code></td></tr><tr><td><code class="filename">/usr/include/disptmpl.h</code></td><td><code class="filename">/usr/include/srchpref.h</code></td></tr><tr><td><code class="filename">/usr/lib/liblber.so.1.0.0</code></td><td><code class="filename">/usr/lib/liblber.so.1</code></td></tr><tr><td><code class="filename">/usr/lib/liblber.so</code></td><td><code class="filename">/usr/lib/liblber.la</code></td></tr><tr><td><code class="filename">/usr/lib/liblber.a</code></td><td><code class="filename">/usr/lib/libldap.so.1.0.0</code></td></tr><tr><td><code class="filename">/usr/lib/libldap.so.1</code></td><td><code class="filename">/usr/lib/libldap.so</code></td></tr><tr><td><code class="filename">/usr/lib/libldap.la</code></td><td><code class="filename">/usr/lib/libldap.a</code></td></tr><tr><td><code class="filename">/usr/man/man1/ud.1</code></td><td><code class="filename">/usr/man/man1/ldapdelete.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/ldapmodify.1</code></td><td><code class="filename">/usr/man/man1/ldapadd.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/ldapmodrdn.1</code></td><td><code class="filename">/usr/man/man1/ldappasswd.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/ldapsearch.1</code></td><td><code class="filename">/usr/man/man3/cldap_close.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/cldap_open.3</code></td><td><code class="filename">/usr/man/man3/cldap_search_s.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/cldap_setretryinfo.3</code></td><td><code class="filename">/usr/man/man3/lber-decode.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/lber-encode.3</code></td><td><code class="filename">/usr/man/man3/ldap.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/cldap.3</code></td><td><code class="filename">/usr/man/man3/ldap_abandon.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_add.3</code></td><td><code class="filename">/usr/man/man3/ldap_add_s.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_bind.3</code></td><td><code class="filename">/usr/man/man3/ldap_bind_s.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_simple_bind.3</code></td><td><code class="filename">/usr/man/man3/ldap_simple_bind_s.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_kerberos_bind_s.3</code></td><td><code class="filename">/usr/man/man3/ldap_kerberos_bind1.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_kerberos_bind1_s.3</code></td><td><code class="filename">/usr/man/man3/ldap_kerberos_bind2.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_kerberos_bind2_s.3</code></td><td><code class="filename">/usr/man/man3/ldap_unbind.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_unbind_s.3</code></td><td><code class="filename">/usr/man/man3/ldap_set_rebind_proc.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_cache.3</code></td><td><code class="filename">/usr/man/man3/ldap_enable_cache.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_disable_cache.3</code></td><td><code class="filename">/usr/man/man3/ldap_destroy_cache.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_flush_cache.3</code></td><td><code class="filename">/usr/man/man3/ldap_uncache_entry.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_uncache_request.3</code></td><td><code class="filename">/usr/man/man3/ldap_set_cache_options.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_charset.3</code></td><td><code class="filename">/usr/man/man3/ldap_set_string_translators.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_enable_translation.3</code></td><td><code class="filename">/usr/man/man3/ldap_translate_from_t61.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_translate_to_t61.3</code></td><td><code class="filename">/usr/man/man3/ldap_t61_to_8859.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_8859_to_t61.3</code></td><td><code class="filename">/usr/man/man3/ldap_compare.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_compare_s.3</code></td><td><code class="filename">/usr/man/man3/ldap_delete.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_delete_s.3</code></td><td><code class="filename">/usr/man/man3/ldap_disptmpl.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_init_templates.3</code></td><td><code class="filename">/usr/man/man3/ldap_init_templates_buf.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_free_templates.3</code></td><td><code class="filename">/usr/man/man3/ldap_first_disptmpl.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_next_disptmpl.3</code></td><td><code class="filename">/usr/man/man3/ldap_oc2template.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_tmplattrs.3</code></td><td><code class="filename">/usr/man/man3/ldap_first_tmplrow.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_next_tmplrow.3</code></td><td><code class="filename">/usr/man/man3/ldap_first_tmplcol.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_next_tmplcol.3</code></td><td><code class="filename">/usr/man/man3/ldap_entry2text.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_entry2text_search.3</code></td><td><code class="filename">/usr/man/man3/ldap_vals2text.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_entry2html.3</code></td><td><code class="filename">/usr/man/man3/ldap_entry2html_search.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_vals2html.3</code></td><td><code class="filename">/usr/man/man3/ldap_error.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_perror.3</code></td><td><code class="filename">/usr/man/man3/ld_errno.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_result2error.3</code></td><td><code class="filename">/usr/man/man3/ldap_open.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_errlist.3</code></td><td><code class="filename">/usr/man/man3/ldap_err2string.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_first_attribute.3</code></td><td><code class="filename">/usr/man/man3/ldap_next_attribute.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_first_entry.3</code></td><td><code class="filename">/usr/man/man3/ldap_next_entry.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_count_entries.3</code></td><td><code class="filename">/usr/man/man3/ldap_friendly.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_friendly_name.3</code></td><td><code class="filename">/usr/man/man3/ldap_free_friendlymap.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_get_dn.3</code></td><td><code class="filename">/usr/man/man3/ldap_explode_dn.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_explode_dns.3</code></td><td><code class="filename">/usr/man/man3/ldap_dn2ufn.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_is_dns_dn.3</code></td><td><code class="filename">/usr/man/man3/ldap_get_values.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_get_values_len.3</code></td><td><code class="filename">/usr/man/man3/ldap_value_free.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_value_free_len.3</code></td><td><code class="filename">/usr/man/man3/ldap_count_values.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_count_values_len.3</code></td><td><code class="filename">/usr/man/man3/ldap_getfilter.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_init_getfilter.3</code></td><td><code class="filename">/usr/man/man3/ldap_init_getfilter_buf.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_getfilter_free.3</code></td><td><code class="filename">/usr/man/man3/ldap_getfirstfilter.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_getnextfilter.3</code></td><td><code class="filename">/usr/man/man3/ldap_setfilteraffixes.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_build_filter.3</code></td><td><code class="filename">/usr/man/man3/ldap_modify.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_modify_s.3</code></td><td><code class="filename">usr/man/man3/ldap_mods_free.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_modrdn.3</code></td><td><code class="filename">/usr/man/man3/ldap_modrdn_s.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_modrdn2.3</code></td><td><code class="filename">/usr/man/man3/ldap_modrdn2_s.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_init.3</code></td><td><code class="filename">/usr/man/man3/ldap_result.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_msgfree.3</code></td><td><code class="filename">/usr/man/man3/ldap_search.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_search_s.3</code></td><td><code class="filename">/usr/man/man3/ldap_search_st.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_searchprefs.3</code></td><td><code class="filename">/usr/man/man3/ldap_init_searchprefs.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_init_searchprefs_buf.3</code></td><td><code class="filename">/usr/man/man3/ldap_free_searchprefs.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_first_searchobj.3</code></td><td><code class="filename">/usr/man/man3/ldap_next_searchobj.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_sort.3</code></td><td><code class="filename">/usr/man/man3/ldap_sort_entries.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_sort_values.3</code></td><td><code class="filename">/usr/man/man3/ldap_sort_strcasecmp.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_ufn.3</code></td><td><code class="filename">/usr/man/man3/ldap_ufn_search_s.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_ufn_search_c.3</code></td><td><code class="filename">/usr/man/man3/ldap_ufn_search_ct.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_ufn_setprefix.3</code></td><td><code class="filename">/usr/man/man3/ldap_ufn_setfilter.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_ufn_timeout.3</code></td><td><code class="filename">/usr/man/man3/ldap_url.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_is_ldap_url.3</code></td><td><code class="filename">/usr/man/man3/ldap_url_parse.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_free_urldesc.3</code></td><td><code class="filename">/usr/man/man3/ldap_url_search.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/ldap_url_search_s.3</code></td><td><code class="filename">/usr/man/man3/ldap_url_search_st.3</code></td></tr><tr><td><code class="filename">/usr/man/man5/ldap.conf.5</code></td><td><code class="filename">/usr/man/man5/ldapfilter.conf.5</code></td></tr><tr><td><code class="filename">/usr/man/man5/ldapfriendly.5</code></td><td><code class="filename">/usr/man/man5/ldapsearchprefs.conf.5</code></td></tr><tr><td><code class="filename">/usr/man/man5/ldaptemplates.conf.5</code></td><td><code class="filename">/usr/man/man5/ldif.5</code></td></tr><tr><td><code class="filename">/usr/man/man5/slapd.conf.5</code></td><td><code class="filename">/usr/man/man5/slapd.replog.5</code></td></tr><tr><td><code class="filename">/usr/man/man5/ud.conf.5</code></td><td><code class="filename">/usr/man/man8/centipede.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/chlog2replog.8</code></td><td><code class="filename">/usr/man/man8/edb2ldif.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/go500.8</code></td><td><code class="filename">/usr/man/man8/go500gw.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/in.xfingerd.8</code></td><td><code class="filename">/usr/man/man8/ldapd.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/ldbmcat.8</code></td><td><code class="filename">/usr/man/man8/ldif.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/ldif2ldbm.8</code></td><td><code class="filename">/usr/man/man8/ldif2index.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/ldif2id2entry.8</code></td><td><code class="filename">/usr/man/man8/ldif2id2children.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/mail500.8</code></td><td><code class="filename">/usr/man/man8/fax500.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/rcpt500.8</code></td><td><code class="filename">/usr/man/man8/slapd.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/slurpd.8</code></td><td><code class="filename">/usr/sbin/ldif</code></td></tr><tr><td><code class="filename">/usr/sbin/in.xfingerd</code></td><td><code class="filename">/usr/sbin/go500</code></td></tr><tr><td><code class="filename">/usr/sbin/go500gw</code></td><td><code class="filename">/usr/sbin/mail500</code></td></tr><tr><td><code class="filename">/usr/sbin/rp500</code></td><td><code class="filename">/usr/sbin/fax500</code></td></tr><tr><td><code class="filename">/usr/sbin/xrpcomp</code></td><td><code class="filename">/usr/sbin/rcpt500</code></td></tr><tr><td><code class="filename">/usr/sbin/slapd</code></td><td><code class="filename">/usr/sbin/ldif2ldbm</code></td></tr><tr><td><code class="filename">/usr/sbin/ldif2index</code></td><td><code class="filename">/usr/sbin/ldif2id2entry</code></td></tr><tr><td><code class="filename">/usr/sbin/ldif2id2children</code></td><td><code class="filename">/usr/sbin/ldbmcat</code></td></tr><tr><td><code class="filename">/usr/sbin/centipede</code></td><td><code class="filename">/usr/sbin/ldbmtest</code></td></tr><tr><td><code class="filename">/usr/sbin/slurpd</code></td><td><code class="filename">/usr/share/openldap</code></td></tr><tr><td><code class="filename">/usr/share/openldap/ldapfriendly</code></td><td><code class="filename">/usr/share/openldap/go500gw.help</code></td></tr><tr><td><code class="filename">/usr/share/openldap/rcpt500.help</code></td><td><code class="filename">/var/ldap</code></td></tr></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="idm17110"></a>Chapter 27. Linux PostgreSQL Database Server</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#pr6ch27scpsql">1. Install PostgreSQL</a></span></dt><dt><span class="section"><a href="#idm17174">2. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm17277">3. Database installation using superuser account</a></span></dt><dt><span class="section"><a href="#idm17319">4. Configuration files</a></span></dt><dt><span class="section"><a href="#idm17352">5. Configure the <code class="filename">/etc/rc.d/init.d/postgresql</code> script file</a></span></dt><dt><span class="section"><a href="#idm17370">6. Commands often used</a></span></dt><dt><span class="section"><a href="#idm17438">7. Installed files</a></span></dt></dl></div><div class="highlights"><p>
             Once you begin to serve, and supply services to your customers, you'll inevitably find that you need to keep information about them in an archive to be accessible and modifiable at any time, should you want it. These tasks can be accomplished 
             with the use of a database. Many databases are available on Linux; Choosing one can be complicated, as it must be able to support a number of programming languages, standards and features. PostgreSQL, developed originally in the UC Berkeley 
             Computer Science Department, pioneered many of the object-relational concepts now becoming available in commercial databases. It provides SQL92/SQL3 language support, transaction integrity, and type extensibility.
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch27scpsql"></a>1. Install PostgreSQL</h2></div></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>As per the [<span class="citation">PostgreSQL web site</span>]:</b></p></div></div></div><p>
                 PostgreSQL is a sophisticated Object-Relational <acronym class="acronym">DBMS</acronym>, supporting almost all <acronym class="acronym">SQL</acronym> constructs, including subselects, transactions, and user-defined types and functions. It is the most advanced 
                 open-source database available anywhere.
                 </p><div class="mediaobject"><img src="./images/SQL-Schema.gif" alt="PostgresSQL"></div><p>

               </p></div><p>
               These installation instructions assume
               </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                   Commands are Unix-compatible.
                 </p></li><li class="listitem"><p>
                 The source path is <code class="filename">/var/tmp</code>, <span class="emphasis"><em>other paths are possible</em></span>.
                 </p></li><li class="listitem"><p>
                   Installations were tested on Red Hat Linux 6.1 and 6.2.
                 </p></li><li class="listitem"><p>
                 All steps in the installation will happen in super-user account <code class="literal">root</code>.
                 </p></li><li class="listitem"><p>
                 PostgreSQL version number is 6.5.3
                 </p></li></ul></div><p>
             </p><p>
               These are the Package(s) and available here:
               </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                 PostgreSQL Homepage: <a class="link" href="#prtinxfp27" title="Install PostgreSQL">http://www.postgresql.org/</a>
               </td></tr><tr><td>
               PostgreSQL FTP Site:<a class="link" href="#prtinxfp27" title="Install PostgreSQL">216.126.84.28</a>
               </td></tr><tr><td>
               You must be sure to download: postgresql-6.5.3.tar.gz
               </td></tr></table><p>
             </p><p>
               There are certain prerequisites before compiling the PostgreSQL program, you must verify that <code class="literal">egcs-c++-version.i386.rpm</code> package is installed on your system. The <code class="literal">egcs-c++-version.i386.rpm</code> package 
               is located in you Red Hat Linux CD-ROM under <code class="filename">RedHat/RPMS</code> subdirectory. After compilation and installation of PostgreSQL you can remove this package from your system.
               To verify that egcs-c++-version.i386.rpm is already installed, use the following command:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>rpm</strong></span> -q egcs-c++
               </pre><p>
               To install egcs-c++-version.i386.rpm, use the following command:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>mount</strong></span> /dev/cdrom /mnt/cdrom
                 [root@deep] /# <span class="command"><strong>cd</strong></span> /mnt/cdrom/RedHat/RPMS
                 [root@deep ]/RPMS# <span class="command"><strong>rpm</strong></span> -Uvh egcs-c++-version.i386.rpm
               </pre><p>
               </p><pre class="literallayout"><code class="computeroutput">
                 egcs-c++                    ##################################################
               </code></pre><p>
             </p><p>
               Before you decompress the tarballs, it is a good idea to make a list of files on the system before you install it, and one afterwards, and then compare them using diff to find out what file it placed where. Simply run <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; PostgreSQL1</code></strong> 
               before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; PostgreSQL2</code></strong> after you install the tarball, and use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>PostgreSQL1 PostgreSQL2 &gt; PostgreSQL-Installed</code></strong> to get a list of what changed.
             </p><p>
               To Compile you need to decompress the tarball -<code class="literal">tar.gz</code>:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>cp</strong></span> postgresql-version.tar.gz /var/tmp
                 [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
                 [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf postgresql-version.tar.gz
               </pre><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm17174"></a>2. Compile and Optimize</h2></div></div></div><p>                             
               First of all, to avoid security risks, we'll create an unprivileged user account named <code class="literal">postgres</code> to be the owner of the Postgres files.
             </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
                 To create the Postgres account, use the following command:
                 </p><pre class="screen">
                   [root@deep] /# <span class="command"><strong>useradd</strong></span> -M -o -r -d /var/lib/pgsql -s /bin/bash -c "PostgreSQL Server" -u 40 postgres &gt;/dev/null 2&gt;&amp;1 || :
                 </pre><p>
               </p></li><li class="step"><p>

                 Move into the new PosgreSQL directory we have untarred earlier, and then move to its subdirectory named <code class="filename">src</code>. Type the following commands on your terminal:
                 </p><pre class="screen">
                   [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp/postgresql-6.5.3
                   [root@deep ]/postgresql-6.5.3# <span class="command"><strong>cd</strong></span> src
                   CC="egcs" \
                   ./configure \
                   --prefix=/usr \
                   --enable-locale
                 </pre><p>
                 This tells PostgreSQL to set itself up for this particular hardware setup with:
                 </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                   - Enable locale support.
                 </td></tr></table><p>
               </p></li><li class="step"><p>
                 Edit the <code class="filename">Makefile.global</code> file, <span class="command"><strong>vi</strong></span>  +210 <code class="filename">Makefile.global</code> and change the line:
                 </p><pre class="programlisting">
                   CFLAGS= -I$(SRCDIR)/include -I$(SRCDIR)/backend
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   CFLAGS= -I$(SRCDIR)/include -I$(SRCDIR)/backend -O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions
                 </pre><p>
                 These are our optimization flags for the PostgreSQL Server. Of course, you must tailor them to fit your system and CPU architecture.
               </p></li></ol></div><p>
               Now, we must compile and install PosgreSQL on to the server:
               </p><pre class="screen">
                 [root@deep ]/src# <span class="command"><strong>make all</strong></span>
                 [root@deep ]/src# <span class="command"><strong>cd</strong></span> ..
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>make</strong></span> -C src install
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>make</strong></span> -C src/man install
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mkdir</strong></span> -p /usr/include/pgsql
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/access  /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/commands  /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/executor  /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/lib  /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/libpq  /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/libpq++  /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/port  /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/utils  /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/fmgr.h /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/os.h /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/config.h /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/c.h /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/postgres.h /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/postgres_ext.h /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/libpq-fe.h /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/libpq-int.h /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/ecpgerrno.h /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/ecpglib.h /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/ecpgtype.h /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/sqlca.h /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/include/libpq++.H /usr/include/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mkdir</strong></span> -p /usr/lib/pgsql
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/lib/*source /usr/lib/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mv</strong></span> /usr/lib/*sample /usr/lib/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>mkdir</strong></span> -p /var/lib/pgsql
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>chown</strong></span> -R postgres.postgres /var/lib/pgsql/
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>chmod</strong></span> 755 /usr/lib/libpq.so.2.0
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>chmod</strong></span> 755 /usr/lib/libecpg.so.3.0.0
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>chmod</strong></span> 755 /usr/lib/libpq++.so.3.0
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>strip</strong></span> /usr/bin/postgres
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>strip</strong></span> /usr/bin/postmaster
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>strip</strong></span> /usr/bin/ecpg
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>strip</strong></span> /usr/bin/pg_id
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>strip</strong></span> /usr/bin/pg_version
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>strip</strong></span> /usr/bin/pg_dump
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>strip</strong></span> /usr/bin/pg_passwd
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>strip</strong></span> /usr/bin/psql
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>rm</strong></span> -f  /usr/lib/global1.description
                 [root@deep ]/postgresql-6.5.3# <span class="command"><strong>rm</strong></span> -f  /usr/lib/local1_template1.description
               </pre><p>
             </p><p>
               </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                   The <span class="command"><strong>make</strong></span> command compiles all source files into executable binaries.
                 </p></li><li class="listitem"><p>
                 The <span class="command"><strong>make install</strong></span> command installs the binaries and any supporting files into the appropriate locations. 
                 </p></li><li class="listitem"><p>
                 The <span class="command"><strong>mkdir</strong></span> will create a new directory named <code class="filename">pgsql</code> under the <code class="filename">/usr/include</code> and <code class="filename">/usr/lib</code> directories, 
                 </p></li><li class="listitem"><p>
                 and then we move all subdirectories and files related to PostgreSQL under <code class="filename">/usr/include</code> and <code class="filename">/usr/lib</code> directories to the <code class="filename">/usr/include/pgsql</code> 
                 and <code class="filename">/usr/lib/pgsql</code> directories respectively with the command <span class="command"><strong>mv.</strong></span>
                 </p></li><li class="listitem"><p>
                 The <span class="command"><strong>chown</strong></span> command will set the correct owner and group permission for the <code class="filename">/var/lib/pgsql</code> directory. 
                 </p></li><li class="listitem"><p>
                 The <span class="command"><strong>strip</strong></span> command will discard all symbols from the object files. This means that our binary file will be smaller in size. This will improve the performance hit to the program since there will be fewer lines 
                 to read by the system when it executes the binary.
                 </p></li><li class="listitem"><p>
                 The <span class="command"><strong>rm</strong></span> command will remove the <code class="filename">global1.description</code> and <code class="filename">local1_template1.description</code> files that are not needed by our PosgreSQL program.
                 </p></li></ul></div><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm17277"></a>3. Database installation using superuser account</h2></div></div></div><p>

               Once PostgreSQL is installed on your Linux server, it's important to create the database installation before starting your PostgreSQL server.
               To create the database installation, use the following command:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>su</strong></span> postgres
                 [postgres@deep /]$ <span class="command"><strong>initdb</strong></span> --pglib=/usr/lib/pgsql --pgdata=/var/lib/pgsql
               </pre><p>
             </p><p>
               We are initializing the database system with username postgres <code class="literal">uid=40</code>.
               This user will own all the files and must also own the server process.
               </p><pre class="literallayout"><code class="computeroutput">
                 Creating Postgres database system directory /var/lib/pgsql/base

                 Creating template database in /var/lib/pgsql/base/template1

                 Creating global classes in /var/lib/pgsql/base

                 Adding template1 database to pg_database...

                 Vacuuming template1
                 Creating public pg_user view
                 Creating view pg_rules
                 Creating view pg_views
                 Creating view pg_tables
                 Creating view pg_indexes
                 Loading pg_description
               </code></pre><p>
               </p><pre class="screen">
                 [postgres@deep /]$ <span class="command"><strong>chmod</strong></span> 640 /var/lib/pgsql/pg_pwd
                 [postgres@deep /]$ <span class="command"><strong>exit</strong></span>
               </pre><p>
               </p><pre class="literallayout"><code class="computeroutput">
                 exit
               </code></pre><p>
               </p><pre class="screen">
                 [root@deep] /#
               </pre><p>
               The  <code class="literal">--pglib</code> command will specify where the library directory of PostgreSQL resides in the system, and the  <code class="literal">--pgdata</code> command will specify where the database files must reside 
               for this installation on Linux.
             </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>               
               Do not create the database installation as <code class="literal">root!</code> This would be a major security hole.
             </p></div><p>
               Please don't foreget to Cleanup later:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
                 [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf postgresql-version/ postgresql-version.tar.gz
               </pre><p>
               Remove the egcs-c++-version.i386.rpm package to save space.
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>rpm</strong></span> -e egcs-c++
               </pre><p>
               </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                 The <span class="command"><strong>rm</strong></span> command will remove all the source files we have used to compile and install PostgreSQL. It will also remove the PostgreSQL compressed archive from the <code class="filename">/var/tmp</code> directory.
               </p></li><li class="listitem"><p>
               The <span class="command"><strong>rpm</strong></span> <code class="literal">-e</code> command will remove the egcs-c++ package we installed to compile the PosgreSQL Server. Note that the egcs-c++ package is required only for compiling programs like 
               PostgreSQL and can be uninstalled safely after successful compilation of PostgreSQL.
               </p></li></ul></div><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm17319"></a>4. Configuration files</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
                   All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
                   You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
                   for respective software. For example <em class="wordasword">PostgreSQL</em> configuration file are organised like this:
                   </p><pre class="literallayout"><code class="computeroutput">
                     total 12
                     -rw-r--r--    1 harrypotter    harrypotter          58 Jun  8 13:00 Compile-PostgreSQL
                     drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 init.d/
                     -rwx------    1 harrypotter    harrypotter        1504 Jun  8 13:00 postgres.sh*
                   </code></pre><p>
                   You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
                   responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
                 </p></div><p>
                 To run PostgreSQL Database server, the following file is required and must be created or copied to the appropriate directory on your server.
                 </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
                   Copy the postgresql script file to the <code class="filename">/etc/rc.d/init.d/</code> directory.
                 </p></li></ol></div><p>
               </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
                 You can obtain the configuration files listed below on our <code class="filename">floppy.tgz</code> archive. Copy the following files from the decompressed <code class="filename">floppy.tgz</code> archive to the appropriate places, or copy and 
                 paste them directly from this book to the concerned file.
                 </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm17352"></a>5. Configure the <code class="filename">/etc/rc.d/init.d/postgresql</code> script file</h2></div></div></div><p>
               To start and stop PostgreSQL Server, create the <code class="filename">postgresql</code> script file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/rc.d/init.d/postgresql</code> and add:
             </p><pre class="programlisting">
               #! /bin/sh
               # postgresql    This is the init script for starting up the PostgreSQL
               #               server

               # chkconfig: 345 85 15
               # description: Starts and stops the PostgreSQL backend daemon that handles \
               #              all database requests.
               # processname: postmaster
               # pidfile: /var/run/postmaster.pid
               #

               # Source function library.
               . /etc/rc.d/init.d/functions

               # Get config.
               . /etc/sysconfig/network

               # Check that networking is up.
               # Pretty much need it for postmaster.
               [ ${NETWORKING} = "no" ] &amp;&amp; exit 0

               [ -f /usr/bin/postmaster ] || exit 0

               # This script is slightly unusual in that the name of the daemon (postmaster)
               # is not the same as the name of the subsystem (postgresql)

               # See how we were called.
               case "$1" in
               start)
               echo -n "Checking postgresql installation: "
               # Check for the PGDATA structure
               if [ -f /var/lib/pgsql/PG_VERSION ] &amp;&amp; [ -d /var/lib/pgsql/base/template1 ]
               then
               # Check version of existing PGDATA

               if [ `cat /var/lib/pgsql/PG_VERSION` != '6.5' ]
               then
               echo "old version. Need to Upgrade."
               echo "See /usr/doc/postgresql-6.5.2/README.rpm for more information."
               exit 1
               else
               echo "looks good!"
               fi

               # No existing PGDATA! Initdb it.

               else
               echo "no database files found."
               if [ ! -d /var/lib/pgsql ]
               then
               mkdir -p /var/lib/pgsql
               chown postgres.postgres /var/lib/pgsql
               fi
               su -l postgres -c '/usr/bin/initdb --pglib=/usr/lib/pgsql --pgdata=/var/lib/pgsql'
               fi

               # Check for postmaster already running...
               pid=`pidof postmaster`
               if [ $pid ]
               then
               echo "Postmaster already running."
               else
               #all systems go -- remove any stale lock files
               rm -f /tmp/.s.PGSQL.* &gt; /dev/null
               echo -n "Starting postgresql service: "
               su -l postgres -c '/usr/bin/postmaster -i -S -D/var/lib/pgsql'
               sleep 1
               pid=`pidof postmaster`
               if [ $pid ]
               then
               echo -n "postmaster [$pid]"
               touch /var/lock/subsys/postgresql
               echo $pid &gt; /var/run/postmaster.pid
               echo
               else
               echo "failed."
               fi
               fi
               ;;
               stop)
               echo -n "Stopping postgresql service: "
               killproc postmaster
               sleep 2
               rm -f /var/run/postmaster.pid
               rm -f /var/lock/subsys/postgresql
               echo
               ;;
               status)
               status postmaster
               ;;
               restart)
               $0 stop
               $0 start
               ;;
               *)
               echo "Usage: postgresql {start|stop|status|restart}"
               exit 1
               esac

               exit 0
             </pre><p>
               Now, make this script executable and change its default permissions:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>chmod</strong></span> 700  /etc/rc.d/init.d/postgresql
               </pre><p>
               Create the symbolic rc.d links for PostgreSQL with the command:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>chkconfig</strong></span> --add postgresql
               </pre><p>
               </p><p>
                   Start your new PostgreSQL server manually with the following command:
                   </p><pre class="screen">
                     [root@deep] /# /etc/rc.d/init.d/postgresql <span class="command"><strong>start</strong></span>
                   </pre><p>
                   </p><pre class="literallayout"><code class="computeroutput">
                     Checking postgresql installation: looks good!
                     Starting postgresql service: postmaster [22401]
                   </code></pre><p>
                 </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm17370"></a>6. Commands often used</h2></div></div></div><p>
               The commands listed below are some that we use often, but many more exist. Check the man page for more details and information.
               To define a new user in your database, run the createuser utility program:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>su</strong></span> postgres
                 [postgres@deep /]$ <span class="command"><strong>createuser</strong></span>
               </pre><p>
               </p><pre class="literallayout"><code class="computeroutput">
                 Enter name of user to add ---&gt; admin
                 Enter user's postgres ID or RETURN to use unix user ID: 500 -&gt;
                 Is user "admin" allowed to create databases (y/n) y
                 Is user "admin" a superuser? (y/n) y
                 createuser: admin was successfully added
               </code></pre><p>
             </p><p>
               To remove a user in your database, run the destroyuser utility program:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>su</strong></span> postgres
                 [postgres@deep /]$ <span class="command"><strong>destroyuser</strong></span>
               </pre><p>
               </p><pre class="literallayout"><code class="computeroutput">
                 Enter name of user to delete ---&gt; admin
                 destroyuser: delete of user admin was successful.
               </code></pre><p>
             </p><p>
               To create a new database, run the createdb utility program:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>su</strong></span> postgres
                 [postgres@deep /]$ <span class="command"><strong>createdb</strong></span> dbname  <a name="psqldbn"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
               </pre><p>
               </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#psqldbn"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
                 dbname is the name of the database.
               </p></td></tr></table></div><p>
             </p><p>
               or with the Postgres terminal monitor program (psql)
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>su</strong></span> admin
                 [admin@deep /]$ <span class="command"><strong>psql</strong></span> template1
               </pre><p>
               </p><pre class="literallayout"><code class="computeroutput">
                 Welcome to the POSTGRESQL interactive sql monitor:
                 Please read the file COPYRIGHT for copyright terms of POSTGRESQL
                 [PostgreSQL 6.5.3 on i686-pc-linux-gnu, compiled by egcs ]

                 type \? for help on slash commands
                 type \q to quit
                 type \g or terminate with semicolon to execute query
                 You are currently connected to the database: template1
               </code></pre><p>
               </p><pre class="screen">
                 template1<span class="command"><strong>-&gt;</strong></span> <span class="command"><strong>create</strong></span> database foo;
                 CREATEDB
               </pre><p>
             </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
               Client connections can be restricted by <acronym class="acronym">IP</acronym> address and/or user name via the <code class="filename">pg_hba.conf</code> file in <code class="envar">PG_DATA</code>.
             </p></div><p>
               Other useful Postgres terminal monitor program commands (psql) are:

               To connect to the new database, use the command:
               </p><pre class="screen">
                 template1<span class="command"><strong>-&gt;</strong></span> \c foo
               </pre><p>
               connecting to new database: foo
               </p><pre class="screen">
                 foo<span class="command"><strong>-&gt;</strong></span>
               </pre><p>
             </p><p>
               To create a table, use the command:
               </p><pre class="screen">
                 foo<span class="command"><strong>-&gt;</strong></span> create table bar (i int4, c char(16));
                 <strong class="userinput"><code>CREATE</code></strong>
                 foo<span class="command"><strong>-&gt;</strong></span>
               </pre><p>
             </p><p>
               To inspect the new table, use the command:
               </p><pre class="screen">
                 foo<span class="command"><strong>-&gt;</strong></span> \d bar
               </pre><p>
               </p><pre class="screen">
                 foo<span class="command"><strong>-&gt;</strong></span>
               </pre><p>
               </p><pre class="literallayout">
                 Table    = bar
                 +----------------------------------+----------------------------------+------------+
                 |              Field	|          Type	        |                          Length  |
                 +----------------------------------+----------------------------------+------------+
                 | I	                | int4	                |                                4 |
                 | c	                | char()	        |                               16 |
                 +----------------------------------+----------------------------------+------------+
               </pre><p>

             </p><p>
               To drop a table, index, view, use the command:
               </p><pre class="screen">
                 foo<span class="command"><strong>-&gt;</strong></span> drop table table_name;
                 foo<span class="command"><strong>-&gt;</strong></span> drop index index_name;
                 foo<span class="command"><strong>-&gt;</strong></span> drop view view_name;
               </pre><p>
             </p><p>
               To insert into: <span class="emphasis"><em>once a table is created, it can be filled using the command</em></span>.
               </p><pre class="screen">
                 foo<span class="command"><strong>-&gt;</strong></span> insert into table_name (name_of_attr1, name_of_attr2, name_of_attr3)
                 foo<span class="command"><strong>-&gt;</strong></span> values (value1, value2, value3);
               </pre><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm17438"></a>7. Installed files</h2></div></div></div><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/rc.d/init.d/postgresql</code></td><td><code class="filename">/etc/rc.d/rc0.d/K15postgresql</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc1.d/K15postgresql</code></td><td><code class="filename">/etc/rc.d/rc2.d/K15postgresql</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc3.d/S85postgresql</code></td><td><code class="filename">/etc/rc.d/rc4.d/S85postgresql</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc5.d/S85postgresql</code></td><td><code class="filename">/etc/rc.d/rc6.d/K15postgresql</code></td></tr><tr><td><code class="filename">/usr/bin/postgres</code></td><td><code class="filename">/usr/bin/postmaster</code></td></tr><tr><td><code class="filename">/usr/bin/ecpg</code></td><td><code class="filename">/usr/bin/pg_id</code></td></tr><tr><td><code class="filename">/usr/bin/pg_version</code></td><td><code class="filename">/usr/bin/psql</code></td></tr><tr><td><code class="filename">/usr/bin/pg_dump</code></td><td><code class="filename">/usr/bin/pg_dumpall</code></td></tr><tr><td><code class="filename">/usr/bin/pg_upgrade</code></td><td><code class="filename">/usr/bin/pg_passwd</code></td></tr><tr><td><code class="filename">/usr/bin/cleardbdir</code></td><td><code class="filename">/usr/bin/createdb</code></td></tr><tr><td><code class="filename">/usr/bin/createlang</code></td><td><code class="filename">/usr/bin/createuser</code></td></tr><tr><td><code class="filename">/usr/bin/destroydb</code></td><td><code class="filename">/usr/bin/destroylang</code></td></tr><tr><td><code class="filename">/usr/bin/destroyuser</code></td><td><code class="filename">/usr/bin/initdb</code></td></tr><tr><td><code class="filename">/usr/bin/vacuumdb</code></td><td><code class="filename">/usr/bin/initlocation</code></td></tr><tr><td><code class="filename">/usr/bin/ipcclean</code></td><td><code class="filename">/usr/include/lib</code></td></tr><tr><td><code class="filename">/usr/include/lib/dllist.h</code></td><td><code class="filename">/usr/include/pgsql</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/access</code></td><td><code class="filename">/usr/include/pgsql/access/attnum.h</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/commands</code></td><td><code class="filename">/usr/include/pgsql/commands/trigger.h</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/executor</code></td><td><code class="filename">/usr/include/pgsql/executor/spi.h</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/libpq</code></td><td><code class="filename">/usr/include/pgsql/libpq/pqcomm.h</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/libpq/libpq-fs.h</code></td><td><code class="filename">/usr/include/pgsql/libpq++</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/libpq++/pgconnection.h</code></td><td><code class="filename">/usr/include/pgsql/libpq++/pgdatabase.h</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/libpq++/pgtransdb.h</code></td><td><code class="filename">/usr/include/pgsql/libpq++/pgcursordb.h</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/libpq++/pglobject.h</code></td><td><code class="filename">/usr/include/pgsql/port</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/port/linux</code></td><td><code class="filename">/usr/include/pgsql/utils</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/utils/geo_decls.h</code></td><td><code class="filename">/usr/include/pgsql/utils/elog.h</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/utils/palloc.h</code></td><td><code class="filename">/usr/include/pgsql/utils/mcxt.h</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/fmgr.h</code></td><td><code class="filename">/usr/include/pgsql/os.h</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/config.h</code></td><td><code class="filename">/usr/include/pgsql/c.h</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/postgres.h</code></td><td><code class="filename">/usr/include/pgsql/postgres_ext.h</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/libpq-fe.h</code></td><td><code class="filename">/usr/include/pgsql/libpq-int.h</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/ecpgerrno.h</code></td><td><code class="filename">/usr/include/pgsql/ecpglib.h</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/ecpgtype.h</code></td><td><code class="filename">/usr/include/pgsql/sqlca.h</code></td></tr><tr><td><code class="filename">/usr/include/pgsql/libpq++.H</code></td><td><code class="filename">/usr/lib/libpq.a</code></td></tr><tr><td><code class="filename">/usr/lib/libpq.so.2.0</code></td><td><code class="filename">/usr/lib/libpq.so.2</code></td></tr><tr><td><code class="filename">/usr/lib/libpq.so</code></td><td><code class="filename">/usr/lib/libecpg.a</code></td></tr><tr><td><code class="filename">/usr/lib/libecpg.so.3.0.0</code></td><td><code class="filename">/usr/lib/libecpg.so.3</code></td></tr><tr><td><code class="filename">/usr/lib/libecpg.so</code></td><td><code class="filename">/usr/lib/libpq++.a</code></td></tr><tr><td><code class="filename">/usr/lib/libpq++.so.3.0</code></td><td><code class="filename">/usr/lib/libpq++.so.3</code></td></tr><tr><td><code class="filename">/usr/lib/libpq++.so</code></td><td><code class="filename">/usr/lib/plpgsql.so</code></td></tr><tr><td><code class="filename">/usr/lib/pgsql</code></td><td><code class="filename">/usr/lib/pgsql/global1.bki.source</code></td></tr><tr><td><code class="filename">/usr/lib/pgsql/local1_template1.bki.source</code></td><td><code class="filename">/usr/lib/pgsql/pg_geqo.sample</code></td></tr><tr><td><code class="filename">/usr/lib/pgsql/pg_hba.conf.sample</code></td><td><code class="filename">/usr/man/man1/cleardbdir.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/createdb.1</code></td><td><code class="filename">/usr/man/man1/createuser.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/destroydb.1</code></td><td><code class="filename">/usr/man/man1/destroyuser.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/ecpg.1</code></td><td><code class="filename">/usr/man/man1/initdb.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/initlocation.1</code></td><td><code class="filename">/usr/man/man1/ipcclean.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/pg_dump.1</code></td><td><code class="filename">/usr/man/man1/pg_dumpall.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/pg_passwd.1</code></td><td><code class="filename">/usr/man/man1/pg_upgrade.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/postgres.1</code></td><td><code class="filename">/usr/man/man1/postmaster.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/psql.1</code></td><td><code class="filename">/usr/man/man3/catalogs.3</code></td></tr><tr><td><code class="filename">/usr/man/man3/libpq.3</code></td><td><code class="filename">/usr/man/man5/pg_hba.conf.5</code></td></tr><tr><td><code class="filename">/usr/man/manl</code></td><td><code class="filename">/usr/man/manl/abort.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/alter_table.l</code></td><td><code class="filename">/usr/man/manl/alter_user.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/begin.l</code></td><td><code class="filename">/usr/man/manl/close.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/cluster.l</code></td><td><code class="filename">/usr/man/manl/commit.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/copy.l</code></td><td><code class="filename">/usr/man/manl/create_aggregate.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/create_database.l</code></td><td><code class="filename">/usr/man/manl/create_function.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/create_index.l</code></td><td><code class="filename">/usr/man/manl/create_language.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/create_operator.l</code></td><td><code class="filename">/usr/man/manl/create_rule.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/create_sequence.l</code></td><td><code class="filename">/usr/man/manl/create_table.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/create_trigger.l</code></td><td><code class="filename">/usr/man/manl/create_type.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/create_user.l</code></td><td><code class="filename">/usr/man/manl/create_version.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/create_view.l</code></td><td><code class="filename">/usr/man/manl/declare.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/delete.l</code></td><td><code class="filename">/usr/man/manl/drop.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/drop_aggregate.l</code></td><td><code class="filename">/usr/man/manl/drop_database.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/drop_function.l</code></td><td><code class="filename">/usr/man/manl/drop_index.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/drop_language.l</code></td><td><code class="filename">/usr/man/manl/drop_operator.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/drop_rule.l</code></td><td><code class="filename">/usr/man/manl/drop_sequence.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/drop_table.l</code></td><td><code class="filename">/usr/man/manl/drop_trigger.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/drop_type.l</code></td><td><code class="filename">/usr/man/manl/drop_user.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/drop_view.l</code></td><td><code class="filename">/usr/man/manl/end.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/explain.l</code></td><td><code class="filename">/usr/man/manl/fetch.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/grant.l</code></td><td><code class="filename">/usr/man/manl/insert.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/listen.l</code></td><td><code class="filename">/usr/man/manl/load.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/lock.l</code></td><td><code class="filename">/usr/man/manl/move.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/notify.l</code></td><td><code class="filename">/usr/man/manl/reset.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/revoke.l</code></td><td><code class="filename">/usr/man/manl/rollback.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/select.l</code></td><td><code class="filename">/usr/man/manl/set.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/show.l</code></td><td><code class="filename">/usr/man/manl/sql.l</code></td></tr><tr><td><code class="filename">/usr/man/manl/update.l</code></td><td><code class="filename">/usr/man/manl/vacuum.l</code></td></tr><tr><td><code class="filename">/var/lib/pgsql</code></td><td><code class="filename">/var/lib/pgsql/base</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_proc</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_type</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_attribute</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_class</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_inherits</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_index</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_statistic</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_operator</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_opclass</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_am</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_amop</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_amproc</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_language</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_aggregate</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_ipl</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_inheritproc</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_rewrite</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_listener</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_description</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_attribute_relid_attnam_index</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_attribute_relid_attnum_index</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_attribute_attrelid_index</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_proc_oid_index</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_proc_proname_narg_type_index</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_proc_prosrc_index</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_type_oid_index</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_type_typname_index</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_class_oid_index</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_class_relname_index</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_attrdef</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_attrdef_adrelid_index</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_relcheck</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_relcheck_rcrelid_index</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_trigger</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_trigger_tgrelid_index</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_description_objoid_index</code></td><td><code class="filename">/var/lib/pgsql/base/template1/PG_VERSION</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_user</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_rules</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_views</code></td><td><code class="filename">/var/lib/pgsql/base/template1/pg_tables</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/base/template1/pg_indexes</code></td><td><code class="filename">/var/lib/pgsql/pg_variable</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/pg_database</code></td><td><code class="filename">/var/lib/pgsql/pg_shadow</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/pg_group</code></td><td><code class="filename">/var/lib/pgsql/pg_log</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/PG_VERSION</code></td><td><code class="filename">/var/lib/pgsql/pg_hba.conf</code></td></tr><tr><td><code class="filename">/var/lib/pgsql/pg_geqo.sample</code></td><td><code class="filename">/var/lib/pgsql/pg_pwd</code></td></tr></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="pr6sserprnt"></a>Chapter 28. Software -Server/Proxy Network</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#pr6ch28scsps">1. Linux Squid Proxy Server</a></span></dt><dt><span class="section"><a href="#idm17930">2. Configure and Optimize</a></span></dt><dt><span class="section"><a href="#idm18014">3. Improve performance Using GNU malloc library </a></span></dt><dt><span class="section"><a href="#idm18048">4. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm18123">5. Configurations</a></span></dt><dt><span class="section"><a href="#pr6ch28scsqcnf">6. Configure the <code class="filename">/etc/squid/squid.conf</code> file -in <code class="literal">httpd-accelerator mode</code></a></span></dt><dt><span class="section"><a href="#idm18345">7. Configure of the <code class="filename">/etc/squid/squid.conf</code> file -/proxy-caching mode</a></span></dt><dt><span class="section"><a href="#idm18388">8. Configure the <code class="filename">/etc/rc.d/init.d/squid</code> script file -/all configurations</a></span></dt><dt><span class="section"><a href="#idm18419">9. Configure the <code class="filename">/etc/logrotate.d/squid</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm18428">9.1. Securing and Immunize Squid</a></span></dt></dl></dd><dt><span class="section"><a href="#idm18456">10. Optimizing Squid</a></span></dt><dd><dl><dt><span class="section"><a href="#idm18464">10.1. The cachemgr.cgi </a></span></dt></dl></dd><dt><span class="section"><a href="#idm18503">11. Netscape Proxies Configuration</a></span></dt><dt><span class="section"><a href="#idm18550">12. Installed files</a></span></dt></dl></div><div class="highlights"><p>
             Proxy-servers, with their capability to save bandwidth, improve security, and increase web-surfing speed are becoming more popular than ever. At this time only a few proxy-server programs are available. These proxy-servers have two main drawbacks: 
             </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
               They are commercial.
             </td></tr><tr><td>
             They don't support <acronym class="acronym">ICP</acronym>, <span class="emphasis"><em><acronym class="acronym">ICP</acronym> is used to exchange hints about the existence of URLs in neighbor caches</em></span> .
             </td></tr></table><p>
             Squid is the best choice for a proxy-cache server since it is robust, free, and can use <acronym class="acronym">ICP</acronym> features.
           </p><p>
             Derived from the <code class="literal">cached</code> software from the <acronym class="acronym">ARPA</acronym>-funded Harvest research project, developed at the National Laboratory for Applied Network Research and funded by the National Science Foundation, Squid 
             offers high-performance caching of web clients, and also supports <acronym class="acronym">FTP</acronym>, Gopher, and <acronym class="acronym">HTTP</acronym> data objects. It stores hot objects in <acronym class="acronym">RAM</acronym>, maintains a robust database of objects on disk, has 
             a complex access control mechanism, and supports the <acronym class="acronym">SSL</acronym> protocol for proxying secure connections. In addition, it can be hierarchically linked to other Squid-based proxy servers for streamlined caching of pages.
           </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch28scsps"></a>1. Linux Squid Proxy Server</h2></div></div></div><p>
               In our compilation and configuration we'll configure Squid to run as an httpd-accelerator to get more performance out of our web server. In accelerator mode, the Squid server acts as a reverse proxy cache: it accepts client 
               requests, serves them out of cache, if possible, or requests them from the original server for which it is the reverse proxy. Also we'll show you how to configure Squid as a proxy-caching server to be able to let all users 
               in your corporate network use Squid to access the Internet.
             </p><p>
               These installation instructions assume
               </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                 Commands are Unix-compatible.
               </p></li><li class="listitem"><p>
               The source path is <code class="filename">/var/tmp</code>, <span class="emphasis"><em>other paths are possible</em></span>.
               </p></li><li class="listitem"><p>
               Installations were tested on Red Hat Linux 6.1 and 6.2.
               </p></li><li class="listitem"><p>
               All steps in the installation will happen in super-user account <code class="literal">root.</code>
               </p></li><li class="listitem"><p>
               Squid version number is 2.3.STABLE2
               </p></li></ul></div><p>
             </p><p>
               These are Package(s) and are available here:
               </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                   Squid Homepage:<a class="link" href="#prtinxfp28" title="Linux Squid Proxy Server">http://www.squid-cache.org/</a> 
                 </td></tr><tr><td>
                 Squid <acronym class="acronym">FTP</acronym> Site: <a class="link" href="#prtinxfp28" title="Linux Squid Proxy Server">204.144.128.89</a>
                 </td></tr><tr><td>
                 You must be sure to download: squid-2.3.STABLE2-src.tar.gz
                 </td></tr></table><p>
             </p><p>
               Before you decompress tarballs, it is a good idea to make a list of files on the system before you install Squid, and one afterwards, and then compare them using diff to find out what file it placed where. Simply 
               run <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Squid1</code></strong> before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Squid2</code></strong> after you install the software, and use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>Squid1 Squid2 &gt; Squid-Installed</code></strong> 
               to get a list of what changed.
             </p><p>
               To Compile, you need to decompress the tarball, <code class="literal">tar.gz.</code>:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>cp</strong></span> squid-version.STABLEz-src.tar.gz /var/tmp
                 [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
                 [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf squid-version.STABLEz-src.tar.gz
               </pre><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm17930"></a>2. Configure and Optimize</h2></div></div></div><p>
               Squid Proxy Server can't run as super-user root, and for this reason we must create a special user with no shell for running Squid Proxy Server.
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>useradd</strong></span> -d /cache/ -r -s /dev/null squid &gt;/dev/null 2&gt;&amp;1
                 [root@deep] /# <span class="command"><strong>mkdir</strong></span> /cache/
                 [root@deep] /# <span class="command"><strong>chown</strong></span> -R squid.squid /cache/
               </pre><p>
               First of all, we add the user <code class="literal">squid</code> to the <code class="filename">/etc/passwd</code> file. Then, we create the <code class="filename">/cache</code> directory if this directory doesn't exist, <span class="emphasis"><em>we repeat only if 
               it doesn't exist</em></span>. Finally, we change the owner of the directory <code class="filename">cache</code> to be the user <code class="literal">squid</code>.
             </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
               Usually we don't need to perform the command, <span class="command"><strong>mkdir</strong></span> <code class="filename">/cache/</code>, because we have already created this directory when we partitioned our hard drive during the installation of Linux. If this 
               partition doesn't exist, you must execute this command to create the directory.
             </p></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
                 Move into the new Squid directory and type the following commands on your terminal:
               
                 Edit the <code class="filename">Makefile.in</code> file, <span class="command"><strong>vi</strong></span> +18 <code class="filename">icons/Makefile.in</code> and change the line:
                 </p><pre class="programlisting">
                   DEFAULT_ICON_DIR  =  $(sysconfdir)/icons
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   DEFAULT_ICON_DIR  =  $(libexecdir)/icons
                 </pre><p>
               </p></li><li class="step"><p>
                 We change the variable, <code class="envar">sysconfdir</code> to be <code class="envar">libexecdir</code>. With this modification, the <code class="filename">icons</code> directory of Squid will be located under the <code class="filename">/usr/lib/squid</code> directory.
                </p><ol type="a" class="substeps"><li class="step"><p>
                     Edit the <code class="filename">Makefile.in</code> file, <span class="command"><strong>vi</strong></span> +34 <code class="filename">src/Makefile.in</code> and change the lines:
                     </p><pre class="programlisting">
                       DEFAULT_CACHE_LOG  =  <code class="prompt">$</code>(localstatedir)/logs/cache.log
                     </pre><p>
                     To read:
                     </p><pre class="programlisting">
                       DEFAULT_CACHE_LOG  =  <code class="prompt">$</code>(localstatedir)/log/squid/cache.log
                     </pre><p>
                   </p></li><li class="step"><p>
                   </p><pre class="programlisting">
                     DEFAULT_ACCESS_LOG  =  <code class="prompt">$</code>(localstatedir)/logs/access.log
                   </pre><p>
                   To read:
                   </p><pre class="programlisting">
                     DEFAULT_ACCESS_LOG  =  <code class="prompt">$</code>(localstatedir)/log/squid/access.log
                   </pre><p>
                   </p></li><li class="step"><p>
                   </p><pre class="programlisting">
                     DEFAULT_STORE_LOG  =  <code class="prompt">$</code>(localstatedir)/logs/store.log
                   </pre><p>
                   To read:
                   </p><pre class="programlisting">
                     DEFAULT_STORE_LOG  =  <code class="prompt">$</code>(localstatedir)/log/squid/store.log
                   </pre><p>
                   </p></li><li class="step"><p>
                   </p><pre class="programlisting">
                     DEFAULT_PID_FILE  =  <code class="prompt">$</code>(localstatedir)/logs/squid.pid
                   </pre><p>
                   To read:
                   </p><pre class="programlisting">
                     DEFAULT_PID_FILE  =  <code class="prompt">$</code>(localstatedir)/run/squid.pid
                   </pre><p>
                   </p></li><li class="step"><p>
                   </p><pre class="programlisting">
                     DEFAULT_SWAP_DIR  =  <code class="prompt">$</code>(localstatedir)/cache
                   </pre><p>
                   To read:
                   </p><pre class="programlisting">
                     DEFAULT_SWAP_DIR  =  /cache
                   </pre><p>
                   </p></li><li class="step"><p>
                   </p><pre class="programlisting">
                     DEFAULT_ICON_DIR  =  <code class="prompt">$</code>(sysconfdir)/icons
                   </pre><p>
                   To read:
                   </p><pre class="programlisting">
                     DEFAULT_ICON_DIR  =  <code class="prompt">$</code>(libexecdir)/icons
                   </pre><p>
                   We change the default location of <code class="filename">cache.log,</code> <code class="filename">access.log,</code> and <code class="filename">store.log</code> files to be located under <code class="filename">/var/log/squid</code> directory. Then, we put the pid file of Squid under <code class="filename">/var/run</code> 
                   directory, and finally, locate the <code class="filename">icons</code> directory of Squid under <code class="filename">/usr/lib/squid/icons</code> with the variable <code class="envar">libexecdir</code> above.

                   </p></li></ol></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm18014"></a>3. Improve performance Using GNU malloc library </h2></div></div></div><p>
               If you're suffering from memory limitations on your system, the cache performance of Squid will be affected. To reduce this problem, you can link Squid with an external malloc library such as GNU malloc. To make 
               Squid use GNU malloc as an external library, follows these simple steps:
             </p><p>
               These are the Package(s) required:
               </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                 GNU malloc Homepage:<a class="link" href="#prtinxfp28" title="Linux Squid Proxy Server"> http://www.gnu.org/order/ftp.html</a>
               </td></tr><tr><td>
               You must be sure to download: malloc.tar.gz
               </td></tr></table><p>
             </p><p>
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>cp</strong></span> malloc.tar.gz /var/tmp
                 [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
                 [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf malloc.tar.gz
               </pre><p>
             </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
                 Compile and install GNU malloc on your system by executing the following commands:
                 </p><pre class="screen">
                   [root@deep ]/tmp# <span class="command"><strong>cd</strong></span> malloc
                   [root@deep ]/malloc# <span class="command"><strong>export</strong></span> CC=egcs
                   [root@deep ]/malloc# <span class="command"><strong>make</strong></span>
                 </pre><p>
               </p></li><li class="step"><p>

                 Copy the <code class="filename">libmalloc.a</code> file to your system library directory and be sure to name it <code class="filename">libgnumalloc.a</code>
                 </p><pre class="screen">
                   [root@deep ]/malloc# <span class="command"><strong>cp</strong></span> libmalloc.a /usr/lib/libgnumalloc.a
                 </pre><p>
               </p></li><li class="step"><p>
                 Copy the <code class="filename">malloc.h</code> file to your system's include directory and be sure to name it <code class="filename">gnumalloc.h</code>
                 </p><pre class="screen">
                   [root@deep ]/malloc# <span class="command"><strong>cp</strong></span> malloc.h /usr/include/gnumalloc.h
                 </pre><p>
                 With the files <code class="filename">libgnumalloc.a</code> and <code class="filename">gnumalloc.h</code> installed on your system, Squid will detect them automatically during its compile time, and will use them to improve its cache performance.
               </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm18048"></a>4. Compile and Optimize</h2></div></div></div><p>
               Return into the new Squid directory and type the following commands on your terminal:
               </p><pre class="screen">
                 CC="egcs" \
                 CFLAGS="-O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions" \
                 ./configure \
                 --prefix=/usr \
                 --exec-prefix=/usr \
                 --bindir=/usr/sbin \
                 --libexecdir=/usr/lib/squid \
                 --localstatedir=/var \
                 --sysconfdir=/etc/squid \
                 --enable-delay-pools \
                 --enable-cache-digests \
                 --enable-poll \
                 --disable-ident-lookups \
                 --enable-truncate \
                 --enable-heap-replacement
               </pre><p>
             </p><p>
               This tells Squid to set itself up for this particular hardware setup with these options:
               </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                   Use the delay pools feature of Squid to limit and control bandwidth usage for users.
                 </p></li><li class="listitem"><p>
                 Use Cache Digests to improve client response time and network utilization.
             </p></li><li class="listitem"><p>
             Enable poll() instead of select() since its preferred over select.
             </p></li><li class="listitem"><p>
             Disable ident-lookups to remove code that performs Ident, <code class="literal">RFC 931</code>, lookups and reduce possible denial-of-service.
             </p></li><li class="listitem"><p>
             Enable truncate to glean some performance improvements when removing cached files.
             </p></li><li class="listitem"><p>
             Use the heap-replacement feature of Squid to have the choice of various cache replacement algorithms, instead of the standard LRU algorithm for better performance. See below for a more detailed explanation.
             </p></li></ul></div><p>
             </p><p>
               Now, we must compile and install Squid on the server:
               </p><pre class="screen">
                 [root@deep ]/squid-2.3.STABLE2# <span class="command"><strong>make</strong></span> -f  makefile
                 [root@deep ]/squid-2.3.STABLE2# <span class="command"><strong>make install</strong></span>
                 [root@deep ]/squid-2.3.STABLE2# <span class="command"><strong>mkdir</strong></span> -p /var/log/squid
                 [root@deep ]/squid-2.3.STABLE2# <span class="command"><strong>rm</strong></span> -rf /var/logs/
                 [root@deep ]/squid-2.3.STABLE2# <span class="command"><strong>chown</strong></span> squid.squid /var/log/squid/
                 [root@deep ]/squid-2.3.STABLE2# <span class="command"><strong>chmod</strong></span> 750 /var/log/squid/
                 [root@deep ]/squid-2.3.STABLE2# <span class="command"><strong>chmod</strong></span> 750 /cache/
                 [root@deep ]/squid-2.3.STABLE2# <span class="command"><strong>rm</strong></span> -f  /usr/sbin/RunCache
                 [root@deep ]/squid-2.3.STABLE2# <span class="command"><strong>rm</strong></span> -f  /usr/sbin/RunAccel
                 [root@deep ]/squid-2.3.STABLE2# <span class="command"><strong>strip</strong></span> /usr/sbin/squid
                 [root@deep ]/squid-2.3.STABLE2# <span class="command"><strong>strip</strong></span> /usr/sbin/client
                 [root@deep ]/squid-2.3.STABLE2# <span class="command"><strong>strip</strong></span> /usr/lib/squid/dnsserver
                 [root@deep ]/squid-2.3.STABLE2# <span class="command"><strong>strip</strong></span> /usr/lib/squid/unlinkd
                 [root@deep ]/squid-2.3.STABLE2# <span class="command"><strong>strip</strong></span> /usr/lib/squid/cachemgr.cgi
               </pre><p>
               </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                   The <span class="command"><strong>make</strong></span> -f  command will compile all source files into executable binaries
                 </p></li><li class="listitem"><p>
                 The <span class="command"><strong>make install</strong></span> will install the binaries and any supporting files into the appropriate locations. 
                 </p></li><li class="listitem"><p>
                 The <span class="command"><strong>mkdir</strong></span> command will create a new directory named <code class="filename">squid</code> under <code class="filename">/var/log.</code> 
                 </p></li><li class="listitem"><p>
                 The <span class="command"><strong>rm</strong></span> -rf command will remove the <code class="filename">/var/logs</code> directory since this directory has been created to handle the log files related to Squid that we have moved to the <code class="filename">/var/log/squid</code> location. 
                 </p></li><li class="listitem"><p>
                 The <span class="command"><strong>chown</strong></span> will change the owner of <code class="filename">/var/log/squid</code> to be the user squid
                 </p></li><li class="listitem"><p>
                 The <span class="command"><strong>chmod</strong></span> command will make the mode of <code class="filename">squid</code> and <code class="filename">cache</code> directories; <code class="literal">0750/drwxr-x---</code>, for security reasons.
                 </p></li></ul></div><p>
               Take note that we remove the small scripts named <code class="filename">RunCache</code> and <code class="filename">RunAccel</code> which start Squid in either caching mode or accelerator mode, since we use a better script named <code class="filename">squid</code> located 
               under the <code class="filename">/etc/rc.d/init.d/</code> directory that takes advantage of Linux <code class="literal">system V</code>. 
               The <span class="command"><strong>strip</strong></span> command will reduce the size of binaries for optimum performance.
             </p><p>
               Please do cleanup later:
               </p><pre class="screen">
                 [root@deep] /# <span class="command"><strong>cd</strong></span> /var/tmp
                 [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf squid-version/ squid-version.STABLEz-src.tar.gz
                 [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf malloc/ malloc.tar.gz (if you used the GNU malloc external library)
               </pre><p>
               The <span class="command"><strong>rm</strong></span> command will remove all the source files we have used to compile and install Squid and GNU malloc. It will also remove the Squid and GNU malloc compressed archive from the <code class="filename">/var/tmp</code> 
               directory.
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm18123"></a>5. Configurations</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
                 All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
                 You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
                 for respective software. For example <em class="wordasword">Squid</em> configuration file are organised like this:
                 </p><pre class="literallayout"><code class="computeroutput">
                   total 20
                   -rw-r--r--    1 harrypotter    harrypotter         428 Jun  8 13:00 Compile-Squid
                   drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 init.d/
                   drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 logrotate.d/
                   -rw-r--r--    1 harrypotter    harrypotter         461 Jun  8 13:00 squid.conf
                   -rwx------    1 harrypotter    harrypotter         319 Jun  8 13:00 squid.sh*
                 </code></pre><p>
                 You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
                 responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
               </p></div><p>
               To run Squid server in <code class="literal">httpd-accelerator</code> mode, the following files are required and must be created or copied to the appropriate directories on your server.
               </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
                   Copy the <code class="filename">squid.conf</code> file in the <code class="filename">/etc/squid/</code> directory.
                 </p></li><li class="listitem"><p>
                 Copy the <code class="filename">squid</code> script file in the <code class="filename">/etc/rc.d/init.d/</code> directory.
                 </p></li><li class="listitem"><p>
                 Copy the <code class="filename">squid</code> file in the <code class="filename">/etc/logrotate.d/</code> directory.
                 </p></li></ol></div><p>
             </p><p>
             To run Squid server in <code class="literal">proxy-caching</code> mode, the following files are required and must be created or copied to the appropriate directories on your server.

             </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
                 Copy the <code class="filename">squid.conf</code> file in the <code class="filename">/etc/squid/</code> directory.
               </p></li><li class="listitem"><p>
               Copy the <code class="filename">squid</code> script file in the <code class="filename">/etc/rc.d/init.d/</code> directory.
               </p></li><li class="listitem"><p>
               Copy the <code class="filename">squid</code> file in the <code class="filename">/etc/logrotate.d/</code> directory.
               </p></li></ol></div><p>
             </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
               You can obtain the configuration files listed below on our <code class="filename">floppy.tgz</code> archive. Copy the following files from the decompressed <code class="filename">floppy.tgz</code> archive to the appropriate places, or copy and 
               paste them directly from this book to the concerned file.
             </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch28scsqcnf"></a>6. Configure the <code class="filename">/etc/squid/squid.conf</code> file -in <code class="literal">httpd-accelerator mode</code></h2></div></div></div><p>
               The <code class="filename">squid.conf</code> file is used to set and configure all the different options for your Squid proxy server. In the configuration file below, we'll configure the <code class="filename">/etc/squid/squid.conf</code> file 
               to be in <code class="literal">httpd-accelerator</code> mode. In this acceleration mode, if the Web Server runs on the same server where Squid is installed, you must set its daemon to run on port 81. With the Apache web server, you can 
               do it by assigning the line <code class="literal">Port 80</code> to <code class="literal">Port 81</code> in its <code class="filename">httpd.conf</code> file. If the Web Server runs on other servers in your network like we do, you can keep the same port 
               number (80) for Apache, since Squid will bind on a different IP number where port (80) is not already in use.
               </p><div class="mediaobject"><img src="./images/Squid-Accelerator-Schema.gif" alt="Squid/Accelerator"></div><p>
             </p><p>
               Edit the <code class="filename">squid.conf file</code>, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/squid/squid.conf</code> and add/change the following options:
               </p><pre class="programlisting">
                 http_port 80
                 icp_port 0
                 acl QUERY urlpath_regex cgi-bin \?
                 no_cache deny QUERY
                 cache_mem 16 MB
                 cache_dir ufs /cache 200 16 256
                 emulate_httpd_log on
                 redirect_rewrites_host_header off
                 replacement_policy GDSF
                 acl all src 0.0.0.0/0.0.0.0
                 http_access allow all
                 cache_mgr admin@openna.com
                 cache_effective_user squid
                 cache_effective_group squid
                 httpd_accel_host 208.164.186.3
                 httpd_accel_port 80
                 log_icp_queries off
                 cachemgr_passwd my-secret-pass all
                 buffered_logs on
               </pre><p>

               This tells the <code class="filename">squid.conf</code> file to set itself up for this particular configuration setup with:
               </p><div class="glosslist"><dl><dt><span class="glossterm"><code class="envar">http_port</code> 80</span></dt><dd class="glossdef"><p>
                     The option <code class="envar">http_port</code> specifies the port number where Squid will listen for <acronym class="acronym">HTTP</acronym> client requests. If you set this option to port 80, the client will have the illusion of being connected 
                     to the Apache Web Server. Since we are running Squid in accelerator mode, we must listen on port 80.
                   </p></dd><dt><span class="glossterm"><code class="envar">icp_port 0</code></span></dt><dd class="glossdef"><p>
                   The option <code class="envar">icp_port</code> specifies the port number where Squid will sends and receive <acronym class="acronym">ICP</acronym> requests from neighboring caches. We must set the value of this option to 0 to disable it, since we 
                   are configuring Squid to be in accelerator mode for the Web Server. The <acronym class="acronym">ICP</acronym> feature is needed only in a multi-level cache environment with multiple siblings and parent caches. Using <acronym class="acronym">ICP</acronym> 
                   in an accelerator mode configuration would add unwanted overhead to Squid.
                 </p></dd><dt><span class="glossterm"><code class="envar">acl QUERY urlpath_regex cgi-bin \? and no_cache deny QUERY</code></span></dt><dd class="glossdef"><p>
                   The options <code class="envar">acl QUERY urlpath_regex cgi-bin \? and no_cache deny QUERY</code> are used to force certain objects to never be cached, like files under <code class="filename">cgi-bin</code> directory. This 
                   is a security feature.
                 </p></dd><dt><span class="glossterm"><code class="envar">cache_mem 16 MB</code></span></dt><dd class="glossdef"><p>
                   The option <code class="envar">cache_mem</code> specifies the amount of memory; 
                   <acronym class="acronym">RAM</acronym>, to be used for caching the so called: 
                   In-Transit objects, 
                   Hot Objects, 
                   Negative-Cached objects. 
                   This is an optimization feature. It's important to note that Squid can uses much more memory than the value you specify in this parameter, and for this reason if you have 48 MB free for Squid, you must put 48/3 = 16 MB here.
                 </p></dd><dt><span class="glossterm"><code class="envar">cache_dir ufs /cache 200 16 256</code></span></dt><dd class="glossdef"><p>
                   The option <code class="envar">cache_dir</code> specifies in this order: 
                   which kind of storage system to use; ufs, 
                   the name of the cache directory; <code class="filename">/cache</code> for Squid, 
                   the disk space in megabytes to use under this directory <span class="emphasis"><em>200 Mbytes</em></span>, 
                   the number of first-level subdirectories to be created under the cache directory; 16 Level-1, 
                   and the number of second-level subdirectories to be created under each first-level cache directory; 256 Level-2. 
                   In accelerator mode, this option is directly related to the size and number of files that you want to serve with your Apache web server.
                 </p></dd><dt><span class="glossterm"><code class="envar">emulate_httpd_log on</code></span></dt><dd class="glossdef"><p>
                   The option <code class="envar">emulate_httpd_log,</code> if set to <code class="envar">ON,</code> specifies that Squid should emulate the log file format of the Apache web server. This is very useful if you want to use a third party program like Webalizer 
                   to analyze the Web Server <code class="literal">httpd</code> log file.
                 </p></dd><dt><span class="glossterm"><code class="envar">redirect_rewrites_host_header off</code></span></dt><dd class="glossdef"><p>
                   The option <code class="envar">redirect_rewrites_host_header</code>, if set to <code class="envar">OFF,</code> tells Squid to not rewrites any Host: header in redirected requests. It's recommended to set this option to <code class="envar">OFF</code> if you are running Squid 
                   in accelerator mode.
                 </p></dd><dt><span class="glossterm"><code class="envar">replacement_policy GDSF</code></span></dt><dd class="glossdef"><p>
                   The option <code class="envar">replacement_policy</code> specifies the cache policy Squid will use to determine which objects in the cache must be replaced when the proxy need to make disk space. The Squid LRU policy is used by default if you 
                   have not specified the  <code class="literal">--enable-heap-replacement</code> option during compile time. In our configuration, we choose the GDSF -<span class="emphasis"><em>Greedy-Dual Size Frequency</em></span> policy as our default policy. See 
                   <a class="link" href="#prtinxfp28sqc" title="Configure the /etc/squid/squid.conf file -in httpd-accelerator mode">http://www.hpl.hp.com/techreports/1999/HPL-1999-69.html</a> and <a class="link" href="#prtinxfp28sqc" title="Configure the /etc/squid/squid.conf file -in httpd-accelerator mode">http://fog.hpl.external.hp.com/techreports/98/HPL-98-173.html</a> for more information.
                 </p></dd><dt><span class="glossterm"><code class="envar">acl all src 0.0.0.0/0.0.0.0</code> and <code class="envar">http_access allow all</code></span></dt><dd class="glossdef"><p>
                   The options <code class="envar">acl</code> and <code class="envar">http_access</code> specify and define an access control list to be applied on the proxy server Squid. Our <code class="envar">acl</code> and <code class="envar">http_access</code> options are not restricted, and 
                   allow every one to connect on the proxy server since we use this proxy to accelerate the public Apache Web Server. See your Squid documentation for more information when using Squid in non-accelerator mode.
                 </p></dd><dt><span class="glossterm"><code class="envar">cache_mgr admin</code></span></dt><dd class="glossdef"><p>
                   The option <code class="envar">cache_mgr</code> specify the email-address of the administrator responsible for the Squid proxy server. This person is the one who will receive mail if Squid encounter problems. You can specify the name or the 
                   complete email address in this option.
                 </p></dd><dt><span class="glossterm"><code class="envar">cache_effective_user squid</code> and <code class="envar">cache_effective_group squid</code></span></dt><dd class="glossdef"><p>
                   The options <code class="envar">cache_effective_user</code> and <code class="envar">cache_effective_group</code> specify the <acronym class="acronym">UID/GID</acronym> that the cache will run on. Don't forget to never run Squid as <code class="literal">root</code>. In our 
                   configuration we use the <acronym class="acronym">UID</acronym> <code class="literal">squid</code> and the <acronym class="acronym">GID</acronym> <code class="literal">squid</code>.
                 </p></dd><dt><span class="glossterm"><code class="envar">httpd_accel_host 208.164.186.3</code> and <code class="envar">httpd_accel_port 80</code></span></dt><dd class="glossdef"><p>
                   The options <code class="envar">httpd_accel_host</code> and <code class="envar">httpd_accel_port</code> specify to Squid the <acronym class="acronym">IP</acronym> address and port number where the real <acronym class="acronym">HTTP</acronym> Server <abbr class="abbrev">i.e.</abbr> Apache is. In 
                   our configuration, the real <acronym class="acronym">HTTP</acronym> Web Server is on the <acronym class="acronym">IP</acronym> address <code class="literal">208.164.186.3</code>, <code class="literal">www.openna.com</code> and on port (80). <code class="literal">www.openna.com</code> is 
                   another host name on our network, and since the Squid Proxy Server doesn't reside on the same host of Apache <acronym class="acronym">HTTP</acronym> Web Server, we can use port (80) for our Squid Proxy Server, and port (80) for our Apache Web 
                   Server, and the illusion is perfect.
                 </p></dd><dt><span class="glossterm"><code class="envar">log_icp_queries off</code></span></dt><dd class="glossdef"><p>
                   The option <code class="envar">log_icp_queries</code> specifies if you want <acronym class="acronym">ICP</acronym>; <span class="emphasis"><em><acronym class="acronym">ICP</acronym> is used to exchange hints about the existence of <acronym class="acronym">URL</acronym>s in neighbor caches</em></span> queries 
                   to be logged to the <code class="filename">access.log</code> file or not. Since we don't use the <acronym class="acronym">ICP</acronym> feature in Squid accelerator mode, we can safely set this option to <code class="envar">OFF</code>.
                 </p></dd><dt><span class="glossterm"><code class="envar">cachemgr_passwd my-secret-pass all</code></span></dt><dd class="glossdef"><p>
                   The option <code class="envar">cachemgr_passwd</code> specifies a password that will be required for accessing the operations of the <code class="filename">cachemgr.cgi</code> program utility. This <acronym class="acronym">CGI</acronym> utility program is designed to run 
                   through a web interface and outputs statistics about the Squid configuration and performance. The <code class="filename">my-secret-pass</code> is the password that you have chosen, and the keyword <code class="envar">all</code> specifies to set this 
                   password to be the same for all actions you can perform with this program. See The cachemgr.cgi program utility of Squid, below in this chapter for more information.
                 </p></dd><dt><span class="glossterm"><code class="envar">buffered_logs on</code></span></dt><dd class="glossdef"><p>
                   The option <code class="envar">buffered_logs</code>, if turned <code class="envar">ON</code>, can speed up the writing of some log files slightly. This is an optimization feature.
                 </p></dd></dl></div><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm18345"></a>7. Configure of the <code class="filename">/etc/squid/squid.conf</code> file -/proxy-caching mode</h2></div></div></div><p>
               With some minor modification to the <code class="filename">squid.conf</code> file we have defined above to run in <code class="literal">httpd-accelerator</code> mode, we can run Squid as a proxy-caching server. With a proxy cache server, all users 
               in your corporate network use Squid to access the Internet. With this configuration, you can have complete control, and apply special policies on what can be viewed, accessed, and downloaded. You can also control bandwidth 
               usage, connection time, and so on. A proxy cache server can be configured to run as stand-alone server for your corporation, or to use and share caches hierarchically with other proxy servers around the Internet.
               </p><div class="mediaobject"><img src="./images/Squid-Stand-Alone-Schema.gif" alt="Squid-StandAlone"></div><p>
             </p><p>
               With the first example below we show you how to configure Squid as a stand-alone server, and then speak a little bit about a cache hierarchy configuration, where two or more proxy-cache servers cooperate by serving documents to each other.
               Edit the <code class="filename">squid.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/squid/squid.conf</code> and add/change the following options for proxy cache that run as a stand-alone server:
               </p><pre class="programlisting">
                 http_port 8080
                 icp_port 0
                 acl QUERY urlpath_regex cgi-bin \?
                 no_cache deny QUERY
                 cache_mem 16 MB
                 cache_dir ufs /cache 200 16 256
                 redirect_rewrites_host_header off
                 replacement_policy GDSF
                 acl localnet src 192.168.1.0/255.255.255.0
                 acl localhost src 127.0.0.1/255.255.255.255
                 acl Safe_ports port 80 443 210 119 70 21 1025-65535
                 acl CONNECT method CONNECT
                 acl all src 0.0.0.0/0.0.0.0
                 http_access allow localnet
                 http_access allow localhost
                 http_access deny !Safe_ports
                 http_access deny CONNECT
                 http_access deny all
                 cache_mgr admin@openna.com
                 cache_effective_user squid
                 cache_effective_group squid
                 log_icp_queries off
                 cachemgr_passwd my-secret-pass all
                 buffered_logs on
               </pre><p>
             </p><p>
               The big difference with the <code class="literal">httpd-accellerator</code> mode configuration is the use of access control lists (ACL). This feature allows you to restrict access based on source <acronym class="acronym">IP</acronym> address (src), destination 
               <acronym class="acronym">IP</acronym> address (dst), source domain, destination domain, time, and so on. Many types exist with this feature, and you should consult the <code class="filename">Squid.conf</code> file for a complete list. The four most used types 
               are as follows:
               </p><div class="literallayout"><p><br>
                   acl	 name   type    data<br>
                   |	    |	   |	   |<br>
                   acl some-name src a.b.c.d/e.f.g.h 	# ACL restrict access based on source IP address <br>
                   acl some-name dst a.b.c.d/e.f.g.h 	# ACL restrict access based on destination IP address <br>
                   acl some-name srcdomain foo.com 	# ACL restrict access based on source domain <br>
                   acl some-name dstdomain foo.com 	# ACL restrict access based on destination domain<br>
                 </p></div><p>
             </p><p>
               As an example, to restrict access to your Squid proxy server to only your internal clients, and to a specific range of designated ports, something like the following will make the job:
               </p><pre class="programlisting">
                 acl localnet src 192.168.1.0/255.255.255.0
                 acl localhost src 127.0.0.1/255.255.255.255
                 acl Safe_ports port 80 443 210 119 70 21 1025-65535
                 acl CONNECT method CONNECT
                 acl all src 0.0.0.0/0.0.0.0
                 http_access allow localnet
                 http_access allow localhost
                 http_access deny !Safe_ports
                 http_access deny CONNECT
                 http_access deny all
               </pre><p>
             </p><p>
             This acl configuration will allow all internal clients from the private class C 192.168.1.0 to access the proxy server; it's also recommended that you allow the localhost IP (a special IP address used by your own server) to access 
             the proxy. After we choose a range of ports (80=http, 443=https, 210=wais, 119=nntp, 70=gopher, and 21=ftp) which our internal clients can use to access the Internet, we deny the <code class="envar">CONNECT</code> method to prevent outside people 
             from trying to connect to the proxy server, and finally, we deny all source IP address and ports on the proxy server.
             </p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Multi-level Web Caching</b></p></div></div></div><p>
                 The second method of proxy cache is the so-called <em class="wordasword">Multi-level Web Caching</em> where you choose to share and cooperate with more proxy-cache servers on the Internet. With this method, your organization uses the cache 
                 of many others proxy cache servers, and to compensate, the other cache server can use yours. It's important to note that in this situation, the proxy cache can play two different roles in the hierarchy. It can be configured to be a sibling 
                 cache, and be able to only serve documents it already has, or it can be configured as a parent cache, and be able to get documents from another cache or from the source directly.
<span class="inlinemediaobject"><img src="./images/Squid-Hierarchy-Schema.gif" alt="Squid-Hierarchy"></span>
               </p></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
                 <span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>    
               </h3><p>
               A good strategy to avoid generating more network traffic than without web caching is to choose to have several sibling caches and only a small number of parent caches.
               </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm18388"></a>8. Configure the <code class="filename">/etc/rc.d/init.d/squid</code> script file -/all configurations</h2></div></div></div><p>
               Configure your <code class="filename">/etc/rc.d/init.d/squid</code> script file to start and stop the Squid Internet Object Cache. This script has been modified to setup swap cache for Squid in <code class="filename">/cache</code> instead 
               of <code class="filename">/var/spool/squid</code>.
               Create the <code class="filename">squid</code> script file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/rc.d/init.d/squid</code> and add:
             </p><pre class="programlisting">
               #!/bin/bash
               # squid		This shell script takes care of starting and stopping
               #		Squid Internet Object Cache
               #
               # chkconfig: - 90 25
               # description: Squid - Internet Object Cache. Internet object caching is \
               # 	a way to store requested Internet objects (i.e., data available \
               # 	via the <acronym class="acronym">HTTP</acronym>, <acronym class="acronym">FTP</acronym>, and gopher protocols) on a system closer to the \
               #	requesting site than to the source. Web browsers can then use the \
               #	local Squid cache as a proxy <acronym class="acronym">HTTP</acronym> server, reducing access time as \
               #	well as bandwidth consumption.
               # pidfile: /var/run/squid.pid
               # config: /etc/squid/squid.conf

               PATH=/usr/bin:/sbin:/bin:/usr/sbin
               export PATH

               # Source function library.
               . /etc/rc.d/init.d/functions

               # Source networking configuration.
               . /etc/sysconfig/network

               # Check that networking is up.
               [ <code class="prompt">$</code>{NETWORKING} = "no" ] &amp;&amp; exit 0

               # check if the squid conf file is present
               [ -f /etc/squid/squid.conf ] || exit 0

               # determine the name of the squid binary
               [ -f /usr/sbin/squid ] &amp;&amp; SQUID=squid
               [ -z "$SQUID" ] &amp;&amp; exit 0

               # determine which one is the cache_swap directory
               CACHE_SWAP=`sed -e 's/#.*//g' /etc/squid/squid.conf | \
               grep cache_dir | sed -e 's/cache_dir//' | \
               cut -d ' ' -f 2`
               [ -z "$CACHE_SWAP" ] &amp;&amp; CACHE_SWAP=/cache

               # default squid options
               # -D disables initial dns checks. If you most likely will not to have an
               #    internet connection when you start squid, uncomment this
               #SQUID_OPTS="-D"

               RETVAL=0
               case "$1" in
               start)
               echo -n "Starting $SQUID: "
               for adir in $CACHE_SWAP; do
               if [ ! -d $adir/00 ]; then 
               echo -n "init_cache_dir $adir... "
               $SQUID -z -F 2&gt;/dev/null
               fi
               done
               $SQUID $SQUID_OPTS &amp;
               RETVAL=<code class="prompt">$</code>?
               echo $SQUID
               [ $RETVAL -eq 0 ] &amp;&amp; touch /var/lock/subsys/$SQUID
               ;;

               stop)
               echo -n "Stopping $SQUID: "
               $SQUID -k shutdown &amp;
               RETVAL=<code class="prompt">$</code>?
               if [ $RETVAL -eq 0 ] ; then
               rm -f /var/lock/subsys/$SQUID
               while : ; do
               [ -f /var/run/squid.pid ] || break
               sleep 2 &amp;&amp; echo -n "." 
               done
               echo "done"
               else
               echo
               fi
               ;;

               reload)
               $SQUID $SQUID_OPTS -k reconfigure 
               exit <code class="prompt">$</code>?
               ;;

               restart)
               $0 stop
               $0 start
               ;;

               status)
               status $SQUID
               $SQUID -k check
               exit <code class="prompt">$</code>?
               ;;

               probe)
               exit 0;
               ;;

               *)
               echo "Usage: $0 {start|stop|status|reload|restart}"
               exit 1
               esac

               exit $RETVAL
             </pre><p>
               Now, make this script executable and change its default permissions:
               </p><pre class="screen">
                 [root@deep /]# <span class="command"><strong>chmod</strong></span> 700 /etc/rc.d/init.d/squid
               </pre><p>
               Create the symbolic rc.d links for Squid with the command:
               </p><pre class="screen">
                 [root@deep /]# <span class="command"><strong>chkconfig</strong></span> --add squid
               </pre><p>
             </p><p>
               By default the squid script will not automatically start the proxy server on Red Hat Linux when you reboot the server. You can change it's default by executing the following command:
               </p><pre class="screen">
                 [root@deep /]# <span class="command"><strong>chkconfig</strong></span> --level 345 squid on
               </pre><p>
               Start your new Squid Proxy Server manually with the following command:
               </p><pre class="screen">
                 [root@deep /]# /etc/rc.d/init.d/squid <span class="command"><strong>start</strong></span>
               </pre><p>
               </p><pre class="literallayout"><code class="computeroutput">
                 Starting squid: init_cache_dir ufs... squid
               </code></pre><p>
             </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm18419"></a>9. Configure the <code class="filename">/etc/logrotate.d/squid</code> file</h2></div></div></div><p>
               Configure your <code class="filename">/etc/logrotate.d/squid</code> file to rotate your log files automatically each week.
               Create the <code class="filename">squid</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/logrotate.d/squid</code> and add:
             </p><pre class="programlisting">
               /var/log/squid/access.log {
               weekly
               rotate 5
               copytruncate
               compress
               notifempty
               missingok
               }
               /var/log/squid/cache.log {
               weekly
               rotate 5
               copytruncate
               compress
               notifempty
               missingok
               }

               /var/log/squid/store.log {
               weekly
               rotate 5
               copytruncate
               compress
               notifempty
               missingok
               # This script asks squid to rotate its logs on its own.
               # Restarting squid is a long process and it is not worth
               # doing it just to rotate logs
               postrotate
               /usr/sbin/squid -k rotate
               endscript
               }
             </pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm18428"></a>9.1. Securing and Immunize Squid</h3></div></div></div><p>
                 By having more control on mounting the cache directory of Squid, if you have created the cache directory of Squid in a separate partition of your Linux system <abbr class="abbrev">i.e.</abbr> <code class="filename">/cache</code>, like we have done during the install setup, then you can use 
                 the <code class="literal">noexec</code>, <code class="literal">nodev</code>, and <code class="literal">nosuid</code> features to improve and consolidate the cache security. These features can be set up in the <code class="filename">/etc/fstab</code> file to tell the system to not allow execution of any binaries; <code class="literal">noexec</code> 
                 to not interpret character or block special devices; <code class="literal">nodev</code> and to not allow set-user-identifier or set-group-identifier bits to take effect, <code class="literal">nosuid</code> on the mounted file system <code class="filename">/cache</code> <span class="emphasis"><em>in our example</em></span>. 
                 Applying this procedure on the partition where the Squid Cache resides will help to eliminate the possibility of <code class="literal">DEV</code>, <code class="literal">SUID/SGID</code>, and execution of any binaries.
               </p><p>
                 As an example, assuming <code class="filename">/dev/sda8</code> is the partition in the system where the <code class="filename">/cache</code> directory of Squid lives, you must edit the fstab 
                 file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/fstab</code> and change the line related to <code class="filename">/dev/sda8:</code>
                 </p><pre class="programlisting">
                   /dev/sda8			/cache		ext2		defaults        1 2
                 </pre><p>
                 To read:
                 </p><pre class="programlisting">
                   /dev/sda8			/cache 		ext2		noexec,nodev,nosuid 1 2
                 </pre><p>

                 Dont you forget to reboot your system for the changes to take effect.
               </p><p>
               You should immunize important configuration file like <code class="filename">squid.conf</code>. As we already know, the immutable bit can be used to prevent deletion, overwriting, or creation of a symbolic link to a file. Once your <code class="filename">squid.conf</code> 
               file has been configured, it's a good idea to immunize it with the following command:
               </p><pre class="screen">
                 [root@deep /]# chattr +i /etc/squid/squid.conf
               </pre><p>
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm18456"></a>10. Optimizing Squid</h2></div></div></div><p>
               The <code class="envar">atime</code> and <code class="envar">noatime</code> attributes can be used to get a measurable performance gain in the Squid cache directory. See  <a class="link" href="#prt2ch1gss" title="Chapter 5. General System Security">General System Optimization</a>  in this book, for more information on the subject.
             </p><p>
               The most important resource for Squid is physical memory. Your processor does not need to be ultra-fast. Your disk system will be the major bottleneck, so fast disks are important for high-volume caches. 
               Do not use <acronym class="acronym">IDE</acronym> disks if you can help it.
             </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm18464"></a>10.1. The cachemgr.cgi </h3></div></div></div><p>
                 The cachemgr.cgi utility program, which is available by default when you compile and install Squid into your system, is designed to run through a web interface, and outputs various statistics about Squid configuration and performance.
                 This program is located under the <code class="filename">/usr/lib/squid</code> directory, and you must put it in your <code class="filename">cgi-bin</code> directory (eg, /home/httpd/cgi-bin) to be able to use it. Follow the simple steps below to use this program.
                 </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
                     Move the <span class="command"><strong>cachemgr.cgi</strong></span> program to your <code class="literal">cgi-bin</code> directory:
                     </p><pre class="screen">
                       [root@deep /]# <span class="command"><strong>mv</strong></span> /usr/lib/squid/cachemgr.cgi /home/httpd/cgi-bin
                     </pre><p>
                     I assume your <code class="filename">cgi-bin</code> directory is located under <code class="filename">/home/httpd/cgi-bin</code>, other paths are possible. Also, this <span class="command"><strong>cgi-bin</strong></span> will exist only if you've 
                     installed the Apache Web Server on your system.
                   </p></li><li class="step"><p>

                     Once you've put the <span class="command"><strong>cachemgr.cgi</strong></span> program in your <code class="filename">cgi-bin</code> directory, you can point your web browser to the following address <code class="literal">http://my-web-server/cgi-bin/cachemgr.cgi</code> 
                     to be able to use the various features of this program.

                     The <code class="literal">my-web-server</code> is the address where your Apache web server lives, and <span class="command"><strong>cachemgr.cgi</strong></span> is the utility program we have just placed in our <code class="filename">cgi-bin</code> directory to display 
                     information and the configuration of our Squid Linux server.
                   </p></li></ol></div><p>
                 </p><div class="mediaobject"><img src="./images/Squid-CachePass.gif" alt="Squid cache password"></div><p>

                 If you have configured the <code class="filename">squid.conf</code> file to use password authentication for <span class="command"><strong>cachemgr.cgi</strong></span>, you'll be asked to enter the Cache Host, Cache Port, Manager name, and Password information before you are 
                 able to access the <span class="command"><strong>cachemgr.cgi</strong></span> program. See the configuration of the <a class="link" href="#pr6ch28scsqcnf" title="6. Configure the /etc/squid/squid.conf file -in httpd-accelerator mode">/etc/squid/squid.conf</a> file above for more information.
               </p><p>
                 
</p><div class="mediaobject"><img src="./images/Squid-CacheMGR.gif" alt="Squid cache Manager"></div><p>
Once you have been authenticated by the server, you'll see in your web browser interface the Cache Manager menu where you can examine and analyze the different options related to your Squid Proxy server.
               </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm18503"></a>11. Netscape Proxies Configuration</h2></div></div></div><p>
                   If you decide to use Squid as proxy-caching server, and allow all users in your corporate network to use Squid to access the Internet only in this mode, you must instruct your users browsers to fetch objects from your 
                   Squid proxy server instead of retrieving them directly from the Internet.
                 </p><p>
                   With Netscape Communicator, follow these simple steps below:
                   </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                       Open Netscape Communicator
                     </p></li><li class="listitem"><p>
                     Go to <span class="guimenuitem">Edit</span> menu
                     </p></li><li class="listitem"><p>
                     Click on <span class="guisubmenu">Preferences</span>
                     </p></li><li class="listitem"><p>
                     Double click <span class="guisubmenu">Advanced</span> category on the left side
                     </p></li><li class="listitem"><p>
                     Click on <span class="guisubmenu">Proxies</span> subcategory option
                     </p></li><li class="listitem"><p>
                     Select on the right side <span class="guibutton">Manual proxy configuration</span> radio button
                     </p></li><li class="listitem"><p>
                     Click on the <span class="guibutton">View</span> button
                     </p></li><li class="listitem"><p>
                     Fill the boxes with your proxy server information
                     </p></li></ol></div><p>
                 </p><p>
                   For example:
                   </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                       <acronym class="acronym">HTTP</acronym>: 	<code class="literal">	208.164.186.1 	Port: 8080</code>
                     </td></tr><tr><td>
                     Security: 	<code class="literal">208.164.186.1 	Port: 8080</code>
                     </td></tr><tr><td>
                     <acronym class="acronym">FTP</acronym>: 		<code class="literal">208.164.186.1 	Port: 8080</code>
                     </td></tr><tr><td>
                     Gopher: 	<code class="literal">208.164.186.1 	Port: 8080</code>
                     </td></tr><tr><td>
                     <acronym class="acronym">WAIS</acronym>: 		<code class="literal">208.164.186.1 	Port: 8080</code>
                     </td></tr></table><p>
</p><div class="mediaobject"><img src="./images/Proxy-Configuration.gif" alt="Proxy Netscape Configuration"></div><p>
                 </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm18550"></a>12. Installed files</h2></div></div></div><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/squid</code></td><td><code class="filename">/etc/squid/mib.txt</code></td></tr><tr><td><code class="filename">/etc/squid/squid.conf.default</code></td><td><code class="filename">/etc/squid/squid.conf</code></td></tr><tr><td><code class="filename">/etc/squid/mime.conf.default</code></td><td><code class="filename">/etc/squid/mime.conf</code></td></tr><tr><td><code class="filename">/etc/squid/errors</code></td><td><code class="filename">/etc/squid/errors/ERR_ACCESS_DENIED</code></td></tr><tr><td><code class="filename">/etc/squid/errors/ERR_CACHE_ACCESS_DENIED</code></td><td><code class="filename">/etc/squid/errors/ERR_CACHE_MGR_ACCESS_DENIED</code></td></tr><tr><td><code class="filename">/etc/squid/errors/ERR_CANNOT_FORWARD</code></td><td><code class="filename">/etc/squid/errors/ERR_CONNECT_FAIL</code></td></tr><tr><td><code class="filename">/etc/squid/errors/ERR_DNS_FAIL</code></td><td><code class="filename">/etc/squid/errors/ERR_FORWARDING_DENIED</code></td></tr><tr><td><code class="filename">/etc/squid/errors/ERR_FTP_DISABLED</code></td><td><code class="filename">/etc/squid/errors/ERR_FTP_FAILURE</code></td></tr><tr><td><code class="filename">/etc/squid/errors/ERR_FTP_FORBIDDEN</code></td><td><code class="filename">/etc/squid/errors/ERR_FTP_NOT_FOUND</code></td></tr><tr><td><code class="filename">/etc/squid/errors/ERR_FTP_PUT_CREATED</code></td><td><code class="filename">/etc/squid/errors/ERR_FTP_PUT_ERROR</code></td></tr><tr><td><code class="filename">/etc/squid/errors/ERR_FTP_PUT_MODIFIED</code></td><td><code class="filename">/etc/squid/errors/ERR_FTP_UNAVAILABLE</code></td></tr><tr><td><code class="filename">/etc/squid/errors/ERR_INVALID_REQ</code></td><td><code class="filename">/etc/squid/errors/ERR_INVALID_URL</code></td></tr><tr><td><code class="filename">/etc/squid/errors/ERR_LIFETIME_EXP</code></td><td><code class="filename">/etc/squid/errors/ERR_NO_RELAY</code></td></tr><tr><td><code class="filename">/etc/squid/errors/ERR_ONLY_IF_CACHED_MISS</code></td><td><code class="filename">/etc/squid/errors/ERR_READ_ERROR</code></td></tr><tr><td><code class="filename">etc/squid/errors/ERR_READ_TIMEOUT</code></td><td><code class="filename">/etc/squid/errors/ERR_SHUTTING_DOWN</code></td></tr><tr><td><code class="filename">/etc/squid/errors/ERR_SOCKET_FAILURE</code></td><td><code class="filename">/etc/squid/errors/ERR_TOO_BIG</code></td></tr><tr><td><code class="filename">/etc/squid/errors/ERR_UNSUP_REQ</code></td><td><code class="filename">/etc/squid/errors/ERR_URN_RESOLVE</code></td></tr><tr><td><code class="filename">/etc/squid/errors/ERR_WRITE_ERROR</code></td><td><code class="filename">/etc/squid/errors/ERR_ZERO_SIZE_OBJECT</code></td></tr><tr><td><code class="filename">/etc/rc.d/init.d/squid</code></td><td><code class="filename">/etc/rc.d/rc0.d/K25squid</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc1.d/K25squid</code></td><td><code class="filename">/etc/rc.d/rc2.d/K25squid</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc3.d/S90squid</code></td><td><code class="filename">/etc/rc.d/rc4.d/S90squid</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc5.d/S90squid</code></td><td><code class="filename">/etc/rc.d/rc6.d/K25squid</code></td></tr><tr><td><code class="filename">/etc/logrotate.d/squid</code></td><td><code class="filename">/usr/lib/squid</code></td></tr><tr><td><code class="filename">/usr/lib/squid/dnsserver</code></td><td><code class="filename">/usr/lib/squid/unlinkd</code></td></tr><tr><td><code class="filename">/usr/lib/squid/cachemgr.cgi</code></td><td><code class="filename">/usr/lib/squid/icons</code></td></tr><tr><td><code class="filename">/usr/lib/squid/icons/anthony-binhex.gif</code></td><td><code class="filename">/usr/lib/squid/icons/anthony-bomb.gif</code></td></tr><tr><td><code class="filename">/usr/lib/squid/icons/anthony-box.gif</code></td><td><code class="filename">/usr/lib/squid/icons/anthony-box2.gif</code></td></tr><tr><td><code class="filename">/usr/lib/squid/icons/anthony-c.gif</code></td><td><code class="filename">/usr/lib/squid/icons/anthony-compressed.gif</code></td></tr><tr><td><code class="filename">/usr/lib/squid/icons/anthony-dir.gif</code></td><td><code class="filename">/usr/lib/squid/icons/anthony-dirup.gif</code></td></tr><tr><td><code class="filename">/usr/lib/squid/icons/anthony-dvi.gif</code></td><td><code class="filename">/usr/lib/squid/icons/anthony-f.gif</code></td></tr><tr><td><code class="filename">/usr/lib/squid/icons/anthony-image.gif</code></td><td><code class="filename">/usr/lib/squid/icons/anthony-image2.gif</code></td></tr><tr><td><code class="filename">/usr/lib/squid/icons/anthony-layout.gif</code></td><td><code class="filename">/usr/lib/squid/icons/anthony-link.gif</code></td></tr><tr><td><code class="filename">/usr/lib/squid/icons/anthony-movie.gif</code></td><td><code class="filename">/usr/lib/squid/icons/anthony-pdf.gif</code></td></tr><tr><td><code class="filename">/usr/lib/squid/icons/anthony-portal.gif</code></td><td><code class="filename">/usr/lib/squid/icons/anthony-ps.gif</code></td></tr><tr><td><code class="filename">/usr/lib/squid/icons/anthony-quill.gif</code></td><td><code class="filename">/usr/lib/squid/icons/anthony-script.gif</code></td></tr><tr><td><code class="filename">/usr/lib/squid/icons/anthony-sound.gif</code></td><td><code class="filename">/usr/lib/squid/icons/anthony-tar.gif</code></td></tr><tr><td><code class="filename">/usr/lib/squid/icons/anthony-tex.gif</code></td><td><code class="filename">/usr/lib/squid/icons/anthony-text.gif</code></td></tr><tr><td><code class="filename">/usr/lib/squid/icons/anthony-unknown.gif</code></td><td><code class="filename">/usr/lib/squid/icons/anthony-xbm.gif</code></td></tr><tr><td><code class="filename">/usr/lib/squid/icons/anthony-xpm.gif</code></td><td><code class="filename">/usr/sbin/RunCache</code></td></tr><tr><td><code class="filename">/usr/sbin/RunAccel</code></td><td><code class="filename">/usr/sbin/squid</code></td></tr><tr><td><code class="filename">/usr/sbin/client</code></td><td><code class="filename">/var/log/squid</code></td></tr></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="pr6ch29wapch"></a>Chapter 29. Software -Network Server, web/Apache</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#prt6ch29scmm">1. Linux MM Shared Memory Library </a></span></dt><dt><span class="section"><a href="#idm18766">2. Compile</a></span></dt><dd><dl><dt><span class="section"><a href="#idm18801">2.1. Installed files</a></span></dt></dl></dd><dt><span class="section"><a href="#prt6ch29sapws">3. Linux Apache Web Server</a></span></dt><dt><span class="section"><a href="#idm18910">4. Compile and Optimize</a></span></dt><dt><span class="section"><a href="#idm18970">5. Configure and apply <acronym class="acronym">PHP4</acronym> to Apache source</a></span></dt><dt><span class="section"><a href="#idm19032">6. Apply mod_perl to Apache source tree </a></span></dt><dt><span class="section"><a href="#idm19118">7. Install Apache</a></span></dt><dt><span class="section"><a href="#idm19184">8. Post install Configuration</a></span></dt><dt><span class="section"><a href="#idm19232">9. Configure the <code class="filename">/etc/httpd/conf/httpd.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm19392">10. Configure the <code class="filename">/etc/logrotate.d/apache</code> file</a></span></dt><dt><span class="section"><a href="#idm19414">11. Configure the <code class="filename">/etc/rc.d/init.d/httpd</code> script file</a></span></dt><dt><span class="section"><a href="#idm19437">12. <acronym class="acronym">PHP4</acronym> server-side scripting</a></span></dt><dt><span class="section"><a href="#pr6ch29sappsy">13. Perl module Devel::Symdump</a></span></dt><dd><dl><dt><span class="section"><a href="#idm19531">13.1. Installed files</a></span></dt></dl></dd><dt><span class="section"><a href="#pr6ch29sapcgi">14. CGI.pm Perl library</a></span></dt><dd><dl><dt><span class="section"><a href="#idm19579">14.1. Installed files</a></span></dt></dl></dd><dt><span class="section"><a href="#pr6ch29apscr">15. Securing Apache</a></span></dt><dt><span class="section"><a href="#idm19622">16. users authentication with <code class="filename">.dbmpasswd</code> password file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm19672">16.1. Immunize configuration files like <code class="filename">httpd.conf</code></a></span></dt></dl></dd><dt><span class="section"><a href="#idm19679">17. Apache in a chroot jail</a></span></dt><dt><span class="section"><a href="#idm19800">18. Apache to use shared libraries</a></span></dt><dt><span class="section"><a href="#idm19849">19. The <code class="filename">/chroot/etc</code> directory</a></span></dt><dt><span class="section"><a href="#idm19936">20. Test the new chrooted jail</a></span></dt><dt><span class="section"><a href="#idm19965">21. Configure the new <code class="filename">/etc/logrotate.d/apache</code> file</a></span></dt><dt><span class="section"><a href="#pr6ch29sapo">22. Optimizing Apache</a></span></dt><dt><span class="section"><a href="#idm20023">23. Installed files for Apache Web Server</a></span></dt><dt><span class="section"><a href="#idm20209">24. Installed files /PHP4</a></span></dt><dt><span class="section"><a href="#idm20445">25. Installed files by mod_perl</a></span></dt></dl></div><div class="highlights"><p>
    It is recommended that you compile and install this small program only if you intend to install and use the Apache web server with third party modules like:
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
      mod_ssl for encrypted data
    </td></tr><tr><td>
    mod_perl for the Perl programming language
    </td></tr><tr><td>
    mod_php for the <acronym class="acronym">PHP</acronym> server-side scripting language. 
    </td></tr></table><p>
    This program will provide a significant performance to Apache modules. For instance if you need to install Apache with SSL support for your electronic commerce on the Internet, this will allows the SSL protocol to use a high-performance RAM-based session cache instead of a disk-based one.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prt6ch29scmm"></a>1. Linux MM Shared Memory Library </h2></div></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>As per the [<span class="citation">MM Shared Memory Library web site</span>]:</b></p></div></div></div><p>
        The MM library is a 2-layer abstraction library, which simplifies the usage of shared memory between forked and, in this example, strongly related processes under Unix platforms. On the first layer it hides all platform dependent 
        implementation details; allocation and locking, when dealing with shared memory segments, and on the second layer it provides a high-level malloc(3)-style API for a convenient and well known way to work with data-structures inside 
        those shared memory segments.
      </p><p>
        The library is released under the term of an open-source, BSD-style license, because it was originally written as a proposal for use inside the next version of the Apache web server as a base library for providing shared memory pools 
        to Apache modules,  Currently Apache modules can only use heap-allocated memory, which isn't shared across the pre-forked server processes. The requirement actually comes from comprehensive modules like mod_ssl, mod_perl and mod_php, 
        which would benefit a lot from easy to use shared memory pools.
      </p></div><p>
      These installation instructions assume
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Commands are Unix-compatible.
        </p></li><li class="listitem"><p>
        The source path is <code class="filename">/var/tmp</code>, <span class="emphasis"><em>other paths are possible</em></span>.
        </p></li><li class="listitem"><p>
        Installations were tested on Red Hat Linux 6.1 and 6.2.
        </p></li><li class="listitem"><p>
        All steps in the installation will happen in super-user account <code class="literal">root</code>.
        </p></li><li class="listitem"><p>
        Mm version number is 1.1.2
        </p></li></ul></div><p>
    </p><p>
      These are the package(s):
      </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
          MM Homepage:<a class="link" href="#prtinxfp29" title="Linux MM Shared Memory Library">http://www.engelschall.com/sw/mm/</a>
        </td></tr><tr><td>
        You must be sure to download: <code class="filename">mm-1.1.2.tar.gz</code>
        </td></tr></table><p>
    </p><p>
      Before you decompress the tarballs, it is a good idea to make a list of files on the system before you install MM, and one afterwards, and then compare them using diff to find out what file it placed where. Simply run 
      <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; MM1</code></strong> before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; MM2</code></strong> after you install the software, and use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>MM1 MM2 &gt; MM-Installed</code></strong> 
      to get a list of what changed.
    </p><p>
      To compile you need to decompress the tarball (tar.gz) first.
      </p><pre class="screen">
        [root@deep /]# <span class="command"><strong>cp</strong></span> mm-version.tar.gz /var/tmp
        [root@deep /]# <span class="command"><strong>cd</strong></span> /var/tmp
        [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf mm-version.tar.gz
      </pre><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm18766"></a>2. Compile</h2></div></div></div><p>

      Move into the new mm directory and type the following commands on your terminal:
      </p><pre class="programlisting">
        ./configure \
        --disable-shared  \
        --prefix=/usr
      </pre><p>

      This tells MM to set itself up for this particular hardware setup with:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Disable shared libraries.
        </p></li></ul></div><p>
    </p><p>
      Now, we must compile and install MM Shared Memory Library in the server:
      </p><pre class="screen">
        [root@deep ]/mm-1.1.2# <span class="command"><strong>make</strong></span> 
        [root@deep ]/mm-1.1.2# <span class="command"><strong>make test</strong></span> 
        [root@deep ]/mm-1.1.2# <span class="command"><strong>make install</strong></span> 
      </pre><p>
      The <span class="command"><strong>make test</strong></span> command will make some important tests on the program to verify that it works, and respond properly before the installation.
    </p><p>
      Please do Cleanup later:
      </p><pre class="screen">
        [root@deep /]# <span class="command"><strong>cd</strong></span> /var/tmp
        [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf mm-version/ mm-version.tar.gz
      </pre><p>
      The <span class="command"><strong>rm</strong></span> command will remove all the source files we have used to compile and install mm. It will also remove the mm compressed archive from the <code class="filename">/var/tmp</code> directory.
    </p><p>
      Further documentation, for more details there are several man pages you can read:
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">MM</span>(3)</span></span></dt><dd><p>
            Shared Memory Library
          </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">mm-config</span>(1)</span></span></dt><dd><p>
            MM library configuration/build utility
          </p></dd></dl></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm18801"></a>2.1. Installed files</h3></div></div></div><p>
        These are the files installed by the program MM on your system.
        </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/usr/bin/mm-config</code></td></tr><tr><td><code class="filename">/usr/include/mm.h</code></td></tr><tr><td><code class="filename">/usr/lib/libmm.la</code></td></tr><tr><td><code class="filename">/usr/lib/libmm.a</code></td></tr><tr><td><code class="filename">/usr/man/man1/mm-config.1</code></td></tr><tr><td><code class="filename">/usr/man/man3/mm.3</code></td></tr></table><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prt6ch29sapws"></a>3. Linux Apache Web Server</h2></div></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b></b></p></div></div></div><p>
      Apache is the most widely used HTTP-server in the world today. It surpasses all free and commercial competitors on the market, and provides a myriad of features; more than the nearest cmpetitor could give you on a UNIX variant. 
      It is also the most used web server for a Linux system. A web server like Apache, in its simplest function, is software that displays and serves HTML pages hosted on a server to a client browser that understands the HTML code. 
      Mixed with third party modules and programs, it can become powerful software, which will provide strong and useful services to a client browser.
    </p></div><p>
      I expect that most of the users that read this book will be especially interested in knowing how to install the Apache web server in the most secure, and optimized, way. In its base install, Apache is no more difficult to install 
      then the other software we have installed on our Linux server. The process can become tricky when we want to add some third party modules or programs. There are a lot of possibilities, variants and options for installing Apache. 
    </p><p>
      we have provided some step-by-step examples where you can see how to build Apache with other third-party modules and programs like mod_ssl, mod_perl, PHP4, LDAP connectivity, etc. Of course, the building of these programs is 
      optional, and you are free to compile only what you want, <abbr class="abbrev">i.e.</abbr> you may want to compile Apache with support for PHP4, but without SSL or PostgreSQL database connectivity <abbr class="abbrev">etc.</abbr> To simplify matters
      we assume some prerequisites for each example. If these don't fit your needs, simply modify the steps to suit your needs.
    </p><p>
      In this section, we explain and cover some of the basic ways in which you can adjust the configuration to improve the server's performance. Also, for the interested, we'll provide a procedure to be able to run Apache as a non 
      root-user and in a chrooted environment for optimal security.
    </p><div class="mediaobject" align="center"><img src="./images/Apache-Schema.gif" align="middle" alt="Apache web server"></div><p>
      These installation instructions assume
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Commands are Unix-compatible.
        </p></li><li class="listitem"><p>
        The source path is <code class="filename">/var/tmp</code>, <span class="emphasis"><em>other paths are possible</em></span>.
        </p></li><li class="listitem"><p>
        Installations were tested on Red Hat Linux 6.1 and 6.2.
        </p></li><li class="listitem"><p>
        All steps in the installation will happen in super-user account <code class="literal">root</code>.
        </p></li><li class="listitem"><p>
        Apache version number is 1.3.12
        </p></li><li class="listitem"><p>
        Mod_SSL version number is 2.6.4-1.3.12
        </p></li><li class="listitem"><p>
        Mod_Perl version number is 1.24
        </p></li><li class="listitem"><p>
        Mod_PHP version number is 4.0.0
        </p></li></ul></div><p>
    </p><p>
      Packages
      </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
          Apache Homepage: <a class="link" href="#prtinxfp30" title="Linux Apache Web Server">http://www.apache.org/</a>
        </td><td>
        Mod_Perl Homepage: <a class="link" href="#prtinxfp30" title="Linux Apache Web Server">http://perl.apache.org/</a>
        </td></tr><tr><td>
        Apache FTP Site: <a class="link" href="#prtinxfp30" title="Linux Apache Web Server">63.211.145.10</a>
        </td><td>
        Mod_Perl FTP Site: <a class="link" href="#prtinxfp30" title="Linux Apache Web Server">63.211.145.10</a>
        </td></tr><tr><td>
        You must be sure to download: apache_1.3.12.tar.gz
        </td><td>
        You must be sure to download: mod_perl-1.24.tar.gz
        </td></tr><tr><td>
        Mod_SSL Homepage: <a class="link" href="#prtinxfp30" title="Linux Apache Web Server">http://www.modssl.org/</a>
        </td><td>
        Mod_PHP Homepage: <a class="link" href="#prtinxfp30" title="Linux Apache Web Server">http://www.php.net/</a>
        </td></tr><tr><td>
        Mod_SSL FTP Site: <a class="link" href="#prtinxfp30" title="Linux Apache Web Server">129.132.7.171</a>
        </td><td>
        You must be sure to download: php-4.0.0.tar.gz
        </td></tr><tr><td>
        You must be sure to download: mod_ssl-2.6.4-1.3.12.tar.gz
        </td><td> </td></tr></table><p>
    </p><p>
      And don't forget that these are the prerequisites if you are following the steps described by us exactly.
      </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
          OpenSSL should be already installed on your system if you want Apache and SSL encryption support.
        </p></li><li class="listitem"><p>
        PosgreSQL should be already installed on your system if you want Apache and PostgreSQL database connectivity support.
        </p></li><li class="listitem"><p>
        MM should be already installed on your system if you want Apache and MM high-performance RAM-based session cache support.
        </p></li><li class="listitem"><p>
        OpenLDAP should be already installed on your system if you want Apache and LDAP directory connectivity support.
        </p></li><li class="listitem"><p>
        IMAP &amp; POP should be already installed on your system if you want Apache and IMAP &amp; POP capability.
        </p></li></ol></div><p>
    </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
      <span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
      </h3><p>
      For more information on the required software, see the related chapter(s) in this book.
    </p></div><p>
      Before you decompress the tarballs, It is a good idea to make a list of files on the system before you install Apache, and one afterwards, and then compare them using diff to find out what file it placed where. Simply 
      run <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Apache1</code></strong> before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Apache2</code></strong> after you install the software, and use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>Apache1 Apache2 &gt; Apache-Installed</code></strong> 
      to get a list of what changed.
    </p><p>
      To compile, decompress the tarballs (tar.gz).
      </p><pre class="screen">
      [root@deep ]/# <span class="command"><strong>cp</strong></span> apache_version.tar.gz /var/tmp
      [root@deep ]/# <span class="command"><strong>cp</strong></span> mod_ssl-version-version.tar.gz /var/tmp
      [root@deep ]/# <span class="command"><strong>cp</strong></span> mod_perl-version.tar.gz /var/tmp
      [root@deep ]/# <span class="command"><strong>cp</strong></span> php-version.tar.gz /var/tmp
      [root@deep ]/# <span class="command"><strong>cd</strong></span> /var/tmp/
      [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf apache_version.tar.gz
      [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf mod_ssl-version-version.tar.gz
      [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf mod_perl-version.tar.gz
      [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf php-version.tar.gz
      </pre><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm18910"></a>4. Compile and Optimize</h2></div></div></div><p>
      Apache Web Server, like many applications we'll install, cannot run as <em class="wordasword">super-user</em> root. For this reason we must create a special user that has minimal access to the system, and still function 
      enougn to run the Apache web Server. It is best to choose and create a new user just for the purpose of running the web server daemon.
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        </p><pre class="screen">
          [root@deep ]/# <span class="command"><strong>useradd</strong></span> -c "Apache Server" -u 80 -s /bin/false -r -d /home/httpd www 2&gt;/dev/null || :
        </pre><p>
      </p></li><li class="step"><p>
        You have to apply mod-ssl to Apache source tree, if you want to use and include the SSL data encryption support in your Apache web server, then move into the new mod_ssl source directory <span class="command"><strong>cd</strong></span> <code class="filename">mod_ssl-version-version/</code> 
        and type the following commands on your terminal:
        </p><pre class="programlisting">
          CC="egcs" \
          CFLAGS="-O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions" \
          ./configure \
          --with-apache=../apache_1.3.12 \
          --with-crt=/etc/ssl/certs/server.crt \
          --with-key=/etc/ssl/private/server.key
        </pre><p>
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The  <code class="literal">--with-apache</code> option specifies the location of the Apache source directory, it's important to note that we suppose your Apache version in this example is 1.3.12, 
          </p></li><li class="listitem"><p>
            The  <code class="literal">--with-crt</code> option specifies the location of your existing public key for SSL encryption
          </p></li><li class="listitem"><p>
          The  <code class="literal">--with-key</code> option specifies the location of your existing private key for SSL encryption.
          </p></li></ul></div><p>
        </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
            <span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
          </h3><p>
          OpenSSL software must already be installed on your server, and your public and private keys must already be existent or be created on your server, or you'll receive an error message during the configuration time of mod_ssl. 
          See  <a class="link" href="#pr6ch24sc1ossl" title="1. Linux OPENSSL Server">Software -Networking/Encryption</a>,  in this book, for more information.
        </p></div><p>
      </p></li><li class="step"><p>
        Improve the MaxClients Parameter of Apache, by default in the Apache configuration file; <code class="filename">httpd.conf</code>, the maximum number you can set for the MaxClients Parameter is 256. For a busy site, and for better 
        performance, its recommended that you increase the limit of this parameter. You can do it by editing the <code class="filename">src/include/httpd.h</code> file in the source directory of Apache and changing the 
        default value.

        Move into the new Apache source directory, <span class="command"><strong>cd</strong></span> <code class="filename">../apache_1.3.12/</code> and edit the <code class="filename">httpd.h</code> file:
        </p><pre class="programlisting">
          #define HARD_SERVER_LIMIT 256
        </pre><p>
        To read:
        </p><pre class="programlisting">
          #define HARD_SERVER_LIMIT 1024
        </pre><p>
      </p></li><li class="step"><p>
        Pre-configure Apache for <acronym class="acronym">PHP4</acronym> configure step if you want to use and include the <acronym class="acronym">PHP4</acronym> server-side scripting language support on your Apache web server, then move into the new Apache source directory <span class="command"><strong>cd</strong></span> <code class="filename">apache_1.3.12/</code> 
        if you are not already in it and type the following commands on your terminal:
        </p><pre class="programlisting">
          CC="egcs" \
          OPTIM="-O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions" \
          CFLAGS="-DDYNAMIC_MODULE_LIMIT=0" \
          ./configure \
          --prefix=/home/httpd \
          --bindir=/usr/bin \
          --sbindir=/usr/sbin \
          --libexecdir=/usr/lib/apache \
          --includedir=/usr/include/apache \
          --sysconfdir=/etc/httpd/conf \
          --localstatedir=/var \
          --runtimedir=/var/run \
          --logfiledir=/var/log/httpd \
          --datadir=/home/httpd \
          --proxycachedir=/var/cache/httpd \
          --mandir=/usr/man
        </pre><p>
      </p></li></ol></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
        <span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
      </h3><p>
      This step is necessary only if you want to include <acronym class="acronym">PHP</acronym>4 support in your Apache source code, since it'll pre-configure Apache for <acronym class="acronym">PHP</acronym>4s configure step below. Take a note that the  <code class="envar">-DDYNAMIC_MODULE_LIMIT=0</code> option will 
      disable the use of dynamically loaded modules in our compilation of Apache, and will improve its performance.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm18970"></a>5. Configure and apply <acronym class="acronym">PHP4</acronym> to Apache source</h2></div></div></div><p>
    Now, move into the new php4 directory <span class="command"><strong>cd</strong></span> <code class="filename">../php-4.0</code> and type the following commands on your terminal:
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        Edit the <code class="filename">php_pgsql.h</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">ext/pgsql/php_pgsql.h</code> and change the lines:
        </p><pre class="programlisting">
          #include <code class="filename">libpq-fe.h</code>
          #include <code class="filename">libpq/libpq-fs.h</code>
        </pre><p>
        To read:
        </p><pre class="programlisting">
          #include <code class="filename">/usr/include/pgsql/libpq-fe.h</code>
          #include <code class="filename">/usr/include/pgsql/libpq/libpq-fs.h</code>
        </pre><p>
        These modifications in the <code class="filename">php_pgsql.h</code> file are necessary to indicate the location of our <code class="filename">libpq-fe.h</code>, and <code class="filename">libpq-fs.h</code> header files of 
        PostgreSQL database during configure of PHP4. In Red Hat Linux, the libraries of PostgreSQL are located under <code class="filename">/usr/include/pgsql.</code>
      </p></li><li class="step"><p>
        Now, we must configure and install <acronym class="acronym">PHP4</acronym> in the Linux server:
        </p><pre class="programlisting">
          CC="egcs" \
          CFLAGS="-O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions -I/usr/include/openssl" \
          ./configure \
          --prefix=/usr \
          --with-exec-dir=/usr/bin \
          --with-apache=../apache_1.3.12 \
          --with-config-file-path=/etc/httpd \
          --disable-debug \
          --enable-safe-mode \
          --with-imap \                <a name="php4imp"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
          --with-ldap \                <a name="php4ldp"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
          --with-pgsql \               <a name="php4psq"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
          --with-mm \
          --enable-inline-optimization \
          --with-gnu-ld \
          --enable-memory-limit
        </pre><p>
        </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#php4imp"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
              If you want IMAP &amp; POP support.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#php4ldp"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            If you want LDAP database light directory support.
          </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#php4psq"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            if you want PostgreSQL database support.
          </p></td></tr></table></div><p>
       
        This tells <acronym class="acronym">PHP</acronym>4 to set itself up for this particular hardware setup with:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Compile without debugging symbols.
          </p></li><li class="listitem"><p>
          Enable safe mode by default.
          </p></li><li class="listitem"><p>
          Include IMAP &amp; POP support.
          </p></li><li class="listitem"><p>
          Include <acronym class="acronym">LDAP</acronym> directory support.
          </p></li><li class="listitem"><p>
          Include PostgresSQL database support.
          </p></li><li class="listitem"><p>
          Include mm support to improve performance of Memory Library.
          </p></li><li class="listitem"><p>
          Enable inline-optimization for better performance.
          </p></li><li class="listitem"><p>
          Compile with memory limit support.
          </p></li><li class="listitem"><p>
          Assume the C compiler uses GNU ld.
          </p></li></ul></div><p>
      </p></li><li class="step"><p>
        </p><pre class="screen">
        [root@deep ]/php-4.0# <span class="command"><strong>make</strong></span> 
        [root@deep ]/php-4.0# <span class="command"><strong>make install</strong></span> 
        </pre><p>
      </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm19032"></a>6. Apply mod_perl to Apache source tree </h2></div></div></div><p>
      You need to build/install the Perl-side of mod_perl, if you want to use and include Perl programming language support in your Apache web server. Move into the new mod_perl source directory <span class="command"><strong>cd</strong></span> <code class="filename">../mod_perl-1.24/</code> 
      and type the following commands on your terminal:
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        </p><pre class="programlisting">
          perl Makefile.PL \
          EVERYTHING=1 \
          APACHE_SRC=../apache_1.3.12/src \
          USE_APACI=1 \
          PREP_HTTPD=1 \
          DO_HTTPD=1
        </pre><p>
      </p></li><li class="step"><p>
        </p><pre class="screen">
          [root@deep ]/mod_perl-1.24# <span class="command"><strong>make</strong></span> 
          [root@deep ]/mod_perl-1.24# <span class="command"><strong>make install</strong></span> 
        </pre><p>

      </p></li><li class="step"><p>

        Once you have included in your Apache source the third party modules that you want to support and use, it is time to compile and install it into your Linux system. The last step is to move into the new Apache source directory 
        <span class="command"><strong>cd</strong></span> <code class="filename">../apache_1.3.12/</code> and type the following commands on your terminal depending on what you want to install with Apache for example it could you want to Build/Install Apache with/without 
        mod_ssl +- PHP4 and/or mod_perl etc.
        </p><pre class="programlisting">
          SSL_BASE=SYSTEM \                                             <a name="apchmdssl"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
          EAPI_MM=SYSTEM \                                              <a name="apchmmshrd"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
          CC="egcs" \
          OPTIM="-O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions" \
          CFLAGS="-DDYNAMIC_MODULE_LIMIT=0" \
          ./configure \
          --prefix=/home/httpd \
          --bindir=/usr/bin \
          --sbindir=/usr/sbin \
          --libexecdir=/usr/lib/apache \
          --includedir=/usr/include/apache \
          --sysconfdir=/etc/httpd/conf \
          --localstatedir=/var \
          --runtimedir=/var/run \
          --logfiledir=/var/log/httpd \
          --datadir=/home/httpd \
          --proxycachedir=/var/cache/httpd \
          --mandir=/usr/man \
          --add-module=src/modules/experimental/mod_mmap_static.c \        <a name="apchmm"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
          --add-module=src/modules/standard/mod_auth_db.c \                <a name="apchdb"></a><span><img src="images/callouts/4.png" alt="4" border="0"></span>
          --enable-module=ssl \                                            <a name="apchssl"></a><span><img src="images/callouts/5.png" alt="5" border="0"></span>
          --enable-rule=SSL_SDBM \                                         <a name="apchssldbe"></a><span><img src="images/callouts/6.png" alt="6" border="0"></span>
          --disable-rule=SSL_COMPAT \                                      <a name="apchssldbe1"></a><span><img src="images/callouts/7.png" alt="7" border="0"></span>
          --activate-module=src/modules/php4/libphp4.a \                   <a name="apchph4"></a><span><img src="images/callouts/8.png" alt="8" border="0"></span>
          --enable-module=php4 \                                           <a name="apchph41"></a><span><img src="images/callouts/9.png" alt="9" border="0"></span>
          --activate-module=src/modules/perl/libperl.a \                   <a name="apchprl"></a><span><img src="images/callouts/10.png" alt="10" border="0"></span>
          --enable-module=perl \                                           <a name="apchprl1"></a><span><img src="images/callouts/11.png" alt="11" border="0"></span>
          --disable-module=status \
          --disable-module=userdir \
          --disable-module=negotiation \
          --disable-module=autoindex \
          --disable-module=asis \
          --disable-module=imap \
          --disable-module=env \
          --disable-module=actions
        </pre><p>
        </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#apchmdssl"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
require only if you have included support for mod_ssl to your Apache source.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#apchmmshrd"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
require only if you use the mm Shared Memory Library for Apache.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#apchmm"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            required only if you have the intention to use mod_mmap, see the section <a class="link" href="#pr6ch29sapo" title="22. Optimizing Apache">Optimizing Apache</a> in this chapter for more information.
          </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#apchdb"><span><img src="images/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            required only if you have the intention to use mod_auth_db, see the section <a class="link" href="#pr6ch29apscr" title="15. Securing Apache">Securing Apache</a> in this chapter for more information.
          </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#apchssl"><span><img src="images/callouts/5.png" alt="5" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            required only if you have included support for mod_ssl data encryption to your Apache source.
          </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#apchssldbe"><span><img src="images/callouts/6.png" alt="6" border="0"></span></a> <a href="#apchssldbe1"><span><img src="images/callouts/7.png" alt="7" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            require only if you have included support for mod_ssl data encryption to your Apache source.
          </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#apchph4"><span><img src="images/callouts/8.png" alt="8" border="0"></span></a> <a href="#apchph41"><span><img src="images/callouts/9.png" alt="9" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            require only if you have included support for PHP4 server-side scripting language to your Apache source.
          </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#apchprl"><span><img src="images/callouts/10.png" alt="10" border="0"></span></a> <a href="#apchprl1"><span><img src="images/callouts/11.png" alt="11" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            require only if you have included support for mod_perl programming language to your Apache source.
          </p></td></tr></table></div><p>
        
      </p></li></ol></div><p>
      This tells Apache to set itself up for this particular hardware setup with:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          module mod_mmap to improve performance.
        </p></li><li class="listitem"><p>
        module mod_auth_db for users password authentication security.
        </p></li><li class="listitem"><p>
        module mod_ssl for data encryptions and secure communication.
        </p></li><li class="listitem"><p>
        module mod_php4 for php server-side scripting language and improve the load of web pages build in <acronym class="acronym">PHP</acronym>.
        </p></li><li class="listitem"><p>
        module mod_perl for better security and performance than the default cgi scripts.
        </p></li><li class="listitem"><p>
        disable module status
        </p></li><li class="listitem"><p>
          disable module userdir
        </p></li><li class="listitem"><p>
        disable module negotiation
        </p></li><li class="listitem"><p>
        disable module autoindex
        </p></li><li class="listitem"><p>
        disable module asis
        </p></li><li class="listitem"><p>
        disable module imap
        </p></li><li class="listitem"><p>
        disable module env
        </p></li><li class="listitem"><p>
        disable module actions
        </p></li></ul></div><p>
    </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
      <span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
 </h3><p>
      It's important to note that removing all unrequired modules during the configure time will improve the performance of your Apache Web Server. In our configuration above, we've removed the most unused modules both to lower the load 
      operation, and limit the security risks in our Apache web server. See your Apache documentation for information on each one.
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm19118"></a>7. Install Apache</h2></div></div></div><p>
      Now, we must install Apache in the Linux server:
      </p><pre class="screen">
        [root@deep ]/apache_1.3.12# <span class="command"><strong>make</strong></span> 
        [root@deep ]/apache_1.3.12# <span class="command"><strong>make install</strong></span> 
        [root@deep ]/apache_1.3.12# <span class="command"><strong>rm</strong></span> -f  /usr/sbin/apachectl
        [root@deep ]/apache_1.3.12# <span class="command"><strong>rm</strong></span> -f  /usr/man/man8/apachectl.8
        [root@deep ]/apache_1.3.12# <span class="command"><strong>rm</strong></span> -rf /home/httpd/icons/
        [root@deep ]/apache_1.3.12# <span class="command"><strong>rm</strong></span> -rf /home/httpd/htdocs/
        [root@deep ]/apache_1.3.12# <span class="command"><strong>cd</strong></span> /var/tmp/php-4.0
        [root@deep ]/php-4.0.0# <span class="command"><strong>install</strong></span> -m 644 php.ini.dist /usr/lib/php.ini
        [root@deep ]/php-4.0.0# <span class="command"><strong>rm</strong></span> -rf /etc/httpd/conf/ssl.crl/
        [root@deep ]/php-4.0.0# <span class="command"><strong>rm</strong></span> -rf /etc/httpd/conf/ssl.crt/
        [root@deep ]/php-4.0.0# <span class="command"><strong>rm</strong></span> -rf /etc/httpd/conf/ssl.csr/
        [root@deep ]/php-4.0.0# <span class="command"><strong>rm</strong></span> -rf /etc/httpd/conf/ssl.key/
        [root@deep ]/php-4.0.0# <span class="command"><strong>rm</strong></span> -rf /etc/httpd/conf/ssl.prm/
        [root@deep ]/php-4.0.0# <span class="command"><strong>rm</strong></span> -f  /etc/httpd/conf/srm.conf srm.conf.default access.conf access.conf.default
      </pre><p>
    </p><p>
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <span class="command"><strong>make</strong></span> command will compile all source files into executable binaries
        </p></li><li class="listitem"><p>
        The <span class="command"><strong>make install</strong></span> will install the binaries and any supporting files into the appropriate locations. 
        </p></li><li class="listitem"><p>
        The <span class="command"><strong>rm</strong></span> -f  command will remove the small script <code class="filename">apachectl</code> responsible to start and stop the Apache daemon since we use a better script named <code class="filename">httpd</code> located 
        under the <code class="filename">/etc/rc.d/init.d/</code> directory that takes advantage of Linux system V. 
        </p></li><li class="listitem"><p>
        We also remove the <code class="filename">/home/httpd/icons</code> directory used under Apache when you use its automatic indexing feature. This feature can bring about a security risk, and for this reason we've disabled 
        it in the configuration file. Therefore, we can safely remove the directory to make space on the Linux server. The <code class="filename">/home/httpd/htdocs</code> directory handles all documentation files related to Apache, so 
        after we have finished reading the documentation we can remove it to make space. 
        </p></li><li class="listitem"><p>
        The <span class="command"><strong>install</strong></span> <code class="literal">-m</code> command will install the <code class="filename">php.ini.dist</code> file under the <code class="filename">/etc/httpd/</code> directory, and will rename it <code class="filename">php.ini;</code> 
        This file controls many aspects of <acronym class="acronym">PHP</acronym>'s behavior. 
        </p></li><li class="listitem"><p>
        The <code class="filename">ssl.crl</code>, <code class="filename">ssl.crt</code>, <code class="filename">ssl.csr</code>, <code class="filename">ssl.key</code> and <code class="filename">ssl.prm</code> directories under <code class="filename">/etc/httpd/conf</code> are all of the 
        directories related to SSL, and handle private and public keys. Since we use another location, <code class="filename">/etc/ssl/</code>, we can remove them safely. 
        </p></li><li class="listitem"><p>
        Finally, we remove the unused <code class="filename">srm.conf</code>, <code class="filename">srm.conf.default</code>, <code class="filename">access.conf</code> and <code class="filename">access.conf.default</code> files, whose purposes are now handled by the <code class="filename">httpd.conf</code> 
        Apache file.
        </p></li></ul></div><p>
    </p><p>
      Please as usual do cleanup later:
      </p><pre class="screen">
        [root@deep ]/# <span class="command"><strong>cd</strong></span> /var/tmp
        [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf apache-version/ apache-version.tar.gz mod_ssl-version-version/ mod_ssl-version-version.tar.gz php-version/ php-version.tar.gz mod_perl-version/ mod_perl-version.tar.gz
      </pre><p>
      The <span class="command"><strong>rm</strong></span> command will remove all the source files we have used to compile and install Apache, mod_ssl, mod_perl, and php. It will also remove the Apache, mod_ssl, mod_perl, and php compressed 
      archives from the <code class="filename">/var/tmp</code> directory.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm19184"></a>8. Post install Configuration</h2></div></div></div><p>
      Configuration files for different services are very specific depending on your needs, and your network architecture. Someone might install Apache Server for showing web pages only; another might install it with database connectivity 
      and e-commerce with <acronym class="acronym">SSL</acronym> support, etc. In this book, we provide you with an <code class="filename">httpd.conf</code> file, with <acronym class="acronym">PHP</acronym>, Perl, <acronym class="acronym">SSL</acronym>, <acronym class="acronym">LDAP</acronym>, and password authentication 
      settings, to show you different possibilities.
    </p><p>
      We'll focus on optimization and security of these files, and leave all specific adjustments to your tastes. You will need to read the documentation that comes with these programs, and hopefully  understand them.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
        You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
        for respective software. For example <em class="wordasword">Apache</em> configuration file are organised like this:
        </p><pre class="literallayout"><code class="computeroutput">
          total 16
          -rw-r--r--    1 harrypotter    harrypotter        2417 Jun  8 13:00 Compile-Apache
          -rw-r--r--    1 harrypotter    harrypotter        3426 Jun  8 13:00 httpd.conf
          drwxr-xr-x    3 harrypotter    harrypotter        4096 Jun  8 13:00 init.d/
          drwxr-xr-x    3 harrypotter    harrypotter        4096 Jun  8 13:00 logrotate.d/
        </code></pre><p>
        You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
        responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
      </p></div><p>
      To run Apache server, the following files are required and must be created or copied to the appropriate directories on your server.
      </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
          Copy the <code class="filename">httpd.conf</code> file to the <code class="filename">/etc/httpd/conf/</code> directory.
        </p></li><li class="listitem"><p>
        Copy the <code class="filename">apache</code> file to the <code class="filename">/etc/logrotate.d/</code> directory.
        </p></li><li class="listitem"><p>
        Copy the <code class="filename">httpd</code> script file to the <code class="filename">/etc/rc.d/init.d/</code> directory.
        </p></li></ol></div><p>
    </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
        <span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
      </h3><p>
        You can obtain the configuration files listed in the following section on our <code class="filename">floppy.tgz</code> archive. Copy the following files from the decompressed floppy.tgz archive to the appropriate places, or copy them directly from this book to the concerned file.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm19232"></a>9. Configure the <code class="filename">/etc/httpd/conf/httpd.conf</code> file</h2></div></div></div><p>
      The <code class="filename">httpd.conf</code> file is the main configuration file for the Apache web server. A lot options exist, and it's important to read the documentation that comes with Apache for more information on different settings 
      and parameters. The following configuration example is a minimal working configuration file for Apache, with <acronym class="acronym">SSL</acronym> support. Also, it's important to note that we only comment the parameters that relate to security 
      and optimization, and leave all the others to your own research.
    </p><p>
      Edit the <code class="filename">httpd.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/httpd/conf/httpd.conf</code> and add/change:
    </p><pre class="programlisting">
      ### Section 1: Global Environment
      #
      ServerType standalone
      ServerRoot "/etc/httpd"
      PidFile /var/run/httpd.pid
      ResourceConfig /dev/null
      AccessConfig /dev/null
      Timeout 300
      KeepAlive On
      MaxKeepAliveRequests 0
      KeepAliveTimeout 15
      MinSpareServers 16
      MaxSpareServers 64
      StartServers 16
      MaxClients 512
      MaxRequestsPerChild 100000

      ### Section 2: 'Main' server configuration
      #
      Port 80

      &lt;IfDefine SSL&gt;
      Listen 80
      Listen 443
      &lt;/IfDefine&gt;

      User www
      Group www
      ServerAdmin admin@openna.com
      ServerName www.openna.com
      DocumentRoot "/home/httpd/ona"

      &lt;Directory /&gt;
      Options None
      AllowOverride None
      Order deny,allow
      Deny from all
      &lt;/Directory&gt;

      &lt;Directory "/home/httpd/ona"&gt;
      Options None
      AllowOverride None
      Order allow,deny
      Allow from all
      &lt;/Directory&gt;

      &lt;Files .pl&gt;
      Options None
      AllowOverride None
      Order deny,allow
      Deny from all
      &lt;/Files&gt;

      &lt;IfModule mod_dir.c&gt;
      DirectoryIndex index.htm index.html index.php index.php3 default.html index.cgi
      &lt;/IfModule&gt;

      #&lt;IfModule mod_include.c&gt;
      #Include conf/mmap.conf
      #&lt;/IfModule&gt;

      UseCanonicalName On

      &lt;IfModule mod_mime.c&gt;
      TypesConfig /etc/httpd/conf/mime.types
      &lt;/IfModule&gt;

      DefaultType text/plain
      HostnameLookups Off

      ErrorLog /var/log/httpd/error_log
      LogLevel warn
      LogFormat "%h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
      SetEnvIf Request_URI \.gif$ gif-image
      CustomLog /var/log/httpd/access_log combined env=!gif-image
      ServerSignature Off

      &lt;IfModule mod_alias.c&gt;
      ScriptAlias /cgi-bin/  "/home/httpd/cgi-bin/"
      &lt;Directory "/home/httpd/cgi-bin"&gt;
      AllowOverride None
      Options None
      Order allow,deny
      Allow from all
      &lt;/Directory&gt;
      &lt;/IfModuleGT;

      &lt;IfModule mod_mime.c&gt;
      AddEncoding x-compress Z
      AddEncoding x-gzip gz tgz

      AddType application/x-tar .tgz
      &lt;/IfModule&gt;

      ErrorDocument 500 "The server made a boo boo.
      ErrorDocument 404 http://192.168.1.1/error.htm
      ErrorDocument 403 "Access Forbidden -- Go away.

      &lt;IfModule mod_setenvif.c&gt;
      BrowserMatch "Mozilla/2" nokeepalive
      BrowserMatch "MSIE 4\.0b2;" nokeepalive downgrade-1.0 force-response-1.0
      BrowserMatch "RealPlayer 4\.0" force-response-1.0
      BrowserMatch "Java/1\.0" force-response-1.0
      BrowserMatch "JDK/1\.0" force-response-1.0
      &lt;/IfModule&gt;

      ### Section 3: Virtual Hosts
      #
      &lt;IfDefine SSL&gt;
      AddType application/x-x509-ca-cert .crt
      AddType application/x-pkcs7-crl    .crl
      &lt;/IfDefine&gt;

      &lt;IfModule mod_ssl.c&gt;
      SSLPassPhraseDialog     builtin
      SSLSessionCache         dbm:/var/run/ssl_scache
      SSLSessionCacheTimeout  300

      SSLMutex  file:/var/run/ssl_mutex

      SSLRandomSeed startup builtin
      SSLRandomSeed connect builtin

      SSLLog      /var/log/httpd/ssl_engine_log
      SSLLogLevel warn
      &lt;/IfModule&gt;

      &lt;IfDefine SSL&gt;
      &lt;VirtualHost _default_:443&gt;

      DocumentRoot "/home/httpd/ona"
      ServerName www.openna.com
      ServerAdmin admin@openna.com
      ErrorLog /var/log/httpd/error_log

      SSLEngine on
      SSLCipherSuite ALL:!ADH:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL

      SSLCertificateFile      /etc/ssl/certs/server.crt
      SSLCertificateKeyFile   /etc/ssl/private/server.key
      SSLCACertificatePath    /etc/ssl/certs
      SSLCACertificateFile    /etc/ssl/certs/ca.crt
      SSLCARevocationPath     /etc/ssl/crl
      SSLVerifyClient none
      SSLVerifyDepth  10

      SSLOptions +ExportCertData +StrictRequire
      SetEnvIf User-Agent ".*MSIE.*" nokeepalive ssl-unclean-shutdown
      SetEnvIf Request_URI \.gif$ gif-image
      CustomLog /var/log/httpd/ssl_request_log \
      "%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b" env=!gif-image
      &lt;/VirtualHost&gt;
      &lt;/IfDefine&gt;
    </pre><p>
      This tells <code class="filename">httpd.conf</code> file to set itself up for this particular configuration setup with:
    </p><div class="glosslist"><dl><dt><span class="glossterm"><code class="envar">ServerType standalone</code></span></dt><dd class="glossdef"><p>
          The option <code class="envar">ServerType</code> specifies how Apache should run on the system. You can run it from the super-server inetd, or as standalone daemon. It's highly recommended to run Apache in standalone type for 
          better performance and speed.
        </p></dd><dt><span class="glossterm"><code class="envar">ServerRoot "/etc/httpd"</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">ServerRoot</code> specifies the directory in which the configuration files of the Apache server lives. It allows Apache to know where it can find its configuration files when it starts.
      </p></dd><dt><span class="glossterm"><code class="envar">PidFile</code> <code class="filename">/var/run/httpd.pid</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">PidFile</code> specifies the location where the server will record the process id of the daemon when it starts. This option is only required when you configure Apache in standalone mode.
      </p></dd><dt><span class="glossterm"><code class="envar">ResourceConfig</code> <code class="filename">/dev/null</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">ResourceConfig</code> specifies the location of the old <code class="filename">srm.conf</code> file that Apache read after it finished reading the <code class="filename">httpd.conf</code> file. When you set the location 
        to <code class="filename">/dev/null,</code> Apache allows you to include the content of this file in <code class="filename">httpd.conf</code> file, and in this manner, you have just one file that handles all your configuration 
        parameters for simplicity.
      </p></dd><dt><span class="glossterm"><code class="envar">AccessConfig</code> <code class="filename">/dev/null</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">AccessConfig</code> specifies the location of the old <code class="filename">access.conf</code> file that Apache read after it finished reading the <code class="filename">srm.conf</code> file. When you set the location to <code class="filename">/dev/null</code>,
        Apache allows you to include the content of this file in <code class="filename">httpd.conf</code> file, and in this manner, you have just one file that handles all your configuration parameters for simplicity.
      </p></dd><dt><span class="glossterm"><code class="envar">Timeout 300</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">Timeout</code> specifies the amount of time Apache will wait for a GET, POST, PUT request and ACKs on transmissions. You can safely leave this option on its default values.
      </p></dd><dt><span class="glossterm"><code class="envar">KeepAlive On</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">KeepAlive</code>, if set to <code class="envar">On</code>, specifies enabling persistent connections on this web server. For better performance, it's recommended to set this option to <code class="envar">On</code>, and allow more than one request per connection.
      </p></dd><dt><span class="glossterm"><code class="envar">MaxKeepAliveRequests 0</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">MaxKeepAliveRequests</code> specifies the number of requests allowed per connection when the <code class="envar">KeepAlive</code> option above is set to <code class="envar">On.</code> When the value of this option is set to <code class="envar">0</code> then unlimited 
        requests are allowed on the server. For server performance, it's recommended to allow unlimited requests.
      </p></dd><dt><span class="glossterm"><code class="envar">KeepAliveTimeout 15</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">KeepAliveTimeout</code> specifies how much time, in seconds, Apache will wait for a subsequent request before closing the connection. The value of <code class="envar">15</code> seconds is a good average for server performance.
      </p></dd><dt><span class="glossterm"><code class="envar">MinSpareServers 16</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">MinSpareServers</code> specifies the minimum number of idle child server processes for Apache, which is not handling a request. This is an important tuning parameter regarding the performance of the Apache web server. For 
        high load operation, a value of <code class="envar">16</code> is recommended by various benchmarks on the Internet.
      </p></dd><dt><span class="glossterm"><code class="envar">MaxSpareServers 64</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">MaxSpareServers</code> specifies the maximum number of idle child server processes for Apache, which is not handling a request. This is also an important tuning parameter regarding the performance of the Apache web 
        server. For high load operation, a value of <code class="envar">64</code> is recommended by various benchmarks on the Internet.
      </p></dd><dt><span class="glossterm"><code class="envar">StartServers 16</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">StartServers</code> specifies the number of child server processes that will be created by Apache on start-up. This is, again, an important tuning parameter regarding the performance of the Apache web server. For high 
        load operation, a value of <code class="envar">16</code> is recommended by various benchmarks on the Internet.
      </p></dd><dt><span class="glossterm"><code class="envar">MaxClients 512</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">MaxClients</code> specifies the number of simultaneous requests that can be supported by Apache. This too is an important tuning parameter regarding the performance of the Apache web server. For high load 
        operation, a value of <code class="envar">512</code> is recommended by various benchmarks on the Internet.
      </p></dd><dt><span class="glossterm"><code class="envar">MaxRequestsPerChild 100000</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">MaxRequestsPerChild</code> specifies the number of requests that an individual child server process will handle. This too is an important tuning parameter regarding the performance of the Apache web server.
      </p></dd><dt><span class="glossterm"><code class="envar">User www</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">User</code> specifies the <acronym class="acronym">UID</acronym> that Apache server will run as. It's important to create a new user that has minimal access to the system, and functions just for the purpose of running the 
        web server daemon.
      </p></dd><dt><span class="glossterm"><code class="envar">Group www</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">Group</code> specifies the <acronym class="acronym">GID</acronym> the Apache server will run as. It's important to create a new group that has minimal access to the system and functions just for the purpose of running the web server daemon.
      </p></dd><dt><span class="glossterm"><code class="envar">DirectoryIndex index.htm index.html index.php index.php3 default.html index.cgi</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">DirectoryIndex</code> specifies the files to use by Apache as a pre-written <acronym class="acronym">HTML</acronym> directory index. In other words, if Apache can't find the default index page to display, it'll try the next entry in this parameter, if 
        available. To improve performance of your web server it's recommended to list the most used default index pages of your web site first.
      </p></dd><dt><span class="glossterm"><code class="envar">Include conf/mmap.conf</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">Include</code> specifies the location of other files that you can include from within the server configuration files <code class="filename">httpd.conf</code>. In our case, we include the <code class="filename">mmap.conf</code> file located 
        under <code class="filename">/etc/httpd/conf</code> directory. This file <code class="filename">mmap.conf</code> maps files into memory for faster serving. See the section on <a class="link" href="#pr6ch29sapo" title="22. Optimizing Apache">Optimizing Apache</a> for more information.
      </p></dd><dt><span class="glossterm"><code class="envar">HostnameLookups Off</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">HostnameLookups</code>, if set to <code class="envar">Off</code>, specifies the disabling of <acronym class="acronym">DNS</acronym> lookups. It's recommended to set this option to <code class="envar">Off</code> in order to save the network traffic time, and to improve 
        the performance of your Apache web server.
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm19392"></a>10. Configure the <code class="filename">/etc/logrotate.d/apache</code> file</h2></div></div></div><p>
      Configure your <code class="filename">/etc/logrotate.d/apache</code> file to rotate each week your Apache log files automatically.
      Create the <code class="filename">apache</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/logrotate.d/apache</code> and add:
    </p><pre class="programlisting">
      /var/log/httpd/access_log {
      missingok
      postrotate
      /usr/bin/killall -HUP httpd
      endscript
      }

      /var/log/httpd/error_log {
      missingok
      postrotate
      /usr/bin/killall -HUP httpd
      endscript
      }

      /var/log/httpd/ssl_request_log {
      missingok
      postrotate
      /usr/bin/killall -HUP httpd
      endscript
      }

      /var/log/httpd/ssl_engine_log {
      missingok
      postrotate
      /usr/bin/killall -HUP httpd
      endscript
      }
    </pre><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
        <span class="inlinemediaobject"><img src="./images/Caution.gif" alt="CAution"></span>
      </h3><p>
        Lines to automatically rotate the <acronym class="acronym">SSL</acronym> log files named <code class="filename">ssl_request_log</code> and <code class="filename">ssl_engine_log</code> are included in this file. If you 
        intend to run Apache without <acronym class="acronym">SSL</acronym> support, you must remove the lines related to <acronym class="acronym">SSL</acronym>.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm19414"></a>11. Configure the <code class="filename">/etc/rc.d/init.d/httpd</code> script file</h2></div></div></div><p>
      Configure your <code class="filename">/etc/rc.d/init.d/httpd</code> script file to start and stop Apache Web Server.
      Create the <code class="filename">httpd</code> script file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/rc.d/init.d/httpd</code> and add:
    </p><pre class="programlisting">
      #!/bin/sh
      #
      # Startup script for the Apache Web Server
      #
      # chkconfig: 345 85 15
      # description: Apache is a World Wide Web server.  It is used to serve \
      #	       HTML files and CGI.
      # processname: httpd
      # pidfile: /var/run/httpd.pid
      # config: /etc/httpd/conf/httpd.conf


      # Source function library.
      . /etc/rc.d/init.d/functions

      # See how we were called.
      case "$1" in
      start)
      echo -n "Starting httpd: "
      daemon httpd -DSSL
      echo
      touch /var/lock/subsys/httpd
      ;;
      stop)
      echo -n "Shutting down http: "
      killproc httpd
      echo
      rm -f /var/lock/subsys/httpd
      rm -f /var/run/httpd.pid
      ;;
      status)
      status httpd
      ;;
      restart)
      $0 stop
      $0 start
      ;;
      reload)
      echo -n "Reloading httpd: "
      killproc httpd -HUP
      echo
      ;;
      *)
      echo "Usage: $0 {start|stop|restart|reload|status}"
      exit 1
      esac

      exit 0
    </pre><p>
      Now, make this script executable and change its default permissions:
      </p><pre class="screen">
        [root@deep ]/# <span class="command"><strong>chmod</strong></span> 700  /etc/rc.d/init.d/httpd
      </pre><p>
      Create the symbolic rc.d links for Apache with the command:
      </p><pre class="screen">
        [root@deep ]/# <span class="command"><strong>chkconfig</strong></span> --add httpd
      </pre><p>
    </p><p>
      Start your new Apache server manually with the following command:
      </p><pre class="screen">
        [root@deep ]/# /etc/rc.d/init.d/httpd <span class="command"><strong>start</strong></span>
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        Starting httpd:                                            	[  OK  ]
      </code></pre><p>
    
    The  <code class="literal">-DSSL</code> option will start Apache in <acronym class="acronym">SSL</acronym> mode. If you want to start Apache in regular mode, remove the  <code class="literal">-DSSL</code> option near the line that 
    reads <code class="envar">daemon httpd</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm19437"></a>12. <acronym class="acronym">PHP4</acronym> server-side scripting</h2></div></div></div><p>
      If you intend to use <acronym class="acronym">PHP4</acronym> server-side scripting language support with your Apache web server don't forget to include in your <code class="filename">/etc/httpd/conf/httpd.conf</code> file the following lines to enable this feature:
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        Edit the <code class="filename">httpd.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/httpd/conf/httpd.conf</code>, and add the following lines between the section tags &lt;IfModule mod_mime.c&gt; and &lt;/IfModule&gt;:
        </p><pre class="programlisting">
          AddType application/x-httpd-php .php
          AddType application/x-httpd-php .php3
          AddType application/x-httpd-php-source .phps
        </pre><p>
      </p></li><li class="step"><p>
        You must restart the Apache web server for the changes to take effect, using the following commands:
        </p><pre class="screen">
          [root@deep ]/# /etc/rc.d/init.d/httpd <span class="command"><strong>restart</strong></span>
        </pre><p>
        </p><pre class="literallayout"><code class="computeroutput">
          Shutting down http:                                        	[  OK  ]
          Starting httpd:                                            	[  OK  ]
        </code></pre><p>
      </p></li><li class="step"><p>
        Once the above lines have been included in our <code class="filename">httpd.conf</code> file, we must test the new <acronym class="acronym">PHP4</acronym> feature to be sure it's working. We'll create a small <acronym class="acronym">PHP</acronym> file named 
        <code class="filename">php.php</code> in our DocumentRoot, and then point our web broswer to this <acronym class="acronym">PHP</acronym> document to see if <acronym class="acronym">PHP</acronym>4 work on the server.
        Create the <code class="filename">php.php</code> file in your DocumentRoot, <span class="command"><strong>touch</strong></span> <code class="filename">/home/httpd/ona/php.php</code> and add the following lines in the <acronym class="acronym">PHP</acronym> file:
        </p><pre class="programlisting">
          &lt;body bgcolor="#FFFFFF"&gt;
          &lt;?php phpinfo()?&gt;
          &lt;/body&gt;
        </pre><p>
        These lines will inform <acronym class="acronym">PHP</acronym>4 program to display various pieces of information about the  configuration of our Linux server.
      </p></li><li class="step"><p>
        Now, point your web browser to the following address:<code class="literal">http://my-web-server/php.php</code>

        The &lt;my-web-server&gt; is the address where your Apache web server resides, and &lt;php.php&gt; is the <acronym class="acronym">PHP</acronym> document we have created above to display the information and configuration of our Linux server.
      </p></li></ol></div><div class="mediaobject" align="center"><img src="./images/PHP-Info.gif" align="middle" alt="PHP info"></div><p>
      If you see something like the above page appearing in your web browser congratulations! Your <acronym class="acronym">PHP</acronym> module is working.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch29sappsy"></a>13. Perl module Devel::Symdump</h2></div></div></div><p>
      If you intend to use the mod_perl programming language support with your Apache web server, it can be interesting to install the small perl module program named <code class="filename">Devel::Symdump</code>. This third party module will allow you to 
      inspect perl's symbol table and the class hierarchies within a running program. To build and install it, follow these steps.
    </p><p>
      These are the package(s)
      </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
          Devel-Symdump Homepage:<a class="link" href="#prtinxfp31" title="Perl module Devel::Symdump">http://www.perl.com/CPAN/modules/by-module/Devel/</a> 
        </td></tr><tr><td>
        You must be sure to download: Devel-Symdump-2_00_tar.gz
        </td></tr><tr><td>
          Devel-Symdump version number is 2.00
        </td></tr></table><p>
    </p><p>
      </p><pre class="screen">
        [root@deep ]/# <span class="command"><strong>cp</strong></span> Devel-Symdump-version.tar.gz /var/tmp/
        [root@deep ]/# <span class="command"><strong>cd</strong></span> /var/tmp/
        [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf Devel-Symdump-version.tar.gz
      </pre><p>
    </p><p>
      Move into the new <code class="filename">Devel-Symdump</code> directory and type the following commands on your terminal to compile and install the module on your Linux server:
      </p><pre class="screen">
        [root@deep ]/Devel-Symdump-2.00# <span class="command"><strong>perl</strong></span> Makefile.PL
        [root@deep ]/Devel-Symdump-2.00# <span class="command"><strong>make</strong></span> 
        [root@deep ]/Devel-Symdump-2.00# <span class="command"><strong>make test</strong></span> 
        [root@deep ]/Devel-Symdump-2.00# <span class="command"><strong>make install</strong></span> 
      </pre><p>
    </p><p>
      Once the module has been installed on your system, you must include in your <code class="filename">/etc/httpd/conf/httpd.conf</code> file the following lines to be able to see the status of different Perl modules on the server:
      Edit the <code class="filename">httpd.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/httpd/conf/httpd.conf</code> and add the following lines:
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        </p><pre class="programlisting">
          &lt;Location /perl-status&gt;
          SetHandler  perl-script
          PerlHandler Apache::Status
          Order deny,allow
          Deny from all
          Allow from 192.168.1.0/24
          &lt;/Location&gt;
        </pre><p>
      </p></li><li class="step"><p>
      You must restart the Apache web server for the changes to take effect:
      To restart Apache, use the following commands:
      </p><pre class="screen">
        [root@deep ]/# /etc/rc.d/init.d/httpd <span class="command"><strong>restart</strong></span>
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        Shutting down http:                                        	[  OK  ]
        Starting httpd:                                            	[  OK  ]
      </code></pre><p>
      </p></li><li class="step"><p>
        Finally, we must test the new Devel-Symdump module to be sure that we can see status of different Perl modules on the server.
      </p></li></ol></div><p>
      To verify that it works, points your web browser to the following address: <code class="literal">http://my-web-server/perl-status/</code>. The &lt;my-web-server&gt; is the address where your Apache web server resides.
    </p><div class="mediaobject" align="center"><img src="./images/Mod-Perl.gif" align="middle" alt="Mod perl"></div><p>
      Please as always Cleanup :
      </p><pre class="screen">
        [root@deep ]/# <span class="command"><strong>cd</strong></span> /var/tmp
        [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf Devel-Symdump.version/ Devel-Symdump-version.tar.gz
      </pre><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm19531"></a>13.1. Installed files</h3></div></div></div><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/usr/lib/perl5/man/man3/Devel::Symdump.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Devel</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Devel/Symdump</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Devel/Symdump/.packlist</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/Devel</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/Devel/Symdump</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/Devel/Symdump/Export.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/Devel/Symdump.pm</code></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch29sapcgi"></a>14. CGI.pm Perl library</h2></div></div></div><p>
      The CGI.pm is a Perl5 library for writing World Wide Web <acronym class="acronym">CGI</acronym> scripts. Older versions of this software exist by default on your system, but they are buggy. It's recommended that you update your copy to version 2.56, at least. To 
      update this module, please follow these steps.
    </p><p>
      These are the package(s)
      </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
        CGI.pm Homepage: <a class="link" href="#prtinxfp32" title="CGI.pm Perl library">http://stein.cshl.org/WWW/software/CGI/cgi_docs.html</a>
      </td></tr><tr><td>
      You must be sure to download: CGI_pm_tar.gz
      </td></tr><tr><td>
      CGI.pm version number is 2.56
      </td></tr></table><p>
    </p><pre class="screen">
      [root@deep ]/# <span class="command"><strong>cp</strong></span> CGI_pm_tar.gz /var/tmp/
      [root@deep ]/# <span class="command"><strong>cd</strong></span> /var/tmp/
      [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf CGI_pm_tar.gz
    </pre><p>
      First of all, well check the version of CGI.pm installed in our system with the following command: 
      </p><pre class="screen">
        [root@deep ]/# <span class="command"><strong>perl</strong></span> -e 'use CGI; print $CGI::VERSION."\n";'
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        2.46
      </code></pre><p>
    </p><p>
      Move into the new CGI.pm directory and type the following commands on your terminal to compile and install the updated libraries on your Linux server:
      </p><pre class="screen">
        [root@deep ]/CGI.pm-2.56# <span class="command"><strong>perl</strong></span> Makefile.PL
        [root@deep ]/CGI.pm-2.56# <span class="command"><strong>make</strong></span> 
        [root@deep ]/CGI.pm-2.56# <span class="command"><strong>make test</strong></span> 
        [root@deep ]/CGI.pm-2.56# <span class="command"><strong>make install</strong></span> 
      </pre><p>
    </p><p>
      Please do cleanup later:
      </p><pre class="screen">
        [root@deep ]/# <span class="command"><strong>cd</strong></span> /var/tmp
        [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf CGI.pm-version/ CGI_pm_tar.gz
      </pre><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm19579"></a>14.1. Installed files</h3></div></div></div><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/usr/lib/perl5/5.00503/CGI/Pretty.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/5.00503/i386-linux/auto/CGI</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/5.00503/i386-linux/auto/CGI/.packlist</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/CGI::Pretty.3</code></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch29apscr"></a>15. Securing Apache</h2></div></div></div><p>
      Change some important permissions on files and directories for your Web Server. When you install Apache on your server, there are some files and directories that have too many permissions set by default. The binary program 
      <code class="filename">httpd</code> can be set to be read-only by the super-user <code class="literal">root</code>, and executable by the owner, group, and others for better security. The <code class="filename">/etc/httpd/conf</code> 
      and <code class="filename">/var/log/httpd</code> directories don't need to by readable, writable or executable by other people.
      </p><pre class="screen">
        [root@deep ]/# <span class="command"><strong>chmod</strong></span> 511 /usr/sbin/httpd
        [root@deep ]/# <span class="command"><strong>chmod</strong></span> 750 /etc/httpd/conf/
        [root@deep ]/# <span class="command"><strong>chmod</strong></span> 750 /var/log/httpd/
      </pre><p>
    </p><p>
      If you have enabled the automatic indexing of directories in your Apache configuration file; <code class="envar">IndexOptions</code> in <code class="filename">httpd.conf</code>, then you'll have a security issue since any requests for a directory 
      that don't find an index file will build an index of what is in the directory. In many cases, you may only want people seeing files that you specifically link to. To turn this off, you need to remove read permissions from the 
      <code class="filename">DocumentRoot</code> directory but not the files inside it.
      </p><pre class="screen">
        [root@deep ]/# <span class="command"><strong>cd</strong></span> /home/httpd/
        [root@deep ]/httpd# <span class="command"><strong>chmod</strong></span> 311 ona
        [root@deep ]/httpd# ls -la
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        d-wx--x--x   13 webadmin webadmin     1024 Jul 28 08:12 ona
      </code></pre><p>
      Now, with this modification, any requests for this protected directory should return an error message like:
      </p><pre class="literallayout"><code class="computeroutput">
        Forbidden
        You don't have permission to access /ona/ on this server.
      </code></pre><p>
    </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
        <span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
      </h3><p>
        <code class="filename">ona</code> is the <code class="filename">DocumentRoot</code>, the directory out of which you will serve your documents, in our example.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm19622"></a>16. users authentication with <code class="filename">.dbmpasswd</code> password file</h2></div></div></div><p>
      This step is necessary only if you think that you'll use an access file authentication system for your web site. Access file authentication is used when you have the need to protect some part of your web site with a user password. With 
      Apache, a lot of options exist to protect your site with usernames and passwords.
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        The <span class="command"><strong>dbmmanage</strong></span> program utility of Apache can be used to create and update usernames and passwords of <acronym class="acronym">HTTP</acronym> users. This method use a <acronym class="acronym">DBM</acronym> format files that is the fastest mechanism when you have 
        thousands users to manage in your password file. First of all, it's important to change the permission of this program to be <code class="literal">0750/-rwxr-x---</code>, writable only by the super-user <code class="literal">root</code>, readable and executable by group 
        and nothing for the others.</p><ol type="a" class="substeps"><li class="step"><p>
            To change the permissions on the <span class="command"><strong>dbmmanage</strong></span> program, use the following command:
            </p><pre class="screen">
              [root@deep ]/# <span class="command"><strong>chmod</strong></span> 750 /usr/bin/dbmmanage
            </pre><p>
          </p></li><li class="step"><p>
            To create a username and password, use the following command:
            </p><pre class="screen">
              [root@deep ]/# /usr/bin/dbmmanage  /etc/httpd/.dbmpasswd adduser username
            </pre><p>
            </p><pre class="literallayout"><code class="computeroutput">
              New password:
              Re-type new password:
              User username added with password encrypted to l4jrdAL9MH0K.
            </code></pre><p>
            Where &lt;/etc/httpd&gt; is the location of the password file, &lt;.dbmpasswd&gt; is the name of the password file, and &lt;username&gt; is the name of the user you want to add in your <code class="filename">.dbmpasswd</code> file.
          </p></li></ol></li><li class="step"><p>
        If you use the <span class="command"><strong>dbmmanage</strong></span> utility with your Apache web server to create passwords and usernames, don't forget to include in your <code class="filename">/etc/httpd/conf/httpd.conf</code> configuration file the part of your web site 
        you need to protect with user password authentication:
        Edit the <code class="filename">httpd.conf</code> file <span class="command"><strong>vi</strong></span> <code class="filename">/etc/httpd/conf/httpd.conf</code> and add the following lines to protect the <code class="literal">private</code> directory of your web site <code class="literal">ona</code> with 
        user password authentication:
        </p><pre class="programlisting">
          &lt;Directory "/home/httpd/ona/private"&gt;
          Options None
          AllowOverride AuthConfig
          AuthName "restricted stuff"
          AuthType Basic
          AuthDBUserFile /etc/httpd/.dbmpasswd
          require valid-user
          &lt;/Directory&gt;
        </pre><p>
        The path &lt;/home/httpd/ona/private&gt; specifies the directory we want to protect with a password and username, the &lt;/etc/httpd/.dbmpasswd&gt; specifies the location of the password file.

        To add the DB password authentication module to your Apache Web Server, you must be sure to include it during the configuration time of Apache with the following parameter <code class="envar">--add-module=src/modules/standard/mod_auth_db.c</code>. See 
        your Apache documentation for more information.
      </p></li><li class="step"><p>
        You must restart Apache web server for the changes to take effect:
        To restart Apache, use the following commands:
        </p><pre class="screen">
          [root@deep ]/# /etc/rc.d/init.d/httpd <span class="command"><strong>restart</strong></span>
        </pre><p>
        </p><pre class="literallayout"><code class="computeroutput">
          Shutting down http:                                        	[  OK  ]
          Starting httpd:                                            	[  OK  ]
        </code></pre><p>
      </p></li><li class="step"><p>
        Finally, we must test the new protected directory named <code class="literal">private</code>.
        To verify that it works, point your web browser to the following address: <code class="literal">http://my-web-server/private/</code>. The &lt;my-web-server&gt; is the address where your Apache web server lives. The &lt;/private/&gt; is the directory 
        we want to protect with user password authentication.
      </p></li></ol></div><div class="mediaobject"><img src="./images/Apache-Passwd.gif" alt="Apache password"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm19672"></a>16.1. Immunize configuration files like <code class="filename">httpd.conf</code></h3></div></div></div><p>
        As we already know, the immutable bit can be used to prevent deletion, overwriting or creation of a symbolic link to a file. Once your <code class="filename">httpd.conf</code> file has been configured, it's a good idea to immunize it with 
        the following command:
        </p><pre class="screen">
          [root@deep ]/# <span class="command"><strong>chattr</strong></span>  +i /etc/httpd/conf/httpd.conf
        </pre><p>
          </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm19679"></a>17. Apache in a chroot jail</h2></div></div></div><p>
      This part focuses on preventing Apache from being used as a point of break-in to the system hosting it. Apache by default runs as a non-root user, which will limit any damage to what can be done as a normal user with a local shell. 
      Of course, allowing what amounts to an anonymous guest account falls rather short of the security requirements for most Apache servers, so an additional step can be taken - that is, running Apache in a chroot jail.
    </p><p>
      The main benefit of a chroot jail is that the jail will limit the portion of the file system the daemon can see to the root directory of the jail. Additionally, since the jail only needs to support Apache, the programs available in 
      the jail can be extremely limited. Most importantly, there is no need for setuid-root programs, which can be used to gain root access and break out of the jail.
    </p><div class="mediaobject" align="center"><img src="./images/Apache-Chroot.gif" align="middle" alt="Proxy Netscape Configuration"></div><p>
    Chrooting apache is no easy task and has a tendency to break things. Before we embark on this, we need to first decide whether it is beneficial for you to do so. Some pros and cons are there, but most certainly not limited to, the following:
</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Pros and Cons </b></p></div></div></div><p>
        </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
            If apache is ever compromised, the attacker will not have access to the entire file system.
          </p></li><li class="listitem"><p>
          Poorly written <acronym class="acronym">CGI</acronym> scripts that may allow someone to access your server will not work.
          </p></li></ol></div><p>
      </p><p>
        </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
            There are extra libraries you'll need to have in the chroot jail for Apache to work.
          </p></li><li class="listitem"><p>
            If you use any <acronym class="acronym">Perl/CGI</acronym> features with Apache, you will need to copy the needed binaries, Perl libraries and files to the appropriate spot within the chroot space. The same applies for <acronym class="acronym">SSL</acronym>, <acronym class="acronym">PHP</acronym>, LDAP, 
            PostgresSQL and other third-party programs.
          </p></li></ol></div><p>
      </p></div><p>
      The chrooted configuration listed below supposes that you've compiled your Apache server with the external program mod_ssl. The differences in what you've compiled with your Apache web server reside in which libraries and binaries 
      you'll need to copy to the chrooted directory.
    </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
        <span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
      </h3><p>
        Remember that if you've compiled Apache to use mod_perl, you must copy all the related binaries and Perl libraries to the chrooted directory. Perl resides in <code class="filename">/usr/lib/perl5</code> and in case 
        you use Perl features, copy the Perl directories to <code class="filename">/chroot/httpd/usr/lib/perl5/</code>. Don't forget to create the directory <code class="filename">/chroot/httpd/usr/lib/perl5</code> 
        in your chrooted structure before copying.
      </p></div><p>
        The following are the necessary steps to run Apache Web Server in a chroot jail:
      </p><p>
        We must find the shared library dependencies of httpd. These will need to be copied into the chroot jail later.
        To find the shared library dependencies of httpd, execute the following command:
        </p><pre class="screen">
          [root@deep ]/# ldd /usr/sbin/httpd
        </pre><p>
        </p><pre class="literallayout"><code class="computeroutput">
          libpam.so.0 =&gt;/lib/libpam.so.0 (0x40016000)
          libm.so.6 =&gt;/lib/libm.so.6 (0x4001f000)
          libdl.so.2 =&gt;/lib/libdl.so.2 (0x4003b000)
          libcrypt.so.1 =&gt;/lib/libcrypt.so.1 (0x4003e000)
          libnsl.so.1 =&gt;/lib/libnsl.so.1 (0x4006b000)
          libresolv.so.2 =&gt;/lib/libresolv.so.2 (0x40081000)
          libdb.so.3 =&gt;/lib/libdb.so.3 (0x40090000)
          libc.so.6 =&gt;/lib/libc.so.6 (0x400cb000)
          /lib/ld-linux.so.2 =&gt;/lib/ld-linux.so.2 (0x40000000)
        </code></pre><p>
        Make a note of the files listed above, you will need these later in our steps.
      </p><p>
        Add a new <acronym class="acronym">UID</acronym> and a new <acronym class="acronym">GID</acronym> if this is not already done for running Apache httpd. This is important because running it as root defeats the purpose of the jail, and 
        using a different <acronym class="acronym">UID</acronym> that already exists on the system <abbr class="abbrev">i.e.</abbr> <code class="literal">nobody</code> can allow your services to access each others' resources. Consider the scenario 
        where a web server is running as <code class="literal">nobody</code>, or any other overly used <acronym class="acronym">UID/GID</acronym> and compromised. The cracker can now access any other processes running as nobody from within 
        the chroot.
      </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
          These are sample <acronym class="acronym">UID/GID</acronym>s. Check the <code class="filename">/etc/passwd</code> and <code class="filename">/etc/group</code> files for a free <acronym class="acronym">UID/GID</acronym> number. In our configuration we'll use 
          the numeric value <code class="literal">80</code> and <acronym class="acronym">UID/GID</acronym> <code class="literal">www</code>.
          </p><pre class="screen">
            [root@deep ]/# <span class="command"><strong>useradd</strong></span> -c "Apache Server" -u 80 -s /bin/false -r -d /home/httpd www 2&gt;/dev/null || :
          </pre><p>
          The above commands will create the group <code class="literal">www</code> with the numerical <acronym class="acronym">GID</acronym> value <code class="literal">80</code>, and the user <code class="literal">www</code> with the numerical <acronym class="acronym">UID</acronym> value <code class="literal">80</code>.
        </p></li><li class="step"><p>
          Set up the chroot environment. First we need to create the chrooted Apache structure. We use <code class="filename">/chroot/httpd</code> for the chrooted Apache. The <code class="filename">/chroot/httpd</code> is 
          just a directory on a different partition where we've decided to put apache for more security.
          
            </p><pre class="screen">
              [root@deep ]/# /etc/rc.d/init.d/httpd stop  <a name="apchrt1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
            </pre><p>
            </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#apchrt1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
                Only if Apache is already installed and run on your system.
              </p></td></tr></table></div><p>
          
          </p><pre class="literallayout"><code class="computeroutput">
            Shutting down http:                                        [  OK  ]
          </code></pre><p>
          </p><pre class="screen">
            [root@deep ]/# <span class="command"><strong>mkdir</strong></span> /chroot/httpd
          </pre><p>
        </p></li><li class="step"><p>
          Next, create the rest of directories as follows:
          </p><pre class="screen">
            [root@deep ]/# <span class="command"><strong>mkdir</strong></span> /chroot/httpd/dev
            [root@deep ]/# <span class="command"><strong>mkdir</strong></span> /chroot/httpd/lib
            [root@deep ]/# <span class="command"><strong>mkdir</strong></span> /chroot/httpd/etc
            [root@deep ]/# <span class="command"><strong>mkdir</strong></span> -p /chroot/httpd/usr/sbin
            [root@deep ]/# <span class="command"><strong>mkdir</strong></span> -p /chroot/httpd/var/run
            [root@deep ]/# <span class="command"><strong>mkdir</strong></span> -p /chroot/httpd/var/log/httpd
            [root@deep ]/# <span class="command"><strong>chmod</strong></span> 750 /chroot/httpd/var/log/httpd/
            [root@deep ]/# <span class="command"><strong>mkdir</strong></span> -p /chroot/httpd/home/httpd
          </pre><p>
        </p></li><li class="step"><p>
          Copy the main configuration directory, the configuration files, the cgi-bin directory, the root directory and the httpd program to the chroot jail:

          [root@deep ]/# <span class="command"><strong>cp</strong></span> -r /etc/httpd /chroot/httpd/etc/
          [root@deep ]/# <span class="command"><strong>cp</strong></span> -r /home/httpd/cgi-bin /chroot/httpd/home/httpd/
          [root@deep ]/# <span class="command"><strong>cp</strong></span> -r /home/httpd/your-DocumentRoot /chroot/httpd/home/httpd/
          [root@deep ]/# <span class="command"><strong>mknod</strong></span> /chroot/httpd/dev/null c 1 3
          [root@deep ]/# <span class="command"><strong>chmod</strong></span> 666 /chroot/httpd/dev/null
          [root@deep ]/# <span class="command"><strong>cp</strong></span> /usr/sbin/httpd /chroot/httpd/usr/sbin/

          We need the <code class="filename">/chroot/httpd/etc</code>, <code class="filename">/chroot/httpd/dev</code>, <code class="filename">/chroot/httpd/lib</code>, <code class="filename">/chroot/httpd/usr/sbin</code>
          <code class="filename">/chroot/httpd/var/run</code>, <code class="filename">/chroot/httpd/home/httpd</code> and <code class="filename">/chroot/httpd/var/log/httpd</code> directories because, from the point of the chroot, 
          we're sitting at <code class="filename">/</code>.
        </p></li><li class="step"><p>

          If you have compiled your Apache web server with <acronym class="acronym">SSL</acronym> support, you must copy the entire <code class="filename">/etc/ssl</code> directory that handles all private and public keys to the chroot jail.
          </p><pre class="screen">
            [root@deep ]/# <span class="command"><strong>cp</strong></span> -r /etc/ssl /chroot/httpd/etc/ ß require only if you use mod_ssl feature.
            [root@deep ]/# <span class="command"><strong>chmod</strong></span> 600 /chroot/httpd/etc/ssl/certs/ca.crt ß require only if you use mod_ssl feature.
            [root@deep ]/# <span class="command"><strong>chmod</strong></span> 600 /chroot/httpd//etc/ssl/certs/server.crt ß require only if you use mod_ssl feature.
            [root@deep ]/# <span class="command"><strong>chmod</strong></span> 600 /chroot/httpd/etc/ssl/private/ca.key ß require only if you use mod_ssl feature.
            [root@deep ]/# <span class="command"><strong>chmod</strong></span> 600 /chroot/httpd/etc/ssl/private/server.key ß require only if you use mod_ssl feature.
          </pre><p>
        </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm19800"></a>18. Apache to use shared libraries</h2></div></div></div><p>
      Since we have compiled apache to use shared libraries, we need to install them into the chroot directory structure. Use <span class="command"><strong>ldd</strong></span> <code class="filename">/chroot/httpd/usr/sbin/httpd</code> to find out which libraries are needed. 
      The output, depending on what you've compiled with Apache will be something similar to:
      </p><pre class="literallayout"><code class="computeroutput">
        libpam.so.0 =&gt;/lib/libpam.so.0 (0x40016000)
        libm.so.6 =&gt;/lib/libm.so.6 (0x4001f000)
        libdl.so.2 =&gt;/lib/libdl.so.2 (0x4003b000)
        libcrypt.so.1 =&gt;/lib/libcrypt.so.1 (0x4003e000)
        libnsl.so.1 =&gt;/lib/libnsl.so.1 (0x4006b000)
        libresolv.so.2 =&gt;/lib/libresolv.so.2 (0x40081000)
        libdb.so.3 =&gt;/lib/libdb.so.3 (0x40090000)
        libc.so.6 =&gt;/lib/libc.so.6 (0x400cb000)
        /lib/ld-linux.so.2 =&gt;/lib/ld-linux.so.2 (0x40000000)
      </code></pre><p>
    </p><p>
      Copy the shared libraries identified above:
      </p><pre class="screen">
        [root@deep ]/# <span class="command"><strong>cp</strong></span> /lib/libpam.so.0 /chroot/httpd/lib/
        [root@deep ]/# <span class="command"><strong>cp</strong></span> /lib/libm.so.6 /chroot/httpd/lib/
        [root@deep ]/# <span class="command"><strong>cp</strong></span> /lib/libdl.so.2 /chroot/httpd/lib/
        [root@deep ]/# <span class="command"><strong>cp</strong></span> /lib/libcrypt.so.1 /chroot/httpd/lib/
        [root@deep ]/# <span class="command"><strong>cp</strong></span> /lib/libnsl* /chroot/httpd/lib/
        [root@deep ]/# <span class="command"><strong>cp</strong></span> /lib/libresolv* /chroot/httpd/lib/
        [root@deep ]/# <span class="command"><strong>cp</strong></span> /lib/libdb.so.3 /chroot/httpd/lib/
        [root@deep ]/# <span class="command"><strong>cp</strong></span> /lib/libc.so.6 /chroot/httpd/lib/
        [root@deep ]/# <span class="command"><strong>cp</strong></span> /lib/ld-linux.so.2 /chroot/httpd/lib/
      </pre><p>
    </p><p>
      You'll also need the following extra libraries for some network functions, like resolving:
      </p><pre class="screen">
        [root@deep ]/# <span class="command"><strong>cp</strong></span> /lib/libnss_compat* /chroot/httpd/lib/
        [root@deep ]/# <span class="command"><strong>cp</strong></span> /lib/libnss_dns* /chroot/httpd/lib/
        [root@deep ]/# <span class="command"><strong>cp</strong></span> /lib/libnss_files* /chroot/httpd/lib/
      </pre><p>
    </p><div class="procedure"><ul class="procedure"><li class="step"><p>
        We now need to copy the passwd and group files inside the <code class="filename">/chroot/httpd/etc</code> chrooted directory. The concept here is the same as how ftpd uses passwd and group files. Next, we'll remove 
        all entries except for the user that apache runs as in both files <code class="literal">passwd</code> and <code class="literal">group</code>.
        </p><ol type="a" class="substeps"><li class="step"><p>
            </p><pre class="screen">
              [root@deep ]/# <span class="command"><strong>cp</strong></span> /etc/passwd /chroot/httpd/etc/
              [root@deep ]/# <span class="command"><strong>cp</strong></span> /etc/group /chroot/httpd/etc/
            </pre><p>
          </p></li><li class="step"><p>
            Edit the <code class="filename">passwd</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/chroot/httpd/etc/passwd</code> and delete all entries except for the user apache run as in our configuration, it's <code class="literal">www</code>:
            </p><pre class="programlisting">
              www:x:80:80::/home/www:/bin/bash
            </pre><p>
          </p></li><li class="step"><p>
            Edit the <code class="literal">group</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/chroot/httpd/etc/group</code> and delete all entries except the group apache run as, in our configuration it,s <code class="literal">www</code>:
            </p><pre class="programlisting">
              www:x:80:
            </pre><p>
          </p></li></ol></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm19849"></a>19. The <code class="filename">/chroot/etc</code> directory</h2></div></div></div><p>
      You will also need <code class="filename">/etc/resolv.conf</code>, <code class="filename">/etc/nsswitch.conf</code> and <code class="filename">/etc/hosts</code> files in your chroot jail.

      [root@deep ]/# <span class="command"><strong>cp</strong></span> /etc/resolv.conf /chroot/httpd/etc/
      [root@deep ]/# <span class="command"><strong>cp</strong></span> /etc/hosts /chroot/httpd/etc/
      [root@deep ]/# <span class="command"><strong>cp</strong></span> /etc/nsswitch.conf /chroot/httpd/etc/
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        Now we must set some files in the chroot jail directory immutable for better security.
        </p><ol type="a" class="substeps"><li class="step"><p>
            Set the immutable bit on <code class="filename">passwd</code> file:
            </p><pre class="screen">
              [root@deep ]/# <span class="command"><strong>cd</strong></span> /chroot/httpd/etc/
              [root@deep ]/# <span class="command"><strong>chattr</strong></span>  +i passwd
            </pre><p>
          </p></li><li class="step"><p>
          Set the immutable bit on <code class="filename">group</code> file:
          </p><pre class="screen">
            [root@deep ]/# <span class="command"><strong>cd</strong></span> /chroot/httpd/etc/
            [root@deep ]/# <span class="command"><strong>chattr</strong></span>  +i group
          </pre><p>
          </p></li><li class="step"><p>
            Set the immutable bit on <code class="filename">httpd.conf</code> file:
            </p><pre class="screen">
              [root@deep ]/# <span class="command"><strong>cd</strong></span> /chroot/httpd/etc/httpd/conf/
              [root@deep ]/# <span class="command"><strong>chattr</strong></span>  +i httpd.conf
            </pre><p>
          </p></li><li class="step"><p>
            Set the immutable bit on <code class="filename">resolv.conf</code> file:
            </p><pre class="screen">
              [root@deep ]/# <span class="command"><strong>cd</strong></span> /chroot/httpd/etc/
              [root@deep ]/# <span class="command"><strong>chattr</strong></span>  +i resolv.conf
            </pre><p>
          </p></li><li class="step"><p>
          Set the immutable bit on <code class="filename">hosts</code> file:
          </p><pre class="screen">
            [root@deep ]/# <span class="command"><strong>cd</strong></span> /chroot/httpd/etc/
            [root@deep ]/# <span class="command"><strong>chattr</strong></span>  +i hosts
          </pre><p>
        
          Set the immutable bit on <code class="filename">nsswitch.conf</code> file:
          </p><pre class="screen">
          [root@deep ]/# <span class="command"><strong>cd</strong></span> /chroot/httpd/etc/
          [root@deep ]/# <span class="command"><strong>chattr</strong></span>  +i nsswitch.conf
          </pre><p>
            </p></li></ol></li><li class="step"><p>
        Copy the <code class="filename">localtime</code> file to the jail so that log entries are adjusted for your local timezone properly:
        </p><pre class="screen">
          [root@deep ]/# <span class="command"><strong>cp</strong></span> /etc/localtime /chroot/httpd/etc/
        </pre><p>
      </p></li><li class="step"><p>

        Remove unnecessary Apache files and directories:
        </p><pre class="screen">
          [root@deep ]/# <span class="command"><strong>rm</strong></span> -rf /var/log/httpd/
          [root@deep ]/# <span class="command"><strong>rm</strong></span> -rf /etc/httpd/
          [root@deep ]/# <span class="command"><strong>rm</strong></span> -rf /home/httpd/
          [root@deep ]/# <span class="command"><strong>rm</strong></span> -f  /usr/sbin/httpd
        </pre><p>
        We can remove safely all of the above files and directories since they are now located under our chroot jail directory.
      </p></li><li class="step"><p>
        Normally, processes talk to syslogd through <code class="filename">/dev/log</code>. As a result of the chroot jail, this won't be possible, so syslogd needs to be told to listen to <code class="filename">/chroot/httpd/dev/log</code>. 
        To do this, edit the <code class="filename">syslog</code> startup script, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/rc.d/init.d/syslog</code> to specify additional places to listen.
        </p><pre class="programlisting">
          daemon syslogd -m 0
        </pre><p>
        To read:
        </p><pre class="programlisting">
          daemon syslogd -m 0 -a /chroot/httpd/dev/log
        </pre><p>
      </p></li><li class="step"><p>
        The default <code class="filename">httpd</code> script file of Apache starts the daemon <code class="literal">httpd</code> outside the chroot jail. We must change it to now start httpd from the chroot jail. 
        </p><ol type="a" class="substeps"><li class="step"><p>
Edit the <code class="filename">httpd</code> script file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/rc.d/init.d/httpd</code> and change the line:
            </p><pre class="programlisting">
              daemon httpd
            </pre><p>
            To read:
            </p><pre class="programlisting">
              /usr/sbin/chroot /chroot/httpd/ /usr/sbin/httpd -DSSL
            </pre><p>
          </p></li><li class="step"><p>
            </p><pre class="programlisting">
              <span class="command"><strong>rm</strong></span> -f  /var/run/httpd.pid
            </pre><p>
            To read:
            </p><pre class="programlisting">
              <span class="command"><strong>rm</strong></span> -f  /chroot/httpd/var/run/httpd.pid
            </pre><p>
          </p></li></ol></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm19936"></a>20. Test the new chrooted jail</h2></div></div></div><p>
      Finally, we must test the new chrooted jail configuration of our Apache Web Server. The first thing to do is to restart our syslogd daemon with the following command:
      </p><pre class="screen">
        [root@deep ]/# /etc/rc.d/init.d/syslog <span class="command"><strong>restart</strong></span>
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        Shutting down kernel logger:                               	[  OK  ]
        Shutting down system logger:                               	[  OK  ]
        Starting system logger:                                    	[  OK  ]
        Starting kernel logger:                                		[  OK  ]
      </code></pre><p>
    </p><p>
      Now, start the new chrooted jail Apache with the following command:
      </p><pre class="screen">
        [root@deep ]/# /etc/rc.d/init.d/httpd <span class="command"><strong>start</strong></span>
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        Starting httpd:                                            		[  OK  ]
      </code></pre><p>
    </p><p>
      If you don't get any errors, do a <span class="command"><strong>ps ax</strong></span> | <span class="command"><strong>grep httpd</strong></span> and see if we're running:
      </p><pre class="screen">
        [root@deep ]/# <span class="command"><strong>ps ax</strong></span> | <span class="command"><strong>grep httpd</strong></span>
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        14373 ?        S      0:00 httpd -DSSL
        14376 ?        S      0:00 httpd -DSSL
        14377 ?        S      0:00 httpd -DSSL
        14378 ?        S      0:00 httpd -DSSL
        14379 ?        S      0:00 httpd -DSSL
        14380 ?        S      0:00 httpd -DSSL
        14381 ?        S      0:00 httpd -DSSL
        14382 ?        S      0:00 httpd -DSSL
        14383 ?        S      0:00 httpd -DSSL
        14384 ?        S      0:00 httpd -DSSL
        14385 ?        S      0:00 httpd -DSSL
        14386 ?        S      0:00 httpd -DSSL
        14387 ?        S      0:00 httpd -DSSL
        14388 ?        S      0:00 httpd -DSSL
        14389 ?        S      0:00 httpd -DSSL
        14390 ?        S      0:00 httpd -DSSL
        14391 ?        S      0:00 httpd -DSSL
        14397 ?        S      0:00 httpd -DSSL
        14476 ?        S      0:00 httpd -DSSL
        14477 ?        S      0:00 httpd -DSSL
        14478 ?        S      0:00 httpd -DSSL
      </code></pre><p>
    </p><p>
      If so, lets check to make sure it's chrooted by picking out one of its process numbers and doing <strong class="userinput"><code>ls -la /proc/that_process_number/root/.</code></strong>
      </p><pre class="screen">
        [root@deep ]/# ls -la /proc/14373/root/
      </pre><p>
      If you see:
      </p><pre class="literallayout"><code class="computeroutput">
        dev
        etc
        home
        lib
        usr
        var
      </code></pre><p>
      congratulations!
    </p><p>
      As mentioned above, if you use Perl, you'll need to copy or hardlink any system libraries, perl libraries <code class="filename">/usr/lib/perl5</code>, and binaries into the chroot area. The same applies for <acronym class="acronym">SSL</acronym>, <acronym class="acronym">PHP</acronym>, LDAP, 
      PostgreSQL and other programs.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm19965"></a>21. Configure the new <code class="filename">/etc/logrotate.d/apache</code> file</h2></div></div></div><p>
      Now Apache logs files residing in the <code class="filename">/chroot/var/log/httpd</code> directory instead of <code class="filename">/var/log/httpd</code> and for this reason we need to modify the <code class="filename">/etc/logrotate.d/httpd</code> 
      file to point to the new chrooted directory. Also, we've compiled Apache with mod_ssl, so we'll add one more line to permit the logrotate program to rotate the <code class="filename">ssl_request_log</code> and <code class="filename">ssl_engine_log</code> files. 
      Configure your <code class="filename">/etc/logrotate.d/apache</code> file to rotate your log files each week automatically.
    </p><p>
      Create the <code class="filename">apache</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/logrotate.d/apache</code> and add:
      </p><pre class="programlisting">
        /chroot/httpd/var/log/httpd/access_log {
        missingok
        postrotate
        /usr/bin/killall -HUP /chroot/httpd/usr/sbin/httpd
        endscript
        }

        /chroot/httpd/var/log/httpd/error_log {
        missingok
        postrotate
        /usr/bin/killall -HUP /chroot/httpd/usr/sbin/httpd
        endscript
        }

        /chroot/httpd/var/log/httpd/ssl_request_log {
        missingok
        postrotate
        /usr/bin/killall -HUP /chroot/httpd/usr/sbin/httpd
        endscript
        }

        /chroot/httpd/var/log/httpd/ssl_engine_log {
        missingok
        postrotate
        /usr/bin/killall -HUP /chroot/httpd/usr/sbin/httpd
        endscript
        }
      </pre><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch29sapo"></a>22. Optimizing Apache</h2></div></div></div><p>
      The mod_mmap_static module of Apache, is a special module with the Apache distribution named <code class="literal">mod_mmap_static</code> that can be used to improve the performance of your Web Server. This module works by providing 
      mappings of a statically configured list of frequently requested, but not changed, files in your RootDirectory. So, if files displayed by Apache don't change often, you can use this module to memory-map the static documents 
      and increase the speed of your Apache web server.
    </p><p>
    It's important to note that the mod_mmap_static module of Apache must be enabled during the configuration and compilation time of Apache before you can use it. If you have followed our steps described in the configuration and 
    compilation time section above, this is already in Apache  <code class="envar">--add-module-../mod_mmap_static.c</code>.
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        To memory-map static documents, use the following command:
        </p><pre class="screen">
          [root@deep ]/# find /home/httpd/ona -type f -print | sed -e 's/.*/mmapfile &amp;/' /etc/httpd/conf/mmap.conf
        </pre><p>
        The <code class="filename">/home/httpd/ona</code> is the RootDirectory, or to be more precise, the directory out of which you will serve your documents, and the <code class="filename">/etc/httpd/conf/mmap.conf</code> 
        is the location where we want to create this file, <code class="filename">mmap.conf</code>, that contains a static memory-map of all documents under our RootDirectory.
      </p></li><li class="step"><p>
        Once the <code class="filename">mmap.conf</code> file has been created under the location where we have chosen to keep this file, we must include it in the <code class="filename">httpd.conf</code> file of Apache to be able to use its features on our web server.
        Edit the <code class="filename">httpd.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/httpd/conf/httpd.conf</code> and add the line:
        </p><pre class="programlisting">
          &lt;IfModule mod_include.c&gt;
          Include conf/mmap.conf
          &lt;/IfModule&gt;
        </pre><p>

      </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
        <span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Proxy Netscape Configuration"></span>

      </h3><p>
        See your Apache documentation for more information about the use of mod_mmap_static. Remember that this feature must be only used when you serve documents that don't change often on your web site.
      </p></div><p>
        You must restart the Apache web server for the changes to take effect:
        </p><pre class="screen">
          [root@deep ]/# /etc/rc.d/init.d/httpd <span class="command"><strong>restart</strong></span>
        </pre><p>
        </p><pre class="literallayout"><code class="computeroutput">
          Shutting down http:                                        	[  OK  ]
          Starting httpd:                                            	[  OK  ]
        </code></pre><p>
      </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"> The atime and noatime attributes</h3><p>
      </p><div class="mediaobject"><img src="./images/Tip.gif" alt="Tip"></div><p>
      The atime and noatime attributes of Linux can be used to get measurable performance gains in Apache. See in this book, <a class="link" href="#pr2ch6scntm" title="11. The atime and noatime attribute">General System Optimization</a>, for more information on the subject.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm20023"></a>23. Installed files for Apache Web Server</h2></div></div></div><p>
      These are the files installed by the software program Apache on your server.
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/rc.d/init.d/httpd</code></td><td><code class="filename">/etc/rc.d/rc0.d/K15httpd</code></td><td><code class="filename">/etc/rc.d/rc1.d/K15httpd</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc2.d/K15httpd</code></td><td><code class="filename">/etc/rc.d/rc3.d/S85httpd</code></td><td><code class="filename">/etc/rc.d/rc4.d/S85httpd</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc5.d/S85httpd</code></td><td><code class="filename">/etc/rc.d/rc6.d/K15httpd</code></td><td><code class="filename">/etc/logrotate.d/apache</code></td></tr><tr><td><code class="filename">/etc/httpd</code></td><td><code class="filename">/etc/httpd/conf</code></td><td><code class="filename">/etc/httpd/conf/httpd.conf.default</code></td></tr><tr><td><code class="filename">/etc/httpd/conf/httpd.conf</code></td><td><code class="filename">/etc/httpd/conf/mime.types.default</code></td><td><code class="filename">/etc/httpd/conf/mime.types</code></td></tr><tr><td><code class="filename">/etc/httpd/conf/magic.default</code></td><td><code class="filename">/etc/httpd/conf/magic</code></td><td><code class="filename">/etc/httpd/php.ini</code></td></tr><tr><td><code class="filename">/home/httpd</code></td><td><code class="filename">/home/httpd/cgi-bin</code></td><td><code class="filename">/home/httpd/cgi-bin/printenv</code></td></tr><tr><td><code class="filename">/home/httpd/cgi-bin/test-cgi</code></td><td><code class="filename">/usr/bin/htpasswd</code></td><td><code class="filename">/usr/bin/htdigest</code></td></tr><tr><td><code class="filename">/usr/bin/dbmmanage</code></td><td><code class="filename">/usr/include/apache</code></td><td><code class="filename">/usr/include/apache/xml</code></td></tr><tr><td><code class="filename">/usr/include/apache/xml/asciitab.h</code></td><td><code class="filename">/usr/include/apache/xml/hashtable.h</code></td><td><code class="filename">/usr/include/apache/xml/iasciitab.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/xml/latin1tab.h</code></td><td><code class="filename">/usr/include/apache/xml/nametab.h</code></td><td><code class="filename">/usr/include/apache/xml/utf8tab.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/xml/xmldef.h</code></td><td><code class="filename">/usr/include/apache/xml/xmlparse.h</code></td><td><code class="filename">/usr/include/apache/xml/xmlrole.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/xml/xmltok.h</code></td><td><code class="filename">/usr/include/apache/xml/xmltok_impl.h</code></td><td><code class="filename">/usr/include/apache/alloc.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/ap.h</code></td><td><code class="filename">/usr/include/apache/ap_compat.h</code></td><td><code class="filename">/usr/include/apache/ap_config.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/ap_config_auto.h</code></td><td><code class="filename">/usr/include/apache/ap_ctx.h</code></td><td><code class="filename">/usr/include/apache/ap_ctype.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/ap_hook.h</code></td><td><code class="filename">/usr/include/apache/ap_md5.h</code></td><td><code class="filename">/usr/include/apache/ap_mm.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/ap_mmn.h</code></td><td><code class="filename">/usr/include/apache/ap_sha1.h</code></td><td><code class="filename">/usr/include/apache/buff.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/compat.h</code></td><td><code class="filename">/usr/include/apache/conf.h</code></td><td><code class="filename">/usr/include/apache/explain.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/fnmatch.h</code></td><td><code class="filename">/usr/include/apache/hsregex.h</code></td><td><code class="filename">/usr/include/apache/http_conf_globals.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/http_config.h</code></td><td><code class="filename">/usr/include/apache/http_core.h</code></td><td><code class="filename">/usr/include/apache/http_log.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/http_main.h</code></td><td><code class="filename">/usr/include/apache/http_protocol.h</code></td><td><code class="filename">/usr/include/apache/http_request.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/http_vhost.h</code></td><td><code class="filename">/usr/include/apache/httpd.h</code></td><td><code class="filename">/usr/include/apache/multithread.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/rfc1413.h</code></td><td><code class="filename">/usr/include/apache/scoreboard.h</code></td><td><code class="filename">/usr/include/apache/util_date.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/util_md5.h</code></td><td><code class="filename">/usr/include/apache/util_script.h</code></td><td><code class="filename">/usr/include/apache/util_uri.h</code></td></tr><tr><td><code class="filename">/usr/include/apache/os.h</code></td><td><code class="filename">/usr/include/apache/os-inline.c</code></td><td><code class="filename">/usr/lib/apache</code></td></tr><tr><td><code class="filename">/usr/man/man1/htpasswd.1</code></td><td><code class="filename">/usr/man/man1/htdigest.1</code></td><td><code class="filename">/usr/man/man1/dbmmanage.1</code></td></tr><tr><td><code class="filename">/usr/man/man8/ab.8</code></td><td><code class="filename">/usr/man/man8/httpd.8</code></td><td><code class="filename">/usr/man/man8/logresolve.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/rotatelogs.8</code></td><td><code class="filename">/usr/man/man8/apxs.8</code></td><td><code class="filename">/usr/sbin/httpd</code></td></tr><tr><td><code class="filename">/usr/sbin/ab</code></td><td><code class="filename">/usr/sbin/logresolve</code></td><td><code class="filename">/usr/sbin/rotatelogs</code></td></tr><tr><td><code class="filename">/usr/sbin/apxs</code></td><td><code class="filename">/var/log/httpd</code></td><td><code class="filename">/var/cache</code></td></tr><tr><td><code class="filename">/var/cache/httpd</code></td><td> </td><td> </td></tr></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm20209"></a>24. Installed files /PHP4</h2></div></div></div><p>
      These are the tnstalled files by PHP4 server-side scripting language with Apache Web Server:

    </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/usr/bin/phpize</code></td><td><code class="filename">/usr/bin/php-config</code></td></tr><tr><td><code class="filename">/usr/include/php</code></td><td><code class="filename">/usr/include/php/Zend</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/FlexLexer.h</code></td><td><code class="filename">/usr/include/php/Zend/acconfig.h</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/modules.h</code></td><td><code class="filename">/usr/include/php/Zend/zend-parser.h</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/zend-scanner.h</code></td><td><code class="filename">/usr/include/php/Zend/zend.h</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/zend_API.h</code></td><td><code class="filename">/usr/include/php/Zend/zend_alloc.h</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/zend_builtin_functions.h</code></td><td><code class="filename">/usr/include/php/Zend/zend_compile.h</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/zend_config.h</code></td><td><code class="filename">/usr/include/php/Zend/zend_config.w32.h</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/zend_constants.h</code></td><td><code class="filename">/usr/include/php/Zend/zend_dynamic_array.h</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/zend_errors.h</code></td><td><code class="filename">/usr/include/php/Zend/zend_execute.h</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/zend_execute_locks.h</code></td><td><code class="filename">/usr/include/php/Zend/zend_extensions.h</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/zend_fast_cache.h</code></td><td><code class="filename">/usr/include/php/Zend/zend_globals.h</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/zend_globals_macros.h</code></td><td><code class="filename">/usr/include/php/Zend/zend_hash.h</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/zend_highlight.h</code></td><td><code class="filename">/usr/include/php/Zend/zend_indent.h</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/zend_list.h</code></td><td><code class="filename">/usr/include/php/Zend/zend_llist.h</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/zend_operators.h</code></td><td><code class="filename">/usr/include/php/Zend/zend_ptr_stack.h</code></td></tr><tr><td><code class="filename">/usr/include/php/Zend/zend_stack.h</code></td><td><code class="filename">/usr/include/php/Zend/zend_variables.h</code></td></tr><tr><td><code class="filename">/usr/include/php/TSRM</code></td><td><code class="filename">/usr/include/php/TSRM/TSRM.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext</code></td><td><code class="filename">/usr/include/php/ext/standard</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/base64.h</code></td><td><code class="filename">/usr/include/php/ext/standard/basic_functions.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/cyr_convert.h</code></td><td><code class="filename">/usr/include/php/ext/standard/datetime.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/dl.h</code></td><td><code class="filename">/usr/include/php/ext/standard/dns.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/exec.h</code></td><td><code class="filename">/usr/include/php/ext/standard/file.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/flock_compat.h</code></td><td><code class="filename">/usr/include/php/ext/standard/fsock.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/global.h</code></td><td><code class="filename">/usr/include/php/ext/standard/head.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/html.h</code></td><td><code class="filename">/usr/include/php/ext/standard/info.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/md5.h</code></td><td><code class="filename">/usr/include/php/ext/standard/microtime.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/pack.h</code></td><td><code class="filename">/usr/include/php/ext/standard/pageinfo.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/php_array.h</code></td><td><code class="filename">/usr/include/php/ext/standard/php_assert.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/php_browscap.h</code></td><td><code class="filename">/usr/include/php/ext/standard/php_crypt.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/php_dir.h</code></td><td><code class="filename">/usr/include/php/ext/standard/php_filestat.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/php_image.h</code></td><td><code class="filename">/usr/include/php/ext/standard/php_iptc.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/php_lcg.h</code></td><td><code class="filename">/usr/include/php/ext/standard/php_link.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/php_mail.h</code></td><td><code class="filename">/usr/include/php/ext/standard/php_metaphone.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/php_output.h</code></td><td><code class="filename">/usr/include/php/ext/standard/php_rand.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/php_standard.h</code></td><td><code class="filename">/usr/include/php/ext/standard/php_string.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/php_syslog.h</code></td><td><code class="filename">/usr/include/php/ext/standard/php_var.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/phpdir.h</code></td><td><code class="filename">/usr/include/php/ext/standard/phpmath.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/quot_print.h</code></td><td><code class="filename">/usr/include/php/ext/standard/reg.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/type.h</code></td><td><code class="filename">/usr/include/php/ext/standard/uniqid.h</code></td></tr><tr><td><code class="filename">/usr/include/php/ext/standard/url.h</code></td><td><code class="filename">/usr/include/php/ext/standard/url_scanner.h</code></td></tr><tr><td><code class="filename">/usr/include/php/regex</code></td><td><code class="filename">/usr/include/php/regex/regex.h</code></td></tr><tr><td><code class="filename">/usr/include/php/regex/regex_extra.h</code></td><td><code class="filename">/usr/include/php/php.h</code></td></tr><tr><td><code class="filename">/usr/include/php/php_regex.h</code></td><td><code class="filename">/usr/include/php/php3_compat.h</code></td></tr><tr><td><code class="filename">/usr/include/php/safe_mode.h</code></td><td><code class="filename">/usr/include/php/fopen-wrappers.h</code></td></tr><tr><td><code class="filename">/usr/include/php/php_version.h</code></td><td><code class="filename">/usr/include/php/php_globals.h</code></td></tr><tr><td><code class="filename">/usr/include/php/php_reentrancy.h</code></td><td><code class="filename">/usr/include/php/php_ini.h</code></td></tr><tr><td><code class="filename">/usr/include/php/SAPI.h</code></td><td><code class="filename">/usr/include/php/php_config.h</code></td></tr><tr><td><code class="filename">/usr/include/php/zend_config.h</code></td><td><code class="filename">/usr/include/php/build-defs.h</code></td></tr><tr><td><code class="filename">/usr/lib/php</code></td><td><code class="filename">/usr/lib/php/DB</code></td></tr><tr><td><code class="filename">/usr/lib/php/DB/common.php</code></td><td><code class="filename">/usr/lib/php/DB/odbc.php</code></td></tr><tr><td><code class="filename">/usr/lib/php/DB/mysql.php</code></td><td><code class="filename">/usr/lib/php/DB/pgsql.php</code></td></tr><tr><td><code class="filename">/usr/lib/php/DB/storage.php</code></td><td><code class="filename">/usr/lib/php/build</code></td></tr><tr><td><code class="filename">/usr/lib/php/build/pear.m4</code></td><td><code class="filename">/usr/lib/php/build/fastgen.sh</code></td></tr><tr><td><code class="filename">/usr/lib/php/build/library.mk</code></td><td><code class="filename">/usr/lib/php/build/ltlib.mk</code></td></tr><tr><td><code class="filename">/usr/lib/php/build/program.mk</code></td><td><code class="filename">/usr/lib/php/build/rules.mk</code></td></tr><tr><td><code class="filename">/usr/lib/php/build/rules_pear.mk</code></td><td><code class="filename">/usr/lib/php/build/shtool</code></td></tr><tr><td><code class="filename">/usr/lib/php/build/acinclude.m4</code></td><td><code class="filename">/usr/lib/php/DB.php</code></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm20445"></a>25. Installed files by mod_perl</h2></div></div></div><p>
      Installed files by mod_perl programming language with Apache Web Server on your machine.
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/usr/lib/perl5/5.00503/i386-linux/perllocal.pod</code></td><td><code class="filename">/usr/lib/perl5/man/man3/Apache.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::Constants.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/Apache::Leak.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::Log.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/Apache::PerlRunXS.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::Symbol.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/Apache::Table.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::URI.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/Apache::Util.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::FakeRequest.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/mod_perl.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::ExtUtils.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/Apache::SIG.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::Status.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/Apache::Include.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::Debug.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/Apache::Resource.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::src.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/Apache::PerlRun.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::httpd_conf.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/mod_perl_traps.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::Options.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/mod_perl_cvs.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::Symdump.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/Apache::RegistryLoader.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/mod_perl_method_handlers.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/mod_perl_tuning.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/cgi_to_mod_perl.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/Apache::StatINC.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::Registry.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/Bundle::Apache.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::SizeLimit.3</code></td><td><code class="filename">/usr/lib/perl5/man/man3/Apache::PerlSections.3</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/man/man3/Apache::RedirectLogFix.3</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/buff.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/multithread.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/httpd.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/ap_config.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/alloc.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/ap.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/ap_md5.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/ap_ctx.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/util_md5.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/rfc1413.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/conf.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/util_uri.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/explain.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/ap_compat.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/http_config.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/ap_sha1.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/scoreboard.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/compat.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/http_request.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/http_core.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/ap_mm.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/http_protocol.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/util_date.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/ap_hook.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/http_main.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/http_conf_globals.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/util_script.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/http_vhost.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/ap_ctype.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/hsregex.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/ap_mmn.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/ap_config_auto.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/http_log.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/include/fnmatch.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/netware</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/netware/os.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/netware/getopt.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/netware/test_char.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/netware/uri_delims.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/netware/precomp.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/bs2000</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/bs2000/os-inline.c</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/bs2000/ebcdic.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/bs2000/os.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/tpf</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/tpf/ebcdic.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/tpf/os.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/tpf/os-inline.c</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/win32</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/win32/service.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/win32/getopt.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/win32/registry.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/win32/resource.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/win32/installer</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/win32/installer/installdll</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/win32/installer/installdll/test</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/win32/installer/installdll/test/test.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/win32/installer/installdll/test/resource.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/win32/os.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/win32/passwd.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/win32/readdir.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/unix</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/unix/os.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/unix/os-inline.c</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/os390</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/os390/os-inline.c</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/os390/ebcdic.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/os390/os.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/mpeix</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/mpeix/os-inline.c</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/mpeix/os.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/os2</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/os2/os.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/os/os2/os-inline.c</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/ssl</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/ssl/ssl_expr.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/ssl/ssl_util_table.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/ssl/ssl_util_ssl.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/ssl/ssl_expr_parse.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/ssl/mod_ssl.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/ssl/ssl_util_sdbm.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/perl</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/perl/mod_perl.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/perl/mod_perl_version.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/perl/perl_PL.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/perl/mod_perl_xs.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/php4</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/php4/mod_php4.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/proxy</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/proxy/mod_proxy.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/standard</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/modules/standard/mod_rewrite.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/support</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/support/suexec.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/lib</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/lib/expat-lite</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/lib/expat-lite/iasciitab.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/lib/expat-lite/latin1tab.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/lib/expat-lite/xmldef.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/lib/expat-lite/xmlparse.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/lib/expat-lite/xmltok.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/lib/expat-lite/xmlrole.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/lib/expat-lite/hashtable.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/lib/expat-lite/nametab.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/lib/expat-lite/xmltok_impl.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/lib/expat-lite/utf8tab.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/lib/expat-lite/asciitab.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/regex</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/regex/utils.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/regex/regex2.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/regex/cclass.h</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/include/regex/cname.h</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/typemap</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/Leak</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/Leak/Leak.so</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/Leak/Leak.bs</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/Symbol</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/Symbol/Symbol.so</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/Apache/Symbol/Symbol.bs</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/mod_perl</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/mod_perl/.packlist</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/mod_perl.pod</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Bundle</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Bundle/Apache.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/test.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Debug.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Resource.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/src.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/httpd_conf.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Symdump.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/RegistryLoader.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Registry.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/SizeLimit.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/RedirectLogFix.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/MyConfig.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Constants</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Constants/Exports.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/SIG.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/StatINC.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Opcode.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/PerlSections.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/FakeRequest.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/ExtUtils.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Include.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Status.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/PerlRun.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Options.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/RegistryNG.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/RegistryBB.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Connection.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Constants.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/File.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Leak.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Log.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/ModuleConfig.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/PerlRunXS.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Server.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Symbol.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Table.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/URI.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache/Util.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/mod_perl_hooks.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/mod_perl_hooks.pm.PL</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/mod_perl_tuning.pod</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/mod_perl_cvs.pod</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/mod_perl_method_handlers.pod</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/mod_perl.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/mod_perl_traps.pod</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/cgi_to_mod_perl.pod</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/Apache.pm</code></td></tr></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="idm20873"></a>Chapter 30. Optional component to install with Apache</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#pr6ch30swblzr">1. Linux Webalizer</a></span></dt><dt><span class="section"><a href="#idm20959">2. Compile</a></span></dt><dd><dl><dt><span class="section"><a href="#idm20986">2.1. Configurations</a></span></dt></dl></dd><dt><span class="section"><a href="#idm21018">3. Configure the <code class="filename">/etc/webalizer.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm21094">4. Make Apache aware of Webalizer output directory</a></span></dt><dd><dl><dt><span class="section"><a href="#idm21112">4.1. Running Webalizer manually first time</a></span></dt></dl></dd><dt><span class="section"><a href="#idm21128">5. Run Webalizer automatically with a cron job</a></span></dt><dd><dl><dt><span class="section"><a href="#idm21134">5.1. Installed files</a></span></dt></dl></dd><dt><span class="section"><a href="#pr6ch30scfqmtc">6. Linux FAQ-O-Matic</a></span></dt><dt><span class="section"><a href="#idm21203">7. Compile and install FAQ-O-Matic</a></span></dt><dt><span class="section"><a href="#idm21263">8. Make Apache aware Faq-O-Matic file's location</a></span></dt><dt><span class="section"><a href="#idm21281">9. Configure your FAQ-O-Matic</a></span></dt><dt><span class="section"><a href="#idm21343">10. Installed files</a></span></dt><dt><span class="section"><a href="#pr6ch30swmlimp">11. Linux Webmail IMP</a></span></dt><dt><span class="section"><a href="#pr6ch30sphplb">12. Set up PHPLib </a></span></dt><dt><span class="section"><a href="#idm21572">13. Compile to install Webmail IMP</a></span></dt><dt><span class="section"><a href="#idm21628">14. Configure and create Webmail IMP SQL database</a></span></dt><dt><span class="section"><a href="#idm21708">15. Configure your <code class="filename">php.ini</code> from PHP4</a></span></dt><dd><dl><dt><span class="section"><a href="#idm21728">15.1. Configure Apache to recognize Webmail IMP</a></span></dt></dl></dd><dt><span class="section"><a href="#idm21743">16. Configure Webmail <acronym class="acronym">IMP</acronym> via your web browser</a></span></dt></dl></div><div class="highlights"><p>
    In this chapter, Three-useful external programs that you may install on your Linux server are explained. These programs have been made for use with the Apache Web Server, and are useful only if you intend to use Apache in your 
    organization. If this is not the case, you can skip this chapter and continue through the rest of this book. To begin, we'll talk about:
    </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
        Webalizer, which is a web server log file analysis program. 
      </p></li><li class="listitem"><p>
      Then we'll discuss FAQ-O-Matic, which can be used when you want a <acronym class="acronym">FAQ</acronym> list, bug-tracing database, documentation and much more on your server. 
      </p></li><li class="listitem"><p>
      Finally, we'll talk about a very sophisticated and interesting program called Webmail, which allows you to offer free mail accounts to your clients, or access and read your mail, in a secure manner.
      </p></li></ol></div><p>
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch30swblzr"></a>1. Linux Webalizer</h2></div></div></div><p>
      A web server like Apache logs all predefined log entry information into a text file that can be viewed and analyzed by the web administrator. This file can also be evaluated by a special program which can produce the information in a 
      graphical presentation, making interpretation easier for the administrator.
    </p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>As per in the [<span class="citation">README</span>] file of Webalizer:</b></p></div></div></div><p>
        The Webalizer is a web server log file analysis program, which produces usage statistics in HTML format for viewing with a browser.  The results are presented in both columnar and graphical format, which facilitates 
        interpretation. Yearly, monthly, daily and hourly usage statistics are presented, along with the ability to display usage by site, URL, referrer, user agent, <span class="emphasis"><em>browser</em></span> and country, <span class="emphasis"><em>user 
        agent and referrer are only available if your web server produces Combined log format files</em></span>.
      </p></div><p>
      These installation instructions assume
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Commands are Unix-compatible.
        </p></li><li class="listitem"><p>
        The source path is <code class="filename">/var/tmp</code>, <span class="emphasis"><em>other paths are possible</em></span>.
        </p></li><li class="listitem"><p>
        Installations were tested on Red Hat Linux 6.1 and 6.2.
        </p></li><li class="listitem"><p>
        All steps in the installation will happen in super-user account <code class="literal">root</code>.
        </p></li><li class="listitem"><p>
        Webalizer version number is 1_30-04
        </p></li></ul></div><p>
    </p><p>
      These are the Package(s):
      </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
          Webalizer Homepage: <a class="link" href="#prtinxfp33" title="Linux Webalizer">http://www.mrunix.net/webalizer/</a>
        </td></tr><tr><td>
        Webalizer FTP Site: <a class="link" href="#prtinxfp33" title="Linux Webalizer">207.153.121.6</a>
        </td></tr><tr><td>
        You must be sure to download: webalizer-1_30-04-src.tgz
        </td></tr></table><p>
    </p><p>
      Before you compile, decompress the tarball (tar.gz).
      </p><pre class="screen">
        [root@deep /]# <span class="command"><strong>cp</strong></span> webalizer-version-src.tgz /var/tmp/
        [root@deep /]# <span class="command"><strong>cd</strong></span> /var/tmp/
        [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf webalizer-version-src.tgz
      </pre><p>
    </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
        <span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>

      </h3><p>
        There are a few prerequisites; the Webalizer requires that the <acronym class="acronym">GD</acronym> Graphics Library, which is required for generating inline graphics for the Webalizer program, be already installed on your system. If this is 
        not the case, you must install it from your Red Hat Linux CD-ROM.
      </p></div><p>
      To verify that the <acronym class="acronym">GD</acronym> package is installed on your Linux system, use the following command:
      </p><pre class="screen">
        [root@deep /]# <span class="command"><strong>rpm</strong></span> -qi gd
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        package gd is not installed
      </code></pre><p>

      To install the <acronym class="acronym">GD</acronym> packages on your Linux system, use the following command:
      </p><pre class="screen">
        [root@deep /]# <span class="command"><strong>mount</strong></span> /dev/cdrom /mnt/cdrom/
        [root@deep /]# <span class="command"><strong>cd</strong></span> /mnt/cdrom/RedHat/RPMS/
        [root@deep ]/RPMS# <span class="command"><strong>rpm</strong></span> -Uvh gd-version.i386.rpm
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        gd                          ##################################################
      </code></pre><p>
      </p><pre class="screen">
        [root@deep ]/RPMS# <span class="command"><strong>rpm</strong></span> -Uvh gd-devel-version.i386.rpm
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        gd-devel                    ##################################################
      </code></pre><p>
      </p><pre class="screen">
        [root@deep ]/RPMS# <span class="command"><strong>cd</strong></span> /; umount /mnt/cdrom/
      </pre><p>
    </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
        <span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>

      </h3><p>      
        The Apache web server should be already installed on your system to be able to use Webalizer software, of course.
      </p></div><p>
      For more information on <a class="link" href="#pr6ch29wapch" title="Chapter 29. Software -Network Server, web/Apache">Apache web server</a>, see its related chapter in this book.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm20959"></a>2. Compile</h2></div></div></div><p>
      Move into the new Webalizer directory and type the following commands on your terminal:
      </p><pre class="programlisting">
        CC="egcs" \
        CFLAGS="-O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions" \
        ./configure \
        --prefix=/usr
      </pre><p>
      </p><pre class="screen">
        [root@deep ]/webalizer-1.30-04# <span class="command"><strong>make</strong></span>
        [root@deep ]/webalizer-1.30-04# <span class="command"><strong>make install</strong></span>
        [root@deep ]/webalizer-1.30-04# <span class="command"><strong>mkdir</strong></span> /home/httpd/usage
      </pre><p>
    </p><p>
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <span class="command"><strong>make</strong></span> command will compile all source files into executable binaries, 
        </p></li><li class="listitem"><p>
        The <span class="command"><strong>make install</strong></span> will install the binaries and any supporting files into the appropriate locations. 
        </p></li><li class="listitem"><p>
        The <span class="command"><strong>mkdir</strong></span> will create a new directory named <code class="literal">usage</code> under the <code class="filename">/home/httpd/</code> directory where we'll handle all related Webalizer files.
        </p></li></ul></div><p>
    </p><p>
      Please do cleanup later:
      </p><pre class="screen">
        [root@deep /]# <span class="command"><strong>cd</strong></span> /var/tmp
        [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf webalizer-version/ webalizer-version-src.tgz
      </pre><p>
      The <span class="command"><strong>rm</strong></span> command will remove all the source files we have used to compile and install Webalizer. It will also remove the Webalizer compressed archive from the <code class="filename">/var/tmp</code> directory.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm20986"></a>2.1. Configurations</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
          You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
          for respective software. For example <em class="wordasword">Webalizer</em> configuration file are organised like this:
          </p><pre class="literallayout"><code class="computeroutput">
            total 8
            -rw-r--r--    1 harrypotter     harrypotter          208 Jul 26 18:04 webalizer.conf

          </code></pre><p>
          You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
          responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
        </p></div><p>
        To run Webalizer, the following file is required, and must be created or copied to the appropriate directory on your server.
        </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
          Copy the webalizer.conf file to the <code class="filename">/etc/</code> directory.
        </p></li></ol></div><p>
      </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
          <span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
        </h3><p>
          To run Webalizer, the following file from the floppy.tgz archive is required and must be created or copied to the appropriate directory on your server. Copy the sxid.conf file to the <code class="filename">/etc/</code> directory.
          or alternatively you can copy and paste directly from this book to the concerned file.
        </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm21018"></a>3. Configure the <code class="filename">/etc/webalizer.conf</code> file</h2></div></div></div><p>
      The <code class="filename">/etc/webalizer.conf</code> is the default configuration file for Webalizer. With it, you can specify which directories or pages in your web site to analyze, which <acronym class="acronym">URL</acronym>s to hide, and so on. By default, 
      the Webalizer program will install a sample configuration file named <code class="filename">webalizer.conf.sample</code> under the <code class="filename">/etc/</code> directory of Linux. You can use this file to configure your choices and 
      then rename it <code class="filename">webalizer.conf</code>, and the Webalizer program will be able to find and use it. A lot of options exist and it's important to read the documentation that comes with Webalizer for more information on all of 
      the different setting and parameters. Also, it's important to note that we comment in this Webalizer configuration file only the most common and used parameters.
    </p><p>
      Edit the <code class="filename">webalizer.conf.sample</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/webalizer.conf.sample</code> or create the <code class="filename">webalizer.conf</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/webalizer.conf</code> 
      and add/change in this file:
      </p><pre class="programlisting">
        LogFile /var/log/httpd/access_log
        OutputDir /home/httpd/usage
        Incremental  yes
        PageType  htm*
        PageType  cgi
        PageType  php
        HideURL  *.gif
        HideURL  *.GIF
        HideURL  *.jpg
        HideURL  *.JPG
        HideURL  *.ra
        IgnoreURL  /taskbar*
      </pre><p>
    </p><p>
      This tells the <code class="filename">webalizer.conf</code> file to set itself up for this particular configuration setup with:
    </p><div class="glosslist"><dl><dt><span class="glossterm"><code class="envar">LogFile</code>	<code class="filename">/var/log/httpd/access_log</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">LogFile</code> specifies the logfile to use with Webalizer. The default log file is supposed to be the <code class="filename">access_log</code> of Apache Web Server, but you can specifies a different one, 
        like the one Squid Proxy Server makes named <code class="filename">access.log</code> if you use it in httpd-accelerator mode. See, <a class="link" href="#pr6sserprnt" title="Chapter 28. Software -Server/Proxy Network">Software -Server/Proxy Network</a>, for more information.
        </p></dd><dt><span class="glossterm"><code class="envar">OutputDir</code>	  <code class="filename">/home/httpd/usage</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">OutputDir</code> specifies the location of the output directory to use for the reports of Webalizer. All present and future report files generated by the Webalizer program will be hosted in this directory. 
        It is recommended that you create this directory where your Apache web site resides. 
      </p></dd><dt><span class="glossterm"><code class="envar">Incremental   yes</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">Incremental</code> if set to <code class="envar">Yes</code> tells the program only to process partial logs file, and allows you to rotate your log files as much as you want without the loss of access information. It's 
        recommended to set this option to <code class="envar">Yes</code>.
      </p></dd><dt><span class="glossterm"><code class="envar">PageType   htm* cgi php</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">PageType</code> specifies what file extensions you want Webalizer to consider as a page to count. Each added file extensions must be specified on its own line as shown in the Webalizer configuration file above.
      </p></dd><dt><span class="glossterm"><code class="envar">HideURL   *.gif *.GIF *.jpg *.JPG *.ra</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">HideURL</code> specifies what kind of items such as graphic files, audio files or other <code class="literal">non-html</code> files to hide from the reports page. Each added item must be specified on its own line as 
        shown in the Webalizer configuration file above.
      </p></dd><dt><span class="glossterm"><code class="envar">IgnoreURL   /taskbar*</code></span></dt><dd class="glossdef"><p>
        The option <code class="envar">IgnoreURL</code> specifies <acronym class="acronym">URL</acronym>s to be completely ignored from the generated statistics reports. This option can be used to ignore directories that are not important in our statistics reports. It's 
        also useful when you want to manage and class which <acronym class="acronym">URL</acronym>s should be monitored and which should be ignored.
      </p></dd></dl></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
        <span class="inlinemediaobject"><img src="./images/Caution.gif" alt="Caution"></span>

      </h3><p>
        If you decide to use the existent <code class="filename">/etc/webalizer.conf.sample</code> file to configure your parameters for Webalizer, don't forget to rename it <code class="filename">webalizer.conf</code> or the program will be unable to 
        use it.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm21094"></a>4. Make Apache aware of Webalizer output directory</h2></div></div></div><p>
      Once Webalizer has been installed in the system we must add the following lines into the <code class="filename">httpd.conf</code> file of Apache to be able to locate and use it features.
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        Edit the <code class="filename">httpd.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/httpd/conf/httpd.conf</code> and add the following lines between the section tags &lt;IfModule mod_alias.c&gt; and &lt;/IfModule&gt;:
        </p><pre class="programlisting">
          Alias /usage/ "/home/httpd/usage/"
          &lt;Directory "/home/httpd/usage"&gt;
          Options None
          AllowOverride None
          Order deny,allow
          Deny from all
          Allow from 192.168.1.0/24
          &lt;/Directory&gt;
        </pre><p>
      </p></li><li class="step"><p>
        Don't forget to restart your Apache web server once you have added the above lines to its <code class="filename">httpd.conf</code> file:
        </p><pre class="screen">
          [root@deep ] /# /etc/rc.d/init.d/httpd <span class="command"><strong>restart</strong></span>
        </pre><p>
        </p><pre class="literallayout"><code class="computeroutput">
          Shutting down http:                                        	[  OK  ]
          Starting httpd:                                            	[  OK  ]
        </code></pre><p>
      </p></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm21112"></a>4.1. Running Webalizer manually first time</h3></div></div></div><p>
        Now it's time to run the program to generate reports, <code class="literal">html</code> and graphics in the default Webalizer directory so that we can see them in our web browser interface. This step is required just the first time you install 
        and use Webalizer, since it's preferable to use a cron job to automate this task in the future. To run Webalizer manually, to generate reports, use the following command:
      </p><pre class="screen">
        [root@deep ] /# /usr/bin/webalizer
      </pre><pre class="literallayout"><code class="computeroutput">
        Webalizer V1.30-04 (Linux 2.2.14) English
        Using logfile /var/log/httpd/access_log
        Creating output in /home/httpd/usage
        Hostname for reports is 'deep.openna.com'
        History file not found...
        Previous run data not found...
        Saving current run data... [03/06/2000 04:42:03]
        Generating report for March 2000
        Generating summary report
        Saving history information...
        81 records (2 ignored) in 0.31 seconds
      </code></pre><p>
        At this stage, we should verify that Webalizer is working on the system. To do that, point your web browser to the following address: <code class="literal">http://my-web-server/usage/</code>.
        The <code class="filename">my-web-server</code> is the address where your Apache web server lives, and <code class="filename">usage</code> is the directory that host all the Webalizer reports files.
      </p><div class="mediaobject" align="center"><img src="./images/Webalizer.gif" align="middle" alt="Webalizer"></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm21128"></a>5. Run Webalizer automatically with a cron job</h2></div></div></div><p>
      The last thing you can do now is automate the task of generating a new log file to update your Webalizer reports. Place an entry into root's crontabs to make Webalizer run as a cron job. To add Webalizer in your cron job you must edit the 
      crontab and add the following line as root to run it, for example, every 28 minutes for busy sites:
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>crontab</strong></span> -e
      </pre><p>
      </p><pre class="programlisting">
        # Run Webalizer to update Apache Log files every 28 minutes.
        28 * * * *      /usr/bin/webalizer
      </pre><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm21134"></a>5.1. Installed files</h3></div></div></div><p>
        These are the following files installed by Webalizer.
      </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/webalizer.conf.sample</code></td></tr><tr><td><code class="filename">/usr/bin/webalizer</code></td></tr><tr><td><code class="filename">/usr/man/man1/webalizer.1</code></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch30scfqmtc"></a>6. Linux FAQ-O-Matic</h2></div></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>As per the [<span class="citation">Faq-O-Matic</span>] web site:</b></p></div></div></div><p>
        A mailing list archive is good, because it lets thoughtful people with Frequently Asked Questions search for an immediate answer, and avoids bothering the people who have answers. Unfortunately, the answers in a mailing list 
        archive become stale over time, are disorganized, and are hard to sift from the conversational noise of the mailing list. 
      </p></div><p>
      A Frequently Asked Questions, list <acronym class="acronym">FAQ</acronym> is even better, because the people with questions can be a little lazier and still find their answer right away. Unfortunately, maintaining a <acronym class="acronym">FAQ</acronym> list requires 
      effort; if people with the answers become lazy, the <acronym class="acronym">FAQ</acronym> list becomes stale.
    </p><p>
      The Faq-O-Matic is a <acronym class="acronym">CGI</acronym>-based system that automates the process of maintaining a <acronym class="acronym">FAQ</acronym> or Frequently Asked Questions list. It allows visitors to your <acronym class="acronym">FAQ</acronym> to take part in 
      keeping it up-to-date. A permission system also makes it useful as a help-desk application, bug-tracking database, or documentation system.
    </p><p>
      These installation instructions assume
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Commands are Unix-compatible.
        </p></li><li class="listitem"><p>
        The source path is <code class="filename">/var/tmp</code>, <span class="emphasis"><em>other paths are possible</em></span>.
        </p></li><li class="listitem"><p>
        Installations were tested on Red Hat Linux 6.1 and 6.2.
        </p></li><li class="listitem"><p>
        All steps in the installation will happen in super-user account <code class="literal">root</code>.
        </p></li><li class="listitem"><p>
        FAQ-O-Matic version number is 2.709
        </p></li></ul></div><p>
    </p><p>
      These are the Package(s) required:
      </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
        FAQ-O-Matic Homepage: <a class="link" href="#prtinxfp34" title="Linux FAQ-O-Matic">http://www.dartmouth.edu/~jonh/ff-serve/cache/1.html</a>
      </td></tr><tr><td>
      The most recent version of the FAQ-O-Matic is always available at: <a class="link" href="#prtinxfp34" title="Linux FAQ-O-Matic">ftp://ftp.cs.dartmouth.edu/pub/jonh.</a>
      </td></tr><tr><td>
      You must be sure to download: FAQ-OMatic-2.709.tar.gz
      </td></tr></table><p>
    </p><p>
      There are some prerequisites which you need to keep in mind before can install FAQ-O-Matic,
      </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
          Apache web server should be already installed on your system in order to be able to use FAQ-O-Matic software.
        </p></li><li class="listitem"><p>
        Revision Control System, <acronym class="acronym">RCS</acronym> file version management tools should also already be installed on your system to be able to use FAQ-O-Matic software.
        </p></li></ol></div><p>
    </p><p>
      To verify that the <acronym class="acronym">RCS</acronym> package is installed on your system, use the following command:
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>rpm</strong></span> -qi rcs
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        package rcs is not installed
      </code></pre><p>
    </p><p>
      To install the <span class="command"><strong>RCS</strong></span> package on your Linux system, use the following command:
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>mount</strong></span> /dev/cdrom /mnt/cdrom/
        [root@deep ] /# <span class="command"><strong>cd</strong></span> /mnt/cdrom/RedHat/RPMS/
        [root@deep ]/RPMS# <span class="command"><strong>rpm</strong></span> -Uvh rcs-version.i386.rpm
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        rcs                         ##################################################
      </code></pre><p>
      </p><pre class="screen">
        [root@deep ]/RPMS# <span class="command"><strong>cd</strong></span> /; umount /mnt/cdrom/
      </pre><p>
      For more information on the required software, see the related chapters in this book.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm21203"></a>7. Compile and install FAQ-O-Matic</h2></div></div></div><p>
      Before you Compile, Decompress the tarball (tar.gz).
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>cp</strong></span> FAQ-O-Matic-version.tar.gz /var/tmp/
        [root@deep ] /# <span class="command"><strong>cd</strong></span> /var/tmp/
        [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf FAQ-O-Matic-version.tar.gz
      </pre><p>
    </p><p>
      You need to compile, to install the Faq-O-Matic program on your computer, move into the new FAQ-O-Matic directory and type the following commands on your terminal:
 
        </p><pre class="screen">
          [root@deep ] /FAQ-OMatic-2.709# <span class="command"><strong>perl</strong></span> Makefile.PL
          [root@deep ] /FAQ-OMatic-2.709# <span class="command"><strong>make</strong></span>
          [root@deep ] /FAQ-OMatic-2.709# <span class="command"><strong>make install</strong></span>
          [root@deep ] /FAQ-OMatic-2.709# <span class="command"><strong>mv</strong></span> fom /home/httpd/cgi-bin/           <a name="cgbnap"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
          [root@deep ] /FAQ-OMatic-2.709# <span class="command"><strong>mkdir</strong></span> -p /home/httpd/cgi-bin/fom-meta
          [root@deep ] /FAQ-OMatic-2.709# <span class="command"><strong>mkdir</strong></span> -p /home/httpd/faqomatic
          [root@deep ] /FAQ-OMatic-2.709# <span class="command"><strong>chown</strong></span> root.www /home/httpd/cgi-bin/fom
          [root@deep ] /FAQ-OMatic-2.709# <span class="command"><strong>chown</strong></span> -R www.www /home/httpd/cgi-bin/fom-meta/
          [root@deep ] /FAQ-OMatic-2.709# <span class="command"><strong>chown</strong></span> -R www.www /home/httpd/faqomatic/
        </pre><p>
        </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#cgbnap"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
          Or wherever your CGIs live.
        </p></td></tr></table></div><p>
 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <span class="command"><strong>make</strong></span> command will compile all source files into executable binaries
        </p></li><li class="listitem"><p>
        The <span class="command"><strong>make install</strong></span> will install the Perl programs and any supporting files into the appropriate locations
        </p></li><li class="listitem"><p>
        The <span class="command"><strong>mv</strong></span> command will move the main <code class="literal">fom</code> <acronym class="acronym">CGI</acronym> program of Faq-O-Matic to the <code class="filename">cgi-bin</code> directory of your Apache web server. 
        </p></li><li class="listitem"><p>
        The <span class="command"><strong>mkdir</strong></span> will create new directories named <code class="filename">fom-meta</code> and <code class="filename">faqomatic</code> under the <code class="filename">/home/httpd/</code> 
        directory where we'll handle all related FAQ-O-Matic files. 
        </p></li><li class="listitem"><p>
        Finally, the <span class="command"><strong>chown</strong></span> command will set the owner of the <code class="literal">fom</code> <acronym class="acronym">CGI</acronym> program to be the super-user <code class="literal">root</code> and the group to be the user Apache run as <code class="literal">www</code> 
        and will set the directories <code class="filename">fom-meta</code> and <code class="filename">faqomatic</code> to be owned by <code class="literal">www</code> and group by <code class="literal">www</code>.
        </p></li></ul></div><p>
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
        <span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span>

      </h3><p>
        You'll receive a temporary password via mail during the compilation of the software. This password will be necessary to complete later the installation of Faq-O-Matic through the web interface.
  
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm21263"></a>8. Make Apache aware Faq-O-Matic file's location</h2></div></div></div><p>
        Once Faq-O-Matic has been installed in the system, we must add the following lines to the <code class="filename">httpd.conf</code> file of Apache to be able to locate and use it's features.
      </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
          Edit the <code class="filename">httpd.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/httpd/conf/httpd.conf</code> and add the following lines between the section tags &lt;IfModule mod_alias.c&gt; and &lt;/IfModule&gt;:
          </p><pre class="programlisting">
            Alias /faqomatic/ "/home/httpd/faqomatic/"
            &lt;Directory "/home/httpd/faqomatic"&gt;
            Options None
            AllowOverride None
            Order allow,deny
            Allow from all
            &lt;/Directory&gt;

            Alias /bags/ "/home/httpd/faqomatic/bags/"
            &lt;Directory "/home/httpd/faqomatic/bags"&gt;
            Options None
            AllowOverride None
            Order allow,deny
            Allow from all
            &lt;/Directory&gt;

            Alias /cache/ "/home/httpd/faqomatic/cache/"
            &lt;Directory "/home/httpd/faqomatic/cache"&gt;
            Options None
            AllowOverride None
            Order allow,deny
            Allow from all
            &lt;/Directory&gt;

            Alias /item/ "/home/httpd/faqomatic/item/"
            &lt;Directory "/home/httpd/faqomatic/item"&gt;
            Options None
            AllowOverride None
            Order allow,deny
            Allow from all
            &lt;/Directory&gt;
          </pre><p>
        </p></li><li class="step"><p>
          Don't forget to restart your Apache web server once you have added the above lines to its <code class="filename">httpd.conf</code> file:
          </p><pre class="screen">
            [root@deep ] /# /etc/rc.d/init.d/httpd <span class="command"><strong>restart</strong></span>
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
            Shutting down http:                                        	[  OK  ]
            Starting httpd:                                            	[  OK  ]
          </code></pre><p>
        </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm21281"></a>9. Configure your FAQ-O-Matic</h2></div></div></div><p>
      The rest of this installation will be made through the use of your web browser. With Netscape Communicator, follow the simple steps below:
       </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
          The first step is to load your web browser and use it to configure Faq-O-Matic.
          </p><ol type="a" class="substeps"><li class="step"><p>
              Point your Netscape browser to the following <code class="literal">location:http://my-web-server/cgi-bin/fom</code>
            </p></li><li class="step"><p>
            Enter your temporary password
            </p></li><li class="step"><p>
            Create the <code class="filename">/home/httpd/cgi-bin/fom-meta/</code> directory first
            </p></li><li class="step"><p>
              Configure the <code class="envar">Define configuration parameters</code> in the configuration main menu
            </p></li></ol></li><li class="step"><p>
          </p><div class="example"><a name="idm21301"></a><p class="title"><b>Example 30.1. Using Netscape browser</b></p><div class="example-contents"><p>
              Fill under the sections marked Mandatory the following information:
              </p><pre class="programlisting">
                <code class="prompt">$</code>adminAuth= admin@openna.com
                <code class="prompt">$</code>serverBase= http://www.openna.com
                <code class="prompt">$</code>cgiURL= /cgi-bin/fom
                <code class="prompt">$</code>serveDir= /home/httpd/faqomatic/
                <code class="prompt">$</code>serveURL= /faqomatic/
              </pre><p>
            </p></div></div><p><br class="example-break">
            <span class="inlinemediaobject"><img src="./images/FAQ-O-Matic-Conf.gif" align="middle" alt="FAQ-O-Matic-Configuration"></span>

            Configure the rest of the <code class="envar">Define configuration parameters</code> as you need. Once you have finished setting your parameters, click on the <span class="command"><strong><span class="guibutton">Define</span></strong></span> button to validate your choices.
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
                <span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>

              </h3><p>
                The <code class="filename">my-web-server</code> is the address where your Apache web server resides, and the temporary password is the one you should have received by mail during the install stage of this software.

              </p></div><p>
        </p></li><li class="step"><p>
          Once you have finished configuring the <code class="envar">Define configuration parameters</code>, you must perform the rest of the FAQ-O-Matic configuration in order to be able to use it as described in the configuration 
          main menu of the FAQ-O-Matic software.
          <span class="inlinemediaobject"><img src="./images/FAQ-O-Matic.gif" align="middle" alt="Test FAQ-O-Matic"></span>

        </p></li><li class="step"><p>
          Please do cleanup later:
          </p><pre class="screen">
            [root@deep ] /# <span class="command"><strong>cd</strong></span> /var/tmp
            [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf FAQ-OMatic-version/ FAQ-O-Matic-version.tar.gz
          </pre><p>
        </p></li></ol></div><p>
        The <span class="command"><strong>rm</strong></span> command will remove all the source files we have used to compile and install FAQ-O-Matic. It will also remove the FAQ-O-Matic compressed archive from the <code class="filename">/var/tmp</code> directory.
      </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm21343"></a>10. Installed files</h2></div></div></div><p>
        These are the files installed by FAQ-O-Matic software on your system:
      </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/usr/lib/perl5/man/man3/FAQ::OMatic::API.3</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/FAQ</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/FAQ/OMatic</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/i386-linux/auto/FAQ/OMatic/.packlist</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/Bags.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/authenticate.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/ImageRef.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/Groups.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/submitGroup.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/recent.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/submitItem.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/maintenance.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/Language_de_iso8859_1.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/Slow.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/help.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/selectBag.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/submitPart.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/delPart.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/buildSearchDB.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/mirrorServer.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/editItem.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/search.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/SearchMod.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/addItem.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/Versions.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/displaySlow.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/Language_fr.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/img.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/editPart.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/AuthLocal.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/ColorPicker.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/ImageData.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/changePass.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/submitBag.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/submitModOptions.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/I18N.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/Log.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/appearanceForm.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/moveItem.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/editGroups.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/HelpMod.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/searchForm.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/submitPass.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/submitMove.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/Set.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/statgraph.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/stats.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/Item.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/Words.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/Appearance.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/dispatch.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/editBag.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/submitCatToAns.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/submitAnsToCat.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/editModOptions.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/Auth.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/install.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/Part.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/faq.pm</code></td><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic/API.pm</code></td></tr><tr><td><code class="filename">/usr/lib/perl5/site_perl/5.005/FAQ/OMatic.pm</code></td><td> </td></tr></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch30swmlimp"></a>11. Linux Webmail IMP</h2></div></div></div><p>
        Webmail IMP allows universal, web-based access to <acronym class="acronym">IMAP/POP3</acronym> servers and provides an address book, <acronym class="acronym">LDAP</acronym> directory searches, full support for sending and receiving attachments, and 
        many other features normally only found in desktop mail clients. If you have installed Apache with <acronym class="acronym">SSL</acronym> support, clients can access and read mail through a secure manner by way of <acronym class="acronym">SSL</acronym> 
        encryption. By default in this section, we have configured Webmail <acronym class="acronym">IMP</acronym> to use PostgreSQL database and <acronym class="acronym">IMAP</acronym> connections. There is, though, much support for other databases within Webmail IMP. If you prefer, you can use MySQL, Oracle, Sybase, or other well know SQL databases. You may also choose to use POP3 instead of IMAP connection to your clients.
      </p><p>
        These installation instructions assume
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Commands are Unix-compatible.
          </p></li><li class="listitem"><p>
          The source path is <code class="filename">/home/httpd</code>.
          </p></li><li class="listitem"><p>
          Installations were tested on Red Hat Linux 6.1 and 6.2.
          </p></li><li class="listitem"><p>
          All steps in the installation will happen in super-user account <code class="literal">root</code>.
          </p></li><li class="listitem"><p>
          Horde version number is 1.2.0
          </p></li><li class="listitem"><p>
          Webmail <acronym class="acronym">IMP</acronym> version number is 2.2.0
          </p></li><li class="listitem"><p>
          PHPLib version number is 7.2b
          </p></li></ul></div><p>
      </p><p>
        These are the Package(s):
        </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
            Webmail <acronym class="acronym">IMP</acronym> Homepage:<a class="link" href="#prtinxfp35" title="Linux Webmail IMP">http://www.horde.org/imp/</a> 
          </td></tr><tr><td>
            You must be sure to download: horde-1.2.0-pre11.tar.gz
          </td></tr><tr><td>
          You must be sure to download: imp-2.2.0-pre11.tar.gz
          </td></tr><tr><td>
          PHPLib Homepage:<a class="link" href="#prtinxfp35" title="Linux Webmail IMP">http://phplib.netuse.de/index.php3</a> 
          </td></tr><tr><td>
          You must be sure to download: phplib-7.2b.tar.gz
          </td></tr></table><p>
      </p><p>
        there are some prerequisites youi need to take care of:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          Apache web server should be already installed on your system to be able to use the Webmail IMP software.
        </p></li><li class="listitem"><p>
        The PHP4 server-side scripting language support should be already installed on your system to be able to use the Webmail IMP software.
        </p></li><li class="listitem"><p>
        Postgresql, or another database server, should be already installed on your system if you intend to use the Webmail IMP software with SQL support.
        </p></li><li class="listitem"><p>
        The OpenLDAP directory server should be already installed on your system if you  intend to use the Webmail IMP software with LDAP support.
        </p></li><li class="listitem"><p>
        The IMAP/POP server should be already installed on your system to be able to use the Webmail IMP software.
        </p></li><li class="listitem"><p>
        The PHPLIB files, 7.2 or greater, should be already installed on your system to be able to use the Webmail IMP software.
        </p></li></ol></div><p>
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
          <span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span>

        </h3><p>
          For more information on the required software, see the related chapter in this book.
        </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch30sphplb"></a>12. Set up PHPLib </h2></div></div></div><p>
      To be able to run Webmail IMP on your Linux server; PHPLib, a toolkit development of Web applications for PHP developers software must be installed. To install PHPLib, follow the simple steps below:
    </p><p>
      These are the package(s)
      </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
        PHPLib Homepage: <a class="link" href="#prtinxfp36" title="phplib">http://phplib.netuse.de/index.php3</a>, <a class="link" href="#prtinxfp36" title="phplib">http://phplib.netuse.de/index.php3</a>
      </td></tr><tr><td>
      You must be sure to download: phplib-7.2b.tar.gz
      </td></tr></table><p>
    </p><p>
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>cp</strong></span> phplib-7.2b.tar.gz /home/httpd/
        [root@deep ] /# <span class="command"><strong>cd</strong></span> /home/httpd/
        [root@deep ] /httpd# <span class="command"><strong>tar</strong></span> xzpf phplib-7.2b.tar.gz
      </pre><p>
    </p><p>
      Move to your web server's DocumentRoot, and create a <code class="filename">/home/httpd/php</code> directory by executing the following commands:
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>cd</strong></span> /home/httpd/
        [root@deep ] /httpd# <span class="command"><strong>mkdir</strong></span> php
      </pre><p>
    </p><p>
      Copy the contents of the PHPLib distributions <code class="filename">php</code> directory into the <code class="filename">php</code> directory that you created in your DocumentRoot:
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>cd</strong></span> /home/httpd/phplib-7.2b/php/
        [root@deep ] /php# <span class="command"><strong>cp</strong></span> * /home/httpd/php/
        [root@deep ] /php# <span class="command"><strong>cd</strong></span> /home/httpd/
        [root@deep ] /httpd# <span class="command"><strong>rm</strong></span> -f phplib-7.2b.tar.gz
        [root@deep ] /httpd# <span class="command"><strong>rm</strong></span> -rf phplib-7.2b/
      </pre><p>
    </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
        <span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>

      </h3><p>
        We remove the tar archive and <code class="filename">phplib-version</code> directory of PHPLib once we are finished  copying its <code class="filename">php</code> directory into the new <code class="filename">php</code> 
        directory we created in our DocumentRoot.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm21572"></a>13. Compile to install Webmail IMP</h2></div></div></div><p>
        To install the Webmail IMP program on your server, please follow the simple steps below.
      </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
          Copy <code class="literal">horde-1.2.0-pre11.tar.gz</code> to your web servers DocumentRoot, <code class="filename">/home/httpd/</code>, untar it and move the directory from <code class="filename">horde-version</code> 
          to <code class="filename">horde</code> by executing the following commands:
          </p><pre class="screen">
            [root@deep ] /# <span class="command"><strong>cp</strong></span> horde-version.tar.gz /home/httpd/
            [root@deep ] /# <span class="command"><strong>cd</strong></span> /home/httpd/
            [root@deep ] /httpd# <span class="command"><strong>tar</strong></span> xzpf horde-version.tar.gz
            [root@deep ] /httpd# <span class="command"><strong>mv</strong></span> horde-version horde
            [root@deep ] /httpd# <span class="command"><strong>rm</strong></span> -f  horde-version.tar.gz
          </pre><p> 
          We remove the tar archive of Horde once we have finished moving the <code class="filename">horde-version</code> directory of Horde to its new name <code class="filename">horde</code>.
        </p></li><li class="step"><p>
          Copy <code class="literal">imp-2.2.0-pre11.tar.gz</code> to your new <code class="filename">horde</code> directory, <code class="filename">/home/httpd/horde/</code>, untar it and move the directory from <code class="filename">imp-version</code> 
          to <code class="filename">imp</code> by executing the following commands:
          </p><pre class="screen">
            [root@deep ] /# <span class="command"><strong>cp</strong></span> imp-version.tar.gz /home/httpd/horde/
            [root@deep ] /# <span class="command"><strong>cd</strong></span> /home/httpd/horde/
            [root@deep ] /horde# <span class="command"><strong>tar</strong></span> xzpf imp-version.tar.gz
            [root@deep ] /horde# <span class="command"><strong>mv</strong></span> imp-version imp
            [root@deep ] /horde# <span class="command"><strong>rm</strong></span> -f  imp-version.tar.gz
          </pre><p>
          </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
              <span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>

            </h3><p>
              It's important that the directory <code class="filename">imp</code> reside inside <code class="filename">horde</code> directory, or Webmail will not work. We remove the tar archive of IMP once we have 
              finished moving the <code class="filename">imp-version</code> directory of IMP to its new name <code class="filename">imp</code>.
            </p></div><p>
        </p></li><li class="step"><p>
          Change the <code class="filename">horde</code> directory and all its subdirectories and files to be owned by the super-user <code class="literal">root</code> for security reasons.
          </p><pre class="screen">
            [root@deep ] /# <span class="command"><strong>chown</strong></span> -R 0.0 /home/httpd/horde/
          </pre><p>
        </p></li><li class="step"><p>

          Copy the <code class="filename">/home/httpd/horde/phplib/*.ihtml</code> files to your new <code class="filename">php</code> directory, <code class="filename">/home/httpd/php/</code> by executing the following commands:
          </p><pre class="screen">
            [root@deep ] /# <span class="command"><strong>cp</strong></span> /home/httpd/horde/phplib/*.ihtml /home/httpd/php/
          </pre><p>
        </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm21628"></a>14. Configure and create Webmail IMP SQL database</h2></div></div></div><p>
        We must now configure our database to be able to use Webmail <acronym class="acronym">IMP</acronym> with the <acronym class="acronym">SQL</acronym> database. The easier method is to use the predefined scripts located under the <code class="filename">/home/httpd/horde/imp/config/scripts/</code>
        subdirectory. For PostgreSQL support, follow the simple steps below.
      </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
          First of all, we must edit the script file <code class="filename">pgsql_create.sql</code> related to PostgreSQL located under the <code class="filename">/home/httpd/horde/imp/config/scripts</code> subdirectory, and change its default 
          value for the username to run as from <code class="literal">httpd</code> to <code class="literal">www</code>.
          </p><pre class="programlisting">
            GRANT SELECT, INSERT, UPDATE ON imp_pref, imp_addr TO nobody;
          </pre><p>
          To read:
          </p><pre class="programlisting">
            GRANT SELECT, INSERT, UPDATE ON imp_pref, imp_addr TO www;
          </pre><p>
        </p></li><li class="step"><p>
          Now, we must define the username for Apache named <code class="literal">www</code> in our PostgreSQL database, to be able to create the Webmail IMP database with this username.
          To define the httpd username named <code class="literal">www</code> in your database, run the createuser utility program of PostgreSQL:
          </p><pre class="screen">
            [root@deep ] /# <span class="command"><strong>su</strong></span> postgres
            [postgres@deep /]$ <span class="command"><strong>createuser</strong></span>
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
            Enter name of user to add ---&gt; www
            Enter user's postgres ID or RETURN to use unix user ID: 80 -[Press Enter]
            Is user "www" allowed to create databases (y/n) y
            Is user "www" a superuser? (y/n) n
            createuser: www was successfully added
          </code></pre><p>
        </p></li><li class="step"><p>
          Once the httpd user <code class="literal">www</code> has been included in PostgreSQL, log in as the user your PostgreSQL database runs as, in our case <code class="literal">postgres</code> and insert the small script related to PostgreSQL to 
          automatically create the Webmail IMP database in PostgreSQL.
          To automatically create Webmail IMP database in PostgreSQL, use the following commands:
          </p><pre class="screen">
            [root@deep ] /# <span class="command"><strong>cd</strong></span> /home/httpd/horde/imp/config/scripts/
            [root@deep scripts]# <span class="command"><strong>su</strong></span> postgres
            [postgres@deep ] /scripts$ <span class="command"><strong>psql</strong></span> template1 &lt; pgsql_create.sql
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
            // IMP database creation script for postgreSQL
            // Author: barce@lines.edu
            // Date:   Aug-29-1998
            // Notes: replace "nobody" with yours httpd username
            // Run using:  psql template1 &lt; pgsql_create.sql

            CREATE DATABASE horde;
            CREATEDB

            \connect horde
            connecting to new database: horde

            CREATE TABLE imp_pref (
            username        	text,
            sig             		text,
            fullname        	text,
            replyto         		text,
            lang            		varchar(30)
            );
            CREATE

            CREATE TABLE imp_addr (
            username        	text,
            address         	text,
            nickname        	text,
            fullname        	text
            );
            CREATE


            GRANT SELECT, INSERT, UPDATE ON imp_pref, imp_addr TO www;
            CHANGE
            EOF
          </code></pre><p>
        </p></li><li class="step"><p>
          We must restart the PostgreSQL server for the changes to take effect:
          </p><pre class="screen">
            [root@deep ] /# /etc/rc.d/init.d/postgresql <span class="command"><strong>restart</strong></span>
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
            Stopping postgresql service:                               [  OK  ]
            Checking postgresql installation: looks good!
            Starting postgresql service: postmaster [13474]
          </code></pre><p>
        </p></li><li class="step"><p>

          Copy and rename the file <code class="filename">/home/httpd/horde/phplib/horde_phplib.inc</code> to <code class="filename">/home/httpd/php/local.inc</code>, then edit the new <code class="filename">local.inc</code> file which is your phplib 
          configuration file containing settings that will define the behavior of phplib, and follow its instruction to define the storage container you'll want to uncomment.
          </p><ol type="a" class="substeps"><li class="step"><p>
              </p><pre class="screen">
                [root@deep ] /# <span class="command"><strong>cp</strong></span> /home/httpd/horde/phplib/horde_phplib.inc /home/httpd/php/local.inc
              </pre><p>
              </p><pre class="literallayout"><code class="computeroutput">
                cp: overwrite `/home/httpd/php/local.inc'? y
                </code></pre><p>
            </p></li><li class="step"><p>
              Edit the <code class="filename">local.inc</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/home/httpd/php/local.inc</code>, then uncomment and set the following lines to define <acronym class="acronym">SQL</acronym> as your default database:
              </p><pre class="programlisting">
                /* To use an SQL database, uncomment and edit the following: */
                class HordeDB extends DB_Sql {
                var $Host = 'localhost';
                var $Database = 'horde';
                var $User = 'www';
                var $Password = 'some-password';
                var $Port = '5432';

                function halt($msg) {
                printf("&lt;b&gt;Database error (HordeDB):&lt;/b&gt; %s&lt;br&gt;\n", $msg);
                }
                }

                class HordeCT extends CT_Sql {
                var $database_class = 'HordeDB';         // Which database class to use...
                var $database_table = 'active_sessions'; // and find our data in this table.
                }
              </pre><p>
              Don't forget to uncomment in this file the type of storage container you want to use for Webmail <acronym class="acronym">IMP</acronym>. Remember to uncomment only one type. In our case we chose to use <acronym class="acronym">SQL</acronym>. Also the 
              parameters you must set for <acronym class="acronym">SQL</acronym> database are the <code class="envar">var $User =</code>, <code class="envar">var $Password =</code>, and <code class="envar">var $Port =</code>. The <code class="envar">var $User =</code> corresponds to your httpd 
              username, in our case <code class="literal">www</code>, <code class="envar">var $Password =</code> corresponds to the password for the user <code class="literal">www</code> you have defined in PostgreSQL, and <code class="envar">var $Port =</code> is the <acronym class="acronym">IP</acronym> 
              port number used to connect to your <acronym class="acronym">SQL</acronym> database.

            </p></li></ol></li><li class="step"><p>
          Finally edit the <code class="filename">/home/httpd/php/prepend.php3</code> file and specifies your default database type.
          Edit the <code class="filename">prepend.php3</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/home/httpd/php/prepend.php3</code> then change the following line to define PostgreSQL as your database type:
          </p><pre class="programlisting">
            require($_PHPLIB["libdir"] . "db_mysql.inc");
          </pre><p>
          To read:
          </p><pre class="programlisting">
            require($_PHPLIB["libdir"] . "db_pgsql.inc");
          </pre><p>
        </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm21708"></a>15. Configure your <code class="filename">php.ini</code> from PHP4</h2></div></div></div><p>
        Another setting you need to configure is in your PHP4 configuration file <code class="filename">/etc/httpd/php.ini</code>. This modification is required in order to define which features, such as <acronym class="acronym">IMAP</acronym>, PostgreSQL and others, 
        are to be loaded automatically by PHP4. Since we decided to use PostgreSQL as our database, and need to use <acronym class="acronym">IMAP</acronym> features in our Webmail software, we must define them in the <code class="filename">php.ini</code> configuration 
        file of PHP4.
      </p><p>
        Edit the <code class="filename">php.ini</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/httpd/php.ini</code>, and add under the Dynamic Extensions section your desired choices. In our case, as you can see, we chose <acronym class="acronym">IMAP</acronym> 
        and PostgreSQL support:
        </p><pre class="programlisting">
          extension=imap.so		; Added for IMAP support
          extension=pgsql.so		; Added for PostgreSql support
          extension=mysql.so		; Added for MySql support
          extension=ldap.so		; Added for LDAP support
        </pre><p>
      </p><p>
        You must tell where to look when including files that don't have absolute paths as well, to automatically prepend the contents of phplib's <code class="filename">prepend.php3</code> to each file, and turns off magic quotes.
        Edit the <code class="filename">php.ini</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/httpd/php.ini</code> and add the following parameters to the related lines:
        </p><pre class="programlisting">
          magic_quotes_gpc        	=   Off
          auto_prepend_file       	=   "/home/httpd/php/prepend.php3"
          include_path 			=   "/home/httpd/horde:/home/httpd/php"
        </pre><p>
      </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm21728"></a>15.1. Configure Apache to recognize Webmail IMP</h3></div></div></div><p>
          Once Webmail <acronym class="acronym">IMP</acronym> has been installed in the system, we must add the following lines in the <code class="filename">httpd.conf</code> file of Apache to be able to locate and use its features.
        </p><p>
          Edit the <code class="filename">httpd.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/httpd/conf/httpd.conf</code> and add the following lines between the section tags &lt;IfModule mod_alias.c&gt; and &lt;/IfModule&gt;:
          </p><pre class="programlisting">
            Alias /horde/ "/home/httpd/horde/"
            &lt;Directory "/home/httpd/horde"&gt;
            Options None
            AllowOverride None
            Order allow,deny
            Allow from all
            &lt;/Directory&gt;

            Alias /imp/ "/home/httpd/horde/imp/"
            &lt;Directory "/home/httpd/horde/imp"&gt;
            Options None
            AllowOverride None
            Order allow,deny
            Allow from all
            &lt;/Directory&gt;
          </pre><p>
        </p><p>
          You must restart the Apache web server for the changes to take effect, use the following commands:
          </p><pre class="screen">
            [root@deep ] /# /etc/rc.d/init.d/httpd <span class="command"><strong>restart</strong></span>
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
            Shutting down http:                                        	[  OK  ]
            Starting httpd:                                            	[  OK  ]
          </code></pre><p>
        </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm21743"></a>16. Configure Webmail <acronym class="acronym">IMP</acronym> via your web browser</h2></div></div></div><p>
        Several ways exist to configure Webmail <acronym class="acronym">IMP</acronym>, and the one we've chosen is the new setup engine named <code class="filename">setup.php3</code>, which gives people the ability to configure <acronym class="acronym">IMP</acronym> via 
        a web browser.
      </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        For security reasons, it is disabled by default, but you can enable it with the following commands:
        To enable <code class="filename">setup.php</code>, use the following command:
        </p><pre class="screen">
          [root@deep ] /# <span class="command"><strong>cd</strong></span> /home/httpd/horde/
          [root@deep ] /horde# sh ./install.sh
        </pre><p>
        </p><pre class="literallayout"><code class="computeroutput">
          Your blank configuration files have been created, please go to
          the configuration utitlity at :

          your install path url/setup.php3
        </code></pre><p>
        </p></li><li class="step"><p>
          Once the new setup engine of Webmail IMP has been enabled, point your browser to the following URL: <code class="literal">http://my-web-server/horde/setup.php</code>. At this point, you can walk through the graphical setup program 
          and configure all aspects of <acronym class="acronym">IMP</acronym>.

          <code class="filename">my-web-server</code> is the address where your Apache web server lives, and the <code class="filename">/horde/</code> directory is where the <code class="filename">setup.php</code> file resides.

        </p></li><li class="step"><p>
          When you are done with the new setup engine of Webmail IMP, be sure to disable it again for security reasons.
          To disable <code class="filename">setup.php</code>, use the following command:
          </p><pre class="screen">
            [root@deep ] /# <span class="command"><strong>cd</strong></span> /home/httpd/horde/
            [root@deep ] /horde# sh ./secure.sh
          </pre><p>
          </p><pre class="literallayout"><code class="computeroutput">
            I have made your configuration files, and libraries mode 0555
            which is read / execute for everyone.

            And the setup.php is mode 0000 which is no access period.
          </code></pre><p>
        </p></li></ol></div><p>
          At this stage, we must verify that Webmail <acronym class="acronym">IMP</acronym> is working on your system. To do this, point your web browser to the following address: <code class="literal">http://my-web-server/horde/</code>.
          <code class="filename">my-web-server</code> is the address where your Apache web server lives, and <code class="filename">/horde</code> is the directory that host Webmail <code class="literal">IMP</code> program.

        </p><div class="mediaobject" align="center"><img src="./images/Webmail-IMP.gif" align="middle" alt="Webmail through browser"></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="idm21783"></a>Chapter 31. Software -Server/File Sharing-Network</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#pr6ch31slss">1. Linux Samba Server</a></span></dt><dt><span class="section"><a href="#idm21840">2. Configure Samba</a></span></dt><dt><span class="section"><a href="#idm21889">3. Compile and optimize</a></span></dt><dt><span class="section"><a href="#idm21961">4. Configurations</a></span></dt><dt><span class="section"><a href="#idm22007">5. Configuration of the <code class="filename">/etc/smb.conf</code> file</a></span></dt><dt><span class="section"><a href="#idm22266">6. Configure the <code class="filename">/etc/lmhosts</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm22283">6.1. Configure the <code class="filename">/etc/pam.d/samba</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm22302">7. Encrypted Samba password file for clients</a></span></dt><dt><span class="section"><a href="#idm22359">8. Optimizing Samba</a></span></dt><dd><dl><dt><span class="section"><a href="#idm22366">8.1. Tuning the buffer cache</a></span></dt></dl></dd><dt><span class="section"><a href="#idm22401">9. Tuning the buffermem</a></span></dt><dt><span class="section"><a href="#idm22430">10. Further documentation</a></span></dt><dt><span class="section"><a href="#idm22539">11. Samba Administrative Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#idm22548">11.1. Samba Users Tools</a></span></dt></dl></dd><dt><span class="section"><a href="#idm22563">12. The <code class="filename">/etc/rc.d/init.d/smb</code> script file</a></span></dt><dd><dl><dt><span class="section"><a href="#pr6ch31ssmb">12.1. Securing Samba</a></span></dt></dl></dd><dt><span class="section"><a href="#idm22595">13. Installed files</a></span></dt></dl></div><div class="highlights"><p>
    Enterprise-level organizations often use different operating systems for handling many kind of jobs and have the need to keep them in a networked environment for files sharing and printers. Employees may work on workstations like Linux, Microsoft Windows 95/98/NT, 
    OS/2 or Novel and still need to access the server in their daily work. A Linux server with Samba support can be used for these activities.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch31slss"></a>1. Linux Samba Server</h2></div></div></div><p>
      Samba is a strong network service for file and print sharing that works on the majority of operating systems available today. When well implemented by the administrator, it's faster and more secure than the native file sharing services available on Microsoft Windows machines.
    </p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>As per the [<span class="citation">README file of Samba</span>]:</b></p></div></div></div><p>
        Samba is the protocol by which a lot of PC-related machines share files and printers, and other information, such as lists of available files and printers. Operating systems that support this natively include Windows 95/98/NT, OS/2, 
        and Linux, and add on packages that achieve the similar thing are available for DOS, Windows, VMS, Unix of all kinds, MVS, and more.
      </p><p>
        Apple Macs and some Web Browsers can speak this protocol as well.  Alternatives to <acronym class="acronym">SMB</acronym> include Netware, <acronym class="acronym">NFS</acronym>, AppleTalk, Banyan Vines, Decnet etc. Many of these have advantages but none are public 
        specifications and widely implemented in desktop machines by default. Samba software includes an <acronym class="acronym">SMB</acronym> server, to provide Windows NT and LAN Manager-style file and print services to <acronym class="acronym">SMB</acronym> clients 
        such as Windows 95, Warp Server, smbfs and others, a NetBIOS, <em class="wordasword">rfc1001/1002</em> name server, which amongst other things gives browsing support, an ftp-like <acronym class="acronym">SMB</acronym> client so that you can access 
        PC resources; disks and printers from Unix, Netware and other operating systems, and finally, a tar extension to the client for backing up PCs.
      </p></div><div class="mediaobject" align="center"><img src="./images/Samba-Schema.gif" align="middle" alt="Samba"></div><p>
      These installation instructions assume
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Commands are Unix-compatible.
      </p></li><li class="listitem"><p>
      The source path is <code class="filename">/var/tmp</code>, <span class="emphasis"><em>other paths are possible</em></span>.
      </p></li><li class="listitem"><p>
      Installations were tested on Red Hat Linux 6.1 and 6.2.
      </p></li><li class="listitem"><p>
      All steps in the installation will happen in super-user account <code class="literal">root</code>.
      </p></li><li class="listitem"><p>
      Samba version number is 2.0.7
      </p></li></ul></div><p>
    </p><p>
      These are the Package(s) required:
      </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
          Samba Homepage: <a class="link" href="#prtinxfp31er" title="Linux Samba Server">http://us1.samba.org/samba/samba.html</a>
        </td></tr><tr><td>
        Samba FTP Site: <a class="link" href="#prtinxfp31er" title="Linux Samba Server">63.238.153.11</a>
        </td></tr><tr><td>
        You must be sure to download: samba-2.0.7.tar.gz
        </td></tr></table><p>
    </p><p>
      Before you decompress the tarballs, It is a good idea to make a list of files on the system before you install Samba, and one afterwards, and then compare them using diff to find out what file it placed where. Simply run 
      <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Samba1</code></strong> before and <span class="command"><strong>find</strong></span> <strong class="userinput"><code>/* &gt; Samba2</code></strong> after you install the software, and use <span class="command"><strong>diff</strong></span> <strong class="userinput"><code>Samba1 Samba2 &gt; Samba-Installed</code></strong> 
      to get a list of what changed.
    </p><p>
      To compile, decompress the tarball (tar.gz):
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>cp</strong></span> samba-version.tar.gz /var/tmp
        [root@deep ] /# <span class="command"><strong>cd</strong></span> /var/tmp
        [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf samba-version.tar.gz
      </pre><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm21840"></a>2. Configure Samba</h2></div></div></div><p>
      Move into the new Samba directory, and move into its <code class="filename">source</code> subdirectory.
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        Edit the <code class="filename">smbsh.in</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">smbwrapper/smbsh.in</code> and change the line:
        </p><pre class="programlisting">
          SMBW_LIBDIR=${SMBW_LIBDIR-@builddir@/smbwrapper}
        </pre><p>
        To read:
        </p><pre class="programlisting">
          SMBW_LIBDIR=${SMBW_LIBDIR-/usr/bin}
        </pre><p>
        This change will relocate the <code class="filename">lib</code> directory of Samba to be under the <code class="filename">/usr/bin</code> directory.
      </p></li><li class="step"><p>
        Edit the <code class="filename">Makefile.in</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">Makefile.in</code> and change the line:
      </p><ol type="a" class="substeps"><li class="step"><p>
          </p><pre class="programlisting">
            SBINDIR  =  @bindir@
          </pre><p>
          To read:
          </p><pre class="programlisting">
            SBINDIR  =  @sbindir@
          </pre><p>
        </p></li><li class="step"><p>
          </p><pre class="programlisting">
            VARDIR  =  @localstadir@
          </pre><p>
          To read:
          </p><pre class="programlisting">
            VARDIR  =  /var/log/samba
          </pre><p>
          This will specify that our <code class="filename">sbin</code> directory for the Samba binaries files will be located in the <code class="filename">/usr/sbin</code> directory, and that the <code class="filename">/var</code> 
          directory for Samba log files will be under the <code class="filename">/var/log/samba</code> subdirectory.

        </p></li></ol></li><li class="step"><p>
        Edit the <code class="filename">convert_smbpasswd</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">script/convert_smbpasswd</code> and change the line:
        </p><pre class="programlisting">
          nawk 'BEGIN {FS=":"}
        </pre><p>
        To:
        </p><pre class="programlisting">
          gawk 'BEGIN {FS=":"}
        </pre><p>
        This will specify to use the <acronym class="acronym">GNU</acronym> Linux version of the awk text processing utility instated of the Bell Labs research version of awk program for the <code class="filename">smbpasswd</code> file.
      </p></li><li class="step"><p>
        Edit the <code class="filename">smbmount.c</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">client/smbmount.c</code> and change the lines:
        </p><pre class="programlisting">
          static void close_our_files(int client_fd)
          {
          int i;
          for (i = 0; i &lt; 256; i++) {
          if (i == client_fd) continue;
          close(i);
          }
        </pre><p>
        To read:
        </p><pre class="programlisting">
          static void close_our_files(int client_fd)
          {
          struct rlimit limits;
          int i;

          getrlimit(RLIMIT_NOFILE,&amp;limits);
          for (i = 0; i &lt; limits.rlim_max; i++) {
          if (i == client_fd) continue;
          close(i);
          }
        </pre><p>
        This step will make the <code class="filename">smbmount.c</code> file compatible with Red Hat's glibc 2.1 library.
      </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm21889"></a>3. Compile and optimize</h2></div></div></div><p>
      Type the following commands on your terminal:
      </p><pre class="programlisting">
        CC="egcs" \
        ./configure \
        --prefix=/usr \
        --libdir=/etc \
        --with-lockdir=/var/lock/samba \
        --with-privatedir=/etc \
        --with-swatdir=/usr/share/swat \
        --with-pam \
        --with-mmap \
        --without-sambabook
      </pre><p>
    </p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
        <span class="inlinemediaobject"><img src="./images/Caution.gif" alt="Caution"></span>

      </h3><p>
        The option  <code class="literal">--with-mmap</code> can give a large performance boost on some machines, while on others it makes no difference at all, and on some it may reduce performance.
      </p></div><p>
      This tells Samba to set itself up for this particular hardware setup with:
      </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
          Include PAM password database support for better security.
        </p></li><li class="listitem"><p>
        Include experimental MMAP support to improve Samba performance.
        </p></li><li class="listitem"><p>
        Don't install the book help that come with Samba distribution.
        </p></li></ol></div><p>
    </p><p>
      Now, we must install Samba in the Linux server:

      </p><pre class="screen">
        [root@deep ] /source# <span class="command"><strong>make</strong></span> all
        [root@deep ] /source# <span class="command"><strong>make install</strong></span>
        [root@deep ] /source# <span class="command"><strong>install</strong></span> -m 755 script/mksmbpasswd.sh  /usr/bin/
        [root@deep ] /source# <span class="command"><strong>rm</strong></span> -rf /usr/share/swat/      <a name="smsqco1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
        [root@deep ] /source# <span class="command"><strong>rm</strong></span> -f  /usr/sbin/swat
        [root@deep ] /source# <span class="command"><strong>rm</strong></span> -f  /usr/man/man8/swat.8
        [root@deep ] /source# <span class="command"><strong>mkdir</strong></span> -p /var/lock/samba
        [root@deep ] /source# <span class="command"><strong>mkdir</strong></span> -p /var/spool/samba    <a name="smsqco2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
        [root@deep ] /source# <span class="command"><strong>chmod</strong></span> 1777 /var/spool/samba/ <a name="smsqco3"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
      </pre><p>
      </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#smsqco1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            If like me, you don't like to configure Samba in HTML.
          </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#smsqco2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            Only require if you are the intention to use printer sharing.
          </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#smsqco3"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>
            Only require if you are the intention to use printer sharing.
          </p></td></tr></table></div><p>

      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <span class="command"><strong>install</strong></span> command will install the script <code class="filename">mksmbpasswd.sh</code> under <code class="filename">/usr/bin/</code> directory. This script is needed to setup Samba users allowed to connect on our server 
          via the <code class="filename">smbpasswd</code> file. See later in this documentation for how to setup and use Samba password.
        </p></li><li class="listitem"><p>
        The <span class="command"><strong>rm</strong></span> command will remove the <code class="filename">/usr/share/swat</code> directory and all the files under it, and it will also remove the <span class="command"><strong>swat</strong></span> binary program under 
        <code class="filename">/usr/sbin/</code>. The <acronym class="acronym">SWAT</acronym> program is a web-based configuration utility that permits you to configure the <code class="filename">smb.conf</code> file of Samba via a web 
        browser interface. Of course, in order to use the <acronym class="acronym">SWAT</acronym> utility you will need to have a web server running, such as Apache. The SWAT utility can open a security breach on your server and for this 
        reason I recommend that you remove and not use it.
        </p></li><li class="listitem"><p>
        The <span class="command"><strong>mkdir</strong></span> command will create a <code class="filename">/var/spool/samba/</code> directory on your system for all print sharing jobs you may have. Of course this directory is only necessary 
        if you intend to use Samba print sharing over your LAN. Since we have not configured our Samba server to use print sharing, we do not need to create this directory, <code class="filename">/var/spool/samba/</code> 
        on our server, and we do not need to use the command <span class="command"><strong>chmod</strong></span> to change the <code class="literal">sticky</code> bit in <code class="filename">/var/spool/samba</code> so only the file's owner can delete a 
        given file in this directory.
        </p></li></ul></div><p>
    </p><p>
      Please do cleanup later:
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>cd</strong></span> /var/tmp
        [root@deep ]/tmp# <span class="command"><strong>rm</strong></span> -rf samba-version/ samba-version.tar.gz
      </pre><p>
      The <span class="command"><strong>rm</strong></span> command will remove all the source files we have used to compile and install Samba. It will also remove the Samba compressed archive from the <code class="filename">/var/tmp</code> directory.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm21961"></a>4. Configurations</h2></div></div></div><p>
      Configuration files for different services are very specific, depending on your need and your network architecture. Someone could install Samba Server and have just one client connection, and another could install it with 1000 connections.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
        You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
        for respective software. For example <em class="wordasword">Samba</em> configuration file are organised like this:
        </p><pre class="literallayout"><code class="computeroutput">
          total 28
          -rw-r--r--    1 harrypotter    harrypotter         196 Jun  8 13:00 Compile-Samba
          drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 init.d/
          -rw-r--r--    1 harrypotter    harrypotter          94 Jun  8 13:00 lmhosts
          drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 logrotate.d/
          drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 pam.d/
          -rwx------    1 harrypotter    harrypotter         282 Jun  8 13:00 samba.sh*
          -rw-r--r--    1 harrypotter    harrypotter        1157 Jun  8 13:00 smb.conf
        </code></pre><p>
        You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
        responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
      </p></div><p>
      To run a Samba server, the following files are required and must be created or copied to the appropriate directories on your server.
      </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
          Copy the <code class="filename">smb.conf</code> and lmhosts files in the <code class="filename">/etc/</code> directory.
        </p></li><li class="listitem"><p>
        Copy the <code class="filename">smb</code> script file in the <code class="filename">/etc/rc.d/init.d/</code> directory.
        </p></li><li class="listitem"><p>
        Copy the <code class="filename">samba</code> file in the <code class="filename">/etc/logrotate.d/</code> directory.
        </p></li><li class="listitem"><p>
        Copy the <code class="filename">samba</code> file in the <code class="filename">/etc/pam.d/</code> directory.
        </p></li></ol></div><p>
    </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
        <span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
      </h3><p>
        To run Samba, the following file from the floppy.tgz archive is required and must be created or copied to the appropriate directory on your server. Copy the *.conf file to the <code class="filename">/etc/</code> directory.
        or alternatively you can copy and paste directly from this book to the concerned file.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm22007"></a>5. Configuration of the <code class="filename">/etc/smb.conf</code> file</h2></div></div></div><p>
      The <code class="filename">/etc/smb.conf</code> file is the main configuration file for the Samba server, in which you can specify which directory you want to access from Windows machines, which <acronym class="acronym">IP</acronym> addresses are authorized, 
      and so on. The first few lines of the file under the <code class="filename"><em class="replaceable"><code>[global]</code></em></code> line contain global configuration directives, which are common to all shares, <span class="emphasis"><em>unless they are over-ridden on a 
      per-share basis</em></span>, followed by share sections. A lot of options exist, and it's important to read the documentation that comes with Samba for more information on each of the different settings and parameters.
    </p><p>
      The following configuration example is a minimal working configuration file for Samba with encrypted password support. Also, it's important to note that we comment in this Samba configuration only parameters that relate to security 
      and optimization, and left other posiblities for you to explore.
    </p><p>
      In our example we have created just one directory, <code class="filename"><em class="replaceable"><code>[tmp]</code></em></code> and have allowed only <em class="wordasword">class C</em> machine <acronym class="acronym">IP</acronym> address ranges to connect on the 
      Samba server. Also, we don't use print-sharing capability between Samba and Windows on this server.
      Edit the <code class="filename">smb.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/smb.conf</code> and add/change the following parameters:
    </p><pre class="programlisting">
      [global]

      workgroup = OPENNA
      server string = R&amp;D of Open Network Architecture Samba Server
      encrypt passwords = True
      security = user
      smb passwd file = /etc/smbpasswd
      log file = /var/log/samba/log.%m
      socket options = IPTOS_LOWDELAY TCP_NODELAY
      domain master = Yes
      local master = Yes
      preferred master = Yes
      os level = 65
      dns proxy = No
      name resolve order = lmhosts host bcast
      bind interfaces only = True
      interfaces = eth0 192.168.1.1
      hosts deny = ALL
      hosts allow = 192.168.1.4 127.0.0.1
      debug level = 1
      create mask = 0644
      directory mask = 0755
      level2 oplocks = True
      read raw = no
      write cache size = 262144

      [homes]
      comment = Home Directories
      browseable = no
      read only = no
      invalid users = root bin daemon nobody named sys tty disk mem kmem users

      [tmp]
      comment = Temporary File Space
      path = /tmp
      read only = No
      valid users = admin
      invalid users = root bin daemon nobody named sys tty disk mem kmem users
    </pre><p>
      This tells the <code class="filename">smb.conf</code> file to set itself up for this particular configuration setup with:
    </p><p><b><code class="filename"><em class="replaceable"><code>[global]</code></em></code>. </b>
        </p><div class="glosslist"><dl><dt><span class="glossterm"><code class="envar">workgroup = OPENNA</code></span></dt><dd class="glossdef"><p>
              The option <code class="envar">workgroup</code> specifies the workgroup your server will appear to be in when queried by clients. It's important to have the same workgroup name on both clients and servers.
            </p></dd><dt><span class="glossterm"><code class="envar">server string = R&amp;D of Open Network Architecture Samba Server</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">server string</code> specifies the string that you wish to show to your users in the printer comment box in print manager, or to the <acronym class="acronym">IPC</acronym> connection in the <code class="literal">net view</code> 
            command under Windows machines.
          </p></dd><dt><span class="glossterm"><code class="envar">encrypt passwords = True</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">encrypt passwords</code> if set to <code class="envar">True</code> instructs Samba to use encrypted passwords instead of plain text password when negotiating with the client. Sniffer program will not be able to 
            detect your password when it is encrypted. This option always must be set to <code class="envar">True</code> for security reasons.
          </p></dd><dt><span class="glossterm"><code class="envar">security = user</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">security</code>, if set to <code class="envar">user</code>, specifies that a client must first <code class="literal">log-on</code> with a valid username and password, or the connection will be refused. This means that a 
            valid username and password for the client must exit in your <code class="filename">/etc/passwd</code> file on the Linux server and in the <code class="filename">/etc/smbpasswd</code> file of the Samba server, or the connection from 
            the client will fail. See <a class="link" href="#pr6ch31ssmb" title="12.1. Securing Samba">Securing samba</a> in this chapter for more information about the <code class="filename">smbpasswd</code> file.
          </p></dd><dt><span class="glossterm"><code class="envar">smb passwd file = /etc/smbpasswd</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">smb passwd file</code> specifies the path to the encrypted <code class="filename">smbpasswd</code> file. The <code class="filename">smbpasswd</code> file is a copy of the <code class="filename">/etc/passwd</code> file of the 
            Linux system containing valid usernames and passwords of clients allowed to connect to the Samba server. The Samba software reads this file, <code class="filename">smbpasswd</code> when a connection is requested.
          </p></dd><dt><span class="glossterm"><code class="envar">log file = /var/log/samba/log.%m</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">log file</code> specifies the locations and names of Samba log files. With the name extension <code class="envar">%m</code>, it allows you to have separate log files for each user or machine that logs on your 
            Samba server <abbr class="abbrev">i.e.</abbr> <code class="literal">log.machine1</code>.
          </p></dd><dt><span class="glossterm"><code class="envar">socket options = IPTOS_LOWDELAY TCP_NODELAY</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">socket options</code> specifies parameters that you can include in your Samba configuration to tune and improve your samba server for optimal performance. By default we chose to tune the connection 
            for a local network, and improve the performance of the Samba server for transferring files.
          </p></dd><dt><span class="glossterm"><code class="envar">domain master = Yes</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">domain master</code> specifies to set <code class="envar">nmbd</code>, the Samba server daemon, as a domain master browser for its given workgroup. This option usually must be set to <code class="envar">Yes</code> only on 
            one Samba server for all other Samba servers on the same network and workgroup.
          </p></dd><dt><span class="glossterm"><code class="envar">local master = Yes</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">local master</code> allows <code class="envar">nmbd</code>, the Samba server daemon, to try to become a local master browser on a subnet. Like the above, usually this option must be set to <code class="envar">Yes</code> only 
            on one Samba server that acts as a local master on a subnet for all the other Samba servers on your network.
          </p></dd><dt><span class="glossterm"><code class="envar">preferred master = Yes</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">preferred master</code> specifies and controls if <code class="envar">nmbd</code> the Samba server daemon, is a preferred master browser for its workgroup. Once again, this must usually be set to <code class="envar">Yes</code> 
            on one server for all the others on your network.
          </p></dd><dt><span class="glossterm"><code class="envar">os level = 65</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">os level</code> specifies by its value whether <code class="envar">nmbd</code>, the Samba server daemon, has a chance of becoming a local master browser for the Workgroup in the local broadcast area. The number 65 will 
            win against any NT Server. If you have an NT Server on your network, and want to set your Linux Samba server to be a local master browser for the Workgroup in the local broadcast area then you must set the <code class="envar">os level</code> 
            option to 65. Also, this option must be set only on one Linux Samba server, and must be disabled on all other Linux Samba servers you may have on your network.
          </p></dd><dt><span class="glossterm"><code class="envar">dns proxy = No</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">dns proxy</code> if set to <code class="envar">Yes</code> specifies that <code class="envar">nmbd</code>, the Samba server daemon, when acting as a WINS server and finding that a Net BIOS name has not been registered, should treat the 
            Net BIOS name word-for-word as a DNS name and do a lookup with the DNS server for that name on behalf of the name-querying client. Since we have not configured the Samba server to act as a WINS server, we don't need to set this 
            option to <code class="envar">Yes</code>. Also, setting this option to <code class="envar">Yes</code> will degrade your Samba performance.
          </p></dd><dt><span class="glossterm"><code class="envar">name resolve order = lmhosts host bcast</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">name resolve order</code> specifies what naming services to use in order to resolve host names to <acronym class="acronym">IP</acronym> addresses, and in what order. The parameters we chose cause the local <code class="filename">lmhosts</code> 
            file of samba to be examined first, followed by the rest.
          </p></dd><dt><span class="glossterm"><code class="envar">bind interfaces only = True</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">bind interfaces only</code> if set to <code class="envar">True</code>, allows you to limit what interfaces will serve <code class="literal">smb</code> requests. This is a security feature. The configuration option <code class="envar">interfaces = eth0 192.168.1.1</code> 
            below completes this option.
          </p></dd><dt><span class="glossterm"><code class="envar">interfaces = eth0 192.168.1.1</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">interfaces</code> allows you to override the default network interface list that Samba will use for browsing, name registration and other NBT traffic. By default, Samba will query the kernel for the list of all active interfaces and use 
            any interface, except <code class="literal">127.0.0.1</code>, that is broadcast capable. With this option, Samba will only listen on interface <code class="literal">eth0</code> on the <acronym class="acronym">IP</acronym> address <code class="literal">192.168.1.1</code>. This is a security feature, 
            and completes the above configuration option <code class="envar">bind interfaces only = True</code>.
          </p></dd><dt><span class="glossterm"><code class="envar">hosts deny = ALL</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">hosts deny</code> specifies the list of hosts that are <span class="emphasis"><em>not</em></span> permitted access to Samba services unless the specific services have their own lists to override this one. For simplicity, we 
            deny access to all hosts by default, and allow specific hosts in the <code class="envar">hosts allow =</code> option below.
          </p></dd><dt><span class="glossterm"><code class="envar">hosts allow = 192.168.1.4 127.0.0.1</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">hosts allow</code> specifies which hosts are permitted to access a Samba service. By default, we allow hosts from <acronym class="acronym">IP</acronym> class C <code class="literal">192.168.1.4</code> and our localhost <code class="literal">127.0.0.1</code> 
            to access the Samba server. Note that the localhost must always be set or you will receive some error messages.
          </p></dd><dt><span class="glossterm"><code class="envar">debug level = 1</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">debug level</code> allows the logging level to be specified in the <code class="filename">smb.conf</code> file. If you set the debug level higher than 2 then you may suffer a large drop in performance. This is because 
            the server flushes the log file after each operation, which can be very expensive.
          </p></dd><dt><span class="glossterm"><code class="envar">create mask = 0644</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">create mask</code> specifies and sets the necessary permissions according to the mapping from DOS modes to UNIX permissions. With this option set to <code class="literal">0644</code>, all file copying or creating from a 
            Windows system to the Unix system will have a permission of <code class="literal">0644</code> by default.
          </p></dd><dt><span class="glossterm"><code class="envar">directory mask = 0755</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">directory mask</code> specifies and set the octal modes, which are used when converting DOS modes to UNIX modes when creating UNIX directories. With this option set to <code class="literal">0755</code>, all directory copying 
            or creating from a Windows system to the Unix system will have a permission of <code class="literal">0755</code> by default.
          </p></dd><dt><span class="glossterm"><code class="envar">level2 oplocks = True</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">level2 oplocks</code>, if set to <code class="envar">True</code>, will increase the performance for many accesses of files that are not commonly written, <span class="emphasis"><em>such as .EXE application files</em></span>.
          </p></dd><dt><span class="glossterm"><code class="envar">read raw = no</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">read raw</code> controls whether or not the server will support the raw read SMB requests when transferring data to clients. Note that memory mapping is not used by the <code class="literal">read raw</code> operation. Thus, you 
            may find memory mapping is more effective if you disable <code class="literal">read raw</code> using <code class="envar">read raw = no</code>, like we do.
          </p></dd><dt><span class="glossterm"><code class="envar">write cache size = 262144</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">write cache size</code> allows Samba to improve performance on systems where the disk subsystem is a bottleneck. The value of this option is specified in bytes, and a size of 262,144 represent a 256k cache size per file.
          </p></dd></dl></div><p>
      </p><p><b><code class="filename"><em class="replaceable"><code>[tmp]</code></em></code>. </b>
        </p><div class="glosslist"><dl><dt><span class="glossterm"><code class="envar">comment = Temporary File Space</code></span></dt><dd class="glossdef"><p>
              The option <code class="envar">comment</code> allows you to specify a comment that will appear next to a share when a client does queries to the server.
            </p></dd><dt><span class="glossterm"><code class="envar">path = /tmp</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">path</code> specifies a directory to which the user of the service is to be given access. In our example this is the <code class="filename">tmp</code> directory of the Linux server.
          </p></dd><dt><span class="glossterm"><code class="envar">read only = No</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">read only</code> specifies if users should be allowed to only read files or not. In our example, since this is a configuration for the <code class="filename">tmp</code> directory of the Linux server, users 
            can do more than just read files.
          </p></dd><dt><span class="glossterm"><code class="envar">valid users = admin</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">valid users</code> specifies a list of users that should be allowed to login to this service. In our example only the user <code class="literal">admin</code> is allowed to access the service.
          </p></dd><dt><span class="glossterm"><code class="envar">invalid users = root bin daemon nobody named sys tty disk mem kmem users</code></span></dt><dd class="glossdef"><p>
            The option <code class="envar">invalid users</code> specifies a list of users that should not be allowed to login to this service. This is really a <code class="literal">paranoid</code> check to absolutely ensure an improper setting does not breach your 
            security. It is recommended that you include all default users that run daemons on the server.
          </p></dd></dl></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm22266"></a>6. Configure the <code class="filename">/etc/lmhosts</code> file</h2></div></div></div><p>
      Configure your <code class="filename">/etc/lmhosts</code> file. The <code class="filename">lmhosts</code> file is the Samba Net BIOS name to <acronym class="acronym">IP</acronym> address mapping file. It is very similar to the <code class="filename">/etc/hosts</code> file format, except 
      that the hostname component must correspond to the Net BIOS naming format.
    </p><p>
      Create the <code class="filename">lmhosts</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/lmhosts</code> and add your client hosts:
      </p><pre class="programlisting">
        # Sample Samba lmhosts file.
        #
        127.0.0.1	localhost
        192.168.1.1	deep
        192.168.1.4	win
      </pre><p>
      In our example, this file contains three <acronym class="acronym">IP</acronym> to Net BIOS name mappings. The localhost, <code class="literal">127.0.0.1</code>, client named deep, <code class="literal">192.168.1.1</code> and client named win, <code class="literal">192.168.1.4.</code>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm22283"></a>6.1. Configure the <code class="filename">/etc/pam.d/samba</code> file</h3></div></div></div><p>
        Configure your <code class="filename">/etc/pam.d/samba</code> file to use pam authentication by creating the <code class="filename">samba</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/pam.d/samba</code> and add the following lines:
      </p><pre class="programlisting">
        Auth	required        /lib/security/pam_pwdb.so nullok shadow
        Account	required        /lib/security/pam_pwdb.so
      </pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idm22292"></a>6.1.1. Configure the <code class="filename">/etc/logrotate.d/samba</code> file</h4></div></div></div><p>
          Configure your <code class="filename">/etc/logrotate.d/samba</code> file to rotate each week your log files automatically.
        </p><p>
          Create the <code class="filename">samba</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/logrotate.d/samba</code> and add the following lines:
          </p><pre class="programlisting">
            /var/log/samba/log.nmb {
            notifempty
            missingok
            postrotate
            /usr/bin/killall -HUP nmbd
            endrotate
            }

            /var/log/samba/log.smb {
            notifempty
            missingok
            postrotate
            /usr/bin/killall -HUP smbd
            endrotate
            }
          </pre><p>
        </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm22302"></a>7. Encrypted Samba password file for clients</h2></div></div></div><p>
      The <code class="filename">/etc/smbpasswd</code> file is the Samba encrypted password file. It contains the username; Unix UID and SMB hashed passwords of the allowed users to your Samba server, as well as account flag information and the time the 
      password was last changed. It's important to create this password file and include all allowed users to it before your clients try to connect to your Samba server. Without this step, no one will be able to connect to your Samba server.
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        To create a Samba account you must first have a valid Linux account for them, so create in your <code class="filename">etc/passwd</code> file all the users you want to connect to your Samba server first before generating the <code class="filename">smbpasswd</code> 
        file of Samba.</p><ol type="a" class="substeps"><li class="step"><p>
            To add a new users to your <code class="filename">/etc/passwd</code> file, use the following commands:
            </p><pre class="screen">
              [root@deep ] /# <span class="command"><strong>useradd</strong></span> smbclient
            </pre><p>
          </p></li><li class="step"><p>
            To add password for users in your <code class="filename">/etc/passwd</code> file, use the following commands:
            </p><pre class="screen">
              [root@deep ] /# passwd smbclient
            </pre><p>
            </p><pre class="literallayout"><code class="computeroutput">
              Changing password for user smbclient
              New UNIX password:
              Retype new UNIX password:
              passwd: all authentication tokens updated successfully
            </code></pre><p>
          </p></li></ol></li><li class="step"><p>
        Once we have added all Samba clients in our <code class="filename">/etc/passwd</code> file on the Linux server, we can now generate the <code class="filename">smbpasswd</code> file from the <code class="filename">/etc/passwd</code> file.
        To generate <code class="filename">smbpasswd</code> file from the <code class="filename">/etc/passwd</code> file, use the following commands:
        </p><pre class="screen">
          [root@deep ] /# <span class="command"><strong>cat</strong></span> /etc/passwd | mksmbpasswd.sh &gt; /etc/smbpasswd
        </pre><p>
      </p></li><li class="step"><p>
        Finally, the last step we must perform is to create the Samba user account in our <code class="filename">/etc/smbpasswd</code> file before we are able to use it.
        To create the <code class="literal">Samba</code> user account, use the following commands:
        </p><pre class="screen">
          [root@deep ] /# smbpasswd -a smbclient  <a name="smbpswd"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
        </pre><p>
        </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#smbpswd"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
          Remember that <code class="literal">smbclient</code> must be a valid Linux account.
        </p></td></tr></table></div><p>
        </p><pre class="literallayout"><code class="computeroutput">
          New SMB password:
          Retype new SMB password:
          Added user smbclient.
          Password changed for user smbclient.
        </code></pre><p>
      </p></li><li class="step"><p>
        Don't forget to change the permission of your new <code class="filename">smbpasswd</code> file to be readable and writable only by the super-user <code class="literal">root</code>, and nothing for group and other <code class="literal">0600/-rw-------</code> This 
        is a security measure.
        </p><pre class="screen">
          [root@deep ] /# <span class="command"><strong>chmod</strong></span> 600 /etc/smbpasswd
          [root@deep ] /# <span class="command"><strong>testparm</strong></span>    <a name="smbtsp"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
        </pre><p>
        </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#smbtsp"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
          This will verify the <code class="filename">smb.conf</code> file for error.
        </p></td></tr></table></div><p>
        See <code class="filename">ENCRYPTION.txt</code> in <code class="filename">samba/doc/texts/</code> for more information.
      </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm22359"></a>8. Optimizing Samba</h2></div></div></div><p>
      It is a big mistake to set the <code class="envar">wide links</code> Samba parameter to <code class="envar">no</code> in the Samba configuration file <code class="filename">/etc/smb.conf</code>. This option, if set to <code class="envar">no</code>, tells Samba not to follow 
      symbolic links outside of an area designated as being exported as a share point. In order to determine if a link points outside the shared area, Samba has to follow the link and then do a directory path lookup to determine where 
      on the file system the link ended up. This ends up adding a total of six extra system calls per filename lookup, and Samba looks up filenames a lot. A test done was published that showed that setting this parameter will cause a 
      25 to 30 -percent slowdown in Samba performance.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm22366"></a>8.1. Tuning the buffer cache</h3></div></div></div><p>
        The modification of the filesystem cache-tuning parameters can significantly improve Linux's file-serving performance up to a factor of two. Linux will attempt to use memory not being used for any other purpose for filesystem caching. 
        A special daemon, called <code class="literal">bdflush</code>, will periodically flush <code class="literal">dirty</code> buffers, <span class="emphasis"><em>buffers that contain modified filesystem data or metadata</em></span> to the disk.
      </p><p>
        The secret to good performance is to keep as much of the data in memory for as long as is possible. Writing to the disk is the slowest part of any filesystem. If you know that the filesystem will be heavily used, then you can tune this 
        process for Linux Samba. As with many kernel tuneable options, this can be done on the fly by writing to special files in the <code class="filename">/proc</code> filesystem. The trick is, you have to tell Linux you want it to do that. You do so by executing the 
        following command for a Linux 2.2 kernel.
      </p><p>
        The default setup for the <code class="literal">bdflush</code> parameters under Red Hat Linux is:
        </p><pre class="programlisting">
          "40 500 64 256 500 3000 500 1884 2"
        </pre><p>
        To change the values of bdflush, type the following command on your terminal:
      </p><p>
        Under 
        <span class="inlinemediaobject"><img src="./images/Version6.1.gif" align="middle" alt="Version 6.1"></span>
        </p><pre class="screen">
          [root@deep ] /# echo "80 500 64 64 15 6000 6000 1884 2" &gt;/proc/sys/vm/bdflush
        </pre><p>
        You may add the above commands to the <code class="filename">/etc/rc.d/rc.local</code> script file and you'll not have to type it again the next time you reboot your system.

      </p><p>
        Under
        <span class="inlinemediaobject"><img src="./images/Version6.2.gif" align="middle" alt="Version 6.2"></span>
         
        Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
        </p><pre class="programlisting">
          # Improve file system performance
          vm.bdflush = 80 500 64 64 15 6000 6000 1884 2
        </pre><p>
      </p><p>
        You must restart your network for the change to take effect. The command to restart the network is the following:
        </p><pre class="screen">
          [root@deep ] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
        </pre><p>
        </p><pre class="literallayout"><code class="computeroutput">
          Setting network parameters		[  OK  ]
          Bringing up interface lo		[  OK  ]
          Bringing up interface eth0	        [  OK  ]
          Bringing up interface eth1	        [  OK  ]
        </code></pre><p>
        This line tells <code class="literal">bdflush</code> not to worry about writing out dirty blocks to the disk until the filesystem buffer cache is 80 percent full (80). The other values tune such things as the number of buffers 
        to write out in one disk operation (500), how long to allow dirty buffers to age in the kernel (60*HZ), etc. You can find full details in the 2.2 kernel documentation in the file <code class="filename">linux/Documentation/sysctl/vm.txt</code>,
        and also, you can check <a class="link" href="#pr3ch6lglc" title="Chapter 6. Linux General Optimization">General System Optimization</a>, for more information.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm22401"></a>9. Tuning the buffermem</h2></div></div></div><p>
      Another helpful tuning hint is to tell Linux the following: Use a minimum of 60 percent of memory for the buffer cache; only prune when the percentage of memory used for the buffer cache gets over 10 percent (this parameter is now unused); 
      and allow the buffer cache to grow to 60 percent of all memory (this parameter is also unused now).
    </p><p>
      The default setup for the <code class="literal">buffermem</code> parameters under Red Hat Linux is:
      </p><pre class="programlisting">
        "2 10 60"
      </pre><p>
    </p><p>
      Under 
      <span class="inlinemediaobject"><img src="./images/Version6.1.gif" alt="Version 6.1"></span>

      To change the values of buffermem, type the following command on your terminal:

      
      </p><pre class="screen">
        [root@deep ] /# echo "60 10 60" &gt;/proc/sys/vm/buffermem
      </pre><p>
      You can put the above command in the <code class="filename">/etc/rc.d/rc.local</code> script file and avoid typing it again the next time your system reboots. You can find full details in the 2.2 kernel documentation in the file <code class="filename">linux/Documentation/sysctl/vm.txt</code> a
      nd also, you can check  <a class="link" href="#pr3ch6lglc" title="Chapter 6. Linux General Optimization">General System Optimization</a>, for more information.
    </p><p>
       Under 
      <span class="inlinemediaobject"><img src="./images/Version6.2.gif" alt="Version 6.2"></span>     
      Edit the <code class="filename">/etc/sysctl.conf</code> file and add the following line:
      </p><pre class="programlisting">
        # Improve virtual memory performance
        vm.buffermem = 60 10 60
      </pre><p>
    </p><p>
      You must restart your network for the change to take effect. The command to restart the network is the following:
      </p><pre class="screen">
        [root@deep ] /# /etc/rc.d/init.d/network <span class="command"><strong>restart</strong></span>
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        Setting network parameters		[  OK  ]
        Bringing up interface lo		[  OK  ]
        Bringing up interface eth0	        [  OK  ]
        Bringing up interface eth1	        [  OK  ]
      </code></pre><p>
      Recall that the last two parameters, 10 and 60 are unused by the system so we don't need to change the default ones.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm22430"></a>10. Further documentation</h2></div></div></div><p>
      For more details, there are several man pages you can read:
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">Samba</span>(7)</span></span></dt><dd><p>
          A Windows SMB/CIFS fileserver for UNIX
        </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">smb.conf</span>(5)</span></span></dt><dd><p>
        The configuration file for the Samba suite
      </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">smbclient</span>(1)</span></span></dt><dd><p>
        ftp-like client to access SMB/CIFS resources on servers
      </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">smbd</span>(8)</span></span></dt><dd><p>
        server to provide SMB/CIFS services to clients
      </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">smbmnt</span>(8)</span></span></dt><dd><p>
        mount smb file system
      </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">smbmount</span>(8)</span></span></dt><dd><p>
        mount smb file system
      </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">smbpasswd</span>(5)</span></span></dt><dd><p>
        The Samba encrypted password file
      </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">smbpasswd</span>(8)</span></span></dt><dd><p>
        change a users SMB password
      </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">smbrun</span>(1)</span></span></dt><dd><p>
        interface program between smbd and external programs
      </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">smbsh</span>(1)</span></span></dt><dd><p>
        Allows access to Windows NT filesystem using UNIX commands
      </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">smbstatus</span>(1)</span></span></dt><dd><p>
        report on current Samba connections
      </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">smbtar</span>(1)</span></span></dt><dd><p>
        shell script for backing up SMB shares directly to UNIX tape drives
      </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">smbumount</span>(8)</span></span></dt><dd><p>
        umount for normal users
      </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">testparm</span>(1)</span></span></dt><dd><p>
        check an smb.conf configuration file for internal correctness
      </p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">testprns</span>(1)</span></span></dt><dd><p>
        check printer name for validity with smbd
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm22539"></a>11. Samba Administrative Tools</h2></div></div></div><p>
      The commands listed below are some that we use often, but many more exist. Check the man pages and documentation for more details and information.
    </p><p><b>smbstatus. </b>
        The smbstatus utility is a very simple program to list the current Samba connections.
        To report current Samba connections, use the following command:
        </p><pre class="screen">
          [root@deep ] /# smbstatus
        </pre><p>
        </p><pre class="literallayout"><code class="computeroutput">
          Samba version 2.0.7
          Service      uid      gid      pid     machine
          ----------------------------------------------
          tmp          webmaster webmaster  3995   gate     (192.168.1.3) Sat Sep 25 19:40:54 1999

          No locked files

          Share mode memory usage (bytes):
          1048464(99%) free + 56(0%) used + 56(0%) overhead = 1048576(100%) total
        </code></pre><p>
      </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm22548"></a>11.1. Samba Users Tools</h3></div></div></div><p>
        The commands listed below are some that we use often, but many more exist. Check the man pages and documentation for more details and information.
      </p><p><b>smbclient. </b>
          The <span class="command"><strong>smbclient</strong></span> program utility for Samba works much like the interface of the FTP program. This small program allow you to get files from the server to the local machine, put files from the local machine 
          to the server, retrieve directory information from the server, and so on.
        </p><p>
        To connect to a Windows machine with smbclient utility, use the following command:
        </p><pre class="screen">
          [root@deep ] /# smbclient //sbmserver/sharename -U smbclient
          [root@deep ] /# smbclient //gate/tmp -U smbclient
        </pre><p>
      </p><p>
        </p><pre class="literallayout"><code class="computeroutput">
          Password:
          Domain=[OPENNA] OS=[Windows NT 4.0] Server=[NT LAN Manager 4.0]
          smb: \&gt; ls
          .                               	D       0  	Tue Mar 14 15:31:50 2000
          ..                                  	D       0  	Tue Mar 14 15:31:50 2000
          PostgreSQL                          	D       0  	Tue Mar 14 15:32:22 2000
          Squid                               	D       0  	Tue Mar 14 15:32:28 2000
          E_comm                              	D       0  	Tue Mar 14 15:32:42 2000
          StackGuard.pdf                      	A    	61440  	Tue Dec 21 20:41:34 1999
          installation-without-XFree86        	A	448	Tue Dec 21 20:41:28 1999
          lcap-0_0_3-2_src.rpm                	A    	13481  	Thu Jan 13 01:50:12 2000
          mirc561t.exe                        	A   	948224	Tue Dec 21 20:41:54 1999

          65510 blocks of size 32768. 5295 blocks available
          smb: \&gt;
        </code></pre><p>
        Where <code class="literal">//sbmserver</code> is the name of the server you want to connect to. <code class="filename">/sharename</code> is the directory on this server you want to connect to, and <code class="literal">smbclient</code> is 
        your username on this machine.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm22563"></a>12. The <code class="filename">/etc/rc.d/init.d/smb</code> script file</h2></div></div></div><p>
      Configure your <code class="filename">/etc/rc.d/init.d/smb</code> script file to start and stop Samba <code class="literal">smbd</code> and <code class="literal">nmbd</code> daemons Server automaticaly.
      Create the <code class="filename">smb</code> script file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/rc.d/init.d/smb</code> and add the following lines:
    </p><pre class="programlisting">
      #!/bin/sh
      #
      # chkconfig: - 91 35
      # description: Starts and stops the Samba smbd and nmbd daemons \
      #	       used to provide SMB network services.

      # Source function library.
      . /etc/rc.d/init.d/functions

      # Source networking configuration.
      . /etc/sysconfig/network

      # Check that networking is up.
      [ ${NETWORKING} = "no" ] &amp;&amp; exit 0

      # Check that smb.conf exists.
      [ -f /etc/smb.conf ] || exit 0

      RETVAL=0

      # See how we were called.
      case "$1" in
      start)
      echo -n "Starting SMB services: "
      daemon smbd -D 	
      RETVAL=$?
      echo
      echo -n "Starting NMB services: "
      daemon nmbd -D 
      RETVAL2=$?
      echo
      [ $RETVAL -eq 0 -a $RETVAL2 -eq 0 ] &amp;&amp; touch /var/lock/subsys/smb || \
      RETVAL=1
      ;;
      stop)
      echo -n "Shutting down SMB services: "
      killproc smbd
      RETVAL=$?
      echo
      echo -n "Shutting down NMB services: "
      killproc nmbd
      RETVAL2=$?
      [ $RETVAL -eq 0 -a $RETVAL2 -eq 0 ] &amp;&amp; rm -f /var/lock/subsys/smb
      echo ""
      ;;
      restart)
      $0 stop
      $0 start
      RETVAL=$?
      ;;
      reload)
      echo -n "Reloading smb.conf file: "
      killproc -HUP smbd
      RETVAL=$?
      echo
      ;;
      status)
      status smbd
      status nmbd
      RETVAL=$?
      ;;
      *)
      echo "Usage: $0 {start|stop|restart|status}"
      exit 1
      esac

      exit $RETVAL
    </pre><p>
      Now, make this script executable and change its default permissions:
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>chmod</strong></span> 700 /etc/rc.d/init.d/smb
      </pre><p>
      Create the symbolic <code class="filename">rc.d</code> links for Samba with the command:
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>chkconfig</strong></span> --add smb
      </pre><p>
    </p><p>
      Samba script will not automatically start the smbd and nmbd daemon when you reboot the server. You can change it to do this by default by executing the following command:
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>chkconfig</strong></span> --level 345 smb on
      </pre><p>
      Start your Samba Server manually with the following command:
      </p><pre class="screen">
        [root@deep ] /# /etc/rc.d/init.d/smb <span class="command"><strong>start</strong></span>
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        Starting SMB services:                     	[  OK  ]
        Starting NMB services:                   	[  OK  ]
      </code></pre><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="pr6ch31ssmb"></a>12.1. Securing Samba</h3></div></div></div><p>
        Immunize important configuration files, the immutable bit can be used to prevent accidentally deleting or overwriting a file that must be protected. It also prevents someone from creating a symbolic link to this file. Once your <code class="filename">smb.conf</code> 
        and <code class="filename">lmhosts</code> files have been configured, it's a good idea to immunize them with a  command like:
        </p><pre class="screen">
          [root@deep ] /# <span class="command"><strong>chattr</strong></span> +i /etc/smb.conf
          [root@deep ] /# <span class="command"><strong>chattr</strong></span> +i /etc/lmhosts
        </pre><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm22595"></a>13. Installed files</h2></div></div></div><p>
      These are the files installed by Samba software on your sytem.
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/rc.d/init.d/smb</code></td><td><code class="filename">/etc/rc.d/rc0.d/K35smb</code></td><td><code class="filename">/etc/rc.d/rc1.d/K35smb</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc2.d/K35smb</code></td><td><code class="filename">/etc/rc.d/rc3.d/S91smb</code></td><td><code class="filename">/etc/rc.d/rc4.d/S91smb</code></td></tr><tr><td><code class="filename">/etc/rc.d/rc5.d/S91smb</code></td><td><code class="filename">/etc/rc.d/rc6.d/K35smb</code></td><td><code class="filename">/etc/pam.d/samba</code></td></tr><tr><td><code class="filename">/etc/logrotate.d/samba</code></td><td><code class="filename">/etc/codepages</code></td><td><code class="filename">/etc/codepages/codepage.437</code></td></tr><tr><td><code class="filename">/etc/codepages/unicode_map.437</code></td><td><code class="filename">/etc/codepages/codepage.737</code></td><td><code class="filename">/etc/codepages/unicode_map.737</code></td></tr><tr><td><code class="filename">/etc/codepages/codepage.775</code></td><td><code class="filename">/etc/codepages/codepage.850</code></td><td><code class="filename">/etc/codepages/unicode_map.850</code></td></tr><tr><td><code class="filename">/etc/codepages/codepage.852</code></td><td><code class="filename">/etc/codepages/unicode_map.852</code></td><td><code class="filename">/etc/codepages/codepage.861</code></td></tr><tr><td><code class="filename">/etc/codepages/unicode_map.861</code></td><td><code class="filename">/etc/codepages/codepage.932</code></td><td><code class="filename">/etc/codepages/unicode_map.932</code></td></tr><tr><td><code class="filename">/etc/codepages/codepage.866</code></td><td><code class="filename">/etc/codepages/unicode_map.866</code></td><td><code class="filename">/etc/codepages/codepage.949</code></td></tr><tr><td><code class="filename">/etc/codepages/unicode_map.949</code></td><td><code class="filename">/etc/codepages/codepage.950</code></td><td><code class="filename">/etc/codepages/unicode_map.950</code></td></tr><tr><td><code class="filename">/etc/codepages/codepage.936</code></td><td><code class="filename">/etc/codepages/unicode_map.936</code></td><td><code class="filename">/etc/codepages/codepage.1251</code></td></tr><tr><td><code class="filename">/etc/codepages/unicode_map.ISO8859-1</code></td><td><code class="filename">/etc/codepages/unicode_map.ISO8859-2</code></td><td><code class="filename">/etc/codepages/unicode_map.ISO8859-5</code></td></tr><tr><td><code class="filename">/etc/codepages/unicode_map.ISO8859-7</code></td><td><code class="filename">/etc/codepages/unicode_map.KOI8-R</code></td><td><code class="filename">/etc/lmhosts</code></td></tr><tr><td><code class="filename">/etc/smb.conf</code></td><td><code class="filename">/etc/smbpasswd</code></td><td><code class="filename">/etc/gshadow-</code></td></tr><tr><td><code class="filename">/usr/bin/smbclient</code></td><td><code class="filename">/usr/bin/smbspool</code></td><td><code class="filename">/usr/bin/testparm</code></td></tr><tr><td><code class="filename">/usr/bin/testprns</code></td><td><code class="filename">/usr/bin/smbstatus</code></td><td><code class="filename">/usr/bin/rpcclient</code></td></tr><tr><td><code class="filename">/usr/bin/smbpasswd</code></td><td><code class="filename">/usr/bin/make_smbcodepage</code></td><td><code class="filename">/usr/bin/make_unicodemap</code></td></tr><tr><td><code class="filename">/usr/bin/nmblookup</code></td><td><code class="filename">/usr/bin/make_printerdef</code></td><td><code class="filename">/usr/bin/smbtar</code></td></tr><tr><td><code class="filename">/usr/bin/addtosmbpass</code></td><td><code class="filename">/usr/bin/convert_smbpasswd</code></td><td><code class="filename">/usr/bin/mksmbpasswd.sh</code></td></tr><tr><td><code class="filename">/usr/man/man1/make_smbcodepage.1</code></td><td><code class="filename">/usr/man/man1/make_unicodemap.1</code></td><td><code class="filename">/usr/man/man1/nmblookup.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/smbclient.1</code></td><td><code class="filename">/usr/man/man1/smbrun.1</code></td><td><code class="filename">/usr/man/man1/smbsh.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/smbstatus.1</code></td><td><code class="filename">/usr/man/man1/smbtar.1</code></td><td><code class="filename">/usr/man/man1/testparm.1</code></td></tr><tr><td><code class="filename">/usr/man/man1/testprns.1</code></td><td><code class="filename">/usr/man/man5/lmhosts.5</code></td><td><code class="filename">/usr/man/man5/smb.conf.5</code></td></tr><tr><td><code class="filename">/usr/man/man5/smbpasswd.5</code></td><td><code class="filename">/usr/man/man7/samba.7</code></td><td><code class="filename">/usr/man/man8/nmbd.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/smbd.8</code></td><td><code class="filename">/usr/man/man8/smbmnt.8</code></td><td><code class="filename">/usr/man/man8/smbmount.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/smbpasswd.8</code></td><td><code class="filename">/usr/man/man8/smbspool.8</code></td><td><code class="filename">/usr/man/man8/smbumount.8</code></td></tr><tr><td><code class="filename">/usr/sbin/smbd</code></td><td><code class="filename">/usr/sbin/nmbd</code></td><td><code class="filename">/var/log/samba</code></td></tr><tr><td><code class="filename">/var/lock/samba</code></td><td> </td><td> </td></tr></table></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="idm22763"></a>Chapter 32. Linux <code class="literal">FTP</code> Server</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#pr6ch32sftp">1. chroot'd Guest FTP access</a></span></dt><dt><span class="section"><a href="#idm22819">2. Setup an <code class="literal">FTP</code> user account minus shells</a></span></dt><dt><span class="section"><a href="#idm22888">3. Setup a chroot user environment</a></span></dt><dt><span class="section"><a href="#idm23080">4. Configurations</a></span></dt><dt><span class="section"><a href="#idm23132">5. Configure the <code class="filename">/etc/ftphosts</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm23156">5.1. Configure the <code class="filename">/etc/ftpusers</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm23175">6. Configure the <code class="filename">/etc/ftpconversions</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm23192">6.1. Configure the <code class="filename">/etc/pam.d/ftp</code> file</a></span></dt></dl></dd><dt><span class="section"><a href="#idm23199">7. Configure the <code class="filename">/etc/logrotate.d/ftpd</code> file</a></span></dt><dd><dl><dt><span class="section"><a href="#idm23206">7.1. Configure ftpd to use tcp-wrappers inetd</a></span></dt></dl></dd><dt><span class="section"><a href="#idm23228">8. <acronym class="acronym">FTP</acronym> Administrative Tools</a></span></dt><dt><span class="section"><a href="#idm23250">9. Securing <code class="literal">FTP</code></a></span></dt><dt><span class="section"><a href="#idm23313">10. The special file <code class="filename">.notar</code></a></span></dt><dt><span class="section"><a href="#idm23372">11. Installed files</a></span></dt></dl></div><div class="highlights"><p>
    Despite its age, using the File Transfer Protocol, <code class="literal">FTP</code> is one of the most popular way to transfer files from machine to machine across a network. Clients and servers have been written for almost all popular platforms in 
    the market, thereby making <code class="literal">FTP</code> the most convenient way to perform file transfers.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pr6ch32sftp"></a>1. chroot'd Guest FTP access</h2></div></div></div><p>
      Various methods exist to configure your <code class="literal">FTP</code> servers. One is as a private user-only site, which is the default configuration for an <code class="literal">FTP</code> server; a private <code class="literal">FTP</code> server allows users on 
      the Linux system only to be able to connect via <code class="literal">FTP</code> and access their files.
    </p><p>
      Anohter method is to configure as an anonymous <code class="literal">FTP</code> server. An anonymous <code class="literal">FTP</code> server allows anyone on the network to connect to it and transfer files without having an account. Due to the potential 
      security risk involved with this setup, precautions should be taken to allow access only to certain directories on the system.
    </p><p>
      The configuration we will cover here is an <code class="literal">FTP</code> server that allows <code class="literal">FTP</code> to semi-secure areas of a Unix file system, <span class="emphasis"><em>chroot'd Guest FTP access</em></span>. This configuration allows users to 
      have access to the <code class="literal">FTP</code> server directories without allowing them to get into higher levels. This is the most secure setup for an <code class="literal">FTP</code> server.

      </p><div class="mediaobject" align="center"><img src="./images/FTP-Schema.gif" align="middle" alt="FTP"></div><p>

    </p><p>
      These installation instructions assume
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Commands are Unix-compatible.
      </p></li><li class="listitem"><p>
      The source path is <code class="filename">/var/tmp</code>, <span class="emphasis"><em>other paths are possible</em></span>.
      </p></li><li class="listitem"><p>
      Installations were tested on Red Hat Linux 6.1 and 6.2.
      </p></li><li class="listitem"><p>
      All steps in the installation will happen in super-user account <code class="literal">root</code>.
      </p></li><li class="listitem"><p>
      wu-ftpd version number is 2.6.0
      </p></li></ul></div><p>
    </p><p>
      These are the Package(s):
      </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
        Wu-ftpd Homepage:<a class="link" href="#prtinxfp32er" title="Linux FTP Server">http://www.wu-ftpd.org/</a>
      </td></tr><tr><td>
      Wu-ftpd FTP Site:<a class="link" href="#prtinxfp32er" title="Linux FTP Server">205.133.13.68</a>
      </td></tr><tr><td>
      You must be sure to download: wu-ftpd-2.6.0.tar.gz
      </td></tr></table><p>
    </p><p>
    To compile, you need to decompress the tarball, <code class="literal">tar.gz</code>.
    </p><pre class="screen">
      [root@deep ] /# <span class="command"><strong>cp</strong></span> wu-ftpd-version.tar.gz /var/tmp
      [root@deep ] /# <span class="command"><strong>cd</strong></span> /var/tmp
      [root@deep ]/tmp# <span class="command"><strong>tar</strong></span> xzpf wu-ftpd-version.tar.gz
    </pre><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm22819"></a>2. Setup an <code class="literal">FTP</code> user account minus shells</h2></div></div></div><p>
      It's important to give to your strictly <code class="literal">FTP</code> users no real shell account on the Linux system. In this manner, if for any reasons someone could successfully get out of the <code class="literal">FTP</code> chrooted environment, it would 
      not have the possibility of executing any user tasks since it doesn't have a bash shell. First, create new users for this purpose; 
      </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
        These users will be the users allowed to connect to your <code class="literal">FTP</code> server. 
      </td></tr></table><p>
      This has to be separate from a regular user account with unlimited access because of how the <code class="literal">chroot</code> environment works. Chroot makes it appear from the user's perspective as if the level of the file system you've placed them 
      in is the top level of the file system.
    </p><p>
      Use the following command to create users in the <code class="filename">/etc/passwd</code> file. This step must be done for each additional new user you allow to access your <code class="literal">FTP</code> server.
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>mkdir</strong></span> /home/ftp
        [root@deep ] /# <span class="command"><strong>useradd</strong></span> -d /home/ftp/ftpadmin/ -s /dev/null ftpadmin &gt; /dev/null 2&gt;&amp;1
        [root@deep ] /# <span class="command"><strong>passwd</strong></span> ftpadmin
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        Changing password for user ftpadmin
        New UNIX password:
        Retype new UNIX password:
        passwd: all authentication tokens updated successfully
      </code></pre><p>
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The <span class="command"><strong>mkdir</strong></span> command will create the <code class="filename">ftp</code> directory under the <code class="filename">/home</code> directory to handle all <code class="literal">FTP</code> users' 
        home directories we'll have on the server. 
      </p></li><li class="listitem"><p>
      The <span class="command"><strong>useradd</strong></span> command will add the new user named <code class="literal">ftpadmin</code> to our Linux server. 
      </p></li><li class="listitem"><p>
      Finally, the <span class="command"><strong>passwd</strong></span> command will set the password for this user <code class="literal">ftpadmin</code>. 
      </p></li></ul></div><p>
      Once the <code class="filename">home/ftp/</code> directory has been created you don't have to use this command again for additional <code class="literal">FTP</code> users.
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        Edit the <code class="filename">/etc/shells</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/shells</code> and add a non-existent shell name like <code class="literal">null</code>, for example. This fake shell will limit access on 
        the system for <code class="literal">FTP</code> users.
        </p><pre class="screen">
          [root@deep ] /# <span class="command"><strong>vi</strong></span> /etc/shells
        </pre><p>
        </p><pre class="literallayout"><code class="computeroutput">
          /bin/bash
          /bin/sh
          /bin/ash
          /bin/bsh
          /bin/tcsh
          /bin/csh
          /dev/null  
        </code></pre><p>
        <code class="literal">/dev/null</code>, This is our added no-existent shell. With Red Hat Linux, a special device name <code class="filename">/dev/null</code> exists for purposes such as these.
      </p></li><li class="step"><p>
        Now, edit your <code class="filename">/etc/passwd</code> file and add manually the <code class="literal">/./</code> line to divide the <code class="filename">/home/ftp</code> directory with the <code class="filename">/ftpadmin</code> 
        directory where the user <code class="literal">ftpadmin</code> should be automatically chdir'd to. This step must be done for each <code class="literal">FTP</code> user you add to your <code class="filename">passwd</code> file.
        </p><pre class="programlisting">
          ftpadmin:x:502:502::/home/ftp/ftpadmin/:/dev/null
        </pre><p>
        To read:
        </p><pre class="programlisting">
          ftpadmin:x:502:502::/home/ftp/./ftpadmin/:/dev/null
          ^^
        </pre><p>
        The account is <code class="literal">ftpadmin</code>, but you'll notice the path to the home directory is a bit odd. The first part <code class="filename">/home/ftp/</code> indicates the filesystem that should be considered their new root directory. 
        The dot <code class="literal">.</code> divides that from the directory they should be automatically chdir'd. <span class="emphasis"><em>change directory'd</em></span> into, <code class="filename">/ftpadmin/.</code>
      </p></li></ol></div><p>
      Once again, the <code class="filename">/dev/null</code> part disables their login as a regular user. With this modification, the user <code class="literal">ftpadmin</code> now has a fake shell instead of a real shell resulting in properly limited access on the system.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm22888"></a>3. Setup a chroot user environment</h2></div></div></div><p>
      What you're essentially doing is creating a skeleton root file system with enough components necessary, <span class="emphasis"><em>binaries, password files, etc.</em></span> to allow Unix to do a chroot when the user logs in. Note that if you use the 
      <code class="literal">--enable-ls</code> option during compilation as seen above, the <code class="filename">/home/ftp/bin</code>, and <code class="filename">/home/ftp/lib</code> directories are not required since this new 
      option allows Wu-ftpd to use its own <code class="literal">ls</code> function. We still continue to demonstrate the old method for people that prefer to copy <code class="filename">/bin/ls</code> to the chroot'd <code class="literal">FTP</code> 
      directory, <code class="literal">/home/ftp/bin</code> and create the appropriated library related to <code class="literal">ls</code>.
      </p><div class="mediaobject" align="center"><img src="./images/FTP-Chroot.gif" align="middle" alt="FTP chrooted"></div><p>

      The following are the necessary steps to run Wu-ftpd software in a chroot jail:
    </p><p>
      First create all the necessary chrooted environment directories as shown below:
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>mkdir</strong></span> /home/ftp/dev
        [root@deep ] /# <span class="command"><strong>mkdir</strong></span> /home/ftp/etc
        [root@deep ] /# <span class="command"><strong>mkdir</strong></span> /home/ftp/bin    <a name="ftpchr1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
        [root@deep ] /# <span class="command"><strong>mkdir</strong></span> /home/ftp/lib    <a name="ftpchr2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
      </pre><p>
      </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ftpchr1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
          Require only if you are not using the <code class="envar">--enable-ls</code> option.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ftpchr2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
          Require only if you are not using the <code class="envar">--enable-ls</code> option
        </p></td></tr></table></div><p>

    </p><p>
      Change the new directories permission to <code class="literal">0511</code> for security reasons:
      The <span class="command"><strong>chmod</strong></span> command will make our chrooted <code class="filename">dev</code>, <code class="filename">etc</code>, <code class="filename">bin</code>, and <code class="filename">lib</code> directories 
      readable and executable by the super-user <code class="literal">root</code> and executable by the user-group and all users.
      </p><pre class="screen">
    [root@deep ] /# <span class="command"><strong>chmod</strong></span> 0511 /home/ftp/dev/
    [root@deep ] /# <span class="command"><strong>chmod</strong></span> 0511 /home/ftp/etc/
    [root@deep ] /# <span class="command"><strong>chmod</strong></span> 0511 /home/ftp/bin    <a name="ftpchr3"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
    [root@deep ] /# <span class="command"><strong>chmod</strong></span> 0511 /home/ftp/lib    <a name="ftpchr4"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
</pre><p>
</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ftpchr3"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
Require only if you are not using the <code class="envar">--enable-ls</code> option.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ftpchr4"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
Require only if you are not using the <code class="envar">--enable-ls</code> option.
</p></td></tr></table></div><p>
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        Copy the <code class="literal">/bin/ls</code> binary to <code class="filename">/home/ftp/bin</code> directory and change the permission of the <code class="literal">ls</code> program to <code class="literal">0111</code>. 
        <span class="emphasis"><em>You don't want users to be able to modify the binaries</em></span>:
</p><pre class="screen">
    [root@deep ] /# <span class="command"><strong>cp</strong></span> /bin/ls /home/ftp/bin            <a name="ftpchr6"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
    [root@deep ] /# <span class="command"><strong>chmod</strong></span> 0111 /bin/ls /home/ftp/bin/ls <a name="ftpchr7"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
</pre><p>
</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ftpchr6"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
Require only if you are not using the <code class="envar">--enable-ls</code> option.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ftpchr7"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
Require only if you are not using the <code class="envar">--enable-ls</code> option.
</p></td></tr></table></div><p>
        This step is necessary only if you're not using the <code class="envar">--enable-ls</code> option during the configure time of Wu-ftpd. See the <a class="link" href="#pr6ch32sftp" title="1. chroot'd Guest FTP access">Compile and Optimize</a> section in this chapter for more information.
      </p></li><li class="step"><p>
        Find the shared library dependencies of the <code class="literal">ls</code> Linux binary program:
      </p><ol type="a" class="substeps"><li class="step"><p>
          </p><pre class="screen">
            [root@deep ] /# ldd /bin/ls <a name="ftpsc1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
          </pre><p>
          </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ftpsc1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
              Require only if you are not using the <code class="envar">--enable-ls</code> option.
            </p></td></tr></table></div><p>
          </p><pre class="literallayout"><code class="computeroutput">
            libc.so.6 =&gt; /lib/libc.so.6 (0x00125000)
            /lib/ld-linux.so.2 =7gt; /lib/ld-linux.so.2 (0x00110000)
          </code></pre><p>
          </p></li><li class="step"><p>
              Copy the shared libraries identified above to your new <code class="filename">lib</code> directory under <code class="filename">/home/ftp</code> directory:
              </p><pre class="screen">
                [root@deep ] /# <span class="command"><strong>cp</strong></span> /lib/libc.so.6 /home/ftp/lib/ <a name="ftpsc2"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
                [root@deep ] /# <span class="command"><strong>cp</strong></span> /lib/ld-linux.so.2 /home/ftp/lib/ <a name="ftpsc3"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
              </pre><p>
              </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ftpsc2"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
                  Require only if you are not using the <code class="envar">--enable-ls</code> option
                </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ftpsc3"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
                  Require only if you are not using the <code class="envar">--enable-ls</code> option
                </p></td></tr></table></div><p>
            </p></li><li class="step"><p>
              </p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
                  <span class="inlinemediaobject"><img src="./images/Caution.gif" align="middle" alt="Caution"></span>

                </h3><p>
                These library are needed to make <code class="literal">ls</code> work. Also, steps 3 and 4 above are required only if you want to use the <code class="literal">ls</code> Linux binary program instead of the <code class="envar">--enable-ls</code> option that uses 
                the new internal <code class="literal">ls</code> capability of Wu-ftpd.
                </p></div><p>
            </p></li></ol></li><li class="step"><p>
            Create your <code class="filename">/home/ftp/dev/null</code> file:
            </p><pre class="screen">
              [root@deep ] /# <span class="command"><strong>mknod</strong></span> /home/ftp/dev/null c 1 3
              [root@deep ] /# <span class="command"><strong>chmod</strong></span> 666 /home/ftp/dev/null
            </pre><p>
          </p></li><li class="step"><p>
            Copy the <code class="filename">group</code> and <code class="filename">passwd</code> files in <code class="filename">/home/ftp/etc</code> directory. This should not be the same as your real ones. For this reason, we'll remove all non <code class="literal">FTP</code> 
            users except for the super-user <code class="literal">root</code> in both of these files, <code class="filename">passwd</code> and <code class="filename">group</code>.
          </p><ol type="a" class="substeps"><li class="step"><p>
              </p><pre class="screen">
                [root@deep ] /# <span class="command"><strong>cp</strong></span> /etc/passwd /home/ftp/etc/
                [root@deep ] /# <span class="command"><strong>cp</strong></span> /etc/group /home/ftp/etc/
              </pre><p>
            </p></li><li class="step"><p>
              Edit the <code class="filename">passwd</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/home/ftp/etc/passwd</code> and delete all entries except for the super-user <code class="literal">root</code> and your allowed <code class="literal">FTP</code> users. It is very important that the <code class="filename">passwd</code> file in 
              the chroot environment has entries like:
              </p><pre class="programlisting">
                root:x:0:0:root:/:/dev/null
                ftpadmin:x:502:502::/ftpadmin/:/dev/null
              </pre><p>
            </p></li><li class="step"><p>
              </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
                <span class="inlinemediaobject"><img src="./images/Note.gif" align="middle" alt="Note"></span>
              </h3><p>
              We can notice two things here: first, the home directory for all users inside this modified <code class="filename">passwd</code> file are now changed to reflect the new chrooted <code class="literal">FTP</code> 
              directory <abbr class="abbrev">i.e.</abbr> <code class="filename">/home/ftp/./ftpadmin/</code> begins <code class="filename">/ftpadmin/</code>, and also, the name of the user's login 
              shell for the <code class="literal">root</code> account has been changed to <code class="filename">/dev/null</code>.
              </p></div><p>
            </p></li><li class="step"><p>
              Edit the <code class="filename">group</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/home/ftp/etc/group</code> and delete all entries except for the super-user <code class="literal">root</code> 
              and all your allowed <code class="literal">FTP</code> users. The <code class="filename">group</code> file should correspond to your normal group file:
              </p><pre class="programlisting">
                root:x:0:root
                ftpadmin:x:502:
              </pre><p>
            </p></li></ol></li><li class="step"><p>
            Now we must set <code class="filename">passwd</code>, and <code class="filename">group</code> files in the chroot jail directory immutable for better security.
          </p><ol type="a" class="substeps"><li class="step"><p>
              </p><pre class="screen">
                [root@deep ] /# <span class="command"><strong>cd</strong></span> /home/ftp/etc/
                [root@deep ] /# <span class="command"><strong>chattr</strong></span> +i passwd
              </pre><p>
            </p></li><li class="step"><p>
              Set the immutable bit on <code class="filename">group</code> file:
              </p><pre class="screen">
                [root@deep ] /# <span class="command"><strong>cd</strong></span> /home/ftp/etc/
                [root@deep ] /# <span class="command"><strong>chattr</strong></span> +i group
              </pre><p>
            </p></li></ol></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23080"></a>4. Configurations</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>All the configuration files required for each software described in this book has been provided by us as a gzipped file, <code class="filename">floppy.tgz</code> for your convenience. This can be downloaded from this web address: <a class="link" href="#sc24obecfrs2">http://www.openna.com/books/floppy.tgz</a>
        You can unpack this to any location on your local machine, say for example <code class="filename">/tmp</code>, assuming you have done this your directory structure will be <code class="filename">/tmp/floppy</code>. Within this floppy directory each configuration file has its own directory 
        for respective software. For example <em class="wordasword">FTP</em> configuration file are organised like this:
        </p><pre class="literallayout"><code class="computeroutput">
          total 32
          -rw-r--r--    1 harrypotter    harrypotter         419 Jun  8 13:00 Compile-Wuftpd
          -rw-------    1 harrypotter    harrypotter        1036 Jun  8 13:00 ftpaccess
          -rw-------    1 harrypotter    harrypotter         538 Jun  8 13:00 ftpconversions
          -rw-------    1 harrypotter    harrypotter          39 Jun  8 13:00 ftpgroups
          -rw-------    1 harrypotter    harrypotter         188 Jun  8 13:00 ftphosts
          -rw-------    1 harrypotter    harrypotter          79 Jun  8 13:00 ftpusers
          drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 logrotate.d/
          drwxr-xr-x    2 harrypotter    harrypotter        4096 Jun  8 13:00 pam.d/
        </code></pre><p>
        You can either cut and paste this directly if you are faithfully following our instructions from the begining or manually edit these to modify to your needs. This facility is there though as a convenience but please don't forget ultimately it will be your 
        responsibility to check, verify, <abbr class="abbrev">etc.</abbr> before you use them whether modified or as it is.
      </p></div><p>
      To run an <code class="literal">FTP</code> server, the following files are required and must be created or copied to the appropriate directories on your server.
      </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
          Copy the ftpaccess file in the <code class="filename">/etc/</code> directory.
        </p></li><li class="listitem"><p>
        Copy the ftpusers file in the <code class="filename">/etc/</code> directory.
        </p></li><li class="listitem"><p>
        Copy the ftphosts file in the <code class="filename">/etc/</code> directory.
        </p></li><li class="listitem"><p>
        Copy the ftpgroups file in the <code class="filename">/etc/</code> directory.
        </p></li><li class="listitem"><p>
        Copy the ftpconversion file in the <code class="filename">/etc/</code> directory.
        </p></li><li class="listitem"><p>
        Copy the ftp file in the <code class="filename">/etc/pam.d/</code> directory.
        </p></li><li class="listitem"><p>
        Copy the ftpd file in the <code class="filename">/etc/logrotate.d/</code> directory.
      </p></li></ol></div><p>
    </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
        <span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
      </h3><p>
        You can obtain the configuration files listed in the next sections on our <code class="filename">floppy.tgz</code> archive. Copy the following files from the decompressed 
        <code class="filename">floppy.tgz</code> archive to the appropriate places, or copy them directly from this book to the concerned file.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23132"></a>5. Configure the <code class="filename">/etc/ftphosts</code> file</h2></div></div></div><p>
      The <code class="filename">/etc/ftphosts</code> file is used to define whether users are allowed to log in from certain hosts or whether there are denied access.
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
        Create the <code class="filename">ftphosts</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/ftphosts</code> and add for example in this file the following lines:
        </p><pre class="programlisting">
          # Example host access file
          #
          # Everything after a '#' is treated as comment,
          # empty lines are ignored
          allow ftpadmin 208.164.186.1 208.164.186.2 208.164.186.4
          deny ftpadmin 208.164.186.5
        </pre><p>
        In the example below, we allow the user <code class="literal">ftpadmin</code> to connect via <code class="literal">FTP</code> from the explicitly listed addresses <code class="literal">208.164.186.1</code> <code class="literal">208.164.186.2 </code><code class="literal">208.164.186.4,</code> and 
        deny the specified <code class="literal">ftpadmin</code> user to connect from the site <code class="literal">208.164.186.5.</code>
      </p></li><li class="step"><p>
        Now, change its default permission to be <code class="literal">600</code>:
        </p><pre class="screen">
          [root@deep ] /# <span class="command"><strong>chmod</strong></span> 600 /etc/ftphosts
        </pre><p>
      </p></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm23156"></a>5.1. Configure the <code class="filename">/etc/ftpusers</code> file</h3></div></div></div><p>
        The <code class="filename">/etc/ftpusers/</code> file specifies those users that are <span class="emphasis"><em>NOT</em></span> allowed to connect to your <code class="literal">FTP</code> server.
      </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
          Create the <code class="filename">ftpusers</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/ftpusers</code> and add in this file the following users for security reasons:
          </p><pre class="programlisting">
            root
            bin
            daemon
            adm
            lp
            sync
            shutdown
            halt
            mail
            news
            uucp
            operator
            games
            nobody
          </pre><p>
        </p></li><li class="step"><p>
          Now, change its default permission to be <code class="literal">600</code>:
          </p><pre class="screen">
            [root@deep ] /# <span class="command"><strong>chmod</strong></span> 600 /etc/ftpusers
          </pre><p>
        </p></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23175"></a>6. Configure the <code class="filename">/etc/ftpconversions</code> file</h2></div></div></div><p>
      The <code class="filename">/etc/ftpconversions</code> file contains instructions that permit you to compress files on demand before the transfer.
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Edit the <code class="filename">ftpconversions</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/ftpconversions</code> and add in this file the following lines:
      </p><pre class="programlisting">
        :.Z:  :  :/bin/compress -d -c %s:T_REG|T_ASCII:O_UNCOMPRESS:UNCOMPRESS
        :   : :.Z:/bin/compress -c %s:T_REG:O_COMPRESS:COMPRESS
        :.gz: :  :/bin/gzip -cd %s:T_REG|T_ASCII:O_UNCOMPRESS:GUNZIP
        :   : :.gz:/bin/gzip -9 -c %s:T_REG:O_COMPRESS:GZIP
        :   : :.tar:/bin/tar -c -f - %s:T_REG|T_DIR:O_TAR:TAR
        :   : :.tar.Z:/bin/tar -c -Z -f - %s:T_REG|T_DIR:O_COMPRESS|O_TAR:TAR+COMPRESS
        :   : :.tar.gz:/bin/tar -c -z -f - %s:T_REG|T_DIR:O_COMPRESS|O_TAR:TAR+GZIP
        :   : :.crc:/bin/cksum %s:T_REG::CKSUM
        :   : :.md5:/bin/md5sum %s:T_REG::MD5SUM
      </pre><p>
      </p></li><li class="step"><p>
        Now, change its default permissions to be <code class="literal">600</code>:
        </p><pre class="screen">
          [root@deep ] /# <span class="command"><strong>chmod</strong></span> 600 /etc/ftpconversions
        </pre><p>
      </p></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm23192"></a>6.1. Configure the <code class="filename">/etc/pam.d/ftp</code> file</h3></div></div></div><p>
        Configure your <code class="filename">/etc/pam.d/ftp</code> file to use pam authentication by creating  the <code class="filename">/etc/pam.d/ftp</code> file and add the following lines:
        </p><pre class="programlisting">
          #%PAM-1.0
          auth       required     /lib/security/pam_listfile.so item=user sense=deny file=/etc/ftpusers onerr=succeed
          auth       required     /lib/security/pam_pwdb.so shadow nullok
          auth       required     /lib/security/pam_shells.so
          account    required     /lib/security/pam_pwdb.so
          session    required     /lib/security/pam_pwdb.so
          </pre><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23199"></a>7. Configure the <code class="filename">/etc/logrotate.d/ftpd</code> file</h2></div></div></div><p>
        Configure your <code class="filename">/etc/logrotate.d/ftpd</code> file to automatically rotate your log files each week by creating the <code class="filename">/etc/logrotate.d/ftpd</code> file and add the following lines:
        </p><pre class="programlisting">
          /var/log/xferlog {
          # ftpd doesn't handle SIGHUP properly
          nocompress
          }
        </pre><p>
        </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm23206"></a>7.1. Configure ftpd to use tcp-wrappers inetd</h3></div></div></div><p>
      Tcp-wrappers should be enabled to start and stop the ftpd server. Upon execution, inetd reads its configuration information from a configuration file which, by default, is <code class="filename">/etc/inetd.conf</code>. There 
      must be an entry for each field of the configuration file, with entries for each field separated by a tab or a space.
    </p><p>
      Edit the <code class="filename">inetd.conf</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/inetd.conf</code> and add or verify the existence of the following line:
      </p><pre class="programlisting">
        ftp     stream  tcp     nowait  root    /usr/sbin/tcpd  in.ftpd -l -a
      </pre><p>
      Update your <code class="filename">inetd.conf</code> file by sending a SIGHUP signal, <span class="command"><strong>killall</strong></span> <em class="parameter"><code>-HUP</code></em> inetd, after adding the above line in the file.
      </p><pre class="screen">
        [root@deep ] /# killall -HUP inetd
      </pre><p>
    </p><p>
      Edit the <code class="filename">hosts.allow</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/hosts.allow</code> and add, for example, the following line:
      </p><pre class="programlisting">
        in.ftpd: 192.168.1.4 win.openna.com
      </pre><p>
      Which means client <acronym class="acronym">IP</acronym> <code class="literal">192.168.1.4</code> with host name <code class="literal">win.openna.com</code> is allowed to <code class="literal">FTP</code> on to the server.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23228"></a>8. <acronym class="acronym">FTP</acronym> Administrative Tools</h2></div></div></div><p><b>ftpwho. </b>
        The ftpwho program utility displays all active ftp users, and their current process information on the system. The output of the command is in the format of the <em class="parameter"><code>/bin/ps</code></em> command. The format of this command is:
      </p><p>
      To displays all active ftp users and their current process, use the following command:
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>ftpwho</strong></span>
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        Service class openna:
        5443 ?        S      0:00 ftpd: win.openna.com: ftpadmin: IDLE
        -   1 users ( 20 maximum)
      </code></pre><p>
      Here, you can see that one user is logged in, 20 users are allowed to be connected, and this user has the username <code class="literal">ftpadmin</code> who claims to be from <code class="literal">win.openna.com</code>.
    </p><p><b>ftpcount. </b>
        The ftpcount program utility, which is a simplified version of ftpwho, shows only the current number of users logged in to the system, and the maximum number of users allowed.
      </p><p>
      To shows only the current number of users logged in to the system and the maximum number of users allowed, use the following command:
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>ftpcount</strong></span>
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        Service class openna             -   1 users ( 20 maximum)
      </code></pre><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23250"></a>9. Securing <code class="literal">FTP</code></h2></div></div></div><p><b>The ftpusers file. </b>
        It's important to ensure that you have set up the file <code class="filename">/etc/ftpusers</code> which specifies those users that are NOT allowed to connect to your <code class="literal">FTP</code> server. This should include, as a MINIMUM, the following 
        entries: <code class="literal">root</code>, bin, daemon, adm, lp, sync, shutdown, halt, mail, news, uucp, operator, games, nobody and ALL other default vendor supplied accounts available in your <code class="filename">/etc/passwd</code> file.
      </p><p><b>The anonymous <code class="literal">FTP</code> program. </b>
        To disable anonymous <code class="literal">FTP</code>, remove the anonymous user <code class="literal">ftp</code> from your password file and verify that anonftp-version.i386.rpm package is not installed on your system.
      </p><p>
      To remove the user <code class="literal">ftp</code> from your password file, use the following command:
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>userdel</strong></span> ftp
      </pre><p>
      To verify that the <acronym class="acronym">RPM</acronym> package of anonymous <code class="literal">FTP</code> program is not installed on your Linux system, use the following command:
      </p><pre class="screen">
        [root@deep ] /# <span class="command"><strong>rpm</strong></span> -q anonftp
      </pre><p>
      </p><pre class="literallayout"><code class="computeroutput">
        package anonftp is not installed
      </code></pre><p>
    </p><p><b>The upload command. </b>
        By default, the Wu-ftpd server will grant upload privileges to all users. The upload parameter allow remote clients to load and place files on the <code class="literal">FTP</code> server. For optimal security, we don't want users being able to 
        upload into <code class="filename">bin</code>, <code class="filename">etc</code>, <code class="filename">dev</code>, and <code class="filename">lib</code> subdirectories in the <code class="filename">/home/ftp</code> 
        directory. In our <code class="filename">/etc/ftpaccess</code> file we have already chroot'd users to <code class="filename">/home/ftp</code> and they cannot access any area of the filesystem outside that directory structure, but in case something 
        happens to the permissions on them you should deny upload privileges in your <code class="filename">/etc/ftpaccess</code> file into these areas; <code class="filename">/home/ftp/</code>, <code class="filename">/home/ftp/bin</code>, 
        <code class="filename">/home/ftp/etc</code>, <code class="filename">/home/ftp/dev</code>, and <code class="filename">/home/ftp/lib</code>.
      </p><p>
      Edit the <code class="filename">ftpaccess</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/ftpaccess</code> and add the following lines to deny upload privileges into these areas.
      </p><pre class="programlisting">
        # We don't want users being able to upload into these areas.
        upload /home/ftp/* /    no
        upload /home/ftp/* /etc no
        upload /home/ftp/* /dev no
        upload /home/ftp/* /bin no   <a name="ftacss1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
        upload /home/ftp/* /lib no   <a name="ftacss2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
      </pre><p>
      </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ftacss1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
Require only if you are not using the <em class="parameter"><code>--enable-ls</code></em> option.        
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ftacss2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
Require only if you are not using the <em class="parameter"><code>--enable-ls</code></em> option.      
      </p></td></tr></table></div><p>
      The above lines specify to deny upload into the <code class="filename">/</code>, <code class="filename">/etc</code>, <code class="filename">/dev</code>, <code class="filename">/bin</code> and <code class="filename">/lib</code> 
      directories of the chroot'd <code class="filename">/home/ftp</code> directory structure.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23313"></a>10. The special file <code class="filename">.notar</code></h2></div></div></div><p>
      Whether you allow on-the-fly tarring of directories or not, you should make sure an end-run cannot be made using tar command in all areas where the upload parameter is not permit.
      To do so, create the special file <code class="filename">.notar</code> in each directory and in the <code class="literal">FTP</code> directory.
      </p><pre class="screen">
      [root@deep ] /# <span class="command"><strong>touch</strong></span> /home/ftp/.notar
      [root@deep ] /# <span class="command"><strong>touch</strong></span> /home/ftp/etc/.notar
      [root@deep ] /# <span class="command"><strong>touch</strong></span> /home/ftp/dev/.notar
      [root@deep ] /# <span class="command"><strong>touch</strong></span> /home/ftp/bin/.notar   <a name="ftpntr1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
      [root@deep ] /# <span class="command"><strong>touch</strong></span> /home/ftp/lib/.notar   <a name="ftpntr2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
      [root@deep ] /# <span class="command"><strong>chmod</strong></span> 0 /home/ftp/.notar
      [root@deep ] /# <span class="command"><strong>chmod</strong></span> 0 /home/ftp/etc/.notar
      [root@deep ] /# <span class="command"><strong>chmod</strong></span> 0 /home/ftp/dev/.notar
      [root@deep ] /# <span class="command"><strong>chmod</strong></span> 0 /home/ftp/bin/.notar <a name="ftpntr3"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
      [root@deep ] /# <span class="command"><strong>chmod</strong></span> 0 /home/ftp/lib/.notar <a name="ftpntr4"></a><span><img src="images/callouts/4.png" alt="4" border="0"></span>
      </pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ftpntr1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
        Require only if you are not using the <em class="parameter"><code>--enable-ls</code></em> option.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ftpntr2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
        Require only if you are not using the <em class="parameter"><code>--enable-ls</code></em> option.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ftpntr3"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>
        Require only if you are not using the <em class="parameter"><code>--enable-ls</code></em> option.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ftpntr4"><span><img src="images/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>
        Require only if you are not using the <em class="parameter"><code>--enable-ls</code></em> option.
      </p></td></tr></table></div><p>
      The zero-length <code class="filename">.notar</code> file can confuse some web clients and <code class="literal">FTP</code> proxies, so let's mark it irretrievable to solve the problem. Add the following lines to your <code class="filename">/etc/ftpaccess</code> file.
      </p><pre class="programlisting">
        noretrieve .notar
      </pre><p>
    </p><p><b>The noretrieve command. </b>
      The noretrieve parameter of Wu-ftpd server allow you to deny transfer of the sectected directories or files. It is also a good idea to prevent downloads of those subdirectories <code class="filename">bin</code>, <code class="filename">etc</code>, 
      <code class="filename">dev</code>, and <code class="filename">lib</code> in the <code class="filename">/home/ftp</code> directory with the command <span class="command"><strong>noretrieve</strong></span> in your <code class="filename">/etc/ftpaccess</code> file.
      </p><pre class="programlisting">
        # We'll prevent downloads with noretrieve.
        noretrieve /home/ftp/etc
        noretrieve /home/ftp/dev
        noretrieve /home/ftp/bin  <a name="ftpntrv1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
        noretrieve /home/ftp/lib  <a name="ftpntrv2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
      </pre><p>
      </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ftpntrv1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>
          Require only if you are not using the <em class="parameter"><code>--enable-ls</code></em> option.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ftpntrv2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>
          Require only if you are not using the <em class="parameter"><code>--enable-ls</code></em> option.
        </p></td></tr></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23372"></a>11. Installed files</h2></div></div></div><p>
        These are the files installed on your system:
      </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/pam.d/ftp</code></td><td><code class="filename">/etc/logrotate.d/ftpd</code></td></tr><tr><td><code class="filename">/etc/ftpaccess</code></td><td><code class="filename">/etc/ftpconversions</code></td></tr><tr><td><code class="filename">/etc/ftpgroups</code></td><td><code class="filename">/etc/ftphosts</code></td></tr><tr><td><code class="filename">/etc/ftpusers</code></td><td><code class="filename">/home/ftp/</code></td></tr><tr><td><code class="filename">/usr/bin/ftpcount</code></td><td><code class="filename">/usr/bin/ftpwho</code></td></tr><tr><td><code class="filename">/usr/man/man1/ftpcount.1</code></td><td><code class="filename">/usr/man/man1/ftpwho.1</code></td></tr><tr><td><code class="filename">/usr/man/man5/ftpaccess.5</code></td><td><code class="filename">/usr/man/man5/ftphosts.5</code></td></tr><tr><td><code class="filename">/usr/man/man5/ftpconversions.5</code></td><td><code class="filename">/usr/man/man5/xferlog.5</code></td></tr><tr><td><code class="filename">/usr/man/man8/ftpd.8</code></td><td><code class="filename">/usr/man/man8/ftpshut.8</code></td></tr><tr><td><code class="filename">/usr/man/man8/ftprestart.8</code></td><td><code class="filename">/usr/sbin/in.ftpd</code></td></tr><tr><td><code class="filename">/usr/sbin/ftpshut</code></td><td><code class="filename">/usr/sbin/ckconfig</code></td></tr><tr><td><code class="filename">/usr/sbin/ftprestart</code></td><td><code class="filename">/usr/sbin/xferstats</code></td></tr><tr><td><code class="filename">/usr/sbin/wu.ftpd</code></td><td><code class="filename">/usr/sbin/in.wuftpd</code></td></tr><tr><td><code class="filename">/var/log/xferlog</code></td><td> </td></tr></table></div></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="idm23430"></a>Part 7. Backup and Restore</h1></div></div></div><div class="partintro"><div></div><div class="mediaobject" align="center"><img src="./resources/Annimals/Chapter19-20.gif" align="middle" alt="hen, cock!"></div><div class="abstract"><p class="title"><b>Abstract</b></p><p>
    A secure and reliable server is closely related to performing regular backups. Failures will probably occur sometimes. They may be caused by attacks, hardware failure, human error, power outages, etc. The safest method of doing backups 
    is to record them in a location separate from your Linux system like over a network, from tape, removable drive, writable CD-ROM, etc.
</p></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="chapter"><a href="#idm23440">33. Why's and When's of Backup and Restore</a></span></dt><dd><dl><dt><span class="section"><a href="#idm23450">1. What to backup</a></span></dt><dt><span class="section"><a href="#idm23462">2. The tar backup program</a></span></dt><dt><span class="section"><a href="#idm23611">3. Automating backups with <span class="command"><strong>tar</strong></span></a></span></dt><dt><span class="section"><a href="#idm23684">4. Restore files with <span class="command"><strong>tar</strong></span></a></span></dt><dt><span class="section"><a href="#idm23747">5. The dump backup program</a></span></dt><dt><span class="section"><a href="#idm23825">6. Making backups with dump</a></span></dt><dt><span class="section"><a href="#idm23976">7. Restoring files with dump</a></span></dt><dt><span class="section"><a href="#idm24060">8. Backing up and restoring over the network</a></span></dt><dd><dl><dt><span class="section"><a href="#idm24088">8.1. Using the scp SSH command </a></span></dt></dl></dd></dl></dd></dl></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="idm23440"></a>Chapter 33. Why's and When's of Backup and Restore</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#idm23450">1. What to backup</a></span></dt><dt><span class="section"><a href="#idm23462">2. The tar backup program</a></span></dt><dt><span class="section"><a href="#idm23611">3. Automating backups with <span class="command"><strong>tar</strong></span></a></span></dt><dt><span class="section"><a href="#idm23684">4. Restore files with <span class="command"><strong>tar</strong></span></a></span></dt><dt><span class="section"><a href="#idm23747">5. The dump backup program</a></span></dt><dt><span class="section"><a href="#idm23825">6. Making backups with dump</a></span></dt><dt><span class="section"><a href="#idm23976">7. Restoring files with dump</a></span></dt><dt><span class="section"><a href="#idm24060">8. Backing up and restoring over the network</a></span></dt><dd><dl><dt><span class="section"><a href="#idm24088">8.1. Using the scp SSH command </a></span></dt></dl></dd></dl></div><div class="highlights"><p>
Many methods of performing backups with Linux exist, such as dump, tar, cpio, as well as dd that are each available by default on your Linux system. Also available are text-based utilities, such as Amanda, which is designed to add a friendlier 
user interface to the backup and restore procedures. Finally, commercial backup utilities are also available, such as BRU.
</p><p>
The procedures for performing a backup and restore will differ depending on your choice of a backup solution. For this reason we will discuss methods for performing backups with the traditional UNIX tools: 
</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
tar
</p></li><li class="listitem"><p>
dump which is a command-line backup tool.
</p></li></ol></div><p>
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23450"></a>1. What to backup</h2></div></div></div><p>
The idea of making a backup is to back up as much as possible on your system, but some exceptions do exist as shown below. It is not logical to include these in your backup at the cost of time and space in your media for nothing.
The major exceptions to not include in your backup are:
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
The <code class="filename">/proc</code> file system: since it only contains data that the kernel generates automatically, it is never a good idea to back it up.
</p></li><li class="listitem"><p>
The <code class="filename">/mnt</code> file system, because it is where you mount your removable media like CD-ROM, floppy disk and other.
</p></li></ul></div><p>
</p><p>
The backup directory or media where you have placed your backup files, such as a tape, CD-ROM, NFS mounted file system, remote/local directory or other kind of media.
Software that can be easily reinstalled, though they may have configuration files that  are important to back up, lest you do all the work to configure them all over again. I will recommend putting them. <span class="emphasis"><em>the configuration files for software</em></span> on the floppy disk.
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23462"></a>2. The tar backup program</h2></div></div></div><p>
The tar backup program is an archiving program designed to store and extract files from an archive file known as a tarfile. A tarfile may be made on a tape drive; however, it is also common to write a tarfile to a normal file.
</p><p>
A simple backup is when you decide to make a backup of files on your system you must choose a backup scheme before the beginning of your backup procedure. A lot of strategic backup schemes exist, and depend on the backup policies you 
want to use. In the following, We have shown you one backup scheme that you may use which takes advantage of the tar program's capabilities. This scheme is to first back up everything once, then back up everything that has been modified 
since the previous backup. 
</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
The first backup is called a full backup
</p></li><li class="listitem"><p>
The subsequent ones are incremental backups.
</p></li></ol></div><p>
</p><p>
With six tapes you can make backups every day; The procedure is to use tape 1 for the first full backup <span class="emphasis"><em>Friday 1</em></span>, and tapes 2 to 5 for the incremental backups <span class="emphasis"><em>Monday through Thursday</em></span>. Then, you make a new full backup 
on tape 6 <span class="emphasis"><em>second Friday</em></span>, and start doing incremental ones with tapes 2 to 5 again. It's important to keep tape 1 at its state until you've got a new full backup with tape 6. 
</p><p>
In the following example below, we assume that we write the backup to a <acronym class="acronym">SCSI</acronym> tape drive named <code class="filename">/dev/st0,</code> and we backup the home directory <code class="filename">/home</code> of 
our system. First of all, we must to move to the file system <code class="filename">/</code> partition. When creating an archive file, tar will strip leading <code class="literal">/</code> <span class="emphasis"><em>slash</em></span> characters from file path names. This 
means that restored files may not end up in the same locations they were backed up from. Therefore, to solve the problem, the solution is to change to the <code class="filename">/</code> root directory before making all backups and 
restorations.
</p><p>
To move to the <code class="filename">/</code> root directory, use the command:
</p><pre class="screen">
[root@deep]# <span class="command"><strong>cd</strong></span> /
</pre><p>

It is important to always start with a full backup; <span class="emphasis"><em>say on a Friday</em></span>, for example:
</p><p><b>Friday 1. </b>
use tape 1 for the first full backup.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /
[root@deep] /# <span class="command"><strong>tar</strong></span> cpf /dev/st0 --label=" full-backup created on `date '+%d-%B-%Y'`." \
     	 --directory / home
</pre><p>
</p><p><b>Monday. </b>
use tapes 2 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /
[root@deep] /# <span class="command"><strong>tar</strong></span> cpNf /dev/st0 --label=" full-backup created on `date '+%d-%B-%Y'`." \
     	 --directory / home
</pre><p>
</p><p><b>Tuesday. </b>
use tapes 3 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /
[root@deep] /# <span class="command"><strong>tar</strong></span> cpNf /dev/st0 --label=" full-backup created on `date '+%d-%B-%Y'`." \
     	 --directory / home
</pre><p>
</p><p><b>Wednesday. </b>
use tapes 4 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /
[root@deep] /# <span class="command"><strong>tar</strong></span> cpNf /dev/st0 --label=" full-backup created on `date '+%d-%B-%Y'`." \
     	 --directory / home
</pre><p>
</p><p><b>Thursday. </b>
use tapes 5 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /
[root@deep] /# <span class="command"><strong>tar</strong></span> cpNf /dev/st0 --label=" full-backup created on `date '+%d-%B-%Y'`." \
     	 --directory / home
</pre><p>
</p><p><b>Friday 2. </b>
use tape 6 for the new full backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /
[root@deep] /# <span class="command"><strong>tar</strong></span>  cpf /dev/st0 --label=" full-backup created on `date '+%d-%B-%Y'`." \
     	 --directory / home
</pre><p>
</p><p>
Now, start doing incremental ones with tapes 2 to 5 again and so on.

</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      The <code class="literal">c</code> option specifies that an archive file is begin created.
</p></li><li class="listitem"><p>
The <code class="literal">p</code> option preserves permissions; file protection information will be <span class="emphasis"><em>remembered</em></span>.
</p></li><li class="listitem"><p>
The <code class="literal">N</code> option does an incremental backup and only stores files newer than DATE.
</p></li><li class="listitem"><p>
The <code class="literal">f</code> option states that the very next argument will be the name of the archive file or device being written.
</p></li></ul></div><p>
</p><p>
Notice how a filename, which contains the current date, is derived, simply by enclosing the <code class="literal">date</code> command between two back-quote characters. A common naming convention is to add a <code class="literal">tar</code> suffix for non-compressed 
archives, and a <code class="literal">tar.gz</code> suffix for compressed ones. Since we aren't able to specify a filename for the backup set, the  <code class="literal">--label</code> option can be used to write some information about the backup set into the 
archive file itself. Finally, only the files contained in the <code class="filename">/home</code> are written to the tape.
</p><p>
Because the tape drive is a character device, it is not possible to specify an actual file name. Therefore, the file name used as an argument to <code class="literal">tar</code> is simply the name of the 
device, <code class="filename">/dev/st0</code>, the first tape device. The <code class="filename">/dev/st0</code> device does not rewind after the backup set is written. Therefore it is possible to write multiple 
sets on one tape. You may also refer to the device as <code class="filename">/dev/st0</code>, in which case the tape is automatically rewound after the backup set is written. When working with tapes you 
can use the following commands to rewind and eject your tape:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>mt</strong></span> -f  /dev/st0 rewind
[root@deep] /# <span class="command"><strong>mt</strong></span> -f  /dev/st0 offline
</pre><p>
</p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Caution.gif" alt="Caution"></span>
</h3><p>
To reduce the space needed on a <code class="literal">tar</code> archive, the backups can be compressed with the <code class="literal">z</code> option of <span class="command"><strong>tar</strong></span> program. Unfortunately, using this option to compress backups can cause trouble. Due to 
the nature of how compression works, if a single bit in the compressed backup is wrong, all the rest of the compressed data will be lost. It's recommended to NOT using compression, the <code class="literal">z</code> option to make backups with the <span class="command"><strong>tar</strong></span> command.
</p></div><p>
If your backup doesn't fit on one tape, you'll need to use the  <code class="literal">--multi-volume</code>  <code class="literal">-M</code> option:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /
[root@deep] /# <span class="command"><strong>tar</strong></span> cMpf /dev/st0 /home
</pre><p>
Prepare volume #2 for <code class="filename">/dev/st0</code> and hit return:
</p><p>
After you have made a backup, you should check that it is OK, using the <code class="literal">--compare</code> <code class="literal">-d</code> option as shown below:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /
[root@deep] /# <span class="command"><strong>tar</strong></span> dvf /dev/st0
</pre><p>
</p><p>
To perform a backup of your entire system, use the following command:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /
[root@deep] /# <span class="command"><strong>tar</strong></span>  cpf /archive/full-backup-`date '+%d-%B-%Y'`.<span class="command"><strong>tar</strong></span> \
 --directory / --exclude=proc --exclude=mnt --exclude=archive \
 --exclude=cache --exclude=*/lost+found .
</pre><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
The  <code class="literal">--directory</code> option tells <span class="command"><strong>tar</strong></span> to first switch to the following directory path, the <code class="filename">/</code> directory in this example, prior to starting the backup. 
</p></li><li class="listitem"><p>
The  <code class="literal">--exclude</code> options tells <span class="command"><strong>tar</strong></span> not to bother backing up the specified directories or files. 
</p></li><li class="listitem"><p>
The <code class="literal">.</code> character at the end of the command tells <span class="command"><strong>tar</strong></span> that it should back up everything in the current directory.
</p></li></ul></div><p>
</p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Caution.gif" alt="Caution"></span>
</h3><p>
When backing up your file systems, do not include the <code class="filename">/proc</code> pseudo-file-system! The files in <code class="filename">/proc</code> are not actually files but are simply file-like links which describe 
and point to kernel data structures. Also, do not include the <code class="filename">/mnt</code>, <code class="filename">/archive</code>, and all <code class="filename">lost+found</code> directories.
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23611"></a>3. Automating backups with <span class="command"><strong>tar</strong></span></h2></div></div></div><p>
It is always interesting to automate the tasks of a backup. Automation offers enormous opportunities for using your Linux server to achieve the goals you set. The following example below is our backup 
script, called <code class="filename">backup.cron.</code> This script is designed to run on any computer by changing only the four variables: 
</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
COMPUTER
</p></li><li class="listitem"><p>
DIRECTORIES
</p></li><li class="listitem"><p>
BACKUPDIR
</p></li><li class="listitem"><p>
TIMEDIR 
</p></li></ol></div><p>
</p><p>
We suggest that you set this script up and run it at the beginning of the month for the first time, and then run it for a month before making major changes. In our example below we do the backup to a directory on 
the local server BACKUPDIR, but you could modify this script to do it to a tape on the local server or via an <acronym class="acronym">NFS</acronym> mounted file system.
</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
Create the backup script <code class="filename">backup.cron</code> file, <span class="command"><strong>touch</strong></span> <code class="filename">/etc/cron.daily/backup.cron</code> and add the following lines to this backup file:
</p><pre class="programlisting">
#!/bin/sh
# full and incremental backup script
# created 07 February 2000
# Based on a script by Daniel O'Callaghan &lt;danny@freebsd.org&gt;
# and modified by Gerhard Mourani &lt;gmourani@videotron.ca&gt;

#Change the 5 variables below to fit your computer/backup

COMPUTER=deep                           	# name of this computer
DIRECTORIES="/home"                     	# directoris to backup
BACKUPDIR=/backups                      	# where to store the backups
TIMEDIR=/backups/last-full              	# where to store time of full backup
TAR=/bin/tar                            		# name and locaction of tar

#You should not have to change anything below here

PATH=/usr/local/bin:/usr/bin:/bin
DOW=`date +%a`              		# Day of the week e.g. Mon
DOM=`date +%d`              		# Date of the Month e.g. 27
DM=`date +%d%b`             	# Date and Month e.g. 27Sep

# On the 1st of the month a permanet full backup is made
# Every Sunday a full backup is made - overwriting last Sundays backup
# The rest of the time an incremental backup is made. Each incremental
# backup overwrites last weeks incremental backup of the same name.
#
# if NEWER = "", then tar backs up all files in the directories
# otherwise it backs up files newer than the NEWER date. NEWER
# gets it date from the file written every Sunday.


# Monthly full backup
if [ $DOM = "01" ]; then
        NEWER=""
        $TAR $NEWER -cf $BACKUPDIR/$COMPUTER-$DM.tar $DIRECTORIES
fi

# Weekly full backup
if [ $DOW = "Sun" ]; then
        NEWER=""
        NOW=`date +%d-%b`

        # Update full backup date
        echo $NOW &gt; $TIMEDIR/$COMPUTER-full-date
        $TAR $NEWER -cf $BACKUPDIR/$COMPUTER-$DOW.tar $DIRECTORIES

# Make incremental backup - overwrite last weeks
else

        # Get date of last full backup
        NEWER="--newer `cat $TIMEDIR/$COMPUTER-full-date`"
        $TAR $NEWER -cf $BACKUPDIR/$COMPUTER-$DOW.tar $DIRECTORIES
fi
</pre><p>
</p><div class="example"><a name="idm23634"></a><p class="title"><b>Example 33.1. Backup directory of a week</b></p><div class="example-contents"><p>
Here is an abbreviated look of the backup directory after one week:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>ls</strong></span> -l /backups/
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
total 22217
-rw-r--r--   	1 root     root     	 10731288 	Feb  7 11:24 deep-01Feb.<span class="command"><strong>tar</strong></span>
-rw-r--r--   	1 root     root            	6879 	Feb  7 11:24 deep-Fri.<span class="command"><strong>tar</strong></span>
-rw-r--r--   	1 root     root         	2831 	Feb  7 11:24 deep-Mon.<span class="command"><strong>tar</strong></span>
-rw-r--r--   	1 root     root            	7924 	Feb  7 11:25 deep-Sat.<span class="command"><strong>tar</strong></span>
-rw-r--r--   	1 root     root     	 11923013 	Feb  7 11:24 deep-Sun.<span class="command"><strong>tar</strong></span>
-rw-r--r--   	1 root     root            	5643 	Feb  7 11:25 deep-Thu.<span class="command"><strong>tar</strong></span>
-rw-r--r--   	1 root     root            	3152 	Feb  7 11:25 deep-Tue.<span class="command"><strong>tar</strong></span>
-rw-r--r--   	1 root     root            	4567 	Feb  7 11:25 deep-Wed.<span class="command"><strong>tar</strong></span>
drwxr-xr-x	2 root     root         	1024 	Feb  7 11:20 last-full
</code></pre><p>
</p></div></div><p><br class="example-break">
</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
The directory where to store the backups <code class="filename">BACKUPDIR</code>, and the directory where to store time of full backup <code class="filename">TIMEDIR</code> must exist or be created before 
the use of the backup-script, or you will receive an error message.
</p></div><p>
</p></li><li class="step"><p>
If you are not running this backup script from the beginning of the month <span class="emphasis"><em>01-month-year</em></span>, the incremental backups will need the time of the Sunday backup to be able to work properly. If you start in the 
middle of the week, you will need to create the time file in the <code class="filename">TIMEDIR</code>.
To create the time file in the <code class="filename">TIMEDIR</code> directory, use the following command:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>date</strong></span> +%d%b &lt; /backups/last-full/myserver-full-date
</pre><p>
Where <code class="envar">/backups/last-full</code> is our variable TIMEDIR wherein we want to store the time of the full backup, and <code class="envar">myserver-full-date</code> is the name of our server e.g. <code class="literal">deep</code>, and our time 
file consists of a single line with the present date i.e. 15-Feb.
</p></li><li class="step"><p>
Make this script executable and change its default permissions to be writable only by the super-user <code class="literal">root</code> <code class="literal">755</code>.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>chmod</strong></span> 755 /etc/cron.daily/backup.cron
</pre><p>
</p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><span class="inlinemediaobject"><img src="./images/Note.gif" alt="Note"></span></h3><p>
Because this script is in the <code class="filename">/etc/cron.daily</code> directory, it will be automatically run as a cron job at one o'clock in the morning every day.
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23684"></a>4. Restore files with <span class="command"><strong>tar</strong></span></h2></div></div></div><p>
More important than performing regular backups is having them available when we need to recover important files! In this section, we will discuss methods for restoring files, which have been backed up with <span class="command"><strong>tar</strong></span> command.
</p><p>
The following command will restore all files from the <code class="literal">full-backup-Day-Month-Year.tar</code> archive, which is an example backup of our <code class="filename">home</code> directory created from the 
example <span class="command"><strong>tar</strong></span> commands shown above.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /
[root@deep] /# <span class="command"><strong>tar</strong></span> xpf /dev/st0/full-backup-Day-Month-Year.<span class="command"><strong>tar</strong></span>
</pre><p>
The above command extracts all files contained in the compressed archive, preserving original file ownership and permissions.
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
The   x option stands for extract.
</p></li><li class="listitem"><p>
The <code class="literal">p</code> option preserve permissions; file protection information will be <span class="emphasis"><em>remembered.</em></span>
</p></li><li class="listitem"><p>
The <code class="literal">f</code> option states that the very next argument will be the name of the archive file or device.
</p></li></ul></div><p>
</p><p>
If you do not need to restore all the files contained in the archive, you can specify one or more files that you wish to restore:

To specify one or more files that you wish to restore, use the following command:
</p><pre class="screen">
[root@deep]# <span class="command"><strong>cd</strong></span> /
[root@deep]# <span class="command"><strong>tar</strong></span> xpf /dev/st0/full-backup-Day-Month-Year.<span class="command"><strong>tar</strong></span> \
 home/wahib/Personal/Contents.doc home/quota.user
 </pre><p>

The above command restores the <code class="filename">/home/wahib/Personal/Contents.doc</code> and <code class="filename">/home/quota.user</code> files from the archive.

</p><p>
If you just want to see what files are in the backup volume, Use the <code class="literal">--list</code> or <code class="literal">-t</code> option:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>tar</strong></span> tf /dev/st0
</pre><p>
</p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Caution.gif" alt="Caution"></span>
</h3><p>
If you have files on your system set with the immutable bit, using the <span class="command"><strong>chattr</strong></span> command, these files will not be remembered with the immutable bit from your restored backup. You must reset it immutable with the 
command <span class="command"><strong>chattr</strong></span>  +i after the backup is completed.
</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Test the ability to recover</h3><div class="mediaobject"><img src="./images/Note.gif" alt="Note"></div><p>
Dont forget to test the ability to recover from backups, for many system administrators, recovering a file from a backup is an uncommon activity. This step assures that if you need to recover a file, the tools and processes will work. Performing 
this test periodically will help you to discover problems with the backup procedures so you can correct them before losing data. Some backup restoration software does not accurately recover the correct file protection and file ownership controls. 
Check the attributes of restored files to ensure they are being set correctly. Periodically test to ensure that you can perform a full system recovery from your backups.
</p></div><p>
Further documentation, for more details, there is man page you can read:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></span></dt><dd><p>
- The GNU version of the <span class="command"><strong>tar</strong></span> archiving utility
</p></dd></dl></div><p>
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23747"></a>5. The dump backup program</h2></div></div></div><p>
Dump is completely different from <span class="command"><strong>tar</strong></span>, it is a program for backing up and restoring file system. It backups up the entire file system - not the files. Dump does not care what file system is on the hard drive, or 
even if there are files in the file system. It examines files on an ext2 file system, determines which ones need to be backed up, and copies those files to a specified disk, tape, file or other storage medium. It dumps one file 
system at a time quickly and efficiently. Unfortunately, it does not do individual directories, and so it eats up a great deal more storage space than <span class="command"><strong>tar</strong></span>. It is also written specifically for backups. 
</p><p>
The restore command performs the inverse function of dump, It can restore a full backup of a file system. Subsequent incremental backups can then be layered on top of the full backup. Single files and directory sub trees may 
also be restored from full or partial backups. You can use dump if you need a procedure for both backing up file systems and restoring file systems after backups.
</p><p>
Dump has several levels of backup procedures. The levels range from 0 to 9, where level number 0 means a full backup and guarantees the entire file system is copied. A level number above 0, incremental backup, tells dump to copy 
all files new or modified since the last dump of the same or lower level. To be more precise, at each incremental backup level you back up everything that has changed since the previous backup at the same or a previous level. 
</p><p>
What are the advantages and the reasons to create and use several levels to make a backup? I try to explain it with the following schemas:
</p><pre class="literallayout">

0	3	2	5	4	7	6	9	8	9
|	|	|	|	|	|	|	|	|	|
0 means a full backup.	|	|	|
	|	|	|	|	|	|	|	|	|
       3 means copy all files new or modified since level 0, and 3.
	|	|	|	|	|	|	|	|
          2 means copy all files new or modified since level 0, and 2.
	        |	|	|	|	|	|	|
                5 means copy all files new or modified since level 0, 3, and 5.
	                |	|	|	|	|	|
                   4 means copy all files new or modified since level 0, 3, and 4.
	                |	|	|	|	|
                      7 means copy all files new or modified since level 0, 3, 4, and 7.
	                |	|	|	|
                        6 means copy all files new or modified since level 0, 3, 4, and 6.
	                |	|	|
                           9 means copy all files new or modified since level 0, 3, 4, 6, and 9.
	                        |	|
                              8 means copy all files new or modified since level 0, 3, 4, 6, and 8.
	                        |
                                9 means copy all files new or modified since level 0, 3, 4, 6, 8, and 9.

</pre><p>
</p><p>
The advantages and reasons for doing this are that with multiple levels, the backup history can be extended more cheaply. A longer backup history is useful, since deleted or corrupted files are often not noticed for a 
long time. Even a version of a file that is not very up to date is better than no file at all. Also, backup levels are used to keep both the backup and restore times to a minimum -<span class="emphasis"><em>low</em></span>.
</p><p>
The dump manual page suggests a good scheme to take the full advantage of backup levels: 3, 2, 5, 4, 7, 6, 9, 8, 9, etc as described by the table below. The most you have to backup is two day's worth of work. The number 
of tapes for a restore depends on how long you keep between full backups.
</p><div class="table"><a name="idm23759"></a><p class="title"><b>Table 33.1. Dump scheme</b></p><div class="table-contents"><table class="table" summary="Dump scheme" width="100%" border="1"><colgroup><col width="1inch" align="center" class="clnm1"><col width="1inch" align="center" class="clnm2"><col width="1inch" align="center" class="clnm3"><col width="1inch" align="center" class="clnm4"></colgroup><thead valign="middle"><tr><th align="center" valign="middle">Tape</th><th align="center" valign="middle">Level</th><th align="center" valign="middle">Backup <span class="emphasis"><em>days</em></span></th><th align="center" valign="middle">Restore tapes</th></tr></thead><tbody valign="middle"><tr><td align="center" valign="middle">1</td><td align="center" valign="middle">0</td><td align="center" valign="middle"><abbr class="abbrev">N.A.</abbr></td><td align="center" valign="middle">1</td></tr><tr><td align="center" valign="middle">2</td><td align="center" valign="middle">3</td><td align="center" valign="middle">1</td><td align="center" valign="middle">1, 2</td></tr><tr><td align="center" valign="middle">3</td><td align="center" valign="middle">2</td><td align="center" valign="middle">2</td><td align="center" valign="middle">1, 3</td></tr><tr><td align="center" valign="middle">4</td><td align="center" valign="middle">5</td><td align="center" valign="middle">1</td><td align="center" valign="middle">1, 2, 4</td></tr><tr><td align="center" valign="middle">5</td><td align="center" valign="middle">4</td><td align="center" valign="middle">2</td><td align="center" valign="middle">1, 2, 5</td></tr><tr><td align="center" valign="middle">6</td><td align="center" valign="middle">7</td><td align="center" valign="middle">1</td><td align="center" valign="middle">1, 2, 5, 6</td></tr><tr><td align="center" valign="middle">7</td><td align="center" valign="middle">6</td><td align="center" valign="middle">2</td><td align="center" valign="middle">1, 2, 5, 7</td></tr><tr><td align="center" valign="middle">8</td><td align="center" valign="middle">9</td><td align="center" valign="middle">1</td><td align="center" valign="middle">1, 2, 5, 7, 8</td></tr><tr><td align="center" valign="middle">9</td><td align="center" valign="middle">8</td><td align="center" valign="middle">2</td><td align="center" valign="middle">1, 2, 5, 7, 9</td></tr><tr><td align="center" valign="middle">10</td><td align="center" valign="middle">9</td><td align="center" valign="middle">1</td><td align="center" valign="middle">1, 2, 5, 7, 9, 10</td></tr></tbody></table></div></div><p><br class="table-break">
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23825"></a>6. Making backups with dump</h2></div></div></div><p>
It's interesting to use the dump backup program if you want to take advantage of its several levels of backup procedures. Given below is a procedure to have a longer backup history and to keep both the backup and restore times to a 
minimum. In the following example, we assume that the backup is written to a tape drive named <code class="filename">/dev/st0</code> and we backup the home directory <code class="filename">/home</code> of our system.
</p><p>
It is important to always start with a level 0 backup, for example:
</p><p><b>Friday 1. </b>
use tape 1 for the first full backup.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -0u -f  /dev/st0 /home
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
  DUMP: Date of this level 0 dump: Fri Jan 28 21:25:12 2000
  DUMP: Date of last level 0 dump: the epoch
  DUMP: Dumping /dev/sda6 (/home) to /dev/st0
  DUMP: mapping (Pass I) [regular files]
  DUMP: mapping (Pass II) [directories]
  DUMP: estimated 18582 tape blocks on 0.48 tape(s).
  DUMP: Volume 1 started at: Fri Jan 28 21:25:14 2000
  DUMP: dumping (Pass III) [directories]
  DUMP: dumping (Pass IV) [regular files]
  DUMP: DUMP: 18580 tape blocks on 1 volumes(s)
  DUMP: finished in 4 seconds, throughput 4645 KBytes/sec
  DUMP: Volume 1 completed at: Fri Jan 28 21:25:18 2000
  DUMP: Volume 1 took 0:00:04
  DUMP: Volume 1 transfer rate: 4645 KB/s
  DUMP: level 0 dump on Fri Jan 28 21:25:12 2000
  DUMP: DUMP: Date of this level 0 dump: Fri Jan 28 21:25:12 2000
  DUMP: DUMP: Date this dump completed:  Fri Jan 28 21:25:18 2000
  DUMP: DUMP: Average transfer rate: 4645 KB/s
  DUMP: Closing /dev/st0
  DUMP: DUMP IS DONE
  </code></pre><p>
  </p><p><b>Monday. </b>
use tape 2 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -3u -f  /dev/st0 /home
</pre><p>
</p><p><b>Tuesday. </b>
use tape 3 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -2u -f  /dev/st0 /home
</pre><p>
</p><p><b>Wednesday. </b>
use tape 4 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -5u -f  /dev/st0 /home
</pre><p>
</p><p><b>Thursday. </b>
use tape 5 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -4u -f  /dev/st0 /home
</pre><p>
</p><p><b>Friday 2. </b>
use tape 6 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -7u -f  /dev/st0 /home
</pre><p>
</p><p><b>Monday. </b>
use tape 2 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -3u -f  /dev/st0 /home
</pre><p>
</p><p><b>Tuesday. </b>
use tape 3 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -2u -f  /dev/st0 /home
</pre><p>
</p><p><b>Wednesday. </b>
use tape 4 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -5u -f  /dev/st0 /home
</pre><p>
</p><p><b>Thursday. </b>
use tape 5 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -4u -f  /dev/st0 /home
</pre><p>
</p><p><b>Friday 3. </b>
use tape 7 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -6u -f  /dev/st0 /home
</pre><p>
</p><p><b>Monday. </b>
use tape 2 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -3u -f  /dev/st0 /home
</pre><p>
</p><p><b>Tuesday. </b>
use tape 3 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -2u -f  /dev/st0 /home
</pre><p>
</p><p><b>Wednesday. </b>
use tape 4 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -5u -f  /dev/st0 /home
</pre><p>
</p><p><b>Thursday. </b>
use tape 5 for the incremental backups.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -4u -f  /dev/st0 /home
</pre><p>
</p><p><b>Friday 4. </b>
use tape 8 for the incremental backups only if there have five Fridays in one month.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -9u -f  /dev/st0 /home
</pre><p>
</p><p><b>Monday. </b>
use tape 2 for the incremental backups only if there have five Fridays in one month.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -3u -f  /dev/st0 /home
</pre><p>
</p><p><b>Tuesday. </b>
use tape 3 for the incremental backups only if there have five Fridays in one month.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -2u -f  /dev/st0 /home
</pre><p>
</p><p><b>Wednesday. </b>
use tape 4 for the incremental backups only if there have five Fridays in one month.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -5u -f  /dev/st0 /home
</pre><p>
</p><p><b>Thursday. </b>
use tape 5 for the incremental backups only if there have five Fridays in one month.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -4u -f  /dev/st0 /home
</pre><p>
</p><p><b>Month. </b>
use another tape for a new full backup when the month change.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>dump</strong></span> -0u -f  /dev/st0 /home
</pre><p>
</p><p>
Where
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
 <code class="literal">-0</code> to <code class="literal">-9</code> is the backup level option you want to use, 
</p></li><li class="listitem"><p>
the <code class="literal">u</code> option means to update the file <code class="filename">/etc/dumpdates</code> after a successful dump, 
</p></li><li class="listitem"><p>
The  <code class="literal">-f</code>  option to write the backup to file
</p></li></ul></div><p>
The file may be a 
</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
special device file like <code class="filename">/dev/st0</code>, <span class="emphasis"><em>a tape drive</em></span>, 
</p></li><li class="listitem"><p>
<code class="filename">/dev/rsd1c</code>, <span class="emphasis"><em>a disk drive</em></span>, 
</p></li><li class="listitem"><p>
An ordinary file 
</p></li><li class="listitem"><p>
<span class="emphasis"><em>the standard output</em></span>. 
</p></li></ol></div><p>
Finally, you must specify what you want to backup. In our example, it is the <code class="filename">/home</code> directory <code class="filename">/home</code>.
</p><p>
You can see that we use the same tapes 2 to 5 for daily backups -<span class="emphasis"><em>Monday to Thursday = 4 tapes</em></span>, tapes 6, 7, and 8 for weekly backups -<span class="emphasis"><em>other Fridays, 6 + 7 + 8 = 3 tapes</em></span>. note that there 
can be five Fridays in one month and tapes 1 and any subsequent new one for monthly backups -<span class="emphasis"><em>first Friday each month, 1 + any subsequent</em></span> <code class="literal">11 months</code> <span class="emphasis"><em>= 12 tapes</em></span>. In 
conclusion, if we use 8 tapes <code class="literal">4 + 3 + 1 = 8</code>, we can have a full backup for one month and repeat the procedure with the 8 tapes to get our subsequent 11 months to come for a total of 1-year individual full backups.
</p><p>
The full backup should be done at set intervals, say once a month, and on a set of fresh tapes that are saved forever. With this kind of procedure, you will have 12 tapes for 12 months that handle histories and changes of your 
system for one year. Later, you can copy the 12 tape backups onto a different computer designated to keep all yearly backups for a long time and be able to reuse them, <span class="emphasis"><em>12 tapes</em></span>, to repeat the procedure for a new year.
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm23976"></a>7. Restoring files with dump</h2></div></div></div><p>
The restore command performs the inverse function of <span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span>. It restores files or file systems from backups made with dump. A full backup of a file system 
may be restored, and subsequent incremental backups layered on top of it. Single files and directory sub-trees may be restored from full, or partial backups. You have a number of possibile commands and options to restore backed up data 
with the dump program. Below, detailed is a procedure that uses the full potential of the restore program with the most options possible. It is also done in interactive mode.
</p><p>
In an interactive restoration of files from a dump, the restore program provides a shell like interface that allows the user to move around the directory tree selecting files to be extracted,  after reading in the directory information 
from the dump. The following is what we will see if we try to restore our <code class="filename">/home</code> directory:
</p><p>
First of all, with the following command we must move to the partition file system where we want to restore our backup. This is required, since the interactive mode of the restore program will restore our backups from the current partition file system where we 
have executed the restore command from.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /home
</pre><p>
To restore files from a dump in interactive mode, use the following command:
</p><pre class="screen">
[root@deep /home]# <span class="command"><strong>restore</strong></span> -i -f  /dev/st0
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
restore &gt;
</code></pre><p>
A prompt will appear in your terminal, to list the current, or specified, directory. Use the <span class="command"><strong>ls</strong></span> command as shown below:
</p><pre class="literallayout"><code class="computeroutput">
restore &gt; <strong class="userinput"><code>ls</code></strong>
.:
admin/       lost+found/  named/       quota.group  quota.user   wahib/

restore &gt;
</code></pre><p>
</p><p>
To change the current working directory to the specified one, use the <span class="command"><strong>cd</strong></span> commands. <span class="emphasis"><em>In our example, we change to wahib directory</em></span>, as shown below:
</p><pre class="literallayout"><code class="computeroutput">
restore &gt; <span class="command"><strong>cd</strong></span> wahib
restore &gt; ls
./wahib:
.Xdefaults     .bash_logout   .bashrc
.bash_history  .bash_profile  Personal/

restore &gt;
</code></pre><p>
</p><p>
To add the current directory or file to the list of files to be extracted, use the <span class="command"><strong>add</strong></span> command. <span class="emphasis"><em>If a directory is specified, then it and all its descendents are added to the extraction list</em></span> as shown below:
</p><pre class="literallayout"><code class="computeroutput">
restore &gt; <strong class="userinput"><code>add</code></strong> Personal/
restore &gt;
</code></pre><p>
</p><p>
Files that are on the extraction list are prepended with a <code class="literal">*</code> when they are listed by the <span class="command"><strong>ls</strong></span> command:

restore &gt; ls
./wahib:
 .Xdefaults      .bash_logout    .bashrc
 .bash_history   .bash_profile  *Personal/
</p><p>
To delete the current directory or specified argument from the list of files to be extracted, use the <span class="command"><strong>delete</strong></span> command. <span class="emphasis"><em>If a directory is specified, then all its descendents including itself are deleted from the extraction list</em></span>, as shown below:



</p><pre class="literallayout"><code class="computeroutput">
restore &gt; <span class="command"><strong>cd</strong></span> Personal/
restore &gt; ls
./wahib/Personal:
*Ad?le_Nakad.doc			*Overview.doc
*BIMCOR/					*Resume/
*My Webs/				*SAMS/
*Contents.doc				*Templates/
*Divers.doc				*bruno universite.doc
*Linux/					*My Pictures/
</code></pre><p>
</p><pre class="literallayout"><code class="computeroutput">
restore &gt; delete Resume/
restore &gt; ls
./wahib/Personal:
*Ad?le_Nakad.doc			*Overview.doc
*BIMCOR/					Resume/
*My Webs/				*SAMS/
*Contents.doc				*Templates/
*Divers.doc				*bruno universite.doc
*Linux/					*My Pictures/
</code></pre><p>
</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
The most expedient way to extract most of the files from a directory is to add the directory to the extraction list and then delete those files that are not needed.
</p></div><p>
</p><p>
To extract all files in the extraction list from the dump, use the <span class="command"><strong>extract</strong></span> command. <span class="emphasis"><em>Restore will ask which volume the user wishes to mount.  The fastest way to extract a few files is to start with 
the last volume and work towards the first volume</em></span>, as shown below:
</p><pre class="literallayout"><code class="computeroutput">
restore &gt; extract
You have not read any tapes yet.
Unless you know which volume your file(s) are on you should s<span class="command"><strong>tar</strong></span>t
with the last volume and work towards the first.
Specify next volume #: 1
set owner/mode for '.'? [yn] y
</code></pre><p>
</p><p>
To exit from the interactive restore mode after you have finished extracting your directories or files, use the <span class="command"><strong>quit</strong></span> command as shown below.
</p><pre class="literallayout"><code class="computeroutput">
/sbin/restore &gt; quit
</code></pre><p>
</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
Other methods of restoration exist with the dump program, consult the man page of dump for more information.
</p></div><p>
Further documentation, for more details, there are man pages you can read:

</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></span></dt><dd><p>
ext2 filesystem backup
</p></dd><dt><span class="term"><span class="citerefentry"><span class="refentrytitle">restore</span>(8)</span></span></dt><dd><p>
restore files or file systems from backups made with dump
    </p></dd></dl></div><p>
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm24060"></a>8. Backing up and restoring over the network</h2></div></div></div><p>
Backups allow you to restore the availability and integrity of information resources following security breaches and accidents. Without a backup, you may be unable to restore a computer's data after system failures and security 
breaches. It is important to develop a plan that is broad enough to cover all the servers you plan to deploy. We must determine what categories of files will be backed up. For example, you may choose to back up only user data 
files <abbr class="abbrev">i.e.</abbr> <code class="filename">/home</code> because damaged system files should be reloaded from the original distribution media.
</p><p>
There are common technological approaches to file backups. For network servers, an authoritative version of the informational content of the server is created and maintained on a secure machine that is backed up. If the server 
is compromised and its content damaged, it can be reloaded from the secure system maintaining the authoritative version. This approach is typically used for public servers, such as Web servers, because the content changes at 
more predictable intervals.
</p><p>
It is important to ensure that backups are performed in a secure manner and that the contents of the backups remain secure. We recommend that the plan specify that:
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
The source data is encrypted before being transmitted to the storage medium.
</p></li><li class="listitem"><p>
The data remains encrypted on the backup storage media.
</p></li><li class="listitem"><p>
The storage media are kept in a physically secure facility that is protected from man-made and natural disasters.
</p></li></ul></div><p>
</p><p>
You should make sure that transfer of your backup happens in a secure manner over the network. In the previous sections, we have shown you how to make a backup onto both a tape and files from the same system where you execute 
the backup procedure, with utilities like <span class="command"><strong>tar</strong></span> and <span class="command"><strong>dump</strong></span>. These programs <span class="command"><strong>tar</strong></span> and <span class="command"><strong>dump</strong></span> are capable of making backups over the network as well. To be able 
to backup over the network you must ensure that the packages named rmt and rsh are installed on your system. The rmt utility provides remote access to tape devices for programs like <span class="command"><strong>dump</strong></span>, and <span class="command"><strong>tar</strong></span>. 
To complement this, the rsh package contains a set of programs which allow users to run commands on remote machines, login to other machines and copy files between machines, <span class="emphasis"><em>rsh, rlogin and rcp are this set of programs</em></span>.
</p><p>
Since rsh can be easily hacked, and rmt depends on rsh to be able to work, we have chosen to not install them in our setup installation, see <a class="link" href="#pr1ch2" title="Chapter 3. Installation of your Linux Server">Installation of your Linux Server</a> for more information, due to security reasons. 
Therefore, we must find another way to make backups over the network in a secure manner. SSH technology is the solution for our problem <a class="link" href="#prt6ch15ssh" title="Chapter 15. Software -Securities">Software -Securities</a>, because it also has the ability to copy data across 
the network with its <span class="command"><strong>scp</strong></span> command, through encryption. The following is a method that permits us to use the potential of SSH software to transfer our backups made with <span class="command"><strong>tar</strong></span> or dump in a secure manner via the 
<span class="command"><strong>scp</strong></span> SSH utility.
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idm24088"></a>8.1. Using the scp SSH command </h3></div></div></div><p>
The <span class="command"><strong>scp</strong></span> command copies files between hosts on a network. It uses SSH for data transfer, and uses the same authentication, and provides the same security, as SSH. Unlike the rcp utility that comes with the package rsh, scp will ask 
for passwords or passphrases. In our example below, we transfer a backup file made with the <span class="command"><strong>tar</strong></span> archive program. The procedure to transfer a backup file or tape made with dump program is the same.

To use scp to copy a backup tape or file to a remote secure system, use the command:
</p><pre class="screen">
[admin@deep /]# scp &lt;localdir/to/filelocation&gt; &lt;user@host:/dir/for/file&gt;
</pre><p>

Where &lt;localdir/to/filelocation&gt; is the directory where your backup file resides on your local server, 
and &lt;user@host:/dir/for/file&gt; represents, in this order: 
</p><div class="orderedlist"><ol class="orderedlist" type="I"><li class="listitem"><p>
The username, <code class="literal">user</code> of the person on the remote site that will hold the backup file, 
</p></li><li class="listitem"><p>
The hostname, <code class="literal">host</code> of the remote host where you want to send the backup file, 
</p></li><li class="listitem"><p>
The remote directory of this host where you want to place the transferred backup file.
</p></li></ol></div><p>
</p><div class="example"><a name="idm24103"></a><p class="title"><b>Example 33.2. scp SSH command</b></p><div class="example-contents"><p>
A real example will look like this:
</p><pre class="screen">
[admin@deep /]# <span class="command"><strong>scp</strong></span> -Cp /backups/deep-01Feb.<span class="command"><strong>tar</strong></span> admin@backupserver:/archive/deep/deep-01Feb.<span class="command"><strong>tar</strong></span>
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
admin@backupserver's password:
deep-01Feb.tgz            |      10479 KB | 154.1 kB/s | ETA: 00:00:00 | 100%
</code></pre><p>
</p></div></div><br class="example-break"><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
The <code class="literal">C</code> option enables compression for fast data transfer over the encrypted session, the <code class="literal">p</code> option indicates that the modification and access 
times as well as modes of the source file should be preserved on the copy. This is usually desirable. It is important to note that the <code class="filename">dir/for/file</code> directory 
on the remote host, <code class="filename">/archive/deep</code> in our example, must be owned by the <code class="literal">username</code> you specify in your scp command <code class="literal">admin</code> is 
this username in our example, or you may receive error message like: <code class="computeroutput">scp: /archive/deep/deep-01Feb.<span class="command"><strong>tar</strong></span>: Permission denied.</code>
</p></div><p>
To use scp to copy a remote tape or file to the local system, use the command:
</p><pre class="screen">
[admin@deep /]# scp &lt;user@host:/dir/for/file&gt; &lt;localdir/to/filelocation&gt;
</pre><p>

Where &lt;user@host:/dir/for/file&gt; represents, in this order; 
</p><div class="orderedlist"><ol class="orderedlist" type="I"><li class="listitem"><p>
The username <code class="literal">user</code> of the person on the remote site that holds the backup file, 
</p></li><li class="listitem"><p>
The hostname <code class="literal">host</code> of the remote host where you want to get the backup file, 
</p></li><li class="listitem"><p>
The remote directory of this host where the backup file is kept, 
</p></li><li class="listitem"><p>
&lt;localdir/to/filelocation&gt; is the local directory on your system where your want to place the backup file that you get from the remote host.
</p></li></ol></div><p>
</p><div class="example"><a name="idm24141"></a><p class="title"><b>Example 33.3. scp SSH command</b></p><div class="example-contents"><p>
A real example would look like this:
</p><pre class="screen">
[admin@deep /]# <span class="command"><strong>scp</strong></span> -Cp admin@backupserver:/archive/deep/deep-01Feb.tar /backups
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
admin@backupserver's password:
deep-01Feb.tgz            |      10479 KB | 154.1 kB/s | ETA: 00:00:00 | 100%
</code></pre><p>
</p></div></div><br class="example-break"><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
It is important to note that the <code class="filename">localdir/to/filelocation</code> directory on the local host, <code class="filename">/backups</code> in our example, must be owned 
by the <code class="literal">username</code> you specify in your scp command, <code class="literal">admin</code> is this username in our example or you may receive an error message like: <code class="computeroutput">/backups/deep-01Feb.tar: Permission denied.</code>
</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="prt7chscatd"></a>8.1.1. Alternatives to <span class="command"><strong>tar</strong></span> and dump backups</h4></div></div></div><table border="0" summary="Simple list" class="simplelist"><tr><td>
AMANDA Homepage: <a class="link" href="#prtinxfp26" title="Alternatives to tar and dump backups">http://www.cs.umd.edu/projects/amanda/</a>
</td></tr><tr><td>
BRU Homepage: <a class="link" href="#prtinxfp26" title="Alternatives to tar and dump backups">http://www.bru.com/</a>
</td></tr></table></div></div></div></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="idm24169"></a>Part I. Appendixes</h1></div></div></div><div class="partintro"><div></div><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col></colgroup><tbody><tr valign="middle"><td align="center" valign="middle">
                   <span class="inlinemediaobject"><img src="./resources/Annimals/Chapter17.gif" alt="Elephant"></span>
         </td></tr></tbody></table></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="appendix"><a href="#idm24182">A. Resources</a></span></dt><dt><span class="appendix"><a href="#idm24626">B. Tweaks, Tips and Administration tasks</a></span></dt><dt><span class="appendix"><a href="#pr7ap3rfc">C. Obtaining Requests for Comments (RFCs)</a></span></dt></dl></div></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="idm24182"></a>Appendix A. Resources</h2></div></div></div><p><span class="emphasis"><em>Surprised!</em></span>, Don't be, what we have attempted is to duplicate a server-side redirect here. The idea is, supposingly you are viewing this book online from a website, this will give enough time to 
          think about leaving this environement which is what would have happened if you had clicked on any link, or save this page and go back to the page you were browsing. this will leave with the option of checking out the
         later at your convenience. To us when and if, <em class="wordasword">a misnomer</em> the link needs to be updated or changed or edited etc. we have to tinker with this page rather than hunt and peck at the links by searching them from different pages
         </p><p>I have strived hard to make it as easy as possible for all to traverse here for finding the links . As a thumb rule all the links have as title the name of the chapter you clicked on the link.  </p><p><a name="rsrcofwbi1"></a><b>Open Network Architecture. </b>
         The official website of Securing and Optimizing Linux Redhat Edition 
         <a class="ulink" href="http://www.openna.com" target="_top">www.openna.com</a>
         </p><p><a name="rsrclgnwbi2"></a><b><a class="link" href="#binflgnrsr1" title="Legal Notice">Legalnotice</a>. </b>
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
            For the latest version of Open Publication License:
           <a class="ulink" href="http://www.opencontent.org/openpub/" target="_top">www.opencontent.org/openpub/</a>.
           </td></tr><tr><td>
           For the commercial printing license please contact:
           <a class="ulink" href="http://www.opendocspublishing.com/" target="_top">OpenDocs @www.opendocspublishing.com/</a>
           </td></tr></table><p>
           </p><p><a name="sc24obecfrs1"></a><b><a class="link" href="#pr1ch2s4obefs" title="4. Obtaining the book and example configuration files">
             Obtaining the book and example configuration files</a>. </b>
           From the original web site
                     </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                       <code class="systemitem">Open Network Architecture</code><a class="ulink" href="www.openna.com" target="_top">www.openna.com</a>
                       </td></tr><tr><td>
                     <code class="systemitem">The Linux Documentation Project homepage:</code>
                     <a class="ulink" href="http://www.linuxdoc.org/guides.html" target="_top">www.linuxdoc.org</a>
                     </td></tr><tr><td>                       
                     <code class="systemitem">O'Reilly Network:</code>
                     <a class="ulink" href="http://oreilly.linux.com/pub/d/25" target="_top">oreilly.linu.com/pub/d/25</a> 
                     </td></tr><tr><td>
                     <a class="ulink" href="http://www.opendocspublishing.com/wheretobuy.lxp" target="_top">
                     <span class="inlinemediaobject"><img src="./images/lcanim-1.gif" align="middle" alt="You can Buy here!"></span>
                      By clicking here!
                     </a>
                     </td></tr><tr><td>                       
                     <code class="systemitem">Linux Security portal</code>
                     <a class="ulink" href="www.linuxsecurity.com/docs" target="_top">www.linuxsecurity.com/docs</a> 
                     </td></tr></table><p>
                     </p><p>
              For the latest version of this book keep checking here:
            <a class="ulink" href="http://www.linuxdoc.org/" target="_top">www.linuxdoc.org/</a>           
            </p><p><a name="sc24obecfrs2"></a>
              The <a class="link" href="#pr1ch2s4obefs1" title="4.1. Example Configuration files">example configuration files</a> can obtained from here:
            <a class="ulink" href="http://www.openna.com/books/floppy.tgz" target="_top">www.openna.com/books/floppy.tgz.</a>
            </p><p><a name="prtinxfp4"></a><b><a class="link" href="#prt2ch2sc2" title="2. Creating the Boot Disk and Booting">Creating the Boot Disk and Booting</a>. </b>
          Redhat boot images are available here:
          </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         <a class="ulink" href="http://www.redhat.com/errata" target="_top">www.redhat.com/errata</a>
         </td></tr></table><p>
         </p><p><a name="prtinxfp5"></a><b><a class="link" href="#prt2ch3sc7uls" title="7. Update of the latest software">Update of the latest software</a>. </b>
           The errata page for RedHat Linux distro:
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
           <a class="ulink" href="http://www.redhat.com/corp/support/errata/index.html" target="_top">www.redhat.com/corp/support/errata/index.html</a>
           </td></tr></table><p>
           </p><p><a name="prtinxfperrt1"></a><b>Openna Errata. </b>
         The Firewall Scripts Errata page is here <a class="ulink" href="http://www.openna.com/books/errata.htm" target="_top">http://www.openna.com/books/errata.htm</a>
         </p><p><a name="prtinxfp6"></a><b><a class="link" href="#prt3ch2sc2br" title="2. Benchmark Results">Benchmark Results</a>. </b>
           The benchmarking results can be retrieved from <acronym class="acronym">GCC</acronym> homepage:
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         <a class="ulink" href="http://egcs.cygnus.com/" target="_top">http://egcs.cygnus.com/</a>
         </td></tr></table><p>
         </p><p><a name="prtinxfp7"></a><b><a class="link" href="#prt3ch3sc1pi" title="1. Pre-Install">Pre-install</a>. </b>
         For the latest Linux kernel check out the Kernel homepage here:
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         <a class="ulink" href="http://www.kernelnotes.org/" target="_top">http://www.kernelnotes.org/</a>
         </td></tr></table><p>
         </p><p><b>Secure Linux Kernel. </b>
           For the latest the place to check for the latest Secure Linux Kernel Patches Homepage:
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         <a class="ulink" href="http://www.openwall.com/linux/" target="_top">http://www.openwall.com/linux/</a>
         </td></tr></table><p>
         </p><p><a name="prtinxfp8"></a><b><a class="xref" href="#prt5ch2ssmt" title="Chapter 14. Software -Security/Monitoring">Chapter 14, <i>Software -Security/Monitoring</i></a> . </b>
          The sXid packages can be found here:
          </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         <a class="ulink" href="ftp://marcus.seva.net/pub/sxid/" target="_top">ftp://marcus.seva.net/pub/sxid/</a>
         </td></tr></table><p>
         </p><p><a name="prtinxfp9"></a><b><a class="link" href="#pr5ch2sc3lc" title="3. Logcheck">Logcheck</a>. </b>
           The Logcheck homepage is:
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         <a class="ulink" href="http://www.psionic.com/abacus/logcheck/" target="_top">http://www.psionic.com/abacus/logcheck/</a>
         </td></tr></table><p>
         </p><p><a name="prtinxfp10"></a><b><a class="xref" href="#prt5ch2sc5PS" title="5. PortSentry">PortSentry</a>. </b>
           The Portsentry Homepage is:
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         <a class="ulink" href="http://www.psionic.com/abacus/portsentry/" target="_top">http://www.psionic.com/abacus/portsentry/</a>
         </td></tr></table><p>
         </p><p><a name="prtinxfp11"></a><b><a class="link" href="#prt6ch1sc1ossh" title="1. OpenSSH">OpenSSh</a>. </b>
           The OpenSSh package can be downloaded from:
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         <a class="ulink" href="http://www.openssh.com" target="_top">http://www.openssh.com</a>
         </td></tr></table><p>
         </p><p><a name="prtinxfp12"></a><b><a class="xref" href="#prt6ch1sc8pty" title="Putty">Putty</a>. </b>
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         <a class="ulink" href="http://www.chiark.greenend.org.uk/~sgtatham/putty.html" target="_top">http://www.chiark.greenend.org.uk/~sgtatham/putty.html</a>
         </td></tr></table><p>
           </p><p><a name="prtinxfp13"></a><b><a class="link" href="#prt6ch1sc8ttsh" title="Tera Term Pro and TTSSH">Tera Term Pro and TTSSH</a>. </b>
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
           <a class="ulink" href="http://hp.vector.co.jp/authors/VA002416/teraterm.html" target="_top">http://hp.vector.co.jp/authors/VA002416/teraterm.html</a>,
           </td></tr><tr><td>
         <a class="ulink" href="http://www.zip.com.au/~roca/download.html" target="_top">http://www.zip.com.au/~roca/download.html</a>.
         </td></tr></table><p>
         </p><p><a name="prtinxfp14"></a><b><a class="link" href="#prt6ch2sc1ssh" title="1. Linux SSH2 Client/Server">Linux SSH2 Client/Server</a>. </b>
           The SSH2 (commercial) homepage is:
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         <a class="ulink" href="http://www.ssh.org/" target="_top">http://www.ssh.org/</a>
         </td></tr></table><p>
         </p><p><a name="prtinxfp15"></a><b><a class="link" href="#prt6ch3sc1trwr" title="1. Linux Tripwire 2.2.1">Linux Tripwire 2.2.1</a>. </b>
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
           <a class="ulink" href="http://www.tripwiresecurity.com/" target="_top">http://www.tripwiresecurity.com/</a>
         </td></tr></table><p>
         </p><p><a name="prtinxfp16"></a><b><a class="link" href="#pr6ch4sc1ltp" title="Chapter 18. Linux Tripwire ASR 1.3.1">Linux Tripwire ASR 1.3.1</a>. </b>
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
         <a class="ulink" href="http://www.tripwiresecurity.com/" target="_top">http://www.tripwiresecurity.com/</a>
         </td></tr></table><p>
         </p><p><a name="prtinxfp17"></a><b><a class="link" href="#pr6ch4sc52tri" title="6.1.1. Alternatives to Tripwire">Alternatives to Tripwire:</a> </b>
           
           </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">ViperDB</span></dt><dd><p>
                 ViperDB Homepage: <a class="ulink" href="http://www.resentment.org/projects/viperdb/" target="_top">http://www.resentment.org/projects/viperdb/</a>
               </p></dd><dt><span class="term">FCHECK</span></dt><dd><p>
                 FCHECK Homepage:<a class="ulink" href="http://sites.netscape.net/fcheck/fcheck.html" target="_top">http://sites.netscape.net/fcheck/fcheck.html</a>
               </p></dd><dt><span class="term">Sentinel</span></dt><dd><p>
                     Sentinel Homepage:<a class="ulink" href="http://zurk.netpedia.net/zfile.html" target="_top">http://zurk.netpedia.net/zfile.html</a>
                   </p></dd></dl></div><p>
         </p><p><a name="prtinxfp19er"></a><b><a class="link" href="#pr6ch19sgpgp" title="1. Linux GnuPG">Linux GnuPG</a>. </b>
          These are the Package(s) you must be sure to download:
          </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
          GnuPG Homepage:<a class="ulink" href="http://www.gnupg.org/" target="_top">http://www.gnupg.org/</a>
          </td></tr></table><p>
          </p><p><a name="prtinxfp18"></a><b><a class="link" href="#pr6ch7sc1dbs" title="1. Linux DNS and BIND Server">Linux <acronym class="acronym">DNS</acronym> and <acronym class="acronym">BIND</acronym> Server</a>. </b>
           The required packages of <acronym class="acronym">DNS</acronym>/BIND can be got here:
                   </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
          <acronym class="acronym">ISC</acronym> <acronym class="acronym">BIND</acronym> Homepage:<a class="ulink" href="http://www.isc.org/" target="_top">http://www.isc.org/</a>
          </td></tr><tr><td>
          <acronym class="acronym">ISC</acronym> <acronym class="acronym">BIND</acronym> <acronym class="acronym">FTP</acronym> Site:<a class="ulink" href="ftp://204.152.184.27" target="_top"><code class="literal">204.152.184.27</code></a>
          </td></tr></table><p>
          </p><p><a name="prtinxfp19"></a><b><a class="link" href="#pr6ch22sc1snml">Sendmail</a>. </b>
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
           Sendmail Homepage: <a class="ulink" href="http://www.sendmail.org/" target="_top">http://www.sendmail.org/</a>
           </td></tr><tr><td>
           Sendmail <acronym class="acronym">FTP</acronym> Sire: <a class="ulink" href="ftp://204.152.184.34" target="_top">204.152.184.34</a>
           </td></tr><tr><td>
           You must be sure to download: sendmail.8.10.1.tar.gz
           </td></tr></table><p>
         </p><p>
           For details, regarding <a class="link" href="#pr6ch22sc3gls">Realtime Blackhole List database</a> see:
            
           </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
           <a class="ulink" href="http://maps.vix.com/rbl/" target="_top">http://maps.vix.com/rbl/</a>
         </td></tr></table><p>
         </p><p><a name="prtinxfp20"></a><b><a class="link" href="#pr6ch23sc1ip" title="1. Configure and Compile">Linux <acronym class="acronym">IMAP</acronym> &amp; <acronym class="acronym">POP</acronym> Server</a>. </b>
         These are the Package(s) needed and should be available here:
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
             <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> Homepage: <a class="ulink" href="http://www.washington.edu/imap/" target="_top">http://www.washington.edu/imap/</a>
           </td></tr><tr><td>
           <acronym class="acronym">IMAP</acronym>/<acronym class="acronym">POP</acronym> <acronym class="acronym">FTP</acronym> Site: <a class="ulink" href="ftp://140.142.3.227" target="_top">140.142.3.227</a> or <a class="ulink" href="ftp://140.142.4.227" target="_top">140.142.4.227</a>
           </td></tr><tr><td>
           You must be sure to download: imap.tar.Z
           </td></tr></table><p>
         </p><p><a name="prtinxfp21"></a><b><a class="link" href="#pr6ch24sc1wr" title="Patents">Patents</a>. </b>
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td><acronym class="acronym">RSA</acronym> Data Security:Their web page is <a class="ulink" href="http://www.rsa.com/" target="_top">http://www.rsa.com/</a></td></tr><tr><td>Ascom in Austria:Their web page is <a class="ulink" href="http://www.ascom.ch/" target="_top">http://www.ascom.ch/</a></td></tr></table><p>
         </p><p><a name="prtinxfp22"></a><b><a class="xref" href="#pr6ch24sc1ossl" title="1. Linux OPENSSL Server">OPENSSL</a>. </b>
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>OpenSSL Homepage: <a class="ulink" href="http://www.openssl.org/" target="_top">http://www.openssl.org/</a></td></tr></table><p>
         </p><p><a name="prtinxfp23"></a><b><a class="link" href="#pr6ch25sc1fsw" title="1. IPSEC/VPN -FreeS/WAN">IPSEC/VPN -FreeS/WAN</a>. </b>
</p><table border="0" summary="Simple list" class="simplelist"><tr><td>
             Kernel Homepage: <a class="ulink" href="http://www.kernelnotes.org/" target="_top">http://www.kernelnotes.org/</a>
          </td></tr><tr><td>
           FreeS/WAN VPN Homepage Site: <a class="ulink" href="http://www.freeswan.org/" target="_top">http://www.freeswan.org/</a>
           </td></tr><tr><td>
           FreeS/WAN VPN FTP Site: <a class="ulink" href="ftp://194.109.6.26" target="_top">194.109.6.26</a>
           </td></tr></table><p>
           </p><p><a name="prtinxfp25"></a><b><a class="link" href="#pr6ch26sccmi" title="1. Compile ans Install">Compile and Install</a>. </b>
             </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                 OpenLDAP Homepage:<a class="ulink" href="http://www.openldap.org/" target="_top">http://www.openldap.org/</a>
               </td></tr><tr><td>
               OpenLDAP FTP Site: <a class="ulink" href="ftp://204.152.186.57" target="_top">204.152.186.57</a>
               </td></tr></table><p>
           </p><p><a name="prtinxfp26"></a><b><a class="link" href="#prt7chscatd" title="8.1.1. Alternatives to tar and dump backups">Alternatives to <span class="command"><strong>tar</strong></span> and dump backups</a>. </b>
            </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                AMANDA Homepage: <a class="ulink" href="http://www.cs.umd.edu/projects/amanda/" target="_top">http://www.cs.umd.edu/projects/amanda/</a>
              </td></tr><tr><td>
                BRU Homepage: <a class="ulink" href="http://www.bru.com/" target="_top">http://www.bru.com/</a>
              </td></tr></table><p>
            </p><p><a name="prtinxfp27"></a><b><a class="link" href="#pr6ch27scpsql" title="1. Install PostgreSQL">Install PostgreSQL</a>. </b>
          PostgreSQL packages are found here:
          </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
            PostgreSQL Homepage: <a class="ulink" href="http://www.postgresql.org/" target="_top">http://www.postgresql.org/</a>
          </td></tr><tr><td>
          PostgreSQL FTP Site:<a class="ulink" href="ftp://216.126.84.28" target="_top">216.126.84.28</a>
          </td></tr></table><p>
          </p><p><a name="prtinxfp28"></a><b><a class="link" href="#pr6ch28scsps" title="1. Linux Squid Proxy Server">Linux Squid Proxy Server</a>. </b>
  These are Package(s) and are available here:
  </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
      Squid Homepage:<a class="ulink" href="http://www.squid-cache.org/" target="_top">http://www.squid-cache.org/</a> 
    </td></tr><tr><td>
    Squid <acronym class="acronym">FTP</acronym> Site: <a class="ulink" href="ftp://204.144.128.89" target="_top">204.144.128.89</a>
    </td></tr><tr><td>
 GNU malloc Homepage:<a class="ulink" href="http://www.gnu.org/order/ftp.html" target="_top"> http://www.gnu.org/order/ftp.html</a>
    </td></tr></table><p>
</p><p><a name="prtinxfp28sqc"></a><b><a class="link" href="#pr6ch28scsqcnf" title="6. Configure the /etc/squid/squid.conf file -in httpd-accelerator mode">Configure the <code class="filename">/etc/squid/squid.conf</code> file -in <code class="literal">httpd-accelerator</code> mode</a>. </b>
</p><table border="0" summary="Simple list" class="simplelist"><tr><td>
<a class="ulink" href="http://www.hpl.hp.com/techreports/1999/HPL-1999-69.html" target="_top">http://www.hpl.hp.com/techreports/1999/HPL-1999-69.html</a>
</td></tr><tr><td>
<a class="ulink" href="http://fog.hpl.external.hp.com/techreports/98/HPL-98-173.html" target="_top">http://fog.hpl.external.hp.com/techreports/98/HPL-98-173.html</a>
</td></tr></table><p>
</p><p><a name="prtinxfp29"></a><b><a class="link" href="#prt6ch29scmm" title="1. Linux MM Shared Memory Library">Linux MM Shared Memory Library </a>. </b>
MM Homepage:<a class="ulink" href="http://www.engelschall.com/sw/mm/" target="_top">http://www.engelschall.com/sw/mm/</a>
</p><p><a name="prtinxfp30"></a><b><a class="link" href="#prt6ch29sapws" title="3. Linux Apache Web Server">Linux Apache Web Server</a>. </b>
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
            Apache Homepage: <a class="ulink" href="http://www.apache.org/" target="_top">http://www.apache.org/</a>
        </td><td>
        Mod_Perl Homepage: <a class="ulink" href="http://perl.apache.org/" target="_top">http://perl.apache.org/</a>
        </td></tr><tr><td>
        Apache FTP Site: <a class="ulink" href="ftp://63.211.145.10" target="_top">63.211.145.10</a>
        </td><td>
        Mod_Perl FTP Site: <a class="ulink" href="ftp://63.211.145.10" target="_top">63.211.145.10</a>
        </td></tr><tr><td>
        Mod_SSL Homepage: <a class="ulink" href="http://www.modssl.org/" target="_top">http://www.modssl.org/</a>
        </td><td>
        Mod_PHP Homepage: <a class="ulink" href="http://www.php.net/" target="_top">http://www.php.net/</a>
        </td></tr><tr><td>
        Mod_SSL FTP Site: <a class="ulink" href="ftp://129.132.7.171" target="_top">129.132.7.171</a>
        </td><td> </td></tr></table><p>

</p><p><a name="prtinxfp31"></a><b><a class="link" href="#pr6ch29sappsy" title="13. Perl module Devel::Symdump">Perl module Devel::Symdump</a>. </b>
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
            Devel-Symdump Homepage:<a class="ulink" href="http://www.perl.com/CPAN/modules/by-module/Devel/" target="_top">http://www.perl.com/CPAN/modules/by-module/Devel/</a> 
        </td></tr></table><p>

</p><p><a name="prtinxfp32"></a><b><a class="link" href="#pr6ch29sapcgi" title="14. CGI.pm Perl library">CGI.pm Perl library</a>. </b>
</p><table border="0" summary="Simple list" class="simplelist"><tr><td>
    CGI.pm Homepage: <a class="ulink" href="http://stein.cshl.org/WWW/software/CGI/cgi_docs.html" target="_top">http://stein.cshl.org/WWW/software/CGI/cgi_docs.html</a>
</td></tr></table><p>
</p><p><a name="prtinxfp33"></a><b><a class="link" href="#pr6ch30swblzr" title="1. Linux Webalizer">Linux Webalizer</a>. </b>
    These are the Package(s):
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
        Webalizer Homepage: <a class="ulink" href="http://www.mrunix.net/webalizer/" target="_top">http://www.mrunix.net/webalizer/</a>
      </td></tr><tr><td>
      Webalizer FTP Site: <a class="ulink" href="ftp://207.153.121.6" target="_top">207.153.121.6</a>
      </td></tr></table><p>
  </p><p><a name="prtinxfp34"></a><b><a class="link" href="#pr6ch30scfqmtc" title="6. Linux FAQ-O-Matic">Linux FAQ-O-Matic</a>. </b>
    These are the Package(s) required:
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
      FAQ-O-Matic Homepage: <a class="ulink" href="http://www.dartmouth.edu/~jonh/ff-serve/cache/1.html" target="_top">http://www.dartmouth.edu/~jonh/ff-serve/cache/1.html</a>
    </td></tr><tr><td>
    The most recent version of the FAQ-O-Matic is always available at: <a class="ulink" href="ftp://ftp.cs.dartmouth.edu/pub/jonh." target="_top">ftp://ftp.cs.dartmouth.edu/pub/jonh.</a>
    </td></tr></table><p>
  </p><p><a name="prtinxfp35"></a><b><a class="link" href="#pr6ch30swmlimp" title="11. Linux Webmail IMP">Linux Webmail IMP</a>. </b>
    These are the Package(s):
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
        Webmail <acronym class="acronym">IMP</acronym> Homepage:<a class="ulink" href="http://www.horde.org/imp/" target="_top">http://www.horde.org/imp/</a> 
      </td></tr><tr><td>
      PHPLib Homepage:<a class="ulink" href="http://phplib.netuse.de/index.php3" target="_top">http://phplib.netuse.de/index.php3</a> 
      </td></tr></table><p>
  </p><p><a name="prtinxfp36"></a><b><a class="link" href="#pr6ch30sphplb" title="12. Set up PHPLib">phplib</a>. </b>
    These are the package(s)
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
      PHPLib Homepage: <a class="ulink" href="http://phplib.netuse.de/index.php3" target="_top">http://phplib.netuse.de/index.php3</a>, <a class="ulink" href="http://phplib.netuse.de/index.php3" target="_top">http://phplib.netuse.de/index.php3</a>
    </td></tr></table><p>
  </p><p><a name="prtinxfp31er"></a><b><a class="link" href="#pr6ch31slss" title="1. Linux Samba Server">Linux Samba Server</a>. </b>
               The Package(s) required are and available at:
               </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
                       Samba Homepage: <a class="ulink" href="http://us1.samba.org/samba/samba.html" target="_top">http://us1.samba.org/samba/samba.html</a>
                   </td></tr><tr><td>
                   Samba FTP Site: <a class="ulink" href="ftp://63.238.153.11" target="_top">63.238.153.11</a>
                   </td></tr></table><p>
             </p><p><a name="prtinxfp32er"></a><b><a class="link" href="#pr6ch32sftp" title="1. chroot'd Guest FTP access">Linux <code class="literal">FTP</code> Server</a>. </b>
    These are the Package(s):
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
      Wu-ftpd Homepage:<a class="ulink" href="http://www.wu-ftpd.org/" target="_top">http://www.wu-ftpd.org/</a>
    </td></tr><tr><td>
    Wu-ftpd FTP Site:<a class="ulink" href="ftp://205.133.13.68" target="_top">205.133.13.68</a>
    </td></tr></table><p>
  </p><p><a name="prtinxfp24"></a><b><a class="link" href="#pr7ap3rfc" title="Appendix C. Obtaining Requests for Comments (RFCs)">Appendix -RFC</a>. </b>
  </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
      <a class="ulink" href="http://www.cis.ohio-state.edu/rfc/" target="_top"> http://www.cis.ohio-state.edu/rfc/</a>
    </td></tr></table><p>
  </p><p><a name="prtinxfp1acn"></a><b><a class="link" href="#pr1ch1ackn" title='5.1. Acknowledgements from "Maddy"'>Docbook and Additional resources</a>. </b>
    </p><div class="informaltable"><table class="informaltable" border="0"><colgroup><col></colgroup><tbody valign="middle"><tr><td valign="middle">
            Norman walsh, <a class="ulink" href="http://nwalsh.com/~ndw/" target="_top">http://nwalsh.com/~ndw/</a>
          </td></tr><tr><td valign="middle">
          Peter Graves, <a class="ulink" href="http://armedbear.org" target="_top">http://armedbear.org</a>
          </td></tr><tr><td valign="middle">
            Bryan henderson, <a class="ulink" href="http://netpbm.sourceforge.net/" target="_top">http://netpbm.sourceforge.net/</a>
          </td></tr><tr><td valign="middle">
            James clark, <a class="ulink" href="http://www.jclark.com/" target="_top">http://www.jclark.com/</a> for his xt and xp 
          </td></tr><tr><td valign="middle">
            Michael Kay, <a class="ulink" href="http://users.iclway.co.uk/mhkay/saxon/" target="_top">http://users.iclway.co.uk/mhkay/saxon/</a> for Saxon
          </td></tr><tr><td valign="middle">
            To each and everyone at OASIS, <a class="ulink" href="http://www.oasis-open.org/docbook/" target="_top">http://www.oasis-open.org/docbook/</a>
          </td></tr><tr><td valign="middle">
            To each and everyone at Docbook.org, <a class="ulink" href="http://docbook.org/" target="_top">http://docbook.org/</a>
          </td></tr><tr><td valign="middle">
           Sebestain Rahtz, <a class="ulink" href="http://users.ox.ac.uk/~rahtz/passivetex/" target="_top">http://users.ox.ac.uk/~rahtz/passivetex/</a> for his contribution to DocBook
          </td></tr><tr><td valign="middle">
           Mark Gallasi<a class="ulink" href="http://nis-www.lanl.gov/~rosalia/mydocs/%20" target="_top">http://nis-www.lanl.gov/~rosalia/mydocs/</a>
          </td></tr></tbody></table></div><p>
  </p></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="idm24626"></a>Appendix B. Tweaks, Tips and Administration tasks</h2></div></div></div><p>
Some of the tips in this section are specific to Linux systems. Most are applicable to <acronym class="acronym">UNIX</acronym> system in general.
</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">The <span class="command"><strong>du</strong></span> utility command</h3><div class="mediaobject"><img src="./images/Tip.gif" alt="Tip"></div><p>
You can use the <span class="command"><strong>du</strong></span> utility to estimate file space usage. For example, to determine in megabyte the sizes of the <code class="filename">/var/log/</code> and <code class="filename">/home/</code> directory 
trees, type the following command:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>du</strong></span> -sh /var/log /home
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
3.5M    	/var/log
350M    	/home
</code></pre><p>
</p><p>
Keep in mind that the above command will report the actual size of your data. Now that you know for example that <code class="filename">/home</code> is using 350M you can move into it and <span class="command"><strong>du</strong></span> -sh * to 
locate where the largest files are.
</p><p>
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>cd</strong></span> /home/
[root@deep ]/home# <span class="command"><strong>du</strong></span> -sh *
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
343M    	admin
11k     	ftp
6.8M    	httpd
12k     	lost+found
6.0k    	named
6.0k    	smbclient
6.0k    	test
8.0k    	www
</code></pre><p>
</p></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Tip.gif" alt="Tip"></span>
</h3><p>
You can add this command to your crontab so that every day you get emailed the desired disk space list, and you'll be able to monitor it without logging in constantly.
</p></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Find the route </h3><div class="mediaobject"><img src="./images/Tip.gif" alt="Tip"></div><p>
If you want to find out the route that the packets sent from your machine to a remote host, simply issue the following command:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>traceroute</strong></span> www.redhat.com
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
traceroute to www.portal.redhat.com (206.132.41.202), 30 hops max, 38 byte packets
 1  ppp005.108-253-207.mtl.mt.videotron.net (207.253.108.5)  98.584 ms  1519.806 ms  109.911 ms
 2  fa5-1-0.rb02-piex.videotron.net (207.96.135.1)  149.888 ms  89.830 ms  109.914 ms
 3  ia-tlpt-bb01-fec1.videotron.net (207.253.253.53)  149.896 ms  99.873 ms  139.930 ms
 4  ia-cduc-bb02-ge2-0.videotron.net (207.253.253.61)  99.897 ms  169.863 ms  329.926 ms
 5  if-4-1.core1.Montreal.Teleglobe.net (207.45.204.5)  409.895 ms  1469.882 ms  109.902 ms
 6  if-1-1.core1.NewYork.Teleglobe.net (207.45.223.109)  189.920 ms  139.852 ms  109.939 ms
 7  206.132.150.133 (206.132.150.133)  99.902 ms  99.724 ms  119.914 ms
 8  pos1-0-2488M.wr2.CLE1.gblx.net (206.132.111.89)  189.899 ms  129.873 ms  129.934 ms
 9  pos8-0-2488m.wr2.kcy1.globalcenter.net (206.132.111.82)  169.890 ms  179.884 ms  169.933 ms
10  206.132.114.77 (206.132.114.77)  199.890 ms  179.771 ms  169.928 ms
11  pos8-0-2488M.wr2.SFO1.gblx.net (206.132.110.110)  159.909 ms  199.959 ms  179.837 ms
12  pos1-0-2488M.cr1.SNV2.gblx.net (208.48.118.118)  179.885 ms  309.855 ms  299.937 ms
13  pos0-0-0-155M.hr2.SNV2.gblx.net (206.132.151.46)  329.905 ms  179.843 ms  169.936 ms
14  206.132.41.202 (206.132.41.202)  2229.906 ms  199.752 ms  309.927 ms
</code></pre><p>
Where &lt;www.redhat.com&gt; is the name or ip address of the host that you want to trace.
</p></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Display Web pages access</h3><div class="mediaobject"><img src="./images/Tip.gif" alt="Tip"></div><p>
To display quickly the number of times your web page has been accessed use this command:
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>grep</strong></span> "GET / HTTP" /var/log/httpd/access_log | wc -l
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
      467
</code></pre><p>
</p></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Shut down most services altogether</h3><div class="mediaobject"><img src="./images/Tip.gif" alt="Tip"></div><p>
As root, you can shut down most services altogether with the following command:
</p><pre class="screen">
[root@deep] /# killall httpd smbd nmbd slapd named
</pre><p> 
The above command will shut down the Apache server, Samba services, <acronym class="acronym">LDAP</acronym> server, and <acronym class="acronym">DNS</acronym> server respectively.
</p></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">clock on the top of your terminal </h3><div class="mediaobject"><img src="./images/Tip.gif" alt="Tip"></div><p>
Edit the <code class="filename">profile</code> file, <span class="command"><strong>vi</strong></span> <code class="filename">/etc/profile</code> and add the following line:
</p><pre class="programlisting">
PROMPT_COMMAND='echo -ne "\0337\033[2;999r\033[1;1H\033[00;44m\033[K"`date`"\033[00m\0338"'
</pre><p>
The result will look like:
</p><div class="mediaobject"><img src="./images/time01.gif" alt="Clock on terminal window"></div><p>
</p></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">lsof installed on your server?</h3><div class="mediaobject"><img src="./images/Tip.gif" alt="Tip"></div><p>
If not, install it and execute <span class="command"><strong>lsof</strong></span>-i. This should list which ports you have open on your machine. The lsof program is a great tool as it will tell you which processes are 
listening on a given port.
</p><pre class="screen">
[root@deep] /# <span class="command"><strong>lsof</strong></span> -i
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
COMMAND    PID     USER   FD    TYPE   DEVICE SIZE NODE  NAME
Inetd	   344     root   4u  	IPv4    327        TCP 	 *:ssh (LISTEN)
sendmail   389     root   4u  	IPv4    387        TCP 	 *:smtp (LISTEN)
smbd       450     root   5u  	IPv4    452        TCP 	 deep.openna.com:netbios-ssn (LISTEN)
nmbd       461     root   5u  	IPv4    463        UDP 	 *:netbios-ns
nmbd       461     root   6u  	IPv4    465        UDP 	 *:netbios-dgm
nmbd       461     root   8u  	IPv4    468        UDP 	 deep.openna.com:netbios-ns
nmbd       461     root   9u  	IPv4    470        UDP 	 deep.openna.com:netbios-dgm
named     2599	   root   4u  	IPv4   3095        UDP 	 *:32771
named     2599	   root   20u  	IPv4   3091        UDP 	 localhost.localdomain:domain
named     2599	   root   21u  	IPv4   3092        TCP 	 localhost.localdomain:domain (LISTEN)
named     2599	   root   22u  	IPv4   3093        UDP 	 deep.openna.com:domain
named     2599	   root   23u  	IPv4   3094        TCP 	 deep.openna.com:domain (LISTEN)
</code></pre><p>
</p></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">commands on remote servers via ssh protocol </h3><div class="mediaobject"><img src="./images/Tip.gif" alt="Tip"></div><p>
The <span class="command"><strong>ssh</strong></span> command can also be used to run commands on remote systems without logging in. The output of the command is displayed, and control returns to the local system. Here is an example which will display all 
the users logged in on the remote system.
 </p><pre class="screen">
[admin@deep /]$ <span class="command"><strong>ssh</strong></span> mail.openna.com who
</pre><p>
</p><pre class="literallayout"><code class="computeroutput">
admin@mail.openna.com's password:
root	tty1	Dec  2 14:45
admin	tty2	Dec  2 14:45
wahib	pts/0	Dec  2 11:38
</code></pre><p>
</p></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Filename Completion</h3><div class="mediaobject"><img src="./images/Tip.gif" alt="Tip"></div><p>
Tab filename completion allows you to type in portions of a filename or program, and then press <span class="keycap"><strong>TAB</strong></span>, and it will complete the filename for you. If there's more than one file or program that starts with what you already 
typed in, it will beep, and then when you press <span class="keycap"><strong>TAB</strong></span> again it will list all the files that start with what you initially typed.
</p></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Special Characters</h3><div class="mediaobject"><img src="./images/Tip.gif" alt="Tip"></div><p>
You can quickly accomplish tasks that you perform frequently by using shortcut keys  one or more keys you press on the keyboard to complete a task. For example, special characters can be used on the Linux shell like the following:
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
<span class="keycap"><strong>Control</strong></span>+<span class="keycap"><strong>d</strong></span>: If you are in the shell and hit <span class="keycap"><strong>Control</strong></span>+<span class="keycap"><strong>d</strong></span> you get logged off.
</p></li><li class="listitem"><p>
<span class="keycap"><strong>Control</strong></span>+<span class="keycap"><strong>l</strong></span>: If you are in the shell and hit <span class="keycap"><strong>Control</strong></span>+<span class="keycap"><strong>l</strong></span> you clear the screen.
</p></li><li class="listitem"><p>
<span class="keycap"><strong>?</strong></span>: This is a wildcard. This can represent a single character. If you specified something at the command line like "m?b" Linux would look for mob, mib, mub, and every other letter/number between a-z, 0-9.
</p></li><li class="listitem"><p>
<span class="keycap"><strong>*</strong></span>: This can represent any number of characters. If you specified a "mi*" it would use "mit", mim, miiii, miya, and ANYTHING that starts with mi. "m*l" could by mill, mull, ml, and anything that starts with an m and ends with an l.
</p></li><li class="listitem"><p>
<span class="keycap"><strong>[]</strong></span> - Specifies a range. if I did m[o,u,i]m Linux would think: mim, mum, mom if I did: m[a-d]m Linux would think: mam, mbm, mcm, mdm. Get the idea? The <span class="keycap"><strong>[]</strong></span>, <span class="keycap"><strong>?</strong></span>, 
and <span class="keycap"><strong>*</strong></span> are usually used with copying, deleting, and directory listings.
</p></li></ul></div><p>
</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">
<span class="inlinemediaobject"><img src="./images/Important.gif" alt="Important"></span>
</h3><p>
<span class="emphasis"><em>Everything in Linux is</em></span> CASE <span class="emphasis"><em>sensitive</em></span>. This means "Bill" and "bill" are not the same thing. This allows for many files to be able to be stored, since "Bill" "bill" "bIll" "biLl", etc. can be 
different files. So, when using the <span class="keycap"><strong>[]</strong></span> stuff, you have to specify capital letters if any files you are dealing with have capital letters. Much of everything is lower case in UNIX, though.
</p></div></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="pr7ap3rfc"></a>Appendix C. Obtaining Requests for Comments (RFCs)</h2></div></div></div><p>
Requests for Comments -<acronym class="acronym">RFC</acronym>s is an ongoing set of documents issued by the Internet Engineering Task Force -<acronym class="acronym">IETF</acronym> at the Network Information Center -<acronym class="acronym">NIC</acronym> that presents 
new protocols and establishes standards for the Internet protocol suite. Each such document defines an aspect of protocol regarding the Internet. We have listed below all the <acronym class="acronym">RFC</acronym>s that pertain to this 
book, and various software described in this book. <acronym class="acronym">RFC</acronym>s are available from the following site: <a class="link" href="#prtinxfp24" title="Appendix -RFC">http://www.cis.ohio-state.edu/rfc/</a>
</p><div class="glosslist"><dl><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>706</span></dt><dd class="glossdef"><p>
On the Junk Mail Problem.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>733</span></dt><dd class="glossdef"><p>
Standard for the Format of <acronym class="acronym">ARPA</acronym> Network Text Messages.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>768</span></dt><dd class="glossdef"><p>
User Datagram Protocol -<acronym class="acronym">UDP</acronym>.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>791</span></dt><dd class="glossdef"><p>
Internet Protocol -<acronym class="acronym">IP</acronym>.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>792</span></dt><dd class="glossdef"><p>
Internet Control Message Protocol -<acronym class="acronym">ICMP</acronym>.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>793</span></dt><dd class="glossdef"><p>
Transmission Control Protocol (<acronym class="acronym">TCP</acronym>).
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>805   </span></dt><dd class="glossdef"><p>
Computer Mail Meting Notes.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>821</span></dt><dd class="glossdef"><p>
Simple Mail Transfert Protocol -<acronym class="acronym">SMTP</acronym>.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>822</span></dt><dd class="glossdef"><p>
Standard for the Format of ARPA Internet Text Massages.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>934</span></dt><dd class="glossdef"><p>
Proposed Standard for Message Encapsulation.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>950</span></dt><dd class="glossdef"><p>
<acronym class="acronym">IP</acronym> Subnet Extention.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>959</span></dt><dd class="glossdef"><p>
File Transfer Protocol (<acronym class="acronym">FTP</acronym>).
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>976</span></dt><dd class="glossdef"><p>
<acronym class="acronym">UUCP</acronym> Mail Interchange Format Standard.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1034</span></dt><dd class="glossdef"><p>
Domain Names: Concepts and Facilities.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1036</span></dt><dd class="glossdef"><p>
Standard for Interchange of USENET Message.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1058</span></dt><dd class="glossdef"><p>
Routing Information Protocol -<acronym class="acronym">RIP</acronym>.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1112</span></dt><dd class="glossdef"><p>
Internet Group Multicast Protocol <acronym class="acronym">IGMP.</acronym>
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1122</span></dt><dd class="glossdef"><p>
Requirement for Internet Host Communication Layers.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1123</span></dt><dd class="glossdef"><p>
Requirements for Internet Host Application and Support.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1137</span></dt><dd class="glossdef"><p>
Mapping Between Full <acronym class="acronym">RFC</acronym> 822 and <acronym class="acronym">RFC</acronym> 822 with Restricted Encoding.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1153</span></dt><dd class="glossdef"><p>
Digest Message Format.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1155</span></dt><dd class="glossdef"><p>
Structure of Management Information <acronym class="acronym">SMI.</acronym>
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1157</span></dt><dd class="glossdef"><p>
Simple Network Management Protocol <acronym class="acronym">SNMP.</acronym>
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1176</span></dt><dd class="glossdef"><p>
Interactive Mail Access Protocol: Version 2.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1274</span></dt><dd class="glossdef"><p>
The COSINE and Internet X.500 Schema.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1275</span></dt><dd class="glossdef"><p>
Replication Requirements to provide an Internet Directory using X.500.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1279</span></dt><dd class="glossdef"><p>
X.500 and Domains.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1308</span></dt><dd class="glossdef"><p>
Executive Introduction to Directory Services Using the X.500 Protocol.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1309</span></dt><dd class="glossdef"><p>
Technical Overview of Directory Services Using the X.500 Protocol.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1310</span></dt><dd class="glossdef"><p>
The Internet Standards Process.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1319</span></dt><dd class="glossdef"><p>
MD2 Message-Digest Algorithm.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1320</span></dt><dd class="glossdef"><p>
MD4 Message-Digest Algorithm.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1321</span></dt><dd class="glossdef"><p>
MD5 Message-Digest Algorithm.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1343</span></dt><dd class="glossdef"><p>
User Agent Configuration Mechanism for Multimedia Mail Format Information.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1344</span></dt><dd class="glossdef"><p>
Implications of <acronym class="acronym">MIME</acronym> for Internet Mail Gateways.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1345</span></dt><dd class="glossdef"><p>
Character Mnemonics and Character Sets.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1421</span></dt><dd class="glossdef"><p>
Privacy Enhancement for Internet Electronic Mail: Part IMessage Encipherment and authentication Procedures.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1422</span></dt><dd class="glossdef"><p>
Privacy Enhancement for Internet Electronic Mail: Part IICertificate-based key Management.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1423</span></dt><dd class="glossdef"><p>
Privacy Enhancement for Internet Electronic Mail: Part IIIAlgorithms, modes, and identifiers [Draft].
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1428</span></dt><dd class="glossdef"><p>
Transmition of Internet Mail from Just-Send-8 to 8bit-<acronym class="acronym">SMTP</acronym>/<acronym class="acronym">MIME</acronym>.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1430</span></dt><dd class="glossdef"><p>
A Strategic Plan for Deploying an Internet X.500 Directory Service.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1492</span></dt><dd class="glossdef"><p>
An Access Control Protocol, Sometimes Called TACACS.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1495</span></dt><dd class="glossdef"><p>
Mapping Between X.400(1988)/ISO 10021 and <acronym class="acronym">RFC</acronym> 822.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1496</span></dt><dd class="glossdef"><p>
X.400 1988 to 1984 Downgrading.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1505</span></dt><dd class="glossdef"><p>
Encoding Header Field for Internet Messages.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1510</span></dt><dd class="glossdef"><p>
The Kerberos Network Authentication Service (V5).
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1519</span></dt><dd class="glossdef"><p>
Classless Inter-Domain Routing, -<acronym class="acronym">CIDR</acronym> Assignment and Aggregation Strategy.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1521</span></dt><dd class="glossdef"><p>
<acronym class="acronym">MIME</acronym> -Multipurpose Internet Mail Extensions: Mechanisms for Specifying and Describing the Format of Internet Message Bodies (<acronym class="acronym">MIME</acronym>).
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1522</span></dt><dd class="glossdef"><p>
Representation of Non-<acronym class="acronym">ASCII</acronym> Text in Internet Message Headers.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1558</span></dt><dd class="glossdef"><p>
A String Representation of <acronym class="acronym">LDAP</acronym> Search Filters.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1566</span></dt><dd class="glossdef"><p>
Mail Monitoring MIB.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1579</span></dt><dd class="glossdef"><p>
Firewall-Friendly <acronym class="acronym">FTP</acronym>.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1583</span></dt><dd class="glossdef"><p>
Open Shortest Path First Routing V2 (OSPF2).
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1617</span></dt><dd class="glossdef"><p>
Naming and Structuring Guidelines for X.500 Directory Pilots.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1625</span></dt><dd class="glossdef"><p>
<acronym class="acronym">WAIS</acronym> over Z39.50-1988.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1631</span></dt><dd class="glossdef"><p>
The <acronym class="acronym">IP</acronym> Network Address Translator -<acronym class="acronym">NAT.</acronym>
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1652</span></dt><dd class="glossdef"><p>
<acronym class="acronym">SMTP</acronym> Service Extentions for 8bit-<acronym class="acronym">MIME</acronym>transport.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1661</span></dt><dd class="glossdef"><p>
Point-to-Point Protocol -<acronym class="acronym">PPP</acronym>.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1711</span></dt><dd class="glossdef"><p>
Classifications in E-mail Routing.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1725</span></dt><dd class="glossdef"><p>
Post Office Protocol, Version 3 -<acronym class="acronym">POP</acronym>3.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1738</span></dt><dd class="glossdef"><p>
Uniform Resource Locators -<acronym class="acronym">URL</acronym>.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1739</span></dt><dd class="glossdef"><p>
A Primer on Internet and <acronym class="acronym">TCP</acronym>/<acronym class="acronym">IP</acronym> Tools.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1777</span></dt><dd class="glossdef"><p>
Lightweight Directory Access Protocol.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1778</span></dt><dd class="glossdef"><p>
The String Representation of Standard Attribute Syntaxes.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1779</span></dt><dd class="glossdef"><p>
A String Representation of Distinguished Names.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1781</span></dt><dd class="glossdef"><p>
Using the <acronym class="acronym">OSI</acronym> Directory to Achieve User Friendly Naming.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1796</span></dt><dd class="glossdef"><p>
Not All <acronym class="acronym">RFC</acronym>s are Standards.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1798</span></dt><dd class="glossdef"><p>
Connection-less Lightweight Directory Access Protocol.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1823</span></dt><dd class="glossdef"><p>
The <acronym class="acronym">LDAP</acronym> Application Program Interface.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1830</span></dt><dd class="glossdef"><p>
<acronym class="acronym">SMTP</acronym> Services Extentions for Transmission of Large and Binary <acronym class="acronym">MIME</acronym> Messages.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1844</span></dt><dd class="glossdef"><p>
Multimedia E-mail -<acronym class="acronym">MIME</acronym>, User Agent checklist.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1845</span></dt><dd class="glossdef"><p>
<acronym class="acronym">SMTP</acronym> Service Extension for Checkpoint/Restart.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1846</span></dt><dd class="glossdef"><p>
<acronym class="acronym">SMTP</acronym> 521 Reply Code.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1854</span></dt><dd class="glossdef"><p>
<acronym class="acronym">SMTP</acronym> Service Extention for command pipelining.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1855</span></dt><dd class="glossdef"><p>
Netiquette Guidelines.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1864</span></dt><dd class="glossdef"><p>
The content-MD5 Header.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1866</span></dt><dd class="glossdef"><p>
Hypertext Markup Language - 2.0.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1869</span></dt><dd class="glossdef"><p>
<acronym class="acronym">SMTP</acronym> Service Extensions.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1870</span></dt><dd class="glossdef"><p>
<acronym class="acronym">SMTP</acronym> Service Extension for Message Size Declaration.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1872</span></dt><dd class="glossdef"><p>
The <acronym class="acronym">MIME</acronym> Multipart/Related Content-type.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1873</span></dt><dd class="glossdef"><p>
Message/External-Body Content-ID Access-type.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1883</span></dt><dd class="glossdef"><p>    
Internet Protocol, Version 6 (Ipv6) Specification.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1884</span></dt><dd class="glossdef"><p>
<acronym class="acronym">IP</acronym> Version 6 Addressing Atchitecture.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1886</span></dt><dd class="glossdef"><p>
<acronym class="acronym">DNS</acronym> Extentions to support <acronym class="acronym">IP</acronym> version 6.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1891</span></dt><dd class="glossdef"><p>
<acronym class="acronym">SMTP</acronym> Service Extension for Delivery Status Notifications.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1892</span></dt><dd class="glossdef"><p>
The Multipart/Report Content Type for the Reporting of Mail System Administrative Messages.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1893</span></dt><dd class="glossdef"><p>
Enhanced Mail System Status Codes.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1894</span></dt><dd class="glossdef"><p>
An Extensible Message Format for Delivery Status Notifications.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1918</span></dt><dd class="glossdef"><p>
Address Allocation for Private Internets.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1928</span></dt><dd class="glossdef"><p>
SOCKS Protocol Version 5.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1929</span></dt><dd class="glossdef"><p>
Username/Password Authentication for SOCKS V5.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1959</span></dt><dd class="glossdef"><p>
An <acronym class="acronym">LDAP</acronym> <acronym class="acronym">URL</acronym> Format.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1960</span></dt><dd class="glossdef"><p>
A String Representation of <acronym class="acronym">LDAP</acronym> Search Filters.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>1961</span></dt><dd class="glossdef"><p>
<acronym class="acronym">GSS</acronym>-<acronym class="acronym">API</acronym> Authentication Method for SOCKS Version 5.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2003</span></dt><dd class="glossdef"><p>
<acronym class="acronym">IP</acronym> Encapsulation within <acronym class="acronym">IP</acronym>.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2028</span></dt><dd class="glossdef"><p>
The Organizations Involved in the <acronym class="acronym">IETF</acronym> Standards Process.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2044</span></dt><dd class="glossdef"><p>
UTF-8, a transformation format of Unicode and <acronym class="acronym">ISO</acronym> 10646.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2060</span></dt><dd class="glossdef"><p>
Internet Message Access Protocol  Version 4rev1 -<acronym class="acronym">IMAP</acronym>4.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2104</span></dt><dd class="glossdef"><p>
HMAC: Keyed-Hashing for Message Authentication.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2138</span></dt><dd class="glossdef"><p>
Remote Authentication Dial In User Service (RADIUS).
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2164</span></dt><dd class="glossdef"><p>
Use of an X.500/<acronym class="acronym">LDAP</acronym> directory to support MIXER address mapping.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2200</span></dt><dd class="glossdef"><p>
Internet Official Protocol Standards.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2218</span></dt><dd class="glossdef"><p>
A Common Schema for the Internet White Pages Service.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2247</span></dt><dd class="glossdef"><p>
Using Domains in <acronym class="acronym">LDAP</acronym>/X.500 Distinguished Names.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2251</span></dt><dd class="glossdef"><p>
Lightweight Directory Access Protocol (v3).
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2252</span></dt><dd class="glossdef"><p>
Lightweight Directory Access Protocol (v3): Attribute Syntax Definitions.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2253</span></dt><dd class="glossdef"><p>
Lightweight Directory Access Protocol (v3): UTF-8 String Representation of Distinguished Names
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2254</span></dt><dd class="glossdef"><p>
The String Representation of <acronym class="acronym">LDAP</acronym> Search Filters.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2255</span></dt><dd class="glossdef"><p>
The <acronym class="acronym">LDAP</acronym> <acronym class="acronym">URL</acronym> Format.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2256</span></dt><dd class="glossdef"><p>
A Summary of the X.500(96) User Schema for use with <acronym class="acronym">LDAP</acronym>v3.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2279</span></dt><dd class="glossdef"><p>
UTF-8, a transformation format of <acronym class="acronym">ISO</acronym> 10646.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2293</span></dt><dd class="glossdef"><p>
Representing Tables and Subtrees in the X.500 Directory.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2294</span></dt><dd class="glossdef"><p>
Representing the O/R Address hierarchy in the X.500 Directory Information Tree.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2305</span></dt><dd class="glossdef"><p>
A Simple Mode of Facsimile Using Internet Mail.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2307</span></dt><dd class="glossdef"><p>
An Approach for Using <acronym class="acronym">LDAP</acronym> as a Network Information Service.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2313</span></dt><dd class="glossdef"><p>
PKCS 1: RSA Encryption Version 1-5.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2314</span></dt><dd class="glossdef"><p>
PKCS 10: Certification Request Syntax Version 1-5.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2315</span></dt><dd class="glossdef"><p>
PKCS 7: Cryptographic Message Syntax Version 1-5.
</p></dd><dt><span class="glossterm"><acronym class="acronym">RFC</acronym>2377</span></dt><dd class="glossdef"><p>
Naming Plan for Internet Directory-Enabled Applications.
</p></dd></dl></div></div></div></div></body></html>
