<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>5. Security</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="Linux, Beginners, linux, start, Getting started, guide, Guide, Exercises, exercises"><link rel="home" href="index.html" title="Introduction to Linux"><link rel="up" href="ch10.html" title="Chapter 10. Networking"><link rel="prev" href="ch10s04.html" title="4. Remote execution of applications"><link rel="next" href="ch10s06.html" title="6. Summary"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. Security</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch10s04.html">Prev</a> </td><th width="60%" align="center">Chapter 10. Networking</th><td width="20%" align="right"> <a accesskey="n" href="ch10s06.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sect_10_06"></a>5. Security</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_10_06_01"></a>5.1. Introduction</h3></div></div></div><p>As soon as a computer is connected to the network, all kinds of abuse becomes possible, be it a UNIX-based or any other system.  Admittedly, mountains of papers have been spilled on this subject and it would lead us too far to discuss the subject of security<a class="indexterm" name="idm11005"></a> in detail.  There are, however, a couple of fairly logical things even a novice user can do to obtain a very secure system, because most break-ins are the result of ignorant or careless users.</p><p>Maybe you are asking yourself if this all applies to you, using your computer at home or working at your office on a desktop in a fairly protected environment.  The questions you should be asking yourself, however, are more on the lines of:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Do you want to be in control of your own system?</p></li><li class="listitem"><p>Do you want to (unwittingly) participate in criminal activities?</p></li><li class="listitem"><p>Do you want your equipment to be used by someone else?</p></li><li class="listitem"><p>Do you want to take risks on losing your Internet connection?</p></li><li class="listitem"><p>Do you want to rebuild your system every time it has been hacked?</p></li><li class="listitem"><p>Do you want to risk personal or other data loss?</p></li></ul></div><p>Presuming you don't, we will quickly list the steps you can take to secure your machine.  Extended information can be found in the <a class="ulink" href="http://www.tldp.org/HOWTO/Security-HOWTO.html" target="_top">Linux Security HOWTO</a>.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_10_06_02"></a>5.2. Services</h3></div></div></div><p>The goal is to run as few services<a class="indexterm" name="idm11027"></a> as possible.  If the number of ports that are open for the outside world are kept to a minimum, this is all the better to keep an overview.  If services can't be turned off for the local network, try to at least disable them for outside connections.</p><p>A rule of thumb is that if you don't recognize a particular service, you probably won't need it anyway.  Also keep in mind that some services are not really meant to be used over the Internet.  Don't rely on what <span class="emphasis"><em>should</em></span> be running, check which services are listening<a class="indexterm" name="idm11032"></a> on what TCP ports using the <span class="command"><strong>netstat<a class="indexterm" name="idm11036"></a></strong></span> command:</p><pre class="screen">
<code class="prompt">[elly@mars ~]</code> <span class="command"><strong>netstat -l | grep tcp</strong></span>
tcp     0      0 *:32769                 *:*      LISTEN
tcp     0      0 *:32771                 *:*      LISTEN
tcp     0      0 *:printer               *:*      LISTEN
tcp     0      0 *:kerberos_master       *:*      LISTEN
tcp     0      0 *:sunrpc                *:*      LISTEN
tcp     0      0 *:6001                  *:*      LISTEN
tcp     0      0 *:785                   *:*      LISTEN
tcp     0      0 localhost.localdom:smtp *:*      LISTEN
tcp     0      0 *:ftp                   *:*      LISTEN
tcp     0      0 *:ssh                   *:*      LISTEN
tcp     0      0 ::1:x11-ssh-offset      *:*      LISTEN
</pre><p>Things to avoid:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="command"><strong>exec<a class="indexterm" name="idm11046"></a></strong></span>, <span class="command"><strong>rlogin<a class="indexterm" name="idm11049"></a></strong></span> and <span class="command"><strong>rsh<a class="indexterm" name="idm11052"></a></strong></span>, and <span class="command"><strong>telnet<a class="indexterm" name="idm11055"></a></strong></span> just to be on the safe side.</p></li><li class="listitem"><p>X11 on server machines.</p></li><li class="listitem"><p>No lp if no printer is physically attached.</p></li><li class="listitem"><p>No MS Windows hosts in the network, no Samba required.</p></li><li class="listitem"><p>Don't allow FTP unless an FTP server is required.</p></li><li class="listitem"><p>Don't allow NFS and NIS over the Internet, disable all related services on a stand-alone installation.</p></li><li class="listitem"><p>Don't run an MTA if you're not actually on a mail server.</p></li><li class="listitem"><p>...</p></li></ul></div><p>Stop running services using the <span class="command"><strong>chkconfig</strong></span> command, the initscripts or by editing the <span class="command"><strong>(x)inetd</strong></span> configuration files.
</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_10_06_03"></a>5.3. Update regularly</h3></div></div></div><p>Its ability to adapt quickly in an ever changing environment is what makes Linux thrive.  But it also creates a possibility that security updates<a class="indexterm" name="idm11077"></a> have been released even while you are installing a brand new version, so the first thing you should do (and this goes for about any OS you can think of) after installing is getting the updates as soon as possible.  After that, update <span class="emphasis"><em>all</em></span> the packages you use regularly.</p><p>Some updates may require new configuration files, and old files may be replaced.  Check the documentation, and ensure that everything runs normal after updating.</p><p>Most Linux distributions provide mailing list services for security update announcements, and tools for applying updates to the system.  General Linux only security issues are reported among others at <a class="ulink" href="http://linuxsecurity.com" target="_top">Linuxsecurity.com</a>.</p><p>Updating is an ongoing process, so it should be an almost daily habit.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_10_06_04"></a>5.4. Firewalls and access policies</h3></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_10_06_04_01"></a>5.4.1. What is a firewall?</h4></div></div></div><p>In the previous section we already mentioned firewall<a class="indexterm" name="idm11090"></a> capabilities in Linux.  While firewall administration is one of the tasks of your network admin, you should know a couple of things about firewalls.</p><p><span class="emphasis"><em>Firewall</em></span> is a vague term that can mean anything that acts as a protective barrier between us and the outside world, generally the Internet.  A firewall can be a dedicated system or a specific application that provides this functionality. Or it can be a combination of components, including various combinations of hardware and software. Firewalls are built from <span class="quote">&#8220;<span class="quote">rules</span>&#8221;</span> that are used to define what is allowed to enter and/or exit a given system or network.</p><p>After disabling unnecessary services, we now want to restrict accepted services as to allow only the minimum required connections.  A fine example is working from home: only the specific connection between your office and your home should be allowed, connections from other machines on the Internet should be blocked.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_10_06_04_02"></a>5.4.2. Packet filters</h4></div></div></div><p>The first line of defense is a <span class="emphasis"><em>packet filter<a class="indexterm" name="idm11101"></a></em></span>, which can look inside IP packets and make decisions based on the content.  Most common is the <span class="application">Netfilter</span> package, providing the <span class="command"><strong>iptables</strong></span> command, a next generation packet filter for Linux.</p><p>One of the most noteworthy enhancements in the newer kernels is the <span class="emphasis"><em>stateful inspection</em></span> feature, which not only tells what is inside a packet, but also detects if a packet belongs or is related to a new or existing connection.</p><p>The <span class="application">Shoreline Firewall</span> or <span class="application">Shorewall</span> for short is a front-end for the standard firewall functionality in Linux.</p><p>More information can be found at <a class="ulink" href="http://www.netfilter.org/" target="_top">the Netfilter/iptables project page</a>.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_10_06_04_03"></a>5.4.3. TCP wrappers</h4></div></div></div><p>TCP wrapping<a class="indexterm" name="idm11116"></a> provides much the same results as the packet filters, but works differently.  The wrapper actually accepts the connection attempt, then examines configuration files and decides whether to accept or reject the connection request.  It controls connections at the application level rather than at the network level.</p><p>TCP wrappers are typically used with <span class="command"><strong>xinetd</strong></span> to provide host name and IP-address-based access control.  In addition, these tools include logging and utilization management capabilities that are easy to configure.</p><p>The advantages of TCP wrappers are that the connecting client is unaware that wrappers are used, and that they operate separately from the applications they protect.</p><p>The host based access is controlled in the <code class="filename">hosts.allow</code> and <code class="filename">hosts.deny</code> files.  More information can be found in the TCP wrapper documentation files in <code class="filename">/usr/share/doc/tcp_wrappers[-&lt;version&gt;/]</code> or <code class="filename">/usr/share/doc/tcp</code> and in the man pages for the host based access control files, which contain examples.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_10_07_04_04"></a>5.4.4. Proxies</h4></div></div></div><p>Proxies<a class="indexterm" name="idm11130"></a> can perform various duties, not all of which have much to do with security. But the fact that they are an intermediary make proxies<a class="indexterm" name="idm11133"></a> a good place to enforce access control policies, limit direct connections through a firewall, and control how the network behind the proxy looks to the Internet.</p><p>Usually in combination with a packet filter, but sometimes all by themselves, proxies provide an extra level of control.  More information can be found in the <a class="ulink" href="http://www.tldp.org/HOWTO/Firewall-HOWTO.html" target="_top">Firewall HOWTO</a> or on the Squid website.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_10_07_04_05"></a>5.4.5. Access to individual applications</h4></div></div></div><p>Some servers may have their own access control features.  Common examples include <span class="application">Samba</span>, <span class="application">X Window</span>, <span class="application">Bind</span>, <span class="application">Apache</span> and CUPS.  For every service you want to offer check which configuration files apply.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_10_07_04_06"></a>5.4.6. Log files</h4></div></div></div><p>If anything, the UNIX way of logging<a class="indexterm" name="idm11148"></a> all kinds of activities into all kinds of files confirms that <span class="quote">&#8220;<span class="quote">it is doing something.</span>&#8221;</span>  Of course, log<a class="indexterm" name="idm11152"></a> files should be checked regularly, manually or automatically.  Firewalls and other means of access control tend to create huge amounts of log files, so the trick is to try and only log abnormal activities.</p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_10_07_05"></a>5.5. Intrusion detection</h3></div></div></div><p> Intrusion Detection Systems<a class="indexterm" name="idm11158"></a> are designed to catch what might have gotten past the firewall. They can either be designed to catch an active break-in attempt in progress, or to detect a successful break-in after the fact. In the latter case, it is too late to prevent any damage, but at least we have early awareness of a problem.  There are two basic types of IDS:  those protecting networks, and those protecting individual hosts.</p><p> For host based IDS, this is done with utilities that monitor the file system for changes. System files that have changed in some way, but should not change, are a dead give-away that something is amiss. Anyone who gets in and gets root access will presumably make changes to the system somewhere. This is usually the very first thing done, either so he can get back in through a backdoor, or to launch an attack against someone else, in which case, he has to change or add files to the system.  Some systems come with the <span class="command"><strong>tripwire</strong></span> monitoring system, which is documented at the <a class="ulink" href="http://www.tripwire.org" target="_top">Tripwire Open Source Project</a> website.</p><p>Network intrusion detection is handled by a system that sees all the traffic that passes the firewall (not by portscanners, which advertise usable ports).  <a class="ulink" href="http://www.snort.org" target="_top">Snort</a> is an Open Source example of such a program.  Whitehats.com features an open Intrusion detection database, <a class="ulink" href="http://www.whitehats.com" target="_top">arachNIDS</a>.  </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_10_07_06"></a>5.6. More tips</h3></div></div></div><p>Some general things<a class="indexterm" name="idm11170"></a> you should keep in mind:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Do not allow root logins.  UNIX developers came up with the <span class="command"><strong>su</strong></span> over two decades ago for extra security.</p></li><li class="listitem"><p>Direct root access is always dangerous and susceptible to human errors, be it by allowing root login or by using the <span class="command"><strong>su <code class="option">-</code></strong></span> command.  Rather than using <span class="command"><strong>su</strong></span>, it is even better to use <span class="command"><strong>sudo</strong></span> to only execute the command that you need extra permissions for, and to return afterwards to your own environment.</p></li><li class="listitem"><p>Take passwords seriously.  Use shadow passwords.  Change your passwords regularly.</p></li><li class="listitem"><p>Try to always use SSH or SSL.  Avoid <span class="command"><strong>telnet</strong></span>, FTP and E-mail clients and other client programs which send unencrypted passwords over the network.  Security is not only about securing your computer, it is also about securing your passwords.</p></li><li class="listitem"><p>Limit resources using <span class="command"><strong>quota</strong></span> and/or <span class="command"><strong>ulimit</strong></span>.</p></li><li class="listitem"><p>The mail for root should be delivered to, or at least read by, an actual person.</p></li><li class="listitem"><p>The <a class="ulink" href="http://www.sans.org" target="_top">SANS institute</a> has more tips and tricks, sorted per distribution, with mailing list service.</p></li><li class="listitem"><p>Check the origin of new software, get it from a trusted place/site.  Verify new packages before installing.</p></li><li class="listitem"><p>When using a non-permanent Internet connection, shut it down as soon as you don't need it anymore.</p></li><li class="listitem"><p>Run private services on odd ports instead of the ones expected by possible hackers.</p></li><li class="listitem"><p>Know your system.  After a while, you can almost feel when something is happening.</p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_10_07_07"></a>5.7. Have I been hacked?</h3></div></div></div><p>How can you tell?  This is a checklist of suspicious<a class="indexterm" name="idm11208"></a> events:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Mysterious open ports, strange processes.</p></li><li class="listitem"><p>System utilities (common commands) behaving strange.</p></li><li class="listitem"><p>Login problems.</p></li><li class="listitem"><p>Unexplained bandwidth usage.</p></li><li class="listitem"><p>Damaged or missing log files, syslog daemon behaving strange.</p></li><li class="listitem"><p>Interfaces in unusual modes.</p></li><li class="listitem"><p>Unexpectedly modified configuration files.</p></li><li class="listitem"><p>Strange entries in shell history files.</p></li><li class="listitem"><p>Unidentified temporary files.</p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_10_07_08"></a>5.8. Recovering from intrusion</h3></div></div></div><p>In short, stay calm.  Then take the following actions<a class="indexterm" name="idm11233"></a> in this order:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Disconnect the machine from the network.</p></li><li class="listitem"><p>Try to find out as much as you can about how your security was breached.</p></li><li class="listitem"><p>Backup important non-system data.  If possible, check these data against existing backups, made before the system was compromised, to ensure data integrity.</p></li><li class="listitem"><p>Re-install the system.</p></li><li class="listitem"><p>Use new passwords.</p></li><li class="listitem"><p>Restore from system and data backups.</p></li><li class="listitem"><p>Apply all available updates.</p></li><li class="listitem"><p>Re-examine the system:  block off unnecessary services, check firewall rules and other access policies.</p></li><li class="listitem"><p>Reconnect.</p></li></ul></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch10s04.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch10.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch10s06.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4. Remote execution of applications </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 6. Summary</td></tr></table></div></body></html>
