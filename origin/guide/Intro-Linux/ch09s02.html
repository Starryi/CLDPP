<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>2. Moving your data to a backup device</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="Linux, Beginners, linux, start, Getting started, guide, Guide, Exercises, exercises"><link rel="home" href="index.html" title="Introduction to Linux"><link rel="up" href="ch09.html" title="Chapter 9. Fundamental Backup Techniques"><link rel="prev" href="ch09s01.html" title="1. Introduction"><link rel="next" href="ch09s03.html" title="3. Using rsync"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2. Moving your data to a backup device</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch09s01.html">Prev</a> </td><th width="60%" align="center">Chapter 9. Fundamental Backup Techniques</th><td width="20%" align="right"> <a accesskey="n" href="ch09s03.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sect_09_02"></a>2. Moving your data to a backup device</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_09_02_01"></a>2.1. Making a copy on a floppy disk</h3></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_09_02_01_01"></a>2.1.1. Formatting the floppy</h4></div></div></div><p>On most Linux systems, users have access to the floppy disk<a class="indexterm" name="idm9245"></a> device.  The name of the device may vary depending on the size and number of floppy drives, contact your system admin if you are unsure.  On some systems, there will likely be a link <code class="filename">/dev/floppy</code> pointing to the right device, probably <code class="filename">/dev/fd0</code> (the auto-detecting floppy device) or <code class="filename">/dev/fd0H1440</code> (set for 1,44MB floppies).</p><p>
<span class="command"><strong>fdformat<a class="indexterm" name="idm9253"></a></strong></span> is the low-level floppy disk formatting tool.  It has the device name of the floppy disk as an option.  <span class="command"><strong>fdformat</strong></span> will display an error when the floppy is write-protected.
</p><pre class="screen">
<code class="prompt">emma:~&gt;</code> <span class="command"><strong>fdformat /dev/fd0H1440</strong></span>
Double-sided, 80 tracks, 18 sec/track. Total capacity 1440 kB.
Formatting ... done
Verifying ... done
<code class="prompt">emma:~&gt;</code>
</pre><p>The <span class="command"><strong>mformat<a class="indexterm" name="idm9262"></a></strong></span> command (from the mtools package) is used to create DOS-compatible floppies which can then be accessed using the <span class="command"><strong>mcopy</strong></span>, <span class="command"><strong>mdir</strong></span> and other m-commands.</p><p>Graphical tools are also available.</p><div class="figure"><a name="idm9267"></a><p class="title"><b>Figure 9.1. Floppy formatter</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/formatfloppy.png" alt="This GUI allows for chosing the FS type and density."></div></div></div><br class="figure-break"><p>After the floppy is formatted, it can be mounted into the file system and accessed as a normal, be it small, directory, usually via the <code class="filename">/mnt/floppy</code> entry.</p><p>Should you need it, install the <span class="command"><strong>mkbootdisk<a class="indexterm" name="idm9280"></a></strong></span> utility, which makes a floppy from which the current system can boot.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_09_02_01_02"></a>2.1.2. Using the <span class="command"><strong>dd</strong></span> command to dump data</h4></div></div></div><p>The <span class="command"><strong>dd<a class="indexterm" name="idm9287"></a></strong></span> command can be used to put data on a disk, or get it off again, depending on the given input and output devices.  An example<a class="indexterm" name="idm9290"></a>:</p><pre class="screen">
<code class="prompt">gaby:~&gt;</code> <span class="command"><strong>dd if=images-without-dir.tar.gz of=/dev/fd0H1440</strong></span>
98+1 records in
98+1 records out

<code class="prompt">gaby~&gt;</code> <span class="command"><strong>dd if=/dev/fd0H1440 of=/var/tmp/images.tar.gz</strong></span>
2880+0 records in
2880+0 records out

<code class="prompt">gaby:~&gt;</code> <span class="command"><strong>ls /var/tmp/images*</strong></span>
/var/tmp/images.tar.gz

</pre><p>Note that the dumping is done on an unmounted device.  Floppies created using this method will not be mountable in the file system, but it is of course the way to go for creating boot or rescue disks.  For more information on the possibilities of <span class="command"><strong>dd</strong></span>, read the man pages.</p><p>This tool is part of the GNU <span class="emphasis"><em>coreutils</em></span> package.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Dumping disks</h3><p>The <span class="command"><strong>dd</strong></span> command can also be used to make a raw dump of an entire hard disk.</p></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_09_02_02"></a>2.2. Making a copy with a CD-writer</h3></div></div></div><p>On some systems users are allowed to use the CD-writer<a class="indexterm" name="idm9310"></a> device.  Your data will need to be formatted first.  Use the <span class="command"><strong>mkisofs<a class="indexterm" name="idm9314"></a></strong></span> command to do this in the directory containing the files you want to backup.  Check with <span class="command"><strong>df<a class="indexterm" name="idm9317"></a></strong></span> that enough disk space is available, because a new file<a class="indexterm" name="idm9319"></a> about the same size as the entire current directory will be created:</p><pre class="screen">
<code class="prompt">[rose@blob recordables]</code> <span class="command"><strong>df -h .</strong></span>
Filesystem            Size  Used Avail Use% Mounted on
/dev/hde5              19G   15G  3.2G  82% /home

<code class="prompt">[rose@blob recordables]</code> <span class="command"><strong>du -h -s .</strong></span>
325M    .

<code class="prompt">[rose@blob recordables]</code> <span class="command"><strong>mkisofs -J -r -o cd.iso .</strong></span>
&lt;--snap--&gt;
making a lot of conversions
&lt;--/snap--&gt;
98.95% done, estimate finish Fri Apr  5 13:54:25 2002
Total translation table size: 0
Total rockridge attributes bytes: 35971
Total directory bytes: 94208
Path table size(bytes): 452
Max brk space used 37e84
166768 extents written (325 Mb)
</pre><p>The <code class="option">-J</code> and <code class="option">-r</code> options are used to make the CD-ROM mountable on different systems, see the man pages for more.  After<a class="indexterm" name="idm9332"></a> that, the CD<a class="indexterm" name="idm9335"></a> can be created using the <span class="command"><strong>cdrecord<a class="indexterm" name="idm9339"></a></strong></span> tool with appropriate options:</p><pre class="screen">
<code class="prompt">[rose@blob recordables]</code> <span class="command"><strong>cdrecord -dev 0,0,0 -speed=8 cd.iso</strong></span>
Cdrecord 1.10 (i686-pc-linux-gnu) (C) 1995-2001 Joerg Schilling
scsidev: '0,0,0'
scsibus: 0 target: 0 lun: 0
Linux sg driver version: 3.1.20
Using libscg version 'schily-0.5'
Device type    : Removable CD-ROM
Version        : 0
Response Format: 1
Vendor_info    : 'HP      '
Identification : 'CD-Writer+ 8100 '
Revision       : '1.0g'
Device seems to be: Generic mmc CD-RW.
Using generic SCSI-3/mmc CD-R driver (mmc_cdr).
Driver flags   : SWABAUDIO
Starting to write CD/DVD at speed 4 in write mode for single session.
Last chance to quit, starting real write in 0 seconds. 
Operation starts.
</pre><p>Depending on your CD-writer, you now have the time to smoke^H^H^H^H^H eat a healthy piece of fruit and/or get a cup of coffee.  Upon finishing the job, you will get a confirmation message:</p><pre class="screen">
Track 01: Total bytes read/written: 341540864/341540864 
          (166768 sectors).
</pre><p>There are some graphical tools available to make it easier on you.  One of the popular ones is <span class="command"><strong>xcdroast<a class="indexterm" name="idm9348"></a></strong></span>, which is freely available from <a class="ulink" href="http://www.xcdroast.org/" target="_top">the X-CD-Roast web site</a> and is included on most systems and in the GNU directory.  Both the KDE and Gnome desktop managers have facilities to make your own CDs.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_09_02_03"></a>2.3. Backups on/from jazz drives, USB devices and other removables</h3></div></div></div><p>These devices are usually mounted into the file system.  After the mount procedure, they are accessed as normal directories, so you can use the standard commands for manipulating files.</p><p>In the example below, images are copied from a USB<a class="indexterm" name="idm9358"></a> camera to the hard disk:</p><pre class="screen">
<code class="prompt">robin:~&gt;</code> <span class="command"><strong>mount <code class="filename">/mnt/camera</code></strong></span>

<code class="prompt">robin:~&gt;</code> <span class="command"><strong>mount | grep <em class="parameter"><code>camera</code></em></strong></span>
/dev/sda1 on /mnt/camera type vfat (rw,nosuid,nodev)
</pre><p>If the camera<a class="indexterm" name="idm9369"></a> is the only USB storage device that you ever connect to your system, this is safe.  But keep in mind that USB devices are assigned entries in <code class="filename">/dev</code> as they are connected to the system.  Thus, if you first connect a USB stick to your system, it will be on the <code class="filename">/dev/sda</code> entry, and if you connect your camera after that, it will be assigned to <code class="filename">/dev/sdb</code> - provided that you do not have any SCSI disks, which are also on <code class="filename">/dev/sd*</code>.  On newer systems, since kernel 2.6, a hotplug system called HAL (Hardware Abstraction Layer) ensures that users don't have to deal with this burden.  If you want to check where your device is, type <span class="command"><strong>dmesg<a class="indexterm" name="idm9377"></a></strong></span> after inserting<a class="indexterm" name="idm9380"></a> it.</p><p>You can now copy the files:</p><pre class="screen">
<code class="prompt">robin:~&gt;</code> <span class="command"><strong>cp -R /mnt/camera/* images/</strong></span>

<code class="prompt">robin:~&gt;</code> <span class="command"><strong>umount /mnt/camera</strong></span>
</pre><p>Likewise, a jazz drive may be mounted on <code class="filename">/mnt/jazz</code>.</p><p>Appropriate lines should be added in <code class="filename">/etc/modules.conf<a class="indexterm" name="idm9392"></a></code> and <code class="filename">/etc/fstab<a class="indexterm" name="idm9395"></a></code> to make this work.  Refer to specific hardware HOWTOs for more information.  On systems with a 2.6.x kernel or higher, you may also want to check the man pages for <span class="command"><strong>modprobe</strong></span> and <code class="filename">modprobe.conf</code>.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_09_02_04"></a>2.4. Backing up data using a tape device</h3></div></div></div><p>This is done using <span class="command"><strong>tar</strong></span> (see above).  The <span class="command"><strong>mt<a class="indexterm" name="idm9404"></a></strong></span> tool is used for controlling the magnetic tape<a class="indexterm" name="idm9406"></a> device, like <code class="filename">/dev/st0</code>.  Entire books have been written about tape backup, therefore, refer to our reading-list in <a class="xref" href="apb.html" title="Appendix B. DOS versus Linux commands">Appendix B, <i>DOS versus Linux commands</i></a> for more information.  Keep in mind that databases might need other backup procedures because of their architecture.</p><p>The appropriate backup commands are usually put in one of the <span class="emphasis"><em>cron</em></span> directories in order to have them executed on a regular basis.  In larger environments, the freely available <a class="ulink" href="http://www.amanda.org" target="_top">Amanda</a> backup suite or a commercial solution may be implemented to back up multiple machines.  Working with tapes, however, is a system administration task beyond the scope of this document.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_09_02_05"></a>2.5. Tools from your distribution</h3></div></div></div><p>Most Linux distributions offer their own tools<a class="indexterm" name="idm9417"></a> for making your life easy.  A short overview:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SuSE: <span class="application">YaST</span> now includes expanded backup and restore modules.</p></li><li class="listitem"><p>RedHat: the <span class="application">File Roller</span> tool provides visual management of (compressed) archives.  They seem to be in favour of the X-CD-Roast tool for moving backups to an external device.</p></li><li class="listitem"><p>Mandrake: X-CD-Roast.</p></li><li class="listitem"><p>Most distributions come with the BSD <span class="command"><strong>dump<a class="indexterm" name="idm9432"></a></strong></span> and <span class="command"><strong>restore<a class="indexterm" name="idm9435"></a></strong></span> utilities for making backups of <span class="emphasis"><em>ext2</em></span> and <span class="emphasis"><em>ext3</em></span> file systems.  This tool can write to a variety of devices and literally dumps the file(s) or file system bit per bit onto the specified device.  Like <span class="command"><strong>dd</strong></span>, this allows for backing up special file types such as the ones in <code class="filename">/dev</code>.</p></li></ul></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch09s01.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch09.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch09s03.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">1. Introduction </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 3. Using rsync</td></tr></table></div></body></html>
