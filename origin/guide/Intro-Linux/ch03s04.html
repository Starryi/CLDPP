<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>4. File security</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="Linux, Beginners, linux, start, Getting started, guide, Guide, Exercises, exercises"><link rel="home" href="index.html" title="Introduction to Linux"><link rel="up" href="ch03.html" title="Chapter 3. About files and the file system"><link rel="prev" href="ch03s03.html" title="3. Manipulating files"><link rel="next" href="ch03s05.html" title="5. Summary"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. File security</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s03.html">Prev</a> </td><th width="60%" align="center">Chapter 3. About files and the file system</th><td width="20%" align="right"> <a accesskey="n" href="ch03s05.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sect_03_04"></a>4. File security</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_03_04_01"></a>4.1. Access rights: Linux's first line of defense</h3></div></div></div><p>The Linux security model<a class="indexterm" name="idm3770"></a> is based on the one used on UNIX systems, and is as rigid as the UNIX security<a class="indexterm" name="idm3773"></a> model (and sometimes even more), which is already quite robust.  On a Linux system, every file is owned by a user and a group user.  There is also a third category of users, those that are not the user owner and don't belong to the group owning the file.  For each category of users, read, write and execute permissions can be granted or denied.</p><p>We already used the <span class="emphasis"><em>long</em></span> option to list<a class="indexterm" name="idm3778"></a> files using the <span class="command"><strong>ls <code class="option">-l</code></strong></span> command, though for other reasons.  This command also displays<a class="indexterm" name="idm3782"></a> file permissions<a class="indexterm" name="idm3785"></a> for these three user categories; they are indicated by the nine characters that follow the first character, which is the file type indicator at the beginning of the file properties line.  As seen in the examples below, the first three characters in this series of nine display access rights for the actual user that owns the file.  The next three are for the group owner of the file, the last three for other users.  The permissions are always in the same order: read, write, execute for the user, the group and the others.  Some examples:</p><pre class="screen">
<code class="prompt">marise:~&gt;</code> <span class="command"><strong>ls -l To_Do</strong></span>
-rw-rw-r--    1 marise  users      5 Jan 15 12:39 To_Do
<code class="prompt">marise:~&gt;</code> <span class="command"><strong>ls -l /bin/ls</strong></span>
-rwxr-xr-x    1 root    root   45948 Aug  9 15:01 /bin/ls*
</pre><p>The first file is a regular file (first dash).  Users with user name <span class="emphasis"><em>marise</em></span> or users belonging to the group <span class="emphasis"><em>users</em></span> can read and write (change/move/delete) the file, but they can't execute it (second and third dash).  All other users are only allowed to read this file, but they can't write or execute it (fourth and fifth dash).</p><p>The second example is an executable file, the difference: everybody can run this program, but you need to be <span class="emphasis"><em>root</em></span> to change it.</p><p>The Info pages explain how the <span class="command"><strong>ls</strong></span> command handles display of access rights in detail, see the section <span class="emphasis"><em>What information is listed</em></span>.</p><p>For easy use with commands, both access rights or modes and user groups have<a class="indexterm" name="idm3802"></a> a code.  See the tables below.</p><div class="table"><a name="idm3805"></a><p class="title"><b>Table 3.7. Access mode codes</b></p><div class="table-contents"><table class="table" summary="Access mode codes" border="1"><colgroup><col><col></colgroup><thead><tr><th align="left">Code</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left">0 or -</td><td align="left">The access right that is supposed to be on this place is not granted.</td></tr><tr><td align="left">4 or r</td><td align="left">read access is granted to the user category defined in this place</td></tr><tr><td align="left">2 or w</td><td align="left">write permission is granted to the user category defined in this place</td></tr><tr><td align="left">1 or x</td><td align="left">execute permission is granted to the user category defined in this place</td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="idm3825"></a><p class="title"><b>Table 3.8. User group codes</b></p><div class="table-contents"><table class="table" summary="User group codes" border="1"><colgroup><col><col></colgroup><thead><tr><th align="left">Code</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left">u</td><td align="left">user permissions</td></tr><tr><td align="left">g</td><td align="left">group permissions</td></tr><tr><td align="left">o</td><td align="left">permissions for others</td></tr></tbody></table></div></div><br class="table-break"><p>This straight forward scheme is applied very strictly, which allows a high level of security even without network security.  Among other functions, the security scheme takes care of user access to programs, it can serve files on a need-to-know basis and protect sensitive data such as home directories and system configuration files.</p><p>You should know what your user name<a class="indexterm" name="idm3844"></a> is.  If you don't, it can be displayed using the <span class="command"><strong>id<a class="indexterm" name="idm3848"></a></strong></span> command, which also displays the default group you belong to and eventually other groups of which you are a member:</p><pre class="screen">
<code class="prompt">tilly:~&gt;</code> <span class="command"><strong>id</strong></span>
uid=504(tilly) gid=504(tilly) groups=504(tilly),100(users),2051(org)
</pre><p>Your user name is also stored in the environment variable <code class="varname">USER</code>:</p><pre class="screen">
<code class="prompt">tilly:~&gt;</code> <span class="command"><strong>echo $USER</strong></span>
tilly
</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_03_04_02"></a>4.2. The tools</h3></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_03_04_02_01"></a>4.2.1. The chmod command</h4></div></div></div><p>A normal consequence of applying strict file permissions<a class="indexterm" name="idm3863"></a>, and sometimes a nuisance, is that access rights will need to be changed for all kinds of reasons.  We use the <span class="command"><strong>chmod<a class="indexterm" name="idm3867"></a></strong></span> command to do this, and eventually <span class="emphasis"><em>to chmod<a class="indexterm" name="idm3870"></a></em></span> has become an almost acceptable English verb, meaning the changing of the access mode of a file.  The <span class="command"><strong>chmod</strong></span> command can be used with alphanumeric or numeric options, whatever you like best.</p><p>The example<a class="indexterm" name="idm3874"></a> below uses alphanumeric options  in order to solve a problem that commonly occurs with new users:</p><pre class="screen">
<code class="prompt">asim:~&gt;</code> <span class="command"><strong>./hello</strong></span>
bash: ./hello: bad interpreter: Permission denied

<code class="prompt">asim:~&gt;</code> <span class="command"><strong>cat hello</strong></span>
#!/bin/bash
echo "Hello, World"

<code class="prompt">asim:~&gt;</code> <span class="command"><strong>ls -l hello</strong></span>
-rw-rw-r--    1 asim    asim    32 Jan 15 16:29 hello

<code class="prompt">asim:~&gt;</code> <span class="command"><strong>chmod u+x hello</strong></span>

<code class="prompt">asim:~&gt;</code> <span class="command"><strong>./hello</strong></span>
Hello, World

<code class="prompt">asim:~&gt;</code> <span class="command"><strong>ls -l hello</strong></span>
-rwxrw-r--   1 asim    asim    32 Jan 15 16:29 hello*
</pre><p>The <span class="command"><strong>+</strong></span> and <span class="command"><strong>-</strong></span> operators are used to grant or deny a given right to a given group.  Combinations separated by commas are allowed.  The Info and man pages contain useful examples.  Here's another one, which makes the file from the previous example a private file to user <span class="emphasis"><em>asim</em></span>:</p><pre class="screen">
<code class="prompt">asim:~&gt;</code> <span class="command"><strong>chmod u+rwx,go-rwx hello</strong></span>

<code class="prompt">asim:~&gt;</code> <span class="command"><strong>ls -l hello</strong></span>
-rwx------    1 asim    asim    32 Jan 15 16:29 hello*
</pre><p>The kind of problem resulting in an error message saying that permission is denied somewhere is usually a problem with access rights in most cases.  Also, comments like, <span class="quote">&#8220;<span class="quote">It worked yesterday,</span>&#8221;</span> and <span class="quote">&#8220;<span class="quote">When I run this as root it works,</span>&#8221;</span> are most likely caused by the wrong file permissions.</p><p>When using <span class="command"><strong>chmod</strong></span> with numeric arguments, the values for each granted access right have to be counted together per group.  Thus we get a 3-digit number, which is the symbolic value for the settings <span class="command"><strong>chmod</strong></span> has to make.  The following table lists the most common<a class="indexterm" name="idm3905"></a> combinations:</p><div class="table"><a name="idm3908"></a><p class="title"><b>Table 3.9. File protection with chmod</b></p><div class="table-contents"><table class="table" summary="File protection with chmod" border="1"><colgroup><col><col></colgroup><thead><tr><th align="left">Command</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><span class="command"><strong>chmod <em class="parameter"><code>400</code></em> <code class="filename">file</code></strong></span></td><td align="left">To protect a file against accidental overwriting.</td></tr><tr><td align="left"><span class="command"><strong>chmod <em class="parameter"><code>500</code></em> <code class="filename">directory</code></strong></span></td><td align="left">To protect yourself from accidentally removing, renaming or moving files from this directory.</td></tr><tr><td align="left"><span class="command"><strong>chmod <em class="parameter"><code>600</code></em> <code class="filename">file</code></strong></span></td><td align="left">A private file only changeable by the user who entered this command.</td></tr><tr><td align="left"><span class="command"><strong>chmod <em class="parameter"><code>644</code></em> <code class="filename">file</code></strong></span></td><td align="left">A publicly readable file that can only be changed by the issuing user.</td></tr><tr><td align="left"><span class="command"><strong>chmod <em class="parameter"><code>660</code></em> <code class="filename">file</code></strong></span></td><td align="left">Users belonging to your group can change this file, others don't have any access to it at all.</td></tr><tr><td align="left"><span class="command"><strong>chmod <em class="parameter"><code>700</code></em> <code class="filename">file</code></strong></span></td><td align="left">Protects a file against any access from other users, while the issuing user still has full access.</td></tr><tr><td align="left"><span class="command"><strong>chmod <em class="parameter"><code>755</code></em> <code class="filename">directory</code></strong></span></td><td align="left">For files that should be readable and executable by others, but only changeable by the issuing user.</td></tr><tr><td align="left"><span class="command"><strong>chmod <em class="parameter"><code>775</code></em> <code class="filename">file</code></strong></span></td><td align="left">Standard file sharing mode for a group.</td></tr><tr><td align="left"><span class="command"><strong>chmod <em class="parameter"><code>777</code></em> <code class="filename">file</code></strong></span></td><td align="left">Everybody can do everything to this file.</td></tr></tbody></table></div></div><br class="table-break"><p>If you enter a number with less than three digits as an argument to <span class="command"><strong>chmod</strong></span>, omitted characters are replaced with zeros starting from the left.  There is actually a fourth digit on Linux systems, that precedes the first three and sets special access modes.  Everything about these and many more are located in the Info pages.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_03_04_02_02"></a>4.2.2. Logging on to another group</h4></div></div></div><p>When you type <span class="command"><strong>id<a class="indexterm" name="idm3976"></a></strong></span> on the command line, you get a list of all the groups<a class="indexterm" name="idm3978"></a> that you can possibly belong to, preceded by your user name and ID and the group name and ID that you are currently connected with.  However, on many Linux systems you can only be actively logged in to one group at the time.  By default, this active or <span class="emphasis"><em>primary group<a class="indexterm" name="idm3982"></a></em></span> is the one that you get assigned from the <code class="filename">/etc/passwd<a class="indexterm" name="idm3986"></a></code> file.  The fourth field of this file holds users' primary group ID, which is looked up in the <code class="filename">/etc/group<a class="indexterm" name="idm3989"></a></code> file.  An example:</p><pre class="screen">
<code class="prompt">asim:~&gt;</code> <span class="command"><strong>id</strong></span>
uid=501(asim) gid=501(asim) groups=100(users),501(asim),3400(web)

<code class="prompt">asim:~&gt;</code> <span class="command"><strong>grep <em class="parameter"><code>asim</code></em> <code class="filename">/etc/passwd</code></strong></span>
asim:x:501:501:Asim El Baraka:/home/asim:/bin/bash

<code class="prompt">asim:~&gt;</code> <span class="command"><strong>grep <em class="parameter"><code>501</code></em> <code class="filename">/etc/group</code></strong></span>
asim:x:501:
</pre><p>The fourth field in the line from <code class="filename">/etc/passwd</code> contains the value <span class="quote">&#8220;<span class="quote">501</span>&#8221;</span>, which represents the group <span class="emphasis"><em>asim</em></span> in the above example.  From <code class="filename">/etc/group</code> we can get the name matching this group ID.  When initially connecting to the system, this is the group that <span class="emphasis"><em>asim</em></span> will belong to.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">User private group scheme</h3><p>In order to allow<a class="indexterm" name="idm4011"></a> more flexibility, most Linux systems follow the so-called <span class="emphasis"><em>user private group scheme</em></span>, that assigns each user primarily to his or her own group.  This group is a group that only contains this particular user, hence the name <span class="quote">&#8220;<span class="quote">private group</span>&#8221;</span>.  Usually this group has the same name as the user login name, which can be a bit confusing.</p></div><p>Apart from his own private group, user <span class="emphasis"><em>asim</em></span> can also be in the groups <span class="emphasis"><em>users</em></span> and <span class="emphasis"><em>web</em></span>.  Because these are secondary groups to this user, he will need to use the <span class="command"><strong>newgrp<a class="indexterm" name="idm4021"></a></strong></span> to log into any of these groups (use <span class="command"><strong>gpasswd</strong></span> for setting the group password first).  In the example<a class="indexterm" name="idm4024"></a>, <span class="emphasis"><em>asim</em></span> needs to create files that are owned by the group <span class="emphasis"><em>web</em></span>.</p><pre class="screen">
<code class="prompt">asim:/var/www/html&gt;</code> <span class="command"><strong>newgrp <em class="parameter"><code>web</code></em></strong></span>

<code class="prompt">asim:/var/www/html&gt;</code> <span class="command"><strong>id</strong></span>
uid=501(asim) gid=3400(web) groups=100(users),501(asim),3400(web)
</pre><p>When <span class="emphasis"><em>asim</em></span> creates new files now, they will be in group ownership of the group <span class="emphasis"><em>web</em></span> instead of being owned by the group <span class="emphasis"><em>asim</em></span>:</p><pre class="screen">
<code class="prompt">asim:/var/www/html&gt;</code> <span class="command"><strong>touch <code class="filename">test</code></strong></span>

<code class="prompt">asim:/var/www/html&gt;</code> <span class="command"><strong>ls <code class="option">-l</code> <code class="filename">test</code></strong></span>
-rw-rw-r--  1 asim web   0 Jun 10 15:38 test
</pre><p>Logging in to a new group prevents you from having to use <span class="command"><strong>chown<a class="indexterm" name="idm4049"></a></strong></span> (see <a class="xref" href="ch03s04.html#sect_03_04_02_04" title="4.2.4. Changing user and group ownership">Section 4.2.4, &#8220;Changing user and group ownership&#8221;</a>) or calling your system administrator to change ownerships for you.</p><p>See the manpage for <span class="command"><strong>newgrp</strong></span> for more information.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_03_04_02_03"></a>4.2.3. The file mask</h4></div></div></div><p>When a new file is saved somewhere, it is first subjected to the standard security procedure.  Files without permissions don't exist on Linux.  The standard file<a class="indexterm" name="idm4057"></a> permission is determined by the <span class="emphasis"><em>mask<a class="indexterm" name="idm4061"></a></em></span> for new file creation.  The value of this mask can be displayed using the <span class="command"><strong>umask<a class="indexterm" name="idm4064"></a></strong></span> command:</p><pre class="screen">
<code class="prompt">bert:~&gt;</code> <span class="command"><strong>umask</strong></span>
0002
</pre><p>Instead of adding the symbolic values to each other, as with <span class="command"><strong>chmod</strong></span>, for calculating the permission on a new file they need to be subtracted from the total possible access rights.  In the example above, however, we see 4 values displayed, yet there are only 3 permission categories: <span class="emphasis"><em>user</em></span>, <span class="emphasis"><em>group</em></span> and <span class="emphasis"><em>other</em></span>.  The first zero is part of the special file attributes settings, which we will discuss in <a class="xref" href="ch03s04.html#sect_03_04_02_04" title="4.2.4. Changing user and group ownership">Section 4.2.4, &#8220;Changing user and group ownership&#8221;</a> and <a class="xref" href="ch04s01.html#sect_04_01_06" title="1.6. SUID and SGID">Section 1.6, &#8220;SUID and SGID&#8221;</a>.  It might just as well be that this first zero is not displayed on your system when entering the <span class="command"><strong>umask</strong></span> command, and that you only see 3 numbers representing the default file creation mask.</p><p>Each UNIX-like system has a system function for creating new files, which is called each time a user uses a program that creates new files, for instance, when downloading a file from the Internet, when saving a new text document and so on.  This function creates both new files and new directories.  Full read, write and execute permission is granted to everybody when creating a new directory.  When creating a new file, this function will grant read and write permissions for everybody, but set execute permissions to none for all user categories.  This, before the mask is applied, a directory has permissions <span class="emphasis"><em>777</em></span> or <span class="emphasis"><em>rwxrwxrwx</em></span>, a plain file <span class="emphasis"><em>666</em></span> or <span class="emphasis"><em>rw-rw-rw-</em></span>.</p><p>The <span class="emphasis"><em>umask</em></span> value is subtracted from these default permissions after the function has created the new file or directory.  Thus, a directory will have permissions of <span class="emphasis"><em>775</em></span> by default, a file <span class="emphasis"><em>664</em></span>, if the mask value is <span class="emphasis"><em>(0)002</em></span>.  This is demonstrated in the example below:</p><pre class="screen">
<code class="prompt">bert:~&gt;</code> <span class="command"><strong>mkdir newdir</strong></span>

<code class="prompt">bert:~&gt;</code> <span class="command"><strong>ls -ld newdir</strong></span>
drwxrwxr-x    2 bert    bert		4096 Feb 28 13:45 newdir/

<code class="prompt">bert:~&gt;</code> <span class="command"><strong>touch newfile</strong></span>

<code class="prompt">bert:~&gt;</code> <span class="command"><strong>ls -l newfile</strong></span>
-rw-rw-r--    1 bert    bert		   0 Feb 28 13:52 newfile
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Files versus directories</h3><p>A directory gets more permissions by default: it always has the <span class="emphasis"><em>execute</em></span> permission.  If it wouldn't have that, it would not be accessible.  Try this out by chmodding a directory 644!</p></div><p>If you log in to another group using the <span class="command"><strong>newgrp</strong></span> command, the mask remains unchanged.  Thus, if it is set to <span class="emphasis"><em>002</em></span>, files and directories that you create while being in the new group will also be accessible to the other members of that group; you don't have to use <span class="command"><strong>chmod</strong></span>.</p><p>The <span class="emphasis"><em>root<a class="indexterm" name="idm4106"></a></em></span> user usually has stricter default file creation permissions:</p><pre class="screen">
[root@estoban root]# umask
022
</pre><p>These defaults are set system-wide in the shell resource configuration files, for instance <code class="filename">/etc/bashrc<a class="indexterm" name="idm4112"></a></code> or <code class="filename">/etc/profile<a class="indexterm" name="idm4115"></a></code>.  You can change them in your own shell configuration file, see <a class="xref" href="ch07.html" title="Chapter 7. Home sweet /home">Chapter 7, <i>Home sweet /home</i></a> on customizing your shell environment.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_03_04_02_04"></a>4.2.4. Changing user and group ownership</h4></div></div></div><p>When a file<a class="indexterm" name="idm4121"></a> is owned by the wrong user or group<a class="indexterm" name="idm4124"></a>, the error can be repaired with the <span class="command"><strong>chown<a class="indexterm" name="idm4128"></a></strong></span> (change owner) and <span class="command"><strong>chgrp<a class="indexterm" name="idm4131"></a></strong></span> (change group) commands.  Changing file ownership is a frequent system administrative task in environments where files need to be shared in a group.  Both commands are very flexible, as you can find out by using the <code class="option">--help</code> option.</p><p>The <span class="command"><strong>chown</strong></span> command can be applied to change both user and group ownership of a file, while <span class="command"><strong>chgrp</strong></span> only changes group ownership.  Of course the system will check if the user issuing one of these commands has sufficient permissions on the file(s) she wants to change.</p><p>In order to only change the user ownership of a file, use this syntax<a class="indexterm" name="idm4138"></a>:</p><div class="cmdsynopsis"><p><code class="command">chown <em class="parameter"><code>newuser</code></em> <code class="filename">file</code></code> </p></div><p>If you use a colon after the user name (see the Info pages), group ownership will be changed as well, to the primary group of the user issuing the command.  On a Linux system, each user has his own group, so this form can be used to make files<a class="indexterm" name="idm4146"></a> private:</p><pre class="screen">
<code class="prompt">jacky:~&gt;</code> <span class="command"><strong>id</strong></span>
uid=1304(jacky) gid=(1304) groups=1304(jacky),2034(pproject)

<code class="prompt">jacky:~&gt;</code> <span class="command"><strong>ls -l my_report</strong></span>
-rw-rw-r--  1 jacky   project       29387 Jan 15 09:34 my_report

<code class="prompt">jacky:~&gt;</code> <span class="command"><strong>chown jacky: my_report</strong></span>

<code class="prompt">jacky:~&gt;</code> <span class="command"><strong>chmod o-r my_report</strong></span>

<code class="prompt">jacky:~&gt;</code> <span class="command"><strong>ls -l my_report</strong></span>
-rw-rw----  1 jacky   jacky         29387 Jan 15 09:34 my_report
</pre><p>If <span class="emphasis"><em>jacky</em></span> would like to share this file, without having to give everybody permission to write it, he can use the <span class="command"><strong>chgrp</strong></span> command<a class="indexterm" name="idm4163"></a>:</p><pre class="screen">
<code class="prompt">jacky:~&gt;</code> <span class="command"><strong>ls -l report-20020115.xls</strong></span>
-rw-rw---- 1 jacky   jacky   45635 Jan 15 09:35 report-20020115.xls

<code class="prompt">jacky:~&gt;</code> <span class="command"><strong>chgrp project report-20020115.xls</strong></span>

<code class="prompt">jacky:~&gt;</code> <span class="command"><strong>chmod o= report-20020115.xls</strong></span>

<code class="prompt">jacky:~&gt;</code> <span class="command"><strong>ls -l report-20020115.xls</strong></span>
-rw-rw---- 1 jacky   project 45635 Jan 15 09:35 report-20020115.xls
</pre><p>This way, users in the group <span class="emphasis"><em>project</em></span> will be able to work on this file.  Users not in this group have no business with it at all.</p><p>Both <span class="command"><strong>chown</strong></span> and <span class="command"><strong>chgrp</strong></span> can be used to change ownership<a class="indexterm" name="idm4180"></a> recursively, using the <code class="option">-R</code> option.  In that case, all underlying files and subdirectories of a given directory will belong to the given user and/or group.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Restrictions</h3><p>On most systems, the use of the <span class="command"><strong>chown</strong></span> and <span class="command"><strong>chgrp</strong></span> commands is restricted for non-privileged<a class="indexterm" name="idm4189"></a> users.  If you are not the administrator of the system, you can not change user nor group ownerships for security reasons.  If the usage of these commands would not be restricted, malicious users could assign ownership of files to other users and/or groups and change behavior of those users' environments and even cause damage to other users' files.</p></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="sect_03_04_02_05"></a>4.2.5. Special modes</h4></div></div></div><p>For the system admin to not be bothered solving permission problems all the time, special access<a class="indexterm" name="idm4195"></a> rights can be given to entire directories, or to separate programs.  There are three special modes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Sticky bit<a class="indexterm" name="idm4201"></a> mode: After execution of a job, the command is kept in the system memory.  Originally this was a feature used a lot to save memory: big jobs are loaded into memory only once.  But these days memory is inexpensive and there are better techniques to manage it, so it is not used anymore for its optimizing capabilities on single files.  When applied to an entire directory, however, the sticky bit has a different meaning.  In that case, a user can only change files in this directory when she is the user owner of the file or when the file has appropriate permissions.  This feature is used on directories like <code class="filename">/var/tmp</code>, that have to be accessible for everyone, but where it is not appropriate for users to change or delete each other's data.  The sticky bit is indicated by a <span class="emphasis"><em>t</em></span> at the end of the file permission field:</p><pre class="screen">
<code class="prompt">mark:~&gt;</code> <span class="command"><strong>ls -ld /var/tmp</strong></span>
drwxrwxrwt   19 root     root         8192 Jan 16 10:37 /var/tmp/
</pre><p>The sticky bit is set using the command <span class="command"><strong>chmod <em class="parameter"><code>o+t</code></em> <code class="filename">directory</code></strong></span>.  The historic origin of the <span class="quote">&#8220;<span class="quote">t</span>&#8221;</span> is in UNIX' <span class="emphasis"><em>save Text access</em></span> feature.</p></li><li class="listitem"><p>SUID<a class="indexterm" name="idm4216"></a> (set user ID<a class="indexterm" name="idm4218"></a>) and SGID (set group ID<a class="indexterm" name="idm4221"></a>): represented by the character <span class="emphasis"><em>s</em></span> in the user or group permission field.  When this mode is set on an executable file, it will run with the user and group permissions on the file instead of with those of the user issuing the command, thus giving access to system resources.  We will discuss this further in <a class="xref" href="ch04.html" title="Chapter 4. Processes">Chapter 4, <i>Processes</i></a>.</p></li><li class="listitem"><p>SGID<a class="indexterm" name="idm4228"></a> (set group ID) on a directory: in this special case every file created in the directory will have the same group owner as the directory itself (while normal behavior would be that new files are owned by the users who create them).  This way, users don't need to worry about file ownership when sharing directories:</p><pre class="screen">
<code class="prompt">mimi:~&gt;</code> <span class="command"><strong>ls -ld /opt/docs</strong></span>
drwxrws---  4 root    users          4096 Jul 25 2001 docs/

<code class="prompt">mimi:~&gt;</code> <span class="command"><strong>ls -l /opt/docs</strong></span>
-rw-rw----  1 mimi    users        345672 Aug 30 2001-Council.doc
</pre><p>This is the standard way of sharing files<a class="indexterm" name="idm4236"></a> in UNIX.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Existing files are left unchanged!</h3><p>Files that are being moved to a SGID directory but were created elsewhere keep their original user and group owner.  This may be confusing.</p></div></li></ul></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s03.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch03.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch03s05.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3. Manipulating files </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 5. Summary</td></tr></table></div></body></html>
