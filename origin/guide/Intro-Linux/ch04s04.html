<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>4. Scheduling processes</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="Linux, Beginners, linux, start, Getting started, guide, Guide, Exercises, exercises"><link rel="home" href="index.html" title="Introduction to Linux"><link rel="up" href="ch04.html" title="Chapter 4. Processes"><link rel="prev" href="ch04s03.html" title="3. Managing processes"><link rel="next" href="ch04s05.html" title="5. Summary"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. Scheduling processes</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04s03.html">Prev</a> </td><th width="60%" align="center">Chapter 4. Processes</th><td width="20%" align="right"> <a accesskey="n" href="ch04s05.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sect_04_04"></a>4. Scheduling processes</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_04_04_01"></a>4.1. Use that idle time!</h3></div></div></div><p>A Linux system can have a lot to suffer from, but it usually suffers<a class="indexterm" name="idm5744"></a> only during office hours.  Whether in an office environment, a server room or at home, most Linux systems are just idling away during the morning, the evening, the nights and weekends.  Using this idle time can be a lot cheaper than buying those machines you'd absolutely need if you want everything done at the same time.</p><p>There are three types<a class="indexterm" name="idm5748"></a> of delayed execution:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Waiting a little while and then resuming job execution, using the <span class="command"><strong>sleep<a class="indexterm" name="idm5755"></a></strong></span> command.  Execution time depends on the system time at the moment of submission.</p></li><li class="listitem"><p>Running a command at a specified<a class="indexterm" name="idm5759"></a> time, using the <span class="command"><strong>at</strong></span> command.  Execution of the job(s) depends on system time, not the time of submission.</p></li><li class="listitem"><p>Regularly running a command on a monthly, weekly, daily or hourly basis, using the <span class="command"><strong>cron<a class="indexterm" name="idm5765"></a></strong></span> facilities.</p></li></ul></div><p>The following sections discuss each possibility.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_04_04_02"></a>4.2. The sleep command</h3></div></div></div><p>The Info page on sleep is probably one of the shortest there is.  All <span class="command"><strong>sleep<a class="indexterm" name="idm5772"></a></strong></span> does is wait.  By default the time to wait is expressed in seconds.</p><p>So why does it exist?  Some practical examples<a class="indexterm" name="idm5776"></a>:</p><p>Somebody calls you on the phone, you say "Yes I'll be with you in half an hour" but you're about drowned in work as it is and bound to forget your lunch:</p><div class="cmdsynopsis"><p><code class="command">(sleep <em class="parameter"><code>1800</code></em>; echo <em class="parameter"><code>"Lunch time.."</code></em>) &amp;</code> </p></div><p>When you can't use the <span class="command"><strong>at</strong></span> command for some reason, it's five o'clock, you want to go home but there's still work to do and right now somebody is eating system resources:</p><div class="cmdsynopsis"><p><code class="command">(sleep <em class="parameter"><code>10000</code></em>; myprogram) &amp;</code> </p></div><p>Make sure there's an auto-logout on your system, and that you log out or lock your desktop/office when submitting this kind of job, or run it in a <span class="command"><strong>screen</strong></span> session.</p><p>When you run a series of printouts of large files, but you want other users to be able to print in between:</p><div class="cmdsynopsis"><p><code class="command">lp <code class="filename">lotoftext</code>; sleep <em class="parameter"><code>900</code></em>; lp <code class="filename">hugefile</code>; sleep <em class="parameter"><code>900</code></em>; lp <code class="filename">anotherlargefile</code></code> </p></div><p>Printing files is discussed in <a class="xref" href="ch08.html" title="Chapter 8. Printers and printing">Chapter 8, <i>Printers and printing</i></a>.</p><p>Programmers often use the sleep command to halt script or program execution for a certain time.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_04_04_03"></a>4.3. The at command</h3></div></div></div><p>The <span class="command"><strong>at</strong></span> command<a class="indexterm" name="idm5806"></a> executes commands at a given time, using your default shell unless you tell the command otherwise (see the man page).</p><p>The options to <span class="command"><strong>at</strong></span> are rather user-friendly, which is demonstrated in the examples<a class="indexterm" name="idm5811"></a> below:</p><pre class="screen">
<code class="prompt">steven@home:~&gt;</code> <span class="command"><strong>at tomorrow + 2 days</strong></span>
warning: commands will be executed using (in order) a) $SHELL
        b) login shell c) /bin/sh
<code class="prompt">at&gt;</code> <span class="command"><strong> cat reports | mail myboss@mycompany</strong></span>
<code class="prompt">at&gt;</code> &lt;EOT&gt;
job 1 at 2001-06-16 12:36
</pre><p>Typing <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span> quits the <span class="command"><strong>at</strong></span> utility and generates the <span class="quote">&#8220;<span class="quote">EOT</span>&#8221;</span> message.</p><p>User <span class="emphasis"><em>steven</em></span> does a strange thing here combining two commands; we will study this sort of practice in <a class="xref" href="ch05.html" title="Chapter 5. I/O redirection">Chapter 5, <i>I/O redirection</i></a>, Redirecting Input and Output.</p><pre class="screen">
<code class="prompt">steven@home:~&gt;</code> <span class="command"><strong>at 0237</strong></span>
warning: commands will be executed using (in order) a) $SHELL
        b) login shell c) /bin/sh
<code class="prompt">at&gt;</code> <span class="command"><strong> cd new-programs</strong></span>
<code class="prompt">at&gt;</code> <span class="command"><strong> ./configure; make</strong></span>
<code class="prompt">at&gt;</code> &lt;EOT&gt;
job 2 at 2001-06-14 02:00
</pre><p>The <code class="option">-m</code> option sends mail to the user when the job is done, or explains when a job can't be done.  The command <span class="command"><strong>atq</strong></span> lists jobs; perform this command before submitting jobs in order prevent them from starting at the same time as others.  With the <span class="command"><strong>atrm</strong></span> command you can remove scheduled jobs if you change your mind.</p><p>It is a good idea to pick strange execution<a class="indexterm" name="idm5841"></a> times, because system jobs are often run at <span class="quote">&#8220;<span class="quote">round</span>&#8221;</span> hours, as you can see in <a class="xref" href="ch04s04.html#sect_04_04_04" title="4.4. Cron and crontab">Section 4.4, &#8220;Cron and crontab&#8221;</a> the next section.  For example, jobs are often run at exactly 1 o'clock in the morning (e.g. system indexing to update a standard locate database), so entering a time of 0100 may easily slow your system down rather than fire it up.  To prevent jobs from running all at the same time, you may also use the <span class="command"><strong>batch<a class="indexterm" name="idm5847"></a></strong></span> command, which queues processes and feeds the work in the queue to the system in an evenly balanced way, preventing excessive bursts of system resource usage.  See the Info pages for more information.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sect_04_04_04"></a>4.4. Cron and crontab</h3></div></div></div><p>The cron system is managed by the <span class="command"><strong>cron</strong></span> daemon<a class="indexterm" name="idm5854"></a>.  It gets information about which programs and when they should run from the system's and users' crontab<a class="indexterm" name="idm5857"></a> entries.  Only the root user has access to the system crontabs, while each user should only have access to his own crontabs.  On some systems (some) users may not have access to the cron facility.</p><p>At system startup the cron daemon searches <code class="filename">/var/spool/cron/</code> for crontab entries which are named after accounts in <code class="filename">/etc/passwd</code>, it searches <code class="filename">/etc/cron.d/<a class="indexterm" name="idm5864"></a></code> and it searches <code class="filename">/etc/crontab<a class="indexterm" name="idm5867"></a></code>, then uses this information every minute to check if there is something to be done.  It executes commands as the user who owns the crontab file and mails any output of commands to the owner.</p><p>On systems using <span class="application">Vixie<a class="indexterm" name="idm5871"></a></span> cron, jobs that occur hourly, daily, weekly and monthly are kept in separate directories in <code class="filename">/etc</code> to keep an overview, as opposed to the standard UNIX cron function, where all tasks are entered into one big file.</p><p>Example of a <span class="application">Vixie</span> crontab<a class="indexterm" name="idm5877"></a> file:</p><pre class="screen">
<code class="prompt">[root@blob /etc]#</code> <span class="command"><strong>more crontab</strong></span>
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
HOME=/

# run-parts
# commands to execute every hour
01 * * * * root run-parts /etc/cron.hourly
# commands to execute every day
02 4 * * * root run-parts /etc/cron.daily
# commands to execute every week
22 4 * * 0 root run-parts /etc/cron.weekly
commands to execute every month
42 4 1 * * root run-parts /etc/cron.monthly
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Alternative</h3><p>You could also use the <span class="command"><strong>crontab <code class="option">-l</code></strong></span> command to display crontabs.</p></div><p>Some variables are set, and after that there's the actual scheduling, one line per job, starting with 5 time<a class="indexterm" name="idm5889"></a> and date fields.  The first field contains the minutes (from 0 to 59), the second defines the hour of execution (0-23), the third is day of the month (1-31), then the number of the month (1-12), the last is day of the week (0-7, both 0 and 7 are Sunday).  An asterisk in these fields represents the total acceptable range for the field.  Lists are allowed; to execute a job from Monday to Friday enter 1-5 in the last field, to execute a job on Monday, Wednesday and Friday enter 1,3,5.</p><p>Then comes the user who should run the processes which are listed in the last column.  The example above is from a Vixie cron configuration where root runs the program <span class="command"><strong>run-parts<a class="indexterm" name="idm5894"></a></strong></span> on regular intervals<a class="indexterm" name="idm5896"></a>, with the appropriate directories as options.  In these directories, the actual jobs to be executed at the scheduled time are stored as shell scripts, like this little script that is run daily to update the database used by the <span class="command"><strong>locate</strong></span> command:</p><pre class="screen">
<code class="prompt">billy@ahost cron.daily]$</code> <span class="command"><strong>cat slocate.cron</strong></span>
#!/bin/sh
renice +19 -p $$ &gt;/dev/null 2&gt;&amp;1
/usr/bin/updatedb -f "nfs,smbfs,ncpfs,proc,devpts" -e \
"/tmp,/var/tmp, /usr/tmp,/afs,/net"
</pre><p>Users are supposed to edit their crontabs<a class="indexterm" name="idm5904"></a> in a safe way using the <span class="command"><strong>crontab <code class="option">-e</code></strong></span> command<a class="indexterm" name="idm5909"></a>.  This will prevent a user from accidentally opening more than one copy of his/her crontab file.  The default editor is <span class="command"><strong>vi</strong></span> (see <a class="xref" href="ch06.html" title="Chapter 6. Text editors">Chapter 6, <i>Text editors</i></a>, but you can use any text editor, such as <span class="command"><strong>gvim</strong></span> or <span class="command"><strong>gedit</strong></span> if you feel more comfortable with a GUI editor.</p><p>When you quit, the system will tell you that a new crontab is installed.</p><p>This crontab entry reminds <span class="emphasis"><em>billy</em></span> to go to his sports club every Thursday night:</p><pre class="screen">
<code class="prompt">billy:~&gt;</code> <span class="command"><strong>crontab -l</strong></span>
# DO NOT EDIT THIS FILE - edit the master and reinstall.
# (/tmp/crontab.20264 installed on Sun Jul 20 22:35:14 2003)
# (Cron version -- $Id$)
38 16 * * 3 mail -s "sports evening" billy
</pre><p>After adding a new scheduled task, the system will tell you that a new crontab is installed.  You do not need to restart the <span class="command"><strong>cron</strong></span> daemon for the changes to take effect.  In the example, <span class="emphasis"><em>billy</em></span> added a new line pointing to a backup script:</p><pre class="screen">
<code class="prompt">billy:~&gt;</code> <span class="command"><strong>crontab -e</strong></span>
45 15 * * 3 mail -s "sports evening" billy
4 4 * * 4,7 /home/billy/bin/backup.sh

&lt;--write and quit--&gt;

crontab: installing new crontab

<code class="prompt">billy:~&gt;</code>
</pre><p>The <code class="filename">backup.sh</code> script is executed every Thursday and Sunday.  See <a class="xref" href="ch07s02.html#sect_07_02_07" title="2.5. Shell scripts">Section 2.5, &#8220;Shell scripts&#8221;</a> for an introduction to shell scripting. Keep in mind that output of commands, if any, is mailed to the owner of the crontab file.  If no mail service is configured, you might find the output of your commands in your local mailbox, <code class="filename">/var/spool/mail/&lt;your_username&gt;</code>, a plain text file.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Who runs my commands?</h3><p>You don't have to specify the user who should run the commands.  They are executed with the user's own permissions by default.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04s03.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch04.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch04s05.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3. Managing processes </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 5. Summary</td></tr></table></div></body></html>
