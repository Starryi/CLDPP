<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>2. Application Layer Protocols with Embedded Network Information</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="linux, ip, iproute2, ifconfig, firewall, ARP, NAT, route, routing, route selection, routing selection, network administration"><link rel="home" href="index.html" title="Guide to IP Layer Network Administration with Linux"><link rel="up" href="ch05.html" title="Chapter 5. Network Address Translation (NAT)"><link rel="prev" href="ch05s01.html" title="1. Rationale for and Introduction to NAT"><link rel="next" href="ch05s03.html" title="3. Stateless NAT with iproute2"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2. Application Layer Protocols with Embedded Network Information</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch05s01.html">Prev</a> </td><th width="60%" align="center">Chapter 5. Network Address Translation (NAT)</th><td width="20%" align="right"> <a accesskey="n" href="ch05s03.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="nat-break"></a>2. Application Layer Protocols with Embedded Network Information</h2></div></div></div><p>
      Network address translation is beautifully invisible when it works,
      but has adverse effects on some protocols.
      Some network applications, e.g., FTP, SNMP, H323, LDAP, IRC, make use of
      embedded IP information in the application layer protocol or data
      stream.  Since the 2.0.x kernel
      series (which is not covered here), linux has supported modules which
      inspect and manipulate packet contents on particular types of packets
      when used with NAT or masquerading.
    </p><p>
      FTP is the classic example.  Within the FTP control channel
      (usually established to destination port tcp/21) the client and the
      server exchange IP address and port information.  If the network address
      translation device doesn't manipulate this data, the FTP server will not
      be able to contact the client to provide the data.
    </p><p>
      Passive mode FTP provides the possibility for a network layer which
      requires only outbound TCP connections.  This results in a more NAT
      friendly and firewall friendly protocol, because the connections are
      initiated from the client.
    </p><p>
      Not only are there network applications which break when NAT is involved
      but also network layer protocols.  IPSec is a standards-based
      network-layer security protocol commonly used in VPNs and IPv6 networks.
      There are many different ways to use IPSec, but, when used in AH
      (Authentication Header) mode, NAT will break IPSec functionality.
    </p><p>
      This underscores the importance of determining if NAT is the best
      solution for the problem.  There are kernel modules to help handle many
      (though not all) of the application layer protocol when using NAT, but
      some protocols, such as IPSec in AH mode simply cannot be used with NAT.
    </p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch05s01.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch05.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch05s03.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">1. Rationale for and Introduction to NAT </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 3. Stateless NAT with <span class="command"><strong>iproute2</strong></span></td></tr></table></div></body></html>
