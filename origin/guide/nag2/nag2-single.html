<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Linux Network Administrators Guide</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"></HEAD
><BODY
CLASS="BOOK"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="BOOK"
><A
NAME="LNAG"
></A
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="LNAG"
>Linux Network Administrators Guide</A
></H1
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
><A
HREF="#AEN3"
>Preface</A
></DT
><DD
><DL
><DT
>1. <A
HREF="#AEN12"
>Purpose and Audience for This Book</A
></DT
><DT
>2. <A
HREF="#AEN16"
>Sources of Information</A
></DT
><DT
>3. <A
HREF="#AEN394"
>File System Standards</A
></DT
><DT
>4. <A
HREF="#AEN410"
>Standard Linux Base</A
></DT
><DT
>5. <A
HREF="#AEN425"
>About This Book</A
></DT
><DT
>6. <A
HREF="#AEN453"
>The Official Printed Version</A
></DT
><DT
>7. <A
HREF="#X-087-2-INTRO.OUTLOOK"
>Overview</A
></DT
><DT
>8. <A
HREF="#AEN523"
>Conventions Used in This Book</A
></DT
><DT
>9. <A
HREF="#X-087-2-SUBMITCHANGES"
>Submitting Changes</A
></DT
><DT
>10. <A
HREF="#AEN575"
>Acknowledgments</A
></DT
></DL
></DD
><DT
>1. <A
HREF="#X-087-2-INTRO"
>Introduction to Networking</A
></DT
><DD
><DL
><DT
>1.1. <A
HREF="#X-087-2-INTRO.HISTORY"
>History</A
></DT
><DT
>1.2. <A
HREF="#X-087-2-INTRO.TCPIP"
>TCP/IP Networks</A
></DT
><DT
>1.3. <A
HREF="#X-087-2-INTRO.UUCP"
>UUCP Networks</A
></DT
><DT
>1.4. <A
HREF="#AEN1316"
>Linux Networking</A
></DT
><DT
>1.5. <A
HREF="#AEN1396"
>Maintaining Your System</A
></DT
></DL
></DD
><DT
>2. <A
HREF="#X-087-2-ISSUES"
>Issues of TCP/IP Networking</A
></DT
><DD
><DL
><DT
>2.1. <A
HREF="#X-087-2-ISSUES.INTERFACES"
>Networking Interfaces</A
></DT
><DT
>2.2. <A
HREF="#X-087-2-ISSUES.IP-ADDRESSES"
>IP Addresses</A
></DT
><DT
>2.3. <A
HREF="#X-087-2-ISSUES.ARP"
>Address Resolution</A
></DT
><DT
>2.4. <A
HREF="#X-087-2-ISSUES.ROUTING"
>IP Routing</A
></DT
><DT
>2.5. <A
HREF="#X-087-2-ISSUES.ICMP"
>The Internet Control Message Protocol</A
></DT
><DT
>2.6. <A
HREF="#X-087-2-ISSUES.RESOLVING"
>Resolving Host Names</A
></DT
></DL
></DD
><DT
>3. <A
HREF="#X-087-2-HARDWARE"
>Configuringthe NetworkingHardware</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="#X-087-2-HARDWARE.KERNEL.CONFIG"
>Kernel Configuration</A
></DT
><DT
>3.2. <A
HREF="#X-087-2-HWCONFIG.TOUR"
>A Tour of Linux Network Devices</A
></DT
><DT
>3.3. <A
HREF="#X-087-2-HARDWARE.DRIVERS.ETHERNET"
>Ethernet Installation</A
></DT
><DT
>3.4. <A
HREF="#X-087-2-HARDWARE.DRIVERS.PLIP"
>The PLIP Driver</A
></DT
><DT
>3.5. <A
HREF="#X-087-2-HARDWARE.DRIVERS.SLIP"
>The PPP and SLIP Drivers</A
></DT
><DT
>3.6. <A
HREF="#X-087-2-HARDWARE.OTHER"
>Other Network Types</A
></DT
></DL
></DD
><DT
>4. <A
HREF="#X-087-2-SERIAL"
>Configuring the Serial Hardware</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="#X-087-2-SERIAL.SOFTWARE"
>Communications Software
for Modem Links</A
></DT
><DT
>4.2. <A
HREF="#X-087-2-SERIAL.TTYS"
>Introduction to Serial Devices</A
></DT
><DT
>4.3. <A
HREF="#X-087-2-SERIAL.DEVICES"
>Accessing Serial Devices</A
></DT
><DT
>4.4. <A
HREF="#X-087-2-SERIAL.HARDWARE"
>Serial Hardware</A
></DT
><DT
>4.5. <A
HREF="#X-087-2-SERIAL-CONFIGURATION"
>Using the Configuration Utilities</A
></DT
><DT
>4.6. <A
HREF="#X-087-2-SERIAL.GETTY"
>Serial Devices and the login: Prompt</A
></DT
></DL
></DD
><DT
>5. <A
HREF="#X-087-2-IFACE"
>Configuring TCP/IP Networking</A
></DT
><DD
><DL
><DT
>5.1. <A
HREF="#X-087-2-IFACE.PROCFS"
>Mounting the /proc Filesystem</A
></DT
><DT
>5.2. <A
HREF="#X-087-2-IFACE.BINARIES"
>Installing the Binaries</A
></DT
><DT
>5.3. <A
HREF="#X-087-2-IFACE.HOSTNAME"
>Setting the Hostname</A
></DT
><DT
>5.4. <A
HREF="#X-087-2-IFACE.ADDRESSES"
>Assigning IP Addresses</A
></DT
><DT
>5.5. <A
HREF="#X-087-2-CREATE.SUBNETS"
>Creating Subnets</A
></DT
><DT
>5.6. <A
HREF="#X-087-2-IFACE.SIMPLE-RESOLV"
>Writing hosts and networks Files</A
></DT
><DT
>5.7. <A
HREF="#X-087-2-IFACE.INTERFACE"
>Interface Configuration for IP</A
></DT
><DT
>5.8. <A
HREF="#X-087-2-IFACE.IFCONFIG"
>All About ifconfig</A
></DT
><DT
>5.9. <A
HREF="#X-087-2-IFACE.NETSTAT"
>The netstat Command</A
></DT
><DT
>5.10. <A
HREF="#X-087-2-IFACE.VERIFY.ARP"
>Checking the ARP Tables</A
></DT
></DL
></DD
><DT
>6. <A
HREF="#X-087-2-RESOLV"
>Name Service and Resolver Configuration</A
></DT
><DD
><DL
><DT
>6.1. <A
HREF="#X-087-2-RESOLV.LIBRARY"
>The Resolver Library</A
></DT
><DT
>6.2. <A
HREF="#X-087-2-RESOLV.HOWDNSWORKS"
>How DNS Works</A
></DT
><DT
>6.3. <A
HREF="#X-087-2-RESOLV.NAMED"
>Running named</A
></DT
></DL
></DD
><DT
>7. <A
HREF="#X-087-2-SLIP"
>Serial Line IP</A
></DT
><DD
><DL
><DT
>7.1. <A
HREF="#X-087-2-SLIP.GENERAL"
>General Requirements</A
></DT
><DT
>7.2. <A
HREF="#X-087-2-SLIP.OPERATION"
>SLIP Operation</A
></DT
><DT
>7.3. <A
HREF="#AEN6035"
>Dealing with Private IP Networks</A
></DT
><DT
>7.4. <A
HREF="#X-087-2-SLIP.DIP"
>Using dip</A
></DT
><DT
>7.5. <A
HREF="#X-087-2-SLIP.SERVER"
>Running in Server Mode</A
></DT
></DL
></DD
><DT
>8. <A
HREF="#X-087-2-PPP"
>The Point-to-Point Protocol</A
></DT
><DD
><DL
><DT
>8.1. <A
HREF="#AEN6533"
>PPP on Linux</A
></DT
><DT
>8.2. <A
HREF="#AEN6586"
>Running pppd</A
></DT
><DT
>8.3. <A
HREF="#X-087-2-PPP.OPTIONS"
>Using Options Files</A
></DT
><DT
>8.4. <A
HREF="#AEN6701"
>Using chat to Automate Dialing</A
></DT
><DT
>8.5. <A
HREF="#X-087-2-IPCONFIG.OPTIONS"
>IP Configuration Options</A
></DT
><DT
>8.6. <A
HREF="#AEN6994"
>Link Control Options</A
></DT
><DT
>8.7. <A
HREF="#AEN7063"
>General Security Considerations</A
></DT
><DT
>8.8. <A
HREF="#X-087-2-PPP.AUTHENTICATION"
>Authentication with PPP</A
></DT
><DT
>8.9. <A
HREF="#AEN7287"
>Debugging Your PPP Setup</A
></DT
><DT
>8.10. <A
HREF="#AEN7323"
>More Advanced PPP Configurations</A
></DT
></DL
></DD
><DT
>9. <A
HREF="#X-087-2-FIREWALL"
>TCP/IP Firewall</A
></DT
><DD
><DL
><DT
>9.1. <A
HREF="#X-082-2-FIREWALL.ATTACKS"
>Methods of Attack</A
></DT
><DT
>9.2. <A
HREF="#X-087-2-FIREWALL.INTRODUCTION"
>What Is a Firewall?</A
></DT
><DT
>9.3. <A
HREF="#X-087-2-FIREWALL.FILTERING"
>What Is IP Filtering?</A
></DT
><DT
>9.4. <A
HREF="#X-087-2-FIREWALL.HOWTO"
>Setting Up Linux for Firewalling</A
></DT
><DT
>9.5. <A
HREF="#X-087-2-FIREWALL.FILTERINGMETHODS"
>Three Ways We Can Do Filtering</A
></DT
><DT
>9.6. <A
HREF="#X-087-2-FIREWALL.ORIGINAL"
>Original IP Firewall (2.0 Kernels)</A
></DT
><DT
>9.7. <A
HREF="#X-087-2-FIREWALL.FWCHAINS"
>IP Firewall Chains (2.2 Kernels)</A
></DT
><DT
>9.8. <A
HREF="#X-087-2-FIREWALL.FUTURE"
>Netfilter and IP Tables (2.4 Kernels)</A
></DT
><DT
>9.9. <A
HREF="#X-087-2-FIREWALL.TOS.MANIPULATION"
>TOS Bit Manipulation</A
></DT
><DT
>9.10. <A
HREF="#X-087-2-FIREWALL.CHECKINGCONF"
>Testing a
Firewall Configuration</A
></DT
><DT
>9.11. <A
HREF="#X-087-2-FIREWALL.EXAMPLE"
>A Sample Firewall Configuration</A
></DT
></DL
></DD
><DT
>10. <A
HREF="#X-087-2-ACCOUNTING"
>IP Accounting</A
></DT
><DD
><DL
><DT
>10.1. <A
HREF="#X-087-2-ACCOUNTING.KERNEL.CONFIG"
>Configuring the Kernel for IP Accounting</A
></DT
><DT
>10.2. <A
HREF="#X-087-2-ACCOUNTING.IPFWADM"
>Configuring IP Accounting</A
></DT
><DT
>10.3. <A
HREF="#X-087-2-ACCOUNTING.VIEWING.RESULTS"
>Using IP Accounting Results</A
></DT
><DT
>10.4. <A
HREF="#X-087-2-ACCOUNTING.ZEROING.COUNTER"
>Resetting the Counters</A
></DT
><DT
>10.5. <A
HREF="#X-087-2-ACCOUNTING.FLUSHING.RULES"
>Flushing the Ruleset</A
></DT
><DT
>10.6. <A
HREF="#X-087-2-ACCOUNTING.PASSIVE.COLLECTION"
>Passive Collection of Accounting Data</A
></DT
></DL
></DD
><DT
>11. <A
HREF="#X-087-2-IPMASQ"
>IP Masquerade and Network Address Translation</A
></DT
><DD
><DL
><DT
>11.1. <A
HREF="#X-087-2-MASQ.SIDE.EFFECTS"
>Side Effects and Fringe Benefits</A
></DT
><DT
>11.2. <A
HREF="#X-087-2-MASQ.KERNEL.CONFIG"
>Configuring the Kernel for IP Masquerade</A
></DT
><DT
>11.3. <A
HREF="#X-087-2-MASQ.CONFIGURATION"
>Configuring IP Masquerade</A
></DT
><DT
>11.4. <A
HREF="#X-087-2-MASQ.NAMELOOKUPS"
>Handling Name Server Lookups</A
></DT
><DT
>11.5. <A
HREF="#AEN9869"
>More About Network Address Translation</A
></DT
></DL
></DD
><DT
>12. <A
HREF="#X-087-2-APPL"
>ImportantNetwork Features</A
></DT
><DD
><DL
><DT
>12.1. <A
HREF="#X-087-2-APPL.INETD"
>The inetd Super Server</A
></DT
><DT
>12.2. <A
HREF="#X-087-2-APPL.TCPD"
>The tcpd Access Control Facility</A
></DT
><DT
>12.3. <A
HREF="#X-087-2-APPL.SERVICES"
>The Services and Protocols Files</A
></DT
><DT
>12.4. <A
HREF="#X-087-2-APPL.RPC"
>Remote Procedure Call</A
></DT
><DT
>12.5. <A
HREF="#X-087-2-APPL.REMOTE"
>Configuring Remote Loginand Execution</A
></DT
></DL
></DD
><DT
>13. <A
HREF="#X-087-2-NIS"
>The Network Information System</A
></DT
><DD
><DL
><DT
>13.1. <A
HREF="#AEN10645"
>Getting Acquainted with NIS</A
></DT
><DT
>13.2. <A
HREF="#X-087-2-NIS.NISPLUS"
>NIS Versus NIS+</A
></DT
><DT
>13.3. <A
HREF="#X-087-2-NIS.CLIENTS"
>The Client Side of NIS</A
></DT
><DT
>13.4. <A
HREF="#X-087-2-NIS.SERVER"
>Running an NIS Server</A
></DT
><DT
>13.5. <A
HREF="#X-087-2-NIS.SECURENETS"
>NIS Server Security</A
></DT
><DT
>13.6. <A
HREF="#X-087-2-NIS.YP"
>Setting Up an NIS Client with GNU libc</A
></DT
><DT
>13.7. <A
HREF="#X-087-2-NIS.NSSWITCH"
>Choosing the Right Maps</A
></DT
><DT
>13.8. <A
HREF="#X-087-2-NIS.PASSWD"
>Using the passwd and group Maps</A
></DT
><DT
>13.9. <A
HREF="#X-087-2-NIS.SHADOW"
>Using NIS with Shadow Support</A
></DT
></DL
></DD
><DT
>14. <A
HREF="#X-087-2-NFS"
>The NetworkFile System</A
></DT
><DD
><DL
><DT
>14.1. <A
HREF="#X-087-2-NFS.NFSD"
>Preparing NFS</A
></DT
><DT
>14.2. <A
HREF="#X-087-2-NFS.MOUNTD"
>Mounting an NFS Volume</A
></DT
><DT
>14.3. <A
HREF="#X-087-2-NFS.DAEMONS"
>The NFS Daemons</A
></DT
><DT
>14.4. <A
HREF="#X-087-2-NFS.EXPORTS"
>The exports File</A
></DT
><DT
>14.5. <A
HREF="#X-087-2-NFS.KERNELV2"
>Kernel-Based NFSv2 Server Support</A
></DT
><DT
>14.6. <A
HREF="#X-087-2-NFS.KERNELV3"
>Kernel-Based NFSv3 Server Support</A
></DT
></DL
></DD
><DT
>15. <A
HREF="#X-087-2-IPX"
>IPX and the NCP Filesystem</A
></DT
><DD
><DL
><DT
>15.1. <A
HREF="#AEN11750"
>Xerox, Novell, and History</A
></DT
><DT
>15.2. <A
HREF="#AEN11823"
>IPX and Linux</A
></DT
><DT
>15.3. <A
HREF="#X-087-2-IPX.KERNEL"
>Configuring the Kernel for IPXand NCPFS</A
></DT
><DT
>15.4. <A
HREF="#X-087-2-IPX.INTERFACES"
>Configuring IPX Interfaces</A
></DT
><DT
>15.5. <A
HREF="#X-087-2-IPX.ROUTER"
>Configuring an IPX Router</A
></DT
><DT
>15.6. <A
HREF="#X-087-2-IPX.NCPFS.CLIENT"
>Mounting a Remote NetWare Volume</A
></DT
><DT
>15.7. <A
HREF="#X-087-2-IPX.OTHERTOOLS"
>Exploring Some of the Other IPX Tools</A
></DT
><DT
>15.8. <A
HREF="#X-087-2-IPX.NCPFS.PRINTING"
>Printing to a NetWare Print Queue</A
></DT
><DT
>15.9. <A
HREF="#X-087-2-IPX.NCPFS.SERVER"
>NetWare Server Emulation</A
></DT
></DL
></DD
><DT
>16. <A
HREF="#X-087-2-UUCP"
>ManagingTaylor UUCP</A
></DT
><DD
><DL
><DT
>16.1. <A
HREF="#X-087-2-UUCP.INTRO.GRADES"
>UUCP Transfers and Remote Execution</A
></DT
><DT
>16.2. <A
HREF="#X-087-2-UUCP.CONFIG.FILES"
>UUCP Configuration Files</A
></DT
><DT
>16.3. <A
HREF="#X-087-2-UUCP.PERMISSIONS"
>Controlling Access to UUCP Features</A
></DT
><DT
>16.4. <A
HREF="#X-087-2-UUCP.DIALIN"
>Setting Up Your System for Dialing In</A
></DT
><DT
>16.5. <A
HREF="#X-087-2-UUCP.PROTOCOLS"
>UUCP Low-Level Protocols</A
></DT
><DT
>16.6. <A
HREF="#X-087-2-UUCP.MISC.FAQ"
>Troubleshooting</A
></DT
><DT
>16.7. <A
HREF="#AEN13893"
>Log Files and Debugging</A
></DT
></DL
></DD
><DT
>17. <A
HREF="#X-087-2-MAIL"
>Electronic Mail</A
></DT
><DD
><DL
><DT
>17.1. <A
HREF="#X-087-2-MAIL.MESSAGE-FORMAT"
>What Is a Mail Message?</A
></DT
><DT
>17.2. <A
HREF="#X-087-2-MAIL.DELIVERY"
>How Is Mail Delivered?</A
></DT
><DT
>17.3. <A
HREF="#X-087-2-MAIL.ADDRESS"
>Email Addresses</A
></DT
><DT
>17.4. <A
HREF="#X-087-2-MAIL.ROUTING"
>How Does Mail Routing Work?</A
></DT
><DT
>17.5. <A
HREF="#X-087-2-MAIL.ELM"
>Configuring elm</A
></DT
></DL
></DD
><DT
>18. <A
HREF="#X-087-2-SENDMAIL"
>Sendmail</A
></DT
><DD
><DL
><DT
>18.1. <A
HREF="#AEN14660"
>Introduction to sendmail</A
></DT
><DT
>18.2. <A
HREF="#AEN14681"
>Installing sendmail</A
></DT
><DT
>18.3. <A
HREF="#AEN14718"
>Overview of Configuration Files</A
></DT
><DT
>18.4. <A
HREF="#AEN14735"
>The sendmail.cf and sendmail.mc Files</A
></DT
><DT
>18.5. <A
HREF="#AEN14977"
>Generating the sendmail.cf File</A
></DT
><DT
>18.6. <A
HREF="#AEN14997"
>Interpreting and Writing Rewrite Rules</A
></DT
><DT
>18.7. <A
HREF="#AEN15294"
>Configuring sendmail Options</A
></DT
><DT
>18.8. <A
HREF="#AEN15365"
>Some Useful sendmail Configurations</A
></DT
><DT
>18.9. <A
HREF="#AEN15657"
>Testing Your Configuration</A
></DT
><DT
>18.10. <A
HREF="#AEN15723"
>Running sendmail</A
></DT
><DT
>18.11. <A
HREF="#AEN15765"
>Tips and Tricks</A
></DT
></DL
></DD
><DT
>19. <A
HREF="#X-087-2-EXIM"
>Getting EximUp and Running</A
></DT
><DD
><DL
><DT
>19.1. <A
HREF="#AEN15983"
>Running Exim</A
></DT
><DT
>19.2. <A
HREF="#AEN16038"
>If Your Mail Doesn't Get Through</A
></DT
><DT
>19.3. <A
HREF="#AEN16073"
>Compiling Exim</A
></DT
><DT
>19.4. <A
HREF="#X-087-2-EXIM.QUEUE"
>Mail Delivery Modes</A
></DT
><DT
>19.5. <A
HREF="#X-087-2-EXIM.OPTIONS"
>Miscellaneous config Options</A
></DT
><DT
>19.6. <A
HREF="#X-087-2-EXIM.DELIVERY"
>Message Routing and Delivery</A
></DT
><DT
>19.7. <A
HREF="#AEN16372"
>Protecting Against Mail Spam</A
></DT
><DT
>19.8. <A
HREF="#X-087-2-EXIM.SIMPLE"
>UUCP Setup</A
></DT
></DL
></DD
><DT
>20. <A
HREF="#X-087-2-NEWS"
>Netnews</A
></DT
><DD
><DL
><DT
>20.1. <A
HREF="#X-087-2-NEWS.HISTORY"
>Usenet History</A
></DT
><DT
>20.2. <A
HREF="#X-087-2-NEWS.USENET"
>What Is Usenet, Anyway?</A
></DT
><DT
>20.3. <A
HREF="#X-087-2-NEWS.ALGORITHM"
>How Does Usenet Handle News?</A
></DT
></DL
></DD
><DT
>21. <A
HREF="#X-087-2-CNEWS"
>C News</A
></DT
><DD
><DL
><DT
>21.1. <A
HREF="#X-087-2-CNEWS.RNEWS"
>Delivering News</A
></DT
><DT
>21.2. <A
HREF="#AEN16782"
>Installation</A
></DT
><DT
>21.3. <A
HREF="#X-087-2-CNEWS.SYS"
>The sys File</A
></DT
><DT
>21.4. <A
HREF="#X-087-2-CNEWS.ACTIVE"
>The active File</A
></DT
><DT
>21.5. <A
HREF="#X-087-2-CNEWS.BATCHER"
>Article Batching</A
></DT
><DT
>21.6. <A
HREF="#X-087-2-CNEWS.EXPLIST"
>Expiring News</A
></DT
><DT
>21.7. <A
HREF="#X-087-2-CNEWS.MISC"
>Miscellaneous Files</A
></DT
><DT
>21.8. <A
HREF="#X-087-2-CNEWS.CONTROL"
>Control Messages</A
></DT
><DT
>21.9. <A
HREF="#X-087-2-CNEWS.NFS"
>C News in an NFS Environment</A
></DT
><DT
>21.10. <A
HREF="#X-087-2-CNEWS.MAINT"
>Maintenance Tools and Tasks</A
></DT
></DL
></DD
><DT
>22. <A
HREF="#X-087-2-NNTP"
>NNTP and thenntpd Daemon</A
></DT
><DD
><DL
><DT
>22.1. <A
HREF="#X-087-2-NNTP.PROTOCOL"
>The NNTP Protocol</A
></DT
><DT
>22.2. <A
HREF="#X-087-2-NNTP.NNTPD"
>Installing the NNTP Server</A
></DT
><DT
>22.3. <A
HREF="#X-087-2-NNTP.ACCESS"
>Restricting NNTP Access</A
></DT
><DT
>22.4. <A
HREF="#X-087-2-NNTP.AUTHORIZE"
>NNTP Authorization</A
></DT
><DT
>22.5. <A
HREF="#X-087-2-NNTP.INTERACT"
>nntpd Interaction with C News</A
></DT
></DL
></DD
><DT
>23. <A
HREF="#X-087-2-INN"
>Internet News</A
></DT
><DD
><DL
><DT
>23.1. <A
HREF="#AEN18283"
>Some INN Internals</A
></DT
><DT
>23.2. <A
HREF="#AEN18364"
>Newsreaders and INN</A
></DT
><DT
>23.3. <A
HREF="#AEN18387"
>Installing INN</A
></DT
><DT
>23.4. <A
HREF="#AEN18412"
>Configuring INN: the Basic Setup</A
></DT
><DT
>23.5. <A
HREF="#AEN18427"
>INN Configuration Files</A
></DT
><DT
>23.6. <A
HREF="#AEN19090"
>Running INN</A
></DT
><DT
>23.7. <A
HREF="#AEN19116"
>Managing INN: The ctlinnd Command</A
></DT
></DL
></DD
><DT
>24. <A
HREF="#X-087-2-NEWSREADERS"
>Newsreader Configuration</A
></DT
><DD
><DL
><DT
>24.1. <A
HREF="#X-087-2-NEWSREADERS.TIN"
>tin Configuration</A
></DT
><DT
>24.2. <A
HREF="#X-087-2-NEWSREADERS.TRN"
>trn Configuration</A
></DT
><DT
>24.3. <A
HREF="#X-087-2-NEWSREADERS.NN"
>nn Configuration</A
></DT
></DL
></DD
><DT
>A. <A
HREF="#X-087-2-APPENDIX.BREWERY"
>Example Network:The Virtual Brewery</A
></DT
><DD
><DL
><DT
>A.1. <A
HREF="#AEN19613"
>Connecting the Virtual Subsidiary Network</A
></DT
></DL
></DD
><DT
>B. <A
HREF="#X-087-2-APPENDIX.CABLES"
>Useful Cable Configurations</A
></DT
><DD
><DL
><DT
>B.1. <A
HREF="#X-087-2-CABLE.PLIP"
>A PLIP Parallel Cable</A
></DT
><DT
>B.2. <A
HREF="#X-087-2-CABLE.SERIAL"
>A Serial NULL Modem Cable</A
></DT
></DL
></DD
><DT
>C. <A
HREF="#X-087-2-APPENDIX.GPL"
>Linux Network Administrator's Guide, Second Edition Copyright Information</A
></DT
><DD
><DL
><DT
>C.1. <A
HREF="#AEN19685"
>0. Preamble</A
></DT
><DT
>C.2. <A
HREF="#AEN19690"
>1. Applicability and Definitions</A
></DT
><DT
>C.3. <A
HREF="#AEN19700"
>2. Verbatim Copying</A
></DT
><DT
>C.4. <A
HREF="#AEN19704"
>3. Copying in Quantity</A
></DT
><DT
>C.5. <A
HREF="#AEN19710"
>4. Modifications</A
></DT
><DT
>C.6. <A
HREF="#AEN19746"
>5. Combining Documents</A
></DT
><DT
>C.7. <A
HREF="#AEN19751"
>6. Collections of Documents</A
></DT
><DT
>C.8. <A
HREF="#AEN19755"
>7. Aggregation with Independent Works</A
></DT
><DT
>C.9. <A
HREF="#AEN19759"
>8. Translation</A
></DT
><DT
>C.10. <A
HREF="#AEN19762"
>9. Termination</A
></DT
><DT
>C.11. <A
HREF="#AEN19765"
>10. Future Revisions of this License</A
></DT
></DL
></DD
><DT
>D. <A
HREF="#X-087-2-SAGE.APP"
>SAGE: The SystemAdministrators Guild</A
></DT
><DT
><A
HREF="#DOC-INDEX"
>Index</A
></DT
></DL
></DIV
><DIV
CLASS="LOT"
><DL
CLASS="LOT"
><DT
><B
>List of Tables</B
></DT
><DT
>2-1. <A
HREF="#X-087-2-ISSUES.RESERVED.ADDRESSES"
>IP Address Ranges Reserved for Private Use</A
></DT
><DT
>4-1. <A
HREF="#X-087-2-SERIAL-SETSERIAL-PARAMETERS"
>setserial Command-Line Parameters</A
></DT
><DT
>4-2. <A
HREF="#X-087-2-SERIAL.STTY.FLAGS"
>stty Flags Most Relevant to Configuring Serial Devices</A
></DT
><DT
>7-1. <A
HREF="#X-087-2-SLIP.LINE.DISCIPLINES"
>Linux Slip-Line Disciplines</A
></DT
><DT
>7-2. <A
HREF="#X-087-2-SLIP.DIPHOSTS.FIELDS"
>/etc/diphosts Field Description</A
></DT
><DT
>9-1. <A
HREF="#X-087-2-CHFW-NETMASKS"
>Common Netmask Bit Values</A
></DT
><DT
>9-2. <A
HREF="#X-087-2-CHFW-ICMPTYPES"
>ICMP Datagram Types</A
></DT
><DT
>9-3. <A
HREF="#X-087-2-FIREWALL.IPCHAINS.TOS.RECIPES"
>Suggested Uses for TOS Bitmasks</A
></DT
><DT
>13-1. <A
HREF="#X-087-2-NIS.TABLE.MAPS"
>Some Standard NIS Maps and Corresponding Files</A
></DT
><DT
>15-1. <A
HREF="#X-087-2-IX.PROTOCOL.FAMILY"
>XNS, Novell, and TCP/IP Protocol Relationships</A
></DT
><DT
>15-2. <A
HREF="#X-087-2-IPX.NCPMOUNT.ARGS"
>ncpmount Command Arguments</A
></DT
><DT
>15-3. <A
HREF="#X-087-2-CHIX-BINDERYTOOLS"
>Linux Bindery Manipulation Tools</A
></DT
><DT
>15-4. <A
HREF="#X-087-2-IPX.NPRINT.OPTIONS"
>nprint Command-Line Options</A
></DT
></DL
></DIV
><DIV
CLASS="LOT"
><DL
CLASS="LOT"
><DT
><B
>List of Figures</B
></DT
><DT
>1-1. <A
HREF="#X-087-2-INTRO.FIG.IP-FLOW"
>The three steps of sending a datagram from erdos to quark</A
></DT
><DT
>2-1. <A
HREF="#X-087-2-ISSUES.FIG.SUBNET"
>Subnetting a class B network</A
></DT
><DT
>2-2. <A
HREF="#X-087-2-ISSUES.FIG.IP"
>A part of the net topology at Groucho Marx University</A
></DT
><DT
>3-1. <A
HREF="#X-087-2-HARDWARE.FIG.DRIVERS"
>The relationship between drivers, interfaces, and hardware</A
></DT
><DT
>6-1. <A
HREF="#X-087-2-RESOLV.FIG.DNS"
>A part of the domain namespace</A
></DT
><DT
>9-1. <A
HREF="#X-087-2-FIREWALL.DESIGN.GRAPHIC"
>The two major classes of firewall design</A
></DT
><DT
>9-2. <A
HREF="#X-087-2-FIREWALL.METHODS.GRAPHIC"
>The stages of IP datagram processing</A
></DT
><DT
>9-3. <A
HREF="#X-087-2-FIREWALL.FTP.GRAPHIC"
>FTP server modes</A
></DT
><DT
>9-4. <A
HREF="#X-087-2-FIREWALL.IPCHAINS"
>A simple IP chain ruleset</A
></DT
><DT
>9-5. <A
HREF="#X-087-2-FIREWALL.IPCHAINS.UDP"
>The sequence of rules tested for a received UDP datagram</A
></DT
><DT
>9-6. <A
HREF="#X-087-2-FIREWALL.IPCHAINS.TCP.SSH"
>The rules flow for a received TCP datagram for ssh</A
></DT
><DT
>9-7. <A
HREF="#X-087-2-FIREWALL.IPCHAINS.TCP.OTHER"
>The rules flow for a received TCP datagram for telnet</A
></DT
><DT
>9-8. <A
HREF="#X-087-2-FIREWALL.ROUTING.IPCHAINS"
>Datagram processing chain in IP chains</A
></DT
><DT
>9-9. <A
HREF="#X-087-2-FIREWALL.ROUTING.NETFILTER"
>Datagram processing chain in netfilter</A
></DT
><DT
>11-1. <A
HREF="#X-087-2-MASQUERADE.NET"
>A typical IP masquerade configuration</A
></DT
><DT
>15-1. <A
HREF="#X-087-2-IPX.INTERNAL.NETWORK"
>IPX internal network</A
></DT
><DT
>16-1. <A
HREF="#X-087-2-UUCP.FIG.FILES"
>Interaction of Taylor UUCP configuration files</A
></DT
><DT
>20-1. <A
HREF="#X-087-2-NEWS.FIG.ARTICLE-FLOW"
>Usenet newsflow through Groucho Marx University</A
></DT
><DT
>21-1. <A
HREF="#X-087-2-CNEWS.FIG.FLOW"
>News flow through relaynews</A
></DT
><DT
>23-1. <A
HREF="#X-087-2-INN.INN.ARCHITECTURE"
>INN architecture (simplified for clarity)</A
></DT
><DT
>A-1. <A
HREF="#X-087-2-APPENDIX.BREWERY.DIAGRAM"
>The Virtual Brewery and Virtual Winery subnets</A
></DT
><DT
>A-2. <A
HREF="#X-087-2-APPENDIX.BREWERY.SUBSIDIARY"
>The Virtual Brewery Network</A
></DT
><DT
>B-1. <A
HREF="#X-087-2-CABLE.PLIP.DIAGRAM"
>Parallel PLIP cable</A
></DT
><DT
>B-2. <A
HREF="#X-087-2-CABLE.NULLMODEM.DIAGRAM"
>Serial NULL-Modem cable</A
></DT
></DL
></DIV
><DIV
CLASS="LOT"
><DL
CLASS="LOT"
><DT
><B
>List of Examples</B
></DT
><DT
>4-1. <A
HREF="#X-087-2-SERIAL-RC.SERIAL.SETSERIAL"
>Example rc.serial setserial Commands</A
></DT
><DT
>4-2. <A
HREF="#X-087-2-SERIAL.SETSERIAL.OUTPUT"
>Output of setserial -bg /dev/ttyS Command</A
></DT
><DT
>4-3. <A
HREF="#X-087-2-SERIAL-RC.SERIAL.STTY"
>Example rc.serial stty Commands</A
></DT
><DT
>4-4. <A
HREF="#X-087-2-SERIAL-RC.SERIAL.STTY.NEW"
>Example rc.serial stty Commands Using Modern Syntax</A
></DT
><DT
>4-5. <A
HREF="#X-087-2-SERIAL.STTY.OUTPUT"
>Output of stty -a Command</A
></DT
><DT
>4-6. <A
HREF="#X-087-2-SERIAL.MGETTY.CONF"
>Sample /etc/mgetty/mgetty.config File</A
></DT
><DT
>6-1. <A
HREF="#X-087-2-DNS-HOST.CONF.FILE"
>Sample host.conf File</A
></DT
><DT
>6-2. <A
HREF="#X-087-2-DNS-NSSWITCH.CONF.FILE"
>Sample nsswitch.conf File</A
></DT
><DT
>6-3. <A
HREF="#X-087-2-DNS-NSSWITCH.CONF.FILE.EXTENDED"
>Sample nsswitch.conf File Using an Action Statement</A
></DT
><DT
>6-4. <A
HREF="#X-087-2-RESOLV.FIG.HOSTS"
>An Excerpt from the named.hosts File for the Physics Department</A
></DT
><DT
>6-5. <A
HREF="#X-087-2-RESOLV.FIG.NSPTR"
>An Excerpt from the named.hosts File for GMU</A
></DT
><DT
>6-6. <A
HREF="#X-087-2-RESOLV.FIG.SUBNET12"
>An Excerpt from the named.rev File for Subnet 12</A
></DT
><DT
>6-7. <A
HREF="#X-087-2-RESOLV.FIG.GROUCHO-REV"
>An Excerpt from the named.rev File for Network 149.76</A
></DT
><DT
>6-8. <A
HREF="#X-087-2-RESOLV.FIG.NAMED.BOOT"
>The named.boot File for vlager</A
></DT
><DT
>6-9. <A
HREF="#X-087-2-RESOLV.FIG.NAMED.CONF"
>The BIND 8 equivalent named.conf File for vlager</A
></DT
><DT
>6-10. <A
HREF="#X-087-2-RESOLV.FIG.NAMED.CACHE"
>The named.ca File</A
></DT
><DT
>6-11. <A
HREF="#X-087-2-RESOLV.FIG.NAMED.HOSTS"
>The named.hosts File</A
></DT
><DT
>6-12. <A
HREF="#X-087-2-RESOLV.FIG.NAMED.LOCAL"
>The named.local File</A
></DT
><DT
>6-13. <A
HREF="#X-087-2-RESOLV.FIG.NAMED.REV"
>The named.rev File</A
></DT
><DT
>7-1. <A
HREF="#X-087-2-SLIP.FIG.SCRIPT"
>A Sample dip Script</A
></DT
><DT
>12-1. <A
HREF="#X-087-2-APPL.FIG.INETD.CONF"
>A Sample /etc/inetd.conf File</A
></DT
><DT
>12-2. <A
HREF="#X-087-2-ETC.SERVICES"
>A Sample /etc/services File</A
></DT
><DT
>12-3. <A
HREF="#X-087-2-ETC.PROTOCOLS"
>A Sample /etc/protocols File</A
></DT
><DT
>12-4. <A
HREF="#X-087-2-RPC.FIG"
>A Sample /etc/rpc File</A
></DT
><DT
>12-5. <A
HREF="#X-087-2-FEATURES.SSH.CONF"
>Example ssh Client Configuration File</A
></DT
><DT
>13-1. <A
HREF="#X-087-2-NIS.SECURENETS.FILE"
>Sample ypserv.securenets File</A
></DT
><DT
>13-2. <A
HREF="#X-087-2-NIS.FIG.SWITCH"
>Sample nsswitch.conf File</A
></DT
><DT
>18-1. <A
HREF="#X-087-2-SENDMAIL.MC.SMTP"
>Sample Configuration File vstout.smtp.m4</A
></DT
><DT
>18-2. <A
HREF="#X-087-2-SENDMAIL.MC.UUCPSMTP"
>Sample Configuration File vstout.uucpsmtp.m4</A
></DT
><DT
>18-3. <A
HREF="#X-087-2-SENDMAIL.REWRITE.EXAMPLE"
>Rewrite Rule from vstout.uucpsmtp.m4</A
></DT
><DT
>18-4. <A
HREF="#X-087-2-SAMP.ALIAS.FIG"
>Sample aliases File</A
></DT
><DT
>18-5. <A
HREF="#X-087-2-SENDMAIL.MAILSTATS"
>Sample Output of the mailstats Command</A
></DT
><DT
>18-6. <A
HREF="#X-087-2-SENDMAIL.HOSTSTAT"
>Sample Output of the oststat Command</A
></DT
></DL
></DIV
><DIV
CLASS="PREFACE"
><HR><H1
><A
NAME="AEN3"
></A
>Preface</H1
><P
>The Internet is now a household term in many countries. With otherwise
serious people beginning to joyride along the Information Superhighway,
computer networking seems to be moving toward the status of TV sets
and microwave ovens. The Internet has unusually high media coverage, and
social science majors are descending on Usenet newsgroups, online virtual
reality environments, and the Web to conduct research on the new
&#8220;Internet Culture.&#8221;</P
><P
>Of course, networking has been around for a long time. Connecting
computers to form local area networks has been common practice, even
at small installations, and so have long-haul links using transmission
lines provided by telecommunications companies. A rapidly growing
conglomerate of world-wide networks has, however, made joining the
global village a perfectly reasonable option for even small non-profit
organizations of private computer users. Setting up an Internet host
with mail and news capabilities offering dialup and ISDN access has
become affordable, and the advent of DSL (Digital Subscriber Line) and
Cable Modem technologies will doubtlessly continue this trend.</P
><P
>Talking about computer networks often means talking about Unix. Of
course, Unix is not the only operating system with network
capabilities, nor will it remain a frontrunner forever, but it has
been in the networking business for a long time, and will surely
continue to be for some time to come.</P
><P
>What makes Unix particularly interesting to private users is that there has
been much activity to bring free Unix-like operating systems to the PC, such
as 386BSD, FreeBSD, and Linux.</P
><P
>Linux is a freely distributable Unix clone for personal computers.  It
currently runs on a variety of machines that includes the Intel family
of processors, but also Motorola 680x0 machines, such as the Commodore
Amiga and Apple Macintosh; Sun SPARC and Ultra-SPARC machines; Compaq
Alphas; MIPS; PowerPCs, such as the new generation of Apple Macintosh;
and StrongARM, like the rebel.com Netwinder and 3Com Palm
machines. Linux has been ported to some relatively obscure platforms,
like the Fujitsu AP-1000 and the IBM System 3/90. Ports to other
interesting architectures are currently in progress in developers'
labs, and the quest to move Linux into the embedded controller space
promises success.</P
><P
>Linux was developed by a large team of volunteers across the Internet.
The project was started in 1990 by Linus Torvalds, a Finnish college
student, as an operating systems course project. Since that time,
Linux has snowballed into a full-featured Unix clone capable of
running applications as diverse as simulation and modeling programs,
word processors, speech recognition systems, World Wide Web browsers,
and a horde of other software, including a variety of excellent
games. A great deal of hardware is supported, and Linux contains a
complete implementation of TCP/IP networking, including SLIP, PPP,
firewalls, a full IPX implementation, and many features and some
protocols not found in any other operating system. Linux is powerful,
fast, and free, and its popularity in the world beyond the Internet is
growing rapidly.</P
><P
>The Linux operating system itself is covered by the GNU General Public
License, the same copyright license used by software developed by the Free
Software Foundation. This license allows anyone to redistribute or modify
the software (free of charge or for a profit) as long as all modifications
and distributions are freely distributable as well. The term &#8220;free
software&#8221; refers to freedom of application, not freedom of cost.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN12"
>1. Purpose and Audience for This Book</A
></H2
><P
>This book was written to provide a single reference for network
administration in a Linux environment. Beginners and experienced users
alike should find the information they need to cover nearly all
important administration activities required to manage a Linux network
configuration. The possible range of topics to cover is nearly
limitless, so of course it has been impossible to include everything
there is to say on all subjects. We've tried to cover the most
important and common ones. We've found that beginners to Linux
networking, even those with no prior exposure to Unix-like operating
systems, have found this book good enough to help them successfully
get their Linux network configurations up and running and get them
ready to learn more.</P
><P
>There are many books and other sources of information from which you
can learn any of the topics covered in this book (with the possible
exception of some of the truly Linux-specific features, such as the
new Linux firewall interface, which is not well documented elsewhere)
in greater depth. We've provided a bibliography for you to use when
you are ready to explore more.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN16"
>2. Sources of Information</A
></H2
><P
>&#13; If you are new to the world of Linux, there
are a number of resources to explore and become familiar with. Having
access to the Internet is helpful, but not essential.</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Linux Documentation Project guides</DT
><DD
><P
>&#13;
 








The Linux Documentation Project is a group of volunteers who have
worked to produce books (guides), HOWTO documents, and manual pages on
topics ranging from installation to kernel programming. The LDP works
include:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><EM
>Linux Installation and Getting Started</EM
></DT
><DD
><P
>By Matt Welsh, et al. This book describes how to obtain, install, and use
Linux. It includes an introductory Unix tutorial and information on systems
administration, the X Window System, and networking.</P
></DD
><DT
><EM
>Linux System Administrators Guide</EM
></DT
><DD
><P
>By Lars Wirzenius and Joanna Oja. This book is a guide to general Linux system
administration and covers topics such as creating and configuring users,
performing system backups, configuration of major software packages, and
installing and upgrading software.</P
></DD
><DT
><EM
>Linux System Adminstration Made Easy</EM
></DT
><DD
><P
>By Steve Frampton. This book describes day-to-day administration and
maintenance issues of relevance to Linux users.</P
></DD
><DT
><EM
>Linux Programmers Guide</EM
></DT
><DD
><P
>By B. Scott Burkett, Sven Goldt, John D. Harper, Sven van der Meer, and
Matt Welsh. This book covers topics of interest to people who wish to
develop application software for Linux.</P
></DD
><DT
><EM
>The Linux Kernel</EM
></DT
><DD
><P
>By David A. Rusling. This book provides an introduction to the Linux
Kernel, how it is constructed, and how it works. Take a tour of your
kernel.</P
></DD
><DT
><EM
>The Linux Kernel Module Programming
Guide</EM
></DT
><DD
><P
>By Ori Pomerantz. This guide explains how to write Linux kernel modules.</P
></DD
></DL
></DIV
></P
><P
>More manuals are in development. For more information about the LDP
you should consult their World Wide Web server at <SPAN
CLASS="SYSTEMITEM"
>http://www.linuxdoc.org/</SPAN
> or one of its many
mirrors.</P
></DD
><DT
>HOWTO documents</DT
><DD
><P
>&#13; The Linux HOWTOs are
a comprehensive series of papers detailing various aspects of the
system&#8212;such as installation and configuration of the X Window
System software, or how to write in assembly language programming
under Linux. These are generally located in the
<TT
CLASS="FILENAME"
>HOWTO</TT
> subdirectory of the FTP sites listed later,
or they are available on the World Wide Web at one of the many Linux
Documentation Project mirror sites.  See the Bibliography at the end
of this book, or the file <TT
CLASS="FILENAME"
>HOWTO-INDEX</TT
> for a list
of what's available.</P
><P
>You might want to obtain the <EM
>Installation HOWTO</EM
>, which
describes how to install Linux on your system; the <EM
>Hardware
Compatibility HOWTO</EM
>, which contains a list of hardware known to
work with Linux; and the <EM
>Distribution HOWTO</EM
>, which lists
software vendors selling Linux on diskette and CD-ROM.</P
><P
>The bibliography of this book includes references to the HOWTO documents
that are related to Linux networking.</P
></DD
><DT
>Linux Frequently Asked Questions</DT
><DD
><P
>The <EM
>Linux Frequently Asked Questions with Answers</EM
>
(FAQ) contains a wide assortment of questions and answers about the
system. It is a must-read for all newcomers.</P
></DD
></DL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN107"
>2.1. Documentation Available via FTP</A
></H3
><P
>&#13; If you have access to anonymous FTP, you
can obtain all Linux documentation listed above from various sites,
including <SPAN
CLASS="SYSTEMITEM"
> metalab.unc.edu:/pub/Linux/docs</SPAN
> and <SPAN
CLASS="SYSTEMITEM"
> tsx-11.mit.edu:/pub/linux/docs</SPAN
>.</P
><P
>These sites are mirrored by a number of sites around the world.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN119"
>2.2. Documentation Available via WWW</A
></H3
><P
>There are many Linux-based WWW sites available. The home site for the
Linux Documentation Project can be accessed at <SPAN
CLASS="SYSTEMITEM"
>http://www.linuxdoc.org/</SPAN
>.</P
><P
>&#13; The Open Source Writers Guild (OSWG) is a
project that has a scope that extends beyond Linux. The OSWG, like
this book, is committed to advocating and facilitating the production
of OpenSource documentation. The OSWG home site is at
<SPAN
CLASS="SYSTEMITEM"
>http://www.oswg.org:8080/oswg</SPAN
>.</P
><P
>Both of these sites contain hypertext (and other) versions of many Linux
related documents.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN133"
>2.3. Documentation Available Commercially</A
></H3
><P
> A
number of publishing companies and software vendors publish the works
of the Linux Documentation Project. Two such vendors are:</P
><P
CLASS="LITERALLAYOUT"
>Specialized&nbsp;Systems&nbsp;Consultants,&nbsp;Inc.&nbsp;(SSC)&nbsp;<br>
<SPAN
CLASS="SYSTEMITEM"
>http://www.ssc.com/</SPAN
>&nbsp;<br>
P.O.&nbsp;Box&nbsp;55549&nbsp;Seattle,&nbsp;WA&nbsp;98155-0549&nbsp;<br>
1-206-782-7733&nbsp;<br>
1-206-782-7191&nbsp;(FAX)&nbsp;<br>
<SPAN
CLASS="SYSTEMITEM"
>sales@ssc.com</SPAN
></P
><P
>and:</P
><P
CLASS="LITERALLAYOUT"
>Linux&nbsp;Systems&nbsp;Labs<br>
<SPAN
CLASS="SYSTEMITEM"
>http://www.lsl.com/</SPAN
><br>
18300&nbsp;Tara&nbsp;Drive<br>
Clinton&nbsp;Township,&nbsp;MI&nbsp;48036<br>
1-810-987-8807<br>
1-810-987-3562&nbsp;(FAX)<br>
<SPAN
CLASS="SYSTEMITEM"
>sales@lsl.com</SPAN
></P
><P
>Both companies sell compendiums of Linux HOWTO documents and other
Linux documentation in printed and bound form.</P
><P
>&#13;

 O'Reilly
&#38; Associates publishes a series of Linux books. This one is a work
of the Linux Documentation Project, but most have been independently
authored. Their range includes:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><EM
>Running Linux</EM
></DT
><DD
><P
>An installation and user guide to the system describing how to get the most
out of personal computing with Linux.</P
></DD
><DT
><EM
>Learning Debian GNU/Linux</EM
>, <EM
>Learning Red Hat Linux</EM
></DT
><DD
><P
>More basic than <EM
>Running Linux</EM
>, these books
contain popular distributions on CD-ROM and offer robust directions
for setting them up and using them.</P
></DD
><DT
><EM
>Linux in a Nutshell</EM
></DT
><DD
><P
>Another in the successful "in a Nutshell" series, this book focuses on
providing a broad reference text for Linux.</P
></DD
></DL
></DIV
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN175"
>2.4. Linux Journal and Linux Magazine</A
></H3
><P
><EM
>Linux Journal</EM
> and <EM
>Linux
Magazine</EM
> are monthly magazines for the Linux community,
written and published by a number of Linux activists. They contain
articles ranging from novice questions and answers to kernel
programming internals. Even if you have Usenet access, these magazines
are a good way to stay in touch with the Linux community.</P
><P
><EM
>Linux Journal</EM
> is the oldest magazine and is
published by S.S.C. Incorporated, for which details were listed
previously. You can also find the magazine on the World Wide Web at
<SPAN
CLASS="SYSTEMITEM"
>http://www.linuxjournal.com/</SPAN
>.</P
><P
><EM
>Linux Magazine</EM
> is a newer, independent
publication. The home web site for the magazine is <SPAN
CLASS="SYSTEMITEM"
>http://www.linuxmagazine.com/</SPAN
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN190"
>2.5. Linux Usenet Newsgroups</A
></H3
><P
>If you have access to Usenet news, the following Linux-related newsgroups
are available:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.announce</SPAN
></DT
><DD
><P
>A moderated newsgroup containing announcements of new software,
distributions, bug reports, and goings-on in the Linux community. All
Linux users should read this group. Submissions may be mailed to
<SPAN
CLASS="SYSTEMITEM"
>linux-announce@news.ornl.gov</SPAN
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.help</SPAN
></DT
><DD
><P
>General questions and answers about installing or using Linux.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.admin</SPAN
></DT
><DD
><P
>Discussions relating to systems administration under Linux.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.networking</SPAN
></DT
><DD
><P
>Discussions relating to networking with Linux.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.development</SPAN
></DT
><DD
><P
>Discussions about developing the Linux kernel and system itself.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.misc</SPAN
></DT
><DD
><P
>A catch-all newsgroup for miscellaneous discussions that don't
fall under the previous categories.</P
></DD
></DL
></DIV
></P
><P
>There are also several newsgroups devoted to Linux in languages other
than English, such as <SPAN
CLASS="SYSTEMITEM"
>fr.comp.os.linux</SPAN
> in French and <SPAN
CLASS="SYSTEMITEM"
>de.comp.os.linux</SPAN
> in German.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN243"
>2.6. Linux Mailing Lists</A
></H3
><P
>&#13;There is a large number of specialist Linux mailing lists on which you
will find many people willing to help with questions you might have.</P
><P
>The best-known of these are the lists hosted by Rutgers University.
You may subscribe to these lists by sending an email message formatted
as follows:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>To: majordomo@vger.rutgers.edu
Subject: anything at all
Body:

subscribe <TT
CLASS="REPLACEABLE"
><I
>listname</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Some of the available lists related to Linux networking are:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>linux-net</SPAN
></DT
><DD
><P
>Discussion relating to Linux networking</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>linux-ppp</SPAN
></DT
><DD
><P
>Discussion relating to the Linux PPP implementation</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>linux-kernel</SPAN
></DT
><DD
><P
>Discussion relating to Linux kernel development</P
></DD
></DL
></DIV
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN274"
>2.7. Online Linux Support</A
></H3
><P
> 
 

There are many ways of obtaining help online, where volunteers
from around the world offer expertise and services to assist
users with questions and problems.</P
><P
>&#13;
The OpenProjects IRC Network is an IRC network devoted entirely to
Open Projects&#8212;Open Source and Open Hardware alike. Some of its
channels are designed to provide online Linux support services. IRC
stands for Internet Relay Chat, and is a network service that allows
you to talk interactively on the Internet to other users. IRC networks
support multiple channels on which groups of people talk. Whatever you
type in a channel is seen by all other users of that channel.</P
><P
>There are a number of active channels on the OpenProjects IRC network
where you will find users 24 hours a day, 7 days a week who are
willing and able to help you solve any Linux problems you may have, or
just chat. You can use this service by installing an IRC client like
<EM
>irc-II</EM
>, connecting to servername <SPAN
CLASS="SYSTEMITEM"
>irc.openprojects.org:6667</SPAN
>, and joining the
<TT
CLASS="LITERAL"
>#linpeople</TT
> channel.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN292"
>2.8. Linux User Groups</A
></H3
><P
>&#13;

Many Linux User Groups around the world offer direct
support to users. Many Linux User Groups engage in activities such as
installation days, talks and seminars, demonstration nights, and other
completely social events. Linux User Groups are a great way of meeting other
Linux users in your area. There are a number of published lists of Linux
User Groups. Some of the better-known ones are:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Groups of Linux Users Everywhere</DT
><DD
><P
> <SPAN
CLASS="SYSTEMITEM"
>http://www.ssc.com/glue/groups/</SPAN
></P
></DD
><DT
>LUG list project</DT
><DD
><P
><SPAN
CLASS="SYSTEMITEM"
>http://www.nllgg.nl/lugww/</SPAN
></P
></DD
><DT
>LUG registry</DT
><DD
><P
><SPAN
CLASS="SYSTEMITEM"
>http://www.linux.org/users/</SPAN
></P
></DD
></DL
></DIV
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN317"
>2.9. Obtaining Linux</A
></H3
><P
>&#13;








There is no single distribution of the Linux software; instead, there
are many distributions, such as Debian, RedHat, Caldera, Corel, SuSE,
and Slackware. Each distribution contains everything you need to run a
complete Linux system: the kernel, basic utilities, libraries, support
files, and applications software.</P
><P
>Linux distributions may be obtained via a number of online sources, such as
the Internet. Each of the major distributions has its own FTP and web site.
Some of these sites are:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Caldera</DT
><DD
><P
><P
CLASS="LITERALLAYOUT"
><SPAN
CLASS="SYSTEMITEM"
>http://www.caldera.com/</SPAN
><SPAN
CLASS="SYSTEMITEM"
>ftp://ftp.caldera.com/</SPAN
></P
></P
></DD
><DT
>Corel</DT
><DD
><P
><P
CLASS="LITERALLAYOUT"
><SPAN
CLASS="SYSTEMITEM"
>http://www.corel.com/</SPAN
><SPAN
CLASS="SYSTEMITEM"
>ftp://ftp.corel.com/</SPAN
></P
></P
></DD
><DT
>Debian</DT
><DD
><P
><P
CLASS="LITERALLAYOUT"
><SPAN
CLASS="SYSTEMITEM"
>http://www.debian.org/</SPAN
><SPAN
CLASS="SYSTEMITEM"
>ftp://ftp.debian.org/</SPAN
></P
></P
></DD
><DT
>RedHat</DT
><DD
><P
><P
CLASS="LITERALLAYOUT"
><SPAN
CLASS="SYSTEMITEM"
>http://www.redhat.com/</SPAN
><SPAN
CLASS="SYSTEMITEM"
>ftp://ftp.redhat.com/</SPAN
></P
></P
></DD
><DT
>Slackware</DT
><DD
><P
><P
CLASS="LITERALLAYOUT"
><SPAN
CLASS="SYSTEMITEM"
>http://www.slackware.com/</SPAN
><SPAN
CLASS="SYSTEMITEM"
>ftp://ftp.slackware.com/</SPAN
></P
></P
></DD
><DT
>SuSE</DT
><DD
><P
><P
CLASS="LITERALLAYOUT"
><SPAN
CLASS="SYSTEMITEM"
>http://www.suse.com/</SPAN
><SPAN
CLASS="SYSTEMITEM"
>ftp://ftp.suse.com/</SPAN
></P
></P
></DD
></DL
></DIV
>

Many of the popular general FTP archive sites also mirror various
Linux distributions. The best-known of these sites are:
<P
CLASS="LITERALLAYOUT"
><SPAN
CLASS="SYSTEMITEM"
>metalab.unc.edu:/pub/Linux/distributions/</SPAN
><br>
<SPAN
CLASS="SYSTEMITEM"
>ftp.funet.fi:/pub/Linux/mirrors/</SPAN
><br>
<SPAN
CLASS="SYSTEMITEM"
>tsx-11.mit.edu:/pub/linux/distributions/</SPAN
><br>
<SPAN
CLASS="SYSTEMITEM"
>mirror.aarnet.edu.au:/pub/linux/distributions/</SPAN
></P
></P
><P
>Many of the modern distributions can be installed directly from the
Internet.  There is a lot of software to download for a typical
installation, though, so you'd probably want to do this only if you
have a high-speed, permanent network connection, or if you just need
to update an existing installation.<A
NAME="X-087-2-FNPR02"
HREF="#FTN.X-087-2-FNPR02"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
></P
><P
>Linux may be purchased on CD-ROM from an increasing number of software
vendors. If your local computer store doesn't have it, perhaps you
should ask them to stock it! Most of the popular distributions can be
obtained on CD-ROM. Some vendors produce products containing multiple
CD-ROMs, each of which provides a different Linux distribution. This
is an ideal way to try a number of different distributions before you
settle on your favorite one.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN394"
>3. File System Standards</A
></H2
><P
>In the past, one of the problems that afflicted Linux distributions,
as well as the packages of software running on Linux, was the lack of
a single accepted filesystem layout. This resulted in
incompatibilities between different packages, and confronted users and
administrators with the task of locating various files and programs.</P
><P
>To improve this situation, in August 1993, several people formed the
Linux File System Standard Group (FSSTND). After six months of
discussion, the group created a draft that presents a coherent file
sytem structure and defines the location of the most essential
programs and configuration files.</P
><P
>This standard was supposed to have been implemented by most major
Linux distributions and packages. It is a little unfortunate that,
while most distributions have made some attempt to work toward the
FSSTND, there is a very small number of distributions that has
actually adopted it fully. Throughout this book, we will assume that
any files discussed reside in the location specified by the standard;
alternative locations will be mentioned only when there is a long
tradition that conflicts with this specification.</P
><P
>The Linux FSSTND continued to develop, but was replaced by the Linux
File Hierarchy Standard (FHS) in 1997. The FHS addresses the
multi-architecture issues that the FSSTND did not. The FHS can be
obtained from the Linux documentation directory of all major Linux FTP
sites and their mirrors, or at its home site at <SPAN
CLASS="SYSTEMITEM"
>http://www.pathname.com/fhs/</SPAN
>.  Daniel Quinlan,
the coordinator of the FHS group, can be reached at <SPAN
CLASS="SYSTEMITEM"
>quinlan@transmeta.com</SPAN
>.&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN410"
>4. Standard Linux Base</A
></H2
><P
>The vast number of different Linux distributions, while providing lots of
healthy choice for Linux users, has created a problem for software
developers&#8212;particularly developers of non-free software.</P
><P
>Each distribution packages and supplies certain base libraries,
configuration tools, system applications, and configuration
files. Unfortunately, differences in their versions, names, and
locations make it very difficult to know what will exist on any
distribution. This makes it hard to develop binary applications that
will work reliably on all Linux distribution bases.</P
><P
>To help overcome this problem, a new project sprang up called the
&#8220;Linux Standard Base.&#8221; It aims to describe a standard base
distribution that complying distributions will use. If a developer
designs an application to work against the standard base platform, the
application will work, and be portable to, any complying Linux
distribution.</P
><P
>You can find information on the status of the Linux Standard Base
project at its home web site at <SPAN
CLASS="SYSTEMITEM"
>http://www.linuxbase.org/</SPAN
>.</P
><P
>If you're concerned about interoperability, particularly of software
from commercial vendors, you should ensure that your Linux
distribution is making an effort to participate in the standardization
project.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN425"
>5. About This Book</A
></H2
><P
>When Olaf joined the Linux Documentation Project in 1992, he wrote two
small chapters on UUCP and <B
CLASS="COMMAND"
>smail</B
>, which he meant to
contribute to the System Administrator's Guide. Development of TCP/IP
networking was just beginning, and when those &#8220;small chapters&#8221;
started to grow, he wondered aloud whether it would be nice to have a
Networking Guide. &#8220;Great!&#8221; everyone said. &#8220;Go for it!&#8221;
So he went for it and wrote the first version of the Networking Guide, which
was released in September 1993.</P
><P
> Olaf continued
work on the Networking Guide and eventually produced a much enhanced
version of the guide. Vince Skahan contributed the original
<B
CLASS="COMMAND"
>sendmail</B
> mail chapter, which was completely
replaced in this edition because of a new interface to the
<B
CLASS="COMMAND"
>sendmail</B
> configuration.</P
><P
>The version of the guide that you are reading now is a revision and
update prompted by O'Reilly &#38; Associates and undertaken by Terry
Dawson.<A
NAME="X-087-2-FNPR04"
HREF="#FTN.X-087-2-FNPR04"
><SPAN
CLASS="footnote"
>[2]</SPAN
></A
>
Terry has been an amateur radio operator for over 20 years and has
worked in the telecommunications industry for over 15 of those. He was
co-author of the original NET-FAQ, and has since authored and
maintained various networking-related HOWTO documents. Terry has
always been an enthusiastic supporter of the Network Administrators
Guide project, and added a few new chapters to this version describing
features of Linux networking that have been developed since the first
edition, plus a bunch of changes to bring the rest of the book up to
date.</P
><P
>&#13;The <B
CLASS="COMMAND"
>exim</B
> chapter was contributed by
Philip Hazel,<A
NAME="X-087-2-FNPR05"
HREF="#FTN.X-087-2-FNPR05"
><SPAN
CLASS="footnote"
>[3]</SPAN
></A
>
who is a lead developer and maintainer of the package.</P
><P
>The book is organized roughly along the sequence of steps you have to
take to configure your system for networking. It starts by discussing
basic concepts of networks, and TCP/IP-based networks in particular.
It then slowly works its way up from configuring TCP/IP at the device
level to firewall, accounting, and masquerade configuration, to the
setup of common applications such as <B
CLASS="COMMAND"
>rlogin</B
> and
friends, the Network File System, and the Network Information
System. This is followed by a chapter on how to set up your machine as
a UUCP node.  Most of the remaining sections is dedicated to two major
applications that run on top of TCP/IP and UUCP: electronic mail and
news.  A special chapter has been devoted to the IPX protocol and the
NCP filesystem, because these are used in many corporate environments
where Linux is finding a home.</P
><P
>The email part features an introduction to the more intimate parts of
mail transport and routing, and the myriad of addressing schemes you
may be confronted with. It describes the configuration and management
of <B
CLASS="COMMAND"
>exim</B
>, a mail transport agent ideal for use in most
situations not requiring UUCP, and <B
CLASS="COMMAND"
>sendmail</B
>, which is for
people who have to do more complicated routing involving UUCP.</P
><P
>The news part gives you an overview of how Usenet news works. It covers
INN and C News, the two most widely used news transport software packages
at the moment, and the use of NNTP to provide newsreading access to a local
network. The book closes with a chapter on the care and feeding of the most
popular newsreaders on Linux.</P
><P
>Of course, a book can never exhaustively answer all questions you
might have. So if you follow the instructions in this book and
something still does not work, please be patient. Some of your
problems may be due to mistakes on our part (see the section <A
HREF="#X-087-2-SUBMITCHANGES"
>Section 9</A
>", later in this Preface), but they also may be caused by changes
in the networking software. Therefore, you should check the listed
information resources first. There's a good chance that you are not
alone with your problems, so a fix or at least a proposed workaround
is likely to be known. If you have the opportunity, you should also
try to get the latest kernel and network release from one of the Linux
FTP sites or a BBS near you.  Many problems are caused by software
from different stages of development, which fail to work together
properly. After all, Linux is a &#8220;work in progress.&#8221;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN453"
>6. The Official Printed Version</A
></H2
><P
>In Autumn 1993, Andy Oram, who had been around the LDP mailing list
from almost the very beginning, asked Olaf about publishing this book
at O'Reilly &#38; Associates. He was excited about this book, never having
imagined that it would become this successful. He and Andy
finally agreed that O'Reilly would produce an enhanced Official
Printed Version of the Networking Guide, while Olaf retained the
original copyright so that the source of the book could be freely
distributed. This means that you can choose freely: you can get the
various free forms of the document from your nearest Linux
Documentation Project mirror site and print it out, or you can
purchase the official printed version from O'Reilly.</P
><P
>Why, then, would you want to pay money for something you can get for
free?  Is Tim O'Reilly out of his mind for publishing something
everyone can print and even sell themselves?<A
NAME="X-087-2-FNPR06"
HREF="#FTN.X-087-2-FNPR06"
><SPAN
CLASS="footnote"
>[4]</SPAN
></A
>
Is there any difference between these versions?</P
><P
>The answers are &#8220;it depends,&#8221; &#8220;no, definitely not,&#8221;
and &#8220;yes and no.&#8221; O'Reilly &#38; Associates does take a risk in
publishing the Networking Guide, and it seems to have paid off for them
(they've asked us to do it again). We believe this project serves as a fine
example of how the free software world and companies can cooperate to produce
something both can benefit from. In our view, the great service O'Reilly is
providing to the Linux community (apart from the book becoming readily
available in your local bookstore) is that it has helped Linux become
recognized as something to be taken seriously: a viable and useful alternative
to other commercial operating systems. It's a sad technical bookstore
that doesn't have at least one shelf stacked with O'Reilly Linux books.</P
><P
>Why are they publishing it? They see it as their
kind of book. It's what they'd hope to produce if they contracted with
an author to write about Linux. The pace, level of detail, and style
fit in well with their other offerings.</P
><P
>The point of the LDP license is to make sure no one gets shut out. Other
people can print out copies of this book, and no one will blame you if you
get one of these copies. But if you haven't gotten a chance to see the
O'Reilly version, try to get to a bookstore or look at a friend's copy. We
think you'll like what you see, and will want to buy it for yourself.</P
><P
>So what about the differences between the printed and online versions?
Andy Oram has made great efforts at transforming our ramblings into
something actually worth printing. (He has also reviewed a few other
books produced by the Linux Documentation Project, contributing
whatever professional skills he can to the Linux community.)</P
><P
>Since Andy started reviewing the Networking Guide and editing the
copies sent to him, the book has improved vastly from its original
form, and with every round of submission and feedback it improves
again. The opportunity to take advantage of a professional editor's
skill is one not to be wasted. In many ways, Andy's contribution has
been as important as that of the authors.  The same is also true of
the copyeditors, who got the book into the shape you see now. All
these edits have been fed back into the online version, so there is no
difference in content.</P
><P
>Still, the O'Reilly version <EM
>will</EM
> be different. It
will be professionally bound, and while you may go to the trouble to
print the free version, it is unlikely that you will get the same
quality result, and even then it is more unlikely that you'll do it for
the price. Secondly, our amateurish attempts at illustration will have
been replaced with nicely redone figures by O'Reilly's professional
artists. Indexers have generated an improved index, which makes
locating information in the book a much simpler process. If this book
is something you intend to read from start to finish, you should
consider reading the official printed version.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-INTRO.OUTLOOK"
>7. Overview</A
></H2
><P
><A
HREF="#X-087-2-INTRO"
>Chapter 1</A
>, discusses the history of Linux and
covers basic networking information on UUCP, TCP/IP, various
protocols, hardware, and security. The next few chapters deal with
configuring Linux for TCP/IP networking and running some major
applications. We examine IP a little more closely in <A
HREF="#X-087-2-ISSUES"
>Chapter 2</A
>, before getting our hands dirty with file
editing and the like. If you already know how IP routing works and how
address resolution is performed, you can skip this chapter.</P
><P
><A
HREF="#X-087-2-HARDWARE"
>Chapter 3</A
>, deals with very basic configuration issues,
such as building a kernel and setting up your Ethernet card. The
configuration of your serial ports is covered separately in
<A
HREF="#X-087-2-SERIAL"
>Chapter 4</A
>, because the discussion does not apply
to TCP/IP networking only, but is also relevant for UUCP.</P
><P
><A
HREF="#X-087-2-IFACE"
>Chapter 5</A
>, helps you set up your machine for TCP/IP
networking.  It contains installation hints for standalone hosts with
loopback enabled only, and hosts connected to an Ethernet.  It also
introduces you to a few useful tools you can use to test and debug your
setup. <A
HREF="#X-087-2-RESOLV"
>Chapter 6</A
>, discusses how to configure hostname
resolution and explains how to set up a name server.</P
><P
><A
HREF="#X-087-2-SLIP"
>Chapter 7</A
>, explains how to establish SLIP connections
and gives a detailed reference for <B
CLASS="COMMAND"
>dip</B
>, a tool that
allows you to automate most of the necessary steps.
<A
HREF="#X-087-2-PPP"
>Chapter 8</A
>, covers PPP and <B
CLASS="COMMAND"
>pppd</B
>,
the PPP daemon.</P
><P
><A
HREF="#X-087-2-FIREWALL"
>Chapter 9</A
>, extends our discussion on network
security and describes the Linux TCP/IP firewall and its configuration
tools: <B
CLASS="COMMAND"
>ipfwadm</B
>, <B
CLASS="COMMAND"
>ipchains</B
>, and
<B
CLASS="COMMAND"
>iptables</B
>. IP firewalling provides a means of
controlling who can access your network and hosts very precisely.</P
><P
><A
HREF="#X-087-2-ACCOUNTING"
>Chapter 10</A
>, explains how to configure IP Accounting
in Linux so you can keep track of how much traffic is going where and who is
generating it.</P
><P
><A
HREF="#X-087-2-IPMASQ"
>Chapter 11</A
>, covers a feature of the Linux
networking software called IP masquerade, which allows whole IP
networks to connect to and use the Internet through a single IP
address, hiding internal systems from outsiders in the process.</P
><P
><A
HREF="#X-087-2-APPL"
>Chapter 12</A
>, gives a short introduction to setting up some
of the most important network applications, such as <B
CLASS="COMMAND"
>rlogin</B
>,
<B
CLASS="COMMAND"
>ssh</B
>, etc. This chapter also covers how services are managed
by the <B
CLASS="COMMAND"
>inetd</B
> superuser, and how you may restrict certain
security-relevant services to a set of trusted hosts.</P
><P
><A
HREF="#X-087-2-NIS"
>Chapter 13</A
>, and <A
HREF="#X-087-2-NFS"
>Chapter 14</A
>,
discuss NIS and NFS. NIS is a tool used to distribute administative
information, such as user passwords in a local area network. NFS
allows you to share filesystems between several hosts in your network.</P
><P
>In <A
HREF="#X-087-2-IPX"
>Chapter 15</A
>, we discuss the IPX protocol and the NCP
filesystem. These allow Linux to be integrated into a Novell NetWare
environment, sharing files and printers with non-Linux machines.</P
><P
><A
HREF="#X-087-2-UUCP"
>Chapter 16</A
>, gives you an extensive introduction to the
administration of Taylor UUCP, a free implementation of the UUCP suite.</P
><P
>The remainder of the book is taken up by a detailed tour of electronic
mail and Usenet news. <A
HREF="#X-087-2-MAIL"
>Chapter 17</A
>, introduces you to the
central concepts of electronic mail, like what a mail address looks like, and
how the mail handling system manages to get your message to the
recipient.</P
><P
><A
HREF="#X-087-2-SENDMAIL"
>Chapter 18</A
>, and <A
HREF="#X-087-2-EXIM"
>Chapter 19</A
>, cover 
the configuration of <B
CLASS="COMMAND"
>sendmail</B
> and <B
CLASS="COMMAND"
>exim</B
>, 
two mail transport agents you can use for Linux.  This book explains both 
of them, because <B
CLASS="COMMAND"
>exim</B
> is easier to install for the 
beginner, while <B
CLASS="COMMAND"
>sendmail</B
> provides support for UUCP.</P
><P
>&#13;<A
HREF="#X-087-2-NEWS"
>Chapter 20</A
>, through <A
HREF="#X-087-2-INN"
>Chapter 23</A
>,
explain the way news is managed in Usenet and how you install and use
C News, <B
CLASS="COMMAND"
>nntpd</B
>, and INN: three popular software
packages for managing Usenet news. After the brief introduction in
<A
HREF="#X-087-2-NEWS"
>Chapter 20</A
>, you can read <A
HREF="#X-087-2-CNEWS"
>Chapter 21</A
>, if you want to transfer news using C News, a
traditional service generally used with UUCP. The following chapters
discuss more modern alternatives to C News that use the Internet-based
protocol NNTP (Network News Transfer Protocol).  <A
HREF="#X-087-2-NNTP"
>Chapter 22</A
> covers how to set up a simple NNTP daemon,
<B
CLASS="COMMAND"
>nntpd</B
>, to provide news reading access for a local
network, while <A
HREF="#X-087-2-INN"
>Chapter 23</A
> describes a more robust
server for more extensive NetNews transfers, the InterNet News daemon
(INN).  And finally, <A
HREF="#X-087-2-NEWSREADERS"
>Chapter 24</A
>, shows you
how to configure and maintain various newsreaders.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN523"
>8. Conventions Used in This Book</A
></H2
><P
>All examples presented in this book assume you are using a
<B
CLASS="COMMAND"
>sh</B
> compatible shell. The <B
CLASS="COMMAND"
>bash</B
> shell
is <B
CLASS="COMMAND"
>sh</B
> compatible and is the standard shell of all Linux
distributions. If you happen to be a <B
CLASS="COMMAND"
>csh</B
> user, you will
have to make appropriate adjustments.</P
><P
>The following is a list of the typographical conventions
used in this book:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><EM
>Italic</EM
></DT
><DD
><P
>Used for file and directory names,
program and command names, command-line options, email addresses and
pathnames, URLs, and for emphasizing new terms.</P
></DD
><DT
><EM
>Boldface</EM
></DT
><DD
><P
>Used for machine names, hostnames, site names, usernames and IDs, and for occasional emphasis.</P
></DD
><DT
><TT
CLASS="LITERAL"
>Constant Width</TT
></DT
><DD
><P
>Used in examples to show the contents of
code files or the output from commands and to indicate environment
variables and keywords that appear in code.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>Constant Width Italic</I
></TT
></DT
><DD
><P
>Used to indicate variable options, keywords, or text that the user is to
replace with an actual value.</P
></DD
><DT
><KBD
CLASS="USERINPUT"
>Constant Width Bold</KBD
></DT
><DD
><P
>Used in examples to show commands or other text that should be typed
literally by the user.</P
></DD
></DL
></DIV
><DIV
CLASS="WARNING"
><P
></P
><TABLE
CLASS="WARNING"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.png"
HSPACE="5"
ALT="Warning"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Text appearing in this manner offers a warning. You can make a
mistake here that hurts your system or is hard to recover from.</P
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-SUBMITCHANGES"
>9. Submitting Changes</A
></H2
><P
>We have tested and verified the information in this book to the best of our
ability, but you may find that features have changed (or even that we have
made mistakes!). Please let us know about any errors you find, as well as
your suggestions for future editions, by writing to:</P
><P
CLASS="LITERALLAYOUT"
>O'Reilly&nbsp;&#38;&nbsp;Associates,&nbsp;Inc.<br>
101&nbsp;Morris&nbsp;Street<br>
Sebastopol,&nbsp;CA&nbsp;95472<br>
1-800-998-9938&nbsp;(in&nbsp;the&nbsp;U.S.&nbsp;or&nbsp;Canada)<br>
1-707-829-0515&nbsp;(international&nbsp;or&nbsp;local)<br>
1-707-829-0104&nbsp;(FAX)</P
><P
>You can send us messages electronically. To be put on the mailing list
or request a catalog, send email to:</P
><P
CLASS="LITERALLAYOUT"
><EM
>info@oreilly.com</EM
>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P
><P
>To ask technical questions or comment on the book, send email to:</P
><P
CLASS="LITERALLAYOUT"
><EM
>bookquestions@oreilly.com</EM
></P
><P
>We have a web site for the book, where we'll list examples, errata,
and any plans for future editions. You can access this page at:</P
><P
CLASS="LITERALLAYOUT"
><EM
>http://www.oreilly.com/catalog/linag2</EM
></P
><P
>For more information about this book and others, see the O'Reilly
web site:</P
><P
CLASS="LITERALLAYOUT"
><EM
>http://www.oreilly.com</EM
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN575"
>10. Acknowledgments</A
></H2
><P
>This edition of the Networking Guide owes almost everything to the
outstanding work of Olaf and Vince. It is difficult to appreciate the
effort that goes into researching and writing a book of this nature
until you've had a chance to work on one yourself. Updating the book
was a challenging task, but with an excellent base to work from, it
was an enjoyable one.</P
><P
>This book owes very much to the numerous people who took the time to
proof-read it and help iron out many mistakes, both technical and
grammatical (never knew that there was such a thing as a dangling
participle). Phil Hughes, John Macdonald, and Erik Ratcliffe all
provided very helpful (and on the whole, quite consistent) feedback on
the content of the book.</P
><P
>We also owe many thanks to the people at O'Reilly we've had the
pleasure to work with: Sarah Jane Shangraw, who got the book into the
shape you can see now; Maureen Dempsey, who copyedited the text; Rob
Romano, Rhon Porter, and Chris Reilley, who created all the figures;
Hanna Dyer, who designed the cover; Alicia Cech, David Futato, and
Jennifer Niedherst for the internal layout; Lars Kaufman for
suggesting old woodcuts as a visual theme; Judy Hoer for the index;
and finally, Tim O'Reilly for the courage to take up such a project.</P
><P
>We are greatly indebted to Andres Seplveda, Wolfgang Michaelis,
Michael K. Johnson, and all developers who spared the time to check
the information provided in the Networking Guide. Phil Hughes, John 
MacDonald, and Eric Ratcliffe contributed invaluable comments on the 
second edition. We also wish to thank all those who read the first version 
of the Networking Guide and sent corrections and suggestions. You can find 
a hopefully complete list of contributors in the file 
<TT
CLASS="FILENAME"
>Thanks</TT
> in the online distribution. Finally, this book 
would not have been possible without the support of Holger Grothe, who 
provided Olaf with the Internet connectivity he needed to make the original 
version happen.</P
><P
>Olaf would also like to thank the following groups and companies that 
printed the first edition of the Networking Guide and have donated
money either to him or to the Linux Documentation Project as a whole:
Linux Support Team, Erlangen, Germany; S.u.S.E. GmbH, Fuerth, Germany;
and Linux System Labs, Inc., Clinton Twp., United States, RedHat
Software, North Carolina, United States.</P
><P
>Terry thanks his wife, Maggie, who patiently supported him throughout
his participation in the project despite the challenges presented by
the birth of their first child, Jack. Additionally, he thanks the
<EM
>many</EM
> people of the Linux community who either
nurtured or suffered him to the point at which he could actually take
part and actively contribute. &#8220;I'll help you if you promise to
help someone else in return.&#8221;</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN585"
>10.1. The Hall of Fame</A
></H3
><P
>Besides those we have already mentioned, a large number of people have
contributed to the Networking Guide, by reviewing it and sending us
corrections and suggestions. We are very grateful.</P
><P
>Here is a list of those whose contributions left a trace in our mail folders.</P
><P
>Al Longyear, Alan Cox, Andres Seplveda, Ben Cooper, Cameron Spitzer,
Colin McCormack, D.J. Roberts, Emilio Lopes, Fred N. van Kempen, Gert
Doering, Greg Hankins, Heiko Eissfeldt, J.P. Szikora, Johannes Stille,
Karl Eichwalder, Les Johnson, Ludger Kunz, Marc van Diest, Michael
K. Johnson, Michael Nebel, Michael Wing, Mitch D'Souza, Paul
Gortmaker, Peter Brouwer, Peter Eriksson, Phil Hughes, Raul Deluth
Miller, Rich Braun, Rick Sladkey, Ronald Aarts, Swen Themmler,
Terry Dawson, Thomas Quinot, and Yury Shevchuk.</P
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-INTRO"
></A
>Chapter 1. Introduction to Networking</H1
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="X-087-2-INTRO.HISTORY"
>1.1. History</A
></H2
><P
> The idea of networking is probably as old
as telecommunications itself.  Consider people living in the Stone
Age, when drums may have been used to transmit messages between
individuals. Suppose caveman A wants to invite caveman B over for a
game of hurling rocks at each other, but they live too far apart for B
to hear A banging his drum. What are A's options? He could 1) walk
over to B's place, 2) get a bigger drum, or 3) ask C, who lives
halfway between them, to forward the message. The last option is
called <EM
>networking</EM
>.</P
><P
>Of course, we have come a long way from the primitive pursuits and devices of
our forebears. Nowadays, we have computers talk to each other over vast
assemblages of wires, fiber optics, microwaves, and the like, to make an
appointment for Saturday's soccer match.<A
NAME="X-087-2-FNIT01"
HREF="#FTN.X-087-2-FNIT01"
><SPAN
CLASS="footnote"
>[5]</SPAN
></A
>
In the following description, we will deal with the means and ways by which
this is accomplished, but leave out the wires, as well as the soccer part.</P
><P
>We will describe three types of networks in this guide. We will focus on
TCP/IP most heavily because it is the most popular protocol suite in use on
both Local Area Networks (LANs) and Wide Area Networks (WANs), such as the
Internet. We will also take a look at UUCP and IPX. UUCP was once commonly
used to transport news and mail messages over dialup telephone connections.
It is less common today, but is still useful in a variety of situations. The
IPX protocol is used most commonly in the Novell NetWare environment and we'll
describe how to use it to connect your Linux machine into a Novell network.
Each of these protocols are networking protocols and are used to carry data
between host computers. We'll discuss how they are used and introduce you to
their underlying principles.</P
><P
>&#13; We define a network as
a collection of <EM
>hosts</EM
> that are able to
communicate with each other, often by relying on the services of a
number of dedicated hosts that relay data between the
participants. Hosts are often computers, but need not be; one can also
think of X terminals or intelligent printers as hosts. Small
agglomerations of hosts are also called <EM
>sites</EM
>.</P
><P
>&#13; Communication is
impossible without some sort of language or code. In computer
networks, these languages are collectively referred to as
<EM
>protocols</EM
>. However, you shouldn't think of
written protocols here, but rather of the highly formalized code of
behavior observed when heads of state meet, for instance. In a very
similar fashion, the protocols used in computer networks are nothing
but very strict rules for the exchange of messages between two or more
hosts.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-INTRO.TCPIP"
>1.2. TCP/IP Networks</A
></H2
><P
>&#13;




Modern networking applications require a sophisticated approach to
carrying data from one machine to another. If you are managing a Linux
machine that has many users, each of whom may wish to simultaneously
connect to remote hosts on a network, you need a way of allowing them
to share your network connection without interfering with each
other. The approach that a large number of modern networking protocols
uses is called <EM
>packet-switching</EM
>. A
<EM
>packet</EM
> is a small chunk of data that is
transferred from one machine to another across the network. The
switching occurs as the datagram is carried across each link in the
network. A packet-switched network shares a single network link among
many users by alternately sending packets from one user to another
across that link.</P
><P
> The solution that
Unix systems, and subsequently many non-Unix systems, have adopted is
known as TCP/IP. When talking about TCP/IP networks you will hear the
term <EM
>datagram</EM
>, which technically has a special
meaning but is often used interchangeably with
<EM
>packet</EM
>. In this section, we will have a look at
underlying concepts of the TCP/IP protocols.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-INTRO.TCPIP.INTRO"
>1.2.1. Introduction to TCP/IP Networks</A
></H3
><P
>&#13;
TCP/IP traces its origins to a research project funded by the United States
Defense Advanced Research Projects Agency (DARPA) in 1969. The ARPANET was an
experimental network that was converted into an operational one in 1975 after
it had proven to be a success.</P
><P
>&#13;

In 1983, the new protocol suite TCP/IP was adopted as a standard, and
all hosts on the network were required to use it.  When ARPANET
finally grew into the Internet (with ARPANET itself passing out of
existence in 1990), the use of TCP/IP had spread to networks beyond
the Internet itself. Many companies have now built corporate TCP/IP
networks, and the Internet has grown to a point at which it could
almost be considered a mainstream consumer technology. It is difficult
to read a newspaper or magazine now without seeing reference to the
Internet; almost everyone can now use it.</P
><P
>&#13; For something concrete to look at as we
discuss TCP/IP throughout the following sections, we will consider
Groucho Marx University (GMU), situated somewhere in Fredland, as an
example.  Most departments run their own Local Area Networks, while
some share one and others run several of them. They are all
interconnected and hooked to the Internet through a single high-speed
link.</P
><P
>&#13;Suppose your Linux box is connected to a LAN of Unix hosts at the Mathematics
department, and its name is <SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
>. To
access a host at the Physics department, say
<SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>,
you enter the following command:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>rlogin quark.physics</KBD
>
Welcome to the Physics Department at GMU
(ttyq2) login:</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
> 
At the prompt, you enter your login name, say
<SPAN
CLASS="SYSTEMITEM"
>andres</SPAN
>, and your password. You are then
given a shell<A
NAME="X-087-2-FNIT02"
HREF="#FTN.X-087-2-FNIT02"
><SPAN
CLASS="footnote"
>[6]</SPAN
></A
> on <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>, to which you
can type as if you were sitting at the system's console. After you exit the
shell, you are returned to your own machine's prompt. You have just used one
of the instantaneous, interactive applications that TCP/IP provides: remote
login.</P
><P
>&#13;
 
 
While being logged into <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>,
you might also want to run a graphical user interface application,
like a word processing program, a graphics drawing program, or even a
World Wide Web browser. The X windows system is a fully network-aware
graphical user environment, and it is available for many different
computing systems. To tell this application that you want to have its
windows displayed on your host's screen, you have to set the
<SPAN
CLASS="SYSTEMITEM"
>DISPLAY</SPAN
> environment variable:
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>DISPLAY=erdos.maths:0.0</KBD
>
$ <KBD
CLASS="USERINPUT"
>export DISPLAY</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>If you now start your application, it will contact your X server instead of
<SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>'s, and display all its windows
on your screen. Of course, this requires that you have X11 runnning on
<SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
>. The point here is that TCP/IP
allows <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
> to send X11 packets back and
forth to give you the illusion that you're on a single system. The network
is almost transparent here.</P
><P
> 
Another very important application in TCP/IP networks is NFS, which
stands for <EM
>Network File System</EM
>. It is another
form of making the network transparent, because it basically allows
you to treat directory hierarchies from other hosts as if they
were local file systems and look like any other directories on your
host. For example, all users' home directories can be kept on a
central server machine from which all other hosts on the LAN mount
them. The effect is that users can log in to any machine and find
themselves in the same home directory. Similarly, it is possible to
share large amounts of data (such as a database, documentation or
application programs) among many hosts by maintaining one copy of
the data on a server and allowing other hosts to access it. We will
come back to NFS in <A
HREF="#X-087-2-NFS"
>Chapter 14</A
>.</P
><P
>Of course, these are only examples of what you can do with TCP/IP networks.
The possibilities are almost limitless, and we'll introduce you to more as you
read on through the book.</P
><P
>We will now have a closer look at the way TCP/IP works. This information will
help you understand how and why you have to configure your machine. We will
start by examining the hardware, and slowly work our way up.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-INTRO.TCPIP.HISTORY"
>1.2.2. Ethernets</A
></H3
><P
>&#13; 
 
The most common type of LAN hardware is known as <EM
>Ethernet</EM
>.
In its simplest form, it consists of a single cable with hosts attached to it
through connectors, taps, or transceivers. Simple Ethernets are relatively
inexpensive to install, which together with a net transfer rate of 10, 100,
or even 1,000 Megabits per second, accounts for much of its popularity.</P
><P
>&#13;




Ethernets come in three flavors: <EM
>thick</EM
>,
<EM
>thin</EM
>, and <EM
>twisted pair</EM
>.
Thin and thick Ethernet each use a coaxial cable, differing in
diameter and the way you may attach a host to this cable. Thin
Ethernet uses a T-shaped &#8220;BNC&#8221; connector, which you insert
into the cable and twist onto a plug on the back of your computer.
Thick Ethernet requires that you drill a small hole into the cable,
and attach a transceiver using a &#8220;vampire tap.&#8221; One or
more hosts can then be connected to the transceiver. Thin and thick
Ethernet cable can run for a maximum of 200 and 500 meters
respectively, and are also called 10base-2 and 10base-5. The
&#8220;base&#8221; refers to &#8220;baseband modulation&#8221; and
simply means that the data is directly fed onto the cable without any
modem. The number at the start refers to the speed in Megabits per
second, and the number at the end is the maximum length of the cable
in hundreds of metres. Twisted pair uses a cable made of two pairs of
copper wires and usually requires additional hardware known as
<EM
>active hubs</EM
>. Twisted pair is also known as
10base-T, the &#8220;T&#8221; meaning twisted pair. The 100 Megabits
per second version is known as 100base-T.</P
><P
>To add a host to a thin Ethernet installation, you have to disrupt
network service for at least a few minutes because you have to cut the
cable to insert the connector. Although adding a host to a thick
Ethernet system is a little complicated, it does not typically bring
down the network. Twisted pair Ethernet is even simpler. It uses a
device called a &#8220;hub,&#8221; which serves as an interconnection
point. You can insert and remove hosts from a hub without interrupting
any other users at all.</P
><P
>Many people prefer thin Ethernet for small networks because it is very
inexpensive; PC cards come for as little as US $30 (many
companies are literally throwing them out now), and cable is in the
range of a few cents per meter. However, for large-scale
installations, either thick Ethernet or twisted pair is more
appropriate. For example, the Ethernet at GMU's Mathematics Department
originally chose thick Ethernet because it is a long route that the
cable must take so traffic will not be disrupted each time a host
is added to the network. Twisted pair installations are now very
common in a variety of installations. The Hub hardware is dropping in
price and small units are now available at a price that is attractive
to even small domestic networks. Twisted pair cabling can be
significantly cheaper for large installations, and the cable itself is
much more flexible than the coaxial cables used for the other Ethernet
systems. The network administrators in GMU's mathematics department
are planning to replace the existing network with a twisted pair
network in the coming finanical year because it will bring them up to
date with current technology and will save them significant time when
installing new host computers and moving existing computers around.</P
><P
> 
 
 
 
One of the drawbacks of Ethernet technology is its limited cable length, which
precludes any use of it other than for LANs. However, several Ethernet
segments can be linked to one another using repeaters, bridges, or routers.
Repeaters simply copy the signals between two or more segments so that all
segments together will act as if they are one Ethernet. Due to timing
requirements, there may not be more than four repeaters between any two hosts
on the network. Bridges and routers are more sophisticated. They analyze
incoming data and forward it only when the recipient host is not on the local
Ethernet.</P
><P
>&#13;
Ethernet works like a bus system, where a host may send packets (or
<EM
>frames</EM
>) of up to 1,500 bytes to another host on the same
Ethernet. A host is addressed by a six-byte address hardcoded into the
firmware of its Ethernet network interface card (NIC). These addresses are
usually written as a sequence of two-digit hex numbers separated by colons,
as in <SPAN
CLASS="SYSTEMITEM"
>aa:bb:cc:dd:ee:ff</SPAN
>.</P
><P
>&#13; A
frame sent by one station is seen by all attached stations, but only
the destination host actually picks it up and processes it. If two
stations try to send at the same time, a
<EM
>collision</EM
> occurs. Collisions on an Ethernet are
detected very quickly by the electronics of the interface cards and
are resolved by the two stations aborting the send, each waiting a
random interval and re-attempting the transmission. You'll hear lots
of stories about collisions on Ethernet being a problem and that
utilization of Ethernets is only about 30 percent of the available
bandwidth because of them.  Collisions on Ethernet are a
<EM
>normal</EM
> phenomenon, and on a very busy Ethernet
network you shouldn't be surprised to see collision rates of up to
about 30 percent. Utilization of Ethernet networks is more
realistically limited to about 60 percent before you need to start
worrying about it.<A
NAME="X-087-2-FNIT03"
HREF="#FTN.X-087-2-FNIT03"
><SPAN
CLASS="footnote"
>[7]</SPAN
></A
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>1.2.3. Other Types of Hardware</A
></H3
><P
>In larger installations, such as Groucho Marx University, Ethernet is usually
not the only type of equipment used. There are many other data communications
protocols available and in use. All of the protocols listed are supported by
Linux, but due to space constraints we'll describe them briefly. Many of the
protocols have HOWTO documents that describe them in detail, so you should
refer to those if you're interested in exploring those that we don't describe
in this book.</P
><P
>&#13;

At Groucho Marx University, each department's LAN is linked to the
campus high-speed &#8220;backbone&#8221; network, which is a fiber
optic cable running a network technology called <EM
>Fiber
Distributed Data Interface</EM
> (FDDI). FDDI uses an entirely
different approach to transmitting data, which basically involves
sending around a number of <EM
>tokens</EM
>, with a station
being allowed to send a frame only if it captures a token. The main
advantage of a token-passing protocol is a reduction in collisions.
Therefore, the protocol can more easily attain the full speed of the
transmission medium, up to 100 Mbps in the case of FDDI.  FDDI, being
based on optical fiber, offers a significant advantage because its
maximum cable length is much greater than wire-based technologies. It
has limits of up to around 200 km, which makes it ideal for linking
many buildings in a city, or as in GMU's case, many buildings on a
campus.</P
><P
>&#13;  Similarly, if there is any IBM
computing equipment around, an IBM Token Ring network is quite likely
to be installed. Token Ring is used as an alternative to Ethernet in
some LAN environments, and offers the same sorts of advantages as FDDI
in terms of achieving full wire speed, but at lower speeds (4 Mbps or
16 Mbps), and lower cost because it is based on wire rather than
fiber. In Linux, Token Ring networking is configured in almost
precisely the same way as Ethernet, so we don't cover it specifically.</P
><P
>Although it is much less likely today than in the past, other LAN
technologies, such as ArcNet and DECNet, might be installed. Linux
supports these too, but we don't cover them here.</P
><P
>&#13;
 Many national networks operated by
Telecommunications companies support packet switching
protocols. Probably the most popular of these is a standard named
X.25. Many Public Data Networks, like Tymnet in the U.S., Austpac in
Australia, and Datex-P in Germany offer this service. X.25 defines a
set of networking protocols that describes how data terminal
equipment, such as a host, communicates with data communications
equipment (an X.25 switch). X.25 requires a synchronous data link, and
therefore special synchronous serial port hardware. It is possible to
use X.25 with normal serial ports if you use a special device called a
PAD (Packet Assembler Disassembler). The PAD is a standalone device
that provides asynchronous serial ports and a synchronous serial
port. It manages the X.25 protocol so that simple terminal devices can
make and accept X.25 connections. X.25 is often used to carry other
network protocols, such as TCP/IP. Since IP datagrams cannot simply be
mapped onto X.25 (or vice versa), they are encapsulated in X.25
packets and sent over the network. There is an experimental
implementation of the X.25 protocol available for Linux.</P
><P
>&#13;
A more recent protocol commonly offered by telecommunications
companies is called <EM
>Frame Relay</EM
>. The Frame Relay
protocol shares a number of technical features with the X.25 protocol,
but is much more like the IP protocol in behavior. Like X.25, Frame
Relay requires special synchronous serial hardware. Because of their
similarities, many cards support both of these protocols. An
alternative is available that requires no special internal hardware,
again relying on an external device called a Frame Relay Access Device
(FRAD) to manage the encapsulation of Ethernet packets into Frame
Relay packets for transmission across a network. Frame Relay is ideal
for carrying TCP/IP between sites. Linux provides drivers that support
some types of internal Frame Relay devices.</P
><P
>&#13;
If you need higher speed networking that can carry many different
types of data, such as digitized voice and video, alongside your usual
data, ATM (Asynchronous Transfer Mode) is probably what you'll be
interested in. ATM is a new network technology that has been
specifically designed to provide a manageable, high-speed, low-latency
means of carrying data, and provide control over the Quality of
Service (Q.S.). Many telecommunications companies are deploying ATM
network infrastructure because it allows the convergence of a number
of different network services into one platform, in the hope of
achieving savings in management and support costs. ATM is often used
to carry TCP/IP.  The Networking-HOWTO offers information on the Linux
support available for ATM.</P
><P
>&#13;










Frequently, radio amateurs use their radio equipment to network their
computers; this is commonly called <EM
>packet
radio</EM
>. One of the protocols used by amateur radio operators
is called AX.25 and is loosely derived from X.25. Amateur radio
operators use the AX.25 protocol to carry TCP/IP and other protocols,
too. AX.25, like X.25, requires serial hardware capable of synchronous
operation, or an external device called a &#8220;Terminal Node
Controller&#8221; to convert packets transmitted via an asynchronous
serial link into packets transmitted synchronously. There are a
variety of different sorts of interface cards available to support
packet radio operation; these cards are generally referred to as being
&#8220;Z8530 SCC based,&#8221; and are named after the most popular
type of communications controller used in the designs. Two of the
other protocols that are commonly carried by AX.25 are the NetRom and
Rose protocols, which are network layer protocols. Since these
protocols run over AX.25, they have the same hardware
requirements. Linux supports a fully featured implementation of the
AX.25, NetRom, and Rose protocols. The AX25-HOWTO is a good source of
information on the Linux implementation of these protocols.</P
><P
>Other types of Internet access involve dialing up a central system
over slow but cheap serial lines (telephone, ISDN, and so on).  These
require yet another protocol for transmission of packets, such as SLIP
or PPP, which will be described later.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-INTRO.TCPIP.IP"
>1.2.4. The Internet Protocol</A
></H3
><P
>&#13;
Of course, you wouldn't want your networking to be limited to one
Ethernet or one point-to-point data link. Ideally, you would want to
be able to communicate with a host computer regardless of what type of
physical network it is connected to. For example, in larger
installations such as Groucho Marx University, you usually have a
number of separate networks that have to be connected in some way. At
GMU, the Math department runs two Ethernets: one with fast machines
for professors and graduates, and another with slow machines for
students. Both are linked to the FDDI campus backbone network.</P
><P
>&#13;


This connection is handled by a dedicated host called a
<EM
>gateway</EM
> that handles incoming and outgoing
packets by copying them between the two Ethernets and the FDDI fiber
optic cable. For example, if you are at the Math department and want
to access <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
> on the
Physics department's LAN from your Linux box, the networking software
will not send packets to <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>
directly because it is not on the same Ethernet. Therefore, it has to
rely on the gateway to act as a forwarder. The gateway (named
<SPAN
CLASS="SYSTEMITEM"
>sophus</SPAN
>) then forwards these
packets to its peer gateway <SPAN
CLASS="SYSTEMITEM"
>niels</SPAN
> at the Physics department, using
the backbone network, with <SPAN
CLASS="SYSTEMITEM"
>niels</SPAN
> delivering it to the destination
machine. Data flow between <SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
> and <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
> is shown in <A
HREF="#X-087-2-INTRO.FIG.IP-FLOW"
>Figure 1-1</A
>.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-INTRO.FIG.IP-FLOW"
></A
><P
><B
>Figure 1-1. The three steps of sending a datagram from erdos to quark</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_0101.jpg"></P
></DIV
></DIV
><P
>&#13;
This scheme of directing data to a remote host is called
<EM
>routing</EM
>, and packets are often referred to as
<EM
>datagrams</EM
> in this context. To facilitate things,
datagram exchange is governed by a single protocol that is independent
of the hardware used: IP, or <EM
>Internet Protocol</EM
>.
In <A
HREF="#X-087-2-ISSUES"
>Chapter 2</A
>, we will cover IP and the issues of
routing in greater detail.</P
><P
>&#13;

The main benefit of IP is that it turns physically dissimilar networks into
one apparently homogeneous network. This is called internetworking, and the
resulting &#8220;meta-network&#8221; is called an
<EM
>internet</EM
>. Note the subtle difference here between
<EM
>an</EM
> internet and <EM
>the</EM
> Internet.
The latter is the official name of one particular global internet.</P
><P
>&#13;




Of course, IP also requires a hardware-independent addressing
scheme. This is achieved by assigning each host a unique 32-bit number
called the <EM
>IP address</EM
>. An IP address is usually
written as four decimal numbers, one for each 8-bit portion, separated
by dots. For example, <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>
might have an IP address of <SPAN
CLASS="SYSTEMITEM"
>0x954C0C04</SPAN
>, which would be written as
<SPAN
CLASS="SYSTEMITEM"
>149.76.12.4</SPAN
>. This format is
also called <EM
>dotted decimal notation</EM
> and sometimes
<EM
>dotted quad notation</EM
>. It is increasingly going
under the name IPv4 (for Internet Protocol, Version 4) because a new
standard called IPv6 offers much more flexible addressing, as well as
other modern features. It will be at least a year after the release of
this edition before IPv6 is in use.</P
><P
>&#13;
You will notice that we now have three different types of addresses:
first there is the host's name, like <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>, then there are IP addresses, and
finally, there are hardware addresses, like the 6-byte Ethernet
address. All these addresses somehow have to match so that when you
type <B
CLASS="COMMAND"
>rlogin quark</B
>, the networking software can be
given <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>'s IP address; and
when IP delivers any data to the Physics department's Ethernet, it
somehow has to find out what Ethernet address corresponds to the IP
address.</P
><P
>We will deal with these situations in <A
HREF="#X-087-2-ISSUES"
>Chapter 2</A
>.
For now, it's enough to remember that these steps of finding addresses are
called <EM
>hostname resolution</EM
>, for mapping hostnames onto IP
addresses, and <EM
>address resolution</EM
>, for mapping the latter
to hardware addresses.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-INTRO.TCPIP.SLIP"
>1.2.5. IP Over Serial Lines</A
></H3
><P
>&#13;





On serial lines, a &#8220;de facto&#8221; standard exists known as SLIP, or
<EM
>Serial Line IP</EM
>. A modification of SLIP known as CSLIP,
or <EM
>Compressed SLIP</EM
>, performs compression of IP headers
to make better use of the relatively low bandwidth provided by most serial
links. Another serial protocol is PPP, or the
<EM
>Point-to-Point Protocol</EM
>. PPP is more modern than
SLIP and includes a number of features that make it more attractive. Its
main advantage over SLIP is that it isn't limited to transporting IP
datagrams, but is designed to allow just about any protocol to be carried
across it.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-INTRO.TCPIP.TCP"
>1.2.6. The Transmission Control Protocol</A
></H3
><P
>&#13;
Sending datagrams from one host to another is not the whole story. If you
log in to <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>, you want to have a
reliable connection between your <B
CLASS="COMMAND"
>rlogin</B
> process on
<SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
> and the shell process on
<SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>. Thus, the information sent
to and fro must be split up into packets by the sender and reassembled into
a character stream by the receiver. Trivial as it seems, this involves a
number of complicated tasks.</P
><P
>A very important thing to know about IP is that, by intent, it is not
reliable.  Assume that ten people on your Ethernet started downloading
the latest release of Netscape's web browser source code from GMU's
FTP server. The amount of traffic generated might be too much for the
gateway to handle, because it's too slow and it's tight on memory. Now
if you happen to send a packet to <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>, <SPAN
CLASS="SYSTEMITEM"
>sophus</SPAN
> might be out of buffer space for a
moment and therefore unable to forward it. IP solves this problem by
simply discarding it. The packet is irrevocably lost. It is therefore
the responsibility of the communicating hosts to check the integrity
and completeness of the data and retransmit it in case of error.</P
><P
>This process is performed by yet another protocol, <EM
>Transmission
Control Protocol</EM
> (TCP), which builds a reliable service on top of IP. The
essential property of TCP is that it uses IP to give you the illusion of a
simple connection between the two processes on your host and the remote
machine, so you don't have to care about how and along which route your data
actually travels.  A TCP connection works essentially like a two-way pipe that
both processes may write to and read from. Think of it as a telephone
conversation.</P
><P
>&#13;
TCP identifies the end points of such a connection by the IP addresses
of the two hosts involved and the number of a
<EM
>port</EM
> on each host. Ports may be viewed as
attachment points for network connections.  If we are to strain the
telephone example a little more, and you imagine that cities are like
hosts, one might compare IP addresses to area codes (where numbers map
to cities), and port numbers to local codes (where numbers map to
individual people's telephones). An individual host may support many
different services, each distinguished by its own port number.</P
><P
>&#13;In the <B
CLASS="COMMAND"
>rlogin</B
> example, the client application
(<B
CLASS="COMMAND"
>rlogin</B
>) opens a port on <SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
> and connects to port 513 on
<SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>, to which the
<B
CLASS="COMMAND"
>rlogind</B
> server is known to listen. This action
establishes a TCP connection. Using this connection,
<B
CLASS="COMMAND"
>rlogind</B
> performs the authorization procedure and
then spawns the shell. The shell's standard input and output are
redirected to the TCP connection, so that anything you type to
<B
CLASS="COMMAND"
>rlogin</B
> on your machine will be passed through the
TCP stream and be given to the shell as standard input.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-INTRO.TCPIP.UDP"
>1.2.7. The User Datagram Protocol</A
></H3
><P
>&#13;

Of course, TCP isn't the only user protocol in TCP/IP networking. Although
suitable for applications like <B
CLASS="COMMAND"
>rlogin</B
>, the overhead
involved is prohibitive for applications like NFS, which instead uses a
sibling protocol of TCP called UDP, or
<EM
>User Datagram Protocol</EM
>. Just like TCP, UDP allows an
application to contact a service on a certain port of the remote machine, but
it doesn't establish a connection for this. Instead, you use it to send single
packets to the destination service&#8212;hence its name.</P
><P
>Assume you want to request a small amount of data from a database
server. It takes at least three datagrams to establish a TCP
connection, another three to send and confirm a small amount of data
each way, and another three to close the connection. UDP provides us
with a means of using only two datagrams to achieve almost the same
result. UDP is said to be connectionless, and it doesn't require us to
establish and close a session. We simply put our data into a datagram
and send it to the server; the server formulates its reply, puts the
data into a datagram addressed back to us, and transmits it
back. While this is both faster and more efficient than TCP for simple
transactions, UDP was not designed to deal with datagram loss. It is
up to the application, a name server for example, to take care of
this.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-INTRO.TCPIP.PORTS"
>1.2.8. More on Ports</A
></H3
><P
>&#13; Ports may be viewed
as attachment points for network connections. If an application wants
to offer a certain service, it attaches itself to a port and waits for
clients (this is also called <EM
>listening</EM
> on the
port). A client who wants to use this service allocates a port on its
local host and connects to the server's port on the remote host. The
same port may be open on many different machines, but on each machine
only one process can open a port at any one time.</P
><P
>An important property of ports is that once a connection has been
established between the client and the server, another copy of the
server may attach to the server port and listen for more clients.
This property permits, for instance, several concurrent remote logins
to the same host, all using the same port 513. TCP is able to tell
these connections from one another because they all come from
different ports or hosts. For example, if you log in twice to
<SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
> from <SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
>, the first
<B
CLASS="COMMAND"
>rlogin</B
> client will use the local port 1023, and the
second one will use port 1022. Both, however, will connect to the same
port 513 on <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>. The two
connections will be distinguished by use of the port numbers used at
<SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
>.</P
><P
>&#13;

This example shows the use of ports as rendezvous points, where a client
contacts a specific port to obtain a specific service. In order for a client
to know the proper port number, an agreement has to be reached between the
administrators of both systems on the assignment of these numbers. For
services that are widely used, such as <B
CLASS="COMMAND"
>rlogin</B
>, these
numbers have to be administered centrally. This is done by the IETF
(Internet Engineering Task Force), which regularly releases an RFC titled
<EM
>Assigned Numbers</EM
> (RFC-1700). It describes, among other
things, the port numbers assigned to well-known services. Linux uses a file
called <TT
CLASS="FILENAME"
>/etc/services</TT
> that maps service names to
numbers.</P
><P
>It is worth noting that although both TCP and UDP connections rely on ports,
these numbers do not conflict. This means that TCP port 513, for example, is
different from UDP port 513. In fact, these ports serve as access points for
two different services, namely <B
CLASS="COMMAND"
>rlogin</B
> (TCP) and
<B
CLASS="COMMAND"
>rwho</B
> (UDP).
&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-INTRO.TCPIP.SOCKETS"
>1.2.9. The Socket Library</A
></H3
><P
> 







In Unix operating systems, the software performing all the tasks and
protocols described above is usually part of the kernel, and so it is
in Linux. The programming interface most common in the Unix world is
the <EM
>Berkeley Socket Library</EM
>. Its name derives
from a popular analogy that views ports as sockets and connecting to
a port as plugging in. It provides the <CODE
CLASS="FUNCTION"
>bind</CODE
> call
to specify a remote host, a transport protocol, and a service that a
program can connect or listen to (using <CODE
CLASS="FUNCTION"
>connect</CODE
>,
<CODE
CLASS="FUNCTION"
>listen</CODE
>, and <CODE
CLASS="FUNCTION"
>accept</CODE
>). The
socket library is somewhat more general in that it provides not only a
class of TCP/IP-based sockets (the <CODE
CLASS="FUNCTION"
>AF_INET</CODE
>
sockets), but also a class that handles connections local to the
machine (the <CODE
CLASS="FUNCTION"
>AF_UNIX</CODE
> class). Some implementations
can also handle other classes, like the XNS (<EM
>Xerox
Networking System</EM
>) protocol or X.25.</P
><P
>&#13;










In Linux, the socket library is part of the standard
<TT
CLASS="FILENAME"
>libc</TT
> C library. It supports the
<CODE
CLASS="FUNCTION"
>AF_INET</CODE
> and <CODE
CLASS="FUNCTION"
>AF_INET6</CODE
> sockets
for TCP/IP and <CODE
CLASS="FUNCTION"
>AF_UNIX</CODE
> for Unix domain
sockets. It also supports <CODE
CLASS="FUNCTION"
>AF_IPX</CODE
> for Novell's
network protocols, <CODE
CLASS="FUNCTION"
>AF_X25</CODE
> for the X.25 network
protocol, <CODE
CLASS="FUNCTION"
>AF_ATMPVC</CODE
> and
<CODE
CLASS="FUNCTION"
>AF_ATMSVC</CODE
> for the ATM network protocol and
<CODE
CLASS="FUNCTION"
>AF_AX25</CODE
>, <CODE
CLASS="FUNCTION"
>AF_NETROM</CODE
>, and
<CODE
CLASS="FUNCTION"
>AF_ROSE</CODE
> sockets for Amateur Radio protocol
support. Other protocol families are being developed and will be
added in time.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-INTRO.UUCP"
>1.3. UUCP Networks</A
></H2
><P
>&#13;
Unix-to-Unix Copy (UUCP) started out as a package of programs that
transferred files over serial lines, scheduled those transfers, and
initiated execution of programs on remote sites. It has undergone major
changes since its first implementation in the late seventies, but it
is still rather spartan in the services it offers. Its main
application is still in Wide Area Networks, based on periodic dialup
telephone links.</P
><P
>UUCP was first developed by Bell Laboratories in 1977 for
communication between their Unix development sites. In mid-1978, this
network already connected over 80 sites.  It was running email as an
application, as well as remote printing.  However, the system's
central use was in distributing new software and bug fixes. Today, UUCP
is not confined solely to the Unix environment. There are free and
commercial ports available for a variety of platforms, including
AmigaOS, DOS, and Atari's TOS.</P
><P
>One of the main disadvantages of UUCP networks is that they operate in
batches. Rather than having a permanent connection established between
hosts, it uses temporary connections. A UUCP host machine might dial in to
another UUCP host only once a day, and then only for a short period of time.
While it is connected, it will transfer all of the news, email, and files that
have been queued, and then disconnect. It is this queuing that limits the
sorts of applications that UUCP can be applied to. In the case of email, a
user may prepare an email message and post it. The message will stay queued
on the UUCP host machine until it dials in to another UUCP host to transfer
the message. This is fine for network services such as email, but is no
use at all for services such as <B
CLASS="COMMAND"
>rlogin</B
>.</P
><P
>Despite these limitations, there are still many UUCP networks
operating all over the world, run mainly by hobbyists, which offer
private users network access at reasonable prices. The main reason for
the longtime popularity of UUCP was that it was very cheap compared to
having your computer directly connected to the Internet. To make your
computer a UUCP node, all you needed was a modem, a working UUCP
implementation, and another UUCP node that was willing to feed you
mail and news. Many people were prepared to provide UUCP feeds to
individuals because such connections didn't place much demand on their
existing network.</P
><P
>We cover the configuration of UUCP in a chapter of its own later in
the book, but we won't focus on it too heavily, as it's being replaced
rapidly with TCP/IP, now that cheap Internet access has become commonly
available in most parts of the world.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1316"
>1.4. Linux Networking</A
></H2
><P
> 
 







As it is the result of a concerted effort of programmers around
the world, Linux wouldn't have been possible without the global
network. So it's not surprising that in the early stages of
development, several people started to work on providing it with
network capabilities. A UUCP implementation was running on Linux
almost from the very beginning, and work on TCP/IP-based networking
started around autumn 1992, when Ross Biro and others created what has
now become known as Net-1.</P
><P
>After Ross quit active development in May 1993, Fred van Kempen began
to work on a new implementation, rewriting major parts of the
code. This project was known as Net-2. The first public release, Net-2d, was
made in the summer of 1993 (as part of the 0.99.10 kernel), and has
since been maintained and expanded by several people, most 
notably Alan Cox.<A
NAME="X-087-2-FNIT04"
HREF="#FTN.X-087-2-FNIT04"
><SPAN
CLASS="footnote"
>[8]</SPAN
></A
> Alan's original work was known as
Net-2Debugged. After heavy debugging and numerous improvements to the
code, he changed its name to Net-3 after Linux 1.0 was released. The
Net-3 code was further developed for Linux 1.2 and Linux 2.0.  The 2.2
and later kernels use the Net-4 version network support, which remains
the standard official offering today.</P
><P
> The
Net-4 Linux Network code offers a wide variety of device drivers and
advanced features. Standard Net-4 protocols include SLIP and PPP (for
sending network traffic over serial lines), PLIP (for parallel lines),
IPX (for Novell compatible networks, which we'll discuss in <A
HREF="#X-087-2-IPX"
>Chapter 15</A
>), Appletalk (for Apple networks) and AX.25,
NetRom, and Rose (for amateur radio networks). Other standard Net-4
features include IP firewalling, IP accounting (discussed later in
<A
HREF="#X-087-2-FIREWALL"
>Chapter 9</A
> and <A
HREF="#X-087-2-ACCOUNTING"
>Chapter 10</A
>), and IP Masquerade (discussed later in
<A
HREF="#X-087-2-IPMASQ"
>Chapter 11</A
>. IP tunnelling in a couple of
different flavors and advanced policy routing are supported. A very
large variety of Ethernet devices is supported, in addition to support
for some FDDI, Token Ring, Frame Relay, and ISDN, and ATM cards.</P
><P
>&#13;Additionally, there are a number of other features that greatly
enhance the flexibility of Linux. These features include an
implementation of the SMB filesystem, which interoperates with
applications like <EM
>lanmanager</EM
> and Microsoft
Windows, called Samba, written by Andrew Tridgell, and an
implementation of the Novell NCP (NetWare Core Protocol).<A
NAME="X-087-2-FNIT05"
HREF="#FTN.X-087-2-FNIT05"
><SPAN
CLASS="footnote"
>[9]</SPAN
></A
>&#13;</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN1356"
>1.4.1. Different Streaks of Development</A
></H3
><P
>There have been, at various times, varying network development efforts active
for Linux.</P
><P
>&#13;  Fred continued development after
Net-2Debugged was made the official network implementation. This
development led to the Net-2e, which featured a much revised design of
the networking layer. Fred was working toward a standardized Device
Driver Interface (DDI), but the Net-2e work has ended now.</P
><P
> Yet another 
implementation of TCP/IP networking came from Matthias
Urlichs, who wrote an ISDN driver for Linux and FreeBSD. For this
driver, he integrated some of the BSD networking code in the Linux
kernel.  That project, too is no longer being worked on.</P
><P
>There has been a lot of rapid change in the Linux kernel networking
implementation, and change is still the watchword as development
continues. Sometimes this means that changes also have to occur in
other software, such as the network configuration tools. While this is
no longer as large a problem as it once was, you may still find that
upgrading your kernel to a later version means that you must upgrade
your network configuration tools, too. Fortunately, with the large
number of Linux distributions available today, this is a quite simple
task.</P
><P
>&#13;
The Net-4 network implementation is now quite mature and is in use at a
very large number of sites around the world. Much work has been done on
improving the performance of the Net-4 implementation, and it now competes
with the best implementations available for the same hardware platforms.
Linux is proliferating in the Internet Service Provider environment, and is
often used to build cheap and reliable World Wide Web servers, mail servers,
and news servers for these sorts of organizations. There is now sufficient
development interest in Linux that it is managing to keep abreast of
networking technology as it changes, and current releases of the Linux kernel
offer the next generation of the IP protocol, IPv6, as a standard offering.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN1376"
>1.4.2. Where to Get the Code</A
></H3
><P
>&#13;


It seems odd now to remember that in the early days of the Linux
network code development, the standard kernel required a huge patch
kit to add the networking support to it. Today, network development
occurs as part of the mainstream Linux kernel development process. The
latest stable Linux kernels can be found on <EM
>ftp.kernel.org</EM
> in
<TT
CLASS="FILENAME"
>/pub/linux/kernel/v2.x/</TT
>, where
<EM
>x</EM
> is an even number. The latest experimental Linux
kernels can be found on <EM
>ftp.kernel.org</EM
>
in <TT
CLASS="FILENAME"
>/pub/linux/kernel/v2.y/</TT
>, where
<EM
>y</EM
> is an odd number. There are Linux kernel source
mirrors all over the world. It is now hard to imagine Linux without
standard network support.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1396"
>1.5. Maintaining Your System</A
></H2
><P
>&#13;
Throughout this book, we will mainly deal with installation and
configuration issues. Administration is, however, much more than
that&#8212;after setting up a service, you have to keep it running, too.
For most services, only a little attendance will be necessary, while some,
like mail and news, require that you perform routine tasks to keep your system
up to date. We will discuss these tasks in later chapters.</P
><P
>&#13;
The absolute minimum in maintenance is to check system and per-application
log files regularly for error conditions and unusual events. Often, you
will want to do this by writing a couple of administrative shell scripts
and periodically running them from <B
CLASS="COMMAND"
>cron</B
>. The source
distributions of some major applications, like <B
CLASS="COMMAND"
>inn</B
> or
C News, contain such scripts. You only have to tailor them to suit your
needs and preferences.</P
><P
>The output from any of your <B
CLASS="COMMAND"
>cron</B
> jobs should be mailed to an
administrative account. By default, many applications will send error
reports, usage statistics, or log file summaries to the
<SPAN
CLASS="SYSTEMITEM"
>root</SPAN
> account. This makes sense only
if you log in as <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
> frequently; a much
better idea is to forward <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
>'s mail to
your personal account by setting up a mail alias as described in
<A
HREF="#X-087-2-EXIM"
>Chapter 19</A
> or <A
HREF="#X-087-2-SENDMAIL"
>Chapter 18</A
>.</P
><P
>However carefully you have configured your site, Murphy's law guarantees
that some problem <EM
>will</EM
> surface eventually. Therefore,
maintaining a system also means being available for complaints. Usually,
people expect that the system administrator can at least be reached via email
as <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
>, but there are also other
addresses that are commonly used to reach the person responsible for a
specific aspect of maintenence. For instance, complaints about a
malfunctioning mail configuration will usually be addressed to
<SPAN
CLASS="SYSTEMITEM"
>postmaster</SPAN
>, and problems with the
news system may be reported to
<SPAN
CLASS="SYSTEMITEM"
>newsmaster</SPAN
> or
<SPAN
CLASS="SYSTEMITEM"
>usenet</SPAN
>. Mail to
<SPAN
CLASS="SYSTEMITEM"
>hostmaster</SPAN
> should be redirected to
the person in charge of the host's basic network services, and the DNS name
service if you run a name server.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-INTRO.SECURITY"
>1.5.1. System Security</A
></H3
><P
>&#13;
Another very important aspect of system administration in a network
environment is protecting your system and users from intruders.
Carelessly managed systems offer malicious people many targets. Attacks
range from password guessing to Ethernet snooping, and the damage caused
may range from faked mail messages to data loss or violation of your
users' privacy. We will mention some particular problems when discussing
the context in which they may occur and some common defenses against them.</P
><P
>This section will discuss a few examples and basic techniques for
dealing with system security.  Of course, the topics covered cannot
treat all security issues you may be faced with in detail; they merely
serve to illustrate the problems that may arise.  Therefore, reading a
good book on security is an absolute must, especially in a networked
system.</P
><P
>System security starts with good system administration. This includes
checking the ownership and permissions of all vital files and
directories and monitoring use of privileged accounts. The COPS
program, for instance, will check your file system and common
configuration files for unusual permissions or other anomalies. It is
also wise to use a password suite that enforces certain rules on the
users' passwords that make them hard to guess. The shadow password
suite, for instance, requires a password to have at least five letters
and to contain both upper- and lowercase numbers, as well as
non-alphabetic characters.</P
><P
>  When making a service
accessible to the network, make sure to give it &#8220;least
privilege&#8221;; don't permit it to do things that aren't required
for it to work as designed. For example, you should make programs
setuid to <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
> or some other
privileged account only when necessary. Also, if you want to use a
service for only a very limited application, don't hesitate to
configure it as restrictively as your special application allows. For
instance, if you want to allow diskless hosts to boot from your
machine, you must provide <EM
>Trivial File Transfer
Protocol</EM
>&#8201; (TFTP) so that they can download basic
configuration files from the <TT
CLASS="FILENAME"
>/boot</TT
>
directory. However, when used unrestrictively, TFTP allows users
anywhere in the world to download any world-readable file from your
system. If this is not what you want, restrict TFTP service to the
<TT
CLASS="FILENAME"
>/boot</TT
> directory.<A
NAME="X-087-2-FNIT06"
HREF="#FTN.X-087-2-FNIT06"
><SPAN
CLASS="footnote"
>[10]</SPAN
></A
>&#13;</P
><P
>&#13;You might also want to restrict certain services to users from certain
hosts, say from your local network.  In <A
HREF="#X-087-2-APPL"
>Chapter 12</A
>,
we introduce <B
CLASS="COMMAND"
>tcpd</B
>, which does this for a variety of
network applications. More sophisticated methods of restricting access
to particular hosts or services will be explored later in <A
HREF="#X-087-2-FIREWALL"
>Chapter 9</A
>.</P
><P
>Another important point is to avoid &#8220;dangerous&#8221;
software. Of course, any software you use can be dangerous because
software may have bugs that clever people might exploit to gain access
to your system. Things like this happen, and there's no complete
protection against it. This problem affects free software and
commercial products alike.<A
NAME="X-087-2-FNIT07"
HREF="#FTN.X-087-2-FNIT07"
><SPAN
CLASS="footnote"
>[11]</SPAN
></A
> However, programs that require special privilege are inherently
more dangerous than others, because any loophole can have drastic
consequences.<A
NAME="X-087-2-FNIT08"
HREF="#FTN.X-087-2-FNIT08"
><SPAN
CLASS="footnote"
>[12]</SPAN
></A
>
If you install a setuid program for network purposes, be doubly
careful to check the documentation so that you don't create a security
breach by accident.</P
><P
>&#13;
Another source of concern should be programs that enable login or
command execution with limited authentication. The
<B
CLASS="COMMAND"
>rlogin</B
>, <B
CLASS="COMMAND"
>rsh</B
>, and
<B
CLASS="COMMAND"
>rexec</B
> commands are all very useful, but offer very
limited authentication of the calling party.  Authentication is based
on trust of the calling host name obtained from a name server (we'll
talk about these later), which can be faked. Today it should be
standard practice to disable the <B
CLASS="COMMAND"
>r</B
> commands
completely and replace them with the <B
CLASS="COMMAND"
>ssh</B
> suite of
tools. The <B
CLASS="COMMAND"
>ssh</B
> tools use a much more reliable
authentication method and provide other services, such as encryption
and compression, as well. </P
><P
>&#13;You can never rule out the possibility that your precautions might
fail, regardless of how careful you have been. You should therefore
make sure you detect intruders early. Checking the system log files is
a good starting point, but the intruder is probably clever enough to
anticipate this action and will delete any obvious traces he or she
left. However, there are tools like <B
CLASS="COMMAND"
>tripwire</B
>,
written by Gene Kim and Gene Spafford, that allow you to check vital
system files to see if their contents or permissions have been
changed. <B
CLASS="COMMAND"
>tripwire</B
> computes various strong
checksums over these files and stores them in a database. During
subsequent runs, the checksums are recomputed and compared to the
stored ones to detect any modifications.

 </P
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-ISSUES"
></A
>Chapter 2. Issues of TCP/IP Networking</H1
><P
>In this chapter we turn to the configuration decisions you'll need to make
when connecting your Linux machine to a TCP/IP network, including dealing 
with IP addresses, hostnames, and routing issues.  This chapter gives you the
background you need in order to understand what your setup requires, while
the next chapters cover the tools you will use.</P
><P
>To learn more about TCP/IP and the reasons behind it, refer to the
three-volume set <EM
>Internetworking with TCP/IP</EM
>, by
Douglas R. Comer (Prentice Hall). For a more detailed guide to managing 
a TCP/IP network, see <EM
>TCP/IP Network Administration</EM
> 
by Craig Hunt (O'Reilly).</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-ISSUES.INTERFACES"
>2.1. Networking Interfaces</A
></H2
><P
>To hide the diversity of equipment that may be used in a networking
environment, TCP/IP defines an abstract <EM
>interface</EM
>
through which the hardware is accessed. This interface offers a set of
operations that is the same for all types of hardware and basically deals
with sending and receiving packets.</P
><P
>For each peripheral networking device, a corresponding interface has
to be present in the kernel. For example, Ethernet interfaces in Linux
are called by such names as <TT
CLASS="FILENAME"
>eth0</TT
> and
<TT
CLASS="FILENAME"
>eth1</TT
>; PPP (discussed in <A
HREF="#X-087-2-PPP"
>Chapter 8</A
>&#8201;) interfaces are named <TT
CLASS="FILENAME"
>ppp0</TT
>
and <TT
CLASS="FILENAME"
>ppp1</TT
>; and FDDI interfaces are given names
like <TT
CLASS="FILENAME"
>fddi0</TT
> and <TT
CLASS="FILENAME"
>fddi1</TT
>. These
interface names are used for configuration purposes when you want to
specify a particular physical device in a configuration command, and
they have no meaning beyond this use.</P
><P
>Before being used by TCP/IP networking, an interface must be assigned
an IP address that serves as its identification when communicating
with the rest of the world. This address is different from the
interface name mentioned previously; if you compare an interface to a
door, the address is like the nameplate pinned on it.</P
><P
>&#13;Other device parameters may be set, like the maximum size of datagrams 
that can be processed by a particular piece of hardware, which is referred
to as <EM
>Maximum Transfer Unit</EM
> (MTU). Other attributes 
will be introduced later. Fortunately, most attributes have sensible defaults.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-ISSUES.IP-ADDRESSES"
>2.2. IP Addresses</A
></H2
><P
>As mentioned in <A
HREF="#X-087-2-INTRO"
>Chapter 1</A
>, the IP networking protocol 
understands addresses as 32-bit numbers. Each machine must be assigned a 
number unique to the networking environment.<A
NAME="X-087-2-FNIS01"
HREF="#FTN.X-087-2-FNIS01"
><SPAN
CLASS="footnote"
>[13]</SPAN
></A
>
If you are running a local network that does not have TCP/IP traffic
with other networks, you may assign these numbers according to your
personal preferences. There are some IP address ranges that have been
reserved for such private networks. These ranges are listed in <A
HREF="#X-087-2-ISSUES.RESERVED.ADDRESSES"
>Table 2-1</A
>.  However, for sites on
the Internet, numbers are assigned by a central authority, the
<EM
>Network Information Center</EM
> (NIC).<A
NAME="X-087-2-FNIS02"
HREF="#FTN.X-087-2-FNIS02"
><SPAN
CLASS="footnote"
>[14]</SPAN
></A
>&#13;</P
><P
>&#13; 
IP addresses are split up into four eight-bit numbers called
<EM
>octets</EM
> for readability.  For example,
<SPAN
CLASS="SYSTEMITEM"
>quark.physics.groucho.edu</SPAN
> has an
IP address of <SPAN
CLASS="SYSTEMITEM"
>0x954C0C04</SPAN
>, which is
written as <SPAN
CLASS="SYSTEMITEM"
>149.76.12.4</SPAN
>. This format
is often referred to as <EM
>dotted quad notation</EM
>.</P
><P
>Another reason for this notation is that IP addresses are split into a
<EM
>network</EM
> number, which is contained in the leading
octets, and a <EM
>host</EM
> number, which is the remainder.
When applying to the NIC for IP addresses, you are not assigned an address
for each single host you plan to use. Instead, you are given a network
number and allowed to assign all valid IP addresses within this range to
hosts on your network according to your preferences.</P
><P
>The size of the host part depends on the size of the network. To accommodate
different needs, several classes of networks, defining different places to 
split IP addresses, have been defined. The class networks are described here:</P
><P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Class A</DT
><DD
><P
>Class A comprises networks <SPAN
CLASS="SYSTEMITEM"
>1.0.0.0</SPAN
>
through <SPAN
CLASS="SYSTEMITEM"
>127.0.0.0</SPAN
>. The network number
is contained in the first octet. This class provides for a 24-bit host part,
allowing roughly 1.6 million hosts per network.</P
></DD
><DT
>Class B</DT
><DD
><P
>Class B contains networks <SPAN
CLASS="SYSTEMITEM"
>128.0.0.0</SPAN
>
through <SPAN
CLASS="SYSTEMITEM"
>191.255.0.0</SPAN
>; the network
number is in the first two octets. This class allows for 16,320 nets with 65,024
hosts each.</P
></DD
><DT
>Class C</DT
><DD
><P
> Class C networks
range from <SPAN
CLASS="SYSTEMITEM"
>192.0.0.0</SPAN
> through
<SPAN
CLASS="SYSTEMITEM"
>223.255.255.0</SPAN
>, with the
network number contained in the first three octets. This class allows
for nearly 2 million networks with up to 254 hosts.</P
></DD
><DT
>Classes D, E, and F</DT
><DD
><P
>Addresses falling into the range of
<SPAN
CLASS="SYSTEMITEM"
>224.0.0.0</SPAN
> through
<SPAN
CLASS="SYSTEMITEM"
>254.0.0.0</SPAN
> are either experimental or
are reserved for special purpose use and don't specify any network. IP
Multicast, which is a service that allows material to be transmitted to many
points on an internet at one time, has been assigned addresses from within
this range.</P
></DD
></DL
></DIV
></P
><P
>If we go back to the example in Chapter 1, we find that
<SPAN
CLASS="SYSTEMITEM"
>149.76.12.4</SPAN
>, the address of
<SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>, refers to host
<SPAN
CLASS="SYSTEMITEM"
>12.4</SPAN
> on the class B network
<SPAN
CLASS="SYSTEMITEM"
>149.76.0.0</SPAN
>.</P
><P
>&#13;You may have noticed that not all possible values in the previous list
were allowed for each octet in the host part. This is because octets
<SPAN
CLASS="SYSTEMITEM"
>0</SPAN
> and <SPAN
CLASS="SYSTEMITEM"
>255</SPAN
> are reserved for special purposes.
An address where all host part bits are 0 refers to the network, and
an address where all bits of the host part are 1 is called a
<EM
>broadcast address</EM
>.  This refers to all hosts on
the specified network simultaneously.  Thus, <SPAN
CLASS="SYSTEMITEM"
>149.76.255.255</SPAN
> is not a valid host
address, but refers to all hosts on network <SPAN
CLASS="SYSTEMITEM"
>149.76.0.0</SPAN
>.</P
><P
>&#13;


A number of network addresses are reserved for special purposes.
<SPAN
CLASS="SYSTEMITEM"
>0.0.0.0</SPAN
> and <SPAN
CLASS="SYSTEMITEM"
>127.0.0.0</SPAN
> are two such addresses. The
first is called the <EM
>default route</EM
>, and the latter
is the <EM
>loopback address</EM
>. The default route has to
do with the way the IP routes datagrams.</P
><P
>Network <SPAN
CLASS="SYSTEMITEM"
>127.0.0.0</SPAN
> is reserved for
IP traffic local to your host. Usually, address
<SPAN
CLASS="SYSTEMITEM"
>127.0.0.1</SPAN
> will be assigned to a special
interface on your host, the <EM
>loopback interface</EM
>, which
acts like a closed circuit. Any IP packet handed to this interface from 
TCP or UDP will be returned to them as if it had just arrived from some 
network. This allows you to develop and test networking software without 
ever using a &#8220;real&#8221; network. The loopback network also allows
you to use networking software on a standalone host. This may not be as 
uncommon as it sounds; for instance, many UUCP sites don't have IP 
connectivity at all, but still want to run the INN news system. For 
proper operation on Linux, INN requires the loopback interface.</P
><P
>&#13;Some address ranges from each of the network classes have been set
aside and designated &#8220;reserved&#8221; or &#8220;private&#8221;
address ranges.  These addresses are reserved for use by private
networks and are not routed on the Internet. They are commonly used by
organizations building their own intranet, but even small networks
often find them useful. The reserved network addresses appear in <A
HREF="#X-087-2-ISSUES.RESERVED.ADDRESSES"
>Table 2-1</A
>.</P
><DIV
CLASS="TABLE"
><A
NAME="X-087-2-ISSUES.RESERVED.ADDRESSES"
></A
><P
><B
>Table 2-1. IP Address Ranges Reserved for Private Use</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><THEAD
><TR
><TH
>Class</TH
><TH
>Networks</TH
></TR
></THEAD
><TBODY
><TR
><TD
>A</TD
><TD
>10.0.0.0 through 10.255.255.255</TD
></TR
><TR
><TD
>B</TD
><TD
>172.16.0.0 through 172.31.0.0</TD
></TR
><TR
><TD
>C</TD
><TD
>192.168.0.0 through 192.168.255.0</TD
></TR
></TBODY
></TABLE
></DIV
><P
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-ISSUES.ARP"
>2.3. Address Resolution</A
></H2
><P
>Now that you've seen how IP addresses are composed, you may be wondering
how they are used on an Ethernet or Token Ring network to address different
hosts. After all, these protocols have their own addresses to identify hosts
that have absolutely nothing in common with an IP address, don't they? Right.</P
><P
>&#13;
A mechanism is needed to map IP addresses onto the addresses of the
underlying network. The mechanism used is the <EM
>Address
Resolution Protocol</EM
> (ARP). In fact, ARP is not confined to
Ethernet or Token Ring, but is used on other types of networks, such
as the amateur radio AX.25 protocol. The idea underlying ARP is
exactly what most people do when they have to find Mr. X in a throng
of 150 people: the person who wants him calls out loudly enough that
everyone in the room can hear them, expecting him to respond if he is
there. When he responds, we know which person he is.</P
><P
>When ARP wants to find the Ethernet address corresponding to a given
IP address, it uses an Ethernet feature called <EM
>broadcasting</EM
>, in which a datagram is addressed to
all stations on the network simultaneously. The broadcast datagram
sent by ARP contains a query for the IP address. Each receiving host
compares this query to its own IP address and if it matches, returns
an ARP reply to the inquiring host.  The inquiring host can now
extract the sender's Ethernet address from the reply.</P
><P
>You may wonder how a host can reach an Internet address that may be on
a different network halfway around the world. The answer to this
question involves <EM
>routing</EM
>, namely finding the
physical location of a host in a network. We will discuss this issue
further in the next section.</P
><P
>Let's talk a little more about ARP. Once a host has discovered an
Ethernet address, it stores it in its ARP cache so that it doesn't
have to query for it again the next time it wants to send a datagram
to the host in question.  However, it is unwise to keep this
information forever; the remote host's Ethernet card may be replaced
because of technical problems, so the ARP entry becomes
invalid. Therefore, entries in the ARP cache are discarded after some
time to force another query for the IP address.</P
><P
>&#13;


Sometimes it is also necessary to find the IP address associated with
a given Ethernet address. This happens when a diskless machine wants
to boot from a server on the network, which is a common situation on
Local Area Networks. A diskless client, however, has virtually no
information about itself&#8212;except for its Ethernet address! So it
broadcasts a message containing a request asking a boot server to
provide it with an IP address. There's another protocol for this
situation named <EM
>Reverse Address Resolution
Protocol</EM
> (RARP). Along with the BOOTP protocol, it serves
to define a procedure for bootstrapping diskless clients over the
network.</P
><P
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-ISSUES.ROUTING"
>2.4. IP Routing</A
></H2
><P
>We now take up the question of finding the host that datagrams go to
based on the IP address. Different parts of the address are handled in
different ways; it is your job to set up the files that indicate how to treat
each part.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-ISSUES.ROUTING.NETWORKS"
>2.4.1. IP Networks</A
></H3
><P
>When you write a letter to someone, you usually put a complete address
on the envelope specifying the country, state, and Zip Code. After you
put it in the mailbox, the post office will deliver it to its
destination: it will be sent to the country indicated, where the
national service will dispatch it to the proper state and region. The
advantage of this hierarchical scheme is obvious: wherever you
post the letter, the local postmaster knows roughly which direction to
forward the letter, but the postmaster doesn't care which way the
letter will travel once it reaches its country of destination.</P
><P
>IP networks are structured similarly. The whole Internet consists of a
number of proper networks, called <EM
>autonomous
systems</EM
>. Each system performs routing between its member
hosts internally so that the task of delivering a datagram is reduced
to finding a path to the destination host's network. As soon as the
datagram is handed to <EM
>any</EM
> host on that particular
network, further processing is done exclusively by the network itself.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-ISSUES.ROUTING.SUBNETS"
>2.4.2. Subnetworks</A
></H3
><P
>This structure is reflected by splitting IP addresses into a host and
network part, as explained previously. By default, the destination network is
derived from the network part of the IP address. Thus, hosts with identical
IP <EM
>network</EM
> numbers should be found within the same
network.<A
NAME="X-087-2-FNIS03"
HREF="#FTN.X-087-2-FNIS03"
><SPAN
CLASS="footnote"
>[15]</SPAN
></A
>&#13;</P
><P
>It makes sense to offer a similar scheme <EM
>inside</EM
> the
network, too, since it may consist of a collection of hundreds of smaller
networks, with the smallest units being physical networks like Ethernets.
Therefore, IP allows you to subdivide an IP network into several
<EM
>subnets</EM
>.</P
><P
>&#13;
A subnet takes responsibility for delivering datagrams to a certain range
of IP addresses. It is an extension of the concept of splitting bit fields,
as in the A, B, and C classes. However, the network part is now extended 
to include some bits from the host part. The number of bits that are 
interpreted as the subnet number is given by the so-called 
<EM
>subnet mask</EM
>, or <EM
>netmask</EM
>. This is a
32-bit number too, which specifies the bit mask for the network part of the
IP address.</P
><P
>&#13;The campus network of Groucho Marx University is an example of such a
network. It has a class B network number of
<SPAN
CLASS="SYSTEMITEM"
>149.76.0.0</SPAN
>, and its
netmask is therefore <SPAN
CLASS="SYSTEMITEM"
>255.255.0.0</SPAN
>.</P
><P
>Internally, GMU's campus network consists of several smaller networks,
such various departments' LANs. So the range of IP addresses is broken
up into 254 subnets, <SPAN
CLASS="SYSTEMITEM"
>149.76.1.0</SPAN
> through <SPAN
CLASS="SYSTEMITEM"
>149.76.254.0</SPAN
>. For example, the department
of Theoretical Physics has been assigned <SPAN
CLASS="SYSTEMITEM"
>149.76.12.0</SPAN
>. The campus backbone is a
network in its own right, and is given <SPAN
CLASS="SYSTEMITEM"
>149.76.1.0</SPAN
>.  These subnets share the same
IP network number, while the third octet is used to distinguish
between them. They will thus use a subnet mask of <SPAN
CLASS="SYSTEMITEM"
>255.255.255.0</SPAN
>.</P
><P
><A
HREF="#X-087-2-ISSUES.FIG.SUBNET"
>Figure 2-1</A
> shows how <SPAN
CLASS="SYSTEMITEM"
>149.76.12.4</SPAN
>, the address of <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>, is interpreted differently when
the address is taken as an ordinary class B network and when used with 
subnetting.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-ISSUES.FIG.SUBNET"
></A
><P
><B
>Figure 2-1. Subnetting a class B network</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_0201.jpg"></P
></DIV
></DIV
><P
>&#13;
It is worth noting that <EM
>subnetting</EM
> (the technique
of generating subnets) is only an <EM
>internal
division</EM
> of the network. Subnets are generated by the
network owner (or the administrators). Frequently, subnets are created
to reflect existing boundaries, be they physical (between two
Ethernets), administrative (between two departments), or geographical
(between two locations), and authority over each subnet is delegated
to some contact person. However, this structure affects only the
network's internal behavior, and is completely invisible to the
outside world.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-ISSUES.ROUTING.GATEWAY"
>2.4.3. Gateways</A
></H3
><P
>Subnetting is not only a benefit to the organization; it is frequently
a natural consequence of hardware boundaries. The viewpoint of a host
on a given physical network, such as an Ethernet, is a very limited
one: it can only talk to the host of the network it is on.  All other
hosts can be accessed only through special-purpose machines called
<EM
>gateways</EM
>. A gateway is a host that is connected
to two or more physical networks simultaneously and is configured to
switch packets between them.</P
><P
><A
HREF="#X-087-2-ISSUES.FIG.IP"
>Figure 2-2</A
> shows part of the network topology at
Groucho Marx University (GMU).  Hosts that are on two subnets at the same
time are shown with both addresses.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-ISSUES.FIG.IP"
></A
><P
><B
>Figure 2-2. A part of the net topology at Groucho Marx University</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_0202.jpg"></P
></DIV
></DIV
><P
>Different physical networks have to belong to different IP networks for IP to 
be able to recognize if a host is on a local network. For example, the 
network number
<SPAN
CLASS="SYSTEMITEM"
>149.76.4.0</SPAN
> is reserved for hosts on
the mathematics LAN. When sending a datagram to
<SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>, the network software on
<SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
> immediately sees from the IP
address <SPAN
CLASS="SYSTEMITEM"
>149.76.12.4</SPAN
> that the
destination host is on a different physical network, and therefore can be
reached only through a gateway (<SPAN
CLASS="SYSTEMITEM"
>sophus</SPAN
>
by default).</P
><P
><SPAN
CLASS="SYSTEMITEM"
>sophus</SPAN
> itself is connected to two
distinct subnets: the Mathematics department and the campus backbone. It
accesses each through a different interface, <TT
CLASS="FILENAME"
>eth0</TT
> and
<TT
CLASS="FILENAME"
>fddi0</TT
>, respectively.  Now, what IP address do we assign
it? Should we give it one on subnet
<SPAN
CLASS="SYSTEMITEM"
>149.76.1.0</SPAN
>, or on
<SPAN
CLASS="SYSTEMITEM"
>149.76.4.0</SPAN
>?</P
><P
>The answer is: &#8220;both.&#8221;
<SPAN
CLASS="SYSTEMITEM"
>sophus</SPAN
> has been assigned the address
<SPAN
CLASS="SYSTEMITEM"
>149.76.1.1</SPAN
> for use on the
<SPAN
CLASS="SYSTEMITEM"
>149.76.1.0</SPAN
> network and address
<SPAN
CLASS="SYSTEMITEM"
>149.76.4.1</SPAN
> for use on the
<SPAN
CLASS="SYSTEMITEM"
>149.76.4.0</SPAN
> network. A gateway must be
assigned one IP address for each network it belongs to. These addresses&#8212;along with the corresponding netmask&#8212;are tied to
the interface through which the subnet is accessed. Thus, the interface and 
address mapping for <SPAN
CLASS="SYSTEMITEM"
>sophus</SPAN
>
would look like this:</P
><DIV
CLASS="INFORMALTABLE"
><P
></P
><A
NAME="AEN1770"
></A
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Interface</TH
><TH
>Address</TH
><TH
>Netmask</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="FILENAME"
>eth0</TT
></TD
><TD
>149.76.4.1</TD
><TD
>255.255.255.0</TD
></TR
><TR
><TD
><TT
CLASS="FILENAME"
>fddi0</TT
></TD
><TD
>149.76.1.1</TD
><TD
>255.255.255.0</TD
></TR
><TR
><TD
><TT
CLASS="FILENAME"
>lo</TT
></TD
><TD
>127.0.0.1</TD
><TD
>255.0.0.0</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
>The last entry describes the loopback interface <TT
CLASS="FILENAME"
>lo</TT
>, which
we talked about earlier.</P
><P
>&#13;Generally, you can ignore the subtle difference between attaching an
address to a host or its interface. For hosts that are on one network
only, like <SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
>, you would generally
refer to the host as having this-and-that IP address, although strictly
speaking, it's the Ethernet interface that has this IP address. The
distinction is really important only when you refer to a gateway.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-ISSUES.ROUTING.TABLE"
>2.4.4. The Routing Table</A
></H3
><P
>We now focus our attention on how IP chooses a gateway to use to deliver 
a datagram to a remote network.</P
><P
>We have seen that <SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
>, when
given a datagram for <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>,
checks the destination address and finds that it is not on the local
network.  <SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
> therefore
sends the datagram to the default gateway <SPAN
CLASS="SYSTEMITEM"
>sophus</SPAN
>, which is now faced with the same
task.  <SPAN
CLASS="SYSTEMITEM"
>sophus</SPAN
> recognizes that
<SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
> is not on any of the
networks it is connected to directly, so it has to find yet another
gateway to forward it through. The correct choice would be <SPAN
CLASS="SYSTEMITEM"
>niels</SPAN
>, the gateway to the Physics
department. <SPAN
CLASS="SYSTEMITEM"
>sophus</SPAN
> thus 
needs information to associate a destination network with a
suitable gateway.</P
><P
>IP uses a table for this task that associates networks with the
gateways by which they may be reached. A catch-all entry (the
<EM
>default route</EM
>) must generally be supplied too;
this is the gateway associated with network <SPAN
CLASS="SYSTEMITEM"
>0.0.0.0</SPAN
>. All destination addresses match
this route, since none of the 32 bits are required to match, and
therefore packets to an unknown network are sent through the default
route.  On <SPAN
CLASS="SYSTEMITEM"
>sophus</SPAN
>, the table
might look like this:</P
><DIV
CLASS="INFORMALTABLE"
><P
></P
><A
NAME="AEN1821"
></A
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><COL><COL><THEAD
><TR
><TH
>Network</TH
><TH
>Netmask</TH
><TH
>Gateway</TH
><TH
>Interface</TH
></TR
></THEAD
><TBODY
><TR
><TD
>149.76.1.0</TD
><TD
>255.255.255.0</TD
><TD
>-</TD
><TD
><TT
CLASS="FILENAME"
>fddi0</TT
></TD
></TR
><TR
><TD
>149.76.2.0</TD
><TD
>255.255.255.0</TD
><TD
>149.76.1.2</TD
><TD
><TT
CLASS="FILENAME"
>fddi0</TT
></TD
></TR
><TR
><TD
>149.76.3.0</TD
><TD
>255.255.255.0</TD
><TD
>149.76.1.3</TD
><TD
><TT
CLASS="FILENAME"
>fddi0</TT
></TD
></TR
><TR
><TD
>149.76.4.0</TD
><TD
>255.255.255.0</TD
><TD
>-</TD
><TD
><TT
CLASS="FILENAME"
>eth0</TT
></TD
></TR
><TR
><TD
>149.76.5.0</TD
><TD
>255.255.255.0</TD
><TD
>149.76.1.5</TD
><TD
><TT
CLASS="FILENAME"
>fddi0</TT
></TD
></TR
><TR
><TD
>&#8230;</TD
><TD
>&#8230;</TD
><TD
>&#8230;</TD
><TD
>&#8230;</TD
></TR
><TR
><TD
>0.0.0.0</TD
><TD
>0.0.0.0</TD
><TD
>149.76.1.2</TD
><TD
><TT
CLASS="FILENAME"
>fddi0</TT
></TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
>If you need to use a route to a network that <SPAN
CLASS="SYSTEMITEM"
>sophus</SPAN
> is directly connected to, you
don't need a gateway; the gateway column here contains a hyphen.</P
><P
>&#13;The process for identifying whether a particular destination address
matches a route is a mathematical operation. The process is quite
simple, but it requires an understanding of binary arithmetic and
logic: A route matches a destination if the network
address logically ANDed with the netmask precisely equals the
destination address logically ANDed with the
netmask. </P
><P
>Translation: a route matches if the
number of bits of the network address specified by the netmask
(starting from the left-most bit, the high order bit of byte one of
the address) match that same number of bits in the destination
address.</P
><P
>When the IP implementation is searching for the best route to a
destination, it may find a number of routing entries that match the
target address. For example, we know that the default route matches
every destination, but datagrams destined for locally attached
networks will match their local route, too. How does IP know which
route to use? It is here that the netmask plays an important
role. While both routes match the destination, one of the routes has a
larger netmask than the other. We previously mentioned that the
netmask was used to break up our address space into smaller
networks. The larger a netmask is, the more specifically a target
address is matched; when routing datagrams, we should always choose
the route that has the largest netmask. The default route has a
netmask of zero bits, and in the configuration presented above, the
locally attached networks have a 24-bit netmask. If a datagram matches
a locally attached network, it will be routed to the appropriate device
in preference to following the default route because the local network
route matches with a greater number of bits. The only datagrams that
will be routed via the default route are those that don't match any
other route.</P
><P
>&#13;


You can build routing tables by a variety of means. For small LANs, it
is usually most efficient to construct them by hand and feed them to
IP using the <B
CLASS="COMMAND"
>route</B
> command at boot time (see <A
HREF="#X-087-2-IFACE"
>Chapter 5</A
>). For larger networks, they are built and
adjusted at runtime by <EM
>routing daemons</EM
>; these
daemons run on central hosts of the network and exchange routing
information to compute &#8220;optimal&#8221; routes between the member
networks.</P
><P
>&#13;




Depending on the size of the network, you'll need to use different
routing protocols. For routing inside autonomous systems (such as the
Groucho Marx campus), the <EM
>internal routing
protocols</EM
> are used. The most prominent one of these is the
<EM
>Routing Information Protocol</EM
> (RIP), which is
implemented by the BSD <B
CLASS="COMMAND"
>routed</B
> daemon. For routing
between autonomous systems, <EM
>external routing
protocols</EM
> like <EM
>External Gateway
Protocol</EM
> (EGP) or <EM
>Border Gateway
Protocol</EM
> (BGP) have to be used; these protocols, including
RIP, have been implemented in the University of Cornell's
<B
CLASS="COMMAND"
>gated</B
> daemon.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-ISSUES.ROUTING.METRIC"
>2.4.5. Metric Values</A
></H3
><P
>We depend on dynamic routing to choose the best route to a destination
host or network based on the number of <EM
>hops</EM
>. Hops
are the gateways a datagram has to pass before reaching a host or
network. The shorter a route is, the better RIP rates it. Very long
routes with 16 or more hops are regarded as unusable and are
discarded.</P
><P
>RIP manages routing information internal to your local network, but
you have to run <B
CLASS="COMMAND"
>gated</B
> on all hosts. At boot time,
<B
CLASS="COMMAND"
>gated</B
> checks for all active network interfaces.  If
there is more than one active interface (not counting the loopback
interface), it assumes the host is switching packets between several
networks and will actively exchange and broadcast routing
information. Otherwise, it will only passively receive RIP updates and
update the local routing table.</P
><P
>When broadcasting information from the local routing table,
<B
CLASS="COMMAND"
>gated</B
> computes the length of the route from the
so-called <EM
>metric value</EM
> associated with the
routing table entry. This metric value is set by the system
administrator when configuring the route, and should reflect the
actual route cost.<A
NAME="X-087-2-FNIS05"
HREF="#FTN.X-087-2-FNIS05"
><SPAN
CLASS="footnote"
>[16]</SPAN
></A
> Therefore, the metric of a route to a subnet that the host
is directly connected to should always be zero, while a route going
through two gateways should have a metric of two. You don't have to bother
with metrics if you don't use <B
CLASS="COMMAND"
>RIP</B
> or
<B
CLASS="COMMAND"
>gated</B
>.&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-ISSUES.ICMP"
>2.5. The Internet Control Message Protocol</A
></H2
><P
>&#13;
IP has a companion protocol that we haven't talked about yet. This is
the <EM
>Internet Control Message Protocol</EM
> (ICMP),
used by the kernel networking code to communicate error messages to
other hosts. For instance, assume that you are on <SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
> again and want to
<B
CLASS="COMMAND"
>telnet</B
> to port 12345 on <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>, but there's no process listening
on that port. When the first TCP packet for this port arrives on
<SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
>, the networking layer
will recognize this arrival and immediately return an ICMP message to
<SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
> stating &#8220;Port
Unreachable.&#8221;</P
><P
>&#13;


The ICMP protocol provides several different messages, many of which
deal with error conditions. However, there is one very interesting
message called the Redirect message. It is generated by the routing
module when it detects that another host is using it as a gateway,
even though a much shorter route exists. For example, after booting, the
routing table of <SPAN
CLASS="SYSTEMITEM"
>sophus</SPAN
> may be
incomplete. It might contain the routes to the Mathematics network, to the
FDDI backbone, and the default route pointing at the Groucho Computing
Center's gateway (&#8201;gcc1). Thus, packets for <SPAN
CLASS="SYSTEMITEM"
>quark</SPAN
> would be sent
to <SPAN
CLASS="SYSTEMITEM"
>gcc1</SPAN
> rather than to
<SPAN
CLASS="SYSTEMITEM"
>niels</SPAN
>, the gateway to the Physics
department. When receiving such a datagram,
<SPAN
CLASS="SYSTEMITEM"
>gcc1</SPAN
> will notice that this is a poor
choice of route and will forward the packet to
<SPAN
CLASS="SYSTEMITEM"
>niels</SPAN
>, meanwhile returning an
ICMP Redirect message to <SPAN
CLASS="SYSTEMITEM"
>sophus</SPAN
> telling it of the superior route.</P
><P
>This seems to be a very clever way to avoid manually setting up any
but the most basic routes. However, be warned that relying on dynamic
routing schemes, be it RIP or ICMP Redirect messages, is not always a
good idea. ICMP Redirect and RIP offer you little or no choice in
verifying that some routing information is indeed authentic. This
situation allows malicious good-for-nothings to disrupt your entire
network traffic, or even worse. Consequently, the Linux networking
code treats Network Redirect messages as if they were Host Redirects.
This minimizes the damage of an attack by restricting it to just one
host, rather than the whole network. On the flip side, it means that a
little more traffic is generated in the event of a legitimate
condition, as each host causes the generation of an ICMP Redirect
message. It is generally considered bad practice to rely on ICMP
redirects for anything these days.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-ISSUES.RESOLVING"
>2.6. Resolving Host Names</A
></H2
><P
>As described previously, addressing in TCP/IP networking, at least for
IP Version 4, revolves around 32-bit numbers. However, you will have a
hard time remembering more than a few of these numbers. Therefore,
hosts are generally known by &#8220;ordinary&#8221; names such as
<SPAN
CLASS="SYSTEMITEM"
>gauss</SPAN
> or <SPAN
CLASS="SYSTEMITEM"
>strange</SPAN
>. It becomes the application's
duty to find the IP address corresponding to this name.  This process
is called <EM
>hostname resolution</EM
>.</P
><P
>When an application needs to find the IP address of a given host, it
relies on the library functions <CODE
CLASS="FUNCTION"
>gethostbyname(3)</CODE
>
and <CODE
CLASS="FUNCTION"
>gethostbyaddr(3)</CODE
>. Traditionally, these and a
number of related procedures were grouped in a separate library called
the <EM
>resolverlibrary</EM
>&#8201;; on Linux, these functions
are part of the standard <TT
CLASS="FILENAME"
>libc</TT
>. Colloquially, this
collection of functions is therefore referred to as &#8220;the
resolver.&#8221; Resolver name configuration is detailed in <A
HREF="#X-087-2-RESOLV"
>Chapter 6</A
>.</P
><P
>On a small network like an Ethernet or even a cluster of Ethernets, it
is not very difficult to maintain tables mapping hostnames to
addresses. This information is usually kept in a file named
<TT
CLASS="FILENAME"
>/etc/hosts</TT
>. When adding or removing hosts, or
reassigning addresses, all you have to do is update the
<TT
CLASS="FILENAME"
>hosts</TT
> file on all hosts. Obviously, this will
become burdensome with networks that comprise more than a handful of
machines.</P
><P
>One solution to this problem is the <EM
>Network Information
System</EM
> (NIS), developed by Sun Microsystems, colloquially 
called YP or Yellow Pages. NIS stores the <TT
CLASS="FILENAME"
>hosts</TT
>
file (and other information) in a database on a master host from which clients
may retrieve it as needed. Still, this approach is suitable only for
medium-sized networks such as LANs, because it involves maintaining
the entire <TT
CLASS="FILENAME"
>hosts</TT
> database centrally and distributing
it to all servers. NIS installation and configuration is discussed in
detail in <A
HREF="#X-087-2-NIS"
>Chapter 13</A
>.</P
><P
>On the Internet, address information was initially stored in a single
<TT
CLASS="FILENAME"
>HOSTS.TXT</TT
> database, too. This file was maintained at
the <EM
>Network Information Center</EM
> (NIC), and had to 
be downloaded and installed by all participating sites. When the network 
grew, several problems with this scheme arose. Besides the administrative 
overhead involved in installing <TT
CLASS="FILENAME"
>HOSTS.TXT</TT
> regularly, 
the load on the servers that distributed it became too high. Even more 
severe, all names had to be registered with the NIC, which made sure that 
no name was issued twice.</P
><P
>This is why a new name resolution scheme was adopted in 1994: the
<EM
>Domain Name System</EM
>. DNS was designed by Paul
Mockapetris and addresses both problems simultaneously. We discuss the
Domain Name System in detail in <A
HREF="#X-087-2-RESOLV"
>Chapter 6</A
>.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-HARDWARE"
></A
>Chapter 3. Configuringthe NetworkingHardware</H1
><P
>We've been talking quite a bit about network interfaces and general
TCP/IP issues, but we haven't really covered what happens when the
&#8220;networking code&#8221; in the kernel accesses a piece of
hardware.  In order to describe this accurately, we have to talk a
little about the concept of interfaces and drivers.</P
><P
>First, of course, there's the hardware itself, for example an
Ethernet, FDDI or Token Ring card: this is a slice of Epoxy cluttered
with lots of tiny chips with strange numbers on them, sitting in a
slot of your PC. This is what we generally call a physical device.</P
><P
>&#13; For you to
use a network card, special functions have to be present in your Linux
kernel that understand the particular way this device is accessed. The
software that implements these functions is called a <EM
>device
driver</EM
>. Linux has device drivers for many different types
of network interface cards: ISA, PCI, MCA, EISA, Parallel port, PCMCIA,
and more recently, USB.</P
><P
>But what do we mean when we say a driver &#8220;handles&#8221; a device? Let's
consider an Ethernet card. The driver has to be able to communicate with the
peripheral's on-card logic somehow: it has to send commands and data to the
card, while the card should deliver any data received to the driver.</P
><P
>In IBM-style personal computers, this communication takes place through a
cluster of I/O addresses that are mapped to registers on the card and/or
through shared or direct memory transfers. All commands and data the kernel
sends to the card have to go to these addresses. I/O and memory addresses are
generally described by providing the starting or
<EM
>base address</EM
>. Typical base addresses for ISA bus Ethernet
cards are <TT
CLASS="LITERAL"
>0x280</TT
> or <TT
CLASS="LITERAL"
>0x300</TT
>. PCI bus
network cards generally have their I/O address automatically assigned.</P
><P
>Usually you don't have to worry about any hardware issues such as the
base address because the kernel makes an attempt at boot time to
detect a card's location. This is called <EM
>auto
probing</EM
>, which means that the kernel reads several memory
or I/O locations and compares the data it reads there with what it
would expect to see if a certain network card were installed at that
location. However, there may be network cards it cannot detect
automatically; this is sometimes the case with cheap network cards
that are not-quite clones of standard cards from other
manufacturers. Also, the kernel will normally attempt to detect only
one network device when booting. If you're using more than one card,
you have to tell the kernel about the other cards explicitly.</P
><P
>&#13;Another parameter that you might have to tell the kernel about is the
interrupt request line. Hardware components usually interrupt the
kernel when they need to be taken care of&#8212;for example, when data
has arrived or a special condition occurs. In an ISA bus PC,
interrupts may occur on one of 15 interrupt channels numbered 0, 1,
and 3 through 15. The interrupt number assigned to a hardware
component is called its <EM
>interrupt request
number</EM
> (IRQ).<A
NAME="X-087-2-FNHW01"
HREF="#FTN.X-087-2-FNHW01"
><SPAN
CLASS="footnote"
>[17]</SPAN
></A
>&#13;</P
><P
>&#13;
As described in <A
HREF="#X-087-2-ISSUES"
>Chapter 2</A
>, the kernel accesses a piece
of network hardware through a software construct called an 
<EM
>interface</EM
>.
Interfaces offer an abstract set of functions that are the same across all
types of hardware, such as sending or receiving a datagram.</P
><P
>&#13; Interfaces are identified by means of
names. In many other Unix-like operating systems, the network
interface is implemented as a special device file in the
<TT
CLASS="FILENAME"
>/dev/</TT
> directory. If you type the <TT
CLASS="LITERAL"
>ls -las
/dev/</TT
> command, you will see what these device files look
like. In the file permissions (second) column you will see that device
files begin with a letter rather than the hyphen seen for normal
files. This character indicates the device type. The most common
device types are <TT
CLASS="LITERAL"
>b</TT
>, which indicates the device is a
<EM
>block</EM
> device and handles whole blocks of data
with each read and write, and <TT
CLASS="LITERAL"
>c</TT
>, which indicates
the device is a <EM
>character</EM
> device and handles data
one character at a time. Where you would normally see the file length
in the <B
CLASS="COMMAND"
>ls</B
> output, you instead see two numbers,
called the major and minor device numbers. These numbers indicate the
actual device with which the device file is associated.</P
><P
>Each device driver registers a unique major number with the kernel.
Each <EM
>instance</EM
> of that device registers a unique
minor number for that major device. The <TT
CLASS="LITERAL"
>tty</TT
>
interfaces,&#8201;<TT
CLASS="FILENAME"
>/dev/tty*</TT
>, are a character
mode device indicated by the &#8220;<TT
CLASS="LITERAL"
>c</TT
>&#8221;, and
each have a major number of <TT
CLASS="LITERAL"
>4</TT
>, but
<TT
CLASS="FILENAME"
>/dev/tty1</TT
> has a minor number of
<TT
CLASS="LITERAL"
>1</TT
>, and <TT
CLASS="FILENAME"
>/dev/tty2</TT
> has a minor
number of <TT
CLASS="LITERAL"
>2</TT
>. Device files are very useful for
many types of devices, but can be clumsy to use when trying to find an
unused device to open.</P
><P
>Linux interface names are defined internally in the kernel and are not
device files in the <TT
CLASS="FILENAME"
>/dev</TT
> directory. Some typical
device names are listed later in <A
HREF="#X-087-2-HWCONFIG.TOUR"
>Section 3.2</A
>.&#8221; The assignment of interfaces to
devices usually depends on the order in which devices are
configured. For instance, the first Ethernet card installed will
become <TT
CLASS="FILENAME"
>eth0</TT
>, and the next will be
<TT
CLASS="FILENAME"
>eth1</TT
>. SLIP interfaces are handled differently
from others because they are assigned dynamically. Whenever a SLIP
connection is established, an interface is assigned to the serial
port.</P
><P
><A
HREF="#X-087-2-HARDWARE.FIG.DRIVERS"
>Figure 3-1</A
> illustrates the relationship
between the hardware, device drivers, and interfaces.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-HARDWARE.FIG.DRIVERS"
></A
><P
><B
>Figure 3-1. The relationship between drivers, interfaces, and hardware</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_0301.jpg"></P
></DIV
></DIV
><P
>When booting, the kernel displays the devices it detects and the
interfaces it installs. The following is an excerpt from typical
boot messages:
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
> .
 .  This processor honors the WP bit even when in supervisor mode./ 
    Good. 
Swansea University Computer Society NET3.035 for Linux 2.0 
NET3: Unix domain sockets 0.13 for Linux NET3.035.
Swansea University Computer Society TCP/IP for NET3.034 
IP Protocols: IGMP,ICMP, UDP, TCP 
Swansea University Computer Society IPX 0.34 for NET3.035 
IPX Portions Copyright (c) 1995 Caldera, Inc.
Serial driver version 4.13 with no serial options enabled 
tty00 at 0x03f8 (irq = 4) is a 16550A
tty01 at 0x02f8 (irq = 3) is a 16550A
CSLIP: code copyright 1989 Regents of the University of California 
PPP: Version 2.2.0 (dynamic channel allocation) 
PPP Dynamic channel allocation code copyright 1995 Caldera, Inc. 
PPP line discipline registered.  
eth0: 3c509 at 0x300 tag 1, 10baseT port, address 00 a0 24 0e e4 e0,/ 
    IRQ 10.
3c509.c:1.12 6/4/97 becker@cesdis.gsfc.nasa.gov 
Linux Version 2.0.32 (root@perf) (gcc Version 2.7.2.1) 
#1 Tue Oct 21 15:30:44 EST 1997
 .
 .</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This example shows that the kernel has been compiled with TCP/IP
enabled, and it includes drivers for SLIP, CSLIP, and PPP. The third
line from the bottom says that a 3C509 Ethernet card was detected and
installed as interface <TT
CLASS="FILENAME"
>eth0</TT
>. If you have some
other type of network card&#8212;perhaps a D-Link pocket adaptor, for
example&#8212;the kernel will usually print a line starting with its
device name&#8212;<TT
CLASS="FILENAME"
>dl0</TT
> in the D-Link
example&#8212;followed by the type of card detected. If you have a
network card installed but don't see any similar message, the kernel
is unable to detect your card properly. This situation will be
discussed later in the section &#8220;Ethernet Autoprobing.&#8221;</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-HARDWARE.KERNEL.CONFIG"
>3.1. Kernel Configuration</A
></H2
><P
>Most Linux distributions are supplied with boot disks that work for
all common types of PC hardware. Generally, the supplied kernel is
highly modularized and includes nearly every possible driver. This is
a great idea for boot disks, but is probably not what you'd want for
long-term use. There isn't much point in having drivers cluttering up
your disk that you will never use. Therefore, you will generally roll
your own kernel and include only those drivers you actually need or
want; that way you save a little disk space and reduce the time it
takes to compile a new kernel.</P
><P
>In any case, when running a Linux system, you should be familiar with 
building a kernel. Think of it as a right of passage, an affirmation of 
the one thing that makes free software as powerful as it is&#8212;you have 
the source. It isn't a case of, &#8220;I have to compile a kernel,&#8221; 
rather it's a case of, &#8220;I <EM
>can</EM
> compile a 
kernel.&#8221; The basics of compiling a Linux kernel are explained in Matt 
Welsh's book, <EM
>Running Linux</EM
> (O'Reilly). Therefore, we 
will discuss only configuration options that affect networking in this 
section.</P
><P
>&#13; One important point that does bear
repeating here is the way the kernel version numbering scheme
works. Linux kernels are numbered in the following format:
<TT
CLASS="LITERAL"
>2.2.14</TT
>. The first digit indicates the
<EM
>major</EM
> version number. This digit changes when
there are large and significant changes to the kernel design. For
example, the kernel changed from major 1 to 2 when the kernel obtained
support for machines other than Intel machines. The second number is
the <EM
>minor</EM
> version number. In many respects, this
number is the most important number to look at. The Linux development
community has adopted a standard at which <EM
>even</EM
> minor
version numbers indicate <EM
>production</EM
>, or
<EM
>stable</EM
>, kernels and <EM
>odd</EM
>
minor version numbers indicate <EM
>development</EM
>, or
<EM
>unstable</EM
>, kernels. The stable kernels are what
you should use on a machine that is important to you, as they have
been more thoroughly tested. The development kernels are what you
should use if you are interested in experimenting with the newest
features of Linux, but they may have problems that haven't yet been
found and fixed. The third number is simply incremented for each
release of a minor version.<A
NAME="X-087-2-FNHW02"
HREF="#FTN.X-087-2-FNHW02"
><SPAN
CLASS="footnote"
>[18]</SPAN
></A
></P
><P
>When running <B
CLASS="COMMAND"
>make menuconfig</B
>, you are presented with
a text-based menu that offers lists of configuration questions, such as
whether you want kernel math emulation. One of these queries asks you
whether you want TCP/IP networking support. You must answer this with
<TT
CLASS="LITERAL"
>y</TT
> to get a kernel capable of networking.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN2147"
>3.1.1. Kernel Options in Linux 2.0 and Higher</A
></H3
><P
>&#13;After the general option section is complete, the configuration will
go on to ask whether you want to include support for various features,
such as SCSI drivers or sound cards. The prompt will indicate what
options are available. You can press <SAMP
CLASS="PROMPT"
>?</SAMP
> to obtain a
description of what the option is actually offering. You'll always
have the option of yes (<SAMP
CLASS="PROMPT"
>y</SAMP
>) to statically include the
component in the kernel, or no (<SAMP
CLASS="PROMPT"
>n</SAMP
>) to exclude the
component completely. You'll also see the module (<SAMP
CLASS="PROMPT"
>m</SAMP
>)
option for those components that may be compiled as a run-time
loadable module. Modules need to be loaded before they can be used,
and are useful for drivers of components that you use infrequently.</P
><P
>The subsequent list of questions deal with networking support. 
The exact set of configuration options is in constant flux due to ongoing 
development. A typical list of options offered by most kernel versions 
around 2.0 and 2.1 looks like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>*
* Network device support
*
Network device support (CONFIG_NETDEVICES) [Y/n/?] </PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>You must answer this question with <TT
CLASS="LITERAL"
>y</TT
> if you want to 
use <EM
>any</EM
> type of networking devices, whether 
they are Ethernet, SLIP, PPP, or whatever. When you answer the 
question with <TT
CLASS="LITERAL"
>y</TT
>, support for Ethernet-type devices 
is enabled automatically. You must answer additional questions if 
you want to enable support for other types of network drivers:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>PLIP (parallel port) support (CONFIG_PLIP) [N/y/m/?] y
PPP (point-to-point) support (CONFIG_PPP) [N/y/m/?] y
*
* CCP compressors for PPP are only built as modules.
*
SLIP (serial line) support (CONFIG_SLIP) [N/y/m/?] m
 CSLIP compressed headers (CONFIG_SLIP_COMPRESSED) [N/y/?] (NEW) y
 Keepalive and linefill (CONFIG_SLIP_SMART) [N/y/?] (NEW) y
 Six bit SLIP encapsulation (CONFIG_SLIP_MODE_SLIP6) [N/y/?] (NEW) y</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;
These questions concern the various link layer protocols that Linux
supports.  Both PPP and SLIP allow you to transport IP datagrams
across serial lines.  PPP is actually a suite of protocols used to
send network traffic across serial lines. Some of the protocols that
form PPP manage the way that you authenticate yourself to the dial-in
server, while others manage the way certain protocols are carried
across the link&#8212;PPP is not limited to carrying TCP/IP datagrams;
it may also carry other protocol such as IPX.</P
><P
>If you answer <TT
CLASS="LITERAL"
>y</TT
> or <TT
CLASS="LITERAL"
>m</TT
> to SLIP 
support, you will be prompted to answer the three questions that appear 
below it. The compressed header option provides support for CSLIP, a 
technique that compresses TCP/IP headers to as little as three bytes. Note 
that this kernel option does not turn on CSLIP automatically; it merely 
provides the necessary kernel functions for it. The <TT
CLASS="LITERAL"
>Keepalive and 
linefill</TT
> option causes the SLIP support to periodically generate 
activity on the SLIP line to avoid it being dropped by an inactivity timer. The
<TT
CLASS="LITERAL"
>Six bit SLIP encapsulation</TT
> option allows you to run
SLIP over lines and circuits that are not capable of transmitting the
whole 8-bit data set cleanly. This is similar to the uuencoding or binhex 
technique used to send binary files by electronic mail.</P
><P
>PLIP provides a way to send IP datagrams across a parallel port connection.
It is mostly used to communicate with PCs running DOS. On typical PC hardware,
PLIP can be faster than PPP or SLIP, but it requires much more CPU overhead to
perform, so while the transfer rate might be good, other tasks on the machine
may be slow. </P
><P
>The following questions address network cards from various vendors.
As more drivers are being developed, you are likely to see questions added
to this section.  If you want to build a kernel you can use on a number of
different machines, or if your machine has more than one type of network
card installed, you can enable more than one driver:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
> .
 .
Ethernet (10 or 100Mbit) (CONFIG_NET_ETHERNET) [Y/n/?] 
3COM cards (CONFIG_NET_VENDOR_3COM) [Y/n/?] 
3c501 support (CONFIG_EL1) [N/y/m/?]
3c503 support (CONFIG_EL2) [N/y/m/?]
3c509/3c579 support (CONFIG_EL3) [Y/m/n/?]
3c590/3c900 series (592/595/597/900/905) "Vortex/Boomerang" support/
    (CONFIG_VORTEX) [N/y/m/?]
AMD LANCE and PCnet (AT1500 and NE2100) support (CONFIG_LANCE) [N/y/?]
AMD PCInet32 (VLB and PCI) support (CONFIG_LANCE32) [N/y/?] (NEW)
Western Digital/SMC cards (CONFIG_NET_VENDOR_SMC) [N/y/?]
WD80*3 support (CONFIG_WD80x3) [N/y/m/?] (NEW)
SMC Ultra support (CONFIG_ULTRA) [N/y/m/?] (NEW)
SMC Ultra32 support (CONFIG_ULTRA32) [N/y/m/?] (NEW)
SMC 9194 support (CONFIG_SMC9194) [N/y/m/?] (NEW)
Other ISA cards (CONFIG_NET_ISA) [N/y/?]
Cabletron E21xx support (CONFIG_E2100) [N/y/m/?] (NEW)
DEPCA, DE10x, DE200, DE201, DE202, DE422 support (CONFIG_DEPCA) [N/y/m/?]/ 
    (NEW)
EtherWORKS 3 (DE203, DE204, DE205) support (CONFIG_EWRK3) [N/y/m/?] (NEW)
EtherExpress 16 support (CONFIG_EEXPRESS) [N/y/m/?] (NEW)
HP PCLAN+ (27247B and 27252A) support (CONFIG_HPLAN_PLUS) [N/y/m/?] (NEW)
HP PCLAN (27245 and other 27xxx series) support (CONFIG_HPLAN) [N/y/m/?]/ 
    (NEW)
HP 10/100VG PCLAN (ISA, EISA, PCI) support (CONFIG_HP100) [N/y/m/?] (NEW)
NE2000/NE1000 support (CONFIG_NE2000) [N/y/m/?] (NEW)
SK_G16 support (CONFIG_SK_G16) [N/y/?] (NEW)
EISA, VLB, PCI and on card controllers (CONFIG_NET_EISA) [N/y/?]
Apricot Xen-II on card ethernet (CONFIG_APRICOT) [N/y/m/?] (NEW)
Intel EtherExpress/Pro 100B support (CONFIG_EEXPRESS_PRO100B) [N/y/m/?]/ 
    (NEW)
DE425, DE434, DE435, DE450, DE500 support (CONFIG_DE4X5) [N/y/m/?] (NEW)
DECchip Tulip (dc21x4x) PCI support (CONFIG_DEC_ELCP) [N/y/m/?] (NEW)
Digi Intl. RightSwitch SE-X support (CONFIG_DGRS) [N/y/m/?] (NEW)
Pocket and portable adaptors (CONFIG_NET_POCKET) [N/y/?]
AT-LAN-TEC/RealTek pocket adaptor support (CONFIG_ATP) [N/y/?] (NEW)
D-Link DE600 pocket adaptor support (CONFIG_DE600) [N/y/m/?] (NEW)
D-Link DE620 pocket adaptor support (CONFIG_DE620) [N/y/m/?] (NEW)
Token Ring driver support (CONFIG_TR) [N/y/?]
IBM Tropic chipset based adaptor support (CONFIG_IBMTR) [N/y/m/?] (NEW)
FDDI driver support (CONFIG_FDDI) [N/y/?]
Digital DEFEA and DEFPA adapter support (CONFIG_DEFXX) [N/y/?] (NEW)
ARCnet support (CONFIG_ARCNET) [N/y/m/?]
  Enable arc0e (ARCnet "Ether-Encap" packet format) (CONFIG_ARCNET_ETH)/ 
      [N/y/?] (NEW)
  Enable arc0s (ARCnet RFC1051 packet format) (CONFIG_ARCNET_1051)/ 
      [N/y/?] (NEW)
 .
 .</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;Finally, in the file system section, the configuration script will ask you
whether you want support for NFS, the networking file system. NFS lets you
export file systems to several hosts, which makes the files appear as if they
were on an ordinary hard disk attached to the host:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>NFS file system support (CONFIG_NFS_FS) [y]</PRE
></FONT
></TD
></TR
></TABLE
>

We describe NFS in detail in <A
HREF="#X-087-2-NFS"
>Chapter 14</A
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN2203"
>3.1.2. Kernel Networking Options in Linux 2.0.0 and Higher</A
></H3
><P
>&#13;
Linux 2.0.0 marked a significant change in Linux Networking. Many 
features were made a standard part of the Kernel, such as support
for IPX.  A number of options were also added and made
configurable. Many of these options are used only in very special
circumstances and we won't cover them in detail. The Networking HOWTO
probably addresses what is not covered here. We'll list a number of
useful options in this section, and explain when you'd want to use
each one:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Basics</DT
><DD
><P
> To use TCP/IP networking, you must answer this question with
<TT
CLASS="LITERAL"
>y</TT
>. If you answer with <TT
CLASS="LITERAL"
>n</TT
>, however, you
will still be able to compile the kernel with IPX support:</P
></DD
></DL
></DIV
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Networking options  ---&#62;
    [*] TCP/IP networking</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Gateways</DT
><DD
><P
>&#13; You
have to enable this option if your system acts as a gateway between
two networks or between a LAN and a SLIP link, etc.  It
doesn't hurt to enable this by default, but you may want to disable it to
configure a host as a so-called
<EM
>firewall</EM
>. Firewalls are hosts that are connected
to two or more networks, but don't route traffic between them.  They're 
commonly used to provide users with Internet access at minimal
risk to the internal network. Users are allowed to log in to the
firewall and use Internet services, but the company's machines are
protected from outside attacks because incoming connections can't
cross the firewall (firewalls are covered in detail in
<A
HREF="#X-087-2-FIREWALL"
>Chapter 9</A
>&#8201;):</P
></DD
></DL
></DIV
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>    [*] IP: forwarding/gatewaying</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Virtual hosting</DT
><DD
><P
>&#13;
 These options together allow to you
configure more than one IP address onto an interface. This is
sometimes useful if you want to do &#8220;virtual hosting,&#8221;
through which a single machine can be configured to look and act as
though it were actually many separate machines, each with its own
network personality. We'll talk more about IP aliasing in a moment:</P
></DD
></DL
></DIV
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>    [*] Network aliasing
	&#60;*&#62; IP: aliasing support</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Accounting</DT
><DD
><P
>&#13;This option enables you to collect data on the volume of IP traffic leaving
and arriving at your machine (we cover this is detail in
<A
HREF="#X-087-2-ACCOUNTING"
>Chapter 10</A
>&#8201;):</P
></DD
></DL
></DIV
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>    [*] IP: accounting</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>PC hug</DT
><DD
><P
>&#13;This option works around an incompatibility with some versions of PC/TCP, a
commercial TCP/IP implementation for DOS-based PCs. If you enable this option,
you will still be able to communicate with normal Unix machines, but
performance may be hurt over slow links:</P
></DD
></DL
></DIV
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>    --- (it is safe to leave these untouched)
    [*] IP: PC/TCP compatibility mode</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Diskless booting</DT
><DD
><P
>&#13;This function enables <EM
>Reverse Address Resolution
Protocol</EM
> (RARP). RARP is used by diskless clients and X terminals to
request their IP address when booting. You should enable RARP if you plan to
serve this sort of client. A small program called <B
CLASS="COMMAND"
>rarp</B
>,
included with the standard networking utilities, is used to add entries
to the kernel RARP table:</P
></DD
></DL
></DIV
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>    &#60;*&#62; IP: Reverse ARP</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>MTU</DT
><DD
><P
>&#13;



When sending data over TCP, the kernel has to break up the stream into blocks
of data to pass to IP. The size of the block is called the <EM
>Maximum 
Transmission Unit</EM
>, or MTU. For hosts that can be reached over a 
local network such as an
Ethernet, it is typical to use an MTU as large as the maximum length of an
Ethernet packet&#8212;1,500 bytes. When routing IP over a Wide Area Network 
like the Internet, it is preferable to use smaller-sized datagrams to ensure 
that they don't need to be further broken down along the route through a 
process called <EM
>IP fragmentation</EM
>.<A
NAME="X-087-2-FNHW03"
HREF="#FTN.X-087-2-FNHW03"
><SPAN
CLASS="footnote"
>[19]</SPAN
></A
> The kernel is
able to automatically determine the smallest MTU of an IP route and to
automatically configure a TCP connection to use it. This behavior is on by
default. If you answer <TT
CLASS="LITERAL"
>y</TT
> to this option this feature 
will be disabled.</P
><P
>If you do want to use smaller packet sizes for data sent to specific hosts
(because, for example, the data goes through a SLIP link), you can do so using
the <B
CLASS="COMMAND"
>mss</B
> option of the <B
CLASS="COMMAND"
>route</B
> command,
which is briefly discussed at the end of this chapter:</P
></DD
></DL
></DIV
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>    [ ] IP: Disable Path MTU Discovery (normally enabled)</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Security feature</DT
><DD
><P
>&#13;





The IP protocol supports a feature called <EM
>Source
Routing</EM
>.  Source routing allows you to specify the route a
datagram should follow by coding the route into the datagram
itself. This was once probably useful before routing protocols such as
RIP and OSPF became commonplace. But today it's considered a security
threat because it can provide clever attackers with a way of
circumventing certain types of firewall protection by bypassing the
routing table of a router. You would normally want to filter out
source routed datagrams, so this option is normally enabled:</P
></DD
></DL
></DIV
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>    [*] IP: Drop source routed frames</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Novell support</DT
><DD
><P
>&#13;

This option enables support for IPX, the transport protocol Novell
Networking uses.  Linux will function quite happily as an IPX router
and this support is useful in environments where you have Novell
fileservers. The NCP filesystem also requires IPX support enabled in
your kernel; if you wish to attach to and mount your Novell
filesystems you must have this option enabled (we'll dicuss IPX and
the NCP filesystem in <A
HREF="#X-087-2-IPX"
>Chapter 15</A
>):</P
></DD
></DL
></DIV
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>    &#60;*&#62; The IPX protocol</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Amateur radio</DT
><DD
><P
>&#13;







These three options select support for the three Amateur Radio protocols
supported by Linux: AX.25, NetRom and Rose (we don't describe them in this
book, but they are covered in detail in the AX25 HOWTO):

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>    &#60;*&#62; Amateur Radio AX.25 Level 2
    &#60;*&#62; Amateur Radio NET/ROM
    &#60;*&#62; Amateur Radio X.25 PLP (Rose)</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
> Linux supports another driver type: the dummy driver. The following
question appears toward the start of the device-driver section:
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>    &#60;*&#62; Dummy net driver support</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The dummy driver doesn't really do much, but it is quite useful on standalone
or PPP/SLIP hosts.  It is basically a masqueraded loopback interface. On 
hosts that offer PPP/SLIP but have no
other network interface, you want to have an interface that bears your IP
address all the time. This is discussed in a little more detail in 
<A
HREF="#X-087-2-IFACE.INTERFACE.DUMMY"
>Section 5.7.7</A
>" in
<A
HREF="#X-087-2-IFACE"
>Chapter 5</A
>. Note that today you can achieve the same
result by using the IP alias feature and configuring your IP address as an
alias on the loopback interface.
 </P
></DD
></DL
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-HWCONFIG.TOUR"
>3.2. A Tour of Linux Network Devices</A
></H2
><P
>The Linux kernel supports a number of hardware drivers for various
types of equipment. This section gives a short overview of the driver
families available and the interface names they use.</P
><P
> There is a number
of standard names for interfaces in Linux, which are listed here. Most
drivers support more than one interface, in which case the interfaces
are numbered, as in <TT
CLASS="FILENAME"
>eth0</TT
> and
<TT
CLASS="FILENAME"
>eth1</TT
>:</P
><P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="FILENAME"
>lo</TT
></DT
><DD
><P
>&#13; 
This is the local loopback interface. It is used for testing purposes, as 
well as a couple of network applications. It works like a closed circuit in 
that any datagram written to it will immediately be returned to the host's
networking layer.  There's always one loopback device present in the kernel,
and there's little sense in having more.</P
></DD
><DT
><TT
CLASS="FILENAME"
>eth0</TT
>, <TT
CLASS="FILENAME"
>eth1</TT
>, &#8230;</DT
><DD
><P
> 

These are the Ethernet card interfaces. They are used for most Ethernet cards,
including many of the parallel port Ethernet cards.</P
></DD
><DT
><TT
CLASS="FILENAME"
>tr0</TT
>, <TT
CLASS="FILENAME"
>tr1</TT
>, &#8230;</DT
><DD
><P
> 

These are the Token Ring card interfaces. They are used for most Token Ring 
cards, including non-IBM manufactured cards.</P
></DD
><DT
><TT
CLASS="FILENAME"
>sl0</TT
>, <TT
CLASS="FILENAME"
>sl1</TT
>, &#8230;</DT
><DD
><P
> 

These are the SLIP interfaces. SLIP interfaces are associated with serial 
lines in the order in which they are allocated for SLIP.</P
></DD
><DT
><TT
CLASS="FILENAME"
>ppp0</TT
>, <TT
CLASS="FILENAME"
>ppp1</TT
>, &#8230;</DT
><DD
><P
> 

These are the PPP interfaces. Just like SLIP interfaces, a PPP interface is 
associated with a serial line once it is converted to PPP mode.</P
></DD
><DT
><TT
CLASS="FILENAME"
>plip0</TT
>,
<TT
CLASS="FILENAME"
>plip1</TT
>, &#8230;</DT
><DD
><P
>&#13;
These are the PLIP interfaces. PLIP transports IP datagrams over
parallel lines. The interfaces are allocated by the PLIP driver at
system boot time and are mapped onto parallel ports. In the
<EM
>2.0.x</EM
> kernels there is a direct relationship
between the device name and the I/O port of the parallel port, but in
later kernels the device names are allocated sequentially, just as for
SLIP and PPP devices.</P
></DD
><DT
><TT
CLASS="FILENAME"
>ax0</TT
>,
<TT
CLASS="FILENAME"
>ax1</TT
>, &#8230;</DT
><DD
><P
>&#13;

These are the AX.25 interfaces. AX.25 is the primary protocol used by
amateur radio operators. AX.25 interfaces are allocated and mapped in
a similar fashion to SLIP devices.</P
></DD
></DL
></DIV
></P
><P
>There are many other types of interfaces available for other network
drivers. We've listed only the most common ones.</P
><P
>During the next few sections, we will discuss the details of using
the drivers described previously. The Networking HOWTO provides details on 
how to configure most of the others, and the AX25 HOWTO explains how to 
configure the Amateur Radio network devices.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-HARDWARE.DRIVERS.ETHERNET"
>3.3. Ethernet Installation</A
></H2
><P
>The current Linux network code supports a large variety of Ethernet
cards.  Most drivers were written by Donald Becker, who authored a
family of drivers for cards based on the National Semiconductor 8390
chip; these have become known as the Becker Series Drivers. Many other
developers have contributed drivers, and today there are few common
Ethernet cards that aren't supported by Linux. The list of supported
Ethernet cards is growing all the time, so if your card isn't
supported yet, chances are it will be soon.</P
><P
>Sometime earlier in Linux's history we would have attempted to list
all supported Ethernet cards, but that would now take too much time
and space.  Fortunately, Paul Gortmaker maintains the Ethernet HOWTO,
which lists each of the supported cards and provides useful
information about getting each of them running under Linux.<A
NAME="X-087-2-FNHW04"
HREF="#FTN.X-087-2-FNHW04"
><SPAN
CLASS="footnote"
>[20]</SPAN
></A
> It is posted monthly to the <SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.answers</SPAN
> newsgroup, and is
also available on any of the Linux Documentation Project mirror sites.&#13;</P
><P
>Even if you are confident you know how to install a particular type of
Ethernet card in your machine, it is often worthwhile taking a look at
what the Ethernet HOWTO has to say about it. You will find information
that extends beyond simple configuration issues. For example, it could 
save you a lot of headaches to know the
behavior of some DMA-based Ethernet cards that use the same DMA
channel as the Adaptec 1542 SCSI controller by default. Unless you move
one of them to a different DMA channel, you will wind up with the 
Ethernet card writing packet data to arbitrary locations on your hard
disk.</P
><P
>To use any of the supported Ethernet cards with Linux, you may use a
precompiled kernel from one of the major Linux distributions. These generally
have modules available for all of the supported drivers, and the installation
process usually allows you to select which drivers you want loaded. In the
long term, however, it's better to build your own kernel and compile only
those drivers you actually need; this saves disk space and memory.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN2526"
>3.3.1. Ethernet Autoprobing</A
></H3
><P
>Many of the Linux Ethernet drivers are smart enough to know how to
search for the location of your Ethernet card. This saves you having
to tell the kernel where it is manually. The Ethernet HOWTO lists
whether a particular driver uses autoprobing and in which order it
searches the I/O address for the card.</P
><P
>There are three limitations to the autoprobing code. First, it may not
recognize all cards properly. This is especially true for some of the cheaper
clones of common cards. Second, the kernel won't
autoprobe for more than one card unless specifically instructed. This was
a conscious design decision, as it is assumed you will want to have control
over which card is assigned to which interface. The best way to do this
reliably is to manually configure the Ethernet cards in your machine. Third,
the driver may not probe at the address that your card is configured for.
Generally speaking, the drivers will autoprobe at the addresses that the
particular device is capable of being configured for, but sometimes certain
addresses are ignored to avoid hardware conflicts with other types of cards
that commonly use that same address.</P
><P
>PCI network cards should be reliably detected. But if you are using more 
than one card, or if the autoprobe should fail to detect your card, you 
have a way to explicitly tell the kernel about the card's base address and 
name.</P
><P
>&#13;


At boot time you can supply arguments and information to the kernel that any 
of the kernel components may read. This mechanism allows you
to pass information to the kernel that Ethernet drivers can use to locate your
Ethernet hardware without making the driver probe.</P
><P
>If you use lilo to boot your system, you can pass parameters
to the kernel by specifying them through the
<SPAN
CLASS="SYSTEMITEM"
>append</SPAN
> option in the
<TT
CLASS="FILENAME"
>lilo.conf</TT
> file. To inform the kernel about an
Ethernet device, you can pass the following parameters:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ether=<TT
CLASS="REPLACEABLE"
><I
>irq</I
></TT
>,<TT
CLASS="REPLACEABLE"
><I
>base_addr</I
></TT
>,[<TT
CLASS="REPLACEABLE"
><I
>param1</I
></TT
>,][<TT
CLASS="REPLACEABLE"
><I
>param2</I
></TT
>,]<TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The first four parameters are numeric, while the last is the device
name. The <TT
CLASS="REPLACEABLE"
><I
>irq</I
></TT
>,
<TT
CLASS="REPLACEABLE"
><I
>base_addr</I
></TT
>, and
<TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
> parameters are required, but the two
<TT
CLASS="REPLACEABLE"
><I
>param</I
></TT
> parameters are optional. Any of the
numeric values may be set to zero, which causes the kernel to
determine the value by probing.</P
><P
>&#13;
The first parameter sets the IRQ assigned to the device. By default, the
kernel will try to autodetect the device's IRQ channel. The 3c503 driver,
for example, has a special feature that selects a free IRQ from the list
5, 9, 3, 4 and configures the card to use this line.
The <TT
CLASS="REPLACEABLE"
><I
>base_addr</I
></TT
> parameter gives the I/O base address
of the card; a value of zero tells the kernel to probe the addresses listed
above.</P
><P
>Different drivers use the next two parameters differently. For shared-memory cards, such as the WD80x3, they specify starting and ending
addresses of the shared memory area. Other cards commonly use
<TT
CLASS="REPLACEABLE"
><I
>param1</I
></TT
> to set the level at which debugging 
information is displayed. Values of 1 through 7 denote increasing levels of
verbosity, while 8 turns them off altogether; 0 denotes the default.
The 3c503 driver uses <TT
CLASS="REPLACEABLE"
><I
>param2</I
></TT
> to choose between the
internal transceiver (default) or an external transceiver (a value of 1).
The former uses the card's BNC connector; the latter uses its AUI port.
The <TT
CLASS="REPLACEABLE"
><I
>param</I
></TT
> arguments need not be included at all
if you don't have anything special to configure.</P
><P
>The first non-numeric argument is interpreted by the kernel as the
device name. You must specify a device name for each Ethernet card you
describe.</P
><P
>If you have two Ethernet cards, you can have Linux autodetect one card
and pass the second card's parameters with <B
CLASS="COMMAND"
>lilo</B
>,
but you'll probably want to manually configure both cards. If you
decide to have the kernel probe for one and manually configure the
second, you must make sure the kernel doesn't accidentally find the
second card first, or else the other one won't be registered at
all. You do this by passing <B
CLASS="COMMAND"
>lilo</B
> a <SPAN
CLASS="SYSTEMITEM"
>reserve</SPAN
> option, which explicitly tells the
kernel to avoid probing the I/O space taken up by the second card. For
instance, to make Linux install a second Ethernet card at
<TT
CLASS="LITERAL"
>0x300</TT
> as <TT
CLASS="FILENAME"
>eth1</TT
>, you would pass
the following parameters to the kernel:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>reserve=0x300,32 ether=0,0x300,eth1</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <EM
>reserve</EM
> option makes sure no driver
accesses the second card's I/O space when probing for some device. You may 
also use the kernel parameters to override autoprobing for 
<TT
CLASS="FILENAME"
>eth0</TT
>&#8201;:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>reserve=0x340,32 ether=0,0x340,eth0</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>You can turn off autoprobing altogether. You might do this, for example, to
stop a kernel probing for an Ethernet card you might have temporarily removed.
Disabling autoprobing is as simple as specifying a
<TT
CLASS="REPLACEABLE"
><I
>base_addr</I
></TT
> argument of &#8211;1:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ether=0,-1,eth0</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>To supply these parameters to the kernel at boot time, you enter the
parameters at the lilo "boot:" prompt. To have <B
CLASS="COMMAND"
>lilo</B
>
give you the "<SAMP
CLASS="PROMPT"
>boot:</SAMP
>" at the prompt, you must press
any one of the Control, Alt or Shift keys while
<B
CLASS="COMMAND"
>lilo</B
> is booting. If you press the Tab key at the
prompt, you will be presented with a list of kernels that you may
boot. To boot a kernel with parameters supplied, enter the name of the
kernel you wish to boot, followed by a space, then followed by the
parameters you wish to supply. When you press the Enter key,
<B
CLASS="COMMAND"
>lilo</B
> will load that kernel and boot it with the
parameters you've supplied.</P
><P
>To make this change occur automatically on each reboot, enter the parameters
into the <TT
CLASS="FILENAME"
>/etc/lilo.conf</TT
> using the
<TT
CLASS="LITERAL"
>append=</TT
> keyword. An example might look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>boot=/dev/hda
root=/dev/hda2
install=/boot/boot.b
map=/boot/map
vga=normal
delay=20
append="ether=10,300,eth0"

image=/boot/vmlinuz-2.2.14
label=2.2.14
read-only</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>After you've edited <TT
CLASS="FILENAME"
>lilo.conf</TT
>, you must rerun
the <B
CLASS="COMMAND"
>lilo</B
> command to activate the change.</P
><P
>&#13;
 </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-HARDWARE.DRIVERS.PLIP"
>3.4. The PLIP Driver</A
></H2
><P
><EM
>Parallel Line IP</EM
> (PLIP) is a cheap way to
network when you want to connect only two machines. It uses a parallel port
and a special cable, achieving speeds of 10 kilobytes per second to 20 kilobytes per second.</P
><P
>PLIP was originally developed by Crynwr, Inc. Its design at the time was
rather ingenious (or, if you prefer, a
hack), because the original parallel ports on
IBM PCs were designed to spend their time being unidirectional printer ports;
the eight data lines could be used only to send data from the PC to the
peripheral device, but not the other way around.<A
NAME="X-087-2-FNHW05"
HREF="#FTN.X-087-2-FNHW05"
><SPAN
CLASS="footnote"
>[21]</SPAN
></A
> The Cyrnwr
PLIP design worked around this limitation by using the port's five
status lines for input, which limited it to transferring all data as
nibbles (half bytes) only, but allowed for bidirectional
transfer. This mode of operation was called PLIP &#8220;mode 0.&#8221;
Today, the parallel ports supplied on PC hardware cater to full
bidirectional 8-bit data transfer, and PLIP has been extended to
accomodate this with the addition of PLIP &#8220;mode 1.&#8221;</P
><P
> 
Linux kernels up to and including Version 2.0 support PLIP mode 0 only,
and an enhanced parallel port driver exists as a
patch against the 2.0 kernel and as a 
standard part of the 2.2 kernel code to provide PLIP mode 1 operation, too.
<A
NAME="X-087-2-FNHW06"
HREF="#FTN.X-087-2-FNHW06"
><SPAN
CLASS="footnote"
>[22]</SPAN
></A
>
Unlike earlier versions of the PLIP code, the driver now attempts to be
compatible with the PLIP implementations from Crynwr, as well as the PLIP
driver in NCSA <B
CLASS="COMMAND"
>telnet</B
>.<A
NAME="X-087-2-FNHW07"
HREF="#FTN.X-087-2-FNHW07"
><SPAN
CLASS="footnote"
>[23]</SPAN
></A
>
To connect two machines using PLIP, you need a special cable sold at some
shops as a Null Printer or Turbo Laplink cable.
You can, however, make one yourself fairly easily;
<A
HREF="#X-087-2-APPENDIX.CABLES"
>Appendix B</A
> shows you how.</P
><P
>&#13;The PLIP driver for Linux is the work of almost countless persons. It is
currently maintained by Niibe Yutaka.<A
NAME="X-087-2-FNHW08"
HREF="#FTN.X-087-2-FNHW08"
><SPAN
CLASS="footnote"
>[24]</SPAN
></A
>
If compiled into the kernel, it sets up a network interface for each of the
possible printer ports, with <TT
CLASS="FILENAME"
>plip0</TT
> corresponding to
parallel port <TT
CLASS="FILENAME"
>lp0</TT
>, <TT
CLASS="FILENAME"
>plip1</TT
>
corresponding to <TT
CLASS="FILENAME"
>lp1</TT
>, etc. The mapping of interfaces to
ports differs in the 2.0 kernels and the 2.2
kernels. In the 2.0 kernels, the mapping was hardwired in the
<TT
CLASS="FILENAME"
>drivers/net/Spacd.c</TT
> file in the kernel
source. The default mappings in this file are:</P
><DIV
CLASS="INFORMALTABLE"
><P
></P
><A
NAME="AEN2653"
></A
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Interface</TH
><TH
>I/O Port</TH
><TH
>IRQ</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="FILENAME"
>plip0</TT
></TD
><TD
><TT
CLASS="LITERAL"
>0x3BC</TT
></TD
><TD
>7</TD
></TR
><TR
><TD
><TT
CLASS="FILENAME"
>plip1</TT
></TD
><TD
><TT
CLASS="LITERAL"
>0x378</TT
></TD
><TD
>7</TD
></TR
><TR
><TD
><TT
CLASS="FILENAME"
>plip2</TT
></TD
><TD
><TT
CLASS="LITERAL"
>0x278</TT
></TD
><TD
>5</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
>&#13;If you configured your printer port in a different way, you
must change these values in <TT
CLASS="FILENAME"
>drivers/net/Space.c</TT
> in
the Linux kernel source and build a new kernel.</P
><P
>In the 2.2 kernels, the PLIP driver uses the &#8220;parport&#8221; parallel port
sharing driver developed by Philip Blundell.<A
NAME="X-087-2-FNHW09"
HREF="#FTN.X-087-2-FNHW09"
><SPAN
CLASS="footnote"
>[25]</SPAN
></A
> The new driver allocates the PLIP network device names serially,
just as for the Ethernet or PPP drivers, so the first PLIP device created is
<TT
CLASS="FILENAME"
>plip0</TT
>, the second is <TT
CLASS="FILENAME"
>plip1</TT
>, and so on.
The physical parallel port hardware is also allocated serially. By default, the
parallel port driver will attempt to detect your parallel port hardware with an
autoprobe routine, recording the physical device information in the order found. It is better practice to explicitly tell the kernel the physical I/O
parameters. You can do this by supplying arguments to the
<TT
CLASS="FILENAME"
>parport_pc.o</TT
> module as you load it, or if you have
compiled the driver into your kernel, using lilo to supply
arguments to the kernel at boot time. The IRQ setting of any device may be
changed later by writing the new IRQ value to the related
<TT
CLASS="FILENAME"
>/proc/parport/*/irq</TT
> file.</P
><P
>Configuring the physical I/O parameters in a 2.2 kernel when loading the
module is straightforward. For instance, to tell the driver that you have
two PC-style parallel ports at I/O addresses <TT
CLASS="LITERAL"
>0x278</TT
> and
<TT
CLASS="LITERAL"
>0c378</TT
> and IRQs 5 and 7, respectively, you would load the
module with the following arguments:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>modprobe parport_&#8201;pc io=0x278,0x378 irq=5,7</PRE
></FONT
></TD
></TR
></TABLE
>

The corresponding arguments to pass to the kernel for a compiled-in driver are:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>parport=0x278,5 parport=0x378,7</PRE
></FONT
></TD
></TR
></TABLE
>

You would use the lilo <SPAN
CLASS="SYSTEMITEM"
>append</SPAN
> 
keyword to have these arguments
passed to the kernel automatically at boot time.</P
><P
>When the PLIP driver is initialized, either at boot time if it is
built-in, or when the <TT
CLASS="FILENAME"
>plip.o</TT
> module is loaded,
each of the parallel ports will have a <TT
CLASS="FILENAME"
>plip</TT
>
network device associated with it. <TT
CLASS="FILENAME"
>plip0</TT
> will be
assigned to the first parallel port device, <TT
CLASS="FILENAME"
>plip1</TT
>
the second, and so on.  You can manually override this automatic
assignment using another set of kernel arguments. For instance, to
assign <TT
CLASS="LITERAL"
>parport0</TT
> to network device
<TT
CLASS="LITERAL"
>plip0</TT
>, and <TT
CLASS="LITERAL"
>parport1</TT
> to network
device <TT
CLASS="LITERAL"
>plip1</TT
>, you would use kernel arguments of:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>plip=parport1 plip=parport0</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>This mapping does not mean, however, that you cannot use these parallel ports
for printing or other purposes. The physical parallel port devices are used
by the PLIP driver only when the corresponding interface is configured
<SPAN
CLASS="SYSTEMITEM"
>up</SPAN
>.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-HARDWARE.DRIVERS.SLIP"
>3.5. The PPP and SLIP Drivers</A
></H2
><P
>Point-to-Point Protocol (PPP) and Serial Line IP (SLIP) are widely used
protocols for carrying IP packets over a serial link. A number of institutions
offer dialup PPP and SLIP access to machines that are on the Internet, thus
providing IP connectivity to private persons (something that's otherwise
hardly affordable).</P
><P
>No hardware modifications are necessary to run PPP or SLIP; you can use
any serial port. Since serial port configuration is not specific to
TCP/IP networking, we have devoted a separate chapter to this.  Please
refer to <A
HREF="#X-087-2-SERIAL"
>Chapter 4</A
>, for more information. We cover
PPP in detail in <A
HREF="#X-087-2-PPP"
>Chapter 8</A
>, and SLIP in
<A
HREF="#X-087-2-SLIP"
>Chapter 7</A
>.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-HARDWARE.OTHER"
>3.6. Other Network Types</A
></H2
><P
>&#13;





Most other network types are configured similarly to Ethernet. The arguments 
passed to the loadable modules will be different
and some drivers may not support more than one card, but just about everything
else is the same. Documentation for these cards is generally available in the
<TT
CLASS="FILENAME"
>/usr/src/linux&#8201;/Documentation/networking/</TT
> directory of
the Linux kernel source.</P
><P
>&#13;
 </P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-SERIAL"
></A
>Chapter 4. Configuring the Serial Hardware</H1
><P
>The Internet is growing at an incredible rate. Much of this growth is
attributed to Internet users who can't afford high-speed permanent
network connections and who use protocols such as SLIP, PPP, or UUCP
to dial in to a network provider to retrieve their daily dose of email
and news.</P
><P
>&#13;
This chapter is intended to help all people who rely on modems
to maintain their link to the outside world. We won't cover the
mechanics of how to configure your modem (the manual that came with it
will tell you more about it than we can), but we will cover most of
the Linux-specific aspects of managing devices that use serial
ports. Topics include serial communications software, creating the
serial device files, serial hardware, and configuring serial devices
using the <B
CLASS="COMMAND"
>setserial</B
> and <B
CLASS="COMMAND"
>stty</B
>
commands. Many other related topics are covered in the Serial HOWTO
by David Lawyer.<A
NAME="X-087-2-FNSE1"
HREF="#FTN.X-087-2-FNSE1"
><SPAN
CLASS="footnote"
>[26]</SPAN
></A
>&#13;</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-SERIAL.SOFTWARE"
>4.1. Communications Software
for Modem Links</A
></H2
><P
>There are a number of communications packages available for
Linux. Many of these packages are <EM
>terminal
programs</EM
>, which allow a user to dial in to another computer
as if she were sitting in front of a simple terminal. The traditional
terminal program for Unix-like environments is
<B
CLASS="COMMAND"
>kermit</B
>. It is, however, fairly ancient now, and
would probably be considered difficult to use. There are more
comfortable programs available that support features, like
telephone-dialing dictionaries, script languages to automate dialing
and logging in to remote computer systems, and a variety of file
exchange protocols. One of these programs is <B
CLASS="COMMAND"
>minicom</B
>,
which was modeled after some of the most popular DOS terminal
programs. X11 users are accommodated, too. <B
CLASS="COMMAND"
>seyon</B
> is
a fully featured X11-based communications program.</P
><P
>Terminal programs aren't the only type of serial communication
programs available. Other programs let you connect to a host and
download news and email in a single bundle, to read and reply later at
your leisure. This can save a lot of time, and is especially useful if
you are unfortunate enough to live in an area where your local calls
are time-charged. All of the reading and replying time can be spent
offline, and when you are ready, you can redial and upload your
responses in a single bundle. This all consumes a bit more hard disk
because all of the messages have to be stored to your disk before you
can read them, but this could be a reasonable trade-off at today's
hard drive prices.</P
><P
>&#13; UUCP epitomizes this
communication software style. It is a program suite that copies files
from one host to another and executes programs on a remote host. It is
frequently used to transport mail or news in private networks. Ian
Taylor's UUCP package, which also runs under Linux, is described in
detail in <A
HREF="#X-087-2-UUCP"
>Chapter 16</A
>. Other noninteractive
communications software is used throughout networks such as
Fidonet. Fidonet application ports like <B
CLASS="COMMAND"
>ifmail</B
> are
also available, although we expect that not many people still use
them.</P
><P
> 


PPP and SLIP are in between, allowing both interactive and
noninteractive use. Many people use PPP or SLIP to dial in to their
campus network or other Internet Service Provider to run FTP and read
web pages. PPP and SLIP are also, however, commonly used over
permanent or semipermanent connections for LAN-to-LAN coupling,
although this is really only interesting with ISDN or other high-speed
network connections.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-SERIAL.TTYS"
>4.2. Introduction to Serial Devices</A
></H2
><P
>The Unix kernel provides devices for accessing serial hardware,
typically called <EM
>tty</EM
> devices (pronounced as it is
spelled: T-T-Y). This is an abbreviation for <EM
>Teletype
device</EM
>, which used to be one of the major manufacturers of
terminal devices in the early days of Unix. The term is used now for
any character-based data terminal. Throughout this chapter, we use the
term to refer exclusively to the Linux device files rather than the
physical terminal.</P
><P
>Linux provides three classes of tty devices: serial devices, virtual
terminals (all of which you can access in turn by pressing Alt-F1
through Alt-F<EM
>nn</EM
> on the local console), and
pseudo-terminals (similar to a two-way pipe, used by applications such
as X11). The former were called tty devices because the original
character-based terminals were connected to the Unix machine by a
serial cable or telephone line and modem. The latter two were
named after the tty device because they were created to behave in a
similar fashion from the programmer's perspective.</P
><P
>&#13; SLIP and PPP are most commonly
implemented in the kernel. The kernel doesn't really treat the
<EM
>tty</EM
> device as a network device that you can
manipulate like an Ethernet device, using commands such as
<B
CLASS="COMMAND"
>ifconfig</B
>. However, it does treat tty devices as
places where network devices can be bound. To do this, the kernel
changes what is called the &#8220;line discipline&#8221; of the tty
device. Both SLIP and PPP are line disciplines that may be enabled on
tty devices. The general idea is that the serial driver handles data
given to it differently, depending on the line discipline it is
configured for. In its default line discipline, the driver simply
transmits each character it is given in turn. When the SLIP or PPP
line discipline is selected, the driver instead reads a block of data,
wraps a special header around it that allows the remote end to
identify that block of data in a stream, and transmits the new data
block. It isn't too important to understand this yet; we'll cover both
SLIP and PPP in later chapters, and it all happens automatically for
you anyway.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-SERIAL.DEVICES"
>4.3. Accessing Serial Devices</A
></H2
><P
>Like all devices in a Unix system, serial ports are accessed through
device special files, located in the <TT
CLASS="FILENAME"
>/dev</TT
>
directory.  There are two varieties of device files related to serial
drivers, and there is one device file of each type for each port. The
device will behave slightly differently, depending on which of its
device files we open.  We'll cover the differences because it will help you
understand some of the configurations and advice that you might see
relating to serial devices, but in practice you need to use only
one of these. At some point in the future, one of them may even
disappear completely.</P
><P
>&#13;
 



The most important of the two classes of serial device has a major
number of 4, and its device special files are named
<TT
CLASS="FILENAME"
>ttyS0</TT
>, <TT
CLASS="FILENAME"
>ttyS1</TT
>, etc. The
second variety has a major number of 5, and was designed for use when
dialing out (calling out) through a port; its device special files are
called <TT
CLASS="FILENAME"
>cua0</TT
>, <TT
CLASS="FILENAME"
>cua1</TT
>, etc. In
the Unix world, counting generally starts at zero, while laypeople
tend to start at one. This creates a small amount of confusion for
people because <TT
CLASS="LITERAL"
>COM1:</TT
> is represented by
<TT
CLASS="FILENAME"
>/dev/ttyS0</TT
>, <TT
CLASS="LITERAL"
>COM2:</TT
> by
<TT
CLASS="FILENAME"
>/dev/ttyS1</TT
>, etc. Anyone familiar with IBM PC-style
hardware knows that <TT
CLASS="LITERAL"
>COM3:</TT
> and greater were never
really standardized anyway.</P
><P
>The <EM
>cua</EM
>, or &#8220;callout,&#8221; devices were
created to solve the problem of avoiding conflicts on serial devices
for modems that have to support both incoming and outgoing
connections.  Unfortunately, they've created their own problems and
are now likely to be discontinued. Let's briefly look at the problem.</P
><P
>Linux, like Unix, allows a device, or any other file, to be opened by
more than one process simultaneously. Unfortunately, this is rarely
useful with tty devices, as the two processes will almost certainly
interfere with each other. Luckily, a mechanism was devised to allow a
process to check if a tty device had already been opened by another
device before opening it. The mechanism uses what are called
<EM
>lock files</EM
>. The idea was that when a process
wanted to open a tty device, it would check for the existence of a
file in a special location, named similarly to the device it intends
to open. If the file does not exist, the process creates it and opens
the tty device. If the file does exist, the process assumes another
process already has the tty device open and takes appropriate
action. One last clever trick to make the lock file management system
work was writing the process ID (pid) of the process that had created
the lock file into the lock file itself; we'll talk more about that in
a moment.</P
><P
>The lock file mechanism works perfectly well in circumstances in which
you have a defined location for the lock files and all programs know
where to find them. Alas, this wasn't always the case for Linux. It
wasn't until the Linux Filesystem Standard defined a standard location
for lock files when <TT
CLASS="FILENAME"
>tty</TT
> lock files began to work
correctly. At one time there were at least four, and possibly more
locations chosen by software developers to store lock files:
<TT
CLASS="FILENAME"
>/usr/spool/locks/</TT
>,
<TT
CLASS="FILENAME"
>/var/spool/locks/</TT
>,
<TT
CLASS="FILENAME"
>/var/lock/</TT
>, and
<TT
CLASS="FILENAME"
>/usr/lock/</TT
>. Confusion caused chaos. Programs were
opening lock files in different locations that were meant to control a
single tty device; it was as if lock files weren't being used at all.</P
><P
>The <TT
CLASS="FILENAME"
>cua</TT
> devices were created to provide a
solution to this problem. Rather than relying on the use of lock files
to prevent clashes between programs wanting to use the serial devices,
it was decided that the kernel could provide a simple means of
arbitrating who should be given access. If the
<TT
CLASS="FILENAME"
>ttyS</TT
> device were already opened, an attempt to
open the <TT
CLASS="FILENAME"
>cua</TT
> would result in an error that a
program could interpret to mean the device was already being used. If
the <TT
CLASS="FILENAME"
>cua</TT
> device were already open and an attempt
was made to open the <TT
CLASS="FILENAME"
>ttyS</TT
>, the request would
block; that is, it would be put on hold and wait until the
<TT
CLASS="FILENAME"
>cua</TT
> device was closed by the other process. This
worked quite well if you had a single modem that you had configured
for dial-in access and you occasionally wanted to dial out on the same
device. But it did not work very well in environments where you had
multiple programs wanting to call out on the same device. The only way
to solve the contention problem was to use lock files! Back to square
one.</P
><P
>Suffice it to say that the Linux Filesystem Standard came to the
rescue and now mandates that lock files be stored in the
<TT
CLASS="FILENAME"
>/var/lock</TT
> directory, and that by convention, the
lock file name for the <TT
CLASS="FILENAME"
>ttyS1</TT
> device, for
instance, is <TT
CLASS="FILENAME"
>LCK..ttyS1</TT
>. The
<TT
CLASS="FILENAME"
>cua</TT
> lock files should also go in this directory,
but use of <TT
CLASS="FILENAME"
>cua</TT
> devices is now discouraged.</P
><P
>The <TT
CLASS="FILENAME"
>cua</TT
> devices will probably still be around for
some time to provide a period of backward compatibility, but in time
they will be retired. If you are wondering what to use, stick to the
<TT
CLASS="FILENAME"
>ttyS</TT
> device and make sure that your system is
Linux FSSTND compliant, or at the very least that all programs using
the serial devices agree on where the lock files are located. Most
software dealing with serial tty devices provides a compile-time
option to specify the location of the lock files. More often than not,
this will appear as a variable called something like
<TT
CLASS="LITERAL"
>LOCKDIR</TT
> in the <TT
CLASS="FILENAME"
>Makefile</TT
> or in
a configuration header file. If you're compiling the software
yourself, it is best to change this to agree with the FSSTND-specified
location. If you're using a precompiled binary and you're not sure
where the program will write its lock files, you can use the following
command to gain a hint:
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>strings</B
> <TT
CLASS="FILENAME"
>binaryfile</TT
> | <B
CLASS="COMMAND"
>grep</B
> lock</PRE
></FONT
></TD
></TR
></TABLE
>
If the location found does not agree with the rest of your system, you
can try creating a symbolic link from the lock directory that the
foreign executable wants to use back to
<TT
CLASS="FILENAME"
>/var/lock/</TT
>. This is ugly, but it will work.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-SERIAL.DEVICEFILES"
>4.3.1. The Serial Device Special Files</A
></H3
><P
>&#13;
Minor numbers are identical for both types of serial devices. If you
have your modem on one of the ports COM1: through COM4:, its minor
number will be the COM port number plus 63.  If you are using special
serial hardware, such as a high-performance multiple port serial
controller, you will probably need to create special device files for
it; it probably won't use the standard device driver. The Serial-HOWTO
should be able to assist you in finding the appropriate details.</P
><P
>Assume your modem is on COM2:. Its minor number will be 65, and its
major number will be 4 for normal use. There should be a device called
<TT
CLASS="FILENAME"
>ttyS1</TT
> that has these numbers. List the serial
ttys in the <TT
CLASS="FILENAME"
>/dev/</TT
> directory. The fifth and sixth
columns show the major and minor numbers, respectively:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>ls -l /dev/ttyS*</KBD
>
0 crw-rw----   1 uucp     dialout    4,  64 Oct 13  1997 /dev/ttyS0
0 crw-rw----   1 uucp     dialout    4,  65 Jan 26 21:55 /dev/ttyS1
0 crw-rw----   1 uucp     dialout    4,  66 Oct 13  1997 /dev/ttyS2
0 crw-rw----   1 uucp     dialout    4,  67 Oct 13  1997 /dev/ttyS3</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>If there is no device with major number 4 and minor number 65, you
will have to create one. Become the superuser and type:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>mknod -m 666 /dev/ttyS1 c 4 65</KBD
>
# <KBD
CLASS="USERINPUT"
>chown uucp.dialout /dev/ttyS1</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>
The various Linux distributions use slightly differing strategies for
who should own the serial devices. Sometimes they will be owned by
<EM
>root</EM
>, and other times they will be owned by
another user, such as <KBD
CLASS="USERINPUT"
>uucp</KBD
> in our example.
Modern distributions have a group specifically for dial-out devices,
and any users who are allowed to use them are added to this group.</P
><P
>&#13;Some people suggest making <TT
CLASS="FILENAME"
>/dev/modem</TT
> a symbolic
link to your modem device so that casual users don't have to remember
the somewhat unintuitive <TT
CLASS="FILENAME"
>ttyS1</TT
>. However, you
cannot use <TT
CLASS="FILENAME"
>modem</TT
> in one program and the real
device file name in another. Their lock files would have different
names and the locking mechanism wouldn't work.</P
><P
>&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-SERIAL.HARDWARE"
>4.4. Serial Hardware</A
></H2
><P
>RS-232 is currently the most common standard for serial communications
in the PC world. It uses a number of circuits for transmitting single
bits, as well as for synchronization. Additional lines may be used for
signaling the presence of a carrier (used by modems) and for
handshaking. Linux supports a wide variety of serial cards that use
the RS-232 standard.</P
><P
> 

 Hardware handshake is optional, but very
useful. It allows either of the two stations to signal whether it is
ready to receive more data, or if the other station should pause until
the receiver is done processing the incoming data.  The lines used for
this are called &#8220;Clear to Send&#8221; (CTS) and &#8220;Ready to
Send&#8221; (RTS), respectively, which explains the colloquial name
for hardware handshake: &#8220;RTS/CTS.&#8221; The other type of
handshake you might be familiar with is called &#8220;XON/XOFF&#8221;
handshaking. XON/XOFF uses two nominated characters, conventionally
Ctrl-S and Ctrl-Q, to signal to the remote end that it should stop and
start transmitting data, respectively. While this method is simple to
implement and okay for use by dumb terminals, it causes great
confusion when you are dealing with binary data, as you may want to
transmit those characters as part of your data stream, and not have
them interpreted as flow control characters. It is also somewhat
slower to take effect than hardware handshake. Hardware handshake is
clean, fast, and recommended in preference to XON/XOFF when you have a
choice.</P
><P
>&#13;


In the original IBM PC, the RS-232 interface was driven by a UART chip
called the 8250. PCs around the time of the 486 used a newer version
of the UART called the 16450. It was slightly faster than the
8250. Nearly all Pentium-based machines have been supplied with an
even newer version of the UART called the 16550. Some brands (most
notably internal modems equipped with the Rockwell chip set) use
completely different chips that emulate the behavior of the 16550 and
can be treated similarly. Linux supports all of these in its standard
serial port driver.<A
NAME="X-087-2-SERIAL-FIXME"
HREF="#FTN.X-087-2-SERIAL-FIXME"
><SPAN
CLASS="footnote"
>[27]</SPAN
></A
>&#13;</P
><P
>The 16550 was a significant improvement over the 8250 and the 16450
because it offered a 16-byte FIFO buffer. The 16550 is actually a
family of UART devices, comprising the 16550, the 16550A, and the
16550AFN (later renamed PC16550DN). The differences relate to whether
the FIFO actually works; the 16550AFN is the one that is sure to
work. There was also an NS16550, but its FIFO never really worked
either.</P
><P
>The 8250 and 16450 UARTs had a simple 1-byte buffer. This means that a
16450 generates an interrupt for every character transmitted or
received. Each interrupt takes a short period of time to service, and
this small delay limits 16450s to a reliable maximum bit speed of
about 9,600 bps in a typical ISA bus machine.</P
><P
>In the default configuration, the kernel checks the four standard
serial ports, COM1: through COM4:. The kernel is also able to
automatically detect what UART is used for each of the standard serial
ports, and will make use of the enhanced FIFO buffer of the 16550, if
it is available.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-SERIAL-CONFIGURATION"
>4.5. Using the Configuration Utilities</A
></H2
><P
></P
><P
>Now let's spend some time looking at the two most useful serial device
configuration utilities: <B
CLASS="COMMAND"
>setserial</B
> and
<B
CLASS="COMMAND"
>stty</B
>.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-SERIAL-SETSERIAL"
>4.5.1. The setserial Command</A
></H3
><P
>The kernel will make its best effort to correctly determine how your
serial hardware is configured, but the variations on serial device
configuration makes this determination difficult to achieve 100
percent reliably in practice. A good example of where this is a
problem is the internal modems we talked about earlier. The UART they
use has a 16-byte FIFO buffer, but it looks like a 16450 UART to the
kernel device driver: unless we specifically tell the driver that this
port is a 16550 device, the kernel will not make use of the extended
buffer. Yet another example is that of the dumb 4-port cards that
allow sharing of a single IRQ among a number of serial devices. We may
have to specifically tell the kernel which IRQ port it's supposed to
use, and that IRQs may be shared.</P
><P
><B
CLASS="COMMAND"
>setserial</B
> was created to configure the serial driver
at runtime. The <B
CLASS="COMMAND"
>setserial</B
> command is most commonly
executed at boot time from a script called <TT
CLASS="FILENAME"
>0setserial</TT
>
on some distributions, and <TT
CLASS="FILENAME"
>rc.serial</TT
> on others. This
script is charged with the responsibility of initializing the serial driver
to accommodate any nonstandard or unusual serial hardware in the machine.</P
><P
>The general syntax for the <B
CLASS="COMMAND"
>setserial</B
> command is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>setserial <TT
CLASS="REPLACEABLE"
><I
>device</I
></TT
> [<TT
CLASS="REPLACEABLE"
><I
>parameters</I
></TT
>]</PRE
></FONT
></TD
></TR
></TABLE
>
in which the device is one of the serial devices, such as
<EM
>ttyS0</EM
>.</P
><P
>The <B
CLASS="COMMAND"
>setserial</B
> command has a large number of
parameters.  The most common of these are described in <A
HREF="#X-087-2-SERIAL-SETSERIAL-PARAMETERS"
>Table 4-1</A
>. For information on the
remainder of the parameters, you should refer to the
<B
CLASS="COMMAND"
>setserial</B
> manual page.</P
><DIV
CLASS="TABLE"
><A
NAME="X-087-2-SERIAL-SETSERIAL-PARAMETERS"
></A
><P
><B
>Table 4-1. setserial Command-Line Parameters</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL
WIDTH="4"><THEAD
><TR
><TH
>Parameter</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="LITERAL"
>port</TT
> <TT
CLASS="REPLACEABLE"
><I
>port_number</I
></TT
></TD
><TD
><P
>	Specify the I/O port address of the serial device. Port numbers
	should be specified in hexadecimal notation, e.g., <TT
CLASS="LITERAL"
>0x2f8</TT
>.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>irq</TT
> <TT
CLASS="REPLACEABLE"
><I
>num</I
></TT
></TD
><TD
><P
>	Specify the interrupt request line the serial device is
	using.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>uart</TT
> <TT
CLASS="REPLACEABLE"
><I
>uart_type</I
></TT
></TD
><TD
><P
>	Specify the UART type of the serial device. Common values are
	<TT
CLASS="LITERAL"
>16450</TT
>, <TT
CLASS="LITERAL"
>16550</TT
>, etc. Setting this
	value to <TT
CLASS="LITERAL"
>none</TT
> will disable this serial device.</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>fourport</TT
></TD
><TD
><P
>	Specifying this parameter instructs the kernel serial driver that
	this port is one port of an AST Fourport card.</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>spd_hi</TT
></TD
><TD
><P
>	Program the UART to use a speed of 57.6 kbps when a process
	requests 38.4 kbps.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>spd_vhi</TT
></TD
><TD
><P
>	Program the UART to use a speed of 115 kbps when a process
	requests 38.4 kbps.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>spd_normal</TT
></TD
><TD
><P
>	Program the UART to use the default speed of 38.4 kbps when
	requested. This parameter is used to reverse the effect of a
	<TT
CLASS="LITERAL"
>spd_hi</TT
> or <TT
CLASS="LITERAL"
>spd_vhi</TT
> performed on
	the specified serial device.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>auto_irq</TT
></TD
><TD
><P
>	This parameter will cause the kernel to attempt to automatically
	determine the IRQ of the specified device. This attempt may not be 
        completely reliable, so it is probably better to think of this as a 
        request for the kernel to guess the IRQ. If you know the IRQ of the 
        device, you should specify that it use the <TT
CLASS="LITERAL"
>irq</TT
> 
        parameter instead.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>autoconfig</TT
></TD
><TD
><P
>	This parameter must be specified in conjunction with the
	<TT
CLASS="LITERAL"
>port</TT
> parameter. When this parameter is supplied,
	<B
CLASS="COMMAND"
>setserial</B
> instructs the kernel to attempt to
	automatically determine the UART type located at the supplied port
	address. If the <TT
CLASS="LITERAL"
>auto_irq</TT
> parameter is also 
        supplied, the kernel attempts to automatically determine the IRQ,
	too.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>skip_test</TT
></TD
><TD
><P
>	This parameter instructs the kernel not to bother performing
	the UART type test during auto-configuration. This is necessary when
	the UART is incorrectly detected by the kernel.</P
></TD
></TR
></TBODY
></TABLE
></DIV
><P
>A typical and simple <TT
CLASS="FILENAME"
>rc</TT
> file to configure your serial
ports at boot time might look something like that shown in
<A
HREF="#X-087-2-SERIAL-RC.SERIAL.SETSERIAL"
>Example 4-1</A
>. Most Linux distributions
will include something slightly more sophisticated than this one.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-SERIAL-RC.SERIAL.SETSERIAL"
></A
><P
><B
>Example 4-1. Example rc.serial setserial Commands</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/rc.serial - serial line configuration script.
#
# Configure serial devices
/sbin/setserial /dev/ttyS0 auto_irq skip_test autoconfig
/sbin/setserial /dev/ttyS1 auto_irq skip_test autoconfig
/sbin/setserial /dev/ttyS2 auto_irq skip_test autoconfig
/sbin/setserial /dev/ttyS3 auto_irq skip_test autoconfig
#
# Display serial device configuration
/sbin/setserial -bg /dev/ttyS*</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>The <TT
CLASS="LITERAL"
>-bg /dev/ttyS*</TT
> argument in the last
command will print a neatly formatted summary of the hardware configuration
of all active serial devices. The output will look like that shown in
<A
HREF="#X-087-2-SERIAL.SETSERIAL.OUTPUT"
>Example 4-2</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-SERIAL.SETSERIAL.OUTPUT"
></A
><P
><B
>Example 4-2. Output of setserial -bg /dev/ttyS Command</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>/dev/ttyS0 at 0x03f8 (irq = 4) is a 16550A
/dev/ttyS1 at 0x02f8 (irq = 3) is a 16550A</PRE
></FONT
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-SERIAL-STTY"
>4.5.2. The stty Command</A
></H3
><P
>&#13;
&#13;</P
><P
>The name <B
CLASS="COMMAND"
>stty</B
> probably means &#8220;set tty,&#8221;
but the <B
CLASS="COMMAND"
>stty</B
> command can also be used to display a
terminal's configuration. Perhaps even more so than
<B
CLASS="COMMAND"
>setserial</B
>, the <B
CLASS="COMMAND"
>stty</B
> command
provides a bewildering number of characteristics you can
configure. We'll cover the most important of these in a moment. You
can find the rest described in the <B
CLASS="COMMAND"
>stty</B
> manual
page.</P
><P
>The <B
CLASS="COMMAND"
>stty</B
> command is most commonly used to configure
terminal parameters, such as whether characters will be echoed or what
key should generate a break signal. We explained earlier that serial
devices are tty devices and the <B
CLASS="COMMAND"
>stty</B
> command is therefore
equally applicable to them.</P
><P
>One of the more important uses of the <B
CLASS="COMMAND"
>stty</B
> for
serial devices is to enable hardware handshaking on the device. We
talked briefly about hardware handshaking earlier. The default
configuration for serial devices is for hardware handshaking to be
disabled. This setting allows &#8220;three wire&#8221; serial cables to work;
they don't support the necessary signals for hardware handshaking, and
if it were enabled by default, they'd be unable to transmit any
characters to change it.</P
><P
>Surprisingly, some serial communications programs don't enable
hardware handshaking, so if your modem supports hardware handshaking,
you should configure the modem to use it (check your modem manual for
what command to use), and also configure your serial device to use
it. The <B
CLASS="COMMAND"
>stty</B
> command has a
<TT
CLASS="LITERAL"
>crtscts</TT
> flag that enables hardware handshaking on a
device; you'll need to use this. The command is probably best issued
from the <TT
CLASS="FILENAME"
>rc.serial</TT
> file (or equivalent) at boot
time using commands like those shown in <A
HREF="#X-087-2-SERIAL-RC.SERIAL.STTY"
>Example 4-3</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-SERIAL-RC.SERIAL.STTY"
></A
><P
><B
>Example 4-3. Example rc.serial stty Commands</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#
stty crtscts &#60; /dev/ttyS0
stty crtscts &#60; /dev/ttyS1
stty crtscts &#60; /dev/ttyS2
stty crtscts &#60; /dev/ttyS3
#</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>The <B
CLASS="COMMAND"
>stty</B
> command works on the current terminal by
default, but by using the input redirection (&#8220;&#60;&#8221;)
feature of the shell, we can have <B
CLASS="COMMAND"
>stty</B
> manipulate
any tty device. It's a common mistake to forget whether you are
supposed to use &#8220;&#60;&#8221; or &#8220;&#62;&#8221;; modern
versions of the <B
CLASS="COMMAND"
>stty</B
> command have a much cleaner
syntax for doing this. To use the new syntax, we'd rewrite our sample
configuration to look like that shown in <A
HREF="#X-087-2-SERIAL-RC.SERIAL.STTY.NEW"
>Example 4-4</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-SERIAL-RC.SERIAL.STTY.NEW"
></A
><P
><B
>Example 4-4. Example rc.serial stty Commands Using Modern Syntax</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#
stty crtscts -F /dev/ttyS0
stty crtscts -F /dev/ttyS1
stty crtscts -F /dev/ttyS2
stty crtscts -F /dev/ttyS3
#</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>We mentioned that the <B
CLASS="COMMAND"
>stty</B
> command can be used to display
the terminal configuration parameters of a tty device. To display all of
the active settings on a tty device, use:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>stty -a -F /dev/ttyS1</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The output of this command, shown in
<A
HREF="#X-087-2-SERIAL.STTY.OUTPUT"
>Example 4-5</A
>, gives you the status of all flags
for that device; a flag shown with a preceding minus, as in
<CODE
CLASS="OPTION"
>&#8211;crtscts</CODE
>, means that the flag has been
turned off.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-SERIAL.STTY.OUTPUT"
></A
><P
><B
>Example 4-5. Output of stty -a Command</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>speed 19200 baud; rows 0; columns 0; line = 0;
intr = ^C; quit = ^\; erase = ^?; kill = ^U; eof = ^D; eol = &#60;undef&#62;; 
         eol2 = &#60;undef&#62;; start = ^Q; stop = ^S; susp = ^Z; rprnt = ^R;
         werase = ^W; lnext = ^V; flush = ^O; min = 1; time = 0;
-parenb -parodd cs8 hupcl -cstopb cread clocal -crtscts
-ignbrk -brkint -ignpar -parmrk -inpck -istrip -inlcr -igncr -icrnl -ixon
        -ixoff -iuclc -ixany -imaxbel
-opost -olcuc -ocrnl onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0
         bs0 vt0 ff0
-isig -icanon iexten echo echoe echok -echonl -noflsh -xcase -tostop
         -echoprt echoctl echoke</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>A description of the most important of these flags is given in <A
HREF="#X-087-2-SERIAL.STTY.FLAGS"
>Table 4-2</A
>. Each of these flags is enabled
by supplying it to <B
CLASS="COMMAND"
>stty</B
> and disabled by supplying
it to <B
CLASS="COMMAND"
>stty</B
> with the &#8211; character in front of
it. Thus, to disable hardware handshaking on the
<TT
CLASS="LITERAL"
>ttyS0</TT
> device, you would use:
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>stty -crtscts -F /dev/ttyS0</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><DIV
CLASS="TABLE"
><A
NAME="X-087-2-SERIAL.STTY.FLAGS"
></A
><P
><B
>Table 4-2. stty Flags Most Relevant to Configuring Serial Devices</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL
WIDTH="4"><THEAD
><TR
><TH
>Flags</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="LITERAL"
>N</TT
></TD
><TD
><P
>	Set the line speed to <TT
CLASS="LITERAL"
>N</TT
> bits per second.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>crtsdts</TT
></TD
><TD
><P
>	Enable/Disable hardware handshaking.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>ixon</TT
></TD
><TD
><P
>	Enable/Disable XON/XOFF flow control.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>clocal</TT
></TD
><TD
><P
>	Enable/Disable modem control signals such as DTR/DTS and DCD. This
	is necessary if you are using a &#8220;three wire&#8221; serial cable because it does not supply these signals.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>cs5 cs6 cs7 cs8</TT
></TD
><TD
><P
>	Set number of data bits to 5, 6, 7, or 8, respectively.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>parodd</TT
></TD
><TD
><P
>	Enable odd parity. Disabling this flag enables even parity.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>parenb</TT
></TD
><TD
><P
>	Enable parity checking. When this flag is negated, no parity is used.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>cstopb</TT
></TD
><TD
><P
>	Enable use of two stop bits per character. When this flag is
	negated, one stop bit per character is used.
	</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>echo</TT
></TD
><TD
><P
>	Enable/Disable echoing of received characters back to sender.
	</P
></TD
></TR
></TBODY
></TABLE
></DIV
><P
>The next example combines some of these flags and sets the
<TT
CLASS="FILENAME"
>ttyS0</TT
> device to 19,200 bps, 8 data bits, no
parity, and hardware handshaking with echo disabled:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>stty 19200 cs8 -parenb crtscts -echo -F /dev/ttyS0</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
></P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-SERIAL.GETTY"
>4.6. Serial Devices and the login: Prompt</A
></H2
><P
>It was once very common that a Unix installation involved one server
machine and many &#8220;dumb&#8221; character mode terminals or
dial-up modems.  Today that sort of installation is less common, which
is good news for many people interested in operating this way, because
the &#8220;dumb&#8221; terminals are now very cheap to
acquire. Dial-up modem configurations are no less common, but these
days they would probably be used to support a SLIP or PPP login
(discussed in <A
HREF="#X-087-2-SLIP"
>Chapter 7</A
> and <A
HREF="#X-087-2-PPP"
>Chapter 8</A
>&#8201;) than to be used for a simple login.
Nevertheless, each of these configurations can make use of a simple
program called a <B
CLASS="COMMAND"
>getty</B
> program.</P
><P
>The term <B
CLASS="COMMAND"
>getty</B
> is probably a contraction of
&#8220;get tty.&#8221; A <B
CLASS="COMMAND"
>getty</B
> program opens a
serial device, configures it appropriately, optionally configures a
modem, and waits for a connection to be made. An active connection on
a serial device is usually indicated by the Data Carrier Detect (DCD)
pin on the serial device being raised. When a connection is detected,
the <B
CLASS="COMMAND"
>getty</B
> program issues a
<TT
CLASS="LITERAL"
>login:</TT
> prompt, and then invokes the
<B
CLASS="COMMAND"
>login</B
> program to handle the actual system
login. Each of the virtual terminals (e.g.,
<TT
CLASS="FILENAME"
>/dev/tty1</TT
>) in Linux has a
<B
CLASS="COMMAND"
>getty</B
> running against it.</P
><P
>There are a number of different <B
CLASS="COMMAND"
>getty</B
>
implementations, each designed to suit some configurations better than
others.  The <B
CLASS="COMMAND"
>getty</B
> that we'll describe here is
called <B
CLASS="COMMAND"
>mgetty</B
>. It is quite popular because it has
all sorts of features that make it especially modem-friendly,
including support for automatic fax programs and voice modems. We'll
concentrate on configuring <B
CLASS="COMMAND"
>mgetty</B
> to answer
conventional data calls and leave the rest for you to explore at your
convenience.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-SERIAL.GETTY.MGETTY"
>4.6.1. Configuring the mgetty Daemon</A
></H3
><P
>The <B
CLASS="COMMAND"
>mgetty</B
> daemon is available in source form from
<SPAN
CLASS="SYSTEMITEM"
>ftp://alpha.greenie.net/pub/mgetty/source/</SPAN
>,
and is available in just about all Linux distributions in prepackaged
form.  The <B
CLASS="COMMAND"
>mgetty</B
> daemon differs from most other
<B
CLASS="COMMAND"
>getty</B
> implementations in that it has been designed
specifically for Hayes-compatible modems. It still supports direct
terminal connections, but is best suited for dialup
applications. Rather than using the DCD line to detect an incoming
call, it listens for the <TT
CLASS="LITERAL"
>RING</TT
> message generated by
modern modems when they detect an incoming call and are not configured
for auto-answer.</P
><P
>The main executable program is called
<TT
CLASS="FILENAME"
>/usr/sbin/mgetty</TT
>, and its main configuration file
is called <TT
CLASS="FILENAME"
>/etc/mgetty/mgetty.config</TT
>. There are a
number of other binary programs and configuration files that cover
other <B
CLASS="COMMAND"
>mgetty</B
> features.</P
><P
>For most installations, configuration is a matter of editing the
<TT
CLASS="FILENAME"
>/etc/mgetty/ mgetty.config</TT
> file and adding
appropriate entries to the <TT
CLASS="FILENAME"
>/etc/inittab</TT
> file to
execute <B
CLASS="COMMAND"
>mgetty</B
> automatically.</P
><P
><A
HREF="#X-087-2-SERIAL.MGETTY.CONF"
>Example 4-6</A
> shows a very simple
<B
CLASS="COMMAND"
>mgetty</B
> configuration file. This example configures
two serial devices. The first, <TT
CLASS="FILENAME"
>/dev/ttyS0</TT
>,
supports a Hayes-compatible modem at 38,400 bps. The second,
<TT
CLASS="FILENAME"
>/dev/ttyS0</TT
>, supports a directly connected VT100
terminal at 19,200 bps.</P
><P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-SERIAL.MGETTY.CONF"
></A
><P
><B
>Example 4-6. Sample /etc/mgetty/mgetty.config File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#
# mgetty configuration file
#
# this is a sample configuration file, see mgetty.info for details
#
# comment lines start with a "#", empty lines are ignored
#
# ----- global section -----
#
# In this section, you put the global defaults, per-port stuff is below
#
# access the modem(s) with 38400 bps
speed 38400
#
# set the global debug level to "4" (default from policy.h)
debug 4
#

# ----- port specific section -----
# 
# Here you can put things that are valid only for one line, not the others
#
#
# Hayes modem connected to ttyS0: don't do fax, less logging
#
port ttyS0
  debug 3
  data-only y
#
# direct connection of a VT100 terminal which doesn't like DTR drops
#
port ttyS1
  direct y
  speed 19200
  toggle-dtr n
#</PRE
></FONT
></TD
></TR
></TABLE
></DIV
></P
><P
>The configuration file supports global and port-specific options.
In our example we used a global option to set the speed to 38,400 bps. This
value is inherited by the <TT
CLASS="FILENAME"
>ttyS0</TT
> port. Ports we apply
<B
CLASS="COMMAND"
>mgetty</B
> to use this speed setting unless it is
overwritten by a port-specific speed setting, as we have done in the
<TT
CLASS="FILENAME"
>ttyS1</TT
> configuration.</P
><P
>The <TT
CLASS="LITERAL"
>debug</TT
> keyword controls the verbosity of
<B
CLASS="COMMAND"
>mgetty</B
> logging. The <TT
CLASS="LITERAL"
>data-only</TT
>
keyword in the <TT
CLASS="FILENAME"
>ttyS0</TT
> configuration causes
<B
CLASS="COMMAND"
>mgetty</B
> to ignore any modem fax features, to operate
just as a data modem. The <TT
CLASS="LITERAL"
>direct</TT
> keyword in the
<TT
CLASS="FILENAME"
>ttyS1</TT
> configuration instructs
<B
CLASS="COMMAND"
>mgetty</B
> not to attempt any modem initialization on
the port. Finally, the <TT
CLASS="LITERAL"
>toggle-dtr</TT
> keyword instructs
<B
CLASS="COMMAND"
>mgetty</B
> not to attempt to hang up the line by
dropping the DTR (Data Terminal Ready) pin on the serial interface;
some terminals don't like this to happen.</P
><P
>You can also choose to leave the <TT
CLASS="FILENAME"
>mgetty.config</TT
>
file empty and use command-line arguments to specify most of the same
parameters. The documentation accompanying the application includes a
complete description of the <B
CLASS="COMMAND"
>mgetty</B
> configuration
file parameters and command-line arguments. See the following example.</P
><P
>We need to add two entries to the <TT
CLASS="FILENAME"
>/etc/inittab</TT
>
file to activate this configuration. The <TT
CLASS="FILENAME"
>inittab</TT
>
file is the configuration file of the Unix System V
<B
CLASS="COMMAND"
>init</B
> command. The <B
CLASS="COMMAND"
>init</B
> command
is responsible for system initialization; it provides a means of
automatically executing programs at boot time and re-executing them
when they terminate. This is ideal for the goals of running a
<B
CLASS="COMMAND"
>getty</B
> program.</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>T0:23:respawn:/sbin/mgetty ttyS0
T1:23:respawn:/sbin/mgetty ttyS1</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Each line of the <TT
CLASS="FILENAME"
>/etc/inittab</TT
> file contains four
fields, separated by colons. The first field is an identifier that
uniquely labels an entry in the file; traditionally it is two
characters, but modern versions allow four. The second field is the
list of run levels at which this entry should be active. A run level
is a means of providing alternate machine configurations and is
implemented using trees of startup scripts stored in directories
called <TT
CLASS="FILENAME"
>/etc/rc1.d</TT
>,
<TT
CLASS="FILENAME"
>/etc/rc2.d</TT
>, etc. This feature is typically
implemented very simply, and you should model your entries on others
in the file or refer to your system documentation for more
information. The third field describes when to take action. For the
purposes of running a <B
CLASS="COMMAND"
>getty</B
> program, this field
should be set to <TT
CLASS="LITERAL"
>respawn</TT
>, meaning that the command
should be re-executed automatically when it dies. There are several
other options, as well, but they are not useful for our purposes
here. The fourth field is the actual command to execute; this is where
we specify the <B
CLASS="COMMAND"
>mgetty</B
> command and any arguments we
wish to pass it. In our simple example we're starting and restarting
<B
CLASS="COMMAND"
>mgetty</B
> whenever the system is operating at either
of run levels two or three, and are supplying as an argument just the
name of the device we wish it to use.  The <B
CLASS="COMMAND"
>mgetty</B
>
command assumes the <TT
CLASS="FILENAME"
>/dev/</TT
>, so we don't need to
supply it.</P
><P
>This chapter was a quick introduction to <B
CLASS="COMMAND"
>mgetty</B
>
and how to offer login prompts to serial devices. You can find more
extensive information in the Serial-HOWTO.</P
><P
>After you've edited the configuration files, you need to reload
<B
CLASS="COMMAND"
>init</B
> to make the changes take effect. Simply send a
hangup signal to the <B
CLASS="COMMAND"
>init</B
> process; it always has a
process ID of one, so you can use the following command safely:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>kill -HUP 1</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-IFACE"
></A
>Chapter 5. Configuring TCP/IP Networking</H1
><P
>&#13;

 
In this chapter, we walk you through all the necessary steps to set up
TCP/IP networking on your machine. Starting with the assignment of IP
addresses, we slowly work our way through the configuration of TCP/IP
network interfaces and introduce a few tools that come in handy when
hunting down network installation problems.</P
><P
>Most of the tasks covered in this chapter will generally have to be
done only once. Afterward, you have to touch most configuration files
only when adding a new system to your network or when you reconfigure
your system entirely. Some of the commands used to configure TCP/IP,
however, have to be executed each time the system is booted. This is
usually done by invoking them from the system
<TT
CLASS="FILENAME"
>/etc/rc*</TT
> scripts.</P
><P
>&#13;Commonly, the network-specific part of this procedure is contained in
a script. The name of this script varies in different Linux
distributions. In many older Linux distributions, it is known as
<TT
CLASS="FILENAME"
>rc.net</TT
> or <TT
CLASS="FILENAME"
>rc.inet</TT
>. Sometimes
you will also see two scripts named <TT
CLASS="FILENAME"
>rc.inet1</TT
> and
<TT
CLASS="FILENAME"
>rc.inet2</TT
>&#8201;; the former initializes the
kernel part of networking and the latter starts basic networking
services and applications. In modern distributions, the
<TT
CLASS="FILENAME"
>rc</TT
> files are structured in a more sophisticated
arrangement; here you may find scripts in the
<TT
CLASS="FILENAME"
>/etc/init.d/</TT
> (or
<TT
CLASS="FILENAME"
>/etc/rc.d/init.d/</TT
>&#8201;) directory that create
the network devices and other <TT
CLASS="FILENAME"
>rc</TT
> files that run
the network application programs. This book's examples are based on
the latter arrangement.</P
><P
>This chapter discusses parts of the script that configure your network
interfaces, while applications will be covered in later chapters.
After finishing this chapter, you should have established a sequence
of commands that properly configure TCP/IP networking on your
computer. You should then replace any sample commands in your
configuration scripts with your commands, make sure the script is
executed from the basic <TT
CLASS="FILENAME"
>rc</TT
> script at startup
time, and reboot your machine. The networking <TT
CLASS="FILENAME"
>rc</TT
>
scripts that come along with your favorite Linux distribution should
provide a solid example from which to work.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IFACE.PROCFS"
>5.1. Mounting the /proc Filesystem</A
></H2
><P
>Some of the configuration tools of the Linux NET-2 and NET-3 release
rely on the <TT
CLASS="FILENAME"
>/proc</TT
> filesystem for communicating
with the kernel. This interface permits access to kernel runtime
information through a filesystem-like mechanism. When mounted, you can
list its files like any other filesystem, or display their contents.
Typical items include the <TT
CLASS="FILENAME"
>loadavg</TT
> file, which
contains the system load average, and <TT
CLASS="FILENAME"
>meminfo</TT
>,
which shows current core memory and swap usage.</P
><P
>&#13;To this, the networking code adds the <TT
CLASS="FILENAME"
>net</TT
> directory.
It contains a number of files that show things like the kernel ARP tables,
the state of TCP connections, and the routing tables. Most network
administration tools get their information from these files.</P
><P
>&#13;The <TT
CLASS="FILENAME"
>proc</TT
> filesystem (or <TT
CLASS="FILENAME"
>procfs</TT
>, as
it is also known) is usually mounted on <TT
CLASS="FILENAME"
>/proc</TT
> at system
boot time. The best method is to add the following line to
<TT
CLASS="FILENAME"
>/etc/fstab</TT
>&#8201;:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># procfs mount point:
none		/proc		proc	defaults</PRE
></FONT
></TD
></TR
></TABLE
>

Then execute <B
CLASS="COMMAND"
>mount /proc</B
> from your
<TT
CLASS="FILENAME"
>/etc/rc</TT
> script.</P
><P
>The <TT
CLASS="FILENAME"
>procfs</TT
> is now configured into most kernels by
default. If the <TT
CLASS="FILENAME"
>procfs</TT
> is not in your kernel, you
will get a message such as: <TT
CLASS="LITERAL"
>mount: fs type procfs not
supported by kernel</TT
>. You will then have to recompile the
kernel and answer &#8220;yes&#8221; when asked for
<TT
CLASS="FILENAME"
>procfs</TT
> support.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IFACE.BINARIES"
>5.2. Installing the Binaries</A
></H2
><P
>If you are using one of the prepackaged Linux distributions, it will
contain the major networking applications and utilities along with a
coherent set of sample files. The only case in which you might have to
obtain and install new utilities is when you install a new kernel
release. As they occasionally involve changes in the kernel networking
layer, you will need to update the basic configuration tools. This
update at least involves recompiling, but sometimes you may also be
required to obtain the latest set of binaries. These binaries are
available at their official home site at <EM
>ftp.inka.de/pub/comp/Linux/networking/NetTools/</EM
>,
packaged in an archive called
<TT
CLASS="FILENAME"
>net-tools-XXX.tar.gz</TT
>, where
<TT
CLASS="FILENAME"
>XXX</TT
> is the version number. The release matching
Linux 2.0 is <TT
CLASS="FILENAME"
>net-tools-1.45</TT
>.</P
><P
>If you want to compile and install the standard TCP/IP network applications
yourself, you can obtain the sources from most Linux FTP servers. All modern
Linux distributions include a fairly comprehensive range of TCP/IP network
applications, such as World Wide Web browsers, <B
CLASS="COMMAND"
>telnet</B
> and
<B
CLASS="COMMAND"
>ftp</B
> programs, and other network applications, such as
<B
CLASS="COMMAND"
>talk</B
>. If you do find something that you do need to compile
yourself, the chances are good that it will compile under Linux from
source quite simply if you follow the instructions included in the source
package.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IFACE.HOSTNAME"
>5.3. Setting the Hostname</A
></H2
><P
>Most, if not all, network applications rely on you to set the local
host's name to some reasonable value. This setting is usually made
during the boot procedure by executing the <B
CLASS="COMMAND"
>hostname</B
>
command. To set the hostname to <TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
>, enter:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>hostname</KBD
> <TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>It is common practice to use the unqualified hostname without
specifying the domain name. For instance, hosts at the Virtual Brewery
(described in <A
HREF="#X-087-2-APPENDIX.BREWERY"
>Appendix A</A
>) might be
called <SPAN
CLASS="SYSTEMITEM"
>vale.vbrew.com</SPAN
> or
<SPAN
CLASS="SYSTEMITEM"
>vlager.vbrew.com</SPAN
>. These are
their official <EM
>fully qualified domain names</EM
>
(FQDNs). Their local hostnames would be the first component of the
name, such as <SPAN
CLASS="SYSTEMITEM"
>vale</SPAN
>. However,
as the local hostname is frequently used to look up the host's IP
address, you have to make sure that the resolver library is able to
look up the host's IP address. This usually means that you have to
enter the name in <TT
CLASS="FILENAME"
>/etc/hosts</TT
>.</P
><P
>&#13;

Some people suggest using the <B
CLASS="COMMAND"
>domainname</B
> command to
set the kernel's idea of a domain name to the remaining part of the
FQDN. This way you could combine the output from
<B
CLASS="COMMAND"
>hostname</B
> and <B
CLASS="COMMAND"
>domainname</B
> to get
the FQDN again. However, this is at best only half
correct. <B
CLASS="COMMAND"
>domainname</B
> is generally used to set the
host's NIS domain, which may be entirely different from the DNS domain
to which your host belongs. Instead, to ensure that the short form of
your hostname is resolvable with all recent versions of the
<B
CLASS="COMMAND"
>hostname</B
> command, either add it as an entry in your
local Domain Name Server or place the fully qualified domain name in
the <TT
CLASS="FILENAME"
>/etc/hosts</TT
> file. You may then use the
<CODE
CLASS="PARAMETER"
>--fqdn</CODE
> argument to the
<B
CLASS="COMMAND"
>hostname</B
> command, and it will print the fully
qualifed domain name.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IFACE.ADDRESSES"
>5.4. Assigning IP Addresses</A
></H2
><P
>If you configure the networking software on your host for standalone
operation (for instance, to be able to run the INN Netnews software),
you can safely skip this section, because the only IP address
you will need is for the loopback interface, which is always
<SPAN
CLASS="SYSTEMITEM"
>127.0.0.1</SPAN
>.</P
><P
>Things are a little more complicated with real networks like Ethernets.
If you want to connect your host to an existing network, you have to ask
its administrators to give you an IP address on this network.  When
setting up a network all by yourself, you have to assign IP addresses
yourself.</P
><P
>Hosts within a local network should usually share addresses from the
same logical IP network. Hence, you have to assign an IP network address.
If you have several physical networks, you have to either assign them
different network numbers, or use subnetting to split your IP address
range into several subnetworks. Subnetting will be revisited in the
next section, <A
HREF="#X-087-2-CREATE.SUBNETS"
>Section 5.5</A
>.&#8221;</P
><P
>When picking an IP network number, much depends on whether you intend
to get on the Internet in the near future. If so, you should obtain an
official IP address <EM
>now</EM
>. Ask your network service
provider to help you. If you want to obtain a network number, just in
case you might get on the Internet someday, request a Network Address
Application Form from <SPAN
CLASS="SYSTEMITEM"
>hostmaster@internic.net</SPAN
>, or your
country's own Network Information Center, if there is one.</P
><P
>If your network is not connected to the Internet and won't be in the
near future, you are free to choose any legal network address. Just
make sure no packets from your internal network escape to the real
Internet. To make sure no harm can be done even if packets
<EM
>did</EM
> escape, you should use one of the network
numbers reserved for private use. The Internet Assigned Numbers
Authority (IANA) has set aside several network numbers from classes A,
B, and C that you can use without registering. These addresses are
valid only within your private network and are not routed between real
Internet sites. The numbers are defined by RFC 1597 and are listed in
<A
HREF="#X-087-2-ISSUES.RESERVED.ADDRESSES"
>Table 2-1</A
> in <A
HREF="#X-087-2-ISSUES"
>Chapter 2</A
>. Note that the second and third blocks
contain 16 and 256 networks, respectively.</P
><P
>Picking your addresses from one of these network numbers is not
only useful for networks completely unconnected to the Internet; you can
still implement a slightly more restricted access using a single
host as a gateway. To your local network, the gateway is accessible by its
internal IP address, while the outside world knows it by an officially
registered address (assigned to you by your provider). We come back to
this concept in connection with the IP masquerade facility in
<A
HREF="#X-087-2-IPMASQ"
>Chapter 11</A
>.</P
><P
>Throughout the remainder of the book, we will assume that the brewery's
network manager uses a class B network number, say
<SPAN
CLASS="SYSTEMITEM"
>172.16.0.0</SPAN
>. Of course, a class C
network number would definitely suffice to accommodate both the Brewery's and
the Winery's networks. We'll use a class B network here for the sake of
simplicity; it will make the subnetting examples in the next section
of this chapter a little more intuitive.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-CREATE.SUBNETS"
>5.5. Creating Subnets</A
></H2
><P
>To operate several Ethernets (or other networks, once a driver is
available), you have to split your network into subnets. Note that
subnetting is required only if you have more than one
<EM
>broadcast network</EM
>&#8212;point-to-point links
don't count. For instance, if you have one Ethernet, and one or more
SLIP links to the outside world, you don't need to subnet your
network. This is explained in more detail in <A
HREF="#X-087-2-SLIP"
>Chapter 7</A
>.</P
><P
>To accommodate the two Ethernets, the Brewery's network manager decides
to use 8 bits of the host part as additional subnet bits. This
leaves another 8 bits for the host part, allowing for 254 hosts on
each of the subnets. She then assigns subnet number 1 to the brewery,
and gives the winery number 2. Their respective network addresses are
thus <SPAN
CLASS="SYSTEMITEM"
>172.16.1.0</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>172.16.2.0</SPAN
>. The subnet mask is
<SPAN
CLASS="SYSTEMITEM"
>255.255.255.0</SPAN
>.</P
><P
><SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>, which is the gateway between
the two networks, is assigned a host number of 1 on both of them, which gives
it the IP addresses <SPAN
CLASS="SYSTEMITEM"
>172.16.1.1</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>172.16.2.1</SPAN
>, respectively.</P
><P
>Note that in this example we are using a class B network to keep things
simple, but a class C network would be more realistic. With the new networking
code, subnetting is not limited to byte boundaries, so even a class C
network may be split into several subnets. For instance, you could use two
bits of the host part for the netmask, giving you 4 possible subnets
with 64 hosts on each.<A
NAME="X-087-2-FNTC02"
HREF="#FTN.X-087-2-FNTC02"
><SPAN
CLASS="footnote"
>[28]</SPAN
></A
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IFACE.SIMPLE-RESOLV"
>5.6. Writing hosts and networks Files</A
></H2
><P
>After you have subnetted your network, you should prepare for some simple
sort of hostname resolution using the <TT
CLASS="FILENAME"
>/etc/hosts</TT
> file.
If you are not going to use DNS or NIS for address resolution, you have to put
all hosts in the <TT
CLASS="FILENAME"
>hosts</TT
> file.</P
><P
>Even if you want to run DNS or NIS during normal operation, you should
have some subset of all hostnames in
<TT
CLASS="FILENAME"
>/etc/hosts</TT
>. You should have some sort of name
resolution, even when no network interfaces are running, for example,
during boot time. This is not only a matter of convenience, but it
allows you to use symbolic hostnames in your network
<TT
CLASS="FILENAME"
>rc</TT
> scripts. Thus, when changing IP addresses, you
only have to copy an updated <TT
CLASS="FILENAME"
>hosts</TT
> file to all
machines and reboot, rather than edit a large number of
<TT
CLASS="FILENAME"
>rc</TT
> files separately. Usually you put all local
hostnames and addresses in <TT
CLASS="FILENAME"
>hosts</TT
>, adding those of
any gateways and NIS servers used.<A
NAME="X-087-2-FNTC03"
HREF="#FTN.X-087-2-FNTC03"
><SPAN
CLASS="footnote"
>[29]</SPAN
></A
></P
><P
>You should make sure your resolver only uses information from the
<TT
CLASS="FILENAME"
>hosts</TT
> file during initial testing. Sample files
that come with your DNS or NIS software may produce strange
results. To make all applications use <TT
CLASS="FILENAME"
>/etc/hosts</TT
>
exclusively when looking up the IP address of a host, you have to edit
the <TT
CLASS="FILENAME"
>/etc/host.conf</TT
> file. Comment out any lines
that begin with the keyword <SPAN
CLASS="SYSTEMITEM"
>order</SPAN
> by preceding them with a hash sign,
and insert the line:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>order hosts</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The configuration of the resolver library is covered in detail in
<A
HREF="#X-087-2-RESOLV"
>Chapter 6</A
>.</P
><P
>The <TT
CLASS="FILENAME"
>hosts</TT
> file contains one entry per line, consisting
of an IP address, a hostname, and an optional list of aliases for the
hostname. The fields are separated by spaces or tabs, and the address
field must begin in the first column. Anything following a hash sign (#) is
regarded as a comment and is ignored.</P
><P
>Hostnames can be either fully qualified or relative to the local domain.
For <SPAN
CLASS="SYSTEMITEM"
>vale</SPAN
>, you would usually enter the
fully qualified name, <SPAN
CLASS="SYSTEMITEM"
>vale.vbrew.com</SPAN
>,
and <SPAN
CLASS="SYSTEMITEM"
>vale</SPAN
> by itself in the
<TT
CLASS="FILENAME"
>hosts</TT
> file, so that it is known by both its official name
and the shorter local name.</P
><P
>This is an example how a <TT
CLASS="FILENAME"
>hosts</TT
> file at the Virtual
Brewery might look. Two special names are included,
<SPAN
CLASS="SYSTEMITEM"
>vlager-if1</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>vlager-if2</SPAN
>, which give the addresses
for both interfaces used on <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#
# Hosts file for Virtual Brewery/Virtual Winery
#
# IP            FQDN                 aliases
#
127.0.0.1       localhost
#
172.16.1.1      vlager.vbrew.com      vlager vlager-if1
172.16.1.2      vstout.vbrew.com      vstout
172.16.1.3      vale.vbrew.com        vale
#
172.16.2.1      vlager-if2
172.16.2.2      vbeaujolais.vbrew.com vbeaujolais
172.16.2.3      vbardolino.vbrew.com  vbardolino
172.16.2.4      vchianti.vbrew.com    vchianti</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;
Just as with a host's IP address, you should sometimes use a symbolic
name for network numbers, too. Therefore, the
<TT
CLASS="FILENAME"
>hosts</TT
> file has a companion called
<TT
CLASS="FILENAME"
>/etc/networks</TT
> that maps network names to network
numbers, and vice versa. At the Virtual Brewery, we might install a
<TT
CLASS="FILENAME"
>networks</TT
> file like this:<A
NAME="X-087-2-FNTC04"
HREF="#FTN.X-087-2-FNTC04"
><SPAN
CLASS="footnote"
>[30]</SPAN
></A
>

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/networks for the Virtual Brewery
brew-net      172.16.1.0
wine-net      172.16.2.0</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IFACE.INTERFACE"
>5.7. Interface Configuration for IP</A
></H2
><P
>After setting up your hardware as explained in <A
HREF="#X-087-2-SERIAL"
>Chapter 4</A
>, you have to make these devices known to the
kernel networking software. A couple of commands are used to configure
the network interfaces and initialize the routing table. These tasks
are usually performed from the network initialization script each time
you boot the system. The basic tools for this process are called
<B
CLASS="COMMAND"
>ifconfig</B
> (where &#8220;if&#8201;&#8221; stands for
interface) and <B
CLASS="COMMAND"
>route</B
>.</P
><P
><B
CLASS="COMMAND"
>ifconfig</B
> is used to make an interface accessible to
the kernel networking layer. This involves the assignment of an IP
address and other parameters, and activation of the interface, also
known as &#8220;bringing up&#8221; the interface. Being active here
means that the kernel will send and receive IP datagrams through the
interface. The simplest way to invoke it is with:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ifconfig <TT
CLASS="REPLACEABLE"
><I
>interface</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>ip-address</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This command assigns <TT
CLASS="REPLACEABLE"
><I
>ip-address</I
></TT
> to
<TT
CLASS="REPLACEABLE"
><I
>interface</I
></TT
> and activates it. All other
parameters are set to default values. For instance, the default
network mask is derived from the network class of the IP address, such
as <SPAN
CLASS="SYSTEMITEM"
>255.255.0.0</SPAN
> for a class B
address.  <B
CLASS="COMMAND"
>ifconfig</B
> is described in detail in the
section <A
HREF="#X-087-2-IFACE.IFCONFIG"
>Section 5.8</A
>.&#8221;</P
><P
><B
CLASS="COMMAND"
>route</B
> allows you to add or remove routes from the kernel
routing table. It can be invoked as:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>route [add|del] [-net|-host] <TT
CLASS="REPLACEABLE"
><I
>target</I
></TT
> [<TT
CLASS="REPLACEABLE"
><I
>if</I
></TT
>]</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <CODE
CLASS="OPTION"
>add</CODE
> and <CODE
CLASS="OPTION"
>del</CODE
> arguments determine
whether to add or delete the route to
<TT
CLASS="REPLACEABLE"
><I
>target</I
></TT
>. The <CODE
CLASS="OPTION"
>-net</CODE
> and
<CODE
CLASS="OPTION"
>-host</CODE
> arguments tell the route command whether the
target is a network or a host (a host is assumed if you don't
specify). The <CODE
CLASS="OPTION"
>if</CODE
> argument is again optional, and
allows you to specify to which network interface the route should be
directed&#8212;the Linux kernel makes a sensible guess if you don't
supply this information. This topic will be explained in more detail
in succeeding sections.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IFACE.INTERFACE.LOOPBACK"
>5.7.1. The Loopback Interface</A
></H3
><P
>The very first interface to be activated is the loopback interface:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ifconfig lo 127.0.0.1</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;Occasionally, you will see the dummy hostname
<SPAN
CLASS="SYSTEMITEM"
>localhost</SPAN
> being used instead of the
IP address. <B
CLASS="COMMAND"
>ifconfig</B
> will look up the name in the
<TT
CLASS="FILENAME"
>hosts</TT
> file, where an entry should declare
it as the hostname for <SPAN
CLASS="SYSTEMITEM"
>127.0.0.1</SPAN
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># Sample /etc/hosts entry for localhost
localhost     127.0.0.1</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;To view the configuration of an interface, you invoke
<B
CLASS="COMMAND"
>ifconfig</B
>, giving it only the interface name as argument:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>ifconfig lo</KBD
>
lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:3924  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          Collisions:0 </PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>As you can see, the loopback interface has been assigned a netmask
of <SPAN
CLASS="SYSTEMITEM"
>255.0.0.0</SPAN
>, since
<SPAN
CLASS="SYSTEMITEM"
>127.0.0.1</SPAN
> is a class A address.</P
><P
>Now you can almost start playing with your mini-network. What is still
missing is an entry in the routing table that tells IP that it may use
this interface as a route to destination <SPAN
CLASS="SYSTEMITEM"
>127.0.0.1</SPAN
>. This is accomplished by using:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># route add 127.0.0.1</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Again, you can use <SPAN
CLASS="SYSTEMITEM"
>localhost</SPAN
> instead
of the IP address, provided you've entered it into your
<TT
CLASS="FILENAME"
>/etc/hosts</TT
>.</P
><P
>&#13;




Next, you should check that everything works fine, for example by using
<B
CLASS="COMMAND"
>ping</B
>. <B
CLASS="COMMAND"
>ping</B
> is the networking equivalent
of a sonar device.<A
NAME="X-087-2-FNTC05"
HREF="#FTN.X-087-2-FNTC05"
><SPAN
CLASS="footnote"
>[31]</SPAN
></A
> The command is used to verify that a given address is
actually reachable, and to measure the delay that occurs when sending
a datagram to it and back again. The time required for this process is
often referred to as the &#8220;round-trip time&#8221;:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ping localhost</KBD
>
PING localhost (127.0.0.1): 56 data bytes
64 bytes from 127.0.0.1: icmp_seq=0 ttl=255 time=0.4 ms
64 bytes from 127.0.0.1: icmp_seq=1 ttl=255 time=0.4 ms
64 bytes from 127.0.0.1: icmp_seq=2 ttl=255 time=0.4 ms
^C
--- localhost ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.4/0.4/0.4 ms
#</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>When you invoke <B
CLASS="COMMAND"
>ping</B
> as shown here, it will
continue emitting packets forever, unless interrupted by the user. The
<TT
CLASS="LITERAL"
>^C</TT
> marks the place where we pressed Ctrl-C.</P
><P
>The previous example shows that packets for <SPAN
CLASS="SYSTEMITEM"
>127.0.0.1</SPAN
> are properly delivered and a
reply is returned to <B
CLASS="COMMAND"
>ping</B
> almost instantaneously.
This shows that you have successfully set up your first network
interface.</P
><P
>&#13;
If the output you get from <B
CLASS="COMMAND"
>ping</B
> does not resemble
that shown in the previous example, you are in trouble. Check any
errors if they indicate that some file hasn't been installed
properly. Check that the <B
CLASS="COMMAND"
>ifconfig</B
> and
<B
CLASS="COMMAND"
>route</B
> binaries you use are compatible with the
kernel release you run, and above all, that the kernel has been
compiled with networking enabled (you see this from the presence of
the <TT
CLASS="FILENAME"
>/proc/net</TT
> directory). If you get an error
message saying &#8220;Network unreachable,&#8221; you probably got the
<B
CLASS="COMMAND"
>route</B
> command wrong. Make sure you use the same
address you gave to <B
CLASS="COMMAND"
>ifconfig</B
>.</P
><P
>&#13;The steps previously described are enough to use networking
applications on a standalone host. After adding the lines mentioned
earlier to your network initialization script and making sure it will
be executed at boot time, you may reboot your machine and try out
various applications. For instance, <B
CLASS="COMMAND"
>telnet
localhost</B
> should establish a <B
CLASS="COMMAND"
>telnet</B
>
connection to your host, giving you a <TT
CLASS="LITERAL"
>login:</TT
>
prompt.</P
><P
>However, the loopback interface is useful not only as an example in
networking books, or as a test bed during development, but is actually
used by some applications during normal operation.<A
NAME="X-087-2-FNTC06"
HREF="#FTN.X-087-2-FNTC06"
><SPAN
CLASS="footnote"
>[32]</SPAN
></A
>
Therefore, you always have to configure it, regardless of whether your machine
is attached to a network or not.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IFACE.INTERFACE.ETHERNET"
>5.7.2. Ethernet Interfaces</A
></H3
><P
>Configuring an Ethernet interface is pretty much the same as the
loopback interface; it just requires a few more parameters when you are
using subnetting. </P
><P
>At the Virtual Brewery, we have subnetted the IP network, which was
originally a class B network, into class C subnetworks. To make the
interface recognize this, the <B
CLASS="COMMAND"
>ifconfig</B
> incantation
would look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ifconfig eth0 vstout netmask 255.255.255.0</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This command assigns the <TT
CLASS="FILENAME"
>eth0</TT
> interface the IP
address of <SPAN
CLASS="SYSTEMITEM"
>vstout</SPAN
>
(<SPAN
CLASS="SYSTEMITEM"
>172.16.1.2</SPAN
>). If we omitted
the netmask, <B
CLASS="COMMAND"
>ifconfig</B
> would deduce the netmask from
the IP network class, which would result in an incorrect netmask of
<SPAN
CLASS="SYSTEMITEM"
>255.255.0.0</SPAN
>. Now a quick
check shows:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ifconfig eth0</KBD
>
eth0      Link encap 10Mps Ethernet HWaddr  00:00:C0:90:B3:42
          inet addr 172.16.1.2 Bcast 172.16.1.255 Mask 255.255.255.0
          UP BROADCAST RUNNING  MTU 1500  Metric 1
          RX packets 0 errors 0 dropped 0 overrun 0
          TX packets 0 errors 0 dropped 0 overrun 0</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>You can see that <B
CLASS="COMMAND"
>ifconfig</B
> automatically sets the broadcast
address (the <SPAN
CLASS="SYSTEMITEM"
>Bcast</SPAN
> field) to the
usual value, which is the host's network number with all the host bits set.
Also, the maximum transmission unit (the maximum size of IP datagrams the
kernel will generate for this interface) has been set to the maximum size of
Ethernet packets: 1,500 bytes. The defaults are usually what you will use, but
all these values can be overidden if required, with special options that will
be described under <A
HREF="#X-087-2-IFACE.IFCONFIG"
>Section 5.8</A
>&#8221;.</P
><P
> 
Just as for the loopback interface, you now have to install a routing
entry that informs the kernel about the network that can be reached
through <TT
CLASS="FILENAME"
>eth0</TT
>. For the Virtual Brewery, you might invoke
<B
CLASS="COMMAND"
>route</B
> as:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>route add -net 172.16.1.0</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>At first this looks a little like magic, because it's not really
clear how <B
CLASS="COMMAND"
>route</B
> detects which interface to route through.
However, the trick is rather simple: the kernel checks all interfaces
that have been configured so far and compares the destination address
(<SPAN
CLASS="SYSTEMITEM"
>172.16.1.0</SPAN
> in this case) to the
network part of the interface address (that is, the bitwise AND of the
interface address and the netmask). The only interface that matches is
<TT
CLASS="FILENAME"
>eth0</TT
>.</P
><P
>Now, what's that <CODE
CLASS="OPTION"
>&#8211;net</CODE
> option for? This is used
because <B
CLASS="COMMAND"
>route</B
> can handle both routes to networks
and routes to single hosts (as you saw before with <SPAN
CLASS="SYSTEMITEM"
>localhost</SPAN
>). When given an address in
dotted quad notation, <B
CLASS="COMMAND"
>route</B
> attempts to guess
whether it is a network or a hostname by looking at the host part
bits. If the address's host part is zero, <B
CLASS="COMMAND"
>route</B
>
assumes it denotes a network; otherwise, <B
CLASS="COMMAND"
>route</B
>
takes it as a host address. Therefore, <B
CLASS="COMMAND"
>route</B
> would
think that <SPAN
CLASS="SYSTEMITEM"
>172.16.1.0</SPAN
> is a
host address rather than a network number, because it cannot know that
we use subnetting. We have to tell <B
CLASS="COMMAND"
>route</B
> explicitly
that it denotes a network, so we give it the
<CODE
CLASS="OPTION"
>&#8211;net</CODE
> flag.</P
><P
>Of course, the <B
CLASS="COMMAND"
>route</B
> command is a little tedious to
type, and it's prone to spelling mistakes. A more convenient approach
is to use the network names we defined in
<TT
CLASS="FILENAME"
>/etc/networks</TT
>.  This approach makes the command
much more readable; even the <CODE
CLASS="OPTION"
>&#8211;net</CODE
> flag can be
omitted because <B
CLASS="COMMAND"
>route</B
> knows that <SPAN
CLASS="SYSTEMITEM"
>172.16.1.0</SPAN
> denotes a network:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>route add brew-net</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;

Now that you've finished the basic configuration steps, we want to
make sure that your Ethernet interface is indeed running
happily. Choose a host from your Ethernet, for instance <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>, and type:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ping vlager</KBD
>
PING vlager: 64 byte packets
64 bytes from 172.16.1.1: icmp_seq=0. time=11. ms
64 bytes from 172.16.1.1: icmp_seq=1. time=7. ms
64 bytes from 172.16.1.1: icmp_seq=2. time=12. ms
64 bytes from 172.16.1.1: icmp_seq=3. time=3. ms
^C
----vstout.vbrew.com PING Statistics----
4 packets transmitted, 4 packets received, 0
round-trip (ms)  min/avg/max = 3/8/12</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;If you don't see similar output, something is broken. If you encounter
unusual packet loss rates, this hints at a hardware problem, like bad
or missing terminators. If you don't receive any replies at all, you
should check the interface configuration with
<B
CLASS="COMMAND"
>netstat</B
> described later in <A
HREF="#X-087-2-IFACE.NETSTAT"
>Section 5.9</A
>&#8221;. The packet statistics displayed by
<B
CLASS="COMMAND"
>ifconfig</B
> should tell you whether any packets have
been sent out on the interface at all. If you have access to the
remote host too, you should go over to that machine and check the
interface statistics. This way you can determine exactly where the
packets got dropped. In addition, you should display the routing
information with <B
CLASS="COMMAND"
>route</B
> to see if both hosts have
the correct routing entry.  <B
CLASS="COMMAND"
>route</B
> prints out the
complete kernel routing table when invoked without any arguments
(<CODE
CLASS="OPTION"
>&#8211;n</CODE
> just makes it print addresses as dotted
quad instead of using the hostname):







<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>route -n</KBD
>
Kernel routing table
Destination  Gateway  Genmask         Flags Metric Ref Use    Iface
127.0.0.1    *        255.255.255.255 UH    1      0      112 lo
172.16.1.0   *        255.255.255.0   U     1      0       10 eth0</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The detailed meaning of these fields is explained later in <A
HREF="#X-087-2-IFACE.NETSTAT"
>Section 5.9</A
>." The <SPAN
CLASS="SYSTEMITEM"
>Flags</SPAN
> column contains a list of flags set
for each interface. <SPAN
CLASS="SYSTEMITEM"
>U</SPAN
> is
always set for active interfaces, and <SPAN
CLASS="SYSTEMITEM"
>H</SPAN
> says the destination address denotes a
host. If the <SPAN
CLASS="SYSTEMITEM"
>H</SPAN
> flag is set for
a route that you meant to be a network route, you have to reissue the
<B
CLASS="COMMAND"
>route</B
> command with the <CODE
CLASS="OPTION"
>&#8211;net</CODE
>
option. To check whether a route you have entered is used at all,
check to see if the <SPAN
CLASS="SYSTEMITEM"
>Use</SPAN
> field
in the second to last column increases between two invocations of
<B
CLASS="COMMAND"
>ping</B
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IFACE.INTERFACE.GATEWAY"
>5.7.3. Routing Through a Gateway</A
></H3
><P
>In the previous section, we covered only the case of setting up a host
on a single Ethernet. Quite frequently, however, one encounters
networks connected to one another by gateways. These gateways may
simply link two or more Ethernets, but may also provide a link to the
outside world, such as the Internet. In order to use a gateway, you
have to provide additional routing information to the networking
layer.</P
><P
>The Ethernets of the Virtual Brewery and the Virtual Winery are linked
through such a gateway, namely the host <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>.  Assuming that <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> has already been configured, we
just have to add another entry to <SPAN
CLASS="SYSTEMITEM"
>vstout</SPAN
>'s routing table that tells the
kernel it can reach all hosts on the Winery's network through
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>. The appropriate
incantation of <B
CLASS="COMMAND"
>route</B
> is shown below; the
<SPAN
CLASS="SYSTEMITEM"
>gw</SPAN
> keyword tells it that the
next argument denotes a gateway:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>route add wine-net gw vlager</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Of course, any host on the Winery network you wish to talk to must have
a routing entry for the Brewery's network. Otherwise you would only be able
to send data to the Winery network from the Brewery network, but the hosts on
the Winery would be unable to reply.</P
><P
>This example describes only a gateway that switches packets between
two isolated Ethernets. Now assume that <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> also has a connection to the
Internet (say, through an additional SLIP link). Then we would want
datagrams to <EM
>any</EM
> destination network other than
the Brewery to be handed to <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>.  This action can be accomplished
by making it the default gateway for <SPAN
CLASS="SYSTEMITEM"
>vstout</SPAN
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>route add default gw vlager</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;
The network name <SPAN
CLASS="SYSTEMITEM"
>default</SPAN
> is a shorthand
for <SPAN
CLASS="SYSTEMITEM"
>0.0.0.0</SPAN
>, which denotes the default
route. The default route matches every destination and will be used if there
is no more specific route that matches. You do not have to add this name to
<TT
CLASS="FILENAME"
>/etc/networks</TT
> because it is built into
<B
CLASS="COMMAND"
>route</B
>.</P
><P
>If you see high packet loss rates when pinging a host behind one or more
gateways, this may hint at a very congested network. Packet loss is not so
much due to technical deficiencies as to temporary excess loads on
forwarding hosts, which makes them delay or even drop incoming datagrams.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IFACE.INTERFACE.GATEWAY-CONF"
>5.7.4. Configuring a Gateway</A
></H3
><P
>Configuring a machine to switch packets between two Ethernets is
pretty straightforward. Assume we're back at <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>, which is equipped with two
Ethernet cards, each connected to one of the two networks. All you
have to do is configure both interfaces separately, giving them their
respective IP addresses and matching routes, and that's it.</P
><P
>It is quite useful to add information on the two interfaces to the
<TT
CLASS="FILENAME"
>hosts</TT
> file as shown in the following example, so
we have handy names for them, too:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>172.16.1.1      vlager.vbrew.com    vlager vlager-if1
172.16.2.1      vlager-if2</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The sequence of commands to set up the two interfaces is then:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ifconfig eth0 vlager-if1</KBD
>
# <KBD
CLASS="USERINPUT"
>route add brew-net</KBD
>
# <KBD
CLASS="USERINPUT"
>ifconfig eth1 vlager-if2</KBD
>
# <KBD
CLASS="USERINPUT"
>route add wine-net</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>If this sequence doesn't work, make sure your kernel has been compiled
with support for IP forwarding enabled. One good way to do this is to
ensure that the first number on the second line of
<TT
CLASS="FILENAME"
>/proc/net/snmp</TT
> is set to <TT
CLASS="LITERAL"
>1</TT
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IFACE.INTERFACE.PLIP"
>5.7.5. The PLIP Interface</A
></H3
><P
>A PLIP link used to connect two machines is a little different from an
Ethernet. PLIP links are an example of what are called
<EM
>point-to-point</EM
> links, meaning that there is a single
host at each end of the link. Networks like Ethernet are called
<EM
>broadcast</EM
> networks. Configuration of point-to-point links
is different because unlike broadcast networks, point-to-point links don't
support a network of their own.</P
><P
>PLIP provides very cheap and portable links between computers. As
an example, we'll consider the laptop computer of an employee at the Virtual
Brewery that is connected to <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>
via PLIP. The laptop itself is called
<SPAN
CLASS="SYSTEMITEM"
>vlite</SPAN
> and has only one parallel port.
At boot time, this port will be registered as <TT
CLASS="FILENAME"
>plip1</TT
>. To
activate the link, you have to configure the <TT
CLASS="FILENAME"
>plip1</TT
>
interface using the following commands:<A
NAME="X-087-2-FNTC07"
HREF="#FTN.X-087-2-FNTC07"
><SPAN
CLASS="footnote"
>[33]</SPAN
></A
>

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ifconfig plip1 vlite pointopoint vlager</KBD
>
# <KBD
CLASS="USERINPUT"
>route add default gw vlager</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The first command configures the interface, telling the kernel that this
is a point-to-point link, with the remote side having the address of
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>. The second installs the default
route, using <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> as gateway.  On
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>, a similar
<B
CLASS="COMMAND"
>ifconfig</B
> command is necessary to activate the link
(a <B
CLASS="COMMAND"
>route</B
> invocation is not needed):

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ifconfig plip1 vlager pointopoint vlite</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Note that the <TT
CLASS="FILENAME"
>plip1</TT
> interface on <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> does not need a separate IP
address, but may also be given the address <SPAN
CLASS="SYSTEMITEM"
>172.16.1.1</SPAN
>. Point-to-point networks don't
support a network directly, so the interfaces don't require an address
on any supported network. The kernel uses the interface information in
the routing table to avoid any possible confusion.<A
NAME="X-087-2-FNTC08"
HREF="#FTN.X-087-2-FNTC08"
><SPAN
CLASS="footnote"
>[34]</SPAN
></A
></P
><P
>&#13;Now we have configured routing from the laptop to the Brewery's
network; what's still missing is a way to route from any of the
Brewery's hosts to <SPAN
CLASS="SYSTEMITEM"
>vlite</SPAN
>. One
particularly cumbersome way is to add a specific route to every host's routing
table that names <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> as a gateway
to <SPAN
CLASS="SYSTEMITEM"
>vlite</SPAN
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>route add vlite gw vlager</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;




Dynamic routing offers a much better option for temporary routes. You
could use <B
CLASS="COMMAND"
>gated</B
>, a routing daemon, which you would
have to install on each host in the network in order to distribute
routing information dynamically.  The easiest option, however, is to
use <EM
>proxy ARP</EM
> (Address Resolution Protocol).
With proxy ARP, <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> will
respond to any ARP query for <SPAN
CLASS="SYSTEMITEM"
>vlite</SPAN
> by sending its own Ethernet
address. All packets for <SPAN
CLASS="SYSTEMITEM"
>vlite</SPAN
> will wind up at <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>, which then forwards them to the
laptop. We will come back to proxy ARP in the section <A
HREF="#X-087-2-IFACE.VERIFY.ARP"
>Section 5.10</A
>.&#8221;</P
><P
>&#13;Current <TT
CLASS="FILENAME"
>net-tools</TT
> releases contain a tool called
<B
CLASS="COMMAND"
>plipconfig</B
>, which allows you to set certain PLIP
timing parameters. The IRQ to be used for the printer port can be set using
the <B
CLASS="COMMAND"
>ifconfig</B
> command.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IFACE.INTERFACE.SLIP"
>5.7.6. The SLIP and PPP Interfaces</A
></H3
><P
>Although SLIP and PPP links are only simple point-to-point links like
PLIP connections, there is much more to be said about them.  Usually,
establishing a SLIP connection involves dialing up a remote site
through your modem and setting the serial line to SLIP mode. PPP is
used in a similar fashion. We discuss SLIP and PPP in detail in
<A
HREF="#X-087-2-SLIP"
>Chapter 7</A
> and <A
HREF="#X-087-2-PPP"
>Chapter 8</A
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IFACE.INTERFACE.DUMMY"
>5.7.7. The Dummy Interface</A
></H3
><P
>The dummy interface is a little exotic, but rather useful
nevertheless. Its main benefit is with standalone hosts and machines
whose only IP network connection is a dialup link. In fact, the
latter are standalone hosts most of the time, too.</P
><P
>The dilemma with standalone hosts is that they only have a single
network device active, the loopback device, which is usually assigned
the address <SPAN
CLASS="SYSTEMITEM"
>127.0.0.1</SPAN
>.  On
some occasions, however, you must send data to the
&#8220;official&#8221; IP address of the local host. For instance,
consider the laptop <SPAN
CLASS="SYSTEMITEM"
>vlite</SPAN
>,
which was disconnected from a network for the duration of this
example. An application on <SPAN
CLASS="SYSTEMITEM"
>vlite</SPAN
> may now want to send data to
another application on the same host. Looking up <SPAN
CLASS="SYSTEMITEM"
>vlite</SPAN
> in <TT
CLASS="FILENAME"
>/etc/hosts</TT
>
yields an IP address of <SPAN
CLASS="SYSTEMITEM"
>172.16.1.65</SPAN
>, so the application tries to
send to this address. As the loopback interface is currently the only
active interface on the machine, the kernel has no idea that
<SPAN
CLASS="SYSTEMITEM"
>172.16.1.65</SPAN
> actually refers
to itself&#8201;! Consequently, the kernel discards the datagram and returns
an error to the application.</P
><P
>This is where the dummy device steps in. It solves the dilemma by
simply serving as the alter ego of the loopback interface.  In the
case of <SPAN
CLASS="SYSTEMITEM"
>vlite</SPAN
>, you simply
give it the address <SPAN
CLASS="SYSTEMITEM"
>172.16.1.65</SPAN
> and add a host route pointing
to it. Every datagram for <SPAN
CLASS="SYSTEMITEM"
>172.16.1.65</SPAN
> is then delivered
locally. The proper invocation is:<A
NAME="X-087-2-FNTC09"
HREF="#FTN.X-087-2-FNTC09"
><SPAN
CLASS="footnote"
>[35]</SPAN
></A
>

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ifconfig dummy vlite</KBD
>
# <KBD
CLASS="USERINPUT"
>route add vlite</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IFACE.INTERFACE.ALIAS"
>5.7.8. IP Alias</A
></H3
><P
>New kernels support a feature that can completely replace the dummy
interface and serve other useful functions. <EM
>IP
Alias</EM
> allows you to configure multiple IP addresses onto a
physical device. In the simplest case, you could replicate the function
of the dummy interface by configuring the host address as an alias
onto the loopback interface and completely avoid using the dummy
interface. In more complex uses, you could configure your host to look
like many different hosts, each with its own IP address. This
configuration is sometimes called &#8220;Virtual Hosting,&#8221;
although technically it is also used for a variety of other
techniques.<A
NAME="X-087-2-FNTC10"
HREF="#FTN.X-087-2-FNTC10"
><SPAN
CLASS="footnote"
>[36]</SPAN
></A
></P
><P
>To configure an alias for an interface, you must first ensure that
your kernel has been compiled with support for IP Alias (check that
you have a <TT
CLASS="FILENAME"
>/proc/net/ip_alias</TT
> file; if not, you
will have to recompile your kernel). Configuration of an IP alias is
virtually identical to configuring a real network device; you use a
special name to indicate it's an alias that you want. For example:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ifconfig lo:0 172.16.1.1</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

This command would produce an alias for the loopback interface with
the address <TT
CLASS="LITERAL"
>172.16.1.1</TT
>. IP aliases are referred to
by appending :<TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
> to the actual
network device, in which &#8220;n&#8221; is an integer. In our example,
the network device we are creating the alias on is
<TT
CLASS="LITERAL"
>lo</TT
>, and we are creating an alias numbered zero for
it. This way, a single physical device may support a number of
aliases.</P
><P
>Each alias may be treated as though it is a separate device, and as
far as the kernel IP software is concerned, it will be; however, it
will be sharing its hardware with another interface.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IFACE.IFCONFIG"
>5.8. All About ifconfig</A
></H2
><P
>There are many more parameters to <B
CLASS="COMMAND"
>ifconfig</B
> than we
have described so far. Its normal invocation is this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ifconfig <TT
CLASS="REPLACEABLE"
><I
>interface</I
></TT
> [<TT
CLASS="REPLACEABLE"
><I
>address</I
></TT
> [<TT
CLASS="REPLACEABLE"
><I
>parameters</I
></TT
>]]</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
><TT
CLASS="REPLACEABLE"
><I
>interface</I
></TT
> is the interface name, and
<TT
CLASS="REPLACEABLE"
><I
>address</I
></TT
> is the IP address to be assigned to the
interface. This may be either an IP address in dotted quad notation or a
name that <B
CLASS="COMMAND"
>ifconfig</B
> will look up in
<TT
CLASS="FILENAME"
>/etc/hosts</TT
>.</P
><P
>&#13;If <B
CLASS="COMMAND"
>ifconfig</B
> is invoked with only the interface
name, it displays that interface's configuration. When invoked without
any parameters, it displays all interfaces you have configured so far;
a <CODE
CLASS="OPTION"
>&#8211;a</CODE
> option forces it to show the inactive ones
as well. A sample invocation for the Ethernet interface
<TT
CLASS="FILENAME"
>eth0</TT
> may look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ifconfig eth0</KBD
>
eth0      Link encap 10Mbps Ethernet  HWaddr 00:00:C0:90:B3:42
          inet addr 172.16.1.2 Bcast 172.16.1.255 Mask 255.255.255.0
          UP BROADCAST RUNNING  MTU 1500  Metric 0
          RX packets 3136 errors 217 dropped 7 overrun 26
          TX packets 1752 errors 25 dropped 0 overrun 0</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;
The <TT
CLASS="LITERAL"
>MTU</TT
> and <TT
CLASS="LITERAL"
>Metric</TT
> fields show the
current MTU and metric value for that interface. The metric value is
traditionally used by some operating systems to compute the cost of a route.
Linux doesn't use this value yet, but defines it for compatibility,
nevertheless.</P
><P
>The <TT
CLASS="LITERAL"
>RX</TT
> and <TT
CLASS="LITERAL"
>TX</TT
> lines show how
many packets have been received or transmitted error free, how many
errors occurred, how many packets were dropped (probably because of
low memory), and how many were lost because of an overrun. Receiver
overruns usually occur when packets come in faster than the kernel can
service the last interrupt. The flag values printed by
<B
CLASS="COMMAND"
>ifconfig</B
> roughly correspond to the names of its
command-line options; they will be explained later.</P
><P
>The following is a list of parameters recognized by <B
CLASS="COMMAND"
>ifconfig</B
>
with the corresponding flag names. Options that simply turn on a feature also
allow it to be turned off again by preceding the option name by a
dash (&#8211;).</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>up</TT
></DT
><DD
><P
>This option makes an interface accessible to the IP layer. This option
is implied when an <TT
CLASS="REPLACEABLE"
><I
>address</I
></TT
> is given on the
command line. It may also be used to reenable an interface that has
been taken down temporarily using the <TT
CLASS="LITERAL"
>down</TT
> option.</P
><P
>This option corresponds to the flags <CODE
CLASS="OPTION"
>UP</CODE
> and
<CODE
CLASS="OPTION"
>RUNNING</CODE
>.</P
></DD
><DT
><TT
CLASS="LITERAL"
>down</TT
></DT
><DD
><P
>This option marks an interface inaccessible to the IP layer. This
effectively disables any IP traffic through the interface. Note that
this option will also automatically delete all routing entries that
use this interface.</P
></DD
><DT
><TT
CLASS="LITERAL"
>netmask</TT
> <TT
CLASS="REPLACEABLE"
><I
>mask</I
></TT
></DT
><DD
><P
>&#13;
This option assigns a subnet mask to be used by the interface. It may
be given as either a 32-bit hexadecimal number preceded by 0x, or as a
dotted quad of decimal numbers. While the dotted quad format is more
common, the hexadecimal representation is often easier to work
with. Netmasks are essentially binary, and it is easier to do
binary-to-hexadecimal than binary-to-decimal conversion.</P
></DD
><DT
><TT
CLASS="LITERAL"
>pointopoint</TT
> <TT
CLASS="REPLACEABLE"
><I
>address</I
></TT
></DT
><DD
><P
> This option is
used for point-to-point IP links that involve only two hosts. This option is
needed to configure SLIP or PLIP interfaces, for example. If a point-to-point address has been set, <B
CLASS="COMMAND"
>ifconfig</B
> displays
the <CODE
CLASS="OPTION"
>POINTOPOINT</CODE
> flag.</P
></DD
><DT
><TT
CLASS="LITERAL"
>broadcast</TT
>
<TT
CLASS="REPLACEABLE"
><I
>address</I
></TT
></DT
><DD
><P
>&#13;

The broadcast address is usually made up from the network number by
setting all bits of the host part. Some IP implementations (systems
derived from BSD 4.2, for instance) use a different scheme in which
all host part bits are cleared instead. The
<CODE
CLASS="OPTION"
>broadcast</CODE
> option adapts to these strange
environments. If a broadcast address has been set, <B
CLASS="COMMAND"
>ifconfig</B
> displays the <CODE
CLASS="OPTION"
>BROADCAST</CODE
> flag.</P
></DD
><DT
><TT
CLASS="LITERAL"
>irq</TT
></DT
><DD
><P
>&#13;
This option allows you to set the IRQ line used by certain devices. This is
especially useful for PLIP, but may also be useful for certain Ethernet cards.</P
></DD
><DT
><TT
CLASS="LITERAL"
>metric</TT
> <TT
CLASS="REPLACEABLE"
><I
>number</I
></TT
></DT
><DD
><P
>&#13;


This option may be used to assign a metric value to the routing table entry
created for the interface. This metric is used by the Routing Information
Protocol (RIP) to build routing tables for the
network.<A
NAME="X-087-2-FNTC11"
HREF="#FTN.X-087-2-FNTC11"
><SPAN
CLASS="footnote"
>[37]</SPAN
></A
>

The default metric used by <B
CLASS="COMMAND"
>ifconfig</B
> is zero. If
you don't run a RIP daemon, you don't need this option at all; if you do, you
will rarely need to change the metric value.</P
></DD
><DT
><TT
CLASS="LITERAL"
>mtu</TT
> <TT
CLASS="REPLACEABLE"
><I
>bytes</I
></TT
></DT
><DD
><P
>&#13;This sets the Maximum Transmission Unit, which is the maximum number of octets
the interface is able to handle in one transaction. For Ethernets, the MTU
defaults to 1,500 (the largest allowable size of an Ethernet packet); for SLIP
interfaces, it is 296. (There is no constraint on the MTU of SLIP links; this
value is a good compromise.)</P
></DD
><DT
><TT
CLASS="LITERAL"
>arp</TT
></DT
><DD
><P
>&#13;This is an option specific to broadcast networks such as Ethernets or packet
radio. It enables the use of the Address Resolution Protocol (ARP) to detect
the physical addresses of hosts attached to the network. For broadcast
networks, it is on by default. If ARP is disabled, <B
CLASS="COMMAND"
>ifconfig</B
> displays the <CODE
CLASS="OPTION"
>NOARP</CODE
> flag.</P
></DD
><DT
><TT
CLASS="LITERAL"
>&#8211;arp</TT
></DT
><DD
><P
>This option disables the use of ARP on this interface.</P
></DD
><DT
><TT
CLASS="LITERAL"
>promisc</TT
></DT
><DD
><P
>&#13;
This option puts the interface in promiscuous mode. On a broadcast
network, this makes the interface receive all packets, regardless of
whether they were destined for this host or not. This allows network
traffic analysis using packet filters and such, also called
<EM
>Ethernet snooping</EM
>. Usually, this is a good
technique for hunting down network problems that are otherwise hard to
detect. Tools such as <B
CLASS="COMMAND"
>tcpdump</B
> rely on this.</P
><P
>On the other hand, this option allows attackers to do nasty things,
such as skim the traffic of your network for passwords. You can
protect against this type of attack by prohibiting just anyone from
plugging their computers into your Ethernet. You could also use
secure authentication protocols, such as Kerberos or the secure shell
login suite.<A
NAME="X-087-2-FNTC12"
HREF="#FTN.X-087-2-FNTC12"
><SPAN
CLASS="footnote"
>[38]</SPAN
></A
> This option corresponds to the <CODE
CLASS="OPTION"
>PROMISC</CODE
> flag.</P
></DD
><DT
><TT
CLASS="LITERAL"
>&#8211;promisc</TT
></DT
><DD
><P
>This option turns promiscuous mode off.</P
></DD
><DT
><TT
CLASS="LITERAL"
>allmulti</TT
></DT
><DD
><P
>&#13;Multicast addresses are like Ethernet broadcast addresses, except that
instead of automatically including everybody, the only people who
receive packets sent to a multicast address are those programmed to
listen to it. This is useful for applications like Ethernet-based
videoconferencing or network audio, to which only those interested can
listen. Multicast addressing is supported by most, but not all,
Ethernet drivers. When this option is enabled, the interface receives
and passes multicast packets for processing. This option corresponds to the <CODE
CLASS="OPTION"
>ALLMULTI</CODE
> flag.</P
></DD
><DT
><TT
CLASS="LITERAL"
>&#8211;allmulti</TT
></DT
><DD
><P
>This option turns multicast addresses off.</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IFACE.NETSTAT"
>5.9. The netstat Command</A
></H2
><P
><B
CLASS="COMMAND"
>netstat</B
> is a useful tool for checking your network
configuration and activity. It is in fact a collection of several
tools lumped together. We discuss each of its functions in the
following sections.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IFACE.NETSTAT.-R"
>5.9.1. Displaying the Routing Table</A
></H3
><P
>When you invoke <B
CLASS="COMMAND"
>netstat</B
> with the
<CODE
CLASS="OPTION"
>&#8211;r</CODE
> flag, it displays the kernel routing table
in the way we've been doing with <B
CLASS="COMMAND"
>route</B
>. On
<SPAN
CLASS="SYSTEMITEM"
>vstout</SPAN
>, it produces:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>netstat -nr</KBD
>
Kernel IP routing table
Destination   Gateway      Genmask         Flags  MSS Window  irtt Iface
127.0.0.1     *            255.255.255.255 UH       0 0          0 lo
172.16.1.0    *            255.255.255.0   U        0 0          0 eth0
172.16.2.0    172.16.1.1   255.255.255.0   UG       0 0          0 eth0</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <CODE
CLASS="OPTION"
>&#8211;n</CODE
> option makes <B
CLASS="COMMAND"
>netstat</B
>
print addresses as dotted quad IP numbers rather than the symbolic
host and network names. This option is especially useful when you want
to avoid address lookups over the network (e.g., to a DNS or NIS
server).</P
><P
>The second column of <B
CLASS="COMMAND"
>netstat</B
>&#8201;'s output shows
the gateway to which the routing entry points. If no gateway is used,
an asterisk is printed instead. The third column shows the
&#8220;generality&#8221; of the route, i.e., the network mask for this
route. When given an IP address to find a suitable route for, the
kernel steps through each of the routing table entries, taking the
bitwise AND of the address and the genmask before comparing it to the
target of the route.</P
><P
>The fourth column displays the following flags that describe the route:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>G</TT
></DT
><DD
><P
>The route uses a gateway.</P
></DD
><DT
><TT
CLASS="LITERAL"
>U</TT
></DT
><DD
><P
>The interface to be used is up.</P
></DD
><DT
><TT
CLASS="LITERAL"
>H</TT
></DT
><DD
><P
>Only a single host can be reached through the route. For example, this is the
case for the loopback entry <SPAN
CLASS="SYSTEMITEM"
>127.0.0.1</SPAN
>.</P
></DD
><DT
><TT
CLASS="LITERAL"
>D</TT
></DT
><DD
><P
> This
route is dynamically created. It is set if the table entry has been
generated by a routing daemon like <B
CLASS="COMMAND"
>gated</B
> or by an
ICMP redirect message (see the section <A
HREF="#X-087-2-ISSUES.ICMP"
>Section 2.5</A
>&#8221; in Chapter 2).</P
></DD
><DT
><TT
CLASS="LITERAL"
>M</TT
></DT
><DD
><P
> This
route is set if the table entry was modified by an ICMP redirect
message.</P
></DD
><DT
><TT
CLASS="LITERAL"
>!</TT
></DT
><DD
><P
>The route is a reject route and datagrams will be dropped.</P
></DD
></DL
></DIV
></P
><P
>&#13;
The next three columns show the MSS, Window and irtt that will be
applied to TCP connections established via this route. The MSS is the
Maximum Segment Size and is the size of the largest datagram the
kernel will construct for transmission via this route. The Window is
the maximum amount of data the system will accept in a single burst
from a remote host. The acronym <TT
CLASS="LITERAL"
>irtt</TT
> stands for
&#8220;initial round trip time.&#8221; The TCP protocol ensures that
data is reliably delivered between hosts by retransmitting a datagram
if it has been lost.  The TCP protocol keeps a running count of how
long it takes for a datagram to be delivered to the remote end, and an
acknowledgement to be received so that it knows how long to wait
before assuming a datagram needs to retransmitted; this process is
called the round-trip time. The initial round-trip time is the value
that the TCP protocol will use when a connection is first
established. For most network types, the default value is okay, but
for some slow networks, notably certain types of amateur packet radio
networks, the time is too short and causes unnecessary
retransmission. The <TT
CLASS="LITERAL"
>irtt</TT
> value can be set using the
<B
CLASS="COMMAND"
>route</B
> command. Values of zero in these fields mean
that the default is being used.</P
><P
>Finally, the last field displays the network interface that this route
will use.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IFACE.NETSTAT.-I"
>5.9.2. Displaying Interface Statistics</A
></H3
><P
>When invoked with the <CODE
CLASS="OPTION"
>&#8211;i</CODE
> flag,
<B
CLASS="COMMAND"
>netstat</B
> displays statistics for the network
interfaces currently configured. If the <CODE
CLASS="OPTION"
>&#8211;a</CODE
>
option is also given, it prints <EM
>all</EM
> interfaces
present in the kernel, not only those that have been configured
currently. On <SPAN
CLASS="SYSTEMITEM"
>vstout</SPAN
>, the
output from <B
CLASS="COMMAND"
>netstat</B
> will look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>netstat -i</KBD
>
Kernel Interface table
Iface MTU Met  RX-OK RX-ERR RX-DRP RX-OVR  TX-OK TX-ERR TX-DRP TX-OVR Flags
lo      0   0   3185      0      0      0   3185      0      0      0 BLRU
eth0 1500   0 972633     17     20    120 628711    217      0      0 BRU</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <TT
CLASS="LITERAL"
>MTU</TT
> and <TT
CLASS="LITERAL"
>Met</TT
> fields show the
current MTU and metric values for that interface. The
<TT
CLASS="LITERAL"
>RX</TT
> and <TT
CLASS="LITERAL"
>TX</TT
> columns show how many
packets have been received or transmitted error-free
(<TT
CLASS="LITERAL"
>RX-OK</TT
>/<TT
CLASS="LITERAL"
>TX-OK</TT
>) or damaged
(<TT
CLASS="LITERAL"
>RX-ERR</TT
>/<TT
CLASS="LITERAL"
>TX-ERR</TT
>); how many were
dropped (<TT
CLASS="LITERAL"
>RX-DRP</TT
>/<TT
CLASS="LITERAL"
>TX-DRP</TT
>); and how
many were lost because of an overrun
(<TT
CLASS="LITERAL"
>RX-OVR</TT
>/<TT
CLASS="LITERAL"
>TX-OVR</TT
>).</P
><P
>The last column shows the flags that have been set for this interface.
These characters are one-character versions of the long flag names
that are printed when you display the interface configuration with
<B
CLASS="COMMAND"
>ifconfig</B
>:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>B</TT
></DT
><DD
><P
>A broadcast address has been set.</P
></DD
><DT
><TT
CLASS="LITERAL"
>L</TT
></DT
><DD
><P
>This interface is a loopback device.</P
></DD
><DT
><TT
CLASS="LITERAL"
>M</TT
></DT
><DD
><P
>All packets are received (promiscuous mode).</P
></DD
><DT
><TT
CLASS="LITERAL"
>O</TT
></DT
><DD
><P
>ARP is turned off for this interface.</P
></DD
><DT
><TT
CLASS="LITERAL"
>P</TT
></DT
><DD
><P
>This is a point-to-point connection.</P
></DD
><DT
><TT
CLASS="LITERAL"
>R</TT
></DT
><DD
><P
>Interface is running.</P
></DD
><DT
><TT
CLASS="LITERAL"
>U</TT
></DT
><DD
><P
>Interface is up.</P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IFACE.NETSTAT.-T-U-X"
>5.9.3. Displaying Connections</A
></H3
><P
><B
CLASS="COMMAND"
>netstat</B
> supports a set of options to display active
or passive sockets. The options <CODE
CLASS="OPTION"
>&#8211;t</CODE
>,
<CODE
CLASS="OPTION"
>&#8211;u</CODE
>, <CODE
CLASS="OPTION"
>&#8211;w</CODE
>, and
<CODE
CLASS="OPTION"
>&#8211;x</CODE
> show active TCP, UDP, RAW, or Unix socket
connections. If you provide the <CODE
CLASS="OPTION"
>&#8211;a</CODE
> flag in
addition, sockets that are waiting for a connection (i.e., listening)
are displayed as well. This display will give you a list of all
servers that are currently running on your system.</P
><P
>Invoking <B
CLASS="COMMAND"
>netstat -ta</B
> on
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> produces this output:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>netstat -ta</KBD
>
Active Internet Connections
Proto Recv-Q Send-Q Local Address    Foreign Address    (State)
tcp        0      0 *:domain         *:*                LISTEN  
tcp        0      0 *:time           *:*                LISTEN  
tcp        0      0 *:smtp           *:*                LISTEN  
tcp        0      0 vlager:smtp      vstout:1040        ESTABLISHED  
tcp        0      0 *:telnet         *:*                LISTEN  
tcp        0      0 localhost:1046   vbardolino:telnet  ESTABLISHED  
tcp        0      0 *:chargen        *:*                LISTEN  
tcp        0      0 *:daytime        *:*                LISTEN  
tcp        0      0 *:discard        *:*                LISTEN  
tcp        0      0 *:echo           *:*                LISTEN  
tcp        0      0 *:shell          *:*                LISTEN  
tcp        0      0 *:login          *:*                LISTEN  </PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This output shows most servers simply waiting for an incoming
connection. However, the fourth line shows an incoming SMTP connection
from <SPAN
CLASS="SYSTEMITEM"
>vstout</SPAN
>, and the sixth
line tells you there is an outgoing <B
CLASS="COMMAND"
>telnet</B
>
connection to <SPAN
CLASS="SYSTEMITEM"
>vbardolino</SPAN
>.<A
NAME="X-087-2-FNTC13"
HREF="#FTN.X-087-2-FNTC13"
><SPAN
CLASS="footnote"
>[39]</SPAN
></A
>&#13;</P
><P
>Using the <CODE
CLASS="OPTION"
>&#8211;a</CODE
> flag by itself will display all
sockets from all families.</P
><P
></P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IFACE.VERIFY.ARP"
>5.10. Checking the ARP Tables</A
></H2
><P
>On some occasions, it is useful to view or alter the contents of the
kernel's ARP tables, for example when you suspect a duplicate Internet
address is the cause for some intermittent network problem.  The
<B
CLASS="COMMAND"
>arp</B
> tool was made for situations like this.  Its
command-line options are:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>arp [-v] [-t <TT
CLASS="REPLACEABLE"
><I
>hwtype</I
></TT
>] -a [<TT
CLASS="REPLACEABLE"
><I
>hostname</I
></TT
>]
arp [-v] [-t <TT
CLASS="REPLACEABLE"
><I
>hwtype</I
></TT
>] -s <TT
CLASS="REPLACEABLE"
><I
>hostname</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>hwaddr</I
></TT
>
arp [-v] -d <TT
CLASS="REPLACEABLE"
><I
>hostname</I
></TT
> [<TT
CLASS="REPLACEABLE"
><I
>hostname</I
></TT
>&#8230;]</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>All <TT
CLASS="REPLACEABLE"
><I
>hostname</I
></TT
> arguments may be either symbolic
hostnames or IP addresses in dotted quad notation.</P
><P
>The first invocation displays the ARP entry for the IP address or host
specified, or all hosts known if no <TT
CLASS="REPLACEABLE"
><I
>hostname</I
></TT
> is
given.  For example, invoking <B
CLASS="COMMAND"
>arp</B
> on
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> may yield:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>arp -a</KBD
>
IP address      HW type                 HW address
172.16.1.3      10Mbps Ethernet         00:00:C0:5A:42:C1
172.16.1.2      10Mbps Ethernet         00:00:C0:90:B3:42
172.16.2.4      10Mbps Ethernet         00:00:C0:04:69:AA</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>which shows the Ethernet addresses of
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>vstout</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>vale</SPAN
>.</P
><P
>You can limit the display to the hardware type specified using the
<CODE
CLASS="OPTION"
>&#8211;t</CODE
> option.  This may be <SPAN
CLASS="SYSTEMITEM"
>ether</SPAN
>, <SPAN
CLASS="SYSTEMITEM"
>ax25</SPAN
>, or <SPAN
CLASS="SYSTEMITEM"
>pronet</SPAN
>, standing for 10 Mbps Ethernet;
AMPR AX.25, and IEEE 802.5 token ring equipment, respectively.</P
><P
>The <CODE
CLASS="OPTION"
>&#8211;s</CODE
> option is used to permanently add
<TT
CLASS="REPLACEABLE"
><I
>hostname</I
></TT
>'s Ethernet address to the ARP
tables. The <TT
CLASS="REPLACEABLE"
><I
>hwaddr</I
></TT
> argument specifies the
hardware address, which is by default expected to be an Ethernet
address specified as six hexadecimal bytes separated by colons. You
may also set the hardware address for other types of hardware, using
the <CODE
CLASS="OPTION"
>&#8211;t</CODE
> option.</P
><P
>For some reason, ARP queries for the remote host sometimes fail, for
instance when its ARP driver is buggy or there is another host in the
network that erroneously identifies itself with that host's IP
address; this problem requires you to manually add an IP address to
the ARP table.  Hard-wiring IP addresses in the ARP table is also a
(very drastic) measure to protect yourself from hosts on your Ethernet
that pose as someone else.</P
><P
>Invoking <B
CLASS="COMMAND"
>arp</B
> using the <CODE
CLASS="OPTION"
>&#8211;d</CODE
>
switch deletes all ARP entries relating to the given host. This switch
may be used to force the interface to re-attempt obtaining the
Ethernet address for the IP address in question. This is useful when a
misconfigured system has broadcasted wrong ARP information (of course,
you have to reconfigure the broken host first).</P
><P
>&#13;






The <CODE
CLASS="OPTION"
>&#8211;s</CODE
> option may also be used to implement
<EM
>proxy</EM
> ARP. This is a special technique through
which a host, say <SPAN
CLASS="SYSTEMITEM"
>gate</SPAN
>, acts
as a gateway to another host named <SPAN
CLASS="SYSTEMITEM"
>fnord</SPAN
> by pretending that both addresses
refer to the same host, namely <SPAN
CLASS="SYSTEMITEM"
>gate</SPAN
>. It does so by publishing an ARP
entry for <SPAN
CLASS="SYSTEMITEM"
>fnord</SPAN
> that points
to its own Ethernet interface. Now when a host sends out an ARP query
for <SPAN
CLASS="SYSTEMITEM"
>fnord</SPAN
>, <SPAN
CLASS="SYSTEMITEM"
>gate</SPAN
> will return a reply containing its
own Ethernet address. The querying host will then send all datagrams
to <SPAN
CLASS="SYSTEMITEM"
>gate</SPAN
>, which dutifully
forwards them to <SPAN
CLASS="SYSTEMITEM"
>fnord</SPAN
>.</P
><P
>These contortions may be necessary when you want to access <SPAN
CLASS="SYSTEMITEM"
>fnord</SPAN
> from a DOS machine with a broken
TCP implementation that doesn't understand routing too well. When you
use proxy ARP, it will appear to the DOS machine as if <SPAN
CLASS="SYSTEMITEM"
>fnord</SPAN
> was on the local subnet, so it
doesn't have to know about how to route through a gateway.</P
><P
>Another useful application of proxy ARP is when one of your hosts acts
as a gateway to some other host only temporarily, for instance,
through a dial-up link. In a previous example, we encountered the
laptop <SPAN
CLASS="SYSTEMITEM"
>vlite</SPAN
>, which was
connected to <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> through a
PLIP link from time to time. Of course, this application will work
only if the address of the host you want to provide proxy ARP for is
on the same IP subnet as your gateway. <SPAN
CLASS="SYSTEMITEM"
>vstout</SPAN
> could proxy ARP for any host on
the Brewery subnet (<SPAN
CLASS="SYSTEMITEM"
>172.16.1.0</SPAN
>), but never for a host on the
Winery subnet (<SPAN
CLASS="SYSTEMITEM"
>172.16.2.0</SPAN
>).</P
><P
>The proper invocation to provide proxy ARP for <SPAN
CLASS="SYSTEMITEM"
>fnord</SPAN
> is given below; of course, the
given Ethernet address must be that of <SPAN
CLASS="SYSTEMITEM"
>gate</SPAN
>:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># arp -s fnord 00:00:c0:a1:42:e0 pub</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The proxy ARP entry may be removed again by invoking:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># arp -d fnord</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-RESOLV"
></A
>Chapter 6. Name Service and Resolver Configuration</H1
><P
>As we discussed in <A
HREF="#X-087-2-ISSUES"
>Chapter 2</A
>, TCP/IP networking
may rely on different schemes to convert names into addresses. The
simplest way is a host table stored in
<TT
CLASS="FILENAME"
>/etc/hosts</TT
>. This is useful only for small LANs
that are run by one single administrator and otherwise have no IP
traffic with the outside world. The format of the
<TT
CLASS="FILENAME"
>hosts</TT
> file has already been described in <A
HREF="#X-087-2-IFACE"
>Chapter 5</A
>.</P
><P
>  Alternatively, you can use the
<EM
>Berkeley Internet Name Domain service</EM
> (BIND) for
resolving hostnames to IP addresses. Configuring BIND can be a real
chore, but once you've done it, you can easily make changes in the
network topology. On Linux, as on many other Unixish systems, name
service is provided through a program called
<B
CLASS="COMMAND"
>named</B
>. At startup, it loads a set of master files
into its internal cache and waits for queries from remote or local
user processes. There are different ways to set up BIND, and not all
require you to run a name server on every host.</P
><P
>&#13;This chapter can do little more than give a rough sketch of how DNS
works and how to operate a name server. It should be sufficient if you
have a small LAN and an Internet uplink. For the most current
information, you may want to check the documentation contained in the
BIND source package, which supplies manual pages, release notes, and
the <EM
>BIND Operator's Guide</EM
> (BOG). Don't let this
name scare you off; it's actually a very useful document. For a more
comprehensive coverage of DNS and associated issues, you may find
<EM
>DNS and BIND</EM
> by Paul Albitz and Cricket Liu
(O'Reilly) a useful reference. DNS questions may be answered in a
newsgroup called <SPAN
CLASS="SYSTEMITEM"
>comp.protocols.tcp-ip.domains</SPAN
>. For
technical details, the Domain Name System is defined by RFC numbers
1033, 1034, and 1035.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-RESOLV.LIBRARY"
>6.1. The Resolver Library</A
></H2
><P
>The term <EM
>resolver</EM
> refers not to a special
application, but to the resolver library. This is a collection of
functions that can be found in the standard C library. The central
routines are <CODE
CLASS="FUNCTION"
>gethostbyname(2)</CODE
> and
<CODE
CLASS="FUNCTION"
>gethostbyaddr&#8201;(2)</CODE
>, which look up all IP addresses
associated with a host name, and vice versa. They may be configured to
simply look up the information in <TT
CLASS="FILENAME"
>hosts</TT
>, to query
a number of DNS name servers, or to use the <EM
>hosts</EM
>
database of Network Information Service (NIS).</P
><P
>The resolver functions read configuration files when they are
invoked. From these configuration files, they determine what databases
to query, in which order, and other details relevant to how you've
configured your environment.  The older Linux standard library, libc,
used <TT
CLASS="FILENAME"
>/etc/host.conf</TT
> as its master configuration
file, but Version 2 of the GNU standard library, glibc, uses
<TT
CLASS="FILENAME"
>/etc/nsswitch.conf</TT
>. We'll describe each in turn,
since both are commonly used.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-RESOLV.HOST-CONF"
>6.1.1. The host.conf File</A
></H3
><P
>The <TT
CLASS="FILENAME"
>/etc/host.conf</TT
> tells the older Linux standard library
resolver functions which services to use, and in what order.</P
><P
>Options in <TT
CLASS="FILENAME"
>host.conf</TT
> must appear on separate lines.
Fields may be separated by white space (spaces or tabs). A hash sign
(<SPAN
CLASS="SYSTEMITEM"
>#</SPAN
>) introduces a comment that extends
to the next newline. The following options are available:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>order</SPAN
></DT
><DD
><P
> This
option determines the order in which the resolving services are
tried. Valid options are <SPAN
CLASS="SYSTEMITEM"
>bind</SPAN
>
for querying the name server, <TT
CLASS="FILENAME"
>hosts</TT
> for lookups
in <TT
CLASS="FILENAME"
>/etc/hosts</TT
>, and <SPAN
CLASS="SYSTEMITEM"
>nis</SPAN
> for NIS lookups. Any or all of them
may be specified. The order in which they appear on the line
determines the order in which the respective services are tried.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>multi</SPAN
></DT
><DD
><P
><TT
CLASS="LITERAL"
>multi</TT
> takes <SPAN
CLASS="SYSTEMITEM"
>on</SPAN
> or
<SPAN
CLASS="SYSTEMITEM"
>off</SPAN
> as options. This determines if a
host in <TT
CLASS="FILENAME"
>/etc/hosts</TT
> is allowed to have several IP
addresses, which is usually referred to as being &#8220;multi-homed.&#8221;
The default is off. This flag has no effect on DNS or NIS queries.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>nospoof</SPAN
></DT
><DD
><P
>&#13;


As we'll explain in the section <A
HREF="#X-087-2-RESOLV.DNS.IN-ADDR"
>Section 6.2.4</A
>,&#8221; DNS allows you to find the
hostname belonging to an IP address by using the <SPAN
CLASS="SYSTEMITEM"
>in-addr.arpa</SPAN
> domain. Attempts by name
servers to supply a false hostname are called
<EM
>spoofing</EM
>. To guard against this, the resolver can
be configured to check whether the original IP address is in fact
associated with the obtained hostname. If not, the name is rejected
and an error is returned. This behavior is turned on by setting
<SPAN
CLASS="SYSTEMITEM"
>nospoof</SPAN
> on.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>alert</SPAN
></DT
><DD
><P
>This option takes <SPAN
CLASS="SYSTEMITEM"
>on</SPAN
> or
<SPAN
CLASS="SYSTEMITEM"
>off</SPAN
> as arguments. If it is turned on,
any spoof attempts will cause the resolver to log a message to the
<B
CLASS="COMMAND"
>syslog</B
> facility.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>trim</SPAN
></DT
><DD
><P
>This option takes an argument specifying a domain name that will be
removed from hostnames before lookup. This is useful for
<TT
CLASS="FILENAME"
>hosts</TT
> entries, for which you might only want to
specify hostnames without a local domain. If you specify your local
domain name here, it will be removed from a lookup of a host with the
local domain name appended, thus allowing the lookup in
<TT
CLASS="FILENAME"
>/etc/hosts</TT
> to succeed. The domain name you add
must end with the (.) character (e.g.,
:<TT
CLASS="LITERAL"
>linux.org.au.</TT
>) if <TT
CLASS="LITERAL"
>trim</TT
> is to
work correctly.</P
><P
><SPAN
CLASS="SYSTEMITEM"
>trim</SPAN
> options accumulate; you
can consider your host as being local to several domains.</P
></DD
></DL
></DIV
></P
><P
>A sample file for <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> is shown in
<A
HREF="#X-087-2-DNS-HOST.CONF.FILE"
>Example 6-1</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-DNS-HOST.CONF.FILE"
></A
><P
><B
>Example 6-1. Sample host.conf File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/host.conf
# We have named running, but no NIS (yet)
order   bind,hosts
# Allow multiple addrs
multi   on
# Guard against spoof attempts
nospoof on
# Trim local domain (not really necessary).
trim    vbrew.com.</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-RESOLV.ENVIRON"
>6.1.1.1. Resolver environment variables</A
></H4
><P
>The settings from <TT
CLASS="FILENAME"
>host.conf</TT
> may be overridden using a
number of environment variables:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>RESOLV_HOST_CONF</SPAN
></DT
><DD
><P
>&#13;This variable specifies a file to be read instead of
<TT
CLASS="FILENAME"
>/etc/host.conf</TT
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>RESOLV_SERV_ORDER</SPAN
></DT
><DD
><P
>&#13;This variable overrides the <SPAN
CLASS="SYSTEMITEM"
>order</SPAN
> option given in
<TT
CLASS="FILENAME"
>host.conf</TT
>. Services are given as <SPAN
CLASS="SYSTEMITEM"
>hosts</SPAN
>, <SPAN
CLASS="SYSTEMITEM"
>bind</SPAN
>, and <SPAN
CLASS="SYSTEMITEM"
>nis</SPAN
>, separated by a space, comma, colon,
or semicolon.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>RESOLV_SPOOF_CHECK</SPAN
></DT
><DD
><P
>&#13;This variable determines the measures taken against spoofing. It is
completely disabled by <SPAN
CLASS="SYSTEMITEM"
>off</SPAN
>.
The values <SPAN
CLASS="SYSTEMITEM"
>warn</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>warn off</SPAN
> enable spoof
checking by turning logging on and off, respectively. A value of
<SPAN
CLASS="SYSTEMITEM"
>*</SPAN
> turns on spoof checks, but
leaves the logging facility as defined in
<TT
CLASS="FILENAME"
>host.conf</TT
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>RESOLV_MULTI</SPAN
></DT
><DD
><P
> 
This variable uses a value of <SPAN
CLASS="SYSTEMITEM"
>on</SPAN
> or <SPAN
CLASS="SYSTEMITEM"
>off</SPAN
> to override the <SPAN
CLASS="SYSTEMITEM"
>multi</SPAN
> options from
<TT
CLASS="FILENAME"
>host.conf</TT
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>RESOLV_OVERRIDE_TRIM_DOMAINS</SPAN
></DT
><DD
><P
> 
This variable specifies a list of trim domains that override those
given in <TT
CLASS="FILENAME"
>host.conf</TT
>.  Trim domains were explained
earlier when we discussed the <SPAN
CLASS="SYSTEMITEM"
>trim</SPAN
> keyword.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>RESOLV_ADD_TRIM_DOMAINS</SPAN
></DT
><DD
><P
> 
This variable specifies a list of trim domains that are added to those
given in <TT
CLASS="FILENAME"
>host.conf</TT
>.</P
></DD
></DL
></DIV
></P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-RESOLV.NSSWITCH-CONF"
>6.1.2. The nsswitch.conf File</A
></H3
><P
>Version 2 of the GNU standard library includes a more powerful and
flexible replacement for the older <TT
CLASS="FILENAME"
>host.conf</TT
>
mechanism. The concept of the name service has been extended to
include a variety of different types of information. Configuration
options for all of the different functions that query these databases
have been brought back into a single configuration file; the
<TT
CLASS="FILENAME"
>nsswitch.conf</TT
> file.</P
><P
>The <TT
CLASS="FILENAME"
>nsswitch.conf</TT
> file allows the system
administrator to configure a wide variety of different
databases. We'll limit our discussion to options that relate to host
and network IP address resolution. You can easily find more
information about the other features by reading the GNU standard
library documentation.</P
><P
>Options in <TT
CLASS="FILENAME"
>nsswitch.conf</TT
> must appear on separate
lines.  Fields may be separated by whitespace (spaces or tabs). A hash
sign (<SPAN
CLASS="SYSTEMITEM"
>#</SPAN
>) introduces a comment
that extends to the next newline. Each line describes a particular
service; hostname resolution is one of these. The first field in each
line is the name of the database, ending with a colon. The database
name associated with host address resolution is <SPAN
CLASS="SYSTEMITEM"
>hosts</SPAN
>. A related database is <SPAN
CLASS="SYSTEMITEM"
>networks</SPAN
>, which is used for resolution of
network names into network addresses. The remainder of each line
stores options that determine the way lookups for that database
are performed.</P
><P
>The following options are available:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>dns</SPAN
></DT
><DD
><P
>&#13;Use the Domain Name System (DNS) service to resolve the address. This makes
sense only for host address resolution, not network address
resolution. This mechanism uses the
<TT
CLASS="FILENAME"
>/etc/resolv.conf</TT
> file that we'll describe later
in the chapter. </P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>files</SPAN
></DT
><DD
><P
>Search a local file for the host or network name and its corresponding address.
This option uses the traditional <TT
CLASS="FILENAME"
>/etc/hosts</TT
> and
<TT
CLASS="FILENAME"
>/etc/network</TT
> files.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>nis</SPAN
> or <SPAN
CLASS="SYSTEMITEM"
>nisplus</SPAN
></DT
><DD
><P
>&#13;Use the Network Information System (NIS) to resolve the host or
network address.  NIS and NIS+ are discussed in detail in <A
HREF="#X-087-2-NIS"
>Chapter 13</A
>.</P
></DD
></DL
></DIV
></P
><P
>The order in which the services to be queried are listed determines the
order in which they are queried when attempting to resolve a name.
The query-order list is in the service description in the
<TT
CLASS="FILENAME"
>/etc/nsswitch.conf</TT
> file. The services are queried
from left to right and by default searching stops when a resolution is
successful.</P
><P
>A simple example of host and network database specification that would
mimic our configuration using the older libc standard library is shown
in <A
HREF="#X-087-2-DNS-NSSWITCH.CONF.FILE"
>Example 6-2</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-DNS-NSSWITCH.CONF.FILE"
></A
><P
><B
>Example 6-2. Sample nsswitch.conf File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/nsswitch.conf
#
# Example configuration of GNU Name Service Switch functionality.
# Information about this file is available in the `libc6-doc' package.

hosts:          dns files
networks:       files&#13;</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>This example causes the system to look up hosts first in the Domain
Name System, and the <TT
CLASS="FILENAME"
>/etc/hosts</TT
> file, if that
can't find them. Network name lookups would be attempted using only
the <TT
CLASS="FILENAME"
>/etc/networks</TT
> file.</P
><P
> You are able to control the lookup
behavior more precisely using &#8220;action items&#8221; that describe
what action to take given the result of the previous lookup
attempt. Action items appear between service specifications, and are
enclosed within square brackets, <SPAN
CLASS="SYSTEMITEM"
>[
]</SPAN
>. The general syntax of the action statement is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>[ [!] <TT
CLASS="REPLACEABLE"
><I
>status</I
></TT
> = <TT
CLASS="REPLACEABLE"
><I
>action</I
></TT
> ... ]</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>There are two possible actions:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>return</SPAN
></DT
><DD
><P
>Controls returns to the program that attempted the name resolution. If a lookup attempt was successful, the resolver will return with the details,
otherwise it will return a zero result.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>continue</SPAN
></DT
><DD
><P
>The resolver will move on to the next service in the list and attempt
resolution using it.</P
></DD
></DL
></DIV
>

The optional (!) character specifies that the status value should
be inverted before testing; that is, it means &#8220;not.&#8221;</P
><P
>The available status values on which we can act are:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>success</SPAN
></DT
><DD
><P
>The requested entry was found without error. The default action for
this status is <SPAN
CLASS="SYSTEMITEM"
>return</SPAN
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>notfound</SPAN
></DT
><DD
><P
>There was no error in the lookup, but the target host or network could not be
found. The default action for this status is
<SPAN
CLASS="SYSTEMITEM"
>continue</SPAN
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>unavail</SPAN
></DT
><DD
><P
>The service queried was unavailable. This could mean that the
<TT
CLASS="FILENAME"
>hosts</TT
> or <TT
CLASS="FILENAME"
>networks</TT
> file was unreadable
for the <SPAN
CLASS="SYSTEMITEM"
>files</SPAN
> service or that a
name server or NIS server did not respond for the
<SPAN
CLASS="SYSTEMITEM"
>dns</SPAN
> or
<SPAN
CLASS="SYSTEMITEM"
>nis</SPAN
> services.
The default action for this status is
<SPAN
CLASS="SYSTEMITEM"
>continue</SPAN
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>tryagain</SPAN
></DT
><DD
><P
>This status means the service is temporarily unavailable. For the
<SPAN
CLASS="SYSTEMITEM"
>files</SPAN
> files service, this would
usually indicate that the relevant file was locked by some
process. For other services, it may mean the server was temporarily
unable to accept connections. The default action for this status is
<SPAN
CLASS="SYSTEMITEM"
>continue</SPAN
>.</P
></DD
></DL
></DIV
></P
><P
>A simple example of how you might use this mechanism is shown in
<A
HREF="#X-087-2-DNS-NSSWITCH.CONF.FILE.EXTENDED"
>Example 6-3</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-DNS-NSSWITCH.CONF.FILE.EXTENDED"
></A
><P
><B
>Example 6-3. Sample nsswitch.conf File Using an Action Statement</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/nsswitch.conf
#
# Example configuration of GNU Name Service Switch functionality.
# Information about this file is available in the `libc6-doc' package.

hosts:          dns [!UNAVAIL=return] files
networks:       files&#13;</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>This example attempts host resolution using the Domain Name Service
system. If the return status is anything other than unavailable, the
resolver returns whatever it has found. If, and only if, the DNS
lookup attempt returns an unavailable status, the resolver attempts to
use the local <TT
CLASS="FILENAME"
>/etc/hosts</TT
>. This means that we
should use the <TT
CLASS="FILENAME"
>hosts</TT
> file only if our name server
is unavailable for some reason.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-RESOLV.RESOLV"
>6.1.3. Configuring Name Server Lookups Using resolv.conf</A
></H3
><P
>When configuring the resolver library to use the BIND name service for host
lookups, you also have to tell it which name servers to use. There is a
separate file for this called <TT
CLASS="FILENAME"
>resolv.conf</TT
>. If this file
does not exist or is empty, the resolver assumes the name server is on your
local host.</P
><P
>To run a name server on your local host, you have to set it up separately,
as will be explained in the following section. If you are on a local network
and have the opportunity to use an existing name server, this should always
be preferred. If you use a dialup IP connection to the Internet, you
would normally specify the name server of your service provider in the
<TT
CLASS="FILENAME"
>resolv.conf</TT
> file.</P
><P
>The most important option in <TT
CLASS="FILENAME"
>resolv.conf</TT
> is
<SPAN
CLASS="SYSTEMITEM"
>name server</SPAN
>, which gives the IP address
of a name server to use. If you specify several name servers by giving the
<SPAN
CLASS="SYSTEMITEM"
>name server</SPAN
> option several times, they
are tried in the order given. You should therefore put the most reliable
server first. The current implementation allows you to have up to three
<SPAN
CLASS="SYSTEMITEM"
>name server</SPAN
> statements in
<TT
CLASS="FILENAME"
>resolv.conf</TT
>. If no
<SPAN
CLASS="SYSTEMITEM"
>name server</SPAN
> option is given, the resolver
attempts to connect to the name server on the local host.</P
><P
>&#13;
Two other options, <SPAN
CLASS="SYSTEMITEM"
>domain</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>search</SPAN
>, let you use shortcut names
for hosts in your local domain. Usually, when just telnetting to another
host in your local domain, you don't want to type in the fully qualified
hostname, but use a name like <SPAN
CLASS="SYSTEMITEM"
>gauss</SPAN
> 
on the command line and have the resolver tack on the
<SPAN
CLASS="SYSTEMITEM"
>mathematics.groucho.edu</SPAN
> part.</P
><P
>This is just the <SPAN
CLASS="SYSTEMITEM"
>domain</SPAN
>
statement's purpose. It lets you specify a default domain name to be
appended when DNS fails to look up a hostname. For instance, when
given the name <SPAN
CLASS="SYSTEMITEM"
>gauss</SPAN
>, the
resolver fails to find <SPAN
CLASS="SYSTEMITEM"
>gauss.</SPAN
> in DNS, because there is no such
top-level domain. When given <SPAN
CLASS="SYSTEMITEM"
>mathematics.groucho.edu</SPAN
> as a default
domain, the resolver repeats the query for <SPAN
CLASS="SYSTEMITEM"
>gauss</SPAN
> with the default domain appended,
this time succeeding.</P
><P
>That's just fine, you may think, but as soon you get out of the Math
department's domain, you're back to those fully qualified domain names.
Of course, you would also want to have shorthands like
<SPAN
CLASS="SYSTEMITEM"
>quark.physics</SPAN
> for hosts in the
Physics department's domain.</P
><P
>This is when the <EM
>search list</EM
> comes in.  A search
list can be specified using the <SPAN
CLASS="SYSTEMITEM"
>search</SPAN
> option, which is a generalization
of the <SPAN
CLASS="SYSTEMITEM"
>domain</SPAN
> statement.
Where the latter gives a single default domain, the former specifies a
whole list of them, each to be tried in turn until a lookup
succeeds. This list must be separated by blanks or tabs.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>search</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>domain</SPAN
> statements are mutually exclusive
and may not appear more than once. If neither option is given, the resolver
will try to guess the default domain from the local hostname using the
<CODE
CLASS="FUNCTION"
>getdomainname(2)</CODE
> system call. If the local hostname
doesn't have a domain part, the default domain will be assumed to be the
root domain.</P
><P
>If you decide to put a <SPAN
CLASS="SYSTEMITEM"
>search</SPAN
> statement
into <TT
CLASS="FILENAME"
>resolv.conf</TT
>, you should be careful about what
domains you add to this list. Resolver libraries prior to BIND 4.9 used to
construct a default search list from the domain name when no search list was
given. This default list was made up of the default domain itself, plus all
of its parent domains up to the root. This caused some problems because DNS
requests wound up at name servers that were never meant to see them.</P
><P
>Assume you're at the Virtual Brewery and want to log in to <SPAN
CLASS="SYSTEMITEM"
>foot.groucho.edu</SPAN
>. By a slip
of your fingers, you mistype <SPAN
CLASS="SYSTEMITEM"
>foot</SPAN
> as <SPAN
CLASS="SYSTEMITEM"
>foo</SPAN
>, which doesn't exist. GMU's name
server will therefore tell you that it knows no such host. With the
old-style search list, the resolver would now go on trying the name
with <SPAN
CLASS="SYSTEMITEM"
>vbrew.com</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>com</SPAN
> appended. The latter is
problematic because <SPAN
CLASS="SYSTEMITEM"
>groucho.edu.com</SPAN
> might actually be a valid
domain name.  Their name server might then even find <SPAN
CLASS="SYSTEMITEM"
>foo</SPAN
> in their domain, pointing you to one
of their hosts&#8212;which clearly was not intended.</P
><P
>For some applications, these bogus host lookups can be a security problem.
Therefore, you should usually limit the domains on your search list to your
local organization, or something comparable. At the Mathematics department of
Groucho Marx University, the search list would commonly be set to
<SPAN
CLASS="SYSTEMITEM"
>maths.groucho.edu</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>groucho.edu</SPAN
>.</P
><P
>If default domains sound confusing to you, consider this sample
<TT
CLASS="FILENAME"
>resolv.conf</TT
> file for the Virtual Brewery:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/resolv.conf
# Our domain
domain         vbrew.com
#
# We use vlager as central name server:
name server     172.16.1.1</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>When resolving the name <SPAN
CLASS="SYSTEMITEM"
>vale</SPAN
>, the
resolver looks up <SPAN
CLASS="SYSTEMITEM"
>vale</SPAN
> and,
failing this, <SPAN
CLASS="SYSTEMITEM"
>vale.vbrew.com</SPAN
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-RESOLV.ROBUSTNESS"
>6.1.4. Resolver Robustness</A
></H3
><P
>When running a LAN inside a larger network, you definitely should use
central name servers if they are available. The name servers develop
rich caches that speed up repeat queries, since all queries are
forwarded to them. However, this scheme has a drawback: when a fire
destroyed the backbone cable at Olaf's university, no more work was
possible on his department's LAN because the resolver could no longer
reach any of the name servers. This situation caused difficulties with
most network services, such as X terminal logins and printing.</P
><P
>Although it is not very common for campus backbones to go down in flames,
one might want to take precautions against cases like this.</P
><P
>One option is to set up a local name server that resolves hostnames from your
local domain and forwards all queries for other hostnames to the main servers.
Of course, this is applicable only if you are running your own domain.</P
><P
>Alternatively, you can maintain a backup host table for your domain or LAN in
<TT
CLASS="FILENAME"
>/etc/hosts</TT
>. This is very simple to do. You simply ensure
that the resolver library queries DNS first, and the hosts file next. In an
<TT
CLASS="FILENAME"
>/etc/host.conf</TT
> file you'd use
&#8220;<SPAN
CLASS="SYSTEMITEM"
>order bind,hosts</SPAN
>&#8221;,
and in an <TT
CLASS="FILENAME"
>/etc/nsswitch.conf</TT
> file you'd use
&#8220;<SPAN
CLASS="SYSTEMITEM"
>hosts: dns files</SPAN
>&#8221;,
to make the resolver fall back to the hosts file if the central name server is
unreachable.

 
 </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-RESOLV.HOWDNSWORKS"
>6.2. How DNS Works</A
></H2
><P
>DNS organizes hostnames in a domain hierarchy. A
<EM
>domain</EM
> is a collection of sites that are related
in some sense&#8212;because they form a proper network (e.g.,
all machines on a campus, or all hosts on BITNET), because they all
belong to a certain organization (e.g., the U.S. government), or
because they're simply geographically close. For instance,
universities are commonly grouped in the <SPAN
CLASS="SYSTEMITEM"
>edu</SPAN
> domain, with each university or
college using a separate <EM
>subdomain</EM
>, below which
their hosts are subsumed. Groucho Marx University have the
<SPAN
CLASS="SYSTEMITEM"
>groucho.edu</SPAN
> domain, while the
LAN of the Mathematics department is assigned <SPAN
CLASS="SYSTEMITEM"
>maths.groucho.edu</SPAN
>. Hosts on the
departmental network would have this domain name tacked onto their
hostname, so <SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
> would be
known as <SPAN
CLASS="SYSTEMITEM"
>erdos.maths.groucho.edu</SPAN
>.  This is called
the <EM
>fully qualified domain name</EM
> (FQDN), which
uniquely identifies this host worldwide.</P
><P
><A
HREF="#X-087-2-RESOLV.FIG.DNS"
>Figure 6-1</A
> shows a section of the namespace.
The entry at the root of this tree, which is denoted by a single dot, is quite
appropriately called the <EM
>root domain</EM
> and encompasses all
other domains. To indicate that a hostname is a fully qualified domain name,
rather than a name relative to some (implicit) local domain, it is
sometimes written with a trailing dot. This dot signifies that the name's
last component is the root domain.
 </P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-RESOLV.FIG.DNS"
></A
><P
><B
>Figure 6-1. A part of the domain namespace</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_0601.jpg"></P
></DIV
></DIV
><P
>&#13;Depending on its location in the name hierarchy, a domain may be
called top-level, second-level, or third-level. More levels of
subdivision occur, but they are rare. This list details several
top-level domains you may see frequently:</P
><DIV
CLASS="INFORMALTABLE"
><P
></P
><A
NAME="AEN4977"
></A
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL
WIDTH="0"><COL
WIDTH="4"><THEAD
><TR
><TH
>Domain</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
>edu</TD
><TD
><P
>(Mostly U.S.) educational institutions like universities.</P
></TD
></TR
><TR
><TD
>com</TD
><TD
><P
>Commercial organizations and companies.</P
></TD
></TR
><TR
><TD
>org</TD
><TD
><P
>Non-commercial organizations. Private UUCP networks are often in this domain.</P
></TD
></TR
><TR
><TD
>net</TD
><TD
><P
>Gateways and other administrative hosts on a network.</P
></TD
></TR
><TR
><TD
>mil</TD
><TD
><P
>U.S. military institutions.</P
></TD
></TR
><TR
><TD
>gov</TD
><TD
><P
>U.S. government institutions.</P
></TD
></TR
><TR
><TD
>uucp</TD
><TD
><P
>Officially, all site names formerly used as UUCP names without domains have been moved to this domain.</P
></TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
>Historically, the first four of these were assigned to the U.S., but
recent changes in policy have meant that these domains, named global
Top Level Domains (gTLD), are now considered global in nature.
Negotiations are currently underway to broaden the range of gTLDs,
which may result in increased choice in the future.</P
><P
>Outside the U.S., each country generally uses a top-level domain of
its own named after the two-letter country code defined in ISO-3166.
Finland, for instance, uses the <SPAN
CLASS="SYSTEMITEM"
>fi</SPAN
> domain; <SPAN
CLASS="SYSTEMITEM"
>fr</SPAN
> is used by France, <SPAN
CLASS="SYSTEMITEM"
>de</SPAN
> by Germany, and <SPAN
CLASS="SYSTEMITEM"
>au</SPAN
> by Australia. Below this top-level
domain, each country's NIC is free to organize hostnames in whatever
way they want. Australia has second-level domains similar to the
international top-level domains, named <SPAN
CLASS="SYSTEMITEM"
>com.au</SPAN
> and <SPAN
CLASS="SYSTEMITEM"
>edu.au</SPAN
>. Other countries, like Germany,
don't use this extra level, but have slightly long names that refer
directly to the organizations running a particular domain. It's not
uncommon to see hostnames like <SPAN
CLASS="SYSTEMITEM"
>ftp.informatik.uni-erlangen.de</SPAN
>. Chalk
that up to German efficiency.</P
><P
>Of course, these national domains do not imply that a host below that
domain is actually located in that country; it means only that the
host has been registered with that country's NIC. A Swedish manufacturer
might have a branch in Australia and still have all its hosts
registered with the <SPAN
CLASS="SYSTEMITEM"
>se</SPAN
> top-level domain.</P
><P
>Organizing the namespace in a hierarchy of domain names nicely solves
the problem of name uniqueness; with DNS, a hostname has to be unique
only within its domain to give it a name different from all other
hosts worldwide. Furthermore, fully qualified names are easy to
remember.  Taken by themselves, these are already very good reasons to
split up a large domain into several subdomains.</P
><P
>&#13;

DNS does even more for you than this. It also allows you to delegate
authority over a subdomain to its administrators.  For example, the
maintainers at the Groucho Computing Center might create a subdomain
for each department; we already encountered the <SPAN
CLASS="SYSTEMITEM"
>math</SPAN
> and <SPAN
CLASS="SYSTEMITEM"
>physics</SPAN
> subdomains above. When they find
the network at the Physics department too large and chaotic to manage
from outside (after all, physicists are known to be an unruly bunch of
people), they may simply pass control of the <SPAN
CLASS="SYSTEMITEM"
>physics.groucho.edu</SPAN
> domain to the
administrators of this network. These administrators are free to use
whatever hostnames they like and assign them IP addresses from their
network in whatever fashion they desire, without outside interference.</P
><P
> To this end,
the namespace is split up into <EM
>zones</EM
>, each rooted
at a domain. Note the subtle difference between a
<EM
>zone</EM
> and a <EM
>domain</EM
>: the
domain <SPAN
CLASS="SYSTEMITEM"
>groucho.edu</SPAN
>
encompasses all hosts at Groucho Marx University, while the zone
<SPAN
CLASS="SYSTEMITEM"
>groucho.edu</SPAN
> includes only the
hosts that are managed by the Computing Center directly; those at the
Mathematics department, for example. The hosts at the Physics
department belong to a different zone, namely <SPAN
CLASS="SYSTEMITEM"
>physics.groucho.edu</SPAN
>.  In <A
HREF="#X-087-2-RESOLV.FIG.DNS"
>Figure 6-1</A
>, the start of a zone is marked by a
small circle to the right of the domain name.</P
><P
></P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-RESOLV.DNS.LOOKUPS"
>6.2.1. Name Lookups with DNS</A
></H3
><P
>At first glance, all this domain and zone fuss seems to make name
resolution an awfully complicated business. After all, if no central
authority controls what names are assigned to which hosts, how is a
humble application supposed to know?</P
><P
>Now comes the really ingenious part about DNS. If you want to find the
IP address of <SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
>, DNS
says, &#8220;Go ask the people who manage it, and they will tell
you.&#8221;</P
><P
> In fact, DNS is
a giant distributed database. It is implemented by so-called name
servers that supply information on a given domain or set of
domains. For each zone there are at least two, or at most a few, name
servers that hold all authoritative information on hosts in that
zone. To obtain the IP address of <SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
>, all you have to do is contact the
name server for the <SPAN
CLASS="SYSTEMITEM"
>groucho.edu</SPAN
> zone, which will then return
the desired data.</P
><P
>&#13;Easier said than done, you might think. So how do I know how to reach
the name server at Groucho Marx University? In case your computer isn't
equipped with an address-resolving oracle, DNS provides for this, too.
When your application wants to look up information on
<SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
>, it contacts a local name
server, which conducts a so-called iterative query for it. It starts off
by sending a query to a name server for the root domain, asking for the address
of <SPAN
CLASS="SYSTEMITEM"
>erdos.maths.groucho.edu</SPAN
>. The root
name server recognizes that this name does not belong to its zone of authority,
but rather to one below the <SPAN
CLASS="SYSTEMITEM"
>edu</SPAN
> domain.
Thus, it tells you to contact an <SPAN
CLASS="SYSTEMITEM"
>edu</SPAN
>
zone name server for more information and encloses a list of all
<SPAN
CLASS="SYSTEMITEM"
>edu</SPAN
> name servers along with their
addresses. Your local name server will then go on and query one of those,
for instance, <SPAN
CLASS="SYSTEMITEM"
>a.isi.edu</SPAN
>. In a manner
similar to the root name server,
<SPAN
CLASS="SYSTEMITEM"
>a.isi.edu</SPAN
> knows that the
<SPAN
CLASS="SYSTEMITEM"
>groucho.edu</SPAN
> people run a zone of
their own, and points you to their servers. The local name server will then
present its query for <SPAN
CLASS="SYSTEMITEM"
>erdos</SPAN
> to one
of these, which will finally recognize the name as belonging to its zone,
and return the corresponding IP address.

<DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/image-missing.jpg"></P
></DIV
></P
><P
>This looks like a lot of traffic being generated for looking up a
measly IP address, but it's really only miniscule compared to the amount
of data that would have to be transferred if we were still stuck with
<TT
CLASS="FILENAME"
>HOSTS.TXT</TT
>. There's still room for improvement with this
scheme, however.</P
><P
>To improve response time during future queries, the name server stores
the information obtained in its local <EM
>cache</EM
>. So
the next time anyone on your local network wants to look up the
address of a host in the <SPAN
CLASS="SYSTEMITEM"
>groucho.edu</SPAN
> domain, your name server will
go directly to the <SPAN
CLASS="SYSTEMITEM"
>groucho.edu</SPAN
> name server.<A
NAME="X-087-2-FNIS06"
HREF="#FTN.X-087-2-FNIS06"
><SPAN
CLASS="footnote"
>[40]</SPAN
></A
></P
><P
> Of course, the name server will not
keep this information forever; it will discard it after some time. The
expiration interval is called the <EM
>time to live</EM
>,
or TTL. Each datum in the DNS database is assigned such a TTL by
administrators of the responsible zone.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-RESOLV.DNS.AUTH"
>6.2.2. Types of Name Servers</A
></H3
><P
>Name servers that hold all information on hosts within a zone are
called <EM
>authoritative</EM
> for this zone, and sometimes are
referred to as <EM
>master name servers</EM
>. Any query for a host
within this zone will end up at one of these master name servers.</P
><P
>&#13;


Master servers must be fairly well synchronized. Thus, the zone's
network administrator must make one the <EM
>primary</EM
>
server, which loads its zone information from data files, and make
the others <EM
>secondary</EM
> servers, which transfer the
zone data from the primary server at regular intervals.</P
><P
>Having several name servers distributes workload; it also provides
backup. When one name server machine fails in a benign way, like
crashing or losing its network connection, all queries will fall back
to the other servers. Of course, this scheme doesn't protect you from
server malfunctions that produce wrong replies to all DNS requests,
such as from software bugs in the server program itself.</P
><P
>&#13;You can also run a name server that is not authoritative for any
domain.<A
NAME="X-087-2-FNIS07"
HREF="#FTN.X-087-2-FNIS07"
><SPAN
CLASS="footnote"
>[41]</SPAN
></A
> This is useful, as the name server will still be able to
conduct DNS queries for the applications running on the local network
and cache the information. Hence it is called a
<EM
>caching-only</EM
> server.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-RESOLV.DNS.RECORDS"
>6.2.3. The DNS Database</A
></H3
><P
>We have seen that DNS not only deals with IP addresses of hosts, but
also exchanges information on name servers. DNS databases may
have, in fact, many different types of entries.</P
><P
> A
single piece of information from the DNS database is called a
<EM
>resource record</EM
> (RR). Each record has a type
associated with it describing the sort of data it represents, and a
class specifying the type of network it applies to. The latter
accommodates the needs of different addressing schemes, like


IP addresses (the IN class), Hesiod addresses (used by MIT's
Kerberos system), and a few more. The prototypical resource record
type is the A record, which associates a fully qualified domain name
with an IP address.</P
><P
>&#13;

A host may be known by more than one name. For example you might have
a server that provides both FTP and World Wide Web servers, which you
give two names: <SPAN
CLASS="SYSTEMITEM"
>ftp.machine.org</SPAN
> and <SPAN
CLASS="SYSTEMITEM"
>www.machine.org</SPAN
>. However, one of these
names must be identified as the official or
<EM
>canonical</EM
> hostname, while the others are simply
aliases referring to the official hostname. The difference is that the
canonical hostname is the one with an associated A record, while the
others only have a record of type CNAME that points to the canonical
hostname.</P
><P
>We will not go through all record types here, but we will give you a brief
example. <A
HREF="#X-087-2-RESOLV.FIG.HOSTS"
>Example 6-4</A
> shows a part of the
domain database that is loaded into the name servers for the
<SPAN
CLASS="SYSTEMITEM"
>physics.groucho.edu</SPAN
> zone.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-RESOLV.FIG.HOSTS"
></A
><P
><B
>Example 6-4. An Excerpt from the named.hosts File for the Physics Department</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>; Authoritative Information on physics.groucho.edu.
@  IN  SOA niels.physics.groucho.edu. janet.niels.physics.groucho.edu. {
                  1999090200       ; serial no
                  360000           ; refresh
                  3600             ; retry
                  3600000          ; expire
                  3600             ; default ttl
                }
;
; Name servers
              IN    NS       niels
              IN    NS       gauss.maths.groucho.edu.
gauss.maths.groucho.edu. IN A 149.76.4.23
;
; Theoretical Physics (subnet 12)
niels         IN    A        149.76.12.1
              IN    A        149.76.1.12
name server    IN    CNAME    niels
otto          IN    A        149.76.12.2
quark         IN    A        149.76.12.4
down          IN    A        149.76.12.5
strange       IN    A        149.76.12.6
...
; Collider Lab. (subnet 14)
boson         IN    A        149.76.14.1
muon          IN    A        149.76.14.7
bogon         IN    A        149.76.14.12
...</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>&#13;


Apart from the A and CNAME records, you can see a special record at the top
of the file, stretching several lines. This is the SOA resource record
signaling the <EM
>Start of Authority</EM
>, which holds general
information on the zone the server is authoritative for. The SOA record
comprises, for instance, the default time to live for all records.</P
><P
>Note that all names in the sample file that do not end with a dot
should be interpreted relative to the <SPAN
CLASS="SYSTEMITEM"
>physics.groucho.edu</SPAN
> domain. The special
name (<SPAN
CLASS="SYSTEMITEM"
>@</SPAN
>) used in the
<TT
CLASS="LITERAL"
>SOA</TT
> record refers to the domain name by itself.</P
><P
> We have seen
earlier that the name servers for the <SPAN
CLASS="SYSTEMITEM"
>groucho.edu</SPAN
> domain somehow have to know
about the <SPAN
CLASS="SYSTEMITEM"
>physics</SPAN
> zone so
that they can point queries to their name servers. This is usually
achieved by a pair of records: the NS record that gives the server's
FQDN, and an A record that associates an address with that name. Since
these records are what holds the namespace together, they are
frequently called <EM
>glue records</EM
>. They are the only
instances of records in which a parent zone actually holds information
on hosts in the subordinate zone. The glue records pointing to the
name servers for <SPAN
CLASS="SYSTEMITEM"
>physics.groucho.edu</SPAN
> are shown in <A
HREF="#X-087-2-RESOLV.FIG.NSPTR"
>Example 6-5</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-RESOLV.FIG.NSPTR"
></A
><P
><B
>Example 6-5. An Excerpt from the named.hosts File for GMU</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
> ; Zone data for the groucho.edu zone.
 @  IN  SOA vax12.gcc.groucho.edu. joe.vax12.gcc.groucho.edu. {
                      1999070100       ; serial no
                      360000           ; refresh
                      3600             ; retry
                      3600000          ; expire
                      3600             ; default ttl
               }
 ....
 ;
 ; Glue records for the physics.groucho.edu zone
 physics        IN     NS        niels.physics.groucho.edu.
                IN     NS        gauss.maths.groucho.edu.
 niels.physics  IN     A         149.76.12.1
 gauss.maths    IN     A         149.76.4.23
 ...</PRE
></FONT
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-RESOLV.DNS.IN-ADDR"
>6.2.4. Reverse Lookups</A
></H3
><P
>Finding the IP address belonging to a host is certainly the most
common use for the Domain Name System, but sometimes you'll want to
find the canonical hostname corresponding to an address. Finding this
hostname is called <EM
>reverse mapping</EM
>, and is used
by several network services to verify a client's identity. When using
a single <TT
CLASS="FILENAME"
>hosts</TT
> file, reverse lookups simply
involve searching the file for a host that owns the IP address in
question. With DNS, an exhaustive search of the namespace is out of
the question.  Instead, a special domain, <SPAN
CLASS="SYSTEMITEM"
>in-addr.arpa</SPAN
>, has been created that
contains the IP addresses of all hosts in a reversed dotted quad
notation.  For instance, an IP address of <SPAN
CLASS="SYSTEMITEM"
>149.76.12.4</SPAN
> corresponds to the name
<SPAN
CLASS="SYSTEMITEM"
>4.12.76.149.in-addr.arpa</SPAN
>. The
resource-record type linking these names to their canonical hostnames
is PTR.</P
><P
>&#13;




Creating a zone of authority usually means that its administrators
have full control over how they assign addresses to names.  Since they
usually have one or more IP networks or subnets at their hands,
there's a one-to-many mapping between DNS zones and IP networks. The
Physics department, for instance, comprises the subnets <SPAN
CLASS="SYSTEMITEM"
>149.76.8.0</SPAN
>, <SPAN
CLASS="SYSTEMITEM"
>149.76.12.0</SPAN
>, and <SPAN
CLASS="SYSTEMITEM"
>149.76.14.0</SPAN
>.</P
><P
>Consequently, new zones in the <SPAN
CLASS="SYSTEMITEM"
>in-addr.arpa</SPAN
> domain have to be created
along with the <SPAN
CLASS="SYSTEMITEM"
>physics</SPAN
> zone,
and delegated to the network administrators at the department:
<SPAN
CLASS="SYSTEMITEM"
>8.76.149.in-addr.arpa</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>12.76.149.in-addr.arpa</SPAN
>, and
<SPAN
CLASS="SYSTEMITEM"
>14.76.149.in-addr.arpa</SPAN
>.
Otherwise, installing a new host at the Collider Lab would require
them to contact their parent domain to have the new address entered
into their <SPAN
CLASS="SYSTEMITEM"
>in-addr.arpa</SPAN
> zone
file.</P
><P
>The zone database for subnet 12 is shown in
<A
HREF="#X-087-2-RESOLV.FIG.SUBNET12"
>Example 6-6</A
>. The corresponding glue records
in the database of their parent zone are shown in
<A
HREF="#X-087-2-RESOLV.FIG.GROUCHO-REV"
>Example 6-7</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-RESOLV.FIG.SUBNET12"
></A
><P
><B
>Example 6-6. An Excerpt from the named.rev File for Subnet 12</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
> ; the 12.76.149.in-addr.arpa domain.
 @  IN  SOA  niels.physics.groucho.edu. janet.niels.physics.groucho.edu. {
                      1999090200 360000 3600 3600000 3600
            }
 2        IN     PTR       otto.physics.groucho.edu.
 4        IN     PTR       quark.physics.groucho.edu.
 5        IN     PTR       down.physics.groucho.edu.
 6        IN     PTR       strange.physics.groucho.edu.</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-RESOLV.FIG.GROUCHO-REV"
></A
><P
><B
>Example 6-7. An Excerpt from the named.rev File for Network 149.76</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
> ; the 76.149.in-addr.arpa domain.
 @  IN  SOA vax12.gcc.groucho.edu. joe.vax12.gcc.groucho.edu. {
                      1999070100 360000 3600 3600000 3600
                  }
 ...
 ; subnet 4: Mathematics Dept.
 1.4        IN     PTR      sophus.maths.groucho.edu.
 17.4       IN     PTR      erdos.maths.groucho.edu.
 23.4       IN     PTR      gauss.maths.groucho.edu.
 ...
 ; subnet 12: Physics Dept, separate zone
 12         IN     NS       niels.physics.groucho.edu.
            IN     NS       gauss.maths.groucho.edu.
 niels.physics.groucho.edu. IN  A 149.76.12.1
 gauss.maths.groucho.edu. IN  A   149.76.4.23
 ...</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>&#13;<SPAN
CLASS="SYSTEMITEM"
>in-addr.arpa</SPAN
> system zones can
only be created as supersets of IP networks. An even more severe
restriction is that these networks' netmasks have to be on byte
boundaries. All subnets at Groucho Marx University have a netmask of
<SPAN
CLASS="SYSTEMITEM"
>255.255.255.0</SPAN
>, hence an
<SPAN
CLASS="SYSTEMITEM"
>in-addr.arpa</SPAN
> zone could be
created for each subnet. However, if the netmask were <SPAN
CLASS="SYSTEMITEM"
>255.255.255.128</SPAN
> instead, creating zones
for the subnet <SPAN
CLASS="SYSTEMITEM"
>149.76.12.128</SPAN
>
would be impossible, because there's no way to tell DNS that the
<SPAN
CLASS="SYSTEMITEM"
>12.76.149.in-addr.arpa</SPAN
> domain
has been split into two zones of authority, with hostnames ranging from
<SPAN
CLASS="SYSTEMITEM"
>1</SPAN
> through
<SPAN
CLASS="SYSTEMITEM"
>127</SPAN
>, and
<SPAN
CLASS="SYSTEMITEM"
>128</SPAN
> through
<SPAN
CLASS="SYSTEMITEM"
>255</SPAN
>, respectively.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-RESOLV.NAMED"
>6.3. Running named</A
></H2
><P
><B
CLASS="COMMAND"
>named</B
> (pronounced <EM
>name-dee</EM
>)
provides DNS on most Unix machines.  It is a server program
originally developed for BSD to provide name service to clients, and
possibly to other name servers. BIND Version 4 was around for some
time and appeared in most Linux distributions. The new release,
Version 8, has been introduced in most Linux distributions, and is a
big change from previous versions.<A
NAME="X-087-2-FNDN01"
HREF="#FTN.X-087-2-FNDN01"
><SPAN
CLASS="footnote"
>[42]</SPAN
></A
>
It has many new features, such as support for DNS dynamic updates, DNS
change notifications, much improved performance, and a new
configuration file syntax. Please check the documentation contained
in the source distribution for details.</P
><P
>This section requires some understanding of the way DNS works. If the
following discussion is all Greek to you, you may want to reread the
section <A
HREF="#X-087-2-RESOLV.HOWDNSWORKS"
>Section 6.2</A
>."</P
><P
>  <B
CLASS="COMMAND"
>named</B
> is usually
started at system boot time and runs until the machine goes down
again. Implementations of BIND prior to Version 8 take their
information from a configuration file called
<B
CLASS="COMMAND"
>/etc/named.boot</B
> and various files that map domain
names to addresses. The latter are called <EM
>zone
files</EM
>.  Versions of BIND from Version 8 onwards use
<TT
CLASS="FILENAME"
>/etc/named.conf</TT
> in place of
<TT
CLASS="FILENAME"
>/etc/named.boot</TT
>.</P
><P
>To run <B
CLASS="COMMAND"
>named</B
> at the prompt, enter:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>/usr/sbin/named</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
><B
CLASS="COMMAND"
>named</B
> will come up and read the <B
CLASS="COMMAND"
>named.boot</B
>
file and any zone files specified therein. It writes its process ID to
<TT
CLASS="FILENAME"
>/var/run/named.pid</TT
> in ASCII, downloads any zone files
from primary servers, if necessary, and starts listening on port 53 for DNS
queries.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN5324"
>6.3.1. The named.boot File</A
></H3
><P
> The
BIND configuration file prior to Version 8 was very simple in
structure.  BIND Version 8 has a very different configuration file
syntax to deal with many of the new features introduced. The name of
the configuration file changed from
<TT
CLASS="FILENAME"
>/etc/named.boot</TT
>, in older versions of BIND, to
<TT
CLASS="FILENAME"
>/etc/named.conf</TT
> in BIND Version 8.  We'll focus
on configuring the older version because it is probably what most
distributions are still using, but we'll present an equivalent
<TT
CLASS="FILENAME"
>named.conf</TT
> to illustrate the differences, and
we'll talk about how to convert the old format into the new one.</P
><P
>The <B
CLASS="COMMAND"
>named.boot</B
> file is generally small and contains
little but pointers to master files containing zone information and
pointers to other name servers. Comments in the boot file start with the
(#) or (;) characters and extend to the next newline. Before we discuss
the format of <TT
CLASS="FILENAME"
>named.boot</TT
> in more detail, we will take a
look at the sample file for <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>
given in <A
HREF="#X-087-2-RESOLV.FIG.NAMED.BOOT"
>Example 6-8</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-RESOLV.FIG.NAMED.BOOT"
></A
><P
><B
>Example 6-8. The named.boot File for vlager</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>;
; /etc/named.boot file for vlager.vbrew.com
;
directory     /var/named
;
;             domain                   file
;-----------------
cache         .                        named.ca
primary       vbrew.com                named.hosts
primary       0.0.127.in-addr.arpa     named.local
primary       16.172.in-addr.arpa      named.rev</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>Let's look at each statement individually. The
<SPAN
CLASS="SYSTEMITEM"
>directory</SPAN
> keyword tells
<B
CLASS="COMMAND"
>named</B
> that all filenames referred to later in this file,
zone files for example, are located in the <TT
CLASS="FILENAME"
>/var/named</TT
>
directory. This saves a little typing.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>primary</SPAN
> keyword shown in
this example loads information into <B
CLASS="COMMAND"
>named</B
>. This
information is taken from the master files specified as the last of
the parameters. These files represent DNS resource records, which we
will look at next.</P
><P
>In this example, we configured <B
CLASS="COMMAND"
>named</B
> as the primary
name server for three domains, as indicated by the three <SPAN
CLASS="SYSTEMITEM"
>primary</SPAN
> statements.  The first of these
statements instructs <B
CLASS="COMMAND"
>named</B
> to act as a primary
server for <SPAN
CLASS="SYSTEMITEM"
>vbrew.com</SPAN
>, taking
the zone data from the file <TT
CLASS="FILENAME"
>named.hosts</TT
>.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>cache</SPAN
> keyword is very special and
should be present on virtually all machines running a name server. It
instructs <B
CLASS="COMMAND"
>named</B
> to enable its cache and to load
the <EM
>root name server hints</EM
> from the cache file specified
(<TT
CLASS="FILENAME"
>named.ca</TT
> in our example). We will come back to the name
server hints in the following list.</P
><P
>Here's a list of the most important options you can use in
<TT
CLASS="FILENAME"
>named.boot</TT
>&#8201;:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>directory</SPAN
></DT
><DD
><P
> This
option specifies a directory in which zone files reside. Names of
files in other options may be given relative to this
directory. Several directories may be specified by repeatedly using
<SPAN
CLASS="SYSTEMITEM"
>directory</SPAN
>. The Linux file
system standard suggests this should be
<TT
CLASS="FILENAME"
>/var/named</TT
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>primary</SPAN
></DT
><DD
><P
>&#13;
This option takes a domain name and filename as an argument, declaring the local
server authoritative for the named domain. As a primary server,
<B
CLASS="COMMAND"
>named</B
> loads the zone information from the given master file.</P
><P
>There will always be at least one <SPAN
CLASS="SYSTEMITEM"
>primary</SPAN
>
entry in every boot file used for reverse mapping of network
<SPAN
CLASS="SYSTEMITEM"
>127.0.0.0</SPAN
>, which is the local
loopback network.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>secondary</SPAN
></DT
><DD
><P
>&#13; This
statement takes a domain name, an address list, and a filename as an
argument. It declares the local server a secondary master server for
the specified domain.</P
><P
>A secondary server holds authoritative data on the domain, too, but it
doesn't gather it from files; instead, it tries to download it from
the primary server. The IP address of at least one primary server thus
must be given to <B
CLASS="COMMAND"
>named</B
> in the address list. The
local server contacts each of them in turn until it successfully
transfers the zone database, which is then stored in the backup file
given as the third argument. If none of the primary servers responds,
the zone data is retrieved from the backup file instead.</P
><P
><B
CLASS="COMMAND"
>named</B
> then attempts to refresh the zone data at
regular intervals. This process is explained later in connection with
the SOA resource record type.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>cache</SPAN
></DT
><DD
><P
>&#13; This option
takes a domain name and filename as arguments. This file contains
the root server hints, which is a list of records pointing to the root
name servers. Only NS and A records will be recognized. The
<TT
CLASS="REPLACEABLE"
><I
>domain</I
></TT
> should be the root domain name, a
simple period (.).</P
><P
>This information is absolutely crucial to <B
CLASS="COMMAND"
>named</B
>; if
the <SPAN
CLASS="SYSTEMITEM"
>cache</SPAN
> statement does not
occur in the boot file, <B
CLASS="COMMAND"
>named</B
> will not develop a
local cache at all. This situation/lack of development will severely
degrade performance and increase network load if the next server
queried is not on the local net. Moreover, <B
CLASS="COMMAND"
>named</B
>
will not be able to reach any root name servers, and thus won't
resolve any addresses except those it is authoritative for. An
exception from this rule involves forwarding servers (see the
<SPAN
CLASS="SYSTEMITEM"
>forwarders</SPAN
> option that
follows).</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>forwarders</SPAN
></DT
><DD
><P
> This
statement takes a whitespace-separated list of addresses as an
argument.  The IP addresses in this list specify a list of name
servers that <B
CLASS="COMMAND"
>named</B
> may query if it fails to resolve
a query from its local cache. They are tried in order until one of
them responds to the query. Typically, you would use the name server of
your network provider or another well-known server as a forwarder.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>slave</SPAN
></DT
><DD
><P
> This
statement makes the name server a <EM
>slave</EM
>
server. It never performs recursive queries itself, but only forwards
them to servers specified in the <SPAN
CLASS="SYSTEMITEM"
>forwarders</SPAN
> statement.  </P
></DD
></DL
></DIV
>

There are two options that we will not describe here: <SPAN
CLASS="SYSTEMITEM"
>sortlist</SPAN
> and <SPAN
CLASS="SYSTEMITEM"
>domain</SPAN
>. Two other directives may also be
used inside these database files: <SPAN
CLASS="SYSTEMITEM"
>$INCLUDE</SPAN
> and <SPAN
CLASS="SYSTEMITEM"
>$ORIGIN</SPAN
>. Since they are rarely
needed, we will not describe them here, either.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN5434"
>6.3.2. The BIND 8 host.conf File</A
></H3
><P
>BIND Version 8 introduced a range of new features, and with these came
a new configuration file syntax. The <TT
CLASS="FILENAME"
>named.boot</TT
>,
with its simple single line statements, was replaced by the
<TT
CLASS="FILENAME"
>named.conf</TT
> file, with a syntax like that of
<B
CLASS="COMMAND"
>gated</B
> and resembling C source syntax.</P
><P
>The new syntax is more complex, but fortunately a tool has been
provided that automates conversion from the old syntax to the new
syntax. In the BIND 8  source package, a
<B
CLASS="COMMAND"
>perl</B
> program called
<B
CLASS="COMMAND"
>named-bootconf.pl</B
> is provided that will read your
existing <TT
CLASS="FILENAME"
>named.boot</TT
> file from
<TT
CLASS="LITERAL"
>stdin</TT
> and convert it into the equivalent
<TT
CLASS="FILENAME"
>named.conf</TT
> format on
<TT
CLASS="LITERAL"
>stdout</TT
>. To use it, you must have the
<B
CLASS="COMMAND"
>perl</B
> interpreter installed.</P
><P
>You should use the script somewhat like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>cd /etc</KBD
>
# <KBD
CLASS="USERINPUT"
>named-bootconf.pl &#60;named.boot &#62;named.conf</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

The script then produces a <TT
CLASS="FILENAME"
>named.conf</TT
> that looks
like that shown in <A
HREF="#X-087-2-RESOLV.FIG.NAMED.CONF"
>Example 6-9</A
>. We've cleaned out a few of
the helpful comments the script includes to help show the almost
direct relationship between the old and the new syntax.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-RESOLV.FIG.NAMED.CONF"
></A
><P
><B
>Example 6-9. The BIND 8 equivalent named.conf File for vlager</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>// 
// /etc/named.boot file for vlager.vbrew.com                                     
options {
	directory "/var/named";
};

zone "." {
	type hint;
	file "named.ca";
};

zone "vbrew.com" {
	type master;
	file "named.hosts";
};

zone "0.0.127.in-addr.arpa" {
	type master;
	file "named.local";
};

zone "16.172.in-addr.arpa" {
	type master;
	file "named.rev";
};</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>If you take a close look, you will see that each of the one-line statements in
<TT
CLASS="FILENAME"
>named.boot</TT
> has been converted into a C-like statement
enclosed within {&#8201;} characters in the
<TT
CLASS="FILENAME"
>named.conf</TT
> file.</P
><P
>The comments, which in the <TT
CLASS="FILENAME"
>named.boot</TT
> file were
indicated by a semicolon (;), are now indicated by two
forward slashes (&#8201;//&#8201;).</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>directory</SPAN
> statement has been
translated into an <SPAN
CLASS="SYSTEMITEM"
>options</SPAN
> paragraph
with a <SPAN
CLASS="SYSTEMITEM"
>directory</SPAN
> clause.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>cache</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>primary</SPAN
> statements have been converted
into <SPAN
CLASS="SYSTEMITEM"
>zone</SPAN
> paragraphs with
<SPAN
CLASS="SYSTEMITEM"
>type</SPAN
> clauses of
<SPAN
CLASS="SYSTEMITEM"
>hint</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>master</SPAN
>, respectively.</P
><P
>The zone files do not need to be modified in any way; their syntax remains
unchanged.</P
><P
>The new configuration syntax allows for many new options that we
haven't covered here. If you'd like information on the new options,
the best source of information is the documentation supplied with the
BIND Version 8 source package.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN5479"
>6.3.3. The DNS Database Files</A
></H3
><P
> Master
files included with <B
CLASS="COMMAND"
>named</B
>, like
<B
CLASS="COMMAND"
>named.hosts</B
>, always have a domain associated with
them, which is called the <EM
>origin</EM
>. This is the
domain name specified with the <SPAN
CLASS="SYSTEMITEM"
>cache</SPAN
> and <SPAN
CLASS="SYSTEMITEM"
>primary</SPAN
> options. Within a master file, you
are allowed to specify domain and host names relative to this
domain. A name given in a configuration file is considered
<EM
>absolute</EM
> if it ends in a single dot, otherwise it
is considered relative to the origin. The origin by itself may be
referred to using (<SPAN
CLASS="SYSTEMITEM"
>@</SPAN
>).</P
><P
>&#13;
 The
data contained in a master file is split up in <EM
>resource
records</EM
>&#8201;(RRs). RRs are the smallest units of information
available through DNS. Each resource record has a type. A records, for
instance, map a hostname to an IP address, and a CNAME record
associates an alias for a host with its official hostname. To see an
example, look at <A
HREF="#X-087-2-RESOLV.FIG.NAMED.HOSTS"
>Example 6-11</A
>, which shows the
<B
CLASS="COMMAND"
>named.hosts</B
> master file for the Virtual Brewery.</P
><P
>Resource record representations in master files share a
common format:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>[<TT
CLASS="REPLACEABLE"
><I
>domain</I
></TT
>] [<TT
CLASS="REPLACEABLE"
><I
>ttl</I
></TT
>] [<TT
CLASS="REPLACEABLE"
><I
>class</I
></TT
>] <TT
CLASS="REPLACEABLE"
><I
>type</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>rdata</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Fields are separated by spaces or tabs. An entry may be continued across
several lines if an opening brace occurs before the first newline and the
last field is followed by a closing brace. Anything between a semicolon and
a newline is ignored. A description of the format terms follows:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>domain</I
></TT
></DT
><DD
><P
>This term is the domain name to which the entry applies. If no domain name is
given, the RR is assumed to apply to the domain of the previous RR.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>ttl</I
></TT
></DT
><DD
><P
>&#13;In order to force resolvers to discard information after a certain time, each
RR is associated a time to live (<EM
>ttl</EM
>&#8201;). The
ttl field specifies the time in seconds that the
information is valid after it has been retrieved from the server. It is a
decimal number with at most eight digits.</P
><P
>If no ttl value is given, the field value defaults to that of the
<TT
CLASS="REPLACEABLE"
><I
>minimum</I
></TT
> field of the preceding SOA record.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>class</I
></TT
></DT
><DD
><P
>This is an address class, like IN for IP addresses or HS for objects in the
Hesiod class. For TCP/IP networking, you have to specify IN.</P
><P
>If no class field is given, the class of the preceding RR is assumed.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>type</I
></TT
></DT
><DD
><P
>This describes the type of the RR. The most common types are A, SOA, PTR,
and NS.  The following sections describe the various types of RRs.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>rdata</I
></TT
></DT
><DD
><P
>This holds the data associated with the RR. The format of this field
depends on the type of RR. In the following discussion, it will be
described for each RR separately.</P
></DD
></DL
></DIV
><P
>The following is partial list of RRs to be used in DNS master files. There
are a couple more of them that we will not explain; they are experimental
and of little use, generally.</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><EM
>SOA</EM
></DT
><DD
><P
>&#13;

This RR describes a zone of authority (SOA means &#8220;Start of Authority&#8221;).
It signals that the records following the SOA RR contain authoritative
information for the domain. Every master file included by a
<SPAN
CLASS="SYSTEMITEM"
>primary</SPAN
> statement must contain an SOA
record for this zone. The resource data contains the following fields:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>origin</I
></TT
></DT
><DD
><P
>This field is the canonical hostname of the primary name server for this domain.
It is usually given as an absolute name.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>contact</I
></TT
></DT
><DD
><P
>This field is the email address of the person responsible for maintaining the
domain, with the "<SPAN
CLASS="SYSTEMITEM"
>@</SPAN
>" sign replaced
by a dot. For instance, if the responsible person at the Virtual Brewery
were <SPAN
CLASS="SYSTEMITEM"
>janet</SPAN
>, this field would
contain <SPAN
CLASS="SYSTEMITEM"
>janet.vbrew.com</SPAN
>.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>serial</I
></TT
></DT
><DD
><P
>This field is the version number of the zone file, expressed as a single decimal
number. Whenever data is changed in the zone file, this number should be
incremented. A common convention is to use a number that reflects the date
of the last update, with a version number appended to it to cover the case
of multiple updates occurring on a single day, e.g., 2000012600 being update 00
that occurred on January 26, 2000.</P
><P
>The serial number is used by secondary name servers to recognize zone
information changes. To stay up to date, secondary servers request the
primary server's SOA record at certain intervals and compare the
serial number to that of the cached SOA record. If the number has
changed, the secondary servers transfer the whole zone database from
the primary server.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>refresh</I
></TT
></DT
><DD
><P
>This field specifies the interval in seconds that the secondary servers should wait
between checking the SOA record of the primary server. Again, this is a
decimal number with at most eight digits.</P
><P
>Generally, the network topology doesn't change too often, so this number
should specify an interval of roughly a day for larger networks, and even
more for smaller ones.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>retry</I
></TT
></DT
><DD
><P
>This number determines the intervals at which a secondary server should retry
contacting the primary server if a request or a zone refresh fails. It must
not be too low, or a temporary failure of the server or a network problem
could cause the secondary server to waste network resources. One hour, or
perhaps one-half hour, might be a good choice.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>expire</I
></TT
></DT
><DD
><P
>This field specifies the time in seconds after which a secondary server should
finally discard all zone data if it hasn't been able to contact the primary
server. You should normally set this field to at least a week (604,800 seconds), but
increasing it to a month or more is also reasonable.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>minimum</I
></TT
></DT
><DD
><P
>This field is the default <EM
>ttl</EM
> value for resource records that
do not explicitly contain one. The ttl value specifies
the maximum amount of time other name servers may keep the RR in their cache. This time applies only to normal lookups, and has nothing to do with the time after
which a secondary server should try to update the zone information.</P
><P
>If the topology of your network does not change frequently, a week or even
more is probably a good choice. If single RRs change more frequently, you could
still assign them smaller ttls individually. If your network changes frequently, you may want to set
<TT
CLASS="REPLACEABLE"
><I
>minimum</I
></TT
> to one day (86,400 seconds).</P
></DD
></DL
></DIV
>&#13;</P
></DD
><DT
>A</DT
><DD
><P
>&#13;
This record associates an IP address with a hostname. The resource data field
contains the address in dotted quad notation.</P
><P
>&#13;



For each hostname, there must be only one A record. The hostname used in
this A record is considered the official or <EM
>canonical</EM
>
hostname. All other hostnames are aliases and must be mapped onto the
canonical hostname using a CNAME record. If the canonical name of
our host were <EM
>vlager</EM
>, we'd have
an A record that associated that hostname with its IP address. Since we may
also want another name associated with that address, say
<SPAN
CLASS="SYSTEMITEM"
>news</SPAN
>, we'd create a
CNAME record that associates this alternate name with the canonical name.
We'll talk more about CNAME records shortly.</P
></DD
><DT
>NS</DT
><DD
><P
>NS records are used to specify a zone's primary server and all its secondary
servers.  An NS record points to a master name server of the given zone, with
the resource data field containing the hostname of the name server.</P
><P
>You will meet NS records in two situations: The first situation is when you delegate
authority to a subordinate zone; the second is within the master zone database
of the subordinate zone itself. The sets of servers specified in both the
parent and delegated zones should match.</P
><P
>The NS record specifies the name of the primary and secondary name
servers for a zone. These names must be resolved to an address so they
can be used. Sometimes the servers belong to the domain they are
serving, which causes a &#8220;chicken and egg&#8221; problem; we
can't resolve the address until the name server is reachable, but we
can't reach the name server until we resolve its address. To solve
this dilemma, we can configure special A records directly into the
name server of the parent zone. The A records allow the name servers
of the parent domain to resolve the IP address of the delegated
zone name servers. These records are commonly called <EM
>glue
records</EM
> because they provide the &#8220;glue&#8221; that
binds a delegated zone to its parent.</P
></DD
><DT
>CNAME</DT
><DD
><P
>This record associates an alias with a host's <EM
>canonical
hostname</EM
>. It provides an alternate name by which
users can refer to the host whose canonical name is supplied as a
parameter. The canonical hostname is the one the master file provides
an A record for; aliases are simply linked to that name by a CNAME
record, but don't have any other records of their own.</P
></DD
><DT
>PTR</DT
><DD
><P
>&#13;This type of record is used to associate names in the
<SPAN
CLASS="SYSTEMITEM"
>in-addr.arpa</SPAN
> domain with hostnames.
It is used for reverse mapping of IP addresses to hostnames. The hostname
given must be the canonical hostname.</P
></DD
><DT
>MX</DT
><DD
><P
>&#13;This RR announces a <EM
>mail exchanger</EM
> for a domain.
Mail exchangers are discussed in 
<A
HREF="#X-087-2-MAIL.ROUTING.INTERNET"
>Section 17.4.1</A
>.&#8221; The syntax of an MX record is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>[<TT
CLASS="REPLACEABLE"
><I
>domain</I
></TT
>] [<TT
CLASS="REPLACEABLE"
><I
>ttl</I
></TT
>] [<TT
CLASS="REPLACEABLE"
><I
>class</I
></TT
>] MX <TT
CLASS="REPLACEABLE"
><I
>preference</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>host</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
><TT
CLASS="REPLACEABLE"
><I
>host</I
></TT
> names the mail exchanger for
<TT
CLASS="REPLACEABLE"
><I
>domain</I
></TT
>. Every mail exchanger has an integer
<TT
CLASS="REPLACEABLE"
><I
>preference</I
></TT
> associated with it. A mail transport
agent that wants to deliver mail to <TT
CLASS="REPLACEABLE"
><I
>domain</I
></TT
>
tries all hosts who have an MX record for this domain until it succeeds.
The one with the lowest preference value is tried first, then the others, in
order of increasing preference value.</P
></DD
><DT
>HINFO</DT
><DD
><P
>This record provides information on the system's hardware and software.
Its syntax is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>[<TT
CLASS="REPLACEABLE"
><I
>domain</I
></TT
>] [<TT
CLASS="REPLACEABLE"
><I
>ttl</I
></TT
>] [<TT
CLASS="REPLACEABLE"
><I
>class</I
></TT
>] HINFO <TT
CLASS="REPLACEABLE"
><I
>hardware software</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <TT
CLASS="REPLACEABLE"
><I
>hardware</I
></TT
> field identifies the hardware used by
this host. Special conventions are used to specify this. A list of valid
&#8220;machine names&#8221; is given in the Assigned Numbers RFC (RFC-1700).
If the field contains any blanks, it must be enclosed in double quotes. The
<TT
CLASS="REPLACEABLE"
><I
>software</I
></TT
> field names the operating system software
used by the system. Again, a valid name from the Assigned Numbers RFC should
be chosen.</P
><P
>An <TT
CLASS="LITERAL"
>HINFO</TT
> record to describe an Intel-based Linux machine
should look something like:


<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>tao	 36500  IN  HINFO  IBM-PC  LINUX2.2</PRE
></FONT
></TD
></TR
></TABLE
>

and <TT
CLASS="LITERAL"
>HINFO</TT
> records for Linux running on Motorola 68000-based
machines might look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>cevad 36500 IN  HINFO  ATARI-104ST LINUX2.0
jedd  36500 IN  HINFO  AMIGA-3000  LINUX2.0</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-RESOLV.NAMED-CACHINGONLY"
>6.3.4. Caching-only named Configuration</A
></H3
><P
>There is a special type of <TT
CLASS="FILENAME"
>named</TT
> configuration
that we'll talk about before we explain how to build a full name
server configuration.  It is called a
<EM
>caching-only</EM
> configuration. It doesn't really
serve a domain, but acts as a relay for all DNS queries produced on
your host.  The advantage of this scheme is that it builds up a cache
so only the first query for a particular host is actually sent to the
name servers on the Internet. Any repeated request will be answered
directly from the cache in your local name server. This may not seem
useful yet, but it will when you are dialing in to the Internet, as
described in <A
HREF="#X-087-2-SLIP"
>Chapter 7</A
> and <A
HREF="#X-087-2-PPP"
>Chapter 8</A
>.</P
><P
>A <TT
CLASS="FILENAME"
>named.boot</TT
> file for a caching-only server looks like
this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>; named.boot file for caching-only server
directory                            /var/named
primary       0.0.127.in-addr.arpa   named.local ; localhost network
cache         .                      named.ca    ; root servers</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>In addition to this <TT
CLASS="FILENAME"
>named.boot</TT
> file, you must set
up the <TT
CLASS="FILENAME"
>named.ca</TT
> file with a valid list of root
name servers. You could copy and use <A
HREF="#X-087-2-RESOLV.FIG.NAMED.CACHE"
>Example 6-10</A
> for this purpose. No other
files are needed for a caching-only server configuration.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN5711"
>6.3.5. Writing the Master Files</A
></H3
><P
><A
HREF="#X-087-2-RESOLV.FIG.NAMED.CACHE"
>Example 6-10</A
>,
<A
HREF="#X-087-2-RESOLV.FIG.NAMED.HOSTS"
>Example 6-11</A
>,
<A
HREF="#X-087-2-RESOLV.FIG.NAMED.LOCAL"
>Example 6-12</A
>, and
<A
HREF="#X-087-2-RESOLV.FIG.NAMED.REV"
>Example 6-13</A
> give sample files for a name
server at the brewery, located on
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>. Due to the nature of the
network discussed (a single LAN), the example is pretty straightforward.</P
><P
>&#13;
The <TT
CLASS="FILENAME"
>named.ca</TT
> cache file shown in
<A
HREF="#X-087-2-RESOLV.FIG.NAMED.CACHE"
>Example 6-10</A
> shows sample hint records for
a root name server. A typical cache file usually describes about a dozen name servers. You can obtain the current list of name servers for the root
domain using the <B
CLASS="COMMAND"
>nslookup</B
> tool described in the next
section.<A
NAME="X-087-2-FNDN03"
HREF="#FTN.X-087-2-FNDN03"
><SPAN
CLASS="footnote"
>[43]</SPAN
></A
>&#13;</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-RESOLV.FIG.NAMED.CACHE"
></A
><P
><B
>Example 6-10. The named.ca File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>;
; /var/named/named.ca          Cache file for the brewery.
;                We're not on the Internet, so we don't need
;                any root servers. To activate these
;                records, remove the semicolons.
;
;.                        3600000  IN  NS    A.ROOT-SERVERS.NET.
;A.ROOT-SERVERS.NET.      3600000      A     198.41.0.4
;.                        3600000      NS    B.ROOT-SERVERS.NET.
;B.ROOT-SERVERS.NET.      3600000      A     128.9.0.107
;.                        3600000      NS    C.ROOT-SERVERS.NET.
;C.ROOT-SERVERS.NET.      3600000      A     192.33.4.12
;.                        3600000      NS    D.ROOT-SERVERS.NET.
;D.ROOT-SERVERS.NET.      3600000      A     128.8.10.90
;.                        3600000      NS    E.ROOT-SERVERS.NET.
;E.ROOT-SERVERS.NET.      3600000      A     192.203.230.10
;.                        3600000      NS    F.ROOT-SERVERS.NET.
;F.ROOT-SERVERS.NET.      3600000      A     192.5.5.241
;.                        3600000      NS    G.ROOT-SERVERS.NET.
;G.ROOT-SERVERS.NET.      3600000      A     192.112.36.4
;.                        3600000      NS    H.ROOT-SERVERS.NET.
;H.ROOT-SERVERS.NET.      3600000      A     128.63.2.53
;.                        3600000      NS    I.ROOT-SERVERS.NET.
;I.ROOT-SERVERS.NET.      3600000      A     192.36.148.17
;.                        3600000      NS    J.ROOT-SERVERS.NET.
;J.ROOT-SERVERS.NET.      3600000      A     198.41.0.10
;.                        3600000      NS    K.ROOT-SERVERS.NET.
;K.ROOT-SERVERS.NET.      3600000      A     193.0.14.129 
;.                        3600000      NS    L.ROOT-SERVERS.NET.
;L.ROOT-SERVERS.NET.      3600000      A     198.32.64.12
;.                        3600000      NS    M.ROOT-SERVERS.NET.
;M.ROOT-SERVERS.NET.      3600000      A     202.12.27.33
;</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-RESOLV.FIG.NAMED.HOSTS"
></A
><P
><B
>Example 6-11. The named.hosts File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>;
; /var/named/named.hosts       Local hosts at the brewery
;                               Origin is vbrew.com
;
@                IN  SOA   vlager.vbrew.com. janet.vbrew.com. (
                           2000012601 ; serial
                           86400      ; refresh: once per day
                           3600       ; retry:   one hour
                           3600000    ; expire:  42 days
                           604800     ; minimum: 1 week
                           )
                 IN  NS    vlager.vbrew.com.
;
; local mail is distributed on vlager
                 IN  MX    10 vlager
;
; loopback address
localhost.       IN  A     127.0.0.1
;
; Virtual Brewery Ethernet
vlager           IN  A     172.16.1.1
vlager-if1       IN  CNAME vlager
; vlager is also news server
news             IN  CNAME vlager
vstout           IN  A     172.16.1.2
vale             IN  A     172.16.1.3
;
; Virtual Winery Ethernet
vlager-if2       IN  A     172.16.2.1
vbardolino       IN  A     172.16.2.2
vchianti         IN  A     172.16.2.3
vbeaujolais      IN  A     172.16.2.4
;
; Virtual Spirits (subsidiary) Ethernet
vbourbon         IN  A     172.16.3.1
vbourbon-if1     IN  CNAME vbourbon</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-RESOLV.FIG.NAMED.LOCAL"
></A
><P
><B
>Example 6-12. The named.local File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>;
; /var/named/named.local       Reverse mapping of 127.0.0
;                              Origin is 0.0.127.in-addr.arpa.
;
@             IN  SOA   vlager.vbrew.com. joe.vbrew.com. (
                        1          ; serial
                        360000     ; refresh: 100 hrs
                        3600       ; retry:   one hour
                        3600000    ; expire:  42 days
                        360000     ; minimum: 100 hrs
                        )
              IN  NS    vlager.vbrew.com.
1             IN  PTR   localhost.</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-RESOLV.FIG.NAMED.REV"
></A
><P
><B
>Example 6-13. The named.rev File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>;
; /var/named/named.rev         Reverse mapping of our IP addresses
;                               Origin is 16.172.in-addr.arpa.
;
@             IN  SOA   vlager.vbrew.com. joe.vbrew.com. (
                          16         ; serial
                          86400      ; refresh: once per day
                          3600       ; retry:   one hour
                          3600000    ; expire:  42 days
                          604800     ; minimum: 1 week
                          )
              IN  NS    vlager.vbrew.com.
; brewery
1.1           IN  PTR   vlager.vbrew.com.
2.1           IN  PTR   vstout.vbrew.com.
3.1           IN  PTR   vale.vbrew.com.
; winery
1.2           IN  PTR   vlager-if2.vbrew.com.
2.2           IN  PTR   vbardolino.vbrew.com.
3.2           IN  PTR   vchianti.vbrew.com.
4.2           IN  PTR   vbeaujolais.vbrew.com.</PRE
></FONT
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-RESOLV.NSLOOKUP"
>6.3.6. Verifying the Name Server Setup</A
></H3
><P
><B
CLASS="COMMAND"
>nslookup</B
> is a great tool for checking the operation
of your name server setup. It can be used both interactively with
prompts and as a single command with immediate output. In the latter
case, you simply invoke it as:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>nslookup</KBD
>
<EM
><TT
CLASS="LITERAL"
>hostname</TT
></EM
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
><B
CLASS="COMMAND"
>nslookup</B
> queries the name server specified in
<TT
CLASS="FILENAME"
>resolv.conf</TT
> for <TT
CLASS="REPLACEABLE"
><I
>hostname</I
></TT
>.
(If this file names more than one server, <B
CLASS="COMMAND"
>nslookup</B
> chooses
one at random.)</P
><P
>The interactive mode, however, is much more exciting. Besides looking up
individual hosts, you may query for any type of DNS record and transfer
the entire zone information for a domain.</P
><P
>When invoked without an argument, <B
CLASS="COMMAND"
>nslookup</B
> displays the name
server it uses and enters interactive mode. At the <B
CLASS="COMMAND"
>&#62;</B
> prompt,
you may type any domain name you want to query. By default, it asks
for class A records, those containing the IP address relating to the
domain name.</P
><P
>You can look for record types by issuing:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>&#62; <KBD
CLASS="USERINPUT"
>set type=</KBD
><TT
CLASS="LITERAL"
>type</TT
></PRE
></FONT
></TD
></TR
></TABLE
><P
>in which <TT
CLASS="REPLACEABLE"
><I
>type</I
></TT
> is one of the resource record names described
earlier, or ANY.</P
><P
>You might have the following <B
CLASS="COMMAND"
>nslookup</B
> session:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>nslookup</KBD
>
Default Server:  tao.linux.org.au
Address:  203.41.101.121

&#62; <KBD
CLASS="USERINPUT"
>metalab.unc.edu</KBD
>
Server:  tao.linux.org.au
Address:  203.41.101.121

Name:    metalab.unc.edu
Address:  152.2.254.81

&#62;</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The output first displays the DNS server being queried, and then the result
of the query.</P
><P
>If you try to query for a name that has no IP address associated with it,
but other records were found in the DNS database, <B
CLASS="COMMAND"
>nslookup</B
>
returns with an error message saying
&#8220;<TT
CLASS="LITERAL"
>No type A records found</TT
>.&#8221; However, you can
make it query for records other than type A by issuing the
<B
CLASS="COMMAND"
>set type</B
> command. To get the SOA record of
<SPAN
CLASS="SYSTEMITEM"
>unc.edu</SPAN
>, you would issue:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>&#62; <KBD
CLASS="USERINPUT"
>unc.edu</KBD
>
Server:  tao.linux.org.au
Address:  203.41.101.121

*** No address (A) records available for unc.edu
&#62; <KBD
CLASS="USERINPUT"
>set type=SOA</KBD
>
&#62; <KBD
CLASS="USERINPUT"
>unc.edu</KBD
>
Server:  tao.linux.org.au
Address:  203.41.101.121

unc.edu
        origin = ns.unc.edu
        mail addr = host-reg.ns.unc.edu
        serial = 1998111011
        refresh = 14400 (4H)
        retry   = 3600 (1H)
        expire  = 1209600 (2W)
        minimum ttl = 86400 (1D)
unc.edu name server = ns2.unc.edu
unc.edu name server = ncnoc.ncren.net
unc.edu name server = ns.unc.edu
ns2.unc.edu     internet address = 152.2.253.100
ncnoc.ncren.net internet address = 192.101.21.1
ncnoc.ncren.net internet address = 128.109.193.1
ns.unc.edu      internet address = 152.2.21.1</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>In a similar fashion, you can query for MX records:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>&#62; <KBD
CLASS="USERINPUT"
>set type=MX</KBD
>
&#62; <KBD
CLASS="USERINPUT"
>unc.edu</KBD
>
Server:  tao.linux.org.au
Address:  203.41.101.121

unc.edu preference = 0, mail exchanger = conga.oit.unc.edu
unc.edu preference = 10, mail exchanger = imsety.oit.unc.edu
unc.edu name server = ns.unc.edu
unc.edu name server = ns2.unc.edu
unc.edu name server = ncnoc.ncren.net
conga.oit.unc.edu       internet address = 152.2.22.21
imsety.oit.unc.edu      internet address = 152.2.21.99
ns.unc.edu      internet address = 152.2.21.1
ns2.unc.edu     internet address = 152.2.253.100
ncnoc.ncren.net internet address = 192.101.21.1
ncnoc.ncren.net internet address = 128.109.193.1</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Using a type of ANY returns all resource records associated with a given name.</P
><P
>&#13;
A practical application of <B
CLASS="COMMAND"
>nslookup</B
>, besides debugging, is
to obtain the current list of root name servers.  You can obtain this list by querying
for all NS records associated with the root domain:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>&#62; <KBD
CLASS="USERINPUT"
>set type=NS</KBD
>
&#62; <KBD
CLASS="USERINPUT"
>.</KBD
>
Server:  tao.linux.org.au
Address:  203.41.101.121

Non-authoritative answer:
(root)  name server = A.ROOT-SERVERS.NET
(root)  name server = H.ROOT-SERVERS.NET
(root)  name server = B.ROOT-SERVERS.NET
(root)  name server = C.ROOT-SERVERS.NET
(root)  name server = D.ROOT-SERVERS.NET
(root)  name server = E.ROOT-SERVERS.NET
(root)  name server = I.ROOT-SERVERS.NET
(root)  name server = F.ROOT-SERVERS.NET
(root)  name server = G.ROOT-SERVERS.NET
(root)  name server = J.ROOT-SERVERS.NET
(root)  name server = K.ROOT-SERVERS.NET
(root)  name server = L.ROOT-SERVERS.NET
(root)  name server = M.ROOT-SERVERS.NET

Authoritative answers can be found from:
A.ROOT-SERVERS.NET      internet address = 198.41.0.4
H.ROOT-SERVERS.NET      internet address = 128.63.2.53
B.ROOT-SERVERS.NET      internet address = 128.9.0.107
C.ROOT-SERVERS.NET      internet address = 192.33.4.12
D.ROOT-SERVERS.NET      internet address = 128.8.10.90
E.ROOT-SERVERS.NET      internet address = 192.203.230.10
I.ROOT-SERVERS.NET      internet address = 192.36.148.17
F.ROOT-SERVERS.NET      internet address = 192.5.5.241
G.ROOT-SERVERS.NET      internet address = 192.112.36.4
J.ROOT-SERVERS.NET      internet address = 198.41.0.10
K.ROOT-SERVERS.NET      internet address = 193.0.14.129
L.ROOT-SERVERS.NET      internet address = 198.32.64.12
M.ROOT-SERVERS.NET      internet address = 202.12.27.33</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>To see the complete set of available commands, use the <B
CLASS="COMMAND"
>help</B
>
command in <B
CLASS="COMMAND"
>nslookup</B
>.</P
><P
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN5821"
>6.3.7. Other Useful Tools</A
></H3
><P
>There are a few tools that can help you with your tasks as a BIND
administrator. We will briefly describe two of them here. Please refer to
the documentation that comes with these tools for more information on how
to use them.</P
><P
>   <B
CLASS="COMMAND"
>hostcvt</B
> helps you
with your initial BIND configuration by converting your
<TT
CLASS="FILENAME"
>/etc/hosts</TT
> file into master files for
<B
CLASS="COMMAND"
>named</B
>. It generates both the forward (A) and
reverse mapping (PTR) entries, and takes care of aliases. Of course,
it won't do the whole job for you, as you may still want to tune the
timeout values in the SOA record, for example, or add MX
records. Still, it may help you save a few
aspirins. <B
CLASS="COMMAND"
>hostcvt</B
> is part of the BIND source, but
can also be found as a standalone package on a few Linux FTP servers.</P
><P
>  
 After setting up your name server,
you may want to test your configuration.  Some good tools
that make this job much simpler: the first is called
<B
CLASS="COMMAND"
>dnswalk</B
>, which is a Perl-based package.  The second
is called <B
CLASS="COMMAND"
>nslint</B
>. They both walk your DNS database
looking for common mistakes and verify that the information they find
is consistent. Two other useful tools are <B
CLASS="COMMAND"
>host</B
> and
<B
CLASS="COMMAND"
>dig</B
>, which are general purpose DNS database query 
tools. You can use these tools to manually inspect and diagnose DNS 
database entries.</P
><P
>These tools are likely to be available in prepackaged form.
<B
CLASS="COMMAND"
>dnswalk</B
> and <B
CLASS="COMMAND"
>nslint</B
> are available
in source from <SPAN
CLASS="SYSTEMITEM"
>http://www.visi.com/~barr/dnswalk/</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>ftp://ftp.ee.lbl.gov/nslint.tar.Z</SPAN
>. The
<B
CLASS="COMMAND"
>host</B
> and <B
CLASS="COMMAND"
>dig</B
> source codes can be
found at <SPAN
CLASS="SYSTEMITEM"
>ftp://ftp.nikhef.nl/pub/network/</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>ftp://ftp.is.co.za/networking/ip/dns/dig/</SPAN
>.</P
><P
>&#13;





&#13;</P
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-SLIP"
></A
>Chapter 7. Serial Line IP</H1
><P
>Packet protocols like IP or IPX rely upon the receiver host knowing
where the start and end of each packet are in the data stream. The
mechanism used to mark and detect the start and end of packets is
called <EM
>delimitation</EM
>. The Ethernet protocol
manages this mechanism in a LAN environment, and the SLIP and PPP protocols
manage it for serial communications lines.</P
><P
>The comparatively low cost of low-speed dialup modems and telephone circuits
has made the serial line IP protocols immensely popular, especially for
providing connectivity to end users of the Internet. The hardware required
to run SLIP or PPP is simple and readily available. All that is required is
a modem and a serial port equipped with a FIFO buffer.</P
><P
>The SLIP protocol is very simple to implement and at one time was the more
common of the two. Today almost everyone uses the PPP protocol instead. The
PPP protocol adds a host of sophisticated features that contribute to its
popularity today, and we'll look at the most important of these later.</P
><P
>Linux supports kernel-based drivers for both SLIP and PPP. The drivers
have both been around for some time and are stable and reliable. In
this chapter and the next, we'll discuss both protocols and how to
configure them.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-SLIP.GENERAL"
>7.1. General Requirements</A
></H2
><P
>To use SLIP or PPP, you have to configure some basic networking
features as described in the previous chapters. You must set up the
loopback interface and configure the name resolver. When connecting to
the Internet, you will want to use DNS. Your options here are the same
as for PPP: you can perform your DNS queries across your serial link
by configuring your Internet Service Provider's IP address into your
<TT
CLASS="FILENAME"
>/etc/resolv.conf</TT
> file, or configure a
caching-only name server as described under <A
HREF="#X-087-2-RESOLV.NAMED-CACHINGONLY"
>Section 6.3.4</A
>,&#8221; in <A
HREF="#X-087-2-RESOLV"
>Chapter 6</A
>."</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-SLIP.OPERATION"
>7.2. SLIP Operation</A
></H2
><P
>Dialup IP servers frequently offer SLIP service through special user
accounts. After logging in to such an account, you are not dropped into
the common shell; instead, a program or shell script is executed that
enables the server's SLIP driver for the serial line and configures the
appropriate network interface. Then you have to do the same at your end
of the link.</P
><P
>On some operating systems, the SLIP driver is a user-space program;
under Linux, it is part of the kernel, which makes it a lot faster.
This speed requires, however, that the serial line be converted to the
SLIP mode explicitly. This conversion is done by means of a special
tty line discipline, SLIPDISC. While the tty is in normal line
discipline (DISC0), it exchanges data only with user processes, using
the normal <CODE
CLASS="FUNCTION"
>read(2)</CODE
> and
<CODE
CLASS="FUNCTION"
>write(2)</CODE
> calls, and the SLIP driver is unable to
write to or read from the tty. In SLIPDISC, the roles are reversed:
now any user-space processes are blocked from writing to or reading
from the tty, while all data coming in on the serial port is passed
directly to the SLIP driver.</P
><P
>   The SLIP driver itself
understands a number of variations on the SLIP protocol. Apart from
ordinary SLIP, it also understands CSLIP, which performs the so-called
Van Jacobson header compression (described in RFC-1144) on outgoing IP
packets. This compression improves throughput for interactive sessions
noticeably. There are also six-bit versions for each of these
protocols.</P
><P
>&#13;A simple way to convert a serial line to SLIP mode is by using the
<B
CLASS="COMMAND"
>slattach</B
> tool. Assume you have your modem on
<TT
CLASS="FILENAME"
>/dev/ttyS3</TT
> and have logged in to the SLIP server
successfully. You will then execute:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>slattach /dev/ttyS3 &#38;</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This tool switches the line discipline of <TT
CLASS="FILENAME"
>ttyS3</TT
> to
<TT
CLASS="LITERAL"
>SLIPDISC</TT
> and attaches it to one of the SLIP network
interfaces. If this is your first active SLIP link, the line will be attached
to <TT
CLASS="FILENAME"
>sl0</TT
>&#8201;; the second will be attached to
<TT
CLASS="FILENAME"
>sl1</TT
>, and so on. The current kernels support a default
maximum of 256 simultaneous SLIP links.</P
><P
>&#13;The default line discipline chosen by <B
CLASS="COMMAND"
>slattach</B
> is CSLIP.
You may choose any other discipline using the <CODE
CLASS="OPTION"
>&#8211;p</CODE
> switch.
To use normal SLIP (no compression), you use:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>slattach -p slip /dev/ttyS3 &#38;</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The disciplines available are listed in <A
HREF="#X-087-2-SLIP.LINE.DISCIPLINES"
>Table 7-1</A
>. A special pseudo-discipline
is available called <TT
CLASS="LITERAL"
>adaptive</TT
>, which causes the
kernel to automatically detect which type of SLIP encapsulation is
being used by the remote end.</P
><DIV
CLASS="TABLE"
><A
NAME="X-087-2-SLIP.LINE.DISCIPLINES"
></A
><P
><B
>Table 7-1. Linux Slip-Line Disciplines</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL
WIDTH="0"><COL
WIDTH="4"><THEAD
><TR
><TH
><P
>Disclipline</P
></TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
>slip</TD
><TD
><P
>Traditional SLIP encapsulation.</P
></TD
></TR
><TR
><TD
>cslip</TD
><TD
><P
>SLIP encapsulation with Van Jacobsen header compression.</P
></TD
></TR
><TR
><TD
>slip6</TD
><TD
><P
>SLIP encapsulation with six-bit encoding. The encoding method is
	similar to that used by the <B
CLASS="COMMAND"
>uuencode</B
> command, and causes
	the SLIP datagram to be converted into printable ASCII characters. This conversion is
	useful when you do not have a serial link that is eight bit clean.</P
></TD
></TR
><TR
><TD
>cslip6</TD
><TD
><P
>SLIP encapsulation with Van Jacobsen header compression and six-bit
	encoding.</P
></TD
></TR
><TR
><TD
>adaptive</TD
><TD
><P
>This is not a real line discipline; instead, it causes the kernel to
	attempt to identify the line discipline being used by the remote machine and
	to match it.</P
></TD
></TR
></TBODY
></TABLE
></DIV
><P
>Note that you must use the same encapsulation as your peer. For
example, if <SPAN
CLASS="SYSTEMITEM"
>cowslip</SPAN
> uses
CSLIP, you also have to do so. If your SLIP connection doesn't work,
the first thing you should do is ensure that both ends of the link
agree on whether to use header compression or not. If you are unsure
what the remote end is using, try configuring your host for adaptive
slip. The kernel might figure out the right type for you.</P
><P
><B
CLASS="COMMAND"
>slattach</B
> lets you enable not only SLIP, but other
protocols that use the serial line, like PPP or KISS (another
protocol used by ham radio people). Doing this is not common, though, and there are
better tools available to support these protocols. For details, please refer
to the <TT
CLASS="FILENAME"
>slattach(8)</TT
> manual page.</P
><P
>After turning over the line to the SLIP driver, you must configure the
network interface. Again, you do this using the standard
<B
CLASS="COMMAND"
>ifconfig</B
> and <B
CLASS="COMMAND"
>route</B
>
commands. Assume that we have dialed up a server named <SPAN
CLASS="SYSTEMITEM"
>cowslip</SPAN
> from <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>. On <EM
>vlager</EM
> you would execute:

 
 
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ifconfig sl0 vlager-slip pointopoint cowslip</KBD
>
# <KBD
CLASS="USERINPUT"
>route add cowslip</KBD
>
# <KBD
CLASS="USERINPUT"
>route add default gw cowslip</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The first command configures the interface as a point-to-point link to
<SPAN
CLASS="SYSTEMITEM"
>cowslip</SPAN
>, while the second and third
add the route to <SPAN
CLASS="SYSTEMITEM"
>cowslip</SPAN
> and the
default route, using <SPAN
CLASS="SYSTEMITEM"
>cowslip</SPAN
> as a
gateway.</P
><P
>Two things are worth noting about the <B
CLASS="COMMAND"
>ifconfig</B
>
invocation: The <SPAN
CLASS="SYSTEMITEM"
>pointopoint</SPAN
>
option that specifies the address of the remote end of a
point-to-point link and our use of <SPAN
CLASS="SYSTEMITEM"
>vlager-slip</SPAN
> as the address of the local
SLIP interface.</P
><P
>We have mentioned that you can use the same address you assigned to
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>'s Ethernet interface
for your SLIP link, as well. In this case, <SPAN
CLASS="SYSTEMITEM"
>vlager-slip</SPAN
> might just be another alias
for address <SPAN
CLASS="SYSTEMITEM"
>172.16.1.1</SPAN
>.
However, it is also possible that you have to use an entirely
different address for your SLIP link. One such case is when your
network uses an unregistered IP network address, as the Brewery
does. We will return to this scenario in greater detail in the next
section.</P
><P
>For the remainder of this chapter we will always use
<SPAN
CLASS="SYSTEMITEM"
>vlager-slip</SPAN
> to refer to the address
of the local SLIP interface.</P
><P
>When taking down the SLIP link, you should first remove all routes
through <SPAN
CLASS="SYSTEMITEM"
>cowslip</SPAN
> using
<B
CLASS="COMMAND"
>route</B
> with the <CODE
CLASS="OPTION"
>del</CODE
> option, then
take the interface down, and send <B
CLASS="COMMAND"
>slattach</B
> the
hangup signal. The you must hang up the modem using your
terminal program again:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>route del default</KBD
>
# <KBD
CLASS="USERINPUT"
>route del cowslip</KBD
>
# <KBD
CLASS="USERINPUT"
>ifconfig sl0 down</KBD
>
# <KBD
CLASS="USERINPUT"
>kill -HUP <TT
CLASS="REPLACEABLE"
><I
>516</I
></TT
></KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

Note that the <TT
CLASS="REPLACEABLE"
><I
>516</I
></TT
> should be replaced with the
process id (as shown in the output of
<KBD
CLASS="USERINPUT"
>ps ax</KBD
>) of the <B
CLASS="COMMAND"
>slattach</B
>
command controlling the slip device you wish to take down.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN6035"
>7.3. Dealing with Private IP Networks</A
></H2
><P
>You will remember from <A
HREF="#X-087-2-IFACE"
>Chapter 5</A
>, that the
Virtual Brewery has an Ethernet-based IP network using unregistered
network numbers that are reserved for internal use only. Packets to or
from one of these networks are not routed on the Internet; if we were
to have <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> dial into
<SPAN
CLASS="SYSTEMITEM"
>cowslip</SPAN
> and act as a router
for the Virtual Brewery network, hosts within the Brewery's network
could not talk to real Internet hosts directly because their packets
would be dropped silently by the first major router.</P
><P
>To work around this dilemma, we will configure <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> to act as a kind of launch pad for
accessing Internet services. To the outside world, it will present
itself as a normal SLIP-connected Internet host with a registered IP
address (probably assigned by the network provider running <SPAN
CLASS="SYSTEMITEM"
>cowslip</SPAN
>). Anyone logged in to <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> can use text-based programs like
<B
CLASS="COMMAND"
>ftp</B
>, <B
CLASS="COMMAND"
>telnet</B
>, or even
<B
CLASS="COMMAND"
>lynx</B
> to make use of the Internet. Anyone on the
Virtual Brewery LAN can therefore telnet and log in to <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> and use the programs there. For
some applications, there may be solutions that avoid logging in
to <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>. For WWW users, for
example, we could run a so-called <EM
>proxy server</EM
> on
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>, which would relay all
requests from your users to their respective servers.</P
><P
> Having to log in
to <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> to make use of the
Internet is a little clumsy. But apart from eliminating the paperwork
(and cost) of registering an IP network, it has the added benefit of
going along well with a firewall setup. Firewalls are dedicated
hosts used to provide limited Internet access to users on your local
network without exposing the internal hosts to network attacks from
the outside world. Simple firewall configuration is covered in more
detail in <A
HREF="#X-087-2-FIREWALL"
>Chapter 9</A
>. In <A
HREF="#X-087-2-IPMASQ"
>Chapter 11</A
>, we'll discuss a Linux feature called
&#8220;IP masquerade&#8221; that provides a powerful alternative to
proxy servers.</P
><P
>Assume that the Brewery has been assigned the IP address <SPAN
CLASS="SYSTEMITEM"
>192.168.5.74</SPAN
> for SLIP access. All you
have to do to realize that the setup discussed above is to enter this
address into your <TT
CLASS="FILENAME"
>/etc/hosts</TT
> file, naming it
<SPAN
CLASS="SYSTEMITEM"
>vlager-slip</SPAN
>.  The procedure
for bringing up the SLIP link itself remains unchanged.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-SLIP.DIP"
>7.4. Using dip</A
></H2
><P
>Now that was rather simple. Nevertheless, you might want to automate
the steps previously described. It would be much better to have a
simple command that performs all the steps necessary to open the
serial device, cause the modem to dial the provider, log in, enable
the SLIP line discipline, and configure the network interface. This is
what the <B
CLASS="COMMAND"
>dip</B
> command is for.</P
><P
><B
CLASS="COMMAND"
>dip</B
> means <EM
>Dialup IP</EM
>. It was
written by Fred van Kempen and has been patched very heavily by a
number of people. Today there is one strain that is used by almost
everyone: Version <TT
CLASS="LITERAL"
>dip337p-uri</TT
>, which is included
with most modern Linux distributions, or is available from the
<SPAN
CLASS="SYSTEMITEM"
>metalab.unc.edu</SPAN
> FTP archive.</P
><P
><B
CLASS="COMMAND"
>dip</B
> provides an interpreter for a simple scripting
language that can handle the modem for you, convert the line to SLIP mode, and
configure the interfaces. The script language is powerful enough to suit most configurations.</P
><P
>&#13;

To be able to configure the SLIP interface, <B
CLASS="COMMAND"
>dip</B
>
requires root privilege. It would now be tempting to make
<B
CLASS="COMMAND"
>dip</B
> setuid to <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
> so that all users can dial up some
SLIP server without having to give them root access. This is very
dangerous, though, because setting up bogus interfaces and default
routes with <B
CLASS="COMMAND"
>dip</B
> may disrupt routing on your
network. Even worse, this action would give your users power to
connect to <EM
>any</EM
> SLIP server and launch dangerous
attacks on your network. If you want to allow your users to fire up a
SLIP connection, write small wrapper programs for each prospective
SLIP server and have these wrappers invoke <B
CLASS="COMMAND"
>dip</B
> with
the specific script that establishes the connection. Carefully written
wrapper programs can then safely be made setuid to <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
>.<A
NAME="X-087-2-FNSL1"
HREF="#FTN.X-087-2-FNSL1"
><SPAN
CLASS="footnote"
>[44]</SPAN
></A
> An alternative,
more flexible approach is to give trusted users root access to
<B
CLASS="COMMAND"
>dip</B
> using a program like <B
CLASS="COMMAND"
>sudo</B
>.&#13;</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-SLIP.DIP.SAMPLE"
>7.4.1. A Sample Script</A
></H3
><P
>Assume that the host to which we make our SLIP connection is
<SPAN
CLASS="SYSTEMITEM"
>cowslip</SPAN
>, and that we have
written a script for <B
CLASS="COMMAND"
>dip</B
> to run called
<TT
CLASS="FILENAME"
>cowslip.dip</TT
> that makes our connection. We invoke
<B
CLASS="COMMAND"
>dip</B
> with the script name as argument:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>dip cowslip.dip</KBD
>
DIP: Dialup IP Protocol Driver version 3.3.7 (12/13/93)
Written by Fred N. van Kempen, MicroWalt Corporation.
connected to cowslip.moo.com with addr 192.168.5.74
#</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The script itself is shown in <A
HREF="#X-087-2-SLIP.FIG.SCRIPT"
>Example 7-1</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-SLIP.FIG.SCRIPT"
></A
><P
><B
>Example 7-1. A Sample dip Script</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># Sample dip script for dialing up cowslip
# Set local and remote name and address
	get $local vlager-slip
	get $remote cowslip
	port ttyS3                # choose a serial port
	speed 38400              # set speed to max
	modem HAYES              # set modem type
	reset                    # reset modem and tty
	flush                    # flush out modem response
# Prepare for dialing.
	send ATQ0V1E1X1\r
	wait OK 2
	if $errlvl != 0 goto error
	dial 41988
	if $errlvl != 0 goto error
	wait CONNECT 60
	if $errlvl != 0 goto error
# Okay, we're connected now
	sleep 3
	send \r\n\r\n
	wait ogin: 10
	if $errlvl != 0 goto error
	send Svlager\n
	wait ssword: 5
	if $errlvl != 0 goto error
	send knockknock\n
	wait running 30
	if $errlvl != 0 goto error
# We have logged in, and the remote side is firing up SLIP.
	print Connected to $remote with address $rmtip
	default                  # Make this link our default route
	mode SLIP                # We go to SLIP mode, too
# fall through in case of error
error:
	print SLIP to $remote failed.</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>&#13;After connecting to <SPAN
CLASS="SYSTEMITEM"
>cowslip</SPAN
>
and enabling SLIP, <B
CLASS="COMMAND"
>dip</B
> will detach from the
terminal and go to the background. You can then start using the normal
networking services on the SLIP link. To terminate the connection,
simply invoke <B
CLASS="COMMAND"
>dip</B
> with the
<CODE
CLASS="OPTION"
>&#8211;k</CODE
> option. This sends a hangup signal to
<B
CLASS="COMMAND"
>dip</B
>, using the process ID <B
CLASS="COMMAND"
>dip</B
>
records in <TT
CLASS="FILENAME"
>/etc/dip.pid</TT
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>dip -k</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>In <B
CLASS="COMMAND"
>dip</B
>'s scripting language, keywords prefixed with a dollar
symbol denote variable names.  <B
CLASS="COMMAND"
>dip</B
> has a predefined set of variables, which will be listed below.
<SPAN
CLASS="SYSTEMITEM"
>$remote</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>$local</SPAN
>, for instance, contain the
hostnames of the remote and local hosts involved in the SLIP link.</P
><P
>The first two statements in the sample script are <B
CLASS="COMMAND"
>get</B
>
commands, which is <B
CLASS="COMMAND"
>dip</B
>'s way to set a variable. Here, the
local and remote hostnames are set to
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>cowslip</SPAN
>, respectively.</P
><P
>&#13;The next five statements set up the terminal line and the modem.
<SPAN
CLASS="SYSTEMITEM"
>reset</SPAN
> sends a reset string to the modem.
The next statement flushes out the modem response so that the login chat in
the next few lines works properly. This chat is pretty straightforward:
it simply dials 41988, the phone number of
<SPAN
CLASS="SYSTEMITEM"
>cowslip</SPAN
>, and logs in to the account
<SPAN
CLASS="SYSTEMITEM"
>Svlager</SPAN
> using the password
<SPAN
CLASS="SYSTEMITEM"
>knockknock</SPAN
>. The
<SPAN
CLASS="SYSTEMITEM"
>wait</SPAN
> command makes <B
CLASS="COMMAND"
>dip</B
>
wait for the string given as its first argument; the number given as its second
argument makes the wait time out after that many seconds if no such string is
received. The <SPAN
CLASS="SYSTEMITEM"
>if</SPAN
> commands interspersed
in the login procedure check that no error occurred while executing the
command.</P
><P
>The final commands executed after logging in are
<SPAN
CLASS="SYSTEMITEM"
>default</SPAN
>, which makes the SLIP link
the default route to all hosts, and <SPAN
CLASS="SYSTEMITEM"
>mode</SPAN
>,
which enables SLIP mode on the line and configures the interface and routing
table for you.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-SLIP.DIP.REFERENCE"
>7.4.2. A dip Reference</A
></H3
><P
>In this section, we will give a reference for most of
<B
CLASS="COMMAND"
>dip</B
>'s commands. You can get an overview of all the
commands it provides by invoking <B
CLASS="COMMAND"
>dip</B
> in test mode
and entering the <SPAN
CLASS="SYSTEMITEM"
>help</SPAN
>
command. To learn about the syntax of a command, you may enter it
without any arguments. Remember that this does not work with commands
that take no arguments. The following example illustrates the
<SPAN
CLASS="SYSTEMITEM"
>help</SPAN
> command:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>dip -t</KBD
>
DIP: Dialup IP Protocol Driver version 3.3.7p-uri (25 Dec 96)
Written by Fred N. van Kempen, MicroWalt Corporation.
Debian version 3.3.7p-2 (debian).

DIP&#62; <KBD
CLASS="USERINPUT"
>help</KBD
>
DIP knows about the following commands:

	beep         bootp        break        chatkey      config       
	databits     dec          default      dial         echo         
	flush        get          goto         help         if           
	inc          init         mode         modem        netmask      
	onexit       parity       password     proxyarp     print        
	psend        port         quit         reset        securidfixed 
	securid      send         shell        skey         sleep        
	speed        stopbits     term         timeout      wait         

DIP&#62; <KBD
CLASS="USERINPUT"
>echo</KBD
>
Usage: echo on|off
DIP&#62;</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Throughout the following section, examples that display the
<B
CLASS="COMMAND"
>DIP&#8201;&#62;</B
> prompt show how to enter a command in test mode
and what output it produces. Examples lacking this prompt should be taken
as script excerpts.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN6170"
>7.4.2.1. The modem commands</A
></H4
><P
> 
<B
CLASS="COMMAND"
>dip</B
> provides a number of commands that configure your serial
line and modem. Some of these are obvious, such as
<SPAN
CLASS="SYSTEMITEM"
>port</SPAN
>, which selects a serial port, and
<SPAN
CLASS="SYSTEMITEM"
>speed</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>databits</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>stopbits</SPAN
>, and
<SPAN
CLASS="SYSTEMITEM"
>parity</SPAN
>, which set
the common line parameters.

The <SPAN
CLASS="SYSTEMITEM"
>modem</SPAN
> command selects a modem type.
Currently, the only type supported is
<SPAN
CLASS="SYSTEMITEM"
>HAYES</SPAN
> (capitalization required).
You have to provide <B
CLASS="COMMAND"
>dip</B
> with a modem type, or else it will
refuse to execute the <SPAN
CLASS="SYSTEMITEM"
>dial</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>reset</SPAN
> commands. The
<SPAN
CLASS="SYSTEMITEM"
>reset</SPAN
> command sends a reset string
to the modem; the string used depends on the modem type selected. For
Hayes-compatible modems, this string is
<SPAN
CLASS="SYSTEMITEM"
>ATZ</SPAN
>.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>flush</SPAN
> code can be used to flush
out all responses the modem has sent so far. Otherwise, a chat script following
<SPAN
CLASS="SYSTEMITEM"
>reset</SPAN
> might be confused because it reads
the <SPAN
CLASS="SYSTEMITEM"
>OK</SPAN
> responses from earlier commands.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>init</SPAN
> command selects an
initialization string to be passed to the modem before dialing. The
default for Hayes modems is &#8220;<SPAN
CLASS="SYSTEMITEM"
>ATE0 Q0
V1 X1</SPAN
>&#8221;, which turns on echoing of commands and long
result codes, and selects blind dialing (no checking of dial
tone). Modern modems have a good factory default configuration, so
this is a little unnecessary, though it does no harm.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>dial</SPAN
> command sends the
initialization string to the modem and dials up the remote system. The
default dial command for Hayes modems is <SPAN
CLASS="SYSTEMITEM"
>ATD</SPAN
>.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN6200"
>7.4.2.2. The echo command</A
></H4
><P
>The <SPAN
CLASS="SYSTEMITEM"
>echo</SPAN
> command serves as a debugging
aid. Calling <SPAN
CLASS="SYSTEMITEM"
>echo on</SPAN
> makes
<B
CLASS="COMMAND"
>dip</B
> echo to the console everything it sends to
the serial device. This can be turned off again by calling
<SPAN
CLASS="SYSTEMITEM"
>echo off</SPAN
>.</P
><P
><B
CLASS="COMMAND"
>dip</B
> also allows you to leave script mode
temporarily and enter terminal mode. In this mode, you can use
<B
CLASS="COMMAND"
>dip</B
> just like any ordinary terminal program,
writing the characters you type to the serial line, reading data from
the serial line, and displaying the characters. To leave this mode,
enter Ctrl-].</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN6210"
>7.4.2.3. The get command</A
></H4
><P
> 
The <SPAN
CLASS="SYSTEMITEM"
>get</SPAN
> command is
<B
CLASS="COMMAND"
>dip</B
>'s way of setting a variable. The simplest form is to
set a variable to a constant, as we did in <TT
CLASS="FILENAME"
>cowslip.dip</TT
>.
You may, however, also prompt the user for input by specifying the keyword
<SPAN
CLASS="SYSTEMITEM"
>ask</SPAN
> instead of a value:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>DIP&#62; <KBD
CLASS="USERINPUT"
>get $local ask</KBD
>
Enter the value for $local: _</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>A third method is to obtain the value from the remote host.
Bizarre as it seems at first, this is very useful in some cases.
Some SLIP servers will not allow you to use your own IP address on the
SLIP link, but will rather assign you one from a pool of addresses
whenever you dial in, printing some message that informs you about
the address you have been assigned. If the message looks something
like &#8220;<TT
CLASS="LITERAL"
>Your address: 192.168.5.74</TT
>&#8221;,
the following piece of <B
CLASS="COMMAND"
>dip</B
> code would let you
pick up the address:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># finish login
wait address: 10
get $locip remote</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN6225"
>7.4.2.4. The print command</A
></H4
><P
> 
This is the command used to echo text to the console from which
<B
CLASS="COMMAND"
>dip</B
> was started. Any of <B
CLASS="COMMAND"
>dip</B
>'s
variables may be used in print commands. Here's an example:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>DIP&#62; <KBD
CLASS="USERINPUT"
>print Using port $port at speed $speed</KBD
>
Using port ttyS3 at speed 38400</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN6234"
>7.4.2.5. Variable names</A
></H4
><P
><B
CLASS="COMMAND"
>dip</B
> understands only a predefined set of variables. A
variable name always begins with a dollar symbol and must be written in
lowercase letters.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>$local</SPAN
> and <SPAN
CLASS="SYSTEMITEM"
>$locip</SPAN
> variables contain the local host's
name and IP address. When you store the canonical hostname in
<SPAN
CLASS="SYSTEMITEM"
>$local</SPAN
>, <B
CLASS="COMMAND"
>dip</B
>
will automatically attempt to resolve the hostname to an IP address
and to store it in the <SPAN
CLASS="SYSTEMITEM"
>$locip</SPAN
>
variable. A similar but backward process occurs when you assign an IP
address to the <SPAN
CLASS="SYSTEMITEM"
>$locip</SPAN
>
variable; <B
CLASS="COMMAND"
>dip</B
> will attempt to perform a reverse
lookup to identify the name of the host and store it in the
<SPAN
CLASS="SYSTEMITEM"
>$local</SPAN
> variable.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>$remote</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>$rmtip</SPAN
> variables operate in the same
way for the remote host's name and address.
<SPAN
CLASS="SYSTEMITEM"
>$mtu</SPAN
> contains the MTU value for
the connection.</P
><P
>These five variables are the only ones that may be assigned values
directly using the <SPAN
CLASS="SYSTEMITEM"
>get</SPAN
> command. A
number of other variables are set as a result of the configuration
commands bearing the same name, but may be used in
<SPAN
CLASS="SYSTEMITEM"
>print</SPAN
> statements;
these variables are <SPAN
CLASS="SYSTEMITEM"
>$modem</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>$port</SPAN
>, and
<SPAN
CLASS="SYSTEMITEM"
>$speed</SPAN
>.</P
><P
><SPAN
CLASS="SYSTEMITEM"
>$errlvl</SPAN
> is the variable through which
you can access the result of the last command executed. An error level of 0
indicates success, while a nonzero value denotes an error.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN6259"
>7.4.2.6. The if and goto commands</A
></H4
><P
>The <SPAN
CLASS="SYSTEMITEM"
>if</SPAN
> command is a conditional
branch, rather than a full-featured programming <EM
>if</EM
>
statement. Its syntax is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>if <TT
CLASS="REPLACEABLE"
><I
>var</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>op</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>number</I
></TT
> goto <TT
CLASS="REPLACEABLE"
><I
>label</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The expression must be a simple comparison between one of the variables
<SPAN
CLASS="SYSTEMITEM"
>$errlvl</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>$locip</SPAN
>, and
<SPAN
CLASS="SYSTEMITEM"
>$rmtip</SPAN
>.
<TT
CLASS="REPLACEABLE"
><I
>var</I
></TT
> must be an integer number; the operator
<TT
CLASS="REPLACEABLE"
><I
>op</I
></TT
> may be one of <TT
CLASS="LITERAL"
>==</TT
>,
<TT
CLASS="LITERAL"
>!=</TT
>, <TT
CLASS="LITERAL"
>&#60;</TT
>, <TT
CLASS="LITERAL"
>&#62;</TT
>,
<TT
CLASS="LITERAL"
>&#60;=</TT
>, and <TT
CLASS="LITERAL"
>&#62;=</TT
>.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>goto</SPAN
> command makes the execution
of the script continue at the line following that bearing the
<TT
CLASS="REPLACEABLE"
><I
>label</I
></TT
>. A label must be the first word
on the line and must be followed immediately by a colon.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN6284"
>7.4.2.7. send, wait, and sleep</A
></H4
><P
>These commands help implement simple chat scripts in
<B
CLASS="COMMAND"
>dip</B
>. The <SPAN
CLASS="SYSTEMITEM"
>send</SPAN
> command outputs its arguments to the
serial line. It does not support variables, but understands all
C-style backslash character sequences, such as <SPAN
CLASS="SYSTEMITEM"
>\n</SPAN
> for newline and <SPAN
CLASS="SYSTEMITEM"
>\b</SPAN
> for backspace.  The tilde character (~)
can be used as an abbreviation for carriage return/newline.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>wait</SPAN
> command takes a word
as an argument and will read all input on the serial line until it
detects a sequence of characters that match this word. The word itself
may not contain any blanks.  Optionally, you may give <SPAN
CLASS="SYSTEMITEM"
>wait</SPAN
> a timeout value as a second argument;
if the expected word is not received within that many seconds, the
command will return with an <SPAN
CLASS="SYSTEMITEM"
>$errlvl</SPAN
> value of 1. This command is used
to detect login and other prompts.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>sleep</SPAN
> command may be used to
wait for a certain amount of time; for instance, to patiently wait for any
login sequence to complete. Again, the interval is specified in seconds.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN6297"
>7.4.2.8. mode and default</A
></H4
><P
>These commands are used to flip the serial line to SLIP mode and
configure the interface. </P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>mode</SPAN
> command is the last command
executed by <B
CLASS="COMMAND"
>dip</B
> before going into daemon mode. Unless
an error occurs, the command does not return.</P
><P
><SPAN
CLASS="SYSTEMITEM"
>mode</SPAN
> takes a protocol name as
argument. <B
CLASS="COMMAND"
>dip</B
> currently recognizes
<SPAN
CLASS="SYSTEMITEM"
>SLIP</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>CSLIP</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>SLIP6</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>CSLIP6</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>PPP</SPAN
>,
and <SPAN
CLASS="SYSTEMITEM"
>TERM</SPAN
> as valid names. The current
version of <B
CLASS="COMMAND"
>dip</B
> does not understand adaptive SLIP, however.</P
><P
>After enabling SLIP mode on the serial line, <B
CLASS="COMMAND"
>dip</B
> executes
<B
CLASS="COMMAND"
>ifconfig</B
> to configure the interface as a point-to-point
link, and invokes <B
CLASS="COMMAND"
>route</B
> to set the route to the remote host.</P
><P
>If, in addition, the script executes the <SPAN
CLASS="SYSTEMITEM"
>default</SPAN
> command before <SPAN
CLASS="SYSTEMITEM"
>mode</SPAN
>, <B
CLASS="COMMAND"
>dip</B
> creates a
default route that points to the SLIP link.</P
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-SLIP.SERVER"
>7.5. Running in Server Mode</A
></H2
><P
>Setting up your SLIP client was the hard part. Configuring your host
to act as a SLIP server is much easier.</P
><P
> There are two
ways of configuring a SLIP server. Both ways require that you set up
one login account per SLIP client. Assume you provide SLIP service to
Arthur Dent at <SPAN
CLASS="SYSTEMITEM"
>dent.beta.com</SPAN
>. You might create an
account named <SPAN
CLASS="SYSTEMITEM"
>dent</SPAN
> by adding
the following line to your <TT
CLASS="FILENAME"
>passwd</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>dent:*:501:60:Arthur Dent's SLIP account:/tmp:/usr/sbin/diplogin</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Afterwards, you would set <SPAN
CLASS="SYSTEMITEM"
>dent</SPAN
>'s
password using the <B
CLASS="COMMAND"
>passwd</B
> utility.</P
><P
> 
 
The <B
CLASS="COMMAND"
>dip</B
> command can be used in server mode by
invoking it as <B
CLASS="COMMAND"
>diplogin</B
>. Usually
<B
CLASS="COMMAND"
>diplogin</B
> is a link to <B
CLASS="COMMAND"
>dip</B
>. Its
main configuration file is <TT
CLASS="FILENAME"
>/etc/diphosts</TT
>, which
is where you specify what IP address a SLIP user will be assigned when
he or she dials in.  Alternatively, you can also use the
<B
CLASS="COMMAND"
>sliplogin</B
> command, a BSD-derived tool featuring a
more flexible configuration scheme that lets you execute shell scripts
whenever a host connects and disconnects.</P
><P
> When our SLIP
user <SPAN
CLASS="SYSTEMITEM"
>dent</SPAN
> logs in,
<B
CLASS="COMMAND"
>dip</B
> starts up as a server. To find out if he is
indeed permitted to use SLIP, it looks up the username in
<TT
CLASS="FILENAME"
>/etc/diphosts</TT
>. This file details the 
access rights and connection parameter for each SLIP user.
The general format for an <TT
CLASS="FILENAME"
>/etc/diphosts</TT
> entry looks like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/diphosts
<TT
CLASS="REPLACEABLE"
><I
>user</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>password</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>rem-addr</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>loc-addr</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>netmask</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>comments</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>protocol</I
></TT
>,<TT
CLASS="REPLACEABLE"
><I
>MTU</I
></TT
>
#</PRE
></FONT
></TD
></TR
></TABLE
>

Each of the fields is described in
<A
HREF="#X-087-2-SLIP.DIPHOSTS.FIELDS"
>Table 7-2</A
>.</P
><DIV
CLASS="TABLE"
><A
NAME="X-087-2-SLIP.DIPHOSTS.FIELDS"
></A
><P
><B
>Table 7-2. /etc/diphosts Field Description</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL
WIDTH="1"><COL
WIDTH="4"><THEAD
><TR
><TH
>Field</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="LITERAL"
>user</TT
></TD
><TD
><P
>The username of the user invoking <B
CLASS="COMMAND"
>dip</B
> that this
	entry will apply to.</P
></TD
></TR
><TR
><TD
>password</TD
><TD
><P
>Field 2 of the <TT
CLASS="FILENAME"
>/etc/diphosts</TT
> file is used to
	add an extra layer of password-based security on the connection. You can place a password in encrypted form here (just as in
	<TT
CLASS="FILENAME"
>/etc/passwd</TT
>&#8201;) and <B
CLASS="COMMAND"
>diplogin</B
>
	will prompt for the user to enter the password before allowing SLIP
	access. Note that this password is used in addition to the normal
	<B
CLASS="COMMAND"
>login</B
>-based password the user will enter.</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>rem-addr</TT
></TD
><TD
><P
>    The address that will be assigned to the remote machine. This address may
	be specified either as a hostname that will be resolved or an IP address
	in dotted quad notation.
    </P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>loc-addr</TT
></TD
><TD
><P
>    The IP address that will be used for this end of the SLIP link.
	This may also be specified as a resolvable hostname or in dotted quad
	format.
    </P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>netmask</TT
></TD
><TD
><P
>    The netmask that will be used for routing purposes. Many people
	are confused by this entry. The netmask doesn't apply to the
	SLIP link itself, but is used in combination with the
	<TT
CLASS="LITERAL"
>rem-addr</TT
> field to produce a route to the remote site.
	The netmask should be that used by the network supported by that of the
	remote host.
    </P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>comments</TT
></TD
><TD
><P
>    This field is free-form text that you may use to help document
	the <TT
CLASS="FILENAME"
>/etc/diphosts</TT
> file. It serves no other purpose.
    </P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>protocol</TT
></TD
><TD
><P
>    This field is where you specify what protocol or line discipline
	you want applied to this connection. Valid entries here are the same as
	those valid for the <CODE
CLASS="OPTION"
>&#8211;p</CODE
> argument to the
	<B
CLASS="COMMAND"
>slattach</B
> command.
    </P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>MTU</TT
></TD
><TD
><P
>    The maximum transmission unit that this link will carry. This field
	describes the largest datagram that will be transmitted across the link.
	Any datagram routed to the SLIP device that is larger than the MTU will
	be fragmented into datagrams no larger than this value. Usually, the MTU is configured identically at both ends of the link.
    </P
></TD
></TR
></TBODY
></TABLE
></DIV
><P
>A sample entry for
<SPAN
CLASS="SYSTEMITEM"
>dent</SPAN
> could look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>dent::dent.beta.com:vbrew.com:255.255.255.0:Arthur Dent:CSLIP,296</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
> Our example gives our user <SPAN
CLASS="SYSTEMITEM"
>dent</SPAN
> access to SLIP with no additional
password required. He will be assigned the IP address associated with
<SPAN
CLASS="SYSTEMITEM"
>dent.beta.com</SPAN
> with a netmask
of <TT
CLASS="LITERAL"
>255.255.255.0</TT
>. His default route should be
directed to the IP address of <SPAN
CLASS="SYSTEMITEM"
>vbrew.com</SPAN
>, and he will use the CSLIP
protocol with an MTU of 296 bytes.</P
><P
>When <SPAN
CLASS="SYSTEMITEM"
>dent</SPAN
> logs in,
<B
CLASS="COMMAND"
>diplogin</B
> extracts the information on him from the
<TT
CLASS="FILENAME"
>diphosts</TT
> file. If the second field contains a
value, <B
CLASS="COMMAND"
>diplogin</B
> will prompt for an &#8220;external
security password.&#8221; The string entered by the user is encrypted
and compared to the password from <TT
CLASS="FILENAME"
>diphosts</TT
>. If
they do not match, the login attempt is rejected. If the password
field contains the string <SPAN
CLASS="SYSTEMITEM"
>s/key</SPAN
>, and <B
CLASS="COMMAND"
>dip</B
>
was compiled with S/Key support, S/Key authentication
will take place. S/Key authentication is described in the
documentation that comes in the <B
CLASS="COMMAND"
>dip</B
> source package.</P
><P
>After a successful login, <B
CLASS="COMMAND"
>diplogin</B
> proceeds by
flipping the serial line to CSLIP or SLIP mode, and sets up the
interface and route. This connection remains established until the
user disconnects and the modem drops the
line. <B
CLASS="COMMAND"
>diplogin</B
> then returns the line to normal
line discipline and exits.</P
><P
>&#13;
<B
CLASS="COMMAND"
>diplogin</B
> requires superuser privilege. If you don't have
<B
CLASS="COMMAND"
>dip</B
> running setuid
<SPAN
CLASS="SYSTEMITEM"
>root</SPAN
>, you should make
<B
CLASS="COMMAND"
>diplogin</B
> a separate copy of <B
CLASS="COMMAND"
>dip</B
>
instead of a simple link. <B
CLASS="COMMAND"
>diplogin</B
> can then safely
be made setuid without affecting the status of
<B
CLASS="COMMAND"
>dip</B
> itself.


&#13;</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-PPP"
></A
>Chapter 8. The Point-to-Point Protocol</H1
><P
>&#13;






Like SLIP, PPP is a protocol used to send datagrams across a
serial connection; however, it addresses a couple of the deficiencies
of SLIP. First, it can carry a large number of protocols and is
thus not limited to the IP protocol. It provides error detection
on the link itself, while SLIP accepts and forwards
corrupted datagrams as long as the corruption does not occur in the
header. Equally important, it lets the communicating sides
negotiate options, such as the IP address and the maximum datagram size
at startup time, and provides client authorization.  This built-in
negotiation allows reliable automation of the connection
establishment, while the authentication removes the need for the
clumsy user login accounts that SLIP requires. For each of these
capabilities, PPP has a separate protocol. In this chapter, we briefly
cover these basic building blocks of PPP. This discussion of PPP is
far from complete; if you want to know more about PPP, we urge you to
read its RFC specification and the dozen or so companion
RFCs.<A
NAME="X-087-2-FNPP01"
HREF="#FTN.X-087-2-FNPP01"
><SPAN
CLASS="footnote"
>[45]</SPAN
></A
>
There is also a comprehensive O'Reilly book on the topic
of <EM
>Using &#38; Managing PPP</EM
>, by Andrew Sun.</P
><P
>&#13;At the very bottom of PPP is the <EM
>High-Level Data Link
Control</EM
> (HDLC) protocol, which defines the
boundaries around the individual PPP frames and provides a 16-bit
checksum.<A
NAME="X-087-2-FNPP02"
HREF="#FTN.X-087-2-FNPP02"
><SPAN
CLASS="footnote"
>[46]</SPAN
></A
> As opposed to the more primitive SLIP
encapsulation, a PPP frame is capable of holding packets from
protocols other than IP, such as Novell's IPX or Appletalk.  PPP
achieves this by adding a protocol field to the basic HDLC frame that
identifies the type of packet carried by the frame.&#13;</P
><P
>&#13;The <EM
>Link Control Protocol</EM
>, (LCP) is used on top of HDLC
to negotiate options pertaining to the data link. For instance, the
<EM
>Maximum Receive Unit</EM
> (MRU), states the maximum
datagram size that one side of the link agrees to receive.</P
><P
>&#13;

An important step at the configuration stage of a PPP link is client
authorization. Although it is not mandatory, it is really a must for
dialup lines in order to keep out intruders.  Usually the called host
(the server) asks the client to authorize itself by proving it knows
some secret key.  If the caller fails to produce the correct secret,
the connection is terminated.  With PPP, authorization works both
ways; the caller may also ask the server to authenticate
itself.  These authentication procedures are totally independent of
each other.  There are two protocols for different types of
authorization, which we will discuss further in this chapter: <EM
>Password Authentication Protocol</EM
> (PAP)
and <EM
>Challenge Handshake Authentication Protocol</EM
>
(CHAP).</P
><P
>&#13;

Each network protocol that is routed across the data link (like IP and
AppleTalk) is configured dynamically using a corresponding
<EM
>Network Control Protocol</EM
> (NCP).  To
send IP datagrams across the link, both sides running PPP must first
negotiate which IP address each of them uses. The control protocol
used for this negotiation is the <EM
>Internet Protocol Control
Protocol</EM
> (IPCP).</P
><P
>&#13;


Besides sending standard IP datagrams across the link, PPP also supports
Van Jacobson header compression of IP datagrams. This technique
shrinks the headers of TCP packets to as little as three bytes. It is
also used in CSLIP, and is more colloquially referred to as VJ header
compression.  The use of compression may be negotiated at startup time
through IPCP, as well.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN6533"
>8.1. PPP on Linux</A
></H2
><P
>On Linux, PPP functionality is split into two parts: a kernel component that
handles the low-level protocols (HDLC, IPCP, IPXCP, etc.) and the user space
<B
CLASS="COMMAND"
>pppd</B
> daemon that handles the various higher-level protocols,
such as PAP and CHAP. The current release of the PPP software for Linux
contains the PPP daemon <B
CLASS="COMMAND"
>pppd</B
> and a program named
<B
CLASS="COMMAND"
>chat</B
> that automates the dialing of the remote
system.</P
><P
>The PPP kernel driver was written by Michael Callahan and reworked by
Paul Mackerras. <B
CLASS="COMMAND"
>pppd</B
> was derived from a free PPP
implementation<A
NAME="X-087-2-FNPP03"
HREF="#FTN.X-087-2-FNPP03"
><SPAN
CLASS="footnote"
>[47]</SPAN
></A
> for Sun and 386BSD machines that was written by
Drew Perkins and others, and is maintained by Paul Mackerras. It was
ported to Linux by Al Longyear. <B
CLASS="COMMAND"
>chat</B
> was written by
Karl Fox.<A
NAME="X-087-2-FNPP04"
HREF="#FTN.X-087-2-FNPP04"
><SPAN
CLASS="footnote"
>[48]</SPAN
></A
></P
><P
>&#13;
Like SLIP, PPP is implemented by a special line discipline.
To use a serial line as a PPP link, you first establish the connection
over your modem as usual, and subsequently convert the line to PPP mode.
In this mode, all incoming data is passed to the PPP driver, which checks
the incoming HDLC frames for validity (each HDLC frame carries a 16-bit
checksum), and unwraps and dispatches them.  Currently, PPP is able to
transport both the IP protocol, optionally using Van Jacobson header
compression, and the IPX protocol.</P
><P
>&#13;
<B
CLASS="COMMAND"
>pppd</B
> aids the kernel driver, performing the
initialization and authentication phase that is necessary before
actual network traffic can be sent across the
link. <B
CLASS="COMMAND"
>pppd</B
>&#8201;'s behavior may be fine-tuned
using a number of options. As PPP is rather complex, it is impossible
to explain all of them in a single chapter. This book therefore cannot
cover all aspects of <B
CLASS="COMMAND"
>pppd</B
>, but only gives you an
introduction. For more information, consult <EM
>Using &#38; Managing
PPP</EM
> or the <B
CLASS="COMMAND"
>pppd</B
> manual pages, and
<TT
CLASS="FILENAME"
>README</TT
>&#8201;s in the <B
CLASS="COMMAND"
>pppd</B
>
source distribution, which should help you sort out most questions
this chapter fails to discuss. The PPP-HOWTO might also be of use.</P
><P
>&#13;Probably the greatest help you will find in configuring PPP will come
from other users of the same Linux distribution. PPP configuration
questions are very common, so try your local usergroup mailing list or
the IRC Linux channel. If your problems persist even after reading the
documentation, you could try the <SPAN
CLASS="SYSTEMITEM"
>comp.protocols.ppp</SPAN
> newsgroup. This is
the place where you can find most of the people involved in
<B
CLASS="COMMAND"
>pppd</B
> development.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN6586"
>8.2. Running pppd</A
></H2
><P
>&#13;


When you want to connect to the Internet through a PPP link, you have
to set up basic networking capabilities, such as the loopback device
and the resolver. Both have been covered in <A
HREF="#X-087-2-IFACE"
>Chapter 5</A
>, and <A
HREF="#X-087-2-RESOLV"
>Chapter 6</A
>. You can
simply configure the name server of your Internet Service Provider in
the <TT
CLASS="FILENAME"
>/etc/resolv.conf</TT
> file, but this will mean
that every DNS request is sent across your serial link. This situation is not
optimal; the closer (network-wise) you are to your name server, the
faster the name lookups will be. An alternative solution is to
configure a caching-only name server at a host on your network.  This
means that the first time you make a DNS query for a particular
host, your request will be sent across your serial link, but every
subsequent request will be answered directly by your local name
server, and will be much faster. This configuration is described in Chapter 6, in 
<A
HREF="#X-087-2-RESOLV.NAMED-CACHINGONLY"
>Section 6.3.4</A
>.&#8221;</P
><P
>As an introductory example of how to establish a PPP connection with
<B
CLASS="COMMAND"
>pppd</B
>, assume you are at <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> again. First, dial in to the PPP
server <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
> and log in to the
<SPAN
CLASS="SYSTEMITEM"
>ppp</SPAN
> account.  <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
> will execute its PPP driver. After
exiting the communications program you used for dialing, execute the
following command, substituting the name of the serial device you used
for the <TT
CLASS="LITERAL"
>ttyS3</TT
> shown here:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>pppd /dev/ttyS3 38400 crtscts defaultroute</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;
This command flips the serial line <TT
CLASS="FILENAME"
>ttyS3</TT
> to the
PPP line discipline and negotiates an IP link with <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
>. The transfer speed used on the
serial port will be 38,400 bps. The <SPAN
CLASS="SYSTEMITEM"
>crtscts</SPAN
> option turns on hardware handshake
on the port, which is an absolute must at speeds above 9,600 bps.</P
><P
>The first thing <B
CLASS="COMMAND"
>pppd</B
> does after starting up is
negotiate several link characteristics with the remote end using
LCP. Usually, the default set of options <B
CLASS="COMMAND"
>pppd</B
> tries
to negotiate will work, so we won't go into this here. Expect to say
that part of this negotiation involves requesting or assigning the IP
addresses at each end of the link.</P
><P
>For the time being, we also assume that
<SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
> doesn't require
any authentication from us, so the configuration phase is completed
successfully.</P
><P
>&#13;

<B
CLASS="COMMAND"
>pppd</B
> will then negotiate the IP parameters with its
peer using IPCP, the IP control protocol. Since we didn't specify any
particular IP address to <B
CLASS="COMMAND"
>pppd</B
> earlier, it will try to
use the address obtained by having the resolver look up the local hostname.
Both will then announce their addresses to each other.</P
><P
>Usually, there's nothing wrong with these defaults. Even if your
machine is on an Ethernet, you can use the same IP address for both
the Ethernet and the PPP interface.  Nevertheless,
<B
CLASS="COMMAND"
>pppd</B
> allows you to use a different address, or even
to ask your peer to use some specific address.  These options are
discussed later in the <A
HREF="#X-087-2-IPCONFIG.OPTIONS"
>Section 8.5</A
>&#8221;
section.</P
><P
>&#13;


After going through the IPCP setup phase, <B
CLASS="COMMAND"
>pppd</B
> will
prepare your host's networking layer to use the PPP link. It first
configures the PPP network interface as a point-to-point link, using
<TT
CLASS="FILENAME"
>ppp0</TT
> for the first PPP link that is active,
<B
CLASS="COMMAND"
>ppp1</B
> for the second, and so on. Next, it sets up a
routing table entry that points to the host at the other end of the
link. In the previous example, <B
CLASS="COMMAND"
>pppd</B
> made the
default network route point to <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
>, because we gave it the <SPAN
CLASS="SYSTEMITEM"
>defaultroute</SPAN
> option.<A
NAME="X-087-2-FNPP05"
HREF="#FTN.X-087-2-FNPP05"
><SPAN
CLASS="footnote"
>[49]</SPAN
></A
> The default route simplifies
your routing by causing any IP datagram destined to a nonlocal host to
be sent to <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
>; this makes
sense since it is the only way they can be reached. There are a number of
different routing schemes <B
CLASS="COMMAND"
>pppd</B
> supports, which we will
cover in detail later in this chapter.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-PPP.OPTIONS"
>8.3. Using Options Files</A
></H2
><P
>&#13;Before <B
CLASS="COMMAND"
>pppd</B
> parses its command-line arguments, it scans
several files for default options.  These files may contain any valid
command-line arguments spread out across an arbitrary number of lines.
Hash signs introduce comments.</P
><P
> 
The first options file is <TT
CLASS="FILENAME"
>/etc/ppp/options</TT
>, which is
always scanned when <B
CLASS="COMMAND"
>pppd</B
> starts up.  Using it to set some
global defaults is a good idea, because it allows you to keep your users from
doing several things that may compromise security.  For instance, to make
<B
CLASS="COMMAND"
>pppd</B
> require some kind of authentication (either PAP or
CHAP) from the peer, you add the <CODE
CLASS="OPTION"
>auth</CODE
> option to this
file. This option cannot be overridden by the user, so it becomes impossible
to establish a PPP connection with any system that is not in your
authentication databases. Note, however, that some options can be overridden;
the <SPAN
CLASS="SYSTEMITEM"
>connect</SPAN
> string is a good example.</P
><P
>&#13;The other options file, which is read after
<TT
CLASS="FILENAME"
>/etc/ppp/options</TT
>, is <TT
CLASS="FILENAME"
>.ppprc</TT
> in the
user's home directory. It allows each user to specify her own set of default
options.</P
><P
>A sample <TT
CLASS="FILENAME"
>/etc/ppp/options</TT
> file might look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># Global options for pppd running on vlager.vbrew.com
lock                 # use UUCP-style device locking
auth                 # require authentication
usehostname          # use local hostname for CHAP
domain vbrew.com     # our domain name</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;
The <SPAN
CLASS="SYSTEMITEM"
>lock</SPAN
> keyword makes
<B
CLASS="COMMAND"
>pppd</B
> comply to the standard UUCP method of device locking.
With this convention, each process that accesses a serial device, say
<TT
CLASS="FILENAME"
>/dev/ttyS3</TT
>, creates a lock file with a name like
<TT
CLASS="FILENAME"
>LCK..ttyS3</TT
> in a special lock-file directory to signal that
the device is in use. This is necessary to prevent signal other programs, such as
<B
CLASS="COMMAND"
>minicom</B
> or <B
CLASS="COMMAND"
>uucico</B
>, from opening the
serial device while it is used by PPP.</P
><P
>The next three options relate to authentication and, therefore,
to system security. The authentication options are best placed in the global
configuration file because they are &#8220;privileged&#8221; and cannot
be overridden by users' <TT
CLASS="FILENAME"
>~/.ppprc</TT
> options files.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN6701"
>8.4. Using chat to Automate Dialing</A
></H2
><P
>&#13;

One of the things that may have struck you as inconvenient in the
previous example is that you had to establish the connection manually
before you could fire up <B
CLASS="COMMAND"
>pppd</B
>.  Unlike
<B
CLASS="COMMAND"
>dip</B
>, <B
CLASS="COMMAND"
>pppd</B
> does not have its own
scripting language for dialing the remote system and logging in, but
relies on an external program or shell script to do this. The
command to be executed can be given to <B
CLASS="COMMAND"
>pppd</B
> with
the <SPAN
CLASS="SYSTEMITEM"
>connect</SPAN
> command-line
option. <B
CLASS="COMMAND"
>pppd</B
> will redirect the command's standard
input and output to the serial line.</P
><P
>The <B
CLASS="COMMAND"
>pppd</B
> software package is supplied with a very simple
program called <B
CLASS="COMMAND"
>chat</B
>, which is capable of being used in
this way to automate simple login sequences. We'll talk about this command in
some detail.</P
><P
>&#13;
If your login sequence is complex, you will need something more
powerful than <B
CLASS="COMMAND"
>chat</B
>. One useful alternative you
might consider is <B
CLASS="COMMAND"
>expect</B
>, written by Don Libes. It
has a very powerful language based on Tcl, and was designed exactly for
this sort of application. Those of you whose login sequence requires,
for example, challenge/response authentication involving
 calculator-like key generators will find
<B
CLASS="COMMAND"
>expect</B
> powerful enough to handle the task. Since
there are so many possible variations on this theme, we won't describe
how to develop an appropriate expect script in this book.  Suffice it
to say, you'd call your expect script by specifying its name using the
<B
CLASS="COMMAND"
>pppd</B
> <SPAN
CLASS="SYSTEMITEM"
>connect</SPAN
> option. It's also important to
note that when the script is running, the standard input and output
will be attached to the modem, not to the terminal that invoked
<B
CLASS="COMMAND"
>pppd</B
>. If you require user interaction, you should
manage it by opening a spare virtual terminal, or arrange some other
means.</P
><P
>&#13;
The <B
CLASS="COMMAND"
>chat</B
> command lets you specify a UUCP-style chat script.
Basically, a chat script consists of an alternating sequence of strings that
we expect to receive from the remote system, and the answers we are to send.
We will call them <EM
>expect</EM
> and <EM
>send</EM
>
strings, respectively.  This is a typical excerpt from a chat script:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ogin: b1ff ssword: s3|&#60;r1t</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This script tells <B
CLASS="COMMAND"
>chat</B
> to wait for the remote system to send
the login prompt and return the login name
<SPAN
CLASS="SYSTEMITEM"
>b1ff</SPAN
>. We wait only for
<SPAN
CLASS="SYSTEMITEM"
>ogin:</SPAN
> so that it doesn't matter if
the login prompt starts with an uppercase or lowercase l, or if it arrives
garbled.  The following string is another expect string that makes
<B
CLASS="COMMAND"
>chat</B
> wait for the password prompt and send our
response password.</P
><P
>This is basically what chat scripts are all about. A complete script to
dial up a PPP server would, of course, also have to include the appropriate
modem commands. Assume that your modem understands the Hayes command set, and
the server's telephone number is 318714. The complete <B
CLASS="COMMAND"
>chat</B
>
invocation to establish a connection with
<SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
> would then be:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>chat -v '' ATZ OK ATDT318714 CONNECT '' ogin: ppp word: GaGariN</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>By definition, the first string must be an expect string, but as the
modem won't say anything before we have kicked it, we make
<B
CLASS="COMMAND"
>chat</B
> skip the first expect by specifying an empty string.
We then send <SPAN
CLASS="SYSTEMITEM"
>ATZ</SPAN
>, the reset
command for Hayes-compatible modems, and wait for its response
(<SPAN
CLASS="SYSTEMITEM"
>OK</SPAN
>). The next string sends the <B
CLASS="COMMAND"
>dial</B
>
command along with the phone number to <B
CLASS="COMMAND"
>chat</B
>, and expects
the <SPAN
CLASS="SYSTEMITEM"
>CONNECT</SPAN
> message in response.
This is followed by an empty string again because we don't want to send
anything now, but rather wait for the login prompt. The remainder of the
chat script works exactly as described previously. This description probably looks a bit
confusing, but we'll see in a moment that there is a way to make
chat scripts a lot easier to understand.</P
><P
>The <CODE
CLASS="OPTION"
>&#8211;v</CODE
> option makes <B
CLASS="COMMAND"
>chat</B
> log all
activities to the <B
CLASS="COMMAND"
>syslog</B
> daemon
<SPAN
CLASS="SYSTEMITEM"
>local2</SPAN
>
facility.<A
NAME="X-087-2-FNPP06"
HREF="#FTN.X-087-2-FNPP06"
><SPAN
CLASS="footnote"
>[50]</SPAN
></A
></P
><P
>&#13;Specifying the chat script on the command line bears a certain risk
because users can view a process's command line with the <B
CLASS="COMMAND"
>ps</B
>
command.  You can avoid this risk by putting the chat script in a file like
<TT
CLASS="FILENAME"
>dial-c3po</TT
>.  You make <B
CLASS="COMMAND"
>chat</B
> read
the script from the file instead of the command line by giving it the
<CODE
CLASS="OPTION"
>&#8211;f</CODE
> option, followed by the filename. This action has the
added benefit of making our chat expect sequences easier to
understand. To convert our example, our <TT
CLASS="FILENAME"
>dial-c3po</TT
> file
would look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>''      ATZ
OK      ATDT318714
CONNECT ''
ogin:   ppp
word:   GaGariN</PRE
></FONT
></TD
></TR
></TABLE
>

When we use a chat script file in this way, the string we expect to
receive is on the left and the response we will send is on the
right. They are much easier to read and understand when presented this way.</P
><P
>The complete <B
CLASS="COMMAND"
>pppd</B
> incantation would now look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>pppd connect "chat -f dial-c3po" /dev/ttyS3 38400 -detach \
        crtscts modem defaultroute</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Besides the <SPAN
CLASS="SYSTEMITEM"
>connect</SPAN
> option
that specifies the dialup script, we have added two more options to
the command line: <SPAN
CLASS="SYSTEMITEM"
>&#8211;detach</SPAN
>, which tells
<B
CLASS="COMMAND"
>pppd</B
> not to detach from the console and become a
background process, and the <SPAN
CLASS="SYSTEMITEM"
>modem</SPAN
>
keyword, which makes it perform
modem-specific actions on the serial device, like disconnecting the
line before and after the call. If you don't use this keyword,
<B
CLASS="COMMAND"
>pppd</B
> will not monitor the port's DCD line and will
therefore not detect whether the remote end hangs up unexpectedly.</P
><P
>The examples we have shown are rather simple; <B
CLASS="COMMAND"
>chat</B
>
allows for much more complex scripts. For instance, it can specify
strings on which to abort the chat with an error.  Typical abort
strings are messages like <SPAN
CLASS="SYSTEMITEM"
>BUSY</SPAN
>
or <SPAN
CLASS="SYSTEMITEM"
>NO CARRIER</SPAN
> that your modem
usually generates when the called number is busy or doesn't answer. To
make <B
CLASS="COMMAND"
>chat</B
> recognize these messages immediately
rather than timing out, you can specify them at the beginning of the
script using the <SPAN
CLASS="SYSTEMITEM"
>ABORT</SPAN
>
keyword:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>chat -v ABORT BUSY ABORT 'NO CARRIER' '' ATZ OK ...</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Similarly, you can change the timeout value for parts of
the chat scripts by inserting <SPAN
CLASS="SYSTEMITEM"
>TIMEOUT</SPAN
> 
options.</P
><P
>Sometimes you also need to have conditional execution
for parts of the chat script: when you don't receive the
remote end's login prompt, you might want to send a BREAK or a carriage
return. You can achieve this by appending a subscript to an expect
string.  The subscript consists of a sequence of send and expect strings, just
like the overall script itself, which are separated by hyphens. The
subscript is executed whenever the expected string it is appended to
is not received in time.  In the example above, we would modify the chat
script as follows:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ogin:-BREAK-ogin: ppp ssword: GaGariN</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>When <B
CLASS="COMMAND"
>chat</B
> doesn't see the remote system send the login
prompt, the subscript is executed by first sending a BREAK, and then
waiting for the login prompt again. If the prompt now appears, the
script continues as usual; otherwise, it will terminate with an error.


&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IPCONFIG.OPTIONS"
>8.5. IP Configuration Options</A
></H2
><P
>&#13;IPCP is used to negotiate a number of IP parameters at link configuration time.
Usually, each peer sends an IPCP Configuration Request packet, indicating which
values it wants to change from the defaults and the new value. Upon receipt,
the remote end inspects each option in turn and either acknowledges or rejects
it.</P
><P
><B
CLASS="COMMAND"
>pppd</B
> gives you a lot of control over which IPCP options
it will try to negotiate. You can tune it through various command-line
options that we will discuss in this section.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN6810"
>8.5.1. Choosing IP Addresses</A
></H3
><P
>&#13;

All IP interfaces require IP addresses assigned to them; a PPP device always
has an IP address. The PPP suite of protocols provides a mechanism that allows
the automatic assignment of IP addresses to PPP interfaces. It is possible for
the PPP program at one end of a point-to-point link to assign an IP address for
the remote end to use, or each may use its own.</P
><P
>Some PPP servers that handle a lot of client sites assign addresses
dynamically; addresses are assigned to systems only when calling in
and are reclaimed after they have logged off again. This allows the
number of IP addresses required to be limited to the number of dialup
lines. While limitation is convenient for managers of the PPP dialup
server, it is often less convenient for users who are dialing
in. We discussed the way that
hostnames are mapped to IP addresses by use of a database in <A
HREF="#X-087-2-RESOLV"
>Chapter 6</A
>. In order
for people to connect to your host, they must know your IP address or
the hostname associated with it. If you are a user of a PPP service
that assigns you an IP address dynamically, this knowledge is difficult without
providing some means of allowing the DNS database to be updated after
you are assigned an IP address. Such systems do exist, but we won't
cover them in detail here; instead, we will look at the more
preferable approach, which involves you being able to use the same IP
address each time you establish your network connection.<A
NAME="X-087-2-FNPP07"
HREF="#FTN.X-087-2-FNPP07"
><SPAN
CLASS="footnote"
>[51]</SPAN
></A
></P
><P
>In the previous example, we had <B
CLASS="COMMAND"
>pppd</B
> dial up
<SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
> and establish an IP
link. No provisions were taken to choose a particular IP address on
either end of the link.  Instead, we let <B
CLASS="COMMAND"
>pppd</B
> take
its default action. It attempts to resolve the local hostname,
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> in our example, to an
IP address, which it uses for the local end, while letting the remote
machine, <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
>, provide its
own. PPP supports several alternatives to this arrangement.</P
><P
>To ask for particular addresses, you generally provide <B
CLASS="COMMAND"
>pppd</B
>
with the following option:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="REPLACEABLE"
><I
>local_addr</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>remote_addr</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
><TT
CLASS="REPLACEABLE"
><I
>local_addr</I
></TT
> and
<TT
CLASS="REPLACEABLE"
><I
>remote_addr</I
></TT
> may be specified either in
dotted quad notation or as hostnames.<A
NAME="X-087-2-FNPP08"
HREF="#FTN.X-087-2-FNPP08"
><SPAN
CLASS="footnote"
>[52]</SPAN
></A
>
This option makes <B
CLASS="COMMAND"
>pppd</B
> attempt to use the first address
supplied as its own IP address, and the second as the peer's. If the peer
rejects either of the addresses during IPCP negotiation, no IP link will be
established.<A
NAME="X-087-2-FNPP09"
HREF="#FTN.X-087-2-FNPP09"
><SPAN
CLASS="footnote"
>[53]</SPAN
></A
></P
><P
>&#13;If you are dialing in to a server and expect it to assign you
an IP address, you should ensure that <B
CLASS="COMMAND"
>pppd</B
> does not
attempt to negotiate one for itself. To do this, use the
<CODE
CLASS="OPTION"
>noipdefault</CODE
> option and leave the
<TT
CLASS="REPLACEABLE"
><I
>local_addr</I
></TT
> blank. The
<CODE
CLASS="OPTION"
>noipdefault</CODE
> option will stop <B
CLASS="COMMAND"
>pppd</B
>
from trying to use the IP address associated with the hostname as the
local address.</P
><P
>If you want to set only the local address but accept any address the
peer uses, simply leave out the <TT
CLASS="REPLACEABLE"
><I
>remote_addr</I
></TT
>
part. To make <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> use
the IP address <SPAN
CLASS="SYSTEMITEM"
>130.83.4.27</SPAN
> instead of
its own, give it <CODE
CLASS="OPTION"
>130.83.4.27:</CODE
> on the command line.
Similarly, to set the remote address only, leave the
<TT
CLASS="REPLACEABLE"
><I
>local_addr</I
></TT
> field blank. By default,
<B
CLASS="COMMAND"
>pppd</B
> will then use the address associated with your
hostname.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN6869"
>8.5.2. Routing Through a PPP Link</A
></H3
><P
>&#13;
After setting up the network interface, <B
CLASS="COMMAND"
>pppd</B
> will usually
set up a host route to its peer only. If the remote host is on a LAN, you
certainly want to be able to connect to hosts &#8220;behind&#8221; your peer as
well; in that case, a network route must be set up.</P
><P
>We have already seen that <B
CLASS="COMMAND"
>pppd</B
> can be
asked to set the default route using the <CODE
CLASS="OPTION"
>defaultroute</CODE
>
option.  This option is very useful if the PPP server you dialed up acts as your Internet gateway.</P
><P
>&#13;

The reverse case, in which your system acts as a gateway for a single
host, is also relatively easy to accomplish. For example, take some
employee at the Virtual Brewery whose home machine is called
<SPAN
CLASS="SYSTEMITEM"
>oneshot</SPAN
>. Let's also assume
that we've configured <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>
as a dialin PPP server. If we've configured <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> to dynamically assign an IP
address that belongs to the Brewery's subnet, then we can use the
<CODE
CLASS="OPTION"
>proxyarp</CODE
> option with <B
CLASS="COMMAND"
>pppd</B
>, which
will install a proxy ARP entry for <SPAN
CLASS="SYSTEMITEM"
>oneshot</SPAN
>. This automatically makes
<SPAN
CLASS="SYSTEMITEM"
>oneshot</SPAN
> accessible from all
hosts at the Brewery and the Winery.</P
><P
>&#13;However, things aren't always that simple. Linking two
local area networks usually requires adding a specific network route
because these networks may have their own default routes. Besides,
having both peers use the PPP link as the default route would generate
a loop, through which packets to unknown destinations would ping-pong between
the peers until their time to live expired.</P
><P
>Suppose the Virtual Brewery opens a branch in another city.
The subsidiary runs an Ethernet of its own using the IP network number
<SPAN
CLASS="SYSTEMITEM"
>172.16.3.0</SPAN
>, which is subnet 3 of the
Brewery's class B network. The subsidiary wants to connect to the Brewery's
network via PPP to update customer databases. Again,
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> acts as the gateway for the
brewery network and will support the PPP link; its peer at the new branch is
called <SPAN
CLASS="SYSTEMITEM"
>vbourbon</SPAN
> and has an IP address
of <SPAN
CLASS="SYSTEMITEM"
>172.16.3.1</SPAN
>. This network is
illustrated in <A
HREF="#X-087-2-APPENDIX.BREWERY.SUBSIDIARY"
>Figure A-2</A
> in
<A
HREF="#X-087-2-APPENDIX.BREWERY"
>Appendix A</A
>.</P
><P
>When <SPAN
CLASS="SYSTEMITEM"
>vbourbon</SPAN
> connects to
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>, it makes the default
route point to <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> as
usual. On <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>, however, we
will have only the point-to-point route to <SPAN
CLASS="SYSTEMITEM"
>vbourbon</SPAN
> and will have to specially
configure a network route for subnet 3 that uses <SPAN
CLASS="SYSTEMITEM"
>vbourbon</SPAN
> as its gateway. We could do this
manually using the <B
CLASS="COMMAND"
>route</B
> command by hand after the
PPP link is established, but this is not a very practical
solution. Fortunately, we can configure the route automatically by using a feature
of <B
CLASS="COMMAND"
>pppd</B
> that we haven't discussed yet&#8212;the
<B
CLASS="COMMAND"
>ip-up</B
> command. This command is a shell script or program
located in <TT
CLASS="FILENAME"
>/etc/ppp</TT
> that is executed by
<B
CLASS="COMMAND"
>pppd</B
> after the PPP interface has been
configured. When present, it is invoked with the following parameters:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ip-up <TT
CLASS="REPLACEABLE"
><I
>iface</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>device</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>speed</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>local_addr</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>remote_addr</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The following table summarizes the meaning of each of the
arguments (in the first column, we show the number used by the shell
script to refer to each argument):
<DIV
CLASS="INFORMALTABLE"
><P
></P
><A
NAME="AEN6928"
></A
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL
WIDTH="0"><COL
WIDTH="0"><COL
WIDTH="3"><THEAD
><TR
><TH
>Argument</TH
><TH
>Name</TH
><TH
>Purpose</TH
></TR
></THEAD
><TBODY
><TR
><TD
>$1</TD
><TD
><TT
CLASS="REPLACEABLE"
><I
>iface</I
></TT
></TD
><TD
><P
>	The network interface used, e.g., <TT
CLASS="LITERAL"
>ppp0</TT
>	
	</P
></TD
></TR
><TR
><TD
>$2</TD
><TD
><TT
CLASS="REPLACEABLE"
><I
>device</I
></TT
></TD
><TD
><P
>	The pathname of the serial device file used (&#8202;<TT
CLASS="FILENAME"
>/dev/tty</TT
>,
	if stdin/stdout are used)
	</P
></TD
></TR
><TR
><TD
>$3</TD
><TD
><TT
CLASS="REPLACEABLE"
><I
>speed</I
></TT
></TD
><TD
><P
>	
	The speed of the serial device in bits per second
	</P
></TD
></TR
><TR
><TD
>$4</TD
><TD
><TT
CLASS="REPLACEABLE"
><I
>local_addr</I
></TT
></TD
><TD
><P
>	The IP address of the link's remote end in dotted quad notation
	</P
></TD
></TR
><TR
><TD
>$5</TD
><TD
><TT
CLASS="REPLACEABLE"
><I
>remote_addr</I
></TT
></TD
><TD
><P
>	The IP address of the remote end of the link in dotted quad notation
	</P
></TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></P
><P
>In our case, the <B
CLASS="COMMAND"
>ip-up</B
> script may contain the
following code fragment:<A
NAME="X-087-2-FNPP10"
HREF="#FTN.X-087-2-FNPP10"
><SPAN
CLASS="footnote"
>[54]</SPAN
></A
>

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#!/bin/sh
case $5 in
172.16.3.1)            # this is vbourbon
        route add -net 172.16.3.0 gw 172.16.3.1;;
...
esac
exit 0</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Similarly, <B
CLASS="COMMAND"
>/etc/ppp/ip-down</B
> can be used to undo
any actions of <B
CLASS="COMMAND"
>ip-up</B
> after the PPP link has been taken down
again. So in our <B
CLASS="COMMAND"
>/etc/ppp/ip-down</B
> script we would have a
<B
CLASS="COMMAND"
>route</B
> command that removed the route we created in the
<B
CLASS="COMMAND"
>/etc/ppp/ip-up</B
> script.</P
><P
>&#13;
However, the routing scheme is not yet complete. We have set up routing table
entries on both PPP hosts, but so far none of the hosts on either network knows
anything about the PPP link. This is not a big problem if all hosts at the
subsidiary have their default route pointing at
<SPAN
CLASS="SYSTEMITEM"
>vbourbon</SPAN
>, and all Brewery hosts route
to <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> by default. If this is not
the case, your only option is usually to use a routing daemon like
<B
CLASS="COMMAND"
>gated</B
>. After creating the network route on
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>, the routing daemon
broadcasts the new route to all hosts on the attached subnets.&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN6994"
>8.6. Link Control Options</A
></H2
><P
>&#13;We already encountered the Link Control Protocol (LCP), which is
used to negotiate link characteristics and test the link.</P
><P
>The two most important options negotiated by LCP are the
<EM
>Asynchronous Control Character Map</EM
> and the
<EM
>Maximum Receive Unit</EM
>. There are a number of other
LCP configuration options, but they are far too specialized to discuss
here.</P
><P
>&#13;



The Asynchronous Control Character Map, colloquially called the
<EM
>async map</EM
>, is used on asynchronous links, such as telephone
lines, to identify control characters that must be escaped (replaced by a
specific two-character sequence) to avoid them being interpreted by equipment
used to establish the link. For instance, you may want to avoid the XON and
XOFF characters used for software handshake because a misconfigured modem
might choke upon receipt of an XOFF. Other candidates include Ctrl-l (the
<B
CLASS="COMMAND"
>telnet</B
> escape character). PPP allows you to escape any of
the characters with ASCII codes 0 through 31 by specifying them in the async
map.</P
><P
>The async map is a 32-bit-wide bitmap expressed in hexadecimal. The least
significant bit corresponds to the ASCII NULL character, and the most
significant bit corresponds to ASCII 31 decimal. These 32 ASCII characters are
the control characters. If a bit is set in the bitmap, it signals that the
corresponding character must be escaped before it is transmitted across the
link.</P
><P
>To tell your peer that it doesn't have to escape all control characters,
but only a few of them, you can specify an async map to <B
CLASS="COMMAND"
>pppd</B
>
using the <CODE
CLASS="OPTION"
>asyncmap</CODE
> option. For example, if only
<TT
CLASS="LITERAL"
>^S</TT
> and <TT
CLASS="LITERAL"
>^Q</TT
> (ASCII 17 and 19, commonly
used for XON and XOFF) must be escaped, use the following option:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>asyncmap 0x000A0000</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The conversion is simple as long as you can convert binary to hex.
Lay out 32 bits in front of you. The right-most bit corresponds to ASCII 00
(NULL), and the left-most bit corresponds to ASCII 32 decimal. Set the bits
corresponding to the characters you want escaped to one, and all others to zero.
To convert that into the hexadecimal number <B
CLASS="COMMAND"
>pppd</B
> expects,
simply take each set of 4 bits and convert them into hex. You should end up
with eight hexadecimal figures. String them all together and preprend
&#8220;0x&#8221; to signify it is a hexadecimal number, and you are done.</P
><P
>Initially, the async map is set to <TT
CLASS="LITERAL"
>0xffffffff</TT
>&#8212;that
is, all control characters will be escaped. This is a safe default,
but is usually much more than you need. Each character that appears in
the async map results in two characters being transmitted across the
link, so escaping comes at the cost of increased link utilization
and a corresponding performance reduction.</P
><P
>In most circumstances, an async map of <TT
CLASS="LITERAL"
>0x0</TT
> works
fine. No escaping is performed.</P
><P
>&#13;
 

The Maximum Receive Unit (MRU), signals to the peer the maximum size
of HDLC frames we want to receive.  Although this may remind you of the
Maximum Transfer Unit (MTU) value, these two have little in common. The
MTU is a parameter of the kernel networking device and describes the
maximum frame size the interface is able to transmit. The MRU is more of
an advice to the remote end not to generate frames larger than the
MRU; the interface must nevertheless be able to receive frames of up to
1,500 bytes.</P
><P
>&#13;Choosing an MRU is therefore not so much a question of what the link
is capable of transferring, but of what gives you the best
throughput. If you intend to run interactive applications over the
link, setting the MRU to values as low as 296 is a good idea, so that
an occasional larger packet (say, from an FTP session) doesn't make
your cursor &#8220;jump.&#8221; To tell <B
CLASS="COMMAND"
>pppd</B
> to
request an MRU of 296, you give it the option <TT
CLASS="LITERAL"
>mru
296</TT
>. Small MRUs, however, make sense only if you have VJ
header compression (it is enabled by default), because otherwise you'd
waste a large amount of your bandwidth just carrying the IP header for
each datagram.</P
><P
><B
CLASS="COMMAND"
>pppd</B
> also understands a couple of LCP options that configure
the overall behavior of the negotiation process, such as the maximum number of
configuration requests that may be exchanged before the link is terminated.
Unless you know exactly what you are doing, you should leave these options alone.</P
><P
>&#13;
Finally, there are two options that apply to LCP echo messages. PPP
defines two messages, <EM
>Echo Request</EM
> and
<EM
>Echo Response</EM
>. <B
CLASS="COMMAND"
>pppd</B
> uses this
feature to check if a link is still operating.  You can enable this by
using the <CODE
CLASS="OPTION"
>lcp-echo-interval</CODE
> option together with a
time in seconds.  If no frames are received from the remote host
within this interval, <B
CLASS="COMMAND"
>pppd</B
> generates an Echo
Request and expects the peer to return an Echo Response.  If the peer
does not produce a response, the link is terminated after a certain
number of requests are sent.  This number can be set using the
<CODE
CLASS="OPTION"
>lcp-echo-failure</CODE
> option.  By default, this feature is
disabled altogether.
&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN7063"
>8.7. General Security Considerations</A
></H2
><P
>&#13;


A misconfigured PPP daemon can be a devastating security breach.  It can be as
bad as letting anyone plug their machine into your Ethernet (and that can be
very bad). In this section, we discuss a few measures that should make
your PPP configuration safe.</P
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.png"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Root privilege is required to configure the network
device and routing table. You will usually solve this by running
<B
CLASS="COMMAND"
>pppd</B
> setuid <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
>.  However, <B
CLASS="COMMAND"
>pppd</B
>
allows users to set various security-relevant options. </P
></TD
></TR
></TABLE
></DIV
><P
>&#13;To protect against any attacks a user may launch by manipulating
<B
CLASS="COMMAND"
>pppd</B
> options, you should set a couple of
default values in the global <TT
CLASS="FILENAME"
>/etc/ppp/options</TT
>
file, like those shown in the sample file in <A
HREF="#X-087-2-PPP.OPTIONS"
>Section 8.3</A
>,&#8221; earlier in this chapter. Some of them, such as the
authentication options, cannot be overridden by the user, and thus
provide reasonable protection against manipulations. An important
option to protect is the <SPAN
CLASS="SYSTEMITEM"
>connect</SPAN
> option. If you intend to allow
non-root users to invoke <B
CLASS="COMMAND"
>pppd</B
> to connect to the
Internet, you should always add the <TT
CLASS="LITERAL"
>connect</TT
> and
<TT
CLASS="LITERAL"
>noauth</TT
> options to the global options file
<TT
CLASS="FILENAME"
>/etc/ppp/options</TT
>. If you fail to do this, users
will be able to execute arbitrary commands with
<TT
CLASS="LITERAL"
>root</TT
> privileges by specifying the command as their
<SPAN
CLASS="SYSTEMITEM"
>connect</SPAN
> command on the
<B
CLASS="COMMAND"
>pppd</B
> line or in their personal options file.</P
><P
>Another good idea is to restrict which users may execute
<B
CLASS="COMMAND"
>pppd</B
> by creating a group in <TT
CLASS="FILENAME"
>/etc/group</TT
>
and adding only those users who you wish to have the ability to execute
the PPP daemon. You should then change group ownership of the
<B
CLASS="COMMAND"
>pppd</B
> daemon to that group and remove the world execute
privileges. To do this, assuming you've called your group
<SPAN
CLASS="SYSTEMITEM"
>dialout</SPAN
>, you could use something like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>chown root /usr/sbin/pppd</KBD
>
# <KBD
CLASS="USERINPUT"
>chgrp dialout /usr/sbin/pppd</KBD
>
# <KBD
CLASS="USERINPUT"
>chmod 4750 /usr/sbin/pppd</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Of course, you have to protect yourself from the systems you speak PPP
with, too.  To fend off hosts posing as someone else, you should
always require some sort of authentication from your peer.  Additionally, you
should not allow foreign hosts to use any IP address they choose, but
restrict them to at most a few.  The following section will deal with
these topics in detail.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-PPP.AUTHENTICATION"
>8.8. Authentication with PPP</A
></H2
><P
>&#13;




With PPP, each system may require its peer to authenticate itself
using one of two authentication protocols: the
<EM
>Password Authentication Protocol</EM
> (PAP), and the
<EM
>Challenge Handshake Authentication Protocol</EM
>
(CHAP).  When a connection is established, each end can request the
other to authenticate itself, regardless of whether it is the caller
or the callee.  In the description that follows, we will loosely talk
of &#8220;client&#8221; and &#8220;server&#8221; when we want to
distinguish between the system sending authentication requests and the
system responding to them. A PPP daemon can ask its peer for
authentication by sending yet another LCP configuration request
identifying the desired authentication protocol.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN7127"
>8.8.1. PAP Versus CHAP</A
></H3
><P
>PAP, which is offered by many Internet Service Providers, works
basically the same way as the normal login procedure. The client
authenticates itself by sending a username and a (optionally
encrypted) password to the server, which the server compares to its
secrets database.<A
NAME="X-087-2-FNPP11"
HREF="#FTN.X-087-2-FNPP11"
><SPAN
CLASS="footnote"
>[55]</SPAN
></A
>
This technique is vulnerable to eavesdroppers, who may try to obtain the
password by listening in on the serial line, and to repeated trial and error
attacks.</P
><P
>CHAP does not have these deficiencies. With CHAP, the server sends a randomly
generated &#8220;challenge&#8221; string to the client, along with its
hostname. The client uses the hostname to look up the appropriate secret,
combines it with the challenge, and encrypts the string using a one-way
hashing function. The result is returned to the server along with the client's
hostname. The server now performs the same computation, and acknowledges the
client if it arrives at the same result.</P
><P
>CHAP also doesn't require the client to authenticate itself only at
startup time, but sends challenges at regular intervals to make sure
the client hasn't been replaced by an intruder, for instance by
switching phone lines, or because of a modem configuration error that
causes the PPP daemon not to notice that the original phone call has
dropped out and someone else has dialed in.</P
><P
> 
 
<B
CLASS="COMMAND"
>pppd</B
> keeps the secret keys for PAP and CHAP in two
separate files called <TT
CLASS="FILENAME"
>/etc/ppp/pap-secrets</TT
> and
<TT
CLASS="FILENAME"
>/etc/ppp/chap-secrets</TT
>.  By entering
a remote host in one or the other file, you have fine control over
whether PAP or CHAP is used to authenticate yourself with your peer,
and vice versa.</P
><P
>By default, <B
CLASS="COMMAND"
>pppd</B
> doesn't require authentication from the
remote host, but it will agree to authenticate itself when requested by the
remote host. Since CHAP is so much stronger than PAP, <B
CLASS="COMMAND"
>pppd</B
>
tries to use the former whenever possible.  If the peer does not support it, or
if <B
CLASS="COMMAND"
>pppd</B
> can't find a CHAP secret for the remote system in
its <TT
CLASS="FILENAME"
>chap-secrets</TT
> file, it reverts to PAP. If it doesn't
have a PAP secret for its peer either, it refuses to authenticate
altogether. As a consequence, the connection is shut down.</P
><P
>You can modify this behavior in several ways. When given
the <CODE
CLASS="OPTION"
>auth</CODE
> keyword, <B
CLASS="COMMAND"
>pppd</B
>
requires the peer to authenticate itself. <B
CLASS="COMMAND"
>pppd</B
>
agrees to use either CHAP or PAP as long as it has a secret for the
peer in its CHAP or PAP database. There are other options to turn a
particular authentication protocol on or off, but I won't describe
them here.</P
><P
> 
If all systems you talk to with PPP agree to authenticate themselves with
you, you should put the <CODE
CLASS="OPTION"
>auth</CODE
> option in the global
<TT
CLASS="FILENAME"
>/etc/ppp/options</TT
> file and define passwords for each
system in the <TT
CLASS="FILENAME"
>chap-secrets</TT
> file. If a system doesn't
support CHAP, add an entry for it to the <TT
CLASS="FILENAME"
>pap-secrets</TT
>
file. That way, you can make sure no unauthenticated system connects to your
host.</P
><P
>The next two sections discuss the two PPP secrets files,
<TT
CLASS="FILENAME"
>pap-secrets</TT
> and <TT
CLASS="FILENAME"
>chap-secrets</TT
>.
They are located in <TT
CLASS="FILENAME"
>/etc/ppp</TT
> and contain triplets
of clients, servers, and passwords, optionally followed by a list of IP
addresses.  The interpretation of the client and server fields is
different for CHAP and PAP, and also depends on whether we authenticate
ourselves with the peer, or whether we require the server to authenticate
itself with us.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN7162"
>8.8.2. The CHAP Secrets File</A
></H3
><P
>&#13;
 

When it has to authenticate itself with a server using CHAP,
<B
CLASS="COMMAND"
>pppd</B
> searches the <TT
CLASS="FILENAME"
>chap-secrets</TT
>
file for an entry with the client field equal to the local hostname, and
the server field equal to the remote hostname sent in the CHAP challenge.
When requiring the peer to authenticate itself, the roles are simply reversed:
<B
CLASS="COMMAND"
>pppd</B
> then looks for an entry with the client field
equal to the remote hostname (sent in the client's CHAP response), and the
server field equal to the local hostname.</P
><P
>The following is a sample <TT
CLASS="FILENAME"
>chap-secrets</TT
> file for
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>:<A
NAME="X-087-2-FNPP12"
HREF="#FTN.X-087-2-FNPP12"
><SPAN
CLASS="footnote"
>[56]</SPAN
></A
>&#13;</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># CHAP secrets for vlager.vbrew.com
#
# client         server           secret                addrs
#---------------------------------------------------------------------
vlager.vbrew.com  c3po.lucas.com   "Use The Source Luke" vlager.vbrew.com
c3po.lucas.com    vlager.vbrew.com "arttoo! arttoo!"     c3po.lucas.com
*                 vlager.vbrew.com "TuXdrinksVicBitter"  pub.vbrew.com</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>When <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> establishes a PPP
connection with <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
> asks
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> to authenticate itself by
sending a CHAP challenge. <B
CLASS="COMMAND"
>pppd</B
> on
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> then scans
<TT
CLASS="FILENAME"
>chap-secrets</TT
> for an entry with the client field equal to
<SPAN
CLASS="SYSTEMITEM"
>vlager.vbrew.com</SPAN
> and the server field
equal to <SPAN
CLASS="SYSTEMITEM"
>c3po.lucas.com</SPAN
>, and finds
the first line shown in the example.<A
NAME="X-087-2-FNPP13"
HREF="#FTN.X-087-2-FNPP13"
><SPAN
CLASS="footnote"
>[57]</SPAN
></A
>
It then produces the CHAP response from the challenge string and the secret
(<TT
CLASS="LITERAL"
>Use The Source Luke</TT
>), and sends it off to
<SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
>.</P
><P
><B
CLASS="COMMAND"
>pppd</B
> also composes a CHAP challenge for
<SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
> containing a unique challenge
string and its fully qualified hostname,
<SPAN
CLASS="SYSTEMITEM"
>vlager.vbrew.com</SPAN
>.
<SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
> constructs a CHAP response in
the way we discussed, and returns it to
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>. <B
CLASS="COMMAND"
>pppd</B
> then
extracts the client hostname
(<SPAN
CLASS="SYSTEMITEM"
>c3po.vbrew.com</SPAN
>) from the response and
searches the <TT
CLASS="FILENAME"
>chap-secrets</TT
> file for a line matching
<SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
> as a client and
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> as the server. The second line
does this, so <B
CLASS="COMMAND"
>pppd</B
> combines the CHAP challenge and the
secret <TT
CLASS="LITERAL"
>arttoo! arttoo!</TT
>, encrypts them, and compares
the result to <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
>'s CHAP response.</P
><P
>&#13;

The optional fourth field lists the IP addresses that are acceptable
for the client named in the first field. The addresses can be given
in dotted quad notation or as hostnames that are looked up with the
resolver.  For instance, if <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
>
asks to use an IP address during IPCP negotiation that is not in this
list, the request is rejected, and IPCP is shut down. In the
sample file shown above, <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
>
is therefore limited to using its own IP address. If the address field is
empty, any addresses are allowed; a value of
&#8220;<TT
CLASS="LITERAL"
>-</TT
>&#8221; prevents the use of IP with that client
altogether.</P
><P
>The third line of the sample <TT
CLASS="FILENAME"
>chap-secrets</TT
> file
allows any host to establish a PPP link with
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> because a client or server field
of <TT
CLASS="LITERAL"
>*</TT
> is a wildcard matching any hostname. The only
requirements are that the connecting host must know the secret and that it must use
the IP address associated with
<SPAN
CLASS="SYSTEMITEM"
>pub.vbrew.com</SPAN
>. Entries with wildcard
hostnames may appear anywhere in the secrets file, since
<B
CLASS="COMMAND"
>pppd</B
> will always use the best match it can find for
the server/client pair.</P
><P
><B
CLASS="COMMAND"
>pppd</B
> may need some help forming hostnames. As explained
before, the remote hostname is always provided by the peer in the CHAP
challenge or response packet.  The local hostname is obtained by calling
the <CODE
CLASS="FUNCTION"
>gethostname(2)</CODE
> function by default. If you have
set the system name to your unqualified hostname, you also have to provide
<B
CLASS="COMMAND"
>pppd</B
> with the domain name using the
<CODE
CLASS="OPTION"
>domain</CODE
> option:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>pppd &#8230; domain vbrew.com</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This provision appends the Brewery's domain name to <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> for all authentication related
activities.  Other options that modify
<B
CLASS="COMMAND"
>pppd</B
>&#8201;'s idea of the local hostname are
<CODE
CLASS="OPTION"
>usehostname</CODE
> and <CODE
CLASS="OPTION"
>name</CODE
>.  When you give
the local IP address on the command line using
<B
CLASS="COMMAND"
><TT
CLASS="REPLACEABLE"
><I
>local</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>remote</I
></TT
></B
> and <TT
CLASS="REPLACEABLE"
><I
>local</I
></TT
> as a name instead of a dotted
quad, <B
CLASS="COMMAND"
>pppd</B
> uses this as the local hostname.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN7250"
>8.8.3. The PAP Secrets File</A
></H3
><P
>&#13;
 
The PAP secrets file is very similar to CHAP's. The first two
fields always contain a username and a server name; the third holds the
PAP secret.  When the remote host sends its authentication information,
<B
CLASS="COMMAND"
>pppd</B
> uses the entry that has a server field equal to the
local hostname, and a user field equal to the username sent in the request.
When it is necessary for us to send our credentials to the peer,
<B
CLASS="COMMAND"
>pppd</B
> uses the secret that has a user field equal to the
local username and the server field equal to the remote hostname.</P
><P
>A sample PAP secrets file might look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/ppp/pap-secrets
#
# user          server          secret          addrs
vlager-pap      c3po            cresspahl       vlager.vbrew.com
c3po            vlager          DonaldGNUth     c3po.lucas.com</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The first line is used to authenticate ourselves when talking to
<SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
>.  The second line describes
how a user named <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
> has
to authenticate itself with us.</P
><P
>The name <SPAN
CLASS="SYSTEMITEM"
>vlager-pap</SPAN
> in the first column
is the username we send to <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
>.
By default, <B
CLASS="COMMAND"
>pppd</B
> picks the local hostname as the username,
but you can also specify a different name by giving the <CODE
CLASS="OPTION"
>user</CODE
>
option followed by that name.</P
><P
>When picking an entry from the <TT
CLASS="FILENAME"
>pap-secrets</TT
> file
to identify us to a remote host, <B
CLASS="COMMAND"
>pppd</B
>
must know the remote host's name.  As it has no way of finding that
out, you must specify it on the command line using the
<CODE
CLASS="OPTION"
>remotename</CODE
> keyword followed by the peer's
hostname. To use the above entry for authentication with
<SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
>, for example, we must add the
following option to <B
CLASS="COMMAND"
>pppd</B
>&#8201;'s command line:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>pppd ... remotename c3po user vlager-pap</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>In the fourth field of the PAP secrets file (and all following fields), you can specify what IP addresses are allowed for that
particular host, just as in the CHAP secrets file. The peer will be
allowed to request only addresses from that list. In the sample file,
the entry that <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
> will use
when it dials in&#8212;the line where <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
> is the client&#8212;allows it to use
its real IP address and no other.</P
><P
>Note that PAP is a rather weak authentication method, you should
use CHAP instead whenever possible. We will therefore not cover PAP in greater
detail here;  if you are interested in using it, you will find more PAP
features in the <TT
CLASS="FILENAME"
>pppd(8)</TT
> manual page.



&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN7287"
>8.9. Debugging Your PPP Setup</A
></H2
><P
>&#13;


By default, <B
CLASS="COMMAND"
>pppd</B
> logs any warnings and error messages
to <B
CLASS="COMMAND"
>syslog</B
>&#8201;'s <SPAN
CLASS="SYSTEMITEM"
>daemon</SPAN
>
facility. You have to add an entry to <TT
CLASS="FILENAME"
>syslog.conf</TT
> that redirects
these messages to a file or even the console; otherwise, <B
CLASS="COMMAND"
>syslog</B
> 
simply discards them. The following entry
sends all messages to <TT
CLASS="FILENAME"
>/var/log/ppp-log</TT
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>daemon.*                /var/log/ppp-log</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>If your PPP setup doesn't work right away, you should look in this log
file. If the log messages don't help, you can also turn on extra
debugging output using the <CODE
CLASS="OPTION"
>debug</CODE
> option. This output makes
<B
CLASS="COMMAND"
>pppd</B
> log the contents of all control packets sent
or received to <B
CLASS="COMMAND"
>syslog</B
>.  All messages then go to the
<SPAN
CLASS="SYSTEMITEM"
>daemon</SPAN
> facility.</P
><P
> 
Finally, the most drastic way to check a problem is to enable kernel-level
debugging by invoking <B
CLASS="COMMAND"
>pppd</B
> with the <CODE
CLASS="OPTION"
>kdebug</CODE
>
option. It is followed by a numeric argument that is the sum of the
following values: 1 for general debug messages, 2 for printing the contents of
all incoming HDLC frames, and 4 to make the driver print all outgoing
HDLC frames. To capture kernel debugging messages, you must either run
a <B
CLASS="COMMAND"
>syslogd</B
> daemon that reads the
<TT
CLASS="FILENAME"
>/proc/kmsg</TT
> file, or the <B
CLASS="COMMAND"
>klogd</B
> daemon.
Either of them directs kernel debugging to the <B
CLASS="COMMAND"
>syslog</B
>
<SPAN
CLASS="SYSTEMITEM"
>kernel</SPAN
> facility.&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN7323"
>8.10. More Advanced PPP Configurations</A
></H2
><P
>&#13;While configuring PPP to dial in to a network like the Internet is the
most common application, there are those of you who have more
advanced requirements. In this section we'll talk about a few of the more
advanced configurations possible with PPP under Linux.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN7329"
>8.10.1. PPP Server</A
></H3
><P
>&#13; 
 
Running <B
CLASS="COMMAND"
>pppd</B
> as a server is just a matter of
configuring a serial tty device to invoke <B
CLASS="COMMAND"
>pppd</B
> with
appropriate options when an incoming data call has been received. One
way to do this is to create a special account, say <SPAN
CLASS="SYSTEMITEM"
>ppp</SPAN
>, and give it a script or program as a
login shell that invokes <B
CLASS="COMMAND"
>pppd</B
> with these
options. Alternatively, if you intend to support PAP or CHAP
authentication, you can use the <B
CLASS="COMMAND"
>mgetty</B
> program to
support your modem and exploit its &#8220;/AutoPPP/&#8221; feature.</P
><P
>To build a server using the login method, you add a line similar
to the following to your <TT
CLASS="FILENAME"
>/etc/passwd</TT
>
file:<A
NAME="X-087-2-FNPP14"
HREF="#FTN.X-087-2-FNPP14"
><SPAN
CLASS="footnote"
>[58]</SPAN
></A
>
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ppp:x:500:200:Public PPP Account:/tmp:/etc/ppp/ppplogin</PRE
></FONT
></TD
></TR
></TABLE
>

If your system supports shadow passwords, you also need to add an entry
to the <TT
CLASS="FILENAME"
>/etc/shadow</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ppp:!:10913:0:99999:7:::</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Of course, the UID and GID you use depends on which user you wish to
own the connection, and how you've created it. You also have to set the
password for the mentioned account using the <B
CLASS="COMMAND"
>passwd</B
> command.</P
><P
>The <B
CLASS="COMMAND"
>ppplogin</B
> script might look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#!/bin/sh
# ppplogin - script to fire up pppd on login
mesg n
stty -echo
exec pppd -detach silent modem crtscts</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <B
CLASS="COMMAND"
>mesg</B
> command disables other users from writing
to the tty by using, for instance, the <B
CLASS="COMMAND"
>write</B
>
command. The <B
CLASS="COMMAND"
>stty</B
> command turns off character
echoing. This command is necessary; otherwise, everything the peer sends would
be echoed back to it. The most important <B
CLASS="COMMAND"
>pppd</B
>
option given is <SPAN
CLASS="SYSTEMITEM"
>&#8211;detach</SPAN
>
because it prevents <B
CLASS="COMMAND"
>pppd</B
> from detaching from the
controlling tty.  If we didn't specify this option, it would go to the
background, making the shell script exit. This in turn would cause the
serial line to hang up and the connection to be dropped.  The
<B
CLASS="COMMAND"
>silent</B
> option causes <B
CLASS="COMMAND"
>pppd</B
> to
wait until it receives a packet from the calling system before it
starts sending.  This option prevents transmit timeouts from occurring when
the calling system is slow in firing up its PPP client. The
<SPAN
CLASS="SYSTEMITEM"
>modem</SPAN
> option makes
<B
CLASS="COMMAND"
>pppd</B
> drive the modem control lines of the serial
port.  You should always turn this option on when using
<B
CLASS="COMMAND"
>pppd</B
> with a modem.  The <CODE
CLASS="OPTION"
>crtscts</CODE
>
option turns on hardware handshake.</P
><P
>Besides these options, you might want to force some sort of
authentication, for example, by specifying <CODE
CLASS="OPTION"
>auth</CODE
> on
<B
CLASS="COMMAND"
>pppd</B
>&#8201;'s command line or in the global
options file.  The manual page also discusses more specific options
for turning individual authentication protocols on and off.</P
><P
>If you wish to use <B
CLASS="COMMAND"
>mgetty</B
>, all you need to do is
configure <B
CLASS="COMMAND"
>mgetty</B
> to support the serial device your modem
is connected to (see <A
HREF="#X-087-2-SERIAL.GETTY.MGETTY"
>Section 4.6.1</A
>&#8221; for details),
configure <B
CLASS="COMMAND"
>pppd</B
> for either PAP or CHAP authentication
with appropriate options in its <TT
CLASS="FILENAME"
>options</TT
> file, and finally,
add a section similar to the following to your
<TT
CLASS="FILENAME"
>/etc/mgetty/login.config</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># Configure mgetty to automatically detect incoming PPP calls and invoke
# the pppd daemon to handle the connection.
#
/AutoPPP/ -     ppp   /usr/sbin/pppd auth -chap +pap login</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The first field is a special piece of magic used to detect that
an incoming call is a PPP one. You must not change the case of this string;
it is case sensitive. The third column is the username that appears in
<B
CLASS="COMMAND"
>who</B
> listings when someone has logged in. The rest of the
line is the command to invoke. In our example, we've ensured that PAP
authentication is required, disabled CHAP, and specified that the system
<TT
CLASS="FILENAME"
>passwd</TT
> file should be used for authenticating users.
This is probably similar to what you'll want. Remember, you can specify
the options in the <TT
CLASS="FILENAME"
>options</TT
> file or on the command line
if you prefer.</P
><P
>Here is a small checklist of tasks to perform and the sequence you should
perform them to get PPP dial in working on your machine. Make sure each
step works before moving on to the next:

<P
></P
><OL
TYPE="1"
><LI
><P
>Configure the modem for auto-answer mode. On Hayes-compatible modems,
this is performed using a command like <TT
CLASS="LITERAL"
>ATS0=3</TT
>. If you're
going to be using the <B
CLASS="COMMAND"
>mgetty</B
> daemon, this isn't necessary.</P
></LI
><LI
><P
>Configure the serial device with a <B
CLASS="COMMAND"
>getty</B
> type of command to
answer incoming calls. A commonly used <B
CLASS="COMMAND"
>getty</B
> variant is
<B
CLASS="COMMAND"
>mgetty</B
>.</P
></LI
><LI
><P
>Consider authentication. Will your callers authenticate using PAP,
CHAP, or system login?</P
></LI
><LI
><P
>Configure <B
CLASS="COMMAND"
>pppd</B
> as server as described in this section.</P
></LI
><LI
><P
>Consider routing. Will you need to provide a network route to callers?
Routing can be performed using the <TT
CLASS="FILENAME"
>ip-up</TT
> script.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN7405"
>8.10.2. Demand Dialing</A
></H3
><P
>&#13;



When there is IP
traffic to be carried across the link, <EM
>demand dialing</EM
> causes your telephone modem to
dial and to establish a connection to a remote host. Demand dialing is most useful
when you can't leave your telephone line permanently switched to your
Internet provider. For example, you might have to pay timed local calls, so it might be cheaper to have the telephone line
switched on only when you need it and disconnected when you aren't
using the Internet.</P
><P
>Traditional Linux solutions have used the <B
CLASS="COMMAND"
>diald</B
>
command, which worked well but was fairly tricky to
configure. Versions 2.3.0 and later of the PPP daemon have built-in
support for demand dialing and make it very simple to configure. You
must use a modern kernel for this to work, too. Any of the later 2.0
kernels will work just fine.</P
><P
>To configure <B
CLASS="COMMAND"
>pppd</B
> for demand dialing, all you need to do
is add options to your <TT
CLASS="FILENAME"
>options</TT
> file or the
<B
CLASS="COMMAND"
>pppd</B
> command line. The following table summarizes the
options related to demand dialing:

<DIV
CLASS="INFORMALTABLE"
><P
></P
><A
NAME="AEN7429"
></A
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL
WIDTH="0"><COL
WIDTH="3"><THEAD
><TR
><TH
>Option</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="LITERAL"
>demand</TT
></TD
><TD
><P
>This option specifies that the PPP link should be placed in demand dial mode. The PPP network device will be created, but the <TT
CLASS="LITERAL"
>connect</TT
> command will not be used until a datagram is transmitted by the local host. This option is mandatory for demand dialing to work.</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>active-filter</TT
> <TT
CLASS="REPLACEABLE"
><I
>expression</I
></TT
></TD
><TD
><P
>This option allows you to specify which data packets are to be considered active traffic. Any traffic matching the specified rule will restart the demand dial idle timer, ensuring that <B
CLASS="COMMAND"
>pppd</B
> waits again before closing the link. The filter syntax has been borrowed from the <B
CLASS="COMMAND"
>tcpdump</B
> command. The default filter matches all datagrams.</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>holdoff</TT
> <TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
></TD
><TD
><P
>This option allows you to specify the minimum amount of time, in seconds, to wait before reconnecting this link if it terminates. If the connection fails while <B
CLASS="COMMAND"
>pppd</B
> believes it is in active use, it will be re-established after this timer has expired. This timer does not apply to reconnections after an idle timeout.</P
></TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>idle</TT
> <TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
></TD
><TD
><P
>If this option is configured, <B
CLASS="COMMAND"
>pppd</B
> will disconnect the link whenever this timer expires. Idle times are specified in seconds. Each new active data packet will reset the timer.</P
></TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
>

A simple demand dialing configuration would therefore look something
like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>demand
holdoff 60
idle 180</PRE
></FONT
></TD
></TR
></TABLE
>

This configuration would enable demand dialing, wait 60 seconds before
re-establishing a failed connection, and drop the link if 180 seconds pass
without any active data on the link.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN7467"
>8.10.3. Persistent Dialing</A
></H3
><P
>&#13;



<EM
>Persistent dialing</EM
> is what people who have
permanent dialup connections to a network will want to use. There is a
subtle difference between demand dialing and persistent dialing. With
persistent dialing, the connection is automatically established as soon
as the PPP daemon is started, and the persistent aspect comes into play
whenever the telephone call supporting the link fails. Persistent dialing ensures that the link is always
available by automatically rebuilding the connection if it fails.</P
><P
>You might be fortunate to not have to pay for your telephone calls;
perhaps they are local and free, or perhaps they're paid by your
company. The persistent dialing option is extremely useful in this
situation. If you do have to pay for your telephone calls, then you
have to be a little careful. If you pay for your telephone calls on a
time-charged basis, persistent dialing is almost certainly not what
you want, unless you're very sure you'll be using the connection fairly
steadily twenty-four hours a day. If you do pay for calls, but they
are not time charged, you need to be careful to protect yourself
against situations that might cause the modem to endlessly redial. The
<B
CLASS="COMMAND"
>pppd</B
> daemon provides an option that can help reduce
the effects of this problem.</P
><P
>To enable persistent dialing, you must include the <SPAN
CLASS="SYSTEMITEM"
>persist</SPAN
> option in one of your
<B
CLASS="COMMAND"
>pppd</B
> options files. Including this option alone is
all you need to have <B
CLASS="COMMAND"
>pppd</B
> automatically
invoke the command specified by the <SPAN
CLASS="SYSTEMITEM"
>connect</SPAN
> option to rebuild the connection
when the link fails. If you are concerned about the modem redialing
too rapidly (in the case of modem or server fault at the
other end of the connection), you can use the <SPAN
CLASS="SYSTEMITEM"
>holdoff</SPAN
> option to set the minimum amount
of time that <B
CLASS="COMMAND"
>pppd</B
> will wait before attempting to
reconnect.  This option won't solve the problem of a fault costing you money
in wasted phone calls, but it will at least serve to reduce the impact
of one.</P
><P
>A typical configuration might have persistent dialing options that
look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>persist
holdoff 600</PRE
></FONT
></TD
></TR
></TABLE
>

The holdoff time is specified in seconds. In our example,
<B
CLASS="COMMAND"
>pppd</B
> waits a full five minutes before redialing
after the call drops out.</P
><P
>It is possible to combine persistent dialing with demand dialing,
using <SPAN
CLASS="SYSTEMITEM"
>idle</SPAN
> to drop the link if
it has been idle for a specified period of time. We doubt many users
would want to do so, but this scenario is described briefly in the
<B
CLASS="COMMAND"
>pppd</B
> manual page, if you'd like to pursue it.</P
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-FIREWALL"
></A
>Chapter 9. TCP/IP Firewall</H1
><P
>&#13;

Security is increasingly important for companies and individuals alike.
The Internet has provided them with a powerful tool to distribute information
about themselves and obtain information from others, but it has
also exposed them to dangers that they have previously been exempt from. 
Computer crime, information theft, and malicious damage are all potential
dangers.</P
><P
>An unauthorized and unscrupulous person who gains access to
a computer system may guess system passwords or
exploit the bugs and idiosyncratic behavior of certain programs to obtain
a working account on that machine. Once they are able to log in to the
machine, they may have access to information that may be damaging, such as
commercially sensitive information like marketing plans,
new project details, or customer information databases. Damaging or modifying
this type of data can cause severe setbacks to the company.</P
><P
>The safest way to avoid such widespread damage is to prevent unauthorized
people from gaining network access to the machine. This is where firewalls
come in.</P
><DIV
CLASS="WARNING"
><P
></P
><TABLE
CLASS="WARNING"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.png"
HSPACE="5"
ALT="Warning"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>&#13;Constructing secure firewalls is an art. It involves a good understanding
of technology, but equally important, it requires an understanding
of the philosophy behind firewall designs. We won't cover
everything you need to know in this book; we strongly recommend you
do some additional research before trusting any particular firewall design,
including any we present here.</P
></TD
></TR
></TABLE
></DIV
><P
>There is enough material on firewall configuration and design
to fill a whole book, and indeed there are some good resources that you might
like to read to expand your knowledge on the subject. Two of these are:
<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><EM
>Building Internet Firewalls</EM
></DT
><DD
><P
>by D. Chapman and E. Zwicky (O'Reilly). A guide
explaining how to design and install firewalls for Unix, Linux, and
Windows NT, and how to configure Internet services to work with the
firewalls.</P
></DD
><DT
><EM
>Firewalls and Internet Security</EM
></DT
><DD
><P
>by W. Cheswick and S. Bellovin (Addison Wesley). This book covers the 
philosophy of firewall design and implementation.</P
></DD
></DL
></DIV
></P
><P
>We will focus on the Linux-specific technical issues in this chapter. Later
we will present a sample firewall configuration that should serve as a useful
starting point in your own configuration, but as with all security-related
matters, trust no one. Double check the design, make sure you understand it,
and then modify it to suit your requirements. To be safe, be sure.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-082-2-FIREWALL.ATTACKS"
>9.1. Methods of Attack</A
></H2
><P
>&#13;
As a network administrator, it is important that you understand the nature of
potential attacks on computer security. We'll briefly
describe the most important types of attacks so that you can better understand
precisely what the Linux IP firewall will protect you against. You should do
some additional reading to ensure that you are able to protect your
network against other types of attacks. Here
are some of the more important methods of attack and ways of protecting
yourself against them:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Unauthorized access</DT
><DD
><P
>This simply means that people who shouldn't use your computer services are
able to connect and
use them. For example, people outside your company might try to
connect to your company accounting machine or to your NFS server.</P
><P
>There are various ways to avoid this attack by carefully specifying who
can gain access through these services. You can prevent network access
to all except the intended users.</P
></DD
><DT
>Exploitation of known weaknesses in programs</DT
><DD
><P
>Some programs and network services were not originally designed with strong
security in mind and are inherently vulnerable to attack. The BSD remote
services (rlogin, rexec, etc.) are an example.</P
><P
>The best way to protect yourself against this type of attack is to disable
any vulnerable services or find alternatives. With Open Source, it is
sometimes possible to repair the weaknesses in the software.</P
></DD
><DT
>Denial of service</DT
><DD
><P
>&#13;Denial of service attacks cause the service or program to cease functioning or
prevent others from making use of the service or program. These may be
performed at the network layer by sending carefully crafted and malicious
datagrams that cause network connections to fail. They may also be performed
at the application layer, where carefully crafted application commands are
given to a program that cause it to become extremely busy or stop functioning.</P
><P
>Preventing suspicious network traffic from reaching your hosts and preventing
suspicious program commands and requests are the best ways of minimizing the
risk of a denial of service attack. It's useful to know the details of the 
attack method, so you should educate yourself about each new attack as it 
gets publicized.</P
></DD
><DT
>Spoofing</DT
><DD
><P
>&#13;This type of attack causes a host or application to mimic the
actions of another. Typically the attacker pretends to be an innocent host
by following IP addresses in network packets. For example, a
well-documented exploit of the BSD rlogin service can use this method to mimic a
TCP connection from another host by guessing TCP sequence numbers.</P
><P
>To protect against this type of attack, verify the authenticity of datagrams
and commands. Prevent datagram routing with invalid source addresses.
Introduce unpredictablility into connection control mechanisms, such as TCP
sequence numbers and the allocation of dynamic port addresses.</P
></DD
><DT
>Eavesdropping</DT
><DD
><P
>&#13;This is the simplest type of attack. A host is configured to "listen" to and
capture data not belonging to it. Carefully written eavesdropping programs
can take usernames and passwords from user login network connections.
Broadcast networks like Ethernet are especially vulnerable to this type of
attack.</P
><P
>To protect against this type of threat, avoid use of broadcast
network technologies and enforce the use of data encryption.</P
></DD
></DL
></DIV
><P
>IP firewalling is very useful in preventing or reducing unauthorized access,
network layer denial of service, and IP spoofing attacks. It not very useful
in avoiding exploitation of weaknesses in network services or programs and
eavesdropping. </P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-FIREWALL.INTRODUCTION"
>9.2. What Is a Firewall?</A
></H2
><P
>&#13;A firewall is a secure and trusted machine that sits between a private
network and a public network.<A
NAME="X-087-2-FW-FN01"
HREF="#FTN.X-087-2-FW-FN01"
><SPAN
CLASS="footnote"
>[59]</SPAN
></A
>
The firewall machine is configured with a set of rules that determine
which network traffic will be allowed to pass and which will be blocked
or refused. In some large organizations, you may even find a firewall
located inside their corporate network to segregate sensitive areas
of the organization from other employees. Many cases of computer
crime occur from within an organization, not just from outside.</P
><P
>Firewalls can be constructed in quite a variety of ways.  The most
sophisticated arrangement involves a number of separate machines and
is known as a <EM
>perimeter network</EM
>. Two machines act
as "filters" called chokes to allow only certain types of network
traffic to pass, and between these chokes reside network servers such as a
mail gateway or a World Wide Web proxy server. This configuration can
be very safe and easily allows quite a great range of control over who
can connect both from the inside to the outside, and from the outside
to the inside. This sort of configuration might be used by large
organizations.</P
><P
>Typically though, firewalls are single machines that serve all of these
functions. These are a little less secure, because if there is some
weakness in the firewall machine itself that allows people to gain access
to it, the whole network security has been breached. Nevertheless,
these types of firewalls are cheaper and easier to manage than the more
sophisticated arrangement just described.
<A
HREF="#X-087-2-FIREWALL.DESIGN.GRAPHIC"
>Figure 9-1</A
> illustrates the two most
common firewall configurations.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-FIREWALL.DESIGN.GRAPHIC"
></A
><P
><B
>Figure 9-1. The two major classes of firewall design</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_0901.jpg"></P
></DIV
></DIV
><P
>The Linux kernel provides a range of built-in features that allow it
to function quite nicely as an IP firewall. The network implementation
includes code to do IP filtering in a number of different ways, and
provides a mechanism to quite accurately configure what sort of rules
you'd like to put in place. The Linux firewall is flexible enough to
make it very useful in either of the configurations illustrated in
<A
HREF="#X-087-2-FIREWALL.DESIGN.GRAPHIC"
>Figure 9-1</A
>. Linux firewall
software provides two other useful features that we'll discuss in
separate chapters: IP Accounting (<A
HREF="#X-087-2-ACCOUNTING"
>Chapter 10</A
>) and IP masquerade (<A
HREF="#X-087-2-IPMASQ"
>Chapter 11</A
>).</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-FIREWALL.FILTERING"
>9.3. What Is IP Filtering?</A
></H2
><P
>&#13;


IP filtering is simply a mechanism that decides which types of IP
datagrams will be processed normally and which will be discarded. By
<EM
>discarded</EM
> we mean that the datagram is deleted
and completely ignored, as if it had never been received. You can
apply many different sorts of criteria to determine which datagrams
you wish to filter; some examples of these are:

<P
></P
><UL
><LI
><P
>Protocol type: TCP, UDP, ICMP, etc.</P
></LI
><LI
><P
>Socket number (for TCP/UPD)</P
></LI
><LI
><P
>Datagram type: SYN/ACK, data, ICMP Echo Request, etc.</P
></LI
><LI
><P
>Datagram source address: where it came from</P
></LI
><LI
><P
>Datagram destination address: where it is going to</P
></LI
></UL
>&#13;</P
><P
>It is important to understand at this point that IP filtering is a
network layer facility. This means it doesn't understand anything
about the application using the network connections, only about the
connections themselves. For example, you may deny users access to your
internal network on the default telnet port, but if you rely on IP
filtering alone, you can't stop them from using the telnet program
with a port that you do allow to pass trhough your firewall. You can prevent
this sort of problem by using proxy servers for each service that you
allow across your firewall. The proxy servers understand the
application they were designed to proxy and can therefore prevent
abuses, such as using the telnet program to get past a firewall by
using the World Wide Web port. If your firewall supports a World Wide
Web proxy, their telnet connection will always be answered by the
proxy and will allow only HTTP requests to pass. A large number of
proxy-server programs exist. Some are free software and many others
are commercial products. The Firewall-HOWTO discusses one popular set
of these, but they are beyond the scope of this book.</P
><P
>The IP filtering ruleset is made up of many combinations of the criteria
listed previously. For example, let's imagine that you wanted to allow World
Wide Web users within the Virtual Brewery network to have no access to the
Internet except to use other sites' web servers. You would configure your
firewall
to allow forwarding of:

<P
></P
><UL
><LI
><P
>datagrams with a source address on Virtual Brewery network, a destination
address of anywhere, and with a destination port of 80 (WWW)</P
></LI
><LI
><P
>datagrams with a destination address of Virtual Brewery network and a
source port of 80 (WWW) from a source address of anywhere</P
></LI
></UL
>&#13;</P
><P
>Note that we've used two rules here. We have to allow our data to go out,
but also the corresponding reply data to come back in. In practice, as we'll
see shortly, Linux simplifies this and allows us to specify this in one
command. </P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-FIREWALL.HOWTO"
>9.4. Setting Up Linux for Firewalling</A
></H2
><P
>&#13;
To build a Linux IP firewall, it is necessary to have a kernel built
with IP firewall support and the appropriate configuration utility. In
all production kernels prior to the 2.2 series, you would use the
<B
CLASS="COMMAND"
>ipfwadm</B
> utility. The 2.2.x kernels marked the
release of the third generation of IP firewall for Linux called
<EM
>IP Chains</EM
>.  IP chains use a program similar to
<B
CLASS="COMMAND"
>ipfwadm</B
> called <B
CLASS="COMMAND"
>ipchains</B
>. Linux
kernels 2.3.15 and later support the fourth generation of Linux IP
firewall called <EM
>netfilter</EM
>. The
<EM
>netfilter</EM
> code is the result of a large redesign
of the packet handling flow in Linux. The
<EM
>netfilter</EM
> is a multifaceted creature, providing
direct backward-compatible support for both <B
CLASS="COMMAND"
>ipfwadm</B
>
and <B
CLASS="COMMAND"
>ipchains</B
> as well as a new alternative command
called <B
CLASS="COMMAND"
>iptables</B
>. We'll talk about the differences
between the three in the next few sections.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-FIREWALL.HOWTO.KERNEL"
>9.4.1. Kernel Configured with IP Firewall</A
></H3
><P
>The Linux kernel must be configured to support IP firewalling. There
isn't much more to it than selecting the appropriate options when
performing a <TT
CLASS="LITERAL"
>make menuconfig</TT
> of your
kernel.<A
NAME="X-087-2-FW-FN02"
HREF="#FTN.X-087-2-FW-FN02"
><SPAN
CLASS="footnote"
>[60]</SPAN
></A
>
We described how to do this is in
<A
HREF="#X-087-2-HARDWARE"
>Chapter 3</A
>&#8221;.
In 2.2 kernels you should select the following options:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Networking options  ---&#62;
	[*] Network firewalls
	[*] TCP/IP networking
	[*] IP: firewalling
	[*] IP: firewall packet logging</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>In kernels 2.4.0 and later you should select this option instead:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>  Networking options  ---&#62;
     [*] Network packet filtering (replaces ipchains)
         IP: Netfilter Configuration  ---&#62;
              .
             &#60;M&#62; Userspace queueing via NETLINK (EXPERIMENTAL)
             &#60;M&#62; IP tables support (required for filtering/masq/NAT)
             &#60;M&#62;   limit match support
             &#60;M&#62;   MAC address match support
             &#60;M&#62;   netfilter MARK match support
             &#60;M&#62;   Multiple port match support
             &#60;M&#62;   TOS match support
             &#60;M&#62;   Connection state match support
             &#60;M&#62;   Unclean match support (EXPERIMENTAL)
             &#60;M&#62;   Owner match support (EXPERIMENTAL)
             &#60;M&#62;   Packet filtering
             &#60;M&#62;     REJECT target support
             &#60;M&#62;     MIRROR target support (EXPERIMENTAL)
              .
             &#60;M&#62;   Packet mangling
             &#60;M&#62;     TOS target support
             &#60;M&#62;     MARK target support
             &#60;M&#62;   LOG target support
             &#60;M&#62; ipchains (2.2-style) support
             &#60;M&#62; ipfwadm (2.0-style) support
  </PRE
></FONT
></TD
></TR
></TABLE
>
  </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-FIREWALL.HOWTO.IPFWADM"
>9.4.2. The ipfwadm Utility</A
></H3
><P
>&#13;The <B
CLASS="COMMAND"
>ipfwadm</B
> (IP Firewall Administration) utility is the
tool used to build the firewall rules for all kernels prior to 2.2.0. Its
command syntax can be very confusing because it can do such a complicated
range of things, but we'll provide some common examples that will illustrate
the most important variations of these.</P
><P
>The <B
CLASS="COMMAND"
>ipfwadm</B
> utility is included in most
modern Linux distributions, but perhaps not by default. There may be a
specific software package for it that you have to install. If your
distribution does not include it, you can obtain the source package from
<SPAN
CLASS="SYSTEMITEM"
>ftp.xos.nl</SPAN
> in the
<TT
CLASS="FILENAME"
>/pub/linux/ipfwadm/</TT
> directory, and compile it yourself.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-FIREWALL.HOWTO.IPCHAINS"
>9.4.3. The ipchains Utility</A
></H3
><P
>&#13;Just as for the <B
CLASS="COMMAND"
>ipfwadm</B
> utility, the
<B
CLASS="COMMAND"
>ipchains</B
> utility can be somewhat baffling to use at first.
It provides all of the flexibility of <B
CLASS="COMMAND"
>ipfwadm</B
> with a
simplified command syntax, and additionally provides a &#8220;chaining&#8221; mechanism that allows you to manage multiple
rulesets and link them together. We'll cover rule chaining in a separate
section near the end of the chapter, because for most situations it is an
advanced concept.</P
><P
>&#13;The <B
CLASS="COMMAND"
>ipchains</B
> command appears in most Linux
distributions based on the 2.2 kernels. If you want to compile it
yourself, you can find the source package from its developer's site at
<EM
>http://www.rustcorp.com/linux/ipchains/</EM
>.
Included in the source package is a wrapper script called
<B
CLASS="COMMAND"
>ipfwadm-wrapper</B
> that mimics the
<B
CLASS="COMMAND"
>ipfwadm</B
> command, but actually invokes the
<B
CLASS="COMMAND"
>ipchains</B
> command. Migration of an existing firewall
configuration is much more painless with this addition.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-FIREWALL.HOWTO.IPTABLES"
>9.4.4. The iptables Utility</A
></H3
><P
>&#13;The syntax of the <B
CLASS="COMMAND"
>iptables</B
> utility is quite similar to that
of the <B
CLASS="COMMAND"
>ipchains</B
> syntax. The changes are improvements and a
result of the tool being redesigned to be extensible through shared libraries.
Just as for <B
CLASS="COMMAND"
>ipchains</B
>, we'll present
<B
CLASS="COMMAND"
>iptables</B
> equivalents of the examples so you can compare
and contrast its syntax with the others.</P
><P
>The <B
CLASS="COMMAND"
>iptables</B
> utility is included in the
<EM
>netfilter</EM
> source package available at
<EM
>http://www.samba.org/netfilter/</EM
>. It will
also be included in any Linux distribution based on the 2.4 series kernels.</P
><P
>We'll talk a bit about <EM
>netfilter</EM
>'s huge step forward in a section of its own later in this chapter.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-FIREWALL.FILTERINGMETHODS"
>9.5. Three Ways We Can Do Filtering</A
></H2
><P
>Consider how a Unix machine, or in fact any machine capable of IP routing,
processes IP datagrams. The basic steps, shown in <A
HREF="#X-087-2-FIREWALL.METHODS.GRAPHIC"
>Figure 9-2</A
> are:</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-FIREWALL.METHODS.GRAPHIC"
></A
><P
><B
>Figure 9-2. The stages of IP datagram processing</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_0902.jpg"></P
></DIV
></DIV
><P
></P
><UL
><LI
><P
>The IP datagram is received. (1)</P
></LI
><LI
><P
>The incoming IP datagram is examined to determine if it is destined for a
process on this machine.</P
></LI
><LI
><P
>If the datagram is for this machine, it is processed locally. (2)</P
></LI
><LI
><P
>If it is not destined for this machine, a search is made of the routing table
for an appropriate route and the datagram is forwarded to the appropriate
interface or dropped if no route can be found. (3)</P
></LI
><LI
><P
>Datagrams from local processes are sent to the routing software for forwarding
to the appropriate interface. (4)</P
></LI
><LI
><P
>The outgoing IP datagram is examined to determine if there is a valid route
for it to take, if not, it is dropped.</P
></LI
><LI
><P
>The IP datagram is transmitted. (5)</P
></LI
></UL
><P
>In our diagram, the flow 1&#8594;3&#8594;5 represents our machine
routing data between a host on our Ethernet network to a host
reachable via our PPP link. The flows 1&#8594;2 and 4&#8594;5 represent
the data input and output flows of a network program running on our
local host. The flow 4&#8594;3&#8594;2 would represent data flow via a
loopback connection. Naturally data flows both into and out of network
devices.  The question marks on the diagram represent the points where
the IP layer makes routing decisions.</P
><P
>The Linux kernel IP firewall is capable of applying filtering at various
stages in this process. That is, you can filter the IP datagrams that come in
to your machine, filter those datagrams being forwarded across your
machine, and filter those datagrams that are ready to be transmitted.</P
><P
>In <B
CLASS="COMMAND"
>ipfwadm</B
> and <B
CLASS="COMMAND"
>ipchains</B
>, an
Input rule applies to flow 1 on the diagram, a Forwarding rule to flow
3, and an Output rule to flow 5.  We'll see when we discuss
<EM
>netfilter</EM
> later that the points of interception
have changed so that an Input rule is applied at flow 2, and an
Output rule is applied at flow 4. This has important implications for
how you structure your rulesets, but the general principle holds true
for all versions of Linux firewalling.</P
><P
>This may seem unnecessarily complicated at first, but it provides flexibility
that allows some very sophisticated and powerful configurations to be built.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-FIREWALL.ORIGINAL"
>9.6. Original IP Firewall (2.0 Kernels)</A
></H2
><P
>&#13;




The first generation IP firewall support for Linux appeared in the 1.1
series kernel. It was a port of the BSD ipfw firewall support to Linux
by Alan Cox.  The firewall support that appeared in the 2.0 series
kernels and is the second generation was enhanced by Jos Vos, Pauline
Middelink, and others.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-FIREWALL.USINGIPFWADM"
>9.6.1. Using ipfwadm</A
></H3
><P
>The <B
CLASS="COMMAND"
>ipfwadm</B
> command was the configuration tool for the
second generation Linux IP firewall. Perhaps the simplest way to describe the
use of the <B
CLASS="COMMAND"
>ipfwadm</B
> command is by example. To begin, let's
code the example we presented earlier.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.SIMPLEEXAMPLE"
>9.6.1.1. A nave example</A
></H4
><P
>Let's suppose that we have a network in our organization and that we
are using a Linux-based firewall machine to connect our network to
the Internet. Additionally, let's suppose that we wish the users of
that network to be able to access web servers on the Internet, but to
allow no other traffic to be passed.</P
><P
>We will put in place a forwarding rule to allow datagrams with a source
address on our network and a destination socket of port 80 to be forwarded
out, and for the corresponding reply datagrams to be forwarded back via the
firewall.</P
><P
>Assume our network has a 24-bit network mask (Class C) and an address
of 172.16.1.0. The rules we might use are:
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipfwadm -F -f</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipfwadm -F -p deny</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipfwadm -F -a accept -P tcp -S 172.16.1.0/24 -D 0/0 80</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipfwadm -F -a accept -P tcp -S 0/0 80 -D 172.16.1.0/24</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <CODE
CLASS="OPTION"
>-F</CODE
> command-line argument tells
<B
CLASS="COMMAND"
>ipfwadm</B
> that this is a forwarding rule.
The first command instructs <B
CLASS="COMMAND"
>ipfwadm</B
> to "flush" all
of the forwarding rules. This ensures we are working from a known
state before we begin adding specific rules.</P
><P
>The second rule sets our default forwarding policy. We
tell the kernel to deny or disallow forwarding of IP datagrams. It
is very important to set the default policy, because this describes what will
happen to any datagrams that are not specifically handled by any other
rule. In most firewall configurations, you will want to set your default
policy to "deny," as shown, to be sure that only the traffic you specifically
allow past your firewall is forwarded.</P
><P
>The third and fourth rules are the ones that implement our requirement.
The third command allows our datagrams out, and the fourth rule allows
the responses back.</P
><P
>Let's review each of the arguments:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>-F</DT
><DD
><P
>This is a Forwarding rule.</P
></DD
><DT
>-a accept</DT
><DD
><P
>Append this rule with the policy set to "accept," meaning we will forward
any datagrams that match this rule.</P
></DD
><DT
>-P tcp</DT
><DD
><P
>This rule applies to tcp datagrams (as opposed to UDP or ICMP).</P
></DD
><DT
>-S 172.16.1.0/24</DT
><DD
><P
>The Source address must have the first 24 bits matching those of the
network address 172.16.1.0.</P
></DD
><DT
>-D 0/0 80</DT
><DD
><P
>The destination address must have zero bits matching the address 0.0.0.0.
This is really a shorthand notation for "anything." The 80 is the
destination port, in this case WWW. You may also use any entry that
appears in the <TT
CLASS="FILENAME"
>/etc/services</TT
> file to describe the
port, so <TT
CLASS="LITERAL"
>-D 0/0 www</TT
> would have worked just as well.</P
></DD
></DL
></DIV
></P
><P
><B
CLASS="COMMAND"
>ipfwadm</B
> accepts network masks in a form with which you may
not be familiar. The <TT
CLASS="LITERAL"
>/nn</TT
> notation is a means of
describing how many bits of the supplied address are significant, or the
size of the mask. The bits are always counted from left to right;
some common examples are listed in <A
HREF="#X-087-2-CHFW-NETMASKS"
>Table 9-1</A
>.</P
><DIV
CLASS="TABLE"
><A
NAME="X-087-2-CHFW-NETMASKS"
></A
><P
><B
>Table 9-1. Common Netmask Bit Values</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><THEAD
><TR
><TH
>Netmask</TH
><TH
>Bits</TH
></TR
></THEAD
><TBODY
><TR
><TD
>255.0.0.0</TD
><TD
>8</TD
></TR
><TR
><TD
>255.255.0.0</TD
><TD
>16</TD
></TR
><TR
><TD
>255.255.255.0</TD
><TD
>24</TD
></TR
><TR
><TD
>255.255.255.128</TD
><TD
>25</TD
></TR
><TR
><TD
>255.255.255.192</TD
><TD
>26</TD
></TR
><TR
><TD
>255.255.255.224</TD
><TD
>27</TD
></TR
><TR
><TD
>255.255.255.240</TD
><TD
>28</TD
></TR
><TR
><TD
>255.255.255.248</TD
><TD
>29</TD
></TR
><TR
><TD
>255.255.255.252</TD
><TD
>30</TD
></TR
></TBODY
></TABLE
></DIV
><P
>We mentioned earlier that <B
CLASS="COMMAND"
>ipfwadm</B
> implements a
small trick that makes adding these sorts of rules easier. This trick
is an option called <EM
>-b</EM
>, which makes the command a
bidirectional rule.</P
><P
>The bidirectional flag allows us to collapse our two
rules into one as follows:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipfwadm -F -a accept -P tcp -S 172.16.1.0/24 -D 0/0 80 -b</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.SIMPLEEXAMPLE.REFINEMENT"
>9.6.1.2. An important refinement</A
></H4
><P
>Take a closer look at our ruleset. Can you see that there is still one method
of attack that someone outside could use to defeat our firewall?</P
><P
>Our ruleset allows all datagrams from outside our network with a source port
of 80 to pass. This will include those datagrams with the SYN bit set! The SYN
bit is what declares a TCP datagram to be a connection request. If a person
on the outside had privileged access to a host, they could make a connection
through our firewall to any of our hosts, provided they use port 80 at their
end. This is not what we intended.</P
><P
>Fortunately there is a solution to this problem. The
<B
CLASS="COMMAND"
>ipfwadm</B
> command provides another flag that allows
us to build rules that will match datagrams with the SYN bit
set. Let's change our example to include such a rule:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipfwadm -F -a deny -P tcp -S 0/0 80 -D 172.16.10.0/24 -y</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipfwadm -F -a accept -P tcp -S 172.16.1.0/24 -D 0/0 80 -b</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <CODE
CLASS="OPTION"
>-y</CODE
> flag causes the rule to match only if the
SYN flag is set in the datagram. So our new rule says:
"Deny any TCP datagrams destined for our network from anywhere with a source
port of 80 and the SYN bit set," or "Deny any connection requests from hosts
using port 80."</P
><P
>Why have we placed this special rule <EM
>before</EM
> the
main rule?  IP firewall rules operate so that the first match is the
rule that is used. Both rules would match the datagrams we want to
stop, so we must be sure to put the <TT
CLASS="LITERAL"
>deny</TT
> rule
before the <TT
CLASS="LITERAL"
>accept</TT
> rule.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.LISTING"
>9.6.1.3. Listing our rules</A
></H4
><P
>&#13;After we've entered our rules, we ask <B
CLASS="COMMAND"
>ipfwadm</B
> to list
them for us using the command:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipfwadm -F -l</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

This command will list all of the configured forwarding rules. The output
should look something like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipfwadm -F -l</KBD
>
IP firewall forward rules, default policy: accept
type  prot source               destination          ports
deny  tcp  anywhere             172.16.10.0/24       www -&#62; any
acc   tcp  172.16.1.0/24        anywhere             any -&#62; www</PRE
></FONT
></TD
></TR
></TABLE
>

The <B
CLASS="COMMAND"
>ipfwadm</B
> command will attempt to translate the port
number into a service name using the <TT
CLASS="FILENAME"
>/etc/services</TT
> if
an entry exists there.</P
><P
>The default output is lacking in some important detail for us. In the
default listing output, we can't see the effect of the
<TT
CLASS="LITERAL"
>-y</TT
> argument.  The <B
CLASS="COMMAND"
>ipfwadm</B
> command
is able to produce a more detailed listing output if you specify the
<TT
CLASS="LITERAL"
>-e</TT
> (extended output) argument too. We won't show the
whole output here because it is too wide for the page, but it includes
an <TT
CLASS="LITERAL"
>opt</TT
> (options) column that shows the <CODE
CLASS="OPTION"
>-y</CODE
> option
controlling SYN packets:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipfwadm -F -l -e</KBD
>
P firewall forward rules, default policy: accept
 pkts bytes type  prot opt  tosa tosx ifname  ifaddress   source        ...   
    0     0 deny  tcp  --y- 0xFF 0x00 any     any         anywhere      ...       
    0     0 acc   tcp  b--- 0xFF 0x00 any     any         172.16.1.0/24 ...</PRE
></FONT
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-FIREWALL.COMPLEXEXAMPLE"
>9.6.2. A More Complex Example</A
></H3
><P
>The previous example was a simple one. Not all network services are as
simple as the WWW service to configure; in practice, a typical firewall
configuration would be much more complex. Let's look at another common
example, this time FTP. We want our internal network users to be able
to log into FTP servers on the Internet to read and write files. But we don't
want people on the Internet to be able to log into our FTP servers.</P
><P
>We know that FTP uses two TCP ports: port 20 (ftp-data) and port 21 (ftp),
so:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipfwadm -a deny -P tcp -S 0/0 20 -D 172.16.1.0/24 -y</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipfwadm -a accept -P tcp -S 172.16.1.0/24 -D 0/0 20 -b</KBD
>
#
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipfwadm -a deny -P tcp -S 0/0 21 -D 172.16.1.0/24 -y</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipfwadm -a accept -P tcp -S 172.16.1.0/24 -D 0/0 21 -b</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

Right? Well, not necessarily. FTP servers
can operate in two different modes: passive mode and active
mode.<A
NAME="X-087-2-FW-FN03"
HREF="#FTN.X-087-2-FW-FN03"
><SPAN
CLASS="footnote"
>[61]</SPAN
></A
>  In passive mode, the FTP server
listens for a connection from the client. In active mode, the server actually
makes the connection to the client. Active mode is usually the
default. The differences are illustrated in <A
HREF="#X-087-2-FIREWALL.FTP.GRAPHIC"
>Figure 9-3</A
>.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-FIREWALL.FTP.GRAPHIC"
></A
><P
><B
>Figure 9-3. FTP server modes</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_0903.jpg"></P
></DIV
></DIV
><P
>Many FTP servers make their data connection from port 20 when operating in
active mode, which simplifies things for us a little, but unfortunately not
all do.<A
NAME="X-087-2-FW-FN04"
HREF="#FTN.X-087-2-FW-FN04"
><SPAN
CLASS="footnote"
>[62]</SPAN
></A
></P
><P
>But how does this affect us? Take a look at our rule for port 20, the
FTP-data port. The rule as we have it now assumes that the connection
will be made by our client to the server. This will work if we
use passive mode. But it is very difficult for us to configure
a satisfactory rule to allow FTP active mode, because we may not know in
advance what ports will be used. If we open up our firewall to allow incoming
connections on any port, we are exposing our network to attack on all
services that accept connections.</P
><P
>The dilemna is most safely resolved by insisting that our users operate in
passive
mode. Most FTP servers and many FTP clients will operate this way.
The popular <B
CLASS="COMMAND"
>ncftp</B
> client also supports passive mode, but
it may require a small configuration change to make it default to passive
mode. Many
World Wide Web browsers such as the Netscape browser also support passive
mode FTP, so it shouldn't be too hard to find appropriate software to use.
Alternatively, you can avoid the issue entirely by using an FTP proxy
server that accepts a connection from the internal network and establishes
connections to the outside network.</P
><P
>In building your firewall, you will probably find a number of these
sorts of problems. You should always give careful thought to how a service
actually operates to be sure you have put in place an appropriate ruleset for
it. A real firewall configuration can be quite complex.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-FIREWALL.IPFWADMARGS"
>9.6.3. Summary of ipfwadm Arguments</A
></H3
><P
>&#13;The <B
CLASS="COMMAND"
>ipfwadm</B
> has many different arguments that relate to
IP firewall configuration. The general syntax is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>ipfwadm</B
> <TT
CLASS="REPLACEABLE"
><I
>category</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>command</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>parameters</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>[options]</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Let's take a look at each of these.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.IPFWADM.CATEGORIES"
>9.6.3.1. Categories</A
></H4
><P
>One and only one of the following must be supplied. The category tells the
firewall what sort of firewall rule you are configuring:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>-I</DT
><DD
><P
>Input rule</P
></DD
><DT
>-O</DT
><DD
><P
>Output rule</P
></DD
><DT
>-F</DT
><DD
><P
>Forwarding rule</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.IPFWADM.COMMAND"
>9.6.3.2. Commands</A
></H4
><P
>At least one of the following must be supplied and applies only to
those rules that relate to the supplied category. The command tells the
firewall what action to take.</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>-a [policy]</DT
><DD
><P
>Append a new rule</P
></DD
><DT
>-i [policy]</DT
><DD
><P
>Insert a new rule</P
></DD
><DT
>-d [policy]</DT
><DD
><P
>Delete an existing rule</P
></DD
><DT
>-p policy</DT
><DD
><P
>Set the default policy</P
></DD
><DT
>-l</DT
><DD
><P
>List all existing rules</P
></DD
><DT
>-f</DT
><DD
><P
>Flush all existing rules</P
></DD
></DL
></DIV
><P
>The policies relevant to IP firewall and their meanings are:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>accept</DT
><DD
><P
>Allows matching datagrams to be received, forwarded, or transmitted</P
></DD
><DT
>deny</DT
><DD
><P
>Blocks matching datagrams from being received, forwarded, or transmitted</P
></DD
><DT
>reject</DT
><DD
><P
>Blocks matching datagrams from being received, forwarded, or transmitted, and
sends the host that sent the datagram and ICMP error message</P
></DD
></DL
></DIV
>&#13;</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.IPFWADM.PARAMETERS"
>9.6.3.3. Parameters</A
></H4
><P
>At least one of the following must be supplied. Use the parameters
to specify to which datagrams this rule applies:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>-P protocol</DT
><DD
><P
>Can be TCP, UDP, ICMP, or all. Example:</P
><P
><TT
CLASS="LITERAL"
>-P tcp</TT
></P
></DD
><DT
>-S address[/mask] [port]</DT
><DD
><P
>Source IP address that this rule will match. A netmask of
&#8220;/32&#8221; will be assumed if you don't supply one. You may
optionally specify which ports this rule will apply to. You must also
specify the protocol using the <CODE
CLASS="OPTION"
>-P</CODE
> argument described
above for this to work. If you don't specify a port or port range,
&#8220;all&#8221; ports will be assumed to match. Ports may be
specified by name, using their <TT
CLASS="FILENAME"
>/etc/services</TT
> entry
if you wish. In the case of the ICMP protocol, the port field is used
to indicate the ICMP datagram types. Port ranges may be described; use
the general syntax:
<TT
CLASS="REPLACEABLE"
><I
>lowport</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>highport</I
></TT
>. Here is an example:</P
><P
><TT
CLASS="LITERAL"
>-S 172.29.16.1/24 ftp:ftp-data</TT
></P
></DD
><DT
>-D address[/mask] [port]</DT
><DD
><P
>Specify the destination IP address that this rule will match. The destination
address is coded with the same rules as the source address described previously. Here is an example:</P
><P
><TT
CLASS="LITERAL"
>-D 172.29.16.1/24 smtp</TT
></P
></DD
><DT
>-V address</DT
><DD
><P
>Specify the address of the network interface on which the packet is received
(<CODE
CLASS="OPTION"
>-I</CODE
>&#8201;) or is being sent (<CODE
CLASS="OPTION"
>-O</CODE
>). This
allows us to create rules that apply only to certain network interfaces on our
machine. Here is an example:</P
><P
><TT
CLASS="LITERAL"
>-V 172.29.16.1</TT
></P
></DD
><DT
>-W name</DT
><DD
><P
>Specify the name of the network interface. This argument works in the same way
as the <CODE
CLASS="OPTION"
>-V</CODE
> argument, except you supply the device name
instead of its address. Here is an example:</P
><P
><TT
CLASS="LITERAL"
>-W ppp0</TT
></P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.IPFWADM.OPTARGS"
>9.6.3.4. Optional arguments</A
></H4
><P
>These arguments are sometimes very useful:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>-b</DT
><DD
><P
>This is used for bidirectional mode. This flag matches traffic flowing
in either direction between the specified source and
destination. This saves you from having to create two rules: one for
the forward direction of a connection and one for the reverse.</P
></DD
><DT
>-o</DT
><DD
><P
>This enables logging of matching datagrams to the kernel log. Any
datagram that matches this rule will be logged as a kernel
message. This is useful to enable you to detect unauthorized access.</P
></DD
><DT
>-y</DT
><DD
><P
>This is used to match TCP connect datagrams. The option causes the
rule to match only datagrams that attempt to establish TCP
connections. Only datagrams that have their SYN bit set, but their ACK
bit unset, will match. This is useful to filter TCP connection
attempts and is ignored for other protocols.</P
></DD
><DT
>-k</DT
><DD
><P
>This is used to match TCP acknowledgement datagrams. This option
causes the rule to match only datagrams that are acknowledgements to
packets attempting to establish TCP connections.  Only datagrams that
have their ACK bit set will match. This is useful to filter TCP
connection attempts and is ignored for all other protocols.</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.IPFWADM.ICMP-TYPES"
>9.6.3.5. ICMP datagram types</A
></H4
><P
>&#13;

Each of the firewall configuration commands allows you to specify ICMP
datagram types. Unlike TCP and UDP ports, there is no convenient
configuration file that lists the datagram types and their
meanings. The ICMP datagram types are defined in
RFC-1700, the Assigned Numbers RFC. The ICMP datagram types are also
listed in one of the standard C library header files. The
<TT
CLASS="FILENAME"
>/usr/include/netinet/ip_icmp.h</TT
> file, which
belongs to the GNU standard library package and is used by C
programmers when writing network software that uses the ICMP protocol,
also defines the ICMP datagram types. For your convenience, we've
listed them in <A
HREF="#X-087-2-CHFW-ICMPTYPES"
>Table 9-2</A
>. The
<B
CLASS="COMMAND"
>iptables</B
> command interface allows you to specify
ICMP types by name, so we've listed the mnemonics it uses, as well.</P
><DIV
CLASS="TABLE"
><A
NAME="X-087-2-CHFW-ICMPTYPES"
></A
><P
><B
>Table 9-2. ICMP Datagram Types</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Type Number</TH
><TH
>iptables Mnemonic</TH
><TH
>Type Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
>0</TD
><TD
>echo-reply</TD
><TD
>Echo Reply</TD
></TR
><TR
><TD
>3</TD
><TD
>destination-unreachable</TD
><TD
>Destination Unreachable</TD
></TR
><TR
><TD
>4</TD
><TD
>source-quench</TD
><TD
>Source Quench</TD
></TR
><TR
><TD
>5</TD
><TD
>redirect</TD
><TD
>Redirect</TD
></TR
><TR
><TD
>8</TD
><TD
>echo-request</TD
><TD
>Echo Request</TD
></TR
><TR
><TD
>11</TD
><TD
>time-exceeded</TD
><TD
>Time Exceeded</TD
></TR
><TR
><TD
>12</TD
><TD
>parameter-problem</TD
><TD
>Parameter Problem</TD
></TR
><TR
><TD
>13</TD
><TD
>timestamp-request</TD
><TD
>Timestamp Request</TD
></TR
><TR
><TD
>14</TD
><TD
>timestamp-reply</TD
><TD
>Timestamp Reply</TD
></TR
><TR
><TD
>15</TD
><TD
>none</TD
><TD
>Information Request</TD
></TR
><TR
><TD
>16</TD
><TD
>none</TD
><TD
>Information Reply</TD
></TR
><TR
><TD
>17</TD
><TD
>address-mask-request</TD
><TD
>Address Mask Request</TD
></TR
><TR
><TD
>18</TD
><TD
>address-mask-reply</TD
><TD
>Address Mask Reply</TD
></TR
></TBODY
></TABLE
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-FIREWALL.FWCHAINS"
>9.7. IP Firewall Chains (2.2 Kernels)</A
></H2
><P
>Most aspects of Linux are evolving to meet the increasing demands of
its users; IP firewall is no exception. The traditional IP firewall
implementation is fine for most applications, but can be clumsy and inefficient
to configure for complex environments. To solve this problem, a new method of
configuring IP firewall and related features was developed. This new method was
called &#8220;IP Firewall Chains&#8221; and was first released for general use
in the 2.2.0 Linux kernel.</P
><P
>&#13;
The IP Firewall Chains support was developed by Paul
Russell and Michael Neuling.<A
NAME="X-087-2-FN05"
HREF="#FTN.X-087-2-FN05"
><SPAN
CLASS="footnote"
>[63]</SPAN
></A
>


Paul has documented the IP Firewall Chains software in the IPCHAINS-HOWTO.</P
><P
>IP Firewall Chains allows you to
develop classes of firewall rules to which you may then add and remove hosts
or networks. An artifact of firewall rule chaining is that it may
improve firewall performance in configurations in which there are lots of rules.</P
><P
>IP Firewall Chains are supported by the 2.2 series kernels and are also
available as a patch against the 2.0.* kernels. The HOWTO
describes where to obtain the patch and provides lots of useful hints about
how to effectively use the <B
CLASS="COMMAND"
>ipchains</B
> configuration utility.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-FIREWALL.USINGIPCHAINS"
>9.7.1. Using ipchains</A
></H3
><P
>&#13;
There are two ways you can use the <B
CLASS="COMMAND"
>ipchains</B
> utility. The
first way is to make use of the <B
CLASS="COMMAND"
>ipfwadm-wrapper</B
> shell
script, which is mostly a drop-in replacement for <B
CLASS="COMMAND"
>ipfwadm</B
>
that drives the <B
CLASS="COMMAND"
>ipchains</B
> program in the background. If you
want to do this, then read no further. Instead, reread the previous sections
describing <B
CLASS="COMMAND"
>ipfwadm</B
>, and substitute
<B
CLASS="COMMAND"
>ipfwadm-wrapper</B
> in its place. This will work, but there is
no guarantee that the script will be maintained, and you will not be taking
advantage of any of the advanced features that the IP Firewall Chains have to
offer.</P
><P
>The second way to use <B
CLASS="COMMAND"
>ipchains</B
> is to learn its new syntax
and modify any existing configurations you have to use the new syntax instead
of the old. With some careful consideration, you may find you can optimize your
configuration as you convert. The <B
CLASS="COMMAND"
>ipchains</B
> syntax is easier
to learn than the <B
CLASS="COMMAND"
>ipfwadm</B
>, so this is a good option.</P
><P
>The <B
CLASS="COMMAND"
>ipfwadm</B
> manipulated three rulesets for the purpose
of configuring firewalling. With IP Firewall Chains you can create arbitrary
numbers of rulesets, each linked to one another, but there are three rulesets
related to firewalling that are always present. The standard rulesets
are direct equivalents of those used with <B
CLASS="COMMAND"
>ipfwadm</B
>, except
they have names: <TT
CLASS="LITERAL"
>input</TT
>, <TT
CLASS="LITERAL"
>forward</TT
> and
<TT
CLASS="LITERAL"
>output</TT
>.</P
><P
>Let's first look at the general syntax of the <B
CLASS="COMMAND"
>ipchains</B
>
command, then we'll look at how we'd use <B
CLASS="COMMAND"
>ipchains</B
> instead
of <B
CLASS="COMMAND"
>ipfwadm</B
> without worrying about any of the advanced
chaining features. We'll do this by revisiting our previous examples.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-FIREWALL.IPCHAINS.SYNTAX"
>9.7.2. ipchains Command Syntax</A
></H3
><P
>&#13;The <B
CLASS="COMMAND"
>ipchains</B
> command syntax is straightforward. We'll now
look at the most important of those. The general syntax of most
<B
CLASS="COMMAND"
>ipchains</B
> commands is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>ipchains</B
> <TT
CLASS="REPLACEABLE"
><I
>command</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>rule-specification</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>options</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.IPCHAINS.COMMANDS"
>9.7.2.1. Commands</A
></H4
><P
>There are a number of ways we can manipulate rules and rulesets with the
<B
CLASS="COMMAND"
>ipchains</B
> command. Those relevant to IP firewalling are:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>-A chain</DT
><DD
><P
>Append one or more rules to the end of the nominated chain. If a hostname is
supplied as either source or destination and it resolves to more than one IP
address, a rule will be added for each address.</P
></DD
><DT
>-I chain rulenum</DT
><DD
><P
>Insert one or more rules to the start of the nominated chain. Again, if a
hostname is supplied in the rule specification, a rule will be added for each
of the addresses it resolves to.</P
></DD
><DT
>-D chain</DT
><DD
><P
>Delete one or more rules from the specified chain that matches the
rule specification.</P
></DD
><DT
>-D chain rulenum</DT
><DD
><P
>Delete the rule residing at position <TT
CLASS="REPLACEABLE"
><I
>rulenum</I
></TT
>
in the specified chain. Rule positions start at one for the first rule in the
chain.</P
></DD
><DT
>-R chain rulenum</DT
><DD
><P
>Replace the rule residing at position <TT
CLASS="REPLACEABLE"
><I
>rulenum</I
></TT
>
in the specific chain with the supplied rule specification.</P
></DD
><DT
>-C chain</DT
><DD
><P
>Check the datagram described by the rule specification against the specific
chain. This command will return a message describing how the datagram was
processed by the chain. This is very useful for testing your firewall
configuration, and we look at it in detail a little later.</P
></DD
><DT
>-L [chain]</DT
><DD
><P
>List the rules of the specified chain, or for all chains if no chain
is specified.</P
></DD
><DT
>-F [chain]</DT
><DD
><P
>Flush the rules of the specified chain, or for all chains if no chain is
 specified.</P
></DD
><DT
>-Z [chain]</DT
><DD
><P
>Zero the datagram and byte counters for all rules of the specified chain, or
for all chains if no chain is specified.</P
></DD
><DT
>-N chain</DT
><DD
><P
>Create a new chain with the specified name. A chain of the same name must not
 already exist. This is how user-defined chains are created.</P
></DD
><DT
>-X [chain]</DT
><DD
><P
>Delete the specified user-defined chain, or all user-defined chains if
no chain is specified. For this command to be successful, there must
be no references to the specified chain from any other rules chain.</P
></DD
><DT
>-P chain policy</DT
><DD
><P
>Set the default policy of the specified chain to the specified policy.
Valid firewalling policies are <TT
CLASS="LITERAL"
>ACCEPT</TT
>,
<TT
CLASS="LITERAL"
>DENY</TT
>, <TT
CLASS="LITERAL"
>REJECT</TT
>,
<TT
CLASS="LITERAL"
>REDIR</TT
>, or
<TT
CLASS="LITERAL"
>RETURN</TT
>. <TT
CLASS="LITERAL"
>ACCEPT</TT
>,
<TT
CLASS="LITERAL"
>DENY</TT
>, and <TT
CLASS="LITERAL"
>REJECT</TT
> have the same
meanings as those for the tradition IP firewall
implementation. <TT
CLASS="LITERAL"
>REDIR</TT
> specifies that the datagram
should be transparently redirected to a port on the firewall host. The
<TT
CLASS="LITERAL"
>RETURN</TT
> target causes the IP firewall code to return
to the Firewall Chain that called the one containing this rule and
continues starting at the rule after the calling rule.</P
></DD
></DL
></DIV
>&#13;</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.IPCHAINS.RULESPEC"
>9.7.2.2. Rule specification parameters</A
></H4
><P
>A number of <B
CLASS="COMMAND"
>ipchains</B
> parameters create a rule specification
by determining what types of packets match. If any of these parameters is
omitted from a rule specification, its default is assumed:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>-p [!]protocol</DT
><DD
><P
>Specifies the protocol of the datagram that will match this rule. Valid
protocol names are <TT
CLASS="LITERAL"
>tcp</TT
>, <TT
CLASS="LITERAL"
>udp</TT
>,
<TT
CLASS="LITERAL"
>icmp</TT
>, or <TT
CLASS="LITERAL"
>all</TT
>. You may also specify a
protocol number here to match other protocols. For example, you might use
<TT
CLASS="LITERAL"
>4</TT
> to match the <TT
CLASS="LITERAL"
>ipip</TT
> encapsulation
protocol. If the <TT
CLASS="LITERAL"
>!</TT
> is supplied, the rule is negated and
the datagram will match any protocol other than the protocol specified. If this
parameter isn't supplied, it will default to <TT
CLASS="LITERAL"
>all</TT
>.</P
></DD
><DT
>-s [!]address[/mask] [!] [port]</DT
><DD
><P
>Specifies the source address and port of the datagram that will match
this rule. The address may be supplied as a hostname, a network name,
or an IP address. The optional <TT
CLASS="LITERAL"
>mask</TT
> is the netmask
to use and may be supplied either in the traditional form (e.g.,
/255.255.255.0) or the modern form (e.g., /24). The optional
<TT
CLASS="LITERAL"
>port</TT
> specifies the TCP or UDP port, or the ICMP
datagram type that will match. You may supply a port specification
only if you've supplied the <CODE
CLASS="OPTION"
>-p</CODE
> parameter with one of
the <TT
CLASS="LITERAL"
>tcp</TT
>, <TT
CLASS="LITERAL"
>udp</TT
>, or
<TT
CLASS="LITERAL"
>icmp</TT
> protocols. Ports may be specified as a range
by specifying the upper and lower limits of the range with a colon as
a delimiter. For example, <TT
CLASS="LITERAL"
>20:25</TT
> described all of
the ports numbered from 20 up to and including 25. Again, the
<TT
CLASS="LITERAL"
>!</TT
> character may be used to negate the values.</P
></DD
><DT
>-d [!]address[/mask] [!] [port]</DT
><DD
><P
>Specifies the destination address and port of the datagram that will
match this rule. The coding of this parameter is the same as that of the
<CODE
CLASS="OPTION"
>-s</CODE
> parameter.</P
></DD
><DT
>-j target</DT
><DD
><P
>Specifies the action to take when this rule matches. You can think of
this parameter as meaning &#8220;jump to.&#8221; Valid targets are
<TT
CLASS="LITERAL"
>ACCEPT</TT
>, <TT
CLASS="LITERAL"
>DENY</TT
>, <TT
CLASS="LITERAL"
>REJECT</TT
>,
<TT
CLASS="LITERAL"
>REDIR</TT
>, and <TT
CLASS="LITERAL"
>RETURN</TT
>. We described the
meanings of each of these targets earlier. However, you may also specify the name of a
user-defined chain where processing will continue. If this parameter is
omitted, no action is taken on matching rule datagrams at all other than to
update the datagram and byte counters.</P
></DD
><DT
>-i [!]interface-name</DT
><DD
><P
>Specifies the interface on which the datagram was received or is to
be transmitted. Again, the <TT
CLASS="LITERAL"
>!</TT
> inverts the result of the
match. If the interface name ends with <TT
CLASS="LITERAL"
>+</TT
>,
then any interface that begins with the supplied string will match. For
example, <TT
CLASS="LITERAL"
>-i ppp+</TT
> would match any PPP network device and
<TT
CLASS="LITERAL"
>-i ! eth+</TT
> would match all interfaces except Ethernet
devices.</P
></DD
><DT
>[!] -f</DT
><DD
><P
>Specifies that this rule applies to everything but the first fragment
of a fragmented datagram.</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.IPCHAINS.OPTIONS"
>9.7.2.3. Options</A
></H4
><P
>The following <B
CLASS="COMMAND"
>ipchains</B
> options are more general in nature.
Some of them control rather esoteric features of the IP chains software:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>-b</DT
><DD
><P
>Causes the command to generate two rules. One rule matches the
parameters supplied, and the other rule added matches the corresponding
parameters in the reverse direction.</P
></DD
><DT
>-v</DT
><DD
><P
>Causes <B
CLASS="COMMAND"
>ipchains</B
> to be verbose in its output. It
will supply more information.</P
></DD
><DT
>-n</DT
><DD
><P
>Causes <B
CLASS="COMMAND"
>ipchains</B
> to display IP address and ports as
numbers without attempting to resolve them to their corresponding names.</P
></DD
><DT
>-l</DT
><DD
><P
>Enables kernel logging of matching datagrams. Any datagram that matches
the rule will be logged by the kernel using its <CODE
CLASS="FUNCTION"
>printk(&#8201;)</CODE
>
function, which is usually handled by the <B
CLASS="COMMAND"
>sysklogd</B
> program
and written to a log file. This is useful for making unusual datagrams visible.</P
></DD
><DT
>-o[maxsize]</DT
><DD
><P
>Causes the IP chains software to copy any datagrams matching the rule to
the userspace &#8220;netlink&#8221; device. The
maxsize argument limits the number of bytes from
each datagram that are passed to the netlink device. This option is of most
use to software developers, but may be exploited by software packages in the
future.</P
></DD
><DT
>-m markvalue</DT
><DD
><P
>Causes matching datagrams to be <EM
>marked</EM
> with a value. Mark
values are unsigned 32-bit numbers. In existing implementations this does
nothing, but at some point in the future, it may determine how the datagram is
handled by other software such as the routing code. If a
markvalue begins with a <TT
CLASS="LITERAL"
>+</TT
> or
<TT
CLASS="LITERAL"
>-</TT
>, the value is added or subtracted from the existing
markvalue.</P
></DD
><DT
>-t andmask xormask</DT
><DD
><P
>Enables you to manipulate the &#8220;type of service&#8221; bits in the
IP header of any datagram that matches this rule. The type of service bits are
used by intelligent routers to prioritize datagrams before forwarding them. The
Linux routing software is capable of this sort prioritization. The
<TT
CLASS="REPLACEABLE"
><I
>andmask</I
></TT
> and <TT
CLASS="REPLACEABLE"
><I
>xormask</I
></TT
>
represent bit masks that will be logically ANDed and ORed with the type of
service bits of the datagram respectively. This is an advanced feature that is
discussed in more detail in the IPCHAINS-HOWTO.</P
></DD
><DT
>-x</DT
><DD
><P
>Causes any numbers in the <B
CLASS="COMMAND"
>ipchains</B
> output to be
expanded to their exact values with no rounding.</P
></DD
><DT
>-y</DT
><DD
><P
>Causes the rule to match any TCP datagram with the SYN bit set and the
ACK and FIN bits clear. This is used to filter TCP connection requests.</P
></DD
></DL
></DIV
>&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-FIREWALL.SIMPLEEXAMPLE.AGAIN"
>9.7.3. Our Nave Example Revisited</A
></H3
><P
>Let's again suppose that we have a network in our organization and
that we are using a Linux-based firewall machine to allow our users
access to WWW servers on the Internet, but to allow no other traffic
to be passed.</P
><P
>If our network has a 24-bit network mask (class C) and has an address of
172.16.1.0, we'd use the following <B
CLASS="COMMAND"
>ipchains</B
> rules:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipchains -F forward</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipchains -P forward DENY</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipchains -A forward -s 0/0 80 -d 172.16.1.0/24 -p tcp -y -j DENY</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipchains -A forward -s 172.16.1.0/24 -d 0/0 80 -p tcp -b -j ACCEPT</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The first of the commands flushes all of the rules from the
<TT
CLASS="LITERAL"
>forward</TT
> rulesets and the second set of
commands sets the default policy of the <TT
CLASS="LITERAL"
>forward</TT
>
ruleset to <TT
CLASS="LITERAL"
>DENY</TT
>. Finally, the third
and fourth commands do the specific filtering we want. The fourth
command allows datagrams to and from web servers on the outside of our
network to pass, and the third prevents incoming TCP connections with
a source port of 80.</P
><P
>If we now wanted to add rules that allowed passive mode only access to FTP
servers in the outside network, we'd add these rules:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipchains -A forward -s 0/0 20 -d 172.16.1.0/24 -p tcp -y -j DENY</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipchains -A forward -s 172.16.1.0/24 -d 0/0 20 -p tcp -b -j ACCEPT</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipchains -A forward -s 0/0 21 -d 172.16.1.0/24 -p tcp -y -j DENY</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipchains -A forward -s 172.16.1.0/24 -d 0/0 21 -p tcp -b -j ACCEPT</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-FIREWALL.LISTING.AGAIN"
>9.7.4. Listing Our Rules with ipchains</A
></H3
><P
>&#13;To list our rules with <B
CLASS="COMMAND"
>ipchains</B
>, we use its
<CODE
CLASS="OPTION"
>-L</CODE
> argument. Just as with <B
CLASS="COMMAND"
>ipfwadm</B
>, there
are arguments that control the amount of detail in the output. In its simplest
form, <B
CLASS="COMMAND"
>ipchains</B
> produces output that looks like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>ipchains -L -n</KBD
>
Chain input (policy ACCEPT):
Chain forward (policy DENY):
target     prot opt     source              destination         ports
DENY       tcp  -y----  0.0.0.0/0           172.16.1.0/24       80 -&#62;   *
ACCEPT     tcp  ------  172.16.1.0/24       0.0.0.0/0           * -&#62;   80
ACCEPT     tcp  ------  0.0.0.0/0           172.16.1.0/24       80 -&#62;   *
ACCEPT     tcp  ------  172.16.1.0/24       0.0.0.0/0           * -&#62;   20
ACCEPT     tcp  ------  0.0.0.0/0           172.16.1.0/24       20 -&#62;   *
ACCEPT     tcp  ------  172.16.1.0/24       0.0.0.0/0           * -&#62;   21
ACCEPT     tcp  ------  0.0.0.0/0           172.16.1.0/24       21 -&#62;   *

Chain output (policy ACCEPT):</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>If you don't supply the name of a chain to list,
<B
CLASS="COMMAND"
>ipchains</B
> will list all rules in all chains. The
<TT
CLASS="LITERAL"
>-n</TT
> argument in our example tells
<B
CLASS="COMMAND"
>ipchains</B
> not to attempt to convert any address or
ports into names. The information presented should be
self-explanatory.</P
><P
>A verbose form, invoked by the <CODE
CLASS="OPTION"
>-u</CODE
> option, provides much more
detail. Its output adds fields for the datagram and byte counters,
Type of Service <EM
>AND</EM
> and <EM
>XOR</EM
> flags, the interface name, the mark, and
the outsize.</P
><P
>All rules created with <B
CLASS="COMMAND"
>ipchains</B
> have datagram and
byte counters associated with them. This is how IP Accounting is
implemented and will be discussed in detail in <A
HREF="#X-087-2-ACCOUNTING"
>Chapter 10</A
>. By default these counters are presented
in a rounded form using the suffixes <TT
CLASS="LITERAL"
>K</TT
> and
<TT
CLASS="LITERAL"
>M</TT
> to represent units of one thousand and one
million, respectively. If the <TT
CLASS="LITERAL"
>-x</TT
> argument is
supplied, the counters are expanded to their full unrounded form.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-FIREWALL.IPCHAINSYAY"
>9.7.5. Making Good Use of Chains</A
></H3
><P
>You now know that the <B
CLASS="COMMAND"
>ipchains</B
> command is a
replacement for the <B
CLASS="COMMAND"
>ipfwadm</B
> with a simpler
command-line syntax and some interesting enhancements, but you're no
doubt wanting to know where you'd use the user-defined chains and
why. You'll also probably want to know how to use the support scripts
that accompany the <B
CLASS="COMMAND"
>ipchains</B
> command in its software
package. We'll now explore these subjects and address the questions.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN8456"
>9.7.5.1. User-defined chains</A
></H4
><P
>&#13;
The three rulesets of the traditional IP firewall code provided a
mechanism for building firewall configurations that were fairly simple
to understand and manage for small networks with simple firewalling
requirements. When the configuration requirements are not simple, a
number of problems become apparent.  Firstly, large networks often
require much more than the small number of firewalling rules we've
seen so far; inevitably needs arise that require firewalling rules
added to cover special case scenarios. As the number of rules grows,
the performance of the firewall deterioriates as more and more tests
are conducted on each datagram and managability becomes an
issue. Secondly, it is not possible to enable and disable sets of
rules atomically; instead, you are forced to expose yourself to attack
while you are in the middle of rebuilding your ruleset.</P
><P
>The design of IP Firewall Chains helps to alleviate these problems by
allowing the network administrator to create arbitrary sets of
firwewall rules that we can link to the three inbuilt rulesets. We can
use the <CODE
CLASS="OPTION"
>-N</CODE
> option of <B
CLASS="COMMAND"
>ipchains</B
> to
create a new chain with any name we please of eight characters or
less. (Restricting the name to lowercase letters only is probably a
good idea.) The <CODE
CLASS="OPTION"
>-j</CODE
> option configures the action to
take when a datagram matches the rule specification. The <CODE
CLASS="OPTION"
>-j</CODE
> option
specifies that if a datagram matches a rule, further testing should be
performed against a user-defined chain. We'll illustrate this with a
diagram.</P
><P
>Consider the following <B
CLASS="COMMAND"
>ipchains</B
> commands:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ipchains -P input DENY
ipchains -N tcpin
ipchains -A tcpin -s ! 172.16.0.0/16
ipchains -A tcpin -p tcp -d 172.16.0.0/16 ssh -j ACCEPT
ipchains -A tcpin -p tcp -d 172.16.0.0/16 www -j ACCEPT
ipchains -A input -p tcp -j tcpin
ipchains -A input -p all</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>We set the default input chain policy to <TT
CLASS="LITERAL"
>deny</TT
>. The
second command creates a user-defined chain called
&#8220;tcpin.&#8221; The third command adds a rule to the
<TT
CLASS="LITERAL"
>tcpin</TT
> chain that matches any datagram that was
sourced from outside our local network; the rule takes no action. This
rule is an accounting rule and will be discussed in more detail in
<A
HREF="#X-087-2-ACCOUNTING"
>Chapter 10</A
>. The next two rules match any
datagram that is destined for our local network and either of the
<TT
CLASS="LITERAL"
>ssh</TT
> or <TT
CLASS="LITERAL"
>www</TT
> ports; datagrams
matching these rules are accepted. The next rule is when the real
<EM
>ipchains</EM
> magic begins. It causes the firewall
software to check any datagram of protocol TCP against the
tcpin user-defined chain.  Lastly, we add a rule to our
<TT
CLASS="LITERAL"
>input</TT
> chain that matches any datagram; this is
another accounting rule. They will produce the following Firewall Chains shown in Figure 9-4.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-FIREWALL.IPCHAINS"
></A
><P
><B
>Figure 9-4. A simple IP chain ruleset</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_0904.jpg"></P
></DIV
></DIV
><P
>Our <TT
CLASS="LITERAL"
>input</TT
> and <TT
CLASS="LITERAL"
>tcpin</TT
> chains are populated
with our rules. Datagram processing always beings at one of the inbuilt chains.
We'll see how our user-defined chain is called into play by following the
processing path of different types of datagrams.</P
><P
>First, let's look at what happens when a UDP datagram for one of our hosts
is received. <A
HREF="#X-087-2-FIREWALL.IPCHAINS.UDP"
>Figure 9-5</A
> illustrates the 
flow through the rules.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-FIREWALL.IPCHAINS.UDP"
></A
><P
><B
>Figure 9-5. The sequence of rules tested for a received UDP datagram</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_0905.jpg"></P
></DIV
></DIV
><P
>The datagram is received by the <TT
CLASS="LITERAL"
>input</TT
> chain and
falls through the first two rules because they match ICMP and TCP
protocols, respectively. It matches the third rule in the
<TT
CLASS="LITERAL"
>input</TT
> chain, but it doesn't specify a target, so
its datagram and byte counters are updated, but no other action takes
place. The datagram reaches the end of the <TT
CLASS="LITERAL"
>input</TT
>
chain, meets with the default <TT
CLASS="LITERAL"
>input</TT
> chain policy,
and is denied.</P
><P
>To see our user-defined chain in operation, let's now consider what
happens when we receive a TCP datagram destined for the
<TT
CLASS="LITERAL"
>ssh</TT
> port of one of our hosts. The sequence is shown
in <A
HREF="#X-087-2-FIREWALL.IPCHAINS.TCP.SSH"
>Figure 9-6</A
>.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-FIREWALL.IPCHAINS.TCP.SSH"
></A
><P
><B
>Figure 9-6. The rules flow for a received TCP datagram for ssh</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_0906.jpg"></P
></DIV
></DIV
><P
>This time the second rule in the <TT
CLASS="LITERAL"
>input</TT
> chain does
match and it specifies a target of <TT
CLASS="LITERAL"
>tcpin</TT
>, our
user-defined chain.  Specifying a user-defined chain as a target
causes the datagram to be tested against the rules in that chain, so
the next rule tested is the first rule in the <TT
CLASS="LITERAL"
>tcpin</TT
>
chain. The first rule matches any datagram that has a source address
outside our local network and specifies no target, so it too is an
accounting rule and testing falls through to the next rule. The second
rule in our <TT
CLASS="LITERAL"
>tcpin</TT
> chain does match and specifies a
target of <TT
CLASS="LITERAL"
>ACCEPT</TT
>. We have arrived at target, so no
further firewall processing occurs. The datagram is accepted.</P
><P
>Finally, let's look at what happens when we reach the end of a
user-defined chain. To see this, we'll map the flow for a TCP datagram
destined for a port other than the two we are handling
specifically, as shown in <A
HREF="#X-087-2-FIREWALL.IPCHAINS.TCP.OTHER"
>Figure 9-7</A
>.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-FIREWALL.IPCHAINS.TCP.OTHER"
></A
><P
><B
>Figure 9-7. The rules flow for a received TCP datagram for telnet</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_0907.jpg"></P
></DIV
></DIV
><P
>The user-defined chains do not have default policies. When all rules
in a user-defined chain have been tested, and none have matched, the
firewall code acts as though a <TT
CLASS="LITERAL"
>RETURN</TT
> rule were
present, so if this isn't what you want, you should ensure you supply
a rule at the end of the user-defined chain that takes whatever action
you wish. In our example, our testing returns to the rule in the
<TT
CLASS="LITERAL"
>input</TT
> ruleset immediately following the one that
moved us to our user-defined chain. Eventually we reach the end of the
<TT
CLASS="LITERAL"
>input</TT
> chain, which does have a default policy and
our datagram is denied.</P
><P
>This example is very simple, but illustrates our point. A more practical use of
IP chains would be much more complex. A slightly more sophisticated example is
provided in the following list of commands:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>#
# Set default forwarding policy to REJECT
ipchains -P forward REJECT
#
# create our user-defined chains
ipchains -N sshin
ipchains -N sshout
ipchains -N wwwin
ipchains -N wwwout
#
# Ensure we reject connections coming the wrong way
ipchains -A wwwin -p tcp -s 172.16.0.0/16 -y -j REJECT
ipchains -A wwwout -p tcp -d 172.16.0.0/16 -y -j REJECT
ipchains -A sshin -p tcp -s 172.16.0.0/16 -y -j REJECT
ipchains -A sshout -p tcp -d 172.16.0.0/16 -y -j REJECT
#
# Ensure that anything reaching the end of a user-defined chain is rejected.
ipchains -A sshin -j REJECT
ipchains -A sshout -j REJECT
ipchains -A wwwin -j REJECT
ipchains -A wwwout -j REJECT
#
# divert www and ssh services to the relevant user-defined chain
ipchains -A forward -p tcp -d 172.16.0.0/16 ssh -b -j sshin
ipchains -A forward -p tcp -s 172.16.0.0/16 -d 0/0 ssh -b -j sshout
ipchains -A forward -p tcp -d 172.16.0.0/16 www -b -j wwwin
ipchains -A forward -p tcp -s 172.16.0.0/16 -d 0/0 www -b -j wwwout
#
# Insert our rules to match hosts at position two in our user-defined chains.
ipchains -I wwwin 2 -d 172.16.1.2 -b -j ACCEPT
ipchains -I wwwout 2 -s 172.16.1.0/24 -b -j ACCEPT
ipchains -I sshin 2 -d 172.16.1.4 -b -j ACCEPT 
ipchains -I sshout 2 -s 172.16.1.4 -b -j ACCEPT
ipchains -I sshout 2 -s 172.16.1.6 -b -j ACCEPT
#</PRE
></FONT
></TD
></TR
></TABLE
><P
>In this example, we've used a selection of user-defined chains both to
simplify management of our firewall configuration and improve the
efficiency of our firewall as compared to a solution involving only the
built-in chains.</P
><P
>Our example creates user-defined chains for each of the
<TT
CLASS="LITERAL"
>ssh</TT
> and <TT
CLASS="LITERAL"
>www</TT
> services in each
connection direction. The chain called <TT
CLASS="LITERAL"
>wwwout</TT
> is
where we place rules for hosts that are allowed to make outgoing World
Wide Web connections, and <TT
CLASS="LITERAL"
>sshin</TT
> is where we define
rules for hosts to which we want to allow incoming ssh
connections. We've assumed that we have a requirement to allow and
deny individual hosts on our network the ability to make or receive
<TT
CLASS="LITERAL"
>ssh</TT
> and <TT
CLASS="LITERAL"
>www</TT
> connections. The
simplication occurs because the user-defined chains allow us to neatly
group the rules for the host incoming and outgoing permissions rather
than muddling them all together. The improvement in efficiency occurs
because for any particular datagram, we have reduced the average number
of tests required before a target is found. The efficiency gain
increases as we add more hosts. If we hadn't used user-defined chains,
we'd potentially have to search the whole list of rules to determine
what action to take with each and every datagram received.  Even if we
assume that each of the rules in our list matches an equal proportion
of the total number of datagrams processed, we'd still be searching
half the list on average. User-defined chains allow us to avoid
testing large numbers of rules if the datagram being tested doesn't
match the simple rule in the built-in chain that jumps to them.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN8546"
>9.7.5.2. The ipchains support scripts</A
></H4
><P
>&#13;The <B
CLASS="COMMAND"
>ipchains</B
> software package is supplied with
three support scripts. The first of these we've discussed briefly
already, while the remaining two provide an easy and convenient means
of saving and restoring your firewall configuration.</P
><P
>&#13;The <B
CLASS="COMMAND"
>ipfwadm-wrapper</B
> script emulates the
command-line syntax of the <B
CLASS="COMMAND"
>ipfwadm</B
> command, but
drives the <B
CLASS="COMMAND"
>ipchains</B
> command to build the firewall
rules. This is a convenient way to migrate your existing firewall
configuration to the kernel or an alternative to learning the
<B
CLASS="COMMAND"
>ipchains</B
> syntax. The
<B
CLASS="COMMAND"
>ipfwadm-wrapper</B
> script behaves differently from the
<B
CLASS="COMMAND"
>ipfwadm</B
> command in two ways: firstly, because the
<B
CLASS="COMMAND"
>ipchains</B
> command doesn't support specification of
an interface by address, the <B
CLASS="COMMAND"
>ipfwadm-wrapper</B
> script
accepts an argument of <CODE
CLASS="OPTION"
>-V</CODE
> but attempts to convert it
into the <B
CLASS="COMMAND"
>ipchains</B
> equivalent of a
<CODE
CLASS="OPTION"
>-W</CODE
> by searching for the interface name configured
with the supplied address. The <B
CLASS="COMMAND"
>ipfwadm-wrapper</B
>
script will always provide a warning when you use the
<CODE
CLASS="OPTION"
>-V</CODE
> option to remind you of this. Secondly, fragment
accounting rules are not translated correctly.</P
><P
>&#13;

The <B
CLASS="COMMAND"
>ipchains-save</B
> and <B
CLASS="COMMAND"
>ipchains-restore</B
>
scripts make building and modifying a firewall configuration much simpler.
The <B
CLASS="COMMAND"
>ipchains-save</B
> command reads the current firewall
configuration and writes a simplified form to the standard output. The
<B
CLASS="COMMAND"
>ipchains-restore</B
> command reads data in the output format
of the <B
CLASS="COMMAND"
>ipchains-save</B
> command and configures the IP firewall
with these rules. The advantage of using these scripts over directly modifying
your firewall configuration script and testing the configuration is the ability
to dynamically build your configuration once and then save it. You can then
restore that configuration, modify it, and resave it as you please.</P
><P
>To use the scripts, you'd enter something like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
><B
CLASS="COMMAND"
>ipchains-save</B
> &#62;/var/state/ipchains/firewall.state</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

to save your current firewall configuration. You'd restore it, perhaps at
boot time, with:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
><B
CLASS="COMMAND"
>ipchains-restore</B
> &#60;/var/state/ipchains/firewall.state</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <B
CLASS="COMMAND"
>ipchains-restore</B
> script checks if any user-defined
chain listed in its input already exists. If you've supplied the
<TT
CLASS="LITERAL"
>-f</TT
> argument, it will automatically flush the rules from
the user-defined chain before configuring those in the input. The default
behavior asks you whether to skip this chain or to flush it.</P
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-FIREWALL.FUTURE"
>9.8. Netfilter and IP Tables (2.4 Kernels)</A
></H2
><P
>While developing IP Firewall Chains, Paul Russell decided that IP firewalling
should be less difficult; he soon set about the task of simplifying aspects of
datagram processing in the kernel firewalling code and produced a filtering
framework that was both much cleaner and much more flexible. He called
this new framework <EM
>netfilter</EM
>.</P
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.png"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>At the time of preparation of this book the
<EM
>netfilter</EM
> design had not yet stabilized. We hope
you'll forgive any errors in the description of
<EM
>netfilter</EM
> or its associated configuration tools
that result from changes that occurred after preparation of this
material. We considered the <EM
>netfilter</EM
> work
important enough to justify the inclusion of this material, despite
parts of it being speculative in nature. If you're in any doubt, the
relevant HOWTO documents will contain the most accurate and up-to-date
information on the detailed issues associated with the
<EM
>netfilter</EM
> configuration.</P
></TD
></TR
></TABLE
></DIV
><P
>So what was wrong with IP chains? They vastly improved the efficiency
and management of firewall rules. But the way they processed datagrams
was still complex, especially in conjunction with firewall-related
features like IP masquerade (discussed in <A
HREF="#X-087-2-IPMASQ"
>Chapter 11</A
>) and other forms of address
translation. Part of this complexity existed because IP masquerade and
Network Address Translation were developed independently of the IP
firewalling code and integrated later, rather than having been
designed as a true part of the firewall code from the start. If a
developer wanted to add yet more features in the datagram processing
sequence, he would have had difficulty finding a place to insert the
code and would have been forced to make changes in the kernel in order
to do so.</P
><P
>Still, there were other problems. In particular, the
&#8220;input&#8221; chain described input to the IP networking layer
as a whole. The input chain affected both datagrams to be
<EM
>destined for</EM
> this host and datagrams to be
<EM
>routed by</EM
> this host. This was somewhat
counterintuitive because it confused the function of the input chain
with that of the forward chain, which applied only to datagrams to be
forwarded, but which always followed the input chain. If you wanted to
treat datagrams for this host differently from datagrams to be
forwarded, it was necessary to build complex rules that excluded one
or the other. The same problem applied to the output chain.</P
><P
>Inevitably some of this complexity spilled over into the system
administrator's job because it was reflected in the way that rulesets
had to be designed.  Moreover, any extensions to filtering required
direct modifications to the kernel, because all filtering policies
were implemented there and there was no way of providing a transparent
interface into it. <EM
>netfilter</EM
> addresses both the
complexity and the rigidity of older solutions by implementing a
generic framework in the kernel that streamlines the way datagrams are
processed and provides a capability to extend filtering policy without
having to modify the kernel.</P
><P
>&#13;Let's take a look at two of the key changes made.  <A
HREF="#X-087-2-FIREWALL.ROUTING.IPCHAINS"
>Figure 9-8</A
> illustrates how datagrams
are processed in the IP chains implementation, while <A
HREF="#X-087-2-FIREWALL.ROUTING.NETFILTER"
>Figure 9-9</A
> illustrates how they are
processed in the <EM
>netfilter</EM
> implementation. The
key differences are the removal of the masquerading function from the
core code and a change in the locations of the input and output
chains. To accompany these changes, a new and extensible configuration
tool called <B
CLASS="COMMAND"
>iptables</B
> was created.</P
><P
>In IP chains, the input chain applies to all datagrams received by the
host, irrespective of whether they are destined for the local host or routed to some other host. In <EM
>netfilter</EM
>,
the input chain applies <EM
>only</EM
> to datagrams
destined for the local host, and the forward chain applies only to
datagrams destined for <EM
>another</EM
> host. Similarly,
in IP chains, the output chain applies to all datagrams leaving the
local host, irrespective of whether the datagram is generated on the
local host or routed from some other host. In
<EM
>netfilter</EM
>, the output chain applies
<EM
>only</EM
> to datagrams generated on this host and does
not apply to datagrams being routed from another host. This change
alone offers a huge simplification of many firewall configurations.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-FIREWALL.ROUTING.IPCHAINS"
></A
><P
><B
>Figure 9-8. Datagram processing chain in IP chains</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_0908.jpg"></P
></DIV
></DIV
><P
>In <A
HREF="#X-087-2-FIREWALL.ROUTING.IPCHAINS"
>Figure 9-8</A
>, the components
labeled &#8220;demasq&#8221; and &#8220;masq&#8221; are separate
kernel components responsible for the incoming and outgoing processing
of masqueraded datagrams.  These have been reimplemented as
<EM
>netfilter</EM
> modules.</P
><P
>Consider the case of a configuration for which the default policy for each
of the input, forward, and output chains is
<TT
CLASS="LITERAL"
>deny</TT
>. In IP chains, six rules would
be needed to allow any session through a firewall host: two each in
the input, forward, and output chains (one would cover each forward
path and one would cover each return path). You can imagine how this
could easily become extremely complex and difficult to manage when you
want to mix sessions that could be routed and sessions that could
connect to the local host without being routed. IP chains allow
you to create chains that would simplify this task a little, but the
design isn't obvious and requires a certain level of expertise.</P
><P
>In the <EM
>netfilter</EM
> implementation with
<B
CLASS="COMMAND"
>iptables</B
>, this complexity disappears
completely. For a service to be routed across the firewall host, but
not terminate on the local host, only two rules are required: one
each for the forward and the reverse directions in the forward
chain. This is the obvious way to design firewalling rules, and will
serve to simplify the design of firewall configurations immensely.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-FIREWALL.ROUTING.NETFILTER"
></A
><P
><B
>Figure 9-9. Datagram processing chain in netfilter</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_0909.jpg"></P
></DIV
></DIV
><P
>&#13;
The PACKET-FILTERING-HOWTO offers a detailed list of the
changes that have been made, so let's focus on the more practical
aspects here.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN8665"
>9.8.1. Backward Compatability with ipfwadmand ipchains</A
></H3
><P
>The remarkable flexibility of Linux <EM
>netfilter</EM
> is
illustrated by its ability to emulate the <B
CLASS="COMMAND"
>ipfwadm</B
> and
<B
CLASS="COMMAND"
>ipchains</B
> interfaces. Emulation makes transition to the new
generation of firewall software a little easier.</P
><P
>&#13;The two <EM
>netfilter</EM
> kernel modules called
<TT
CLASS="FILENAME"
>ipfwadm.o</TT
> and <TT
CLASS="FILENAME"
>ipchains.o</TT
>
provide backward compatibility for <B
CLASS="COMMAND"
>ipfwadm</B
> and
<B
CLASS="COMMAND"
>ipchains</B
>. You may load only one of these modules at
a time, and use one only if the <TT
CLASS="FILENAME"
>ip_tables.o</TT
>
module is not loaded.  When the appropriate module is loaded,
<EM
>netfilter</EM
> works exactly like the former
firewall implementation.</P
><P
><EM
>netfilter</EM
> mimics the
<B
CLASS="COMMAND"
>ipchains</B
> interface with the following commands:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>rmmod ip_tables
modprobe ipchains
ipchains <TT
CLASS="REPLACEABLE"
><I
>...</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-FIREWALL.USINGIPTABLES"
>9.8.2. Using iptables</A
></H3
><P
>&#13;The <B
CLASS="COMMAND"
>iptables</B
> utility is used to configure
<EM
>netfilter</EM
> filtering rules. Its syntax borrows
heavily from the <B
CLASS="COMMAND"
>ipchains</B
> command, but differs in
one very significant respect: it is
<EM
>extensible</EM
>. What this means is that its
functionality can be extended without recompiling it. It manages this
trick by using shared libraries. There are standard extensions
and we'll explore some of them in a moment.</P
><P
>Before you can use the <B
CLASS="COMMAND"
>iptables</B
> command, you must
load the <EM
>netfilter</EM
> kernel module that provides
support for it. The easiest way to do this is to use the
<B
CLASS="COMMAND"
>modprobe</B
> command as follows:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>modprobe ip_tables</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <B
CLASS="COMMAND"
>iptables</B
> command is used to configure both IP
filtering and Network Address Translation. To facilitate this, there are two
tables of rules called <EM
>filter</EM
> and
<EM
>nat</EM
>. The filter table is assumed if you do not
specify the <CODE
CLASS="OPTION"
>-t</CODE
> option to override
it. Five built-in chains are also provided. The
<TT
CLASS="LITERAL"
>INPUT</TT
> and <TT
CLASS="LITERAL"
>FORWARD</TT
> chains are
available for the <TT
CLASS="LITERAL"
>filter</TT
> table, the
<TT
CLASS="LITERAL"
>PREROUTING</TT
> and <TT
CLASS="LITERAL"
>POSTROUTING</TT
>
chains are available for the <TT
CLASS="LITERAL"
>nat</TT
> table, and the
<TT
CLASS="LITERAL"
>OUTPUT</TT
> chain is available for both tables.  In this
chapter we'll discuss only the <EM
>filter</EM
> table. We'll look 
at the <EM
>nat</EM
> table in <A
HREF="#X-087-2-IPMASQ"
>Chapter 11</A
></P
><P
>The general syntax of most <B
CLASS="COMMAND"
>iptables</B
> commands is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>iptables</B
> <TT
CLASS="REPLACEABLE"
><I
>command</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>rule-specification</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>extensions</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
>

Now we'll take a look at some options in detail, after which we'll review
some examples.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.IPTABLES.COMMANDS"
>9.8.2.1. Commands</A
></H4
><P
>There are a number of ways we can manipulate rules and rulesets with the
<B
CLASS="COMMAND"
>iptables</B
> command. Those relevant to IP firewalling are:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>-A chain</DT
><DD
><P
>Append one or more rules to the end of the nominated chain. If a hostname is
supplied as either a source or destination and it resolves to more than one IP
address, a rule will be added for each address.</P
></DD
><DT
>-I chain rulenum</DT
><DD
><P
>Insert one or more rules to the start of the nominated chain. Again, if a
hostname is supplied in the rule specification, a rule will be added for each
of the addresses to which it resolves.</P
></DD
><DT
>-D chain</DT
><DD
><P
>Delete one or more rules from the specified chain matching the rule
specification.</P
></DD
><DT
>-D chain rulenum</DT
><DD
><P
>Delete the rule residing at position <TT
CLASS="REPLACEABLE"
><I
>rulenum</I
></TT
> in the
specified chain. Rule positions start at 1 for the first rule in the chain.</P
></DD
><DT
>-R chain rulenum</DT
><DD
><P
>Replace the rule residing at position <TT
CLASS="REPLACEABLE"
><I
>rulenum</I
></TT
>
in the specific chain with the supplied rule specification.</P
></DD
><DT
>-C chain</DT
><DD
><P
>Check the datagram described by the rule specification against the specific
chain. This command will return a message describing how the chain processed the datagram. This is very useful for testing your firewall
configuration and we will look at it in detail later.</P
></DD
><DT
>-L [chain]</DT
><DD
><P
>List the rules of the specified chain, or for all chains if no chain is
specified.</P
></DD
><DT
>-F [chain]</DT
><DD
><P
>Flush the rules of the specified chain, or for all chains if no chain is
 specified.</P
></DD
><DT
>-Z [chain]</DT
><DD
><P
>Zero the datagram and byte counters for all rules of the specified chain, or
for all chains if no chain is specified.</P
></DD
><DT
>-N chain</DT
><DD
><P
>Create a new chain with the specified name. A chain of the same name must not
 already exist. This is how user-defined chains are created.</P
></DD
><DT
>-X [chain]</DT
><DD
><P
>Delete the specified user-defined chain, or all user-defined chains if no chain
is specified. For this command to be successful, there must be no references
to the specified chain from any other rules chain.</P
></DD
><DT
>-P chain policy</DT
><DD
><P
>Set the default policy of the specified chain to the specified policy. Valid
firewalling policies are <TT
CLASS="LITERAL"
>ACCEPT</TT
>, <TT
CLASS="LITERAL"
>DROP</TT
>,
<TT
CLASS="LITERAL"
>QUEUE</TT
>, and <TT
CLASS="LITERAL"
>RETURN</TT
>.
<TT
CLASS="LITERAL"
>ACCEPT</TT
> allows the datagram to pass. <TT
CLASS="LITERAL"
>DROP</TT
>
causes the datagram to be discarded. <TT
CLASS="LITERAL"
>QUEUE</TT
> causes the
datagram to be passed to userspace for further processing. The
<TT
CLASS="LITERAL"
>RETURN</TT
> target causes the IP firewall code to return to the
Firewall Chain that called the one containing this rule, and continue starting
at the rule after the calling rule.</P
></DD
></DL
></DIV
>&#13;</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.IPTABLES.RULESPEC"
>9.8.2.2. Rule specification parameters</A
></H4
><P
>There are a number of <B
CLASS="COMMAND"
>iptables</B
> parameters that constitute
a rule specification. Wherever a rule specification is required, each of these
parameters must be supplied or their default will be assumed.</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>-p [!]protocol</DT
><DD
><P
>Specifies the protocol of the datagram that will match this rule. Valid
protocol names are <TT
CLASS="LITERAL"
>tcp</TT
>, <TT
CLASS="LITERAL"
>udp</TT
>,
<TT
CLASS="LITERAL"
>icmp</TT
>, or a number, if you know the IP protocol
number.<A
NAME="X-087-2-X-087-2-FW-FN06"
HREF="#FTN.X-087-2-X-087-2-FW-FN06"
><SPAN
CLASS="footnote"
>[64]</SPAN
></A
>
For example, you might use <TT
CLASS="LITERAL"
>4</TT
> to match the
<TT
CLASS="LITERAL"
>ipip</TT
> encapsulation protocol. If the <TT
CLASS="LITERAL"
>!</TT
>
character is supplied, the rule is negated and the datagram will match any
protocol other than the specified protocol. If this parameter isn't supplied, it
will default to match all protocols.</P
></DD
><DT
>-s [!]address[/mask]</DT
><DD
><P
>Specifies the source address of the datagram that will match this rule. The
address may be supplied as a hostname, a network name, or an IP address. The
optional <TT
CLASS="LITERAL"
>mask</TT
> is the netmask to use and may be supplied
either in the traditional form (e.g., /255.255.255.0) or in the modern form
(e.g., /24).</P
></DD
><DT
>-d [!]address[/mask]</DT
><DD
><P
>Specifies the destination address and port of the datagram that will
match this rule. The coding of this parameter is the same as that of the
<CODE
CLASS="OPTION"
>-s</CODE
> parameter.</P
></DD
><DT
>-j target</DT
><DD
><P
>Specifies what action to take when this rule matches. You can think of
this parameter as meaning &#8220;jump to.&#8221; Valid targets are
<TT
CLASS="LITERAL"
>ACCEPT</TT
>, <TT
CLASS="LITERAL"
>DROP</TT
>, <TT
CLASS="LITERAL"
>QUEUE</TT
>,
and <TT
CLASS="LITERAL"
>RETURN</TT
>. We described the meanings of each of these previously in the "Commands" section. You may also specify the name of a user-defined chain where
processing will continue. You may also supply the name of a target supplied
by an extension. We'll talk about extensions shortly. If this parameter is
omitted, no action is taken on matching datagrams at all, other than to
update the datagram and byte counters of this rule.</P
></DD
><DT
>-i [!]interface-name</DT
><DD
><P
>Specifies the interface on which the datagram was received. Again, the
<TT
CLASS="LITERAL"
>!</TT
> inverts the result of the match. If the interface name
ends with &#8220;<TT
CLASS="LITERAL"
>+</TT
>&#8221; then any interface that begins
with the supplied string will match. For example, <TT
CLASS="LITERAL"
>-i ppp+</TT
>
would match any PPP network device and <TT
CLASS="LITERAL"
>-i ! eth+</TT
> would
match all interfaces except ethernet devices.</P
></DD
><DT
>-o [!]interface-name</DT
><DD
><P
>Specifies the interface on which the datagram is to be transmitted. This
argument has the same coding as the <CODE
CLASS="OPTION"
>-i</CODE
> argument.</P
></DD
><DT
>[!] -f</DT
><DD
><P
>Specifies that this rule applies only to the second and later fragments
of a fragmented datagram, not to the first fragment.</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.IPTABLES.OPTIONS"
>9.8.2.3. Options</A
></H4
><P
>The following <B
CLASS="COMMAND"
>iptables</B
> options are more general in nature.
Some of them control rather esoteric features of the
<EM
>netfilter</EM
> software.</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>-v</DT
><DD
><P
>causes <B
CLASS="COMMAND"
>iptables</B
> to be verbose in its output; it
will supply more information.</P
></DD
><DT
>-n</DT
><DD
><P
>causes <B
CLASS="COMMAND"
>iptables</B
> to display IP address and ports as
numbers without attempting to resolve them to their corresponding names.</P
></DD
><DT
>-x</DT
><DD
><P
>causes any numbers in the <B
CLASS="COMMAND"
>iptables</B
> output to be
expanded to their exact values with no rounding.</P
></DD
><DT
>- -line-numbers</DT
><DD
><P
>causes line numbers to be displayed when listing rulesets. The line number
will correspond to the rule's position within the chain.</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FIREWALL.IPTABLES.EXTENSIONS"
>9.8.2.4. Extensions</A
></H4
><P
>&#13;We said earlier that the <B
CLASS="COMMAND"
>iptables</B
> utility is
extensible through optional shared library modules. There are some standard
extensions that provide some of the features <B
CLASS="COMMAND"
>ipchains</B
>
provided. To make use of an extension, you must specify its name through the
<CODE
CLASS="OPTION"
>-m</CODE
> <TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
> argument to
<B
CLASS="COMMAND"
>iptables</B
>. The following list shows the
<CODE
CLASS="OPTION"
>-m</CODE
> and <CODE
CLASS="OPTION"
>-p</CODE
> options that set up the extension's
context, and the options provided by
that extension.</P
><DIV
CLASS="SECT4"
><HR><H5
CLASS="SECT4"
><A
NAME="AEN8878"
>9.8.2.4.1. TCP Extensions: used with -m tcp -p tcp</A
></H5
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>- -sport [!] [port[:port]]</DT
><DD
><P
>Specifies the port that the datagram source must be using to match this rule.
Ports may be specified as a range by specifying the upper and lower limits of
the range using the colon as a delimiter. For example, <TT
CLASS="LITERAL"
>20:25</TT
>
described all of the ports numbered 20 up to and including 25. Again, the
<TT
CLASS="LITERAL"
>!</TT
> character may be used to negate the values.</P
></DD
><DT
>- -dport [!] [port[:port]]</DT
><DD
><P
>Specifies the port that the datagram destination must be using to match this
rule. The argument is coded identically to the <CODE
CLASS="OPTION"
>- -sport</CODE
>
option.</P
></DD
><DT
>- -tcp-flags [!] mask comp</DT
><DD
><P
>&#13;Specifies that this rule should match when the TCP flags in the
datagram match those specified by <TT
CLASS="REPLACEABLE"
><I
>mask</I
></TT
> and
<TT
CLASS="REPLACEABLE"
><I
>comp</I
></TT
>. <TT
CLASS="REPLACEABLE"
><I
>mask</I
></TT
> is a
comma-separated list of flags that should be examined when making the
test. <TT
CLASS="REPLACEABLE"
><I
>comp</I
></TT
> is a comma-separated list of
flags that must be set for the rule to match. Valid flags are:
<EM
>SYN</EM
>, <EM
>ACK</EM
>,
<EM
>FIN</EM
>, <EM
>RST</EM
>,
<EM
>URG</EM
>, <EM
>PSH</EM
>, <EM
>ALL</EM
>
or <EM
>NONE</EM
>. This is an advanced option: refer to a
good description of the TCP protocol, such as RFC-793, for a
description of the meaning and implication of each of these flags.
The <TT
CLASS="LITERAL"
>!</TT
> character negates the rule.</P
></DD
><DT
>[!] - -syn</DT
><DD
><P
>Specifies the rule to match only datagrams with the
<TT
CLASS="LITERAL"
>SYN</TT
> bit set and the <TT
CLASS="LITERAL"
>ACK</TT
> and
<TT
CLASS="LITERAL"
>FIN</TT
> bits cleared. Datagrams with these options are used
to open TCP connections, and this option can therefore be used to manage
connection requests. This option is shorthand for:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="LITERAL"
>- -tcp-flags SYN,RST,ACK SYN</TT
></PRE
></FONT
></TD
></TR
></TABLE
>

 When you use the negation
operator, the rule will match all datagrams that do not have both the
<TT
CLASS="LITERAL"
>SYN</TT
> and <TT
CLASS="LITERAL"
>ACK</TT
> bits set.</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT4"
><HR><H5
CLASS="SECT4"
><A
NAME="AEN8922"
>9.8.2.4.2. UDP Extensions: used with -m udp -p udp</A
></H5
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>- -sport [!] [port[:port]]</DT
><DD
><P
>Specifies the port that the datagram source must be using to match this rule.
Ports may be specified as a range by specifying the upper and lower limits of
the range using the colon as a delimiter. For example, <TT
CLASS="LITERAL"
>20:25</TT
>
describes all of the ports numbered 20 up to and including 25. Again, the
<TT
CLASS="LITERAL"
>!</TT
> character may be used to negate the values.</P
></DD
><DT
>- -dport [!] [port[:port]]</DT
><DD
><P
>Specifies the port that the datagram destination must be using to match this
rule. The argument is coded identically to the <CODE
CLASS="OPTION"
>- -sport</CODE
>
option.</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT4"
><HR><H5
CLASS="SECT4"
><A
NAME="AEN8936"
>9.8.2.4.3. ICMP Extensions: used with <TT
CLASS="LITERAL"
>-m icmp -p icmp</TT
></A
></H5
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>- -icmp-type [!] typename</DT
><DD
><P
>Specifies the ICMP message type that this rule will match. The type may be
specified by number or name. Some valid names are:
<TT
CLASS="LITERAL"
>echo-request</TT
>, <TT
CLASS="LITERAL"
>echo-reply</TT
>,
<TT
CLASS="LITERAL"
>source-quench</TT
>, <TT
CLASS="LITERAL"
>time-exceeded</TT
>,
<TT
CLASS="LITERAL"
>destination-unreachable</TT
>,
<TT
CLASS="LITERAL"
>network-unreachable</TT
>, <TT
CLASS="LITERAL"
>host-unreachable</TT
>,
<TT
CLASS="LITERAL"
>protocol-unreachable</TT
>, and
<TT
CLASS="LITERAL"
>port-unreachable</TT
>.</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT4"
><HR><H5
CLASS="SECT4"
><A
NAME="AEN8953"
>9.8.2.4.4. MAC Extensions: used with <TT
CLASS="LITERAL"
>-m mac</TT
></A
></H5
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>- -mac-source [!] address</DT
><DD
><P
>Specifies the host's Ethernet address that transmitted the datagram
that this rule will match. This only makes sense in a rule in the input or
forward chains because we will be transmitting any datagram that passes the
output chain.</P
></DD
></DL
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN8962"
>9.8.3. Our Nave Example Revisited, Yet Again</A
></H3
><P
>To implement our nave example using the <EM
>netfilter</EM
>,
you could simply load the <TT
CLASS="FILENAME"
>ipchains.o</TT
> module and pretend
it is the <B
CLASS="COMMAND"
>ipchains</B
> version. Instead, we'll reimplement
it using <B
CLASS="COMMAND"
>iptables</B
> to illustrate how similar it is.</P
><P
>Yet again, let's suppose that we have a network in our organization
and that we are using a Linux-based firewall machine to allow our
users to be able to access WWW servers on the Internet, but to allow
no other traffic to be passed.</P
><P
>If our network has a 24-bit network mask (class C) and has an address of
172.16.1.0, then we'd use the following <B
CLASS="COMMAND"
>iptables</B
> rules:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>modprobe ip_tables</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>iptables -F FORWARD</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>iptables -P FORWARD DROP</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -m tcp -p tcp -s 0/0 --sport 80 -d 172.16.1.0/24 /
    --syn -j DROP</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -m tcp -p tcp -s 172.16.1.0/24 --sport /
    80 -d 0/0 -j ACCEPT</KBD
>
<SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -m tcp -p tcp -d 172.16.1.0/24 --dport 80 -s 0/0 -j /
    ACCEPT</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>In this example the <B
CLASS="COMMAND"
>iptables</B
> commands are interpreted
exactly as the equivalent <B
CLASS="COMMAND"
>ipchains</B
> commands. The major
exception that the <TT
CLASS="FILENAME"
>ip_tables.o</TT
>
module must load. Note that <B
CLASS="COMMAND"
>iptables</B
> doesn't support the
<CODE
CLASS="OPTION"
>-b</CODE
> option, so we must supply a rule for each
direction.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-FIREWALL.TOS.MANIPULATION"
>9.9. TOS Bit Manipulation</A
></H2
><P
>&#13;

The Type Of Service (TOS) bits are a set of four-bit flags in
the IP header. When any one of these bit flags is set, routers may handle the
datagram differently than datagrams with no TOS bits set. Each of the four bits
has a different purpose and only one of the TOS bits may be set at any time, so
combinations are not allowed. The bit flags are called Type of Service bits
because they enable the application transmitting the data to tell the network
the type of network service it requires.</P
><P
>The classes of network service available are:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Minimum delay</DT
><DD
><P
>Used when the time it takes for a datagram to travel from the source host
to destination host (latency) is most important. A network provider might, for
example, use both optical fiber and satellite network connections. Data carried
across satellite connections has farther to travel and their latency is
generally therefore higher than for terrestrial-based network connections
between the same endpoints. A network provider might choose to ensure that
datagrams with this type of service set are not carried by satellite.</P
></DD
><DT
>Maximum throughput</DT
><DD
><P
>Used when the volume of data transmitted in any period of time is
important. There are many types of network applications for which latency
is not particularly important but the network throughput is; for
example, bulk-file transfers. A network provider might choose to route
datagrams with this type of service set via high-latency,
high-bandwidth routes, such as satellite connections.</P
></DD
><DT
>Maximum reliability</DT
><DD
><P
>Used when it is important that you have some certainty that the data
will arrive at the destination without retransmission being
required. The IP protocol may be carried over any number of underlying
transmission mediums.  While SLIP and PPP are adequate datalink
protocols, they are not as reliable as carrying IP over some other
network, such as an X.25 network. A network provider might make
an alternate network available, offering high reliability, to carry IP
that would be used if this type of service is selected.</P
></DD
><DT
>Minimum cost</DT
><DD
><P
>Used when it is important to minimize the cost of data
transmission. Leasing bandwidth on a satellite for a transpacific
crossing is generally less costly than leasing space on a
fiber-optical cable over the same distance, so network providers may
choose to provide both and charge differently depending on which you
use. In this scenario, your &#8220;minimum cost&#8221; type of service
bit may cause your datagrams to be routed via the lower-cost satellite
route.</P
></DD
></DL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN9023"
>9.9.1. Setting the TOS Bits Using ipfwadm or ipchains</A
></H3
><P
>&#13;
The <B
CLASS="COMMAND"
>ipfwadm</B
> and <B
CLASS="COMMAND"
>ipchains</B
> commands deal
with the TOS bits in much the same manner. In both cases you specify a rule
that matches the datagrams with particular TOS bits set, and
use the <CODE
CLASS="OPTION"
>-t</CODE
> argument to specify the change you wish to make.</P
><P
>The changes are specified using two-bit masks. The first of these bit masks is
logically ANDed with the IP options field of the datagram and the second is
logically eXclusive-ORd with it. If this sounds complicated, we'll give you
the recipes required to enable each of the types of service in a moment.</P
><P
>The bit masks are specified using eight-bit hexadecimal values. Both
<B
CLASS="COMMAND"
>ipfwadm</B
> and <B
CLASS="COMMAND"
>ipchains</B
> use the same
argument syntax:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="LITERAL"
>-t <TT
CLASS="REPLACEABLE"
><I
>andmask</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>xormask</I
></TT
></TT
></PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Fortunately the same mask arguments can be used each time you wish to set a
particular type of service, to save you having to work them out. They are
presented with some suggested uses in
<A
HREF="#X-087-2-FIREWALL.IPCHAINS.TOS.RECIPES"
>Table 9-3</A
>.</P
><DIV
CLASS="TABLE"
><A
NAME="X-087-2-FIREWALL.IPCHAINS.TOS.RECIPES"
></A
><P
><B
>Table 9-3. Suggested Uses for TOS Bitmasks</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL
WIDTH="2"><COL><COL><COL><THEAD
><TR
><TH
>TOS</TH
><TH
>ANDmask</TH
><TH
>XORmask</TH
><TH
>Suggested Use</TH
></TR
></THEAD
><TBODY
><TR
><TD
>Minimum Delay</TD
><TD
><TT
CLASS="LITERAL"
>0x01</TT
></TD
><TD
><TT
CLASS="LITERAL"
>0x10</TT
></TD
><TD
>ftp, telnet, ssh</TD
></TR
><TR
><TD
>Maximum Throughput</TD
><TD
><TT
CLASS="LITERAL"
>0x01</TT
></TD
><TD
><TT
CLASS="LITERAL"
>0x08</TT
></TD
><TD
>ftp-data, www</TD
></TR
><TR
><TD
>Maximum Reliability</TD
><TD
><TT
CLASS="LITERAL"
>0x01</TT
></TD
><TD
><TT
CLASS="LITERAL"
>0x04</TT
></TD
><TD
>snmp, dns</TD
></TR
><TR
><TD
>Minimum Cost</TD
><TD
><TT
CLASS="LITERAL"
>0x01</TT
></TD
><TD
><TT
CLASS="LITERAL"
>0x02</TT
></TD
><TD
>nntp, smtp</TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN9084"
>9.9.2. Setting the TOS Bits Using iptables</A
></H3
><P
>&#13;The <B
CLASS="COMMAND"
>iptables</B
> tool allows you to specify rules that
capture only datagrams with TOS bits matching some predetermined value
using the <CODE
CLASS="OPTION"
>-m tos</CODE
> option, and for setting the TOS
bits of IP datagrams matching a rule using the <TT
CLASS="LITERAL"
>-j
TOS</TT
> target. You may set TOS bits only on the
<TT
CLASS="LITERAL"
>FORWARD</TT
> and <TT
CLASS="LITERAL"
>OUTPUT</TT
> chains. The
matching and the setting occur quite independently. You can configure
all sort of interesting rules. For example, you can configure a rule
that discads all datagrams with certain TOS bit combinations, or a
rule that sets the TOS bits of datagrams only from certain hosts. Most
often you will use rules that contain both matching and setting to
perform TOS bit translations, just as you could for
<B
CLASS="COMMAND"
>ipfwadm</B
> or <B
CLASS="COMMAND"
>ipchains</B
>.</P
><P
>Rather than the complicated two-mask configuration of
<B
CLASS="COMMAND"
>ipfwadm</B
> and <B
CLASS="COMMAND"
>ipchains</B
>,
<B
CLASS="COMMAND"
>iptables</B
> uses the simpler approach of plainly specifying
what the TOS bits should match, or to what the TOS bits should be set.
Additionally, rather than having to remember and use the hexadecimal value,
you may specify the TOS bits using the more friendly mnemonics listed in
the upcoming table.</P
><P
>The general syntax used to match TOS bits looks like:
 
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="LITERAL"
>-m tos --tos <TT
CLASS="REPLACEABLE"
><I
>mnemonic</I
></TT
> [<TT
CLASS="REPLACEABLE"
><I
>other-args</I
></TT
>] -j <TT
CLASS="REPLACEABLE"
><I
>target</I
></TT
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The general syntax used to set TOS bits looks like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="LITERAL"
>[<TT
CLASS="REPLACEABLE"
><I
>other-args</I
></TT
>] -j TOS --set <TT
CLASS="REPLACEABLE"
><I
>mnemonic</I
></TT
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Remember that these would typically be used together, but they can be
used quite independently if you have a configuration that
requires it.</P
><DIV
CLASS="INFORMALTABLE"
><P
></P
><A
NAME="X-087-2-FIREWALL.IPTABLES.TOS.RECIPES"
></A
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><THEAD
><TR
><TH
>Mnemonic</TH
><TH
>Hexadecimal</TH
></TR
></THEAD
><TBODY
><TR
><TD
>Normal-Service</TD
><TD
>0x00</TD
></TR
><TR
><TD
>Minimize-Cost</TD
><TD
>0x02</TD
></TR
><TR
><TD
>Maximize-Reliability</TD
><TD
>0x04</TD
></TR
><TR
><TD
>Maximize-Throughput</TD
><TD
>0x08</TD
></TR
><TR
><TD
>Minimize-Delay</TD
><TD
>0x10</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-FIREWALL.CHECKINGCONF"
>9.10. Testing a
Firewall Configuration</A
></H2
><P
>&#13;After you've designed an appropriate firewall configuration, it's
important to validate that it does in fact do what you want it to
do. One way to do this is to use a test host outside your network to
attempt to pierce your firewall: this can be quite clumsy and
slow, though, and is limited to testing only those addresses that you can
actually use.</P
><P
>A faster and easier method is available with the Linux firewall
implementation.  It allows you to manually generate tests and run them 
through the firewall configuration just as if you were testing with
actual datagrams. All varieties of the Linux kernel firewall software,
<B
CLASS="COMMAND"
>ipfwadm</B
>, <B
CLASS="COMMAND"
>ipchains</B
>, and
<B
CLASS="COMMAND"
>iptables</B
>, provide support for this style of
testing. The implementation involves use of the relevant
<EM
>check</EM
> command.</P
><P
>The general test procedure is as follows:</P
><P
></P
><OL
TYPE="1"
><LI
><P
>Design and configure your firewall using <B
CLASS="COMMAND"
>ipfwadm</B
>,
<B
CLASS="COMMAND"
>ipchains</B
>, or <B
CLASS="COMMAND"
>iptables</B
>.</P
></LI
><LI
><P
>Design a series of tests that will determine whether your firewall is
actually working as you intend. For these tests you may use any source
or destination address, so choose some address combinations that
should be accepted and some others that should be dropped. If you're
allowing or disallowing only certain ranges of addresses, it is a good
idea to test addresses on either side of the boundary of the
range&#8212;one address just inside the boundary and one address just
outside the boundary. This will help ensure that you have the correct
boundaries configured, because it is sometimes easy to specify
netmasks incorrectly in your configuration.  If you're filtering by
protocol and port number, your tests should also check all important
combinations of these parameters. For example, if you intend to accept
only TCP under certain circumstances, check that UDP datagrams are
dropped.</P
></LI
><LI
><P
>Develop <B
CLASS="COMMAND"
>ipfwadm</B
>, <B
CLASS="COMMAND"
>ipchains</B
>, or
<B
CLASS="COMMAND"
>iptables</B
> rules to implement each test. It is
probably worthwhile to write all the rules into a script so you can
test and re-test easily as you correct mistakes or change your
design. Tests use almost the same syntax as rule specifications, but
the arguments take on slightly differing meanings. For example, the
source address argument in a rule specification specifies the source
address that datagrams matching this rule should have. The source
address argument in test syntax, in contrast, specifies the source
address of the test datagram that will be generated. For 
<B
CLASS="COMMAND"
>ipfwadm</B
>, you must use the <CODE
CLASS="OPTION"
>&#8211;c</CODE
>
option to specify that this command is a test, while for
<B
CLASS="COMMAND"
>ipchains</B
> and <B
CLASS="COMMAND"
>iptables</B
>, you must
use the <CODE
CLASS="OPTION"
>&#8211;C</CODE
> option. In all cases you must
<EM
>always</EM
> specify the source address, destination
address, protocol, and interface to be used for the test. Other
arguments, such as port numbers or TOS bit settings, are optional.</P
></LI
><LI
><P
>Execute each test command and note the output. The output of each test
will be a single word indicating the final target of the datagram
after running it through the firewall configuration&#8212;that is,
where the processing ended. For <B
CLASS="COMMAND"
>ipchains</B
> and
<B
CLASS="COMMAND"
>iptables</B
>, user-specified chains will be tested
in addition to the built-in ones.</P
></LI
><LI
><P
>Compare the output of each test against the desired result. If there
are any discrepancies, you will need to analyse your ruleset to
determine where you've made the error. If you've written your test
commands into a script file, you can easily rerun the test after
correcting any errors in your firewall configuration. It's a good
practice to flush your rulesets completely and rebuild them from
scratch, rather than to make changes dynamically. This helps ensure
that the active configuration you are testing actually reflects the
set of commands in your configuration script.</P
></LI
></OL
><P
>Let's take a quick look at what a manual test transcript would look
like for our nave example with <B
CLASS="COMMAND"
>ipchains</B
>. You will remember that our
local network in the example was 172.16.1.0 with a netmask of
255.255.255.0, and we were to allow TCP connections out to web servers
on the net. Nothing else was to pass our forward chain.  Start with a
transmission that we know should work, a connection from a local host
to a web server outside:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -C forward -p tcp -s 172.16.1.0 1025 -d 44.136.8.2 80 -i eth0</KBD
>
accepted</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Note the arguments had to be supplied and the way they've been used to
describe a datagram. The output of the command indicates that the
datagram was accepted for forwarding, which is what we hoped for.</P
><P
>Now try another test, this time with a source address that doesn't
belong to our network. This one should be denied:
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -C forward -p tcp -s 172.16.2.0 1025 -d 44.136.8.2 80 -i eth0</KBD
>
denied</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Try some more tests, this time with the same details as the first test,
but with different protocols. These should be denied, too:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -C forward -p udp -s 172.16.1.0 1025 -d 44.136.8.2 80 -i eth0</KBD
>
denied
# <KBD
CLASS="USERINPUT"
>ipchains -C forward -p icmp -s 172.16.1.0 1025 -d 44.136.8.2 80 -i eth0</KBD
>
denied</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Try another destination port, again expecting it to be denied:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -C forward -p tcp -s 172.16.1.0 1025 -d 44.136.8.2 23 -i eth0</KBD
>
denied</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>You'll go a long way toward achieving peace of mind if you design a series
of exhaustive tests. While this can sometimes be as difficult as designing
the firewall configuration, it's also the best way of knowing
that your design
is providing the security you expect of it.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-FIREWALL.EXAMPLE"
>9.11. A Sample Firewall Configuration</A
></H2
><P
>&#13;We've discussed the fundamentals of firewall configuration. Let's now
look at what a firewall configuration might actually look like.</P
><P
>The configuration in this example has been designed to be easily
extended and customized. We've provided three versions. The first
version is implemented using the <B
CLASS="COMMAND"
>ipfwadm</B
> command
(or the <B
CLASS="COMMAND"
>ipfwadm-wrapper</B
> script), the second uses
<B
CLASS="COMMAND"
>ipchains</B
>, and the third uses
<B
CLASS="COMMAND"
>iptables</B
>. The example doesn't attempt to exploit
user-defined chains, but it will show you the similarities and
differences between the old and new firewall configuration tool
syntaxes:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>#!/bin/bash
##########################################################################
# IPFWADM VERSION
# This sample configuration is for a single host firewall configuration
# with no services supported by the firewall machine itself.
##########################################################################

# USER CONFIGURABLE SECTION

# The name and location of the ipfwadm utility. Use ipfwadm-wrapper for
# 2.2.* kernels.
IPFWADM=ipfwadm

# The path to the ipfwadm executable.
PATH="/sbin"

# Our internal network address space and its supporting network device.
OURNET="172.29.16.0/24"
OURBCAST="172.29.16.255"
OURDEV="eth0"

# The outside address and the network device that supports it.
ANYADDR="0/0"
ANYDEV="eth1"

# The TCP services we wish to allow to pass - "" empty means all ports
# note: space separated
TCPIN="smtp www"
TCPOUT="smtp www ftp ftp-data irc"

# The UDP services we wish to allow to pass - "" empty means all ports
# note: space separated
UDPIN="domain"
UDPOUT="domain"

# The ICMP services we wish to allow to pass - "" empty means all types
# ref: /usr/include/netinet/ip_icmp.h for type numbers
# note: space separated
ICMPIN="0 3 11"
ICMPOUT="8 3 11"

# Logging; uncomment the following line to enable logging of datagrams
# that are blocked by the firewall.
# LOGGING=1

# END USER CONFIGURABLE SECTION
###########################################################################
# Flush the Incoming table rules
$IPFWADM -I -f

# We want to deny incoming access by default.
$IPFWADM -I -p deny

# SPOOFING
# We should not accept any datagrams with a source address matching ours
# from the outside, so we deny them.
$IPFWADM -I -a deny -S $OURNET -W $ANYDEV

# SMURF
# Disallow ICMP to our broadcast address to prevent "Smurf" style attack.
$IPFWADM -I -a deny -P icmp -W $ANYDEV -D $OURBCAST

# TCP
# We will accept all TCP datagrams belonging to an existing connection
# (i.e. having the ACK bit set) for the TCP ports we're allowing through.
# This should catch more than 95 % of all valid TCP packets.
$IPFWADM -I -a accept -P tcp -D $OURNET $TCPIN -k -b

# TCP - INCOMING CONNECTIONS
# We will accept connection requests from the outside only on the
# allowed TCP ports.
$IPFWADM -I -a accept -P tcp -W $ANYDEV -D $OURNET $TCPIN -y

# TCP - OUTGOING CONNECTIONS
# We accept all outgoing tcp connection requests on allowed TCP ports.
$IPFWADM -I -a accept -P tcp -W $OURDEV -D $ANYADDR $TCPOUT -y

# UDP - INCOMING
# We will allow UDP datagrams in on the allowed ports.
$IPFWADM -I -a accept -P udp -W $ANYDEV -D $OURNET $UDPIN

# UDP - OUTGOING
# We will allow UDP datagrams out on the allowed ports.
$IPFWADM -I -a accept -P udp -W $OURDEV -D $ANYADDR $UDPOUT

# ICMP - INCOMING
# We will allow ICMP datagrams in of the allowed types.
$IPFWADM -I -a accept -P icmp -W $ANYDEV -D $OURNET $UDPIN

# ICMP - OUTGOING
# We will allow ICMP datagrams out of the allowed types.
$IPFWADM -I -a accept -P icmp -W $OURDEV -D $ANYADDR $UDPOUT

# DEFAULT and LOGGING
# All remaining datagrams fall through to the default
# rule and are dropped. They will be logged if you've
# configured the LOGGING variable above.
#
if [ "$LOGGING" ]
then
	# Log barred TCP
	$IPFWADM -I -a reject -P tcp -o

	# Log barred UDP
	$IPFWADM -I -a reject -P udp -o

	# Log barred ICMP
	$IPFWADM -I -a reject -P icmp -o
fi
#
# end.</PRE
></FONT
></TD
></TR
></TABLE
><P
>Now we'll reimplement it using the <B
CLASS="COMMAND"
>ipchains</B
> command:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>#!/bin/bash
##########################################################################
# IPCHAINS VERSION
# This sample configuration is for a single host firewall configuration
# with no services supported by the firewall machine itself.
##########################################################################

# USER CONFIGURABLE SECTION

# The name and location of the ipchains utility.
IPCHAINS=ipchains

# The path to the ipchains executable.
PATH="/sbin"

# Our internal network address space and its supporting network device.
OURNET="172.29.16.0/24"
OURBCAST="172.29.16.255"
OURDEV="eth0"

# The outside address and the network device that supports it.
ANYADDR="0/0"
ANYDEV="eth1"

# The TCP services we wish to allow to pass - "" empty means all ports
# note: space separated
TCPIN="smtp www"
TCPOUT="smtp www ftp ftp-data irc"

# The UDP services we wish to allow to pass - "" empty means all ports
# note: space separated
UDPIN="domain"
UDPOUT="domain"

# The ICMP services we wish to allow to pass - "" empty means all types
# ref: /usr/include/netinet/ip_icmp.h for type numbers
# note: space separated
ICMPIN="0 3 11"
ICMPOUT="8 3 11"

# Logging; uncomment the following line to enable logging of datagrams
# that are blocked by the firewall.
# LOGGING=1

# END USER CONFIGURABLE SECTION
##########################################################################
# Flush the Input table rules
$IPCHAINS -F input

# We want to deny incoming access by default.
$IPCHAINS -P input deny

# SPOOFING
# We should not accept any datagrams with a source address matching ours
# from the outside, so we deny them.
$IPCHAINS -A input -s $OURNET -i $ANYDEV -j deny

# SMURF
# Disallow ICMP to our broadcast address to prevent "Smurf" style attack.
$IPCHAINS -A input -p icmp -w $ANYDEV -d $OURBCAST -j deny

# We should accept fragments, in ipchains we must do this explicitly.
$IPCHAINS -A input -f -j accept

# TCP
# We will accept all TCP datagrams belonging to an existing connection
# (i.e. having the ACK bit set) for the TCP ports we're allowing through.
# This should catch more than 95 % of all valid TCP packets.
$IPCHAINS -A input -p tcp -d $OURNET $TCPIN ! -y -b -j accept

# TCP - INCOMING CONNECTIONS
# We will accept connection requests from the outside only on the
# allowed TCP ports.
$IPCHAINS -A input -p tcp -i $ANYDEV -d $OURNET $TCPIN -y -j accept

# TCP - OUTGOING CONNECTIONS
# We accept all outgoing TCP connection requests on allowed TCP ports.
$IPCHAINS -A input -p tcp -i $OURDEV -d $ANYADDR $TCPOUT -y -j accept

# UDP - INCOMING
# We will allow UDP datagrams in on the allowed ports.
$IPCHAINS -A input -p udp -i $ANYDEV -d $OURNET $UDPIN -j accept

# UDP - OUTGOING
# We will allow UDP datagrams out on the allowed ports.
$IPCHAINS -A input -p udp -i $OURDEV -d $ANYADDR $UDPOUT -j accept

# ICMP - INCOMING
# We will allow ICMP datagrams in of the allowed types.
$IPCHAINS -A input -p icmp -w $ANYDEV -d $OURNET $UDPIN -j accept

# ICMP - OUTGOING
# We will allow ICMP datagrams out of the allowed types.
$IPCHAINS -A input -p icmp -i $OURDEV -d $ANYADDR $UDPOUT -j accept

# DEFAULT and LOGGING
# All remaining datagrams fall through to the default
# rule and are dropped. They will be logged if you've
# configured the LOGGING variable above.
#
if [ "$LOGGING" ]
then
	# Log barred TCP
	$IPCHAINS -A input -p tcp -l -j reject

	# Log barred UDP
	$IPCHAINS -A input -p udp -l -j reject

	# Log barred ICMP
	$IPCHAINS -A input -p icmp -l -j reject
fi
#
# end.</PRE
></FONT
></TD
></TR
></TABLE
><P
>In our <B
CLASS="COMMAND"
>iptables</B
> example, we've switched to using
the <TT
CLASS="LITERAL"
>FORWARD</TT
> ruleset because of the difference in
meaning of the <TT
CLASS="LITERAL"
>INPUT</TT
> ruleset in the
<EM
>netfilter</EM
> implementation. This has implications
for us; it means that none of the rules protect the firewall host
itself. To accurately mimic our <B
CLASS="COMMAND"
>ipchains</B
> example,
we would replicate each of our rules in the <TT
CLASS="LITERAL"
>INPUT</TT
>
chain. For clarity, we've dropped all incoming datagrams received from
our outside interface instead.</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>#!/bin/bash
##########################################################################
# IPTABLES VERSION
# This sample configuration is for a single host firewall configuration
# with no services supported by the firewall machine itself.
##########################################################################

# USER CONFIGURABLE SECTION

# The name and location of the ipchains utility.
IPTABLES=iptables

# The path to the ipchains executable.
PATH="/sbin"

# Our internal network address space and its supporting network device.
OURNET="172.29.16.0/24"
OURBCAST="172.29.16.255"
OURDEV="eth0"

# The outside address and the network device that supports it.
ANYADDR="0/0"
ANYDEV="eth1"

# The TCP services we wish to allow to pass - "" empty means all ports
# note: comma separated
TCPIN="smtp,www"
TCPOUT="smtp,www,ftp,ftp-data,irc"

# The UDP services we wish to allow to pass - "" empty means all ports
# note: comma separated
UDPIN="domain"
UDPOUT="domain"

# The ICMP services we wish to allow to pass - "" empty means all types
# ref: /usr/include/netinet/ip_icmp.h for type numbers
# note: comma separated
ICMPIN="0,3,11"
ICMPOUT="8,3,11"

# Logging; uncomment the following line to enable logging of datagrams
# that are blocked by the firewall.
# LOGGING=1

# END USER CONFIGURABLE SECTION
###########################################################################
# Flush the Input table rules
$IPTABLES -F FORWARD

# We want to deny incoming access by default.
$IPTABLES -P FORWARD deny

# Drop all datagrams destined for this host received from outside.
$IPTABLES -A INPUT -i $ANYDEV -j DROP

# SPOOFING
# We should not accept any datagrams with a source address matching ours
# from the outside, so we deny them.
$IPTABLES -A FORWARD -s $OURNET -i $ANYDEV -j DROP

# SMURF
# Disallow ICMP to our broadcast address to prevent "Smurf" style attack.
$IPTABLES -A FORWARD -m multiport -p icmp -i $ANYDEV -d $OURNET -j DENY

# We should accept fragments, in iptables we must do this explicitly.
$IPTABLES -A FORWARD -f -j ACCEPT

# TCP
# We will accept all TCP datagrams belonging to an existing connection
# (i.e. having the ACK bit set) for the TCP ports we're allowing through.
# This should catch more than 95 % of all valid TCP packets.
$IPTABLES -A FORWARD -m multiport -p tcp -d $OURNET --dports $TCPIN /
    ! --tcp-flags SYN,ACK ACK -j ACCEPT
$IPTABLES -A FORWARD -m multiport -p tcp -s $OURNET --sports $TCPIN /
    ! --tcp-flags SYN,ACK ACK -j ACCEPT


# TCP - INCOMING CONNECTIONS
# We will accept connection requests from the outside only on the
# allowed TCP ports.
$IPTABLES -A FORWARD -m multiport -p tcp -i $ANYDEV -d $OURNET $TCPIN /
    --syn -j ACCEPT

# TCP - OUTGOING CONNECTIONS
# We will accept all outgoing tcp connection requests on the allowed /
    TCP ports.
$IPTABLES -A FORWARD -m multiport -p tcp -i $OURDEV -d $ANYADDR /
    --dports $TCPOUT --syn -j ACCEPT
# UDP - INCOMING
# We will allow UDP datagrams in on the allowed ports and back.
$IPTABLES -A FORWARD -m multiport -p udp -i $ANYDEV -d $OURNET /
    --dports $UDPIN -j ACCEPT
$IPTABLES -A FORWARD -m multiport -p udp -i $ANYDEV -s $OURNET /
    --sports $UDPIN -j ACCEPT
# UDP - OUTGOING
# We will allow UDP datagrams out to the allowed ports and back.
$IPTABLES -A FORWARD -m multiport -p udp -i $OURDEV -d $ANYADDR /
    --dports $UDPOUT -j ACCEPT
$IPTABLES -A FORWARD -m multiport -p udp -i $OURDEV -s $ANYADDR /
    --sports $UDPOUT -j ACCEPT
# ICMP - INCOMING
# We will allow ICMP datagrams in of the allowed types.
$IPTABLES -A FORWARD -m multiport -p icmp -i $ANYDEV -d $OURNET /
    --dports $ICMPIN -j ACCEPT
# ICMP - OUTGOING
# We will allow ICMP datagrams out of the allowed types.
$IPTABLES -A FORWARD -m multiport -p icmp -i $OURDEV -d $ANYADDR /
    --dports $ICMPOUT -j ACCEPT
# DEFAULT and LOGGING
# All remaining datagrams fall through to the default
# rule and are dropped. They will be logged if you've
# configured the LOGGING variable above.
#
if [ "$LOGGING" ]
then
	# Log barred TCP
	$IPTABLES -A FORWARD -m tcp -p tcp -j LOG
	# Log barred UDP
	$IPTABLES -A FORWARD -m udp -p udp -j LOG
	# Log barred ICMP
	$IPTABLES -A FORWARD -m udp -p icmp -j LOG
fi
#
# end.</PRE
></FONT
></TD
></TR
></TABLE
><P
>In many simple situations, to use the sample all you have to do is edit
the top section of the file labeled &#8220;USER
CONFIGURABLE section&#8221; to specify which protocols and datagrams
type you wish to allow in and out. For more complex configurations,
you will need to edit the section at the bottom, as well. Remember,
this is a simple example, so scrutinize it very carefully to ensure it
does what you want while implementing it.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-ACCOUNTING"
></A
>Chapter 10. IP Accounting</H1
><P
>&#13;In today&#8217;s world of commercial Internet service, it is becoming 
increasingly important to know
how much data you are transmitting and receiving on your network connections.
If you are an Internet Service Provider and you charge your customers by
volume, this will be essential to your business. If you are a customer
of an Internet Service Provider that charges by data volume, you will
find it useful to collect your own data to ensure the accuracy of your
Internet charges.</P
><P
>There are other uses for network accounting that have nothing to do with
dollars and bills. If you manage a server that offers a number of different
types of network services, it might be useful to you to know exactly
how much data is being generated by each one. This sort of information
could assist you in making decisions, such as what hardware to buy or how
many servers to run.</P
><P
>The Linux kernel provides a facility that allows you to collect all sorts
of useful information about the network traffic it sees. This facility
is called <EM
>IP accounting</EM
>.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-ACCOUNTING.KERNEL.CONFIG"
>10.1. Configuring the Kernel for IP Accounting</A
></H2
><P
>&#13;
The Linux IP accounting feature is very closely related to the Linux
firewall software. The places you want to collect
accounting data are the same places that you would be interested in
performing firewall filtering: into and out of a network host, and in the
software that does the routing of datagrams. If you haven't read the section
on firewalls, now is probably a good time to do so, as we will be using some of
the concepts described in <A
HREF="#X-087-2-FIREWALL"
>Chapter 9</A
>.</P
><P
>&#13;
To activate the Linux IP accounting feature, you should first see if your 
Linux kernel is configured for it. Check to see if the <TT
CLASS="FILENAME"
>/proc/net/ip_acct</TT
> file exists. If it does, your kernel already supports IP accounting. If it doesn't, you must build a new kernel, ensuring that you answer &#8220;Y&#8221; to the options in 2.0 and 2.2 series kernels:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Networking options  ---&#62;
	[*] Network firewalls
	[*] TCP/IP networking
	 ...
	[*] IP: accounting</PRE
></FONT
></TD
></TR
></TABLE
>


or in 2.4 series kernels:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Networking options  ---&#62;
    [*] Network packet filtering (replaces ipchains)</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-ACCOUNTING.IPFWADM"
>10.2. Configuring IP Accounting</A
></H2
><P
>&#13;



Because IP accounting is closely related to IP firewall, the same tool 
was designated to configure it, so <B
CLASS="COMMAND"
>ipfwadm</B
>,
<B
CLASS="COMMAND"
>ipchains</B
> or <B
CLASS="COMMAND"
>iptables</B
> are used to configure IP accounting. The command syntax is very similar to
that of the firewall rules, so we won't focus on it, but we will discuss
what you can discover about the nature of your network traffic using this 
feature.</P
><P
>The general syntax for IP accounting with <B
CLASS="COMMAND"
>ipfwadm</B
> is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -A [<TT
CLASS="REPLACEABLE"
><I
>direction</I
></TT
>] [<TT
CLASS="REPLACEABLE"
><I
>command</I
></TT
>] [<TT
CLASS="REPLACEABLE"
><I
>parameters</I
></TT
>]</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The direction argument is new. This is simply coded as
<TT
CLASS="LITERAL"
>in</TT
>,
<TT
CLASS="LITERAL"
>out</TT
>, or
<TT
CLASS="LITERAL"
>both</TT
>.
These directions are from the perspective of the linux machine itself, so
<TT
CLASS="LITERAL"
>in</TT
> means data coming into the machine from a network 
connection and <TT
CLASS="LITERAL"
>out</TT
> means data that is being transmitted by 
this host on a network connection. The <TT
CLASS="LITERAL"
>both</TT
> direction is the 
sum of both the incoming and outgoing directions.</P
><P
>The general command syntax for <B
CLASS="COMMAND"
>ipchains</B
> 
and <B
CLASS="COMMAND"
>iptables</B
> is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -A <TT
CLASS="REPLACEABLE"
><I
>chain</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>rule-specification</I
></TT
></KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A <TT
CLASS="REPLACEABLE"
><I
>chain</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>rule-specification</I
></TT
></KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <B
CLASS="COMMAND"
>ipchains</B
> and <B
CLASS="COMMAND"
>iptables</B
>
commands allow you to specify direction in a manner more consistent
with the firewall rules.  IP Firewall Chains doesn't allow you to
configure a rule that aggregates both directions, but it does allow you
to configure rules in the <TT
CLASS="LITERAL"
>forward</TT
> chain that the
older implementation did not. We'll see the difference that makes in
some examples a little later.</P
><P
>The commands are much the same as firewall rules, except that the
policy rules do not apply here. We can add, insert, delete, and list
accounting rules. In the case of <B
CLASS="COMMAND"
>ipchains</B
> and
<B
CLASS="COMMAND"
>iptables</B
>, all valid rules are accounting rules, and
any command that doesn't specify the <EM
>-j</EM
> option
performs accounting only.</P
><P
>The rule specification parameters for IP accounting are the same as
those used for IP firewall. These are what we use to define precisely
what network traffic we wish to count and total.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-ACCOUNTING.BY.ADDRESS"
>10.2.1. Accounting by Address</A
></H3
><P
>&#13;Let's work with an example to illustrate how we'd use IP accounting.</P
><P
>Imagine we have a Linux-based router that serves two departments
at the Virtual Brewery. The router has two Ethernet devices,
<TT
CLASS="FILENAME"
>eth0</TT
> and <TT
CLASS="FILENAME"
>eth1</TT
>, each of which
services a department; and a PPP device, <TT
CLASS="FILENAME"
>ppp0</TT
>, that
connects us via a high-speed serial link to the main campus of the
Groucho Marx University.</P
><P
>Let's also imagine that for billing purposes we want to know the total
traffic generated by each of the departments across the serial link, and
for management purposes we want to know the total traffic generated
between the two departments.</P
><P
>The following table shows the interface addresses we will use in our
example:</P
><P
><DIV
CLASS="INFORMALTABLE"
><P
></P
><A
NAME="AEN9319"
></A
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>iface</TH
><TH
>address</TH
><TH
>netmask</TH
></TR
></THEAD
><TBODY
><TR
><TD
>eth0</TD
><TD
>172.16.3.0</TD
><TD
>255.255.255.0</TD
></TR
><TR
><TD
>eth1</TD
><TD
>172.16.4.0</TD
><TD
>255.255.255.0</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></P
><P
>To answer the question, &#8220;How much data does each department
generate on the PPP link?&#8221;, we could use a rule that looks like
this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -A both -a -W ppp0 -S 172.16.3.0/24 -b</KBD
>
# <KBD
CLASS="USERINPUT"
>ipfwadm -A both -a -W ppp0 -S 172.16.4.0/24 -b</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -A input -i ppp0 -d 172.16.3.0/24</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -A output -i ppp0 -s 172.16.3.0/24</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -A input -i ppp0 -d 172.16.4.0/24</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -A output -i ppp0 -s 172.16.4.0/24</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

and with <B
CLASS="COMMAND"
>iptables</B
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -i ppp0 -d 172.16.3.0/24</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -o ppp0 -s 172.16.3.0/24</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -i ppp0 -d 172.16.4.0/24</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -o ppp0 -s 172.16.4.0/24</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>The first half of each of these set of rules say, &#8220;Count all data
traveling in either direction across the interface named ppp0 with a source
or destination (remember the function of the <EM
>-b</EM
> flag in
<B
CLASS="COMMAND"
>ipfwadm</B
> and <B
CLASS="COMMAND"
>iptables</B
>) address of
<TT
CLASS="LITERAL"
>172.16.3.0/24.</TT
>&#8221; The second half of each ruleset is
the same, but for the second Ethernet network at our site.</P
><P
>To answer the second question, &#8220;How much data travels between the
two departments?&#8221;, we need a rule that looks like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -A both -a -S 172.16.3.0/24 -D 172.16.4.0/24 -b</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -A forward -s 172.16.3.0/24 -d 172.16.4.0/24 -b</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -s 172.16.3.0/24 -d 172.16.4.0/24</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -s 172.16.4.0/24 -d 172.16.3.0/24</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

These rules will count all datagrams with a source address belonging
to one of the department networks and a destination address belonging
to the other.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-ACCOUNTING.BY.SERVICE"
>10.2.2. Accounting by Service Port</A
></H3
><P
>&#13;Okay, let's suppose we also want a better idea of exactly what sort of traffic
is being carried across our PPP link. We might, for example, want to know
how much of the link the FTP, smtp, and World Wide Web services are consuming.</P
><P
>A script of rules to enable us to collect this information might look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#!/bin/sh
# Collect FTP, smtp and www volume statistics for data carried on our
# PPP link using ipfwadm
#
ipfwadm -A both -a -W ppp0 -P tcp -S 0/0 ftp ftp-data
ipfwadm -A both -a -W ppp0 -P tcp -S 0/0 smtp
ipfwadm -A both -a -W ppp0 -P tcp -S 0/0 www</PRE
></FONT
></TD
></TR
></TABLE
>

or:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#!/bin/sh
# Collect ftp, smtp and www volume statistics for data carried on our
# PPP link using ipchains
#
ipchains -A input -i ppp0 -p tcp -s 0/0 ftp-data:ftp
ipchains -A output -i ppp0 -p tcp -d 0/0 ftp-data:ftp
ipchains -A input -i ppp0 -p tcp -s 0/0 smtp
ipchains -A output -i ppp0 -p tcp -d 0/0 smtp
ipchains -A input -i ppp0 -p tcp -s 0/0 www
ipchains -A output -i ppp0 -p tcp -d 0/0 www</PRE
></FONT
></TD
></TR
></TABLE
>

or:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#!/bin/sh
# Collect ftp, smtp and www volume statistics for data carried on our
# PPP link using iptables.
#
iptables -A FORWARD -i ppp0 -m tcp -p tcp --sport ftp-data:ftp
iptables -A FORWARD -o ppp0 -m tcp -p tcp --dport ftp-data:ftp
iptables -A FORWARD -i ppp0 -m tcp -p tcp --sport smtp
iptables -A FORWARD -o ppp0 -m tcp -p tcp --dport smtp
iptables -A FORWARD -i ppp0 -m tcp -p tcp --sport www
iptables -A FORWARD -o ppp0 -m tcp -p tcp --dport www</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>There are a couple of interesting features to this
configuration. Firstly, we've specified the protocol. When we specify
ports in our rules, we must also specify a protocol because TCP and UDP
provide separate sets of ports. Since all of these services are
TCB-based, we've specified it as the protocol.  Secondly, we've
specified the two services <TT
CLASS="LITERAL"
>ftp</TT
> and
<TT
CLASS="LITERAL"
>ftp-data</TT
> in one command. <B
CLASS="COMMAND"
>ipfwadm</B
>
allows you to specify single ports, ranges of ports, or arbitrary lists
of ports. The <B
CLASS="COMMAND"
>ipchains</B
> command allows either single
ports or ranges of ports, which is what we've used here. The syntax
"<TT
CLASS="LITERAL"
>ftp-data:ftp</TT
>" means "ports ftp-data (20) through
ftp (21)," and is how we encode ranges of ports in both
<B
CLASS="COMMAND"
>ipchains</B
> and <B
CLASS="COMMAND"
>iptables</B
>. When you
have a list of ports in an accounting rule, it means that any data
received for any of the ports in the list will cause the data to be
added to that entry's totals. Remembering that the FTP service uses
two ports, the command port and the data transfer port, we've added
them together to total the FTP traffic. Lastly, we've specified the
source address as &#8220;<TT
CLASS="LITERAL"
>0/0,</TT
>&#8221; which is
special notation that matches all addresses and is required by both
the <B
CLASS="COMMAND"
>ipfwadm</B
> and <B
CLASS="COMMAND"
>ipchains</B
>
commands in order to specify ports.</P
><P
>We can expand on the second point a little to give us a different view
of the data on our link. Let's now imagine that we class FTP, SMTP,
and World Wide Web traffic as essential traffic, and all other traffic
as nonessential. If we were interested in seeing the ratio of
essential traffic to nonessential traffic, we could do something like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -A both -a -W ppp0 -P tcp -S 0/0 ftp ftp-data smtp www</KBD
>
# <KBD
CLASS="USERINPUT"
>ipfwadm -A both -a -W ppp0 -P tcp -S 0/0 1:19 22:24 26:79 81:32767</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>If you have already examined your <TT
CLASS="FILENAME"
>/etc/services</TT
> file, you
will see that the second rule covers all ports except (<TT
CLASS="LITERAL"
>ftp</TT
>, <TT
CLASS="LITERAL"
>ftp-data</TT
>, <TT
CLASS="LITERAL"
>smtp</TT
>,
and <TT
CLASS="LITERAL"
>www</TT
>).</P
><P
>How do we do this with the <B
CLASS="COMMAND"
>ipchains</B
> or
<B
CLASS="COMMAND"
>iptables</B
> commands, since they allow only one argument in
their port specification? We can exploit user-defined chains in accounting
just as easily as in firewall rules. Consider the following approach:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -N a-essent</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -N a-noness</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -A a-essent -j ACCEPT</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -A a-noness -j ACCEPT</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -A forward -i ppp0 -p tcp -s 0/0 ftp-data:ftp -j a-essent</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -A forward -i ppp0 -p tcp -s 0/0 smtp -j a-essent</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -A forward -i ppp0 -p tcp -s 0/0 www -j a-essent</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -A forward -j a-noness</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

Here we create two user-defined chains, one called 
<TT
CLASS="LITERAL"
>a-essent</TT
>, where we capture accounting data for 
essential services and another called <TT
CLASS="LITERAL"
>a-noness</TT
>, where we 
capture accounting data for nonessential services. We then add rules to 
our forward chain that match our essential services and jump to the 
<TT
CLASS="LITERAL"
>a-essent</TT
> chain, where we have just one rule that accepts 
all datagrams and counts them. The last rule in our forward chain is a rule 
that jumps to our <TT
CLASS="LITERAL"
>a-noness</TT
> chain, where again we have just 
one rule that accepts all datagrams and counts them. The rule that jumps to the
<TT
CLASS="LITERAL"
>a-noness</TT
> chain will not be reached by any of our essential 
services, as they will have been accepted in their own chain. Our tallies for 
essential and nonessential services will therefore be available in the 
rules within those chains. This is just one approach you could take; there 
are others. Our <B
CLASS="COMMAND"
>iptables</B
> implementation of the same 
approach would look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>iptables -N a-essent</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -N a-noness</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A a-essent -j ACCEPT</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A a-noness -j ACCEPT</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -i ppp0 -m tcp -p tcp --sport ftp-data:ftp -j a-essent</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -i ppp0 -m tcp -p tcp --sport smtp -j a-essent</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -i ppp0 -m tcp -p tcp --sport www -j a-essent</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -j a-noness</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;
This looks simple enough. Unfortunately, there is a small but unavoidable
problem when trying to do accounting by service type. You will remember that
we discussed the role the MTU plays in TCP/IP networking in an earlier
chapter. The MTU defines the largest datagram that will be transmitted on
a network device. When a datagram is received by a router that is larger than
the MTU of the interface that needs to retransmit it, the router performs a
trick called <EM
>fragmentation</EM
>. The router breaks the large 
datagram into small pieces no longer than the MTU of the interface and then 
transmits these pieces. The router builds new headers to put in front of each 
of these pieces, and these are what the remote machine uses to reconstruct the
original data. Unfortunately, during the fragmentation process the port
is lost for all but the first fragment. This means that the IP accounting
can't properly count fragmented datagrams. It can reliably count only
the first fragment, or unfragmented datagrams. There is a small trick permitted
by <B
CLASS="COMMAND"
>ipfwadm</B
> that ensures that while we won't be able to know
exactly what port the second and later fragments were from, we can still
count them.  An early version of Linux accounting software assigned
the fragments a fake port number, 0xFFFF, that we could count. To ensure that
we capture the second and later fragments, we could use a rule like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -A both -a -W ppp0 -P tcp -S 0/0 0xFFFF</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The IP chains implementation has a slightly more sophisticated solution, but
the result is much the same. If using the <B
CLASS="COMMAND"
>ipchains</B
> command
we'd instead use:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -A forward -i ppp0 -p tcp -f</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

and with <B
CLASS="COMMAND"
>iptables</B
> we'd use:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -i ppp0 -m tcp -p tcp -f</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>These won't tell us what the original port for this data was, but at least we are able to see how much of our data is fragments, and be able to account
for the volume of traffic they consume.</P
><P
>In 2.2 kernels you can select a kernel compile-time option that
negates this whole issue if your Linux machine is acting as the single
access point for a network. If you enable the <CODE
CLASS="OPTION"
>IP:
always defragment</CODE
> option when you compile your
kernel, all received datagrams will be reassembled by the Linux router
before routing and retransmission. This operation is performed before
the firewall and accounting software sees the datagram, and thus you
will have no fragments to deal with. In 2.4 kernels you compile and
load the <EM
>netfilter</EM
>
<TT
CLASS="FILENAME"
>forward-fragment</TT
> module.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-ACCOUNTING.OF.ICMP"
>10.2.3. Accounting of ICMP Datagrams</A
></H3
><P
>&#13;

The ICMP protocol does not use service port numbers and is therefore a little
bit more difficult to collect details on. ICMP uses a number of different
types of datagrams. Many of these are harmless and normal, while others
should only be seen under special circumstances. Sometimes people with too
much time on their hands attempt to maliciously disrupt the network
access of a user by generating large numbers of ICMP messages. This is
commonly called <EM
>ping flooding</EM
>. While IP accounting 
cannot do anything to prevent this problem (IP firewalling can help, though!) 
we can at least put accounting rules in place that will show us if anybody 
has been trying.</P
><P
>ICMP doesn't use ports as TCP and UDP do. Instead ICMP has ICMP message
types. We can build rules to account for each ICMP message type. To do this,
we place the ICMP message and type number in place of the port field in the
<B
CLASS="COMMAND"
>ipfwadm</B
> accounting commands. We listed the ICMP message
types in <A
HREF="#X-087-2-FIREWALL.IPFWADM.ICMP-TYPES"
>Section 9.6.3.5</A
>,&#8221; so refer to it
if you need to remember what they are.</P
><P
>An IP accounting rule to collect information about the volume of ping data
that is being sent to you or that you are generating might look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -A both -a -P icmp -S 0/0 8</KBD
>
# <KBD
CLASS="USERINPUT"
>ipfwadm -A both -a -P icmp -S 0/0 0</KBD
>
# <KBD
CLASS="USERINPUT"
>ipfwadm -A both -a -P icmp -S 0/0 0xff</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or, with <B
CLASS="COMMAND"
>ipchains</B
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -A forward -p icmp -s 0/0 8</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -A forward -p icmp -s 0/0 0</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -A forward -p icmp -s 0/0 -f</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or, with <B
CLASS="COMMAND"
>iptables</B
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -m icmp -p icmp --sports echo-request</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -m icmp -p icmp --sports echo-reply</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -m icmp -p icmp -f</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

The first rule collects information about the
&#8220;ICMP Echo Request&#8221; datagrams (ping requests), and the
second rule collects information about the &#8220;ICMP Echo Reply&#8221;
datagrams (ping replies). The third rule collects information about ICMP
datagram fragments. This is a trick similar to that described for fragmented
TCP and UDP datagrams.</P
><P
>If you specify source and/or destination addresses in your rules, you can
keep track of where the pings are coming from, such as whether they originate
inside or outside your network. Once you've determined where the rogue
datagrams are coming from, you can decide whether you want to put firewall
rules in place to prevent them or take some other action, such as
contacting the owner of the offending network to advise them of the problem,
or perhaps even legal action if the problem is a malicious act.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-ACCOUNTING.BY.PROTOCOL"
>10.2.4. Accounting by Protocol</A
></H3
><P
>&#13;Let's now imagine that we are interested in knowing how much of the
traffic on our link is TCP, UDP, and ICMP. We would use rules like
the following:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -A both -a -W ppp0 -P tcp -D 0/0</KBD
>
# <KBD
CLASS="USERINPUT"
>ipfwadm -A both -a -W ppp0 -P udp -D 0/0</KBD
>
# <KBD
CLASS="USERINPUT"
>ipfwadm -A both -a -W ppp0 -P icmp -D 0/0</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -A forward -i ppp0 -p tcp -d 0/0</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -A forward -i ppp0 -p udp -d 0/0</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -A forward -i ppp0 -p icmp -d 0/0</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -i ppp0 -m tcp -p tcp</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -o ppp0 -m tcp -p tcp</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -i ppp0 -m udp -p udp</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -o ppp0 -m udp -p udp</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -i ppp0 -m icmp -p icmp</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -A FORWARD -o ppp0 -m icmp -p icmp</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

With these rules in place, all of the traffic flowing across the
<TT
CLASS="LITERAL"
>ppp0</TT
> interface will be analyzed to determine
whether it is TCP, UDP, or IMCP traffic, and the appropriate counters will
be updated for each. The <B
CLASS="COMMAND"
>iptables</B
> example splits incoming
flow from outgoing flow as its syntax demands it.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-ACCOUNTING.VIEWING.RESULTS"
>10.3. Using IP Accounting Results</A
></H2
><P
>&#13;It is all very well to be collecting this information, but how do we
actually get to see it? To view the collected accounting data and the
configured accounting rules, we use our firewall configuration
commands, asking them to list our rules. The packet and byte counters
for each of our rules are listed in the output.</P
><P
>The <B
CLASS="COMMAND"
>ipfwadm</B
>, <B
CLASS="COMMAND"
>ipchains</B
>, and
<B
CLASS="COMMAND"
>iptables</B
> commands differ in how accounting data is handled,
so we will treat them independently.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN9511"
>10.3.1. Listing Accounting Data with ipfwadm</A
></H3
><P
>&#13;The most basic means of listing our accounting data with the
<B
CLASS="COMMAND"
>ipfwadm</B
> command is to use it like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -A -l</KBD
>
IP accounting rules
 pkts bytes dir prot source               destination          ports
 9833 2345K i/o all  172.16.3.0/24      anywhere             n/a
56527   33M i/o all  172.16.4.0/24      anywhere             n/a</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This will tell us the number of packets sent in each direction. If we use 
the extended output format with the <CODE
CLASS="OPTION"
>-e</CODE
> option (not shown here because the 
output is too wide for the page), we are also supplied the options and
applicable interface names. Most of the fields in the output will be 
self-explanatory, but the following may not:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>dir</DT
><DD
><P
>The direction in which the rule applies. Expected values here are
<TT
CLASS="LITERAL"
>in</TT
>, <TT
CLASS="LITERAL"
>out</TT
>,
or <TT
CLASS="LITERAL"
>i/o</TT
>, meaning both ways.</P
></DD
><DT
>prot</DT
><DD
><P
>The protocols to which the rule applies.</P
></DD
><DT
>opt</DT
><DD
><P
>A coded form of the options we use when invoking
<B
CLASS="COMMAND"
>ipfwadm</B
>. </P
></DD
><DT
>ifname</DT
><DD
><P
>The name of the interface to which the rule applies.</P
></DD
><DT
>ifaddress</DT
><DD
><P
>The address of the interface to which the rule applies.</P
></DD
></DL
></DIV
><P
>By default, <B
CLASS="COMMAND"
>ipfwadm</B
> displays the packet and byte
counts in a shortened form, rounded to the nearest thousand (K) or million
(M). We can ask it to display the collected data in exact units by using the
expanded option as follows:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -A -l -e -x</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN9551"
>10.3.2. Listing Accounting Data with ipchains</A
></H3
><P
>&#13;The <B
CLASS="COMMAND"
>ipchains</B
> command will not display our accounting data
(packet and byte counters) unless we supply it the <TT
CLASS="LITERAL"
>-v</TT
>
argument. The simplest means of listing our accounting data with the
<B
CLASS="COMMAND"
>ipchains</B
> is to use it like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -L -v</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Again, just as with <B
CLASS="COMMAND"
>ipfwadm</B
>, we can display the packet and
byte counters in units by using the expanded output mode. The
<B
CLASS="COMMAND"
>ipchains</B
> uses the <TT
CLASS="LITERAL"
>-x</TT
> argument for this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -L -v -x</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN9568"
>10.3.3. Listing Accounting Data with iptables</A
></H3
><P
>&#13;The <B
CLASS="COMMAND"
>iptables</B
> command behaves very similarly to the
<B
CLASS="COMMAND"
>ipchains</B
> command. Again, we must use the <TT
CLASS="LITERAL"
>-v</TT
>
when listing tour rules to see the accounting counters. To list our accounting
data, we would use:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>iptables -L -v</KBD
></PRE
></FONT
></TD
></TR
></TABLE
><P
>Just as for the <B
CLASS="COMMAND"
>ipchains</B
> command, you can use the 
<TT
CLASS="LITERAL"
>-x</TT
> argument to show the output in expanded
format with unit figures.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-ACCOUNTING.ZEROING.COUNTER"
>10.4. Resetting the Counters</A
></H2
><P
>&#13;The IP accounting counters will overflow if you leave them long enough.
If they overflow, you will have difficulty determining the
value they actually represent. To avoid this problem, you should read
the accounting data periodically, record it, and then reset the counters
back to zero to begin collecting accounting information for the next
accounting interval.</P
><P
>The <B
CLASS="COMMAND"
>ipfwadm</B
> and <B
CLASS="COMMAND"
>ipchains</B
> commands provide
you with a means of doing this quite simply:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -A -z</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -Z</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>iptables -Z</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

You can even combine the list and zeroing actions together to ensure that
no accounting data is lost in between:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -A -l -z</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -L -Z</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>iptables -L -Z -v</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

These commands will first list the accounting data and then immediately
zero the counters and begin counting again. If you are interested in
collecting and using this information regularly, you would probably want to
put this command into a script that recorded the output and stored it
somewhere, and execute the script periodically using the
<B
CLASS="COMMAND"
>cron</B
> command.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-ACCOUNTING.FLUSHING.RULES"
>10.5. Flushing the Ruleset</A
></H2
><P
>&#13;One last command that might be useful allows you to flush all the IP
accounting rules you have configured. This is most useful when you want to
radically alter your ruleset without rebooting the machine.</P
><P
>The <TT
CLASS="LITERAL"
>-f</TT
> argument in combination with the
<B
CLASS="COMMAND"
>ipfwadm</B
> command will flush all of the rules of the type
you specify. <B
CLASS="COMMAND"
>ipchains</B
> supports the <TT
CLASS="LITERAL"
>-F</TT
>
argument, which does the same:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -A -f</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -F</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>iptables -F</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

This flushes all of your configured IP accounting rules, removing them all
and saving you having to remove each of them individually. Note that flushing
the rules with <B
CLASS="COMMAND"
>ipchains</B
> does not cause any user-defined
chains to be removed, only the rules within them.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-ACCOUNTING.PASSIVE.COLLECTION"
>10.6. Passive Collection of Accounting Data</A
></H2
><P
>&#13;One last trick you might like to consider: if your Linux machine is
connected to an Ethernet, you can apply accounting rules to all of the data
from the segment, not only that which it is transmitted by or destined for it.
Your machine will passively listen to all of the data on the segment and
count it.</P
><P
>You should first turn IP forwarding off on your Linux machine so
that it doesn't try to route the datagrams it
receives.<A
NAME="X-087-2-FNAC01"
HREF="#FTN.X-087-2-FNAC01"
><SPAN
CLASS="footnote"
>[65]</SPAN
></A
>
In the 2.0.36 and 2.2 kernels, this is a matter of:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>echo 0 &#62;/proc/sys/net/ipv4/ip_forward</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;You should then enable promiscuous mode on your Ethernet interface using the
<B
CLASS="COMMAND"
>ifconfig</B
> command. Now you can establish accounting
rules that allow you to collect information about the datagrams flowing
across your Ethernet without involving your Linux in the route at all.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-IPMASQ"
></A
>Chapter 11. IP Masquerade and Network Address Translation</H1
><P
>You don't have to have a good memory to remember a time when only large
organizations could afford to have a number of computers networked together
by a LAN. Today network technology has dropped so much in
price that two things have happened. First, LANs are now
commonplace, even in many household environments. Certainly many Linux
users will have two or more computers connected by some Ethernet. 
Second, network resources, particularly IP addresses, are now
a scarce resource and while they used to be free, they are now being bought 
and sold.</P
><P
>Most people with a LAN will probably also want an Internet
connection that every computer on the LAN can use. The IP routing rules
are quite strict in how they deal with this situation. Traditional solutions
to this problem would have involved requesting an IP network address, perhaps
a class C address for small sites, assigning each host on the LAN an
address from this network and using a router to connect the LAN to the
Internet.</P
><P
>In a commercialized Internet environment, this is quite an
expensive proposition. First, you'd be required to pay for the network
address that is assigned to you. Second, you'd probably have to pay your
Internet Service Provider for the privilege of having a suitable route
to your network put in place so that the rest of the Internet knows how to
reach you. This might still be practical for companies, but domestic
installations don't usually justify the cost.</P
><P
>&#13;Fortunately, Linux provides an answer to this dilemma.
This answer involves a component of a group of advanced networking features
called <EM
>Network Address Translation</EM
> (NAT).
NAT describes the process of modifying the network 
addresses contained with datagram headers while they are in transit. This 
might sound odd at first, but we'll show that it is ideal for solving 
the problem we've just described and many have encountered. IP masquerade 
is the name given to one type of network address translation
that allows all of the hosts on a private network to use the Internet at the
price of a single IP address.</P
><P
>&#13;
IP masquerading allows you to use a private (reserved) IP network
address on your LAN and have your Linux-based router perform some
clever, real-time translation of IP addresses and ports. When it
receives a datagram from a computer on the LAN, it takes note of the
type of datagram it is, &#8220;TCP,&#8221; &#8220;UDP,&#8221;
&#8220;ICMP,&#8221; etc., and modifies the datagram so that it looks
like it was generated by the router machine itself (and remembers that
it has done so). It then transmits the datagram onto the Internet with
its single connected IP address. When the destination host receives
this datagram, it believes the datagram has come from the routing
host and sends any reply datagrams back to that address.  When the
Linux masquerade router receives a datagram from its Internet
connection, it looks in its table of established masqueraded
connections to see if this datagram actually belongs to a computer on
the LAN, and if it does, it reverses the modification it did on the
forward path and transmits the datagram to the LAN computer.</P
><P
>A simple example is illustrated in <A
HREF="#X-087-2-MASQUERADE.NET"
>Figure 11-1</A
>.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-MASQUERADE.NET"
></A
><P
><B
>Figure 11-1. A typical IP masquerade configuration</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_1101.jpg"></P
></DIV
></DIV
><P
>We have a small Ethernet network using one of the reserved network addresses.
The network has a Linux-based masquerade router providing access to the
Internet. One of the workstations on the network (192.168.1.3) wishes to
establish a connection to the remote host 209.1.106.178 on port 8888. The
workstation routes its datagram to the masquerade router, which identifies
this connection request as requiring masquerade services. It accepts the
datagram and allocates a port number to use (1035), substitutes its own
IP address and port number for those of the originating host, and transmits
the datagram to the destination host. The destination host believes it has
received a connection request from the Linux masquerade host and generates
a reply datagram. The masquerade host, upon receiving this datagram,
finds the association in its masquerade table and reverses the substution
it performed on the outgoing datagram. It then transmits the reply datagram
to the originating host.</P
><P
>The local host believes it is speaking directly to the remote host. The
remote host knows nothing about the local host at all and believes it has
received a connection from the Linux masquerade host. The Linux masquerade
host knows these two hosts are speaking to each other, and on what ports,
and performs the address and port translations necessary to allow
communication.</P
><P
>This might all seem a little confusing, and it can be, but it works and
is really quite simple to configure. So don't worry if you don't understand 
all the details yet.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-MASQ.SIDE.EFFECTS"
>11.1. Side Effects and Fringe Benefits</A
></H2
><P
>&#13;The IP masquerade facility comes with its own set of side effects, some of
which are useful and some of which might become bothersome.</P
><P
>None of the hosts on the supported network behind the masquerade router
are ever directly seen; consequently, you need only one valid and
routable IP address to allow all hosts to make network connections out
onto the Internet. This has a downside; none of those hosts are
visible from the Internet and you can't directly connect to them from
the Internet; the only host visible on a masqueraded network is the
masquerade machine itself. This is important when you consider
services such as mail or FTP. It helps determine what services should
be provided by the masquerade host and what services it should proxy
or otherwise treat specially.</P
><P
>Second, because none of the masqueraded hosts are visible, they are relatively
protected from attacks from outside; this could simplify or even remove
the need for firewall configuration on the masquerade host. You shouldn't rely
too heavily on this, though. Your whole network will be only as safe as
your masquerade host, so you should use firewall to protect it if security is 
a concern.</P
><P
>Third, IP masquerade will have some impact on the performance of your
networking. In typical configurations this will probably be barely measurable.
If you have large numbers of active masquerade sessions, though, you may find
that the processing required at the masquerade machine begins to impact 
your network throughput. IP masquerade must do a good deal of work for 
each datagram compared to the process of conventional routing. That
386SX16 machine you have been planning on using as a masquerade machine
supporting a dial-up link to the Internet might be fine, but don't expect
too much if you decide you want to use it as a router in your corporate
network at Ethernet speeds.</P
><P
>Last, some network services just won't work through masquerade, or at least
not without a lot of help. Typically, these are services that rely on incoming
sessions to work, such as some types of Direct Communications Channels (DCC), 
features in IRC, or certain types of video and audio multicasting services. 
Some of these services have specially developed kernel modules to provide 
solutions for these, and we'll talk about those in a moment. For others, it 
is possible that you will find no support, so be aware,it won't be suitable 
in all situations.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-MASQ.KERNEL.CONFIG"
>11.2. Configuring the Kernel for IP Masquerade</A
></H2
><P
>&#13;



To use the IP masquerade facility, your kernel must be compiled with masquerade
support. You must select the following options when configuring a 2.2 series
kernel:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Networking options  ---&#62;
	[*] Network firewalls
	[*] TCP/IP networking
	[*] IP: firewalling
	[*] IP: masquerading
	--- Protocol-specific masquerading support will be built as modules.
	[*] IP: ipautofw masq support
	[*] IP: ICMP masquerading</PRE
></FONT
></TD
></TR
></TABLE
>

Note that some of the masquerade support is available only as a kernel module.
This means that you must ensure that you
&#8220;<TT
CLASS="LITERAL"
>make modules</TT
>&#8221; in addition to the usual
&#8220;<TT
CLASS="LITERAL"
>make zImage</TT
>&#8221; when building
your kernel.</P
><P
>&#13;The 2.4 series kernels no longer offer IP masquerade support as a kernel
compile time option. Instead, you should select the network packet
filtering option:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Networking options  ---&#62;
    [M] Network packet filtering (replaces ipchains)</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>In the 2.2 series kernels, a number of protocol-specific helper
modules are created during kernel compilation. Some protocols begin with
an outgoing request on one port, and then expect an incoming connection on
another. Normally these cannot be masqueraded, as there is no way of associating
the second connection with the first without peering inside the protocols
themselves. The helper modules do just that; they actually look inside the
datagrams and allow masquerading to work for supported protocols that
otherwise would be impossible to masquerade. The supported protocols are:

<DIV
CLASS="INFORMALTABLE"
><P
></P
><A
NAME="AEN9708"
></A
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><THEAD
><TR
><TH
>Module</TH
><TH
>Protocol</TH
></TR
></THEAD
><TBODY
><TR
><TD
>ip_masq_ftp</TD
><TD
>FTP</TD
></TR
><TR
><TD
>ip_masq_irc</TD
><TD
>IRC</TD
></TR
><TR
><TD
>ip_masq_raudio</TD
><TD
>RealAudio</TD
></TR
><TR
><TD
>ip_masq_cuseeme</TD
><TD
>CU-See-Me</TD
></TR
><TR
><TD
>ip_masq_vdolive</TD
><TD
>For VDO Live</TD
></TR
><TR
><TD
>ip_masq_quake</TD
><TD
>IdSoftware's Quake</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
>

You must load these modules manually using the <B
CLASS="COMMAND"
>insmod</B
> 
command to implement them. Note that these modules cannot be loaded using
the <B
CLASS="COMMAND"
>kerneld</B
> daemon. Each of the modules takes an argument
specifying what ports it will listen on. For the
RealAudio&#8482; module you might use:<A
NAME="X-087-2-MQ01"
HREF="#FTN.X-087-2-MQ01"
><SPAN
CLASS="footnote"
>[66]</SPAN
></A
>
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>insmod ip_masq_raudio.o ports=7070,7071,7072</KBD
>           </PRE
></FONT
></TD
></TR
></TABLE
>

The ports you need to specify depend on the protocol. An IP masquerade
mini-HOWTO written by Ambrose Au explains more about the IP masquerade modules
and how to configure them.<A
NAME="X-087-2-FNMQ02"
HREF="#FTN.X-087-2-FNMQ02"
><SPAN
CLASS="footnote"
>[67]</SPAN
></A
></P
><P
>The <EM
>netfilter</EM
> package includes modules that perform
similar functions. For example, to provide connection tracking of FTP
sessions, you'd load and use the <TT
CLASS="FILENAME"
>ip_conntrack_&#8201;ftp</TT
> and
<TT
CLASS="FILENAME"
>ip_nat_&#8201;ftp.o</TT
> modules.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-MASQ.CONFIGURATION"
>11.3. Configuring IP Masquerade</A
></H2
><P
>&#13;



If you've already read the firewall and accounting chapters, it
probably comes as no surprise that the <B
CLASS="COMMAND"
>ipfwadm</B
>,
<B
CLASS="COMMAND"
>ipchains</B
>, and <B
CLASS="COMMAND"
>iptables</B
> commands
are used to configure the IP masquerade rules as well.</P
><P
>Masquerade rules are a special class of filtering rule. You can
masquerade only datagrams that are received on one interface that will
be routed to another interface. To configure a masquerade rule you
construct a rule very similar to a firewall forwarding rule, but with
special options that tell the kernel to masquerade the datagram. The
<B
CLASS="COMMAND"
>ipfwadm</B
> command uses the <EM
>-m</EM
>
option, <B
CLASS="COMMAND"
>ipchains</B
> uses <TT
CLASS="LITERAL"
>-j MASQ</TT
>, and <B
CLASS="COMMAND"
>iptables</B
> uses
<TT
CLASS="LITERAL"
>-j MASQUERADE</TT
> to
indicate that datagrams matching the rule specification should be
masqueraded.</P
><P
>Let's look at an example.
A computing science student at Groucho Marx University has a number of
computers at home internetworked onto a small Ethernet-based local area
network. She has chosen to use one of the reserved private Internet network
addresses for her network. She shares her accomodation with other students,
all of whom have an interest in using the Internet. Because student living 
conditions are very frugal, they cannot afford to use a permanent Internet 
connection, so instead they use a simple dial-up PPP Internet connection. 
They would all like to be able
to share the connection to chat on IRC, surf 
the Web, and retrieve files by FTP directly to each of their computers&#8212;IP 
masquerade is the answer.</P
><P
>The student first configures a Linux machine to support the dial-up link and to
act as a router for the LAN. The IP address she is assigned when she dials up
isn't important. She configures the Linux router with IP masquerade and uses 
one of the private network addresses for her LAN: 
<TT
CLASS="LITERAL"
>192.168.1.0</TT
>. She ensures that each of the hosts on the 
LAN has a default route pointing at the Linux router.</P
><P
>The following <B
CLASS="COMMAND"
>ipfwadm</B
> commands are all that are required to
make masquerading work in her configuration:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -F -p deny</KBD
>
# <KBD
CLASS="USERINPUT"
>ipfwadm -F -a accept -m -S 192.168.1.0/24 -D 0/0</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or with <B
CLASS="COMMAND"
>ipchains</B
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipchains -P forward -j deny</KBD
>
# <KBD
CLASS="USERINPUT"
>ipchains -A forward -s 192.168.1.0/24 -d 0/0 -j MASQ</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

or with <B
CLASS="COMMAND"
>iptables</B
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>iptables -t nat -P POSTROUTING DROP</KBD
>
# <KBD
CLASS="USERINPUT"
>iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE</KBD
> </PRE
></FONT
></TD
></TR
></TABLE
>

Now whenever any of the LAN hosts try to connect to a service on a
remote host, their datagrams will be automatically masqueraded by the
Linux masquerade router. The first rule in each example prevents the
Linux machine from routing any other datagrams and also adds some
security.</P
><P
>&#13;To list the masquerade rules you have created, use the <TT
CLASS="LITERAL"
>-l</TT
> 
argument to the <B
CLASS="COMMAND"
>ipfwadm</B
>
command, as we described in earlier while discussing firewalls.</P
><P
>To list the rule we created earlier we use:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -F -l -e</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

which should display something like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipfwadm -F -l -e</KBD
>
IP firewall forward rules, default policy: accept
 pkts bytes type  prot opt  tosa tosx ifname  ifaddress  &#8230;
    0     0 acc/m all  ---- 0xFF 0x00 any     any        &#8230;</PRE
></FONT
></TD
></TR
></TABLE
>

The &#8220;<TT
CLASS="LITERAL"
>/m</TT
>&#8221; in the output indicates this is a
masquerade rule.</P
><P
>To list the masquerade rules with the <B
CLASS="COMMAND"
>ipchains</B
> command, 
use the <B
CLASS="COMMAND"
>-L</B
> argument. If we list the rule
we created earlier with <B
CLASS="COMMAND"
>ipchains</B
>, the output will look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
># ipchains -L</KBD
>
Chain input (policy ACCEPT):
Chain forward (policy ACCEPT):
target     prot opt     source                destination           ports
MASQ       all  ------  192.168.1.0/24        anywhere              n/a

Chain output (policy ACCEPT):</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Any rules with a target of <TT
CLASS="LITERAL"
>MASQ</TT
> are masquerade rules.</P
><P
>Finally, to list the rules using <B
CLASS="COMMAND"
>iptables</B
> you need to use:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>iptables -t nat -L</KBD
>
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination         

Chain POSTROUTING (policy DROP)
target     prot opt source               destination         
MASQUERADE  all  --  anywhere             anywhere           MASQUERADE 

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         </PRE
></FONT
></TD
></TR
></TABLE
>

Again, masquerade rules appear with a target of <TT
CLASS="LITERAL"
>MASQUERADE</TT
>.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-MASQ.SETTING.TIMING"
>11.3.1. Setting Timing Parameters for IP Masquerade</A
></H3
><P
>&#13;When each new connection is established, the IP masquerade software
creates an association in memory between each of the hosts involved in
the connection.  You can view these associations at any time by
looking at the <TT
CLASS="FILENAME"
>/proc/net/ip_masquerade</TT
> file.
These associations will timeout after a period of inactivity, though.</P
><P
>&#13;You can set the timeout values using the <B
CLASS="COMMAND"
>ipfwadm</B
> command.
The general syntax for this is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ipfwadm -M -s &#60;<TT
CLASS="REPLACEABLE"
><I
>tcp</I
></TT
>&#62; &#60;<TT
CLASS="REPLACEABLE"
><I
>tcpfin</I
></TT
>&#62; &#60;<TT
CLASS="REPLACEABLE"
><I
>udp</I
></TT
>&#62;</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;and for the <B
CLASS="COMMAND"
>ipchains</B
> command it is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ipchains -M -S &#60;<TT
CLASS="REPLACEABLE"
><I
>tcp</I
></TT
>&#62; &#60;<TT
CLASS="REPLACEABLE"
><I
>tcpfin</I
></TT
>&#62; &#60;<TT
CLASS="REPLACEABLE"
><I
>udp</I
></TT
>&#62;</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <EM
>iptables</EM
> implementation uses much longer default
timers and does not allow you to set them.</P
><P
>Each of these values represents a timer used by the IP masquerade software and
are in units of seconds. The following table summarizes the timers and their
meanings:</P
><DIV
CLASS="INFORMALTABLE"
><P
></P
><A
NAME="AEN9839"
></A
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL
WIDTH="4"><THEAD
><TR
><TH
>Name</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
>tcp</TD
><TD
><P
>	TCP session timeout. How long a TCP connection may remain idle before the
	association for it is removed.
	</P
></TD
></TR
><TR
><TD
>tcpfin</TD
><TD
><P
>        
	TCP timeout after FIN. How long an association will remain
	after a TCP connection has been disconnected.
	</P
></TD
></TR
><TR
><TD
>udp</TD
><TD
><P
>	UDP session timeout. How long a UDP connection may remain idle before the
	association for it is removed.
	</P
></TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-MASQ.NAMELOOKUPS"
>11.4. Handling Name Server Lookups</A
></H2
><P
>&#13;
Handling domain name server lookups from the hosts on the LAN with IP
masquerading has always presented a problem. There are two ways of
accomodating DNS in a masquerade environment. You can tell each of the
hosts that they use the same DNS that the Linux router machine does,
and let IP masquerade do its magic on their DNS
requests. Alternatively, you can run a caching name server on the
Linux machine and have each of the hosts on the LAN use the Linux
machine as their DNS. Although a more aggressive action, this is
probably the better option because it reduces the volume of DNS
traffic travelling on the Internet link and will be marginally faster
for most requests, since they'll be served from the cache. The downside
to this configuration is that it is more complex. <A
HREF="#X-087-2-RESOLV.NAMED-CACHINGONLY"
>Section 6.3.4</A
>,&#8221; in Chapter 6, describes how to configure
a caching name server.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN9869"
>11.5. More About Network Address Translation</A
></H2
><P
>&#13;The <EM
>netfilter</EM
> software is capable of many different types
of Network Address Translation. IP Masquerade is one simple application of it.</P
><P
>It is possible, for example, to build NAT rules that translate only certain
addresses or ranges of addresses and leave all others untouched, or to
translate addresses into pools of addresses rather than just a single address,
as masquerade does. You can in fact use the <B
CLASS="COMMAND"
>iptables</B
> command
to generate NAT rules that map just about anything, with
combinations of matches using any of the standard attributes, such as source
address, destination address, protocol type, port number, etc.</P
><P
>&#13;Translating the Source Address of a datagram is referred to as &#8220;Source
NAT,&#8221; or <TT
CLASS="LITERAL"
>SNAT</TT
>, in the <EM
>netfilter</EM
>
documentation. Translating the Destination Address of a datagram is known as
&#8220;Destination NAT,&#8221; or <TT
CLASS="LITERAL"
>DNAT</TT
>. Translating the TCP
or UDP port is known by the term <TT
CLASS="LITERAL"
>REDIRECT</TT
>. 
<TT
CLASS="LITERAL"
>SNAT</TT
>, <TT
CLASS="LITERAL"
>DNAT</TT
>, and
<TT
CLASS="LITERAL"
>REDIRECT</TT
> are targets that you may use with the
<B
CLASS="COMMAND"
>iptables</B
> command to build more complex and sophisticated
rules.</P
><P
>&#13;
The topic of Network Address Translation and its uses warrants at least a
whole chapter of its own.<A
NAME="AEN9893"
HREF="#FTN.AEN9893"
><SPAN
CLASS="footnote"
>[68]</SPAN
></A
> Unfortunately we don't have the space in this book to cover it in
any greater depth. You should read the IPTABLES-HOWTO for more information, if
you're interested in discovering more about how you might use Network Address 
Translation.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-APPL"
></A
>Chapter 12. ImportantNetwork Features</H1
><P
>After successfully setting up IP and the resolver, you then must look at
the services you want to provide over the network. This chapter covers the
configuration of a few simple network applications, including the
<B
CLASS="COMMAND"
>inetd</B
> server and the programs from the
<B
CLASS="COMMAND"
>rlogin</B
> family. We'll also deal briefly with the Remote
Procedure Call interface, upon which services like the Network File System (NFS)
and the Network Information System (NIS) are based. The configuration of
NFS and NIS, however, is more complex and are described in separate
chapters, as are electronic mail and network news.</P
><P
>Of course, we can't cover all network applications in this book. If you
want to install one that's not discussed here, like <B
CLASS="COMMAND"
>talk</B
>,
<B
CLASS="COMMAND"
>gopher</B
>, or <B
CLASS="COMMAND"
>http</B
>, please refer to
the manual pages of the server for details.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-APPL.INETD"
>12.1. The inetd Super Server</A
></H2
><P
>Programs that provide application services via the network are called
network <EM
>daemons</EM
>. A daemon is a program that opens a
port, most commonly a well-known service port, and waits for incoming
connections on it. If one occurs, the daemon creates a child process that 
accepts the connection, while the parent continues to listen for further
requests. This mechanism works well, but has a few disadvantages; at
least one instance of every possible service you wish to provide must be
active in memory at all times. In addition, the software routines that 
do the listening and port handling must be replicated in every network daemon.</P
><P
>To overcome these inefficiencies, most Unix installations run a special
network daemon, what you might consider a &#8220;super server.&#8221; This
daemon creates sockets on behalf of a number of services and listens on
all of them simultaneously. When an incoming connection is received on
any of these sockets, the super server accepts the connection and spawns
the server specified for this port, passing the socket across to the child
to manage. The server then returns to listening.</P
><P
>&#13;

The most common super server is called <B
CLASS="COMMAND"
>inetd</B
>,
the Internet Daemon. It is started at system boot time and takes the list
of services it is to manage from a startup file named
<TT
CLASS="FILENAME"
>/etc/inetd.conf</TT
>. In addition to those servers,
there are a number of trivial services performed by <B
CLASS="COMMAND"
>inetd</B
>
itself called <EM
>internal services</EM
>. They include
<B
CLASS="COMMAND"
>chargen</B
>, which simply generates a string of characters,
and <B
CLASS="COMMAND"
>daytime</B
>, which returns the system's idea of the time
of day.</P
><P
>An entry in this file consists of a single line made up of the
following fields:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="REPLACEABLE"
><I
>service</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>type</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>protocol</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>wait</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>user</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>server</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>cmdline</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Each of the fields is described in the following list:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>service</I
></TT
></DT
><DD
><P
>Gives the service name. The service name has to be translated to a port
number by looking it up in the <TT
CLASS="FILENAME"
>/etc/services</TT
> file. This
file will be described later in this chapter in the section <A
HREF="#X-087-2-APPL.SERVICES"
>Section 12.3</A
>.&#8221;</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>type</I
></TT
></DT
><DD
><P
>Specifies a socket type, either <SPAN
CLASS="SYSTEMITEM"
>stream</SPAN
>
(for connection-oriented protocols) or
<SPAN
CLASS="SYSTEMITEM"
>dgram</SPAN
> (for datagram protocols).
TCP-based services should therefore always use
<SPAN
CLASS="SYSTEMITEM"
>stream</SPAN
>, while UDP-based services
should always use <SPAN
CLASS="SYSTEMITEM"
>dgram</SPAN
>.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>protocol</I
></TT
></DT
><DD
><P
>Names the transport protocol used by the service. This must be a valid
protocol name found in the <TT
CLASS="FILENAME"
>protocols</TT
> file, explained
later.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>wait</I
></TT
></DT
><DD
><P
>This option applies only to <SPAN
CLASS="SYSTEMITEM"
>dgram</SPAN
>
sockets. It can be either <SPAN
CLASS="SYSTEMITEM"
>wait</SPAN
> or
<SPAN
CLASS="SYSTEMITEM"
>nowait</SPAN
>. If
<SPAN
CLASS="SYSTEMITEM"
>wait</SPAN
> is specified,
<B
CLASS="COMMAND"
>inetd</B
> executes only one server for the specified
port at any time. Otherwise, it immediately continues to listen on
the port after executing the server.</P
><P
>This is useful for &#8220;single-threaded&#8221; servers that read all
incoming datagrams until no more arrive, and then exit. Most RPC servers
are of this type and should therefore specify
<SPAN
CLASS="SYSTEMITEM"
>wait</SPAN
>. The opposite type,
&#8220;multi-threaded&#8221; servers, allow an unlimited number of
instances to run concurrently. These servers should specify
<SPAN
CLASS="SYSTEMITEM"
>nowait</SPAN
>.</P
><P
><SPAN
CLASS="SYSTEMITEM"
>stream</SPAN
> sockets should always use
<SPAN
CLASS="SYSTEMITEM"
>nowait</SPAN
>.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>user</I
></TT
></DT
><DD
><P
>This is the login ID of the user who will own the process when it is
executing. This will frequently be the <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
>
user, but some services may use different accounts. It is a very good idea to
apply the principle of least privilege here, which states that you shouldn't
run a command under a privileged account if the program doesn't require this for
proper functioning. For example, the NNTP news server runs as
<SPAN
CLASS="SYSTEMITEM"
>news</SPAN
>, while services that may pose
a security risk (such as <B
CLASS="COMMAND"
>tftp</B
> or <B
CLASS="COMMAND"
>finger</B
>)
are often run as <SPAN
CLASS="SYSTEMITEM"
>nobody</SPAN
>.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>server</I
></TT
></DT
><DD
><P
>Gives the full pathname of the server program to be executed. Internal
services are marked by the keyword
<SPAN
CLASS="SYSTEMITEM"
>internal</SPAN
>.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>cmdline</I
></TT
></DT
><DD
><P
>This is the command line to be passed to the server. It starts with the
name of the server to be executed and can include any arguments that need
to be passed to it. If you are using the TCP wrapper, you specify
the full pathname to the server here. If not, then you just specify the
server name as you'd like it to appear in a process list. We'll talk about
the TCP wrapper shortly.</P
><P
>This field is empty for internal services.</P
></DD
></DL
></DIV
><P
>&#13;
A sample <TT
CLASS="FILENAME"
>inetd.conf</TT
> file is shown in
<A
HREF="#X-087-2-APPL.FIG.INETD.CONF"
>Example 12-1</A
>. The <B
CLASS="COMMAND"
>finger</B
>
service is commented out so that it is not available. This is often done
for security reasons, because it can be used by attackers to obtain names
and other details of users on your system.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-APPL.FIG.INETD.CONF"
></A
><P
><B
>Example 12-1. A Sample /etc/inetd.conf File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># 
# inetd services
ftp      stream tcp nowait root  /usr/sbin/ftpd    in.ftpd -l
telnet   stream tcp nowait root  /usr/sbin/telnetd in.telnetd -b/etc/issue
#finger  stream tcp nowait bin   /usr/sbin/fingerd in.fingerd
#tftp    dgram  udp wait  nobody /usr/sbin/tftpd   in.tftpd
#tftp    dgram  udp wait  nobody /usr/sbin/tftpd   in.tftpd /boot/diskless
#login   stream tcp nowait root  /usr/sbin/rlogind in.rlogind
#shell   stream tcp nowait root  /usr/sbin/rshd    in.rshd
#exec    stream tcp nowait root  /usr/sbin/rexecd  in.rexecd
#
#       inetd internal services
#
daytime  stream tcp nowait root internal
daytime  dgram  udp nowait root internal
time     stream tcp nowait root internal
time     dgram  udp nowait root internal
echo     stream tcp nowait root internal
echo     dgram  udp nowait root internal
discard  stream tcp nowait root internal
discard  dgram  udp nowait root internal
chargen  stream tcp nowait root internal
chargen  dgram  udp nowait root internal</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>&#13; 
The <B
CLASS="COMMAND"
>tftp</B
> daemon is shown commented out as well.
<B
CLASS="COMMAND"
>tftp</B
> implements the <EM
>Trivial File Transfer
Protocol</EM
> (TFTP), which allows someone to transfer any
world-readable files from your system without password checking.
This is especially harmful with the <TT
CLASS="FILENAME"
>/etc/passwd</TT
> file, and even more so when you don't use shadow passwords.</P
><P
>TFTP is commonly used by diskless clients and Xterminals to download their
code from a boot server. If you need to run <B
CLASS="COMMAND"
>tftpd</B
> for this
reason, make sure to limit its scope to those directories from which clients 
will retrieve files; you will need to add those directory names to
<B
CLASS="COMMAND"
>tftpd</B
>'s command line. This is shown in the second
<B
CLASS="COMMAND"
>tftp</B
> line in the example.

 &#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-APPL.TCPD"
>12.2. The tcpd Access Control Facility</A
></H2
><P
>Since opening a computer to network access involves many security risks,
applications are designed to guard against several types of attacks. Some
security features, however, may be flawed (most drastically demonstrated by the
RTM Internet worm, which exploited a hole in a number of programs, including old
versions of the sendmail mail daemon), or do not distinguish between secure
hosts from which requests for a particular service will be accepted and
insecure hosts whose requests should be rejected. We've already briefly
discussed the <B
CLASS="COMMAND"
>finger</B
> and <B
CLASS="COMMAND"
>tftp</B
> services.
Network Administrator would want to limit access to these services to 
&#8220;trusted hosts&#8221; only, which is impossible with the usual setup, 
for which <B
CLASS="COMMAND"
>inetd</B
> provides this service either to all clients 
or not at all.</P
><P
>A useful tool for managing host-specific access is <B
CLASS="COMMAND"
>tcpd</B
>,
often called the daemon
&#8220;wrapper.&#8221;<A
NAME="X-087-2-FNFE01"
HREF="#FTN.X-087-2-FNFE01"
><SPAN
CLASS="footnote"
>[69]</SPAN
></A
>
For TCP services you want to monitor or protect, it is invoked instead of the
server program. <B
CLASS="COMMAND"
>tcpd</B
> checks if the remote host is allowed 
to use that service, and only if this succeeds will it execute the real server
program. <B
CLASS="COMMAND"
>tcpd</B
> also logs the request to the 
<B
CLASS="COMMAND"
>syslog</B
> daemon. Note that this does not work with 
UDP-based services.</P
><P
> 
For example, to wrap the <B
CLASS="COMMAND"
>finger</B
> daemon, you have to change
the corresponding line in <TT
CLASS="FILENAME"
>inetd.conf</TT
> from this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># unwrapped finger daemon
finger    stream tcp nowait bin    /usr/sbin/fingerd in.fingerd</PRE
></FONT
></TD
></TR
></TABLE
>

to this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># wrap finger daemon
finger  stream  tcp     nowait  root    /usr/sbin/tcpd   in.fingerd</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;Without adding any access control, this will appear to the client as
the usual <B
CLASS="COMMAND"
>finger</B
> setup, except that any requests are logged
to <B
CLASS="COMMAND"
>syslog</B
>'s <EM
>auth</EM
>
facility.</P
><P
> 
 
Two files called <TT
CLASS="FILENAME"
>/etc/hosts.allow</TT
> and 
<TT
CLASS="FILENAME"
>/etc/hosts.deny</TT
> implement access control.
They contain entries that allow and deny access to certain services and hosts.
When <B
CLASS="COMMAND"
>tcpd</B
> handles a request for a service such as
<B
CLASS="COMMAND"
>finger</B
> from a client host named
<SPAN
CLASS="SYSTEMITEM"
>biff.foobar.com</SPAN
>, it scans
<TT
CLASS="FILENAME"
>hosts.allow</TT
> and <TT
CLASS="FILENAME"
>hosts.deny</TT
>
(in this order) for an entry matching both the service and client host.
If a matching entry is found in <TT
CLASS="FILENAME"
>hosts.allow</TT
>, access
is granted and <B
CLASS="COMMAND"
>tcpd</B
> doesn't consult the
<TT
CLASS="FILENAME"
>hosts.deny</TT
> file. If no match is found in the
<TT
CLASS="FILENAME"
>hosts.allow</TT
> file, but a match is found in
<TT
CLASS="FILENAME"
>hosts.deny</TT
>, the request is rejected by closing down the
connection. The request is accepted if no match is found at all.</P
><P
>Entries in the access files look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="REPLACEABLE"
><I
>servicelist</I
></TT
>: <TT
CLASS="REPLACEABLE"
><I
>hostlist</I
></TT
> [:<TT
CLASS="REPLACEABLE"
><I
>shellcmd</I
></TT
>]</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
><TT
CLASS="REPLACEABLE"
><I
>servicelist</I
></TT
> is a list of service names from
<TT
CLASS="FILENAME"
>/etc/services</TT
>, or the keyword
<SPAN
CLASS="SYSTEMITEM"
>ALL</SPAN
>. To match all services except
<B
CLASS="COMMAND"
>finger</B
> and <B
CLASS="COMMAND"
>tftp</B
>, use
<SPAN
CLASS="SYSTEMITEM"
>ALL</SPAN
>
<SPAN
CLASS="SYSTEMITEM"
>EXCEPT</SPAN
>
<TT
CLASS="LITERAL"
>finger, tftp</TT
>.</P
><P
><TT
CLASS="REPLACEABLE"
><I
>hostlist</I
></TT
> is a list of hostnames, IP addresses,
or the keywords <SPAN
CLASS="SYSTEMITEM"
>ALL</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>LOCAL</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>UNKNOWN</SPAN
> or
<SPAN
CLASS="SYSTEMITEM"
>PARANOID</SPAN
>.
<SPAN
CLASS="SYSTEMITEM"
>ALL</SPAN
> matches any host, while
<SPAN
CLASS="SYSTEMITEM"
>LOCAL</SPAN
> matches hostnames that don't 
contain a dot.<A
NAME="X-087-2-FNFE02"
HREF="#FTN.X-087-2-FNFE02"
><SPAN
CLASS="footnote"
>[70]</SPAN
></A
>

<SPAN
CLASS="SYSTEMITEM"
>UNKNOWN</SPAN
> matches any hosts whose name
or address lookup failed. <SPAN
CLASS="SYSTEMITEM"
>PARANOID</SPAN
>
matches any host whose hostname does not resolve back to its IP
address.<A
NAME="X-087-2-FNFE03"
HREF="#FTN.X-087-2-FNFE03"
><SPAN
CLASS="footnote"
>[71]</SPAN
></A
>

A name starting with a dot matches all hosts whose domain is equal to this
name. For example, <SPAN
CLASS="SYSTEMITEM"
>.foobar.com</SPAN
> matches
<SPAN
CLASS="SYSTEMITEM"
>biff.foobar.com</SPAN
>, but not
<SPAN
CLASS="SYSTEMITEM"
>nurks.fredsville.com</SPAN
>. A pattern that
ends with a dot matches any host whose IP address begins with the supplied
pattern, so <SPAN
CLASS="SYSTEMITEM"
>172.16.</SPAN
> matches
<SPAN
CLASS="SYSTEMITEM"
>172.16.32.0</SPAN
>, but not
<SPAN
CLASS="SYSTEMITEM"
>172.15.9.1</SPAN
>. A pattern of the form
<TT
CLASS="LITERAL"
><TT
CLASS="REPLACEABLE"
><I
>n.n.n.n</I
></TT
>/<TT
CLASS="REPLACEABLE"
><I
>m.m.m.m</I
></TT
></TT
><EM
></EM
> is treated as an IP address and network mask, so we could specify
our previous example as
<SPAN
CLASS="SYSTEMITEM"
>172.16.0.0/255.255.0.0</SPAN
> instead.
Lastly, any pattern beginning with a &#8220;/&#8221; character allows you to
specify a file that is presumed to contain a list of hostname or IP address
patterns, any of which are allowed to match. So a pattern that looked like
<EM
>/var/access/trustedhosts</EM
> would cause
the <B
CLASS="COMMAND"
>tcpd</B
> daemon to read that file, testing if any of the
lines in it matched the connecting host.</P
><P
>To deny access to the <B
CLASS="COMMAND"
>finger</B
> and <B
CLASS="COMMAND"
>tftp</B
>
services to all but the local hosts, put the following in
<TT
CLASS="FILENAME"
>/etc/hosts.deny</TT
> and leave
<TT
CLASS="FILENAME"
>/etc/hosts.allow</TT
> empty:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>in.tftpd, in.fingerd: ALL EXCEPT LOCAL, <TT
CLASS="REPLACEABLE"
><I
>.your.domain</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The optional <TT
CLASS="REPLACEABLE"
><I
>shellcmd</I
></TT
> field may contain a shell
command to be invoked when the entry is matched. This is useful to set up
traps that may expose potential attackers. The following example creates
a log file listing the user and host connecting, and if the host is not
<EM
>vlager.vbrew.com</EM
> it will append the
output of a <B
CLASS="COMMAND"
>finger</B
> to that host:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>in.ftpd: ALL EXCEPT LOCAL, .vbrew.com : \
      echo "request from %d@%h: &#62;&#62; /var/log/finger.log; \
      if [ %h != "vlager.vbrew.com:" ]; then \ 
          finger -l @%h &#62;&#62; /var/log/finger.log \
      fi</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>%h</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>%d</SPAN
> arguments are expanded by
<B
CLASS="COMMAND"
>tcpd</B
> to the client hostname and service name,
respectively. Please refer to the <TT
CLASS="FILENAME"
>hosts_access(5)</TT
>
manual page for details.

&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-APPL.SERVICES"
>12.3. The Services and Protocols Files</A
></H2
><P
>The port numbers on which certain &#8220;standard&#8221; services are
offered are defined in the Assigned Numbers RFC. To enable server and client
programs to convert service names to these numbers, at least part of
the list is kept on each host; it is stored in a file called
<TT
CLASS="FILENAME"
>/etc/services</TT
>.  An entry is made up like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="REPLACEABLE"
><I
>service</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>port</I
></TT
>/<TT
CLASS="REPLACEABLE"
><I
>protocol</I
></TT
>   [<TT
CLASS="REPLACEABLE"
><I
>aliases</I
></TT
>]</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Here, <TT
CLASS="REPLACEABLE"
><I
>service</I
></TT
> specifies the service name,
<TT
CLASS="REPLACEABLE"
><I
>port</I
></TT
> defines the port the service is offered on,
and <TT
CLASS="REPLACEABLE"
><I
>protocol</I
></TT
> defines which transport protocol
is used. Commonly, the latter field is either
<TT
CLASS="REPLACEABLE"
><I
>udp</I
></TT
> or
<TT
CLASS="REPLACEABLE"
><I
>tcp</I
></TT
>. It is possible for a service to be
offered for more than one protocol, as well as offering different services on
the same port as long as the protocols are different. The
<TT
CLASS="REPLACEABLE"
><I
>aliases</I
></TT
> field allows you to specify alternative
names for the same service.</P
><P
>Usually, you don't have to change the services file that comes along
with the network software on your Linux system. Nevertheless, we give a
small excerpt from that file in <A
HREF="#X-087-2-ETC.SERVICES"
>Example 12-2</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-ETC.SERVICES"
></A
><P
><B
>Example 12-2. A Sample /etc/services File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># The services file:
#
# well-known services
echo           7/tcp                 # Echo
echo           7/udp                 #
discard        9/tcp  sink null      # Discard
discard        9/udp  sink null      #
daytime       13/tcp                 # Daytime
daytime       13/udp                 #
chargen       19/tcp  ttytst source  # Character Generator
chargen       19/udp  ttytst source  #
ftp-data      20/tcp                 # File Transfer Protocol (Data)
ftp           21/tcp                 # File Transfer Protocol (Control)
telnet        23/tcp                 # Virtual Terminal Protocol
smtp          25/tcp                 # Simple Mail Transfer Protocol
nntp         119/tcp  readnews       # Network News Transfer Protocol
#
# UNIX services
exec         512/tcp                 # BSD rexecd
biff         512/udp  comsat         # mail notification
login        513/tcp                 # remote login
who          513/udp  whod           # remote who and uptime
shell        514/tcp  cmd            # remote command, no passwd used
syslog       514/udp                 # remote system logging
printer      515/tcp  spooler        # remote print spooling
route        520/udp  router routed  # routing information protocol</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
> 
Note that the <B
CLASS="COMMAND"
>echo</B
> service is offered on port 7 for both 
TCP and UDP, and that port 512 is used for two
different services: remote execution (<B
CLASS="COMMAND"
>rexec</B
>) using TCP,
and the <B
CLASS="COMMAND"
>COMSAT</B
> daemon, which notifies users of new mail, over UDP
(see <B
CLASS="COMMAND"
>xbiff(1x)</B
>&#8201;).</P
><P
> 

Like the services file, the networking library needs a way to translate
protocol names&#8212;for example, those used in the services file&#8212;to
protocol numbers understood by the IP layer on other hosts. This is done by
looking up the name in the <TT
CLASS="FILENAME"
>/etc/protocols</TT
> file. It
contains one entry per line, each containing a protocol name, and the
associated number. Having to touch this file is even more unlikely than
having to meddle with <TT
CLASS="FILENAME"
>/etc/services</TT
>. A sample file
is given in <A
HREF="#X-087-2-ETC.PROTOCOLS"
>Example 12-3</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-ETC.PROTOCOLS"
></A
><P
><B
>Example 12-3. A Sample /etc/protocols File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#
# Internet (IP) protocols
#
ip      0       IP              # internet protocol, pseudo protocol number
icmp    1       ICMP            # internet control message protocol
igmp    2       IGMP            # internet group multicast protocol
tcp     6       TCP             # transmission control protocol
udp     17      UDP             # user datagram protocol
raw     255     RAW             # RAW IP interface</PRE
></FONT
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-APPL.RPC"
>12.4. Remote Procedure Call</A
></H2
><P
>The general mechanism for client-server applications is provided by the
<EM
>Remote Procedure Call</EM
> (RPC) package. RPC was developed by Sun
Microsystems and is a collection of tools and library functions. Important
applications built on top of RPC are NIS, the Network Information System 
(described in <A
HREF="#X-087-2-NIS"
>Chapter 13</A
>), and NFS, the Network File System 
(described in <A
HREF="#X-087-2-NFS"
>Chapter 14</A
>), which are both described in 
this book.</P
><P
>&#13;
An RPC server consists of a collection of procedures that a client can call
by sending an RPC request to the server along with the procedure parameters.
The server will invoke the indicated procedure on behalf of the client,
handing back the return value, if there is any. In order to be
machine-independent, all data exchanged between client and server is
converted to the <EM
>External Data Representation</EM
> format
(XDR) by the sender, and converted back to the machine-local representation
by the receiver. RPC relies on standard UDP and TCP sockets to transport the
XDR formatted data to the remote host. Sun has graciously placed RPC in the
public domain; it is described in a series of RFCs.</P
><P
>Sometimes improvements to an RPC application introduce incompatible changes
in the procedure call interface. Of course, simply changing the server would
crash all applications that still expect the original behavior. Therefore,
RPC programs have version numbers assigned to them, usually starting with 1,
and with each new version of the RPC interface, this counter will be bumped up.
Often, a server may offer several versions simultaneously; clients then
indicate by the version number in their requests which implementation of
the service they want to use.</P
><P
>&#13;
The communication between RPC servers and clients is somewhat peculiar. An
RPC server offers one or more collections of procedures; each set is called
a <EM
>program</EM
> and is uniquely identified by a
<EM
>program number</EM
>. A list that maps service names to program
numbers is usually kept in <TT
CLASS="FILENAME"
>/etc/rpc</TT
>, an excerpt of which
is shown in <A
HREF="#X-087-2-RPC.FIG"
>Example 12-4</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-RPC.FIG"
></A
><P
><B
>Example 12-4. A Sample /etc/rpc File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#
# /etc/rpc - miscellaneous RPC-based services
#
portmapper      100000  portmap sunrpc
rstatd          100001  rstat rstat_svc rup perfmeter
rusersd         100002  rusers
nfs             100003  nfsprog
ypserv          100004  ypprog
mountd          100005  mount showmount
ypbind          100007
walld           100008  rwall shutdown
yppasswdd       100009  yppasswd
bootparam       100026
ypupdated       100028  ypupdate</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>In TCP/IP networks, the authors of RPC faced the problem of mapping
program numbers to generic network services. They designed each server to
provide both a TCP and a UDP port for each program and each version. Generally,
RPC applications use UDP when sending data, and fall back to TCP only
when the data to be transferred doesn't fit into a single UDP datagram.</P
><P
>&#13;
Of course, client programs need to find out to which port
a program number maps. Using a configuration file for this would be
too unflexible; since RPC applications don't use reserved ports, there's
no guarantee that a port originally meant to be used by our database
application hasn't been taken by some other process. Therefore, RPC
applications pick any port they can get and register it with a special program
called the <EM
>portmapper daemon</EM
>. The portmapper acts as a
service broker for all RPC servers running on its machine. A client that
wishes to contact a service with a given program number first queries
the portmapper on the server's host, which returns the TCP and UDP port
numbers the service can be reached at.</P
><P
>&#13;This method introduces a single point of failure, much like the 
<B
CLASS="COMMAND"
>inetd</B
> daemon does for the standard
Berkeley services. However, this case is even a little worse because
when the portmapper dies, all RPC port information is lost; this
usually means you have to restart all RPC servers manually or reboot
the entire machine.</P
><P
> 
 
On Linux, the portmapper is called <TT
CLASS="FILENAME"
>/sbin/portmap</TT
>, or
sometimes <TT
CLASS="FILENAME"
>/usr/sbin/rpc.portmap</TT
>. Other than making sure
it is started from your network boot scripts, the portmapper doesn't require
any configuration.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-APPL.REMOTE"
>12.5. Configuring Remote Loginand Execution</A
></H2
><P
>It's often very useful to execute a command on a remote host and
have input or output from that command be read from, or written to, a network
connection.</P
><P
>&#13;




The traditional commands used for executing commands on remote hosts are
<B
CLASS="COMMAND"
>rlogin</B
>, <B
CLASS="COMMAND"
>rsh</B
> and <B
CLASS="COMMAND"
>rcp</B
>.
We saw an example of the <B
CLASS="COMMAND"
>rlogin</B
> command in <A
HREF="#X-087-2-INTRO"
>Chapter 1</A
> in the section <A
HREF="#X-087-2-INTRO.TCPIP.INTRO"
>Section 1.2.1</A
>.&#8221; We briefly discussed the security
issues associated with it in <A
HREF="#X-087-2-INTRO.SECURITY"
>Section 1.5.1</A
>&#8221; and
suggested <B
CLASS="COMMAND"
>ssh</B
> as a replacement.
The <B
CLASS="COMMAND"
>ssh</B
> package provides replacements called
<B
CLASS="COMMAND"
>slogin</B
>, <B
CLASS="COMMAND"
>ssh</B
>, and <B
CLASS="COMMAND"
>scp</B
>.</P
><P
>&#13;Each of these commands spawns a shell on the remote host and allows the user
to execute commands. Of course, the client needs to have an account on the
remote host where the command is to be executed. Thus, all these commands
use an authentication process. The <EM
>r</EM
> commands use a simple
username and password exchange between the hosts with no encryption, so anyone
listening could easily intercept the passwords. The <B
CLASS="COMMAND"
>ssh</B
>
command suite provides a higher level of security: it uses a technique 
called <B
CLASS="COMMAND"
>Public Key Cryptography</B
>, which provides 
authentication and encryption between the hosts to ensure that
neither passwords nor session data are easily intercepted by other hosts.</P
><P
>&#13;It is possible to relax authentication checks for certain users even further. For
instance, if you frequently have to log into other machines on your LAN,
you might want to be admitted without having to type your password every
time. This was always possible with the <EM
>r</EM
> commands, but the
<B
CLASS="COMMAND"
>ssh</B
> suite allows you to do this a little more easily. It's
still not a great idea because it means that if an account on one machine
is breached, access can be gained to all other accounts that user has
configured for password-less login, but it is very convenient and people will
use it.</P
><P
>Let's talk about removing the <EM
>r</EM
> commands and getting
<B
CLASS="COMMAND"
>ssh</B
> to work instead.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN10332"
>12.5.1. Disabling the r; Commands</A
></H3
><P
>Start by removing the <B
CLASS="COMMAND"
>r</B
> commands if they're
installed.  The easiest way to disable the old <B
CLASS="COMMAND"
>r</B
>
commands is to comment out (or remove) their entries in the
<TT
CLASS="FILENAME"
>/etc/inetd.conf</TT
> file. The relevant entries will
look something like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># Shell, login, exec and talk are BSD protocols.
shell    stream  tcp     nowait  root  /usr/sbin/tcpd /usr/sbin/in.rshd
login    stream  tcp     nowait  root  /usr/sbin/tcpd /usr/sbin/in.rlogind
exec     stream  tcp     nowait  root  /usr/sbin/tcpd /usr/sbin/in.rexecd</PRE
></FONT
></TD
></TR
></TABLE
>

You can comment them by placing a <TT
CLASS="LITERAL"
>#</TT
> character at the start
of each line, or delete the lines completely. Remember, you need to restart the
<B
CLASS="COMMAND"
>inetd</B
> daemon for this change to take effect. Ideally, you 
should remove the daemon programs themselves, too.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN10341"
>12.5.2. Installing and Configuring ssh</A
></H3
><P
>&#13;
OpenSSH is a free version of the ssh suite of programs; the Linux port can
be found at
<SPAN
CLASS="SYSTEMITEM"
>http://violet.ibs.com.au/openssh/</SPAN
> and in
most modern Linux distributions.<A
NAME="X-087-2-FNFE04"
HREF="#FTN.X-087-2-FNFE04"
><SPAN
CLASS="footnote"
>[72]</SPAN
></A
>
We won't describe compilation here; good instructions are included in the
source. If you can install it from a precompiled package, then it's probably
wise to do so.</P
><P
>There are two parts to an <B
CLASS="COMMAND"
>ssh</B
> session. There is an
<B
CLASS="COMMAND"
>ssh</B
> client that you need to configure and run on the local
host and an <B
CLASS="COMMAND"
>ssh</B
> daemon that must be running on the remote
host.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN10357"
>12.5.2.1. The ssh daemon</A
></H4
><P
>&#13;
The <B
CLASS="COMMAND"
>sshd</B
> daemon is the program that listens for network
connections from <B
CLASS="COMMAND"
>ssh</B
> clients, manages authentication, and
executes the requested command. It has one main configuration file called
<TT
CLASS="FILENAME"
>/etc/ssh/sshd_config</TT
> and a special file containing a
key used by the authentication and encryption processes to represent the host
end. Each host and each client has its own key.</P
><P
>&#13;


A utility called <B
CLASS="COMMAND"
>ssh-keygen</B
> is supplied to generate
a random key. This is usually used once at installation time to
generate the host key, which the system administrator usually stores
in a file called <TT
CLASS="FILENAME"
>/etc/ssh/ssh_host_key</TT
>.  Keys can
be of any length of 512 bits or greater. By default,
<B
CLASS="COMMAND"
>ssh-keygen</B
> generates keys of 1024 bits in length,
and most people use the default. To generate a random key, you would
invoke the <B
CLASS="COMMAND"
>ssh-keygen</B
> command like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ssh-keygen -f /etc/ssh/ssh_host_key</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>You will be prompted to enter a passphrase. However, host keys must not use 
a passphrase, so just press the return key to leave it blank. The program 
output will look something like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Generating RSA keys:  ......oooooO...............................oooooO
Key generation complete.
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /etc/ssh/ssh_host_key
Your public key has been saved in /etc/ssh/ssh_host_key.pub
The key fingerprint is:
1024 3a:14:78:8e:5a:a3:6b:bc:b0:69:10:23:b7:d8:56:82 root@moria</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;



You will find at the end that two files have been created. The first is 
called the private key, which must be kept secret and will be in
<TT
CLASS="FILENAME"
>/etc/ssh/ssh_host_key</TT
>. The second is called the public
key and is one that you can share; it will be in
<TT
CLASS="FILENAME"
>/etc/ssh/ssh_host_key.pub</TT
>.</P
><P
>Armed with the keys for <B
CLASS="COMMAND"
>ssh</B
> communication, you need to 
create a configuration file. The <B
CLASS="COMMAND"
>ssh</B
> suite is very 
powerful and the configuration file
may contain many options. We'll present a simple example to get you started;
you should refer to the <B
CLASS="COMMAND"
>ssh</B
> documentation to enable other
features. The following code shows a safe and minimal
<B
CLASS="COMMAND"
>sshd</B
> configuration file. The rest of the configuration
options are detailed in the <B
CLASS="COMMAND"
>sshd</B
>&#8201;(8) manpage:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/ssh/sshd_config
#

# The IP adddresses to listen for connections on. 0.0.0.0 means all
# local addresses.
ListenAddress 0.0.0.0

# The TCP port to listen for connections on. The default is 22.
Port 22

# The name of the host key file.
HostKey /etc/ssh/ssh_host_key

# The length of the key in bits.
ServerKeyBits 1024

# Should we allow root logins via ssh?
PermitRootLogin no

# Should the ssh daemon check users' home directory and files permissions?
# are safe before allowing login?
StrictModes yes

# Should we allow old ~/.rhosts and /etc/hosts.equiv authentication method?
RhostsAuthentication no
# Should we allow pure RSA authentication?
RSAAuthentication yes
# Should we allow password authentication?
PasswordAuthentication yes

# Should we allow /etc/hosts.equiv combined with RSA host authentication?
RhostsRSAAuthentication no
# Should we ignore ~/.rhosts files?
IgnoreRhosts yes
# Should we allow logins to accounts with empty passwords?
PermitEmptyPasswords no</PRE
></FONT
></TD
></TR
></TABLE
><P
>It's important to make sure the permissions of the configuration files are 
correct to ensure that system security is maintained. Use the following
commands:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>chown -R root:root /etc/ssh</KBD
>
# <KBD
CLASS="USERINPUT"
>chmod 755 /etc/ssh</KBD
>
# <KBD
CLASS="USERINPUT"
>chmod 600 /etc/ssh/ssh_host_key</KBD
>
# <KBD
CLASS="USERINPUT"
>chmod 644 /etc/ssh/ssh_host_key.pub</KBD
>
# <KBD
CLASS="USERINPUT"
>chmod 644 /etc/ssh/sshd_config</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The final stage of <B
CLASS="COMMAND"
>sshd</B
> administration daemon is
to run it. Normally you'd create an <TT
CLASS="FILENAME"
>rc</TT
> file
for it or add it to an existing one, so that it is automatically executed
at boot time. The daemon runs standalone and doesn't require any entry in
the <TT
CLASS="FILENAME"
>/etc/inetd.conf</TT
> file. The daemon must be run as the
<TT
CLASS="LITERAL"
>root</TT
> user. The syntax is very simple:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>/usr/sbin/sshd</PRE
></FONT
></TD
></TR
></TABLE
>

The <B
CLASS="COMMAND"
>sshd</B
> daemon will automatically place itself into the
background when being run. You are now ready to accept <EM
>ssh</EM
>
connections.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN10425"
>12.5.2.2. The ssh client</A
></H4
><P
>&#13;


There are a number of <B
CLASS="COMMAND"
>ssh</B
> client programs:
<B
CLASS="COMMAND"
>slogin</B
>, <B
CLASS="COMMAND"
>scp</B
> and <B
CLASS="COMMAND"
>ssh</B
>.
They each read the same configuration file, usually called
<TT
CLASS="FILENAME"
>/etc/ssh/ssh_config</TT
>. They each also read configuration
files from the <TT
CLASS="FILENAME"
>.ssh</TT
> directory in the home directory
of the user executing them. The most important of these files is the
<TT
CLASS="FILENAME"
>.ssh/config</TT
> file, which may contain options that override
those specified in the <TT
CLASS="FILENAME"
>/etc/ssh/ssh_config</TT
> file, the
<TT
CLASS="FILENAME"
>.ssh/identity</TT
> file, which contains the user's own
private key, and the corresponding <TT
CLASS="FILENAME"
>.ssh/identity.pub</TT
>
file, containing the user's public key. Other important files are <TT
CLASS="FILENAME"
>.ssh/known_hosts</TT
> and 
<TT
CLASS="FILENAME"
>.ssh/authorized_keys</TT
>; we'll talk about those later in <A
HREF="#X-087-2-FEATURES.SSH.USING"
>Section 12.5.2.3</A
>.&#8221; First, let's create the global
configuration file and the user key file.</P
><P
><TT
CLASS="FILENAME"
>/etc/ssh/ssh_config</TT
> is very similar to the server
configuration file. Again, there are lots of features you can configure, but
a minimal configuration looks like that presented in
<A
HREF="#X-087-2-FEATURES.SSH.CONF"
>Example 12-5</A
>. The rest of the configuration
options are detailed in the <B
CLASS="COMMAND"
>sshd(8)</B
> manpage. You can add sections that match
specific hosts or groups of hosts. The parameter to the
&#8220;<TT
CLASS="LITERAL"
>Host</TT
>&#8221; statement may be either the full name of
a host or a wildcard specification, as we've used in our example, to match all
hosts. We could create an entry that used, for example,
<TT
CLASS="LITERAL"
>Host *.vbrew.com</TT
> to match any host in the
<TT
CLASS="LITERAL"
>vbrew.com</TT
> domain.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-FEATURES.SSH.CONF"
></A
><P
><B
>Example 12-5. Example ssh Client Configuration File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/ssh/ssh_config

# Default options to use when connecting to a remote host
Host *
  # Compress the session data?
  Compression yes
  # .. using which compression level? (1 - fast/poor, 9 - slow/good)
  CompressionLevel 6

  # Fall back to rsh if the secure connection fails?
  FallBackToRsh no

  # Should we send keep-alive messages? Useful if you use IP masquerade
  KeepAlive yes

  # Try RSA authentication?
  RSAAuthentication yes
  # Try RSA authentication in combination with .rhosts authentication?
  RhostsRSAAuthentication yes</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>&#13;We mentioned in the server configuration section that every host and user has a key. The user's key is stored in his or her
<TT
CLASS="FILENAME"
>~/.ssh/indentity</TT
> file. To generate the key, use the
same <B
CLASS="COMMAND"
>ssh-keygen</B
> command as we used to generate the
host key, except this time you do not need to specify the name of the file
in which you save the key. The <B
CLASS="COMMAND"
>ssh-keygen</B
> defaults to
the correct location, but it prompts you to enter a filename in case you'd like
to save it elsewhere. It is sometimes useful to have multiple identity files,
so <B
CLASS="COMMAND"
>ssh</B
> allows this.
Just as before, <B
CLASS="COMMAND"
>ssh-keygen</B
> will prompt you to entry a
passphrase. Passphrases add yet another level of security and are a good idea.
Your passphrase won't be echoed on the screen when you type it.
<DIV
CLASS="WARNING"
><P
></P
><TABLE
CLASS="WARNING"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.png"
HSPACE="5"
ALT="Warning"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>There is no way to recover a passphrase if you forget it. Make sure it is
something you will remember, but as with all passwords, make it something
that isn't obvious, like a proper noun or your name. For a passphrase to 
be truly effective, it should be between 10 and 30 characters
long and not be plain English prose. Try to throw in some unusual
characters. If you forget your passphrase, you will be forced to generate a
new key.</P
></TD
></TR
></TABLE
></DIV
>




You should ask each of your users to run the <B
CLASS="COMMAND"
>ssh-keygen</B
>
command just once to ensure their key file is created correctly. The
<B
CLASS="COMMAND"
>ssh-keygen</B
> will create their <TT
CLASS="FILENAME"
>~/.ssh/</TT
>
directories for them with appropriate permissions and create their private and
public keys in <TT
CLASS="FILENAME"
>.ssh/identity</TT
> and
<TT
CLASS="FILENAME"
>.ssh/identity.pub</TT
>, respectively. A sample session
should look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>ssh-keygen</KBD
>
Generating RSA keys:  .......oooooO..............................
Key generation complete.
Enter file in which to save the key (/home/maggie/.ssh/identity): 
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/maggie/.ssh/identity.
Your public key has been saved in /home/maggie/.ssh/identity.pub.
The key fingerprint is:
1024 85:49:53:f4:8a:d6:d9:05:d0:1f:23:c4:d7:2a:11:67 maggie@moria
$</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Now <B
CLASS="COMMAND"
>ssh</B
> is ready to run.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-FEATURES.SSH.USING"
>12.5.2.3. Using ssh</A
></H4
><P
>&#13;We should now have the <B
CLASS="COMMAND"
>ssh</B
> command and it's associated
programs installed and ready to run. Let's now take a quick look at how to
run them.</P
><P
>&#13;

First, we'll try a remote login to a host. We can use the <B
CLASS="COMMAND"
>slogin</B
> program in much the same way as we used the <B
CLASS="COMMAND"
>rlogin</B
> 
program in our example earlier in the book. The first time you attempt a 
connection to a host, the <B
CLASS="COMMAND"
>ssh</B
> client will retrieve the 
public key of the host and ask you to confirm its identity by prompting you 
with a shortened version of the public key called a 
<B
CLASS="COMMAND"
>fingerprint</B
>. </P
><P
>The administrator at the remote host should have supplied you in
advance with its public key fingerprint, which you should add to your 
<TT
CLASS="FILENAME"
>.ssh/known_hosts</TT
> file. If the remote
administrator has not supplied you the appropriate key, you can
connect to the remote host, but <B
CLASS="COMMAND"
>ssh</B
> will warn you
that it does have a key and prompt you whether you wish to accept the
one offered by the remote host.  Assuming that you're sure no one is
engaging in DNS spoofing and you are in fact talking to the correct
host, answer yes to the prompt.  The relevant key is then stored
automatically in your <TT
CLASS="FILENAME"
>.ssh/known_hosts</TT
> and you
will not be prompted for it again. If, on a future connection attempt, 
the public key retrieved from that host does not match the one that is 
stored, you will be warned, because this represents a potential security 
breach.</P
><P
>A first-time login to a remote host will look something like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>slogin vchianti.vbrew.com</KBD
>
The authenticity of host 'vchianti.vbrew.com' can't be established.
Key fingerprint is 1024 7b:d4:a8:28:c5:19:52:53:3a:fe:8d:95:dd:14:93:f5.
Are you sure you want to continue connecting (yes/no)? <KBD
CLASS="USERINPUT"
>yes</KBD
>
Warning: Permanently added 'vchianti.vbrew.com,172.16.2.3' to the list of/
    known hosts.
maggie@vchianti.vbrew.com's password: 
Last login: Tue Feb  1 23:28:58 2000 from vstout.vbrew.com
$</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>You will be prompted for a password, which you should answer with the 
password belonging to the remote account, not the local one. This password 
is not echoed when you type it.</P
><P
>Without any special arguments, <B
CLASS="COMMAND"
>slogin</B
> will attempt to log in
with the same userid used on the local machine. You can override this
using the <TT
CLASS="LITERAL"
>-l</TT
> argument, supplying an alternate login name
on the remote host. This is what we did in our example earlier in the book.</P
><P
>&#13;We can copy files to and from the remote host using the <B
CLASS="COMMAND"
>scp</B
>
program. Its syntax is similar to the conventional <B
CLASS="COMMAND"
>cp</B
>
with the exception that you may specify a hostname before a filename, meaning 
that the file path is on the specified host. The following example illustrates
<B
CLASS="COMMAND"
>scp</B
> syntax by copying a local file called 
<TT
CLASS="FILENAME"
>/tmp/fred</TT
> to the <TT
CLASS="FILENAME"
>/home/maggie/</TT
> of 
the remote host <EM
>chianti.vbrew.com</EM
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>scp /tmp/fred vchianti.vbrew.com:/home/maggie/</KBD
>
maggie@vchianti.vbrew.com's password:
fred                 100% |*****************************| 50165   00:01 ETA</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Again, you'll be prompted for a password. The <B
CLASS="COMMAND"
>scp</B
> command 
displays useful progress messages by default. You can copy a file from a 
remote host with the same ease; simply specify its hostname and filepath as 
the source and the local path as the destination. It's even possible to copy 
a file from a remote host to some other remote host, but it is something you 
wouldn't normally want to do, because all of the data travels via your host.</P
><P
>You can execute commands on remote hosts using the
<B
CLASS="COMMAND"
>ssh</B
> command. Again, its syntax is very simple. Let's
have our user <KBD
CLASS="USERINPUT"
>maggie</KBD
> retrieve the root directory of
the remote host <EM
>vchianti.vbrew.com</EM
>.
She'd do this with:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>ssh vchianti.vbrew.com ls -CF /</KBD
>
maggie@vchianti.vbrew.com's password:
bin/    console@  dos/     home/    lost+found/  pub@   tmp/  vmlinuz@
boot/   dev/      etc/     initrd/  mnt/         root/  usr/  vmlinuz.old@
cdrom/  disk/     floppy/  lib/     proc/        sbin/  var/</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>You can place <B
CLASS="COMMAND"
>ssh</B
> in a command pipeline
and pipe program input/output to or from it just like any other command,
except that the input or output is directed to or from the remote host
via the <B
CLASS="COMMAND"
>ssh</B
> connection. Here is an example of how you might
use this capability in combination with the <B
CLASS="COMMAND"
>tar</B
> command
to copy a whole directory with subdirectories and files from a remote host
to the local host:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>ssh vchianti.vbrew.com "tar cf - /etc/" | tar xvf -</KBD
>
maggie@vchianti.vbrew.com's password:
etc/GNUstep
etc/Muttrc
etc/Net
etc/X11
etc/adduser.conf
..
..</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Here we surrounded the command we will execute with quotation marks to make it
clear what is passed as an argument to <B
CLASS="COMMAND"
>ssh</B
> and what is used
by the local shell. This command executes the <B
CLASS="COMMAND"
>tar</B
>
command on the remote host to archive the <TT
CLASS="FILENAME"
>/etc/</TT
> directory
and write the output to standard output. We've piped to an instance of the
<B
CLASS="COMMAND"
>tar</B
> command running on our local host in extract mode
reading from standard input.</P
><P
>&#13;Again, we were prompted for the password. Now you can see why we encouraged 
you to configure <B
CLASS="COMMAND"
>ssh</B
> so
that it doesn't prompt you for passwords all the time! Let's now configure
our local <B
CLASS="COMMAND"
>ssh</B
> client so that it won't prompt for a password
when connecting to the
<SPAN
CLASS="SYSTEMITEM"
>vchianti.vbrew.com</SPAN
> host. We mentioned
the <TT
CLASS="FILENAME"
>.ssh/authorized_keys</TT
> file earlier; this is where
it is used. The <TT
CLASS="FILENAME"
>.ssh/authorized_keys</TT
> file contains the
<EM
>public</EM
> keys on any remote user accounts that we wish to
automatically log in to. You can set up automatic logins by copying the 
contents of the
<TT
CLASS="FILENAME"
>.ssh/identity.pub</TT
> from the <EM
>remote</EM
>
account into our local <TT
CLASS="FILENAME"
>.ssh/authorized_keys</TT
> file. It is
vital that the file permissions of <TT
CLASS="FILENAME"
>.ssh/authorized_keys</TT
> 
allow only that you read and write it; anyone may steal and use the
keys to log in to that remote account. To ensure the permissions are correct,
change <TT
CLASS="FILENAME"
>.ssh/authorized_keys</TT
>, as shown:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>chmod 600 ~/.ssh/authorized_keys</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The public keys are a long <EM
>single</EM
> line of plain
text. If you use copy and paste to duplicate the key into your local file, 
be sure to remove any end of line characters that might have been introduced 
along the way. The <TT
CLASS="FILENAME"
>.ssh/authorized_keys</TT
> file may contain 
many such keys, each on a line of its own.</P
><P
>The <B
CLASS="COMMAND"
>ssh</B
> suite of tools is very powerful and there are many
other useful features and options that you will be interested in exploring.
Please refer to the manual pages and other documentation that is supplied
with the package for more information.</P
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-NIS"
></A
>Chapter 13. The Network Information System</H1
><P
>When you're running a local area network, your overall goal is usually to
provide an environment for your users that makes the network transparent. An
important stepping stone is keeping vital data such as user account
information synchronized among all hosts. This provides users with the freedom
to move from machine to machine without the inconvenience of having to remember
different passwords and copy data from one machine to another. Data that is
centrally stored doesn't need to be replicated, so long as there is some
convenient means of accessing it from a network-connected host. By storing
important administrative information centrally, you can make ensure 
consistency of that data, increase flexibility for the users by
allowing them to move from host to host in a transparent way, and make the
system administrator's life much easier by maintaining a single copy of
information to maintain when required.</P
><P
>We previously discussed an important example of this concept that is used on 
the Internet&#8212;the Domain Name System (DNS). DNS serves a limited range of
information, the most important being the mapping between hostname and
IP address. For other types of information, there is no such specialized
service. Moreover, if you manage only a small LAN with no Internet
connectivity, setting up DNS may not seem to be worth the trouble.</P
><P
> 
This is why Sun developed the <EM
>Network Information
System</EM
> (NIS). NIS provides generic database access facilities that
can be used to distribute, for example,  information contained in the
<TT
CLASS="FILENAME"
>passwd</TT
> and <TT
CLASS="FILENAME"
>groups</TT
> files to all
hosts on your network. This makes the network appear as a single system,
with the same accounts on all hosts. Similarly, you can use NIS
to distribute the hostname information from <TT
CLASS="FILENAME"
>/etc/hosts</TT
>
to all machines on the network.</P
><P
>NIS is based on RPC, and comprises a server, a client-side library, and
several administrative tools.  Originally, NIS was called <EM
>Yellow
Pages</EM
>, or YP, which is still used to refer to it.
Unfortunately, the name is a trademark of British Telecom, which required
Sun to drop that name. As things go, some names stick with people, and so
YP lives on as a prefix to the names of most NIS-related commands such as
<B
CLASS="COMMAND"
>ypserv</B
> and <B
CLASS="COMMAND"
>ypbind</B
>.</P
><P
>&#13;
Today, NIS is available for virtually all Unixes, and there are even
free implementations. BSD Net-2 released one that has
been derived from a public domain reference implementation donated by
Sun. The library client code from this release had been in the Linux
<TT
CLASS="FILENAME"
>libc</TT
> for a long time, and the administrative programs
were ported to Linux by
Swen Thmmler.<A
NAME="X-087-2-FNNI01"
HREF="#FTN.X-087-2-FNNI01"
><SPAN
CLASS="footnote"
>[73]</SPAN
></A
>
An NIS server is missing from the reference implementation, though.&#13;</P
><P
>&#13;

Peter Eriksson developed a new
implementation called NYS.<A
NAME="X-087-2-FNNI02"
HREF="#FTN.X-087-2-FNNI02"
><SPAN
CLASS="footnote"
>[74]</SPAN
></A
>
It supports both plain NIS and Sun's much enhanced NIS+. NYS not only
provides a set of NIS tools and a server, but also adds a whole new
set of library functions that need to be compiled into your
<TT
CLASS="FILENAME"
>libc</TT
> if you wish to use it.  This includes a new
configuration scheme for hostname resolution that replaces the current
scheme using <TT
CLASS="FILENAME"
>host.conf</TT
>.</P
><P
>&#13;


The GNU libc, known as <TT
CLASS="FILENAME"
>libc6</TT
> in the Linux community,
includes an updated version of the traditional NIS support developed by
Thorsten Kukuk.<A
NAME="X-087-2-FNNI04"
HREF="#FTN.X-087-2-FNNI04"
><SPAN
CLASS="footnote"
>[75]</SPAN
></A
> It supports all of the
library functions that NYS provided and also uses the enhanced configuration
scheme of NYS. You still need the tools and server, but using GNU <TT
CLASS="FILENAME"
>libc</TT
> saves
you the trouble of having to meddle with patching and recompiling the library.</P
><P
>This chapter focuses on the NIS support included in the GNU <TT
CLASS="FILENAME"
>libc</TT
> rather than
the other two packages. If you do want to run any of these packages, the
instructions in this chapter may or may not be enough. For additional
information, refer to the NIS-HOWTO or a book such as <EM
>Managing 
NFS and NIS</EM
> by Hal Stern (O'Reilly).</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN10645"
>13.1. Getting Acquainted with NIS</A
></H2
><P
>&#13;
NIS keeps database information in files called <EM
>maps</EM
>, 
which contain key-value pairs. An example of a key-value pair is a user's login
name and the encrypted form of their login password. Maps are stored on a
central host running the NIS server, from which clients may retrieve the
information through various RPC calls. Quite frequently, maps are stored in DBM
files.<A
NAME="X-087-2-FNNI05"
HREF="#FTN.X-087-2-FNNI05"
><SPAN
CLASS="footnote"
>[76]</SPAN
></A
>&#13;</P
><P
>&#13;


 
 
 
 
 
 
The maps themselves are usually generated from master text files such as
<TT
CLASS="FILENAME"
>/etc/hosts</TT
> or <TT
CLASS="FILENAME"
>/etc/passwd</TT
>. For
some files, several maps are created, one for each search key type. For
instance, you may search the <TT
CLASS="FILENAME"
>hosts</TT
> file for a hostname
as well as for an IP address. Accordingly, two NIS maps are derived from it,
called <TT
CLASS="FILENAME"
>hosts.byname</TT
> and <TT
CLASS="FILENAME"
>hosts.byaddr</TT
>.
<A
HREF="#X-087-2-NIS.TABLE.MAPS"
>Table 13-1</A
> lists common maps and the files from
which they are generated.</P
><DIV
CLASS="TABLE"
><A
NAME="X-087-2-NIS.TABLE.MAPS"
></A
><P
><B
>Table 13-1. Some Standard NIS Maps and Corresponding Files</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Master File</TH
><TH
>Map(s)</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="FILENAME"
>/etc/hosts</TT
></TD
><TD
><P
><TT
CLASS="FILENAME"
>hosts.byname</TT
>, <TT
CLASS="FILENAME"
>hosts.byaddr</TT
></P
></TD
><TD
><P
>Maps IP addresses to host names</P
></TD
></TR
><TR
><TD
><TT
CLASS="FILENAME"
>/etc/networks</TT
></TD
><TD
><P
><TT
CLASS="FILENAME"
>networks.byname</TT
>, <TT
CLASS="FILENAME"
>networks.byaddr</TT
></P
></TD
><TD
><P
>Maps IP network addresses to network names</P
></TD
></TR
><TR
><TD
><P
><TT
CLASS="FILENAME"
>/etc/passwd</TT
></P
></TD
><TD
><P
><TT
CLASS="FILENAME"
>passwd.byname</TT
>, <TT
CLASS="FILENAME"
>passwd.byuid</TT
></P
></TD
><TD
><P
>Maps encrypted passwords to user login names</P
></TD
></TR
><TR
><TD
><P
><TT
CLASS="FILENAME"
>/etc/group</TT
></P
></TD
><TD
><P
><TT
CLASS="FILENAME"
>group.byname</TT
>, <TT
CLASS="FILENAME"
>group.bygid</TT
></P
></TD
><TD
><P
>Maps Group IDs to group names</P
></TD
></TR
><TR
><TD
><P
><TT
CLASS="FILENAME"
>/etc/services</TT
></P
></TD
><TD
><P
><TT
CLASS="FILENAME"
>services.byname</TT
>, <TT
CLASS="FILENAME"
>services.bynumber</TT
></P
></TD
><TD
>Maps service descriptions to service names</TD
></TR
><TR
><TD
><TT
CLASS="FILENAME"
>/etc/rpc</TT
></TD
><TD
><P
><TT
CLASS="FILENAME"
>rpc.byname</TT
>, <TT
CLASS="FILENAME"
>rpc.bynumber</TT
></P
></TD
><TD
><P
>Maps Sun RPC service numbers to RPC service names</P
></TD
></TR
><TR
><TD
><TT
CLASS="FILENAME"
>/etc/protocols</TT
></TD
><TD
><P
><TT
CLASS="FILENAME"
>protocols.byname</TT
>, <TT
CLASS="FILENAME"
>protocols.bynumber</TT
></P
></TD
><TD
><P
>Maps protocol numbers to protocol names</P
></TD
></TR
><TR
><TD
><TT
CLASS="FILENAME"
>/usr/lib/aliases</TT
></TD
><TD
><TT
CLASS="FILENAME"
>mail.aliases</TT
></TD
><TD
><P
>Maps mail aliases to mail alias names</P
></TD
></TR
></TBODY
></TABLE
></DIV
><P
>You may find support for other files and maps in other NIS packages.
These usually contain information for applications not discussed in this book,
such as the <TT
CLASS="FILENAME"
>bootparams</TT
> map that is used by Sun's
<B
CLASS="COMMAND"
>bootparamd</B
> server.</P
><P
>&#13;


For some maps, people commonly use <EM
>nicknames</EM
>, which are
shorter and therefore easier to type. Note that these nicknames are understood
only by <B
CLASS="COMMAND"
>ypcat</B
> and <B
CLASS="COMMAND"
>ypmatch</B
>, two tools for
checking your NIS configuration. To obtain a full list of nicknames understood
by these tools, run the following command:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>ypcat -x</KBD
>
Use "passwd" for "passwd.byname"
Use "group" for "group.byname"
Use "networks" for "networks.byaddr"
Use "hosts" for "hosts.byaddr"
Use "protocols" for "protocols.bynumber"
Use "services" for "services.byname"
Use "aliases" for "mail.aliases"
Use "ethers" for "ethers.byname"</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;






The NIS server program is traditionally called <B
CLASS="COMMAND"
>ypserv</B
>. For
an average network, a single server usually suffices; large networks may
choose to run several of these on different machines and different segments
of the network to relieve the load on the server machines and routers.
These servers are synchronized by making one of them the <EM
>master
server</EM
>, and the others <EM
>slave servers</EM
>. Maps are
created only on the master server's host. From there, they are distributed to
all slaves.</P
><P
>&#13;

We have been talking very vaguely about &#8220;networks.&#8221; There's a 
distinctive term in NIS that refers to a collection of all hosts that share 
part of their system configuration data through NIS: the 
<EM
>NIS domain</EM
>. Unfortunately, NIS domains
have absolutely nothing in common with the domains we encountered in DNS. To
avoid any ambiguity throughout this chapter, we will therefore always specify
which type of domain we mean.</P
><P
>&#13;

NIS domains have a purely administrative function. They are mostly
invisible to users, except for the sharing of passwords between all
machines in the domain. Therefore, the name given to an NIS domain is
relevant only to the administrators. Usually, any name will do, as long
as it is different from any other NIS domain name on your local network.
For instance, the administrator at the Virtual Brewery may choose to
create two NIS domains, one for the Brewery itself, and one for the
Winery, which she names <SPAN
CLASS="SYSTEMITEM"
>brewery</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>winery</SPAN
> respectively. Another quite
common scheme is to simply use the DNS domain name for NIS as well.</P
><P
>To set and display the NIS domain name of your host, you can use the
<B
CLASS="COMMAND"
>domainname</B
> command. When invoked without any argument, it
prints the current NIS domain name; to set the domain name, you must
become the superuser:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>domainname brewery</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>NIS domains determine which NIS server an application will query. For
instance, the <B
CLASS="COMMAND"
>login</B
> program on a host at the Winery should,
of course, query only the Winery's NIS server (or one of them, if there
are several) for a user's password information, while an application on
a Brewery host should stick with the Brewery's server.</P
><P
>&#13;

One mystery now remains to be solved: how does a client find out which
server to connect to? The simplest approach would use a configuration
file that names the host on which to find the server. However, this approach
is rather inflexible because it doesn't allow clients to use different servers
(from the same domain, of course) depending on their availability. Therefore,
NIS implementations rely on a special daemon called <B
CLASS="COMMAND"
>ypbind</B
>
to detect a suitable NIS server in their NIS domain. Before performing any 
NIS queries, an application first finds out from
<B
CLASS="COMMAND"
>ypbind</B
> which server to use.</P
><P
><B
CLASS="COMMAND"
>ypbind</B
> probes for servers by broadcasting to the local IP
network; the first to respond is assumed to be the fastest one and
is used in all subsequent NIS queries. After a certain interval has
elapsed, or if the server becomes unavailable, <B
CLASS="COMMAND"
>ypbind</B
>
probes for active servers again.</P
><P
>Dynamic binding is useful only when your network provides more than one
NIS server. Dynamic binding also introduces a security problem.
<B
CLASS="COMMAND"
>ypbind</B
> blindly believes whoever answers, whether it be a
humble NIS server or a malicious intruder. Needless to say, this
becomes especially troublesome if you manage your password databases over NIS.
To guard against this, the Linux <B
CLASS="COMMAND"
>ypbind</B
> program provides
you with the option of probing the local network to find the local NIS server,
or configuring the NIS server hostname in a configuration file.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NIS.NISPLUS"
>13.2. NIS Versus NIS+</A
></H2
><P
>NIS and NIS+ share little more than their name and a common goal. NIS+ is
structured entirely differently from NIS. Instead of a flat namespace with
disjoint NIS domains, NIS+ uses a hierarchical namespace similar to that of
DNS. Instead of maps, so-called <EM
>tables</EM
> are used that
are made up of rows and columns, in which each row represents an object in the
NIS+ database and the columns cover properties of the objects that NIS+
knows and cares about. Each table for a given NIS+ domain comprises those of
its parent domains. In addition, an entry in a table may contain a link to
another table. These features make it possible to structure information in
many ways.</P
><P
>NIS+ additionally supports secure and encrypted RPC, which helps greatly to
solve the security problems of NIS.</P
><P
>Traditional NIS has an RPC Version number of 2, while NIS+ is Version 3.
At the time we're writing, there isn't yet a good working implementation 
of NIS+ for Linux, so it isn't covered here.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NIS.CLIENTS"
>13.3. The Client Side of NIS</A
></H2
><P
>If you are familiar with writing or porting network applications, you
may notice that most of the NIS maps listed previously correspond to library
functions in the C library. For instance, to obtain <TT
CLASS="FILENAME"
>passwd</TT
>
information, you generally use the <CODE
CLASS="FUNCTION"
>getpwnam</CODE
> and
<CODE
CLASS="FUNCTION"
>getpwuid</CODE
> functions, which return the account information
associated with the given username or numerical user ID, respectively.
Under normal circumstances, these functions perform the requested
lookup on the standard file, such as <TT
CLASS="FILENAME"
>/etc/passwd</TT
>.</P
><P
>An NIS-aware implementation of these functions, however, modifies this
behavior and places an RPC call to the NIS server, which looks up the username 
or user ID. This happens transparently to the application. The function may
treat the NIS data as though it has been appended to the original
<TT
CLASS="FILENAME"
>passwd</TT
> file so both sets of information are available
to the application and used, or as though it has completely replaced it so 
that the information in the local <TT
CLASS="FILENAME"
>passwd</TT
> is ignored 
and only the NIS data is used.</P
><P
>For traditional NIS implementations, there were certain conventions for
which maps were replaced and which were appended to the original information.
Some, like the <TT
CLASS="FILENAME"
>passwd</TT
> maps, required kludgy modifications
of the <TT
CLASS="FILENAME"
>passwd</TT
> file which, when done incorrectly, would
open up security holes. To avoid these pitfalls, NYS and the GNU <TT
CLASS="FILENAME"
>libc</TT
> use a
general configuration scheme that determines whether a particular set of
client functions uses the original files, NIS, or NIS+, and in which order.
This scheme will be described later in this chapter.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NIS.SERVER"
>13.4. Running an NIS Server</A
></H2
><P
>&#13;After so much theoretical techno-babble, it's time to get our hands
dirty with actual configuration work. In this section, we will cover the
configuration of an NIS server. If an NIS server is running on your network,
you won't have to set up your own; in this case, you may safely skip this
section.</P
><P
>Note that if you are just going to experiment with the server, make
sure you don't set it up for an NIS domain name that is already in use
on your network. This may disrupt the entire network service and make a
lot of people very unhappy and very angry.</P
><P
>&#13;


There are two possible NIS server configurations: master and slave. The slave
configuration provides a live backup machine, should your master server 
fail. We will cover the configuration only for a master server here. 
The server documentation will explain the differences, should you wish 
to configure a slave server.</P
><P
>There are currently two NIS servers freely available for Linux: one contained
in Tobias Reber's <TT
CLASS="FILENAME"
>yps</TT
> package, and the other in Peter
Eriksson's <TT
CLASS="FILENAME"
>ypserv</TT
> package. It doesn't matter which one
you run.</P
><P
>After installing the server program (<B
CLASS="COMMAND"
>ypserv</B
>) in
<TT
CLASS="FILENAME"
>/usr/sbin</TT
>, you should create the directory that
is going to hold the map files your server is to distribute. When
setting up an NIS domain for the <SPAN
CLASS="SYSTEMITEM"
>brewery</SPAN
> domain, the maps would go to
<TT
CLASS="FILENAME"
>/var/yp/brewery</TT
>.  The server determines whether it is
serving a particular NIS domain by checking if the map directory
is present. If you are disabling service for some NIS domain, make
sure to remove the directory as well.&#13;</P
><P
>&#13;
 
 
Maps are usually stored in DBM files to speed up lookups. They are created
from the master files using a program called <B
CLASS="COMMAND"
>makedbm</B
> (for
Tobias's server) or <B
CLASS="COMMAND"
>dbmload</B
> (for Peter's server).</P
><P
>Transforming a master file into a form that <B
CLASS="COMMAND"
>dbmload</B
> can 
parse usually requires some <B
CLASS="COMMAND"
>awk</B
> or <B
CLASS="COMMAND"
>sed</B
> 
magic, which tends to be a little tedious to type and hard to remember. 
Therefore, Peter Eriksson's <TT
CLASS="FILENAME"
>ypserv</TT
> package contains a 
Makefile (called <TT
CLASS="FILENAME"
>ypMakefile</TT
>) that manages the conversion 
of the most common master files for you. You should install it as
<TT
CLASS="FILENAME"
>Makefile</TT
> in your map directory and edit it to reflect
the maps you want the NIS server to share. Towards the top of the file, you'll
find 
the <SPAN
CLASS="SYSTEMITEM"
>all</SPAN
>
target that lists the services <B
CLASS="COMMAND"
>ypserv</B
> offers. By default, the line looks
something like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>all: ethers hosts networks protocols rpc services passwd group netid</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;If you don't want to produce, for example, the 
<TT
CLASS="FILENAME"
>ethers.byname</TT
> and <TT
CLASS="FILENAME"
>ethers.byaddr</TT
> 
maps, simply remove the <SPAN
CLASS="SYSTEMITEM"
>ethers</SPAN
> 
prerequisite from this rule. To test your setup, you can start with just 
one or two maps, like the <TT
CLASS="FILENAME"
>services.</TT
>* maps.</P
><P
>After editing the <TT
CLASS="FILENAME"
>Makefile</TT
>, while in the map directory,
type <KBD
CLASS="USERINPUT"
>make</KBD
>. This will automatically generate and install the
maps. You have to make sure to update the maps whenever you change the master
files, otherwise the changes will remain invisible to the network.</P
><P
>&#13;The section &#8220;Setting Up an NIS Client with GNU libc&#8221; 
will explain how to configure the NIS client code. If your setup doesn't
work, you should try to find out whether requests are arriving at your
server. If you specify the <CODE
CLASS="OPTION"
>&#8211;&#8211;debug</CODE
>
command-line flag to <B
CLASS="COMMAND"
>ypserv</B
>, it prints debugging
messages to the console about all incoming NIS queries and the results
returned. These should give you a hint as to where the problem
lies. Tobias's server doesn't have this option.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NIS.SECURENETS"
>13.5. NIS Server Security</A
></H2
><P
>&#13;
NIS used to have a major security flaw: it left your password file
readable by virtually anyone in the entire Internet, which made for
quite a number of possible intruders. As long as an intruder knew your
NIS domain name and the address of your server, he could simply send
it a request for the <TT
CLASS="FILENAME"
>passwd.byname</TT
> map and
instantly receive all your system's encrypted passwords. With a fast
password-cracking program like <B
CLASS="COMMAND"
>crack</B
> and a good
dictionary, guessing at least a few of your users' passwords is rarely
a problem.</P
><P
>&#13;

This is what the <EM
>securenets</EM
> option is all
about. It simply restricts access to your NIS server to certain hosts,
based on their IP addresses or network numbers. The latest version of
<B
CLASS="COMMAND"
>ypserv</B
> implements this feature in two ways. The
first relies on a special configuration file called
<TT
CLASS="FILENAME"
>/etc/ypserv.securenets</TT
> and the second
conveniently uses the <TT
CLASS="FILENAME"
>/etc/hosts.allow</TT
> and
<TT
CLASS="FILENAME"
>/etc/hosts.deny</TT
> files we already encountered in
<A
HREF="#X-087-2-APPL"
>Chapter 12</A
>.<A
NAME="X-087-2-FNNI06"
HREF="#FTN.X-087-2-FNNI06"
><SPAN
CLASS="footnote"
>[77]</SPAN
></A
>
Thus, to restrict access to hosts from within the Brewery, their
network manager would add the following line to
<TT
CLASS="FILENAME"
>hosts.allow&#8201;</TT
>:
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ypserv: 172.16.2.</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This would let all hosts from IP network <SPAN
CLASS="SYSTEMITEM"
>172.16.2.0</SPAN
> access the NIS server.  To
shut out all other hosts, a corresponding entry in
<TT
CLASS="FILENAME"
>hosts.deny</TT
> would have to read:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ypserv: ALL</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>IP numbers are not the only way you can specify hosts or networks in
<TT
CLASS="FILENAME"
>hosts.allow</TT
> and <TT
CLASS="FILENAME"
>hosts.deny</TT
>. Please
refer to the <TT
CLASS="FILENAME"
>hosts_access(5)</TT
> manual page on your system
for details.  However, be warned that you <EM
>cannot</EM
> use host
or domain names for the <SPAN
CLASS="SYSTEMITEM"
>ypserv</SPAN
> entry.
If you specify a hostname, the server tries to resolve this hostname&#8212;but
the resolver in turn calls <B
CLASS="COMMAND"
>ypserv</B
>, and you fall into an
endless loop.</P
><P
> 
To configure <SPAN
CLASS="SYSTEMITEM"
>securenets</SPAN
> security
using the <TT
CLASS="FILENAME"
>/etc/ypserv.securenets</TT
> method, you need
to create its configuration file, <TT
CLASS="FILENAME"
>/etc/ypserv.securenets</TT
>.
This configuration file is simple
in structure. Each line describes a host or network of hosts that will be
allowed access to the server. Any address not described by an entry in this
file will be refused access. A line beginning with a # will be
treated as a comment. Example 13-1 shows what a simple <TT
CLASS="FILENAME"
>/etc/ypserv.securenets</TT
>
would look like:</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-NIS.SECURENETS.FILE"
></A
><P
><B
>Example 13-1. Sample ypserv.securenets File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># allow connections from local host -- necessary
host 127.0.0.1
# same as 255.255.255.255 127.0.0.1
#
# allow connections from any host on the Virtual Brewery network
255.255.255.0   172.16.1.0
#</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>The first entry on each line is the netmask to use for the entry, with
<SPAN
CLASS="SYSTEMITEM"
>host</SPAN
> being treated as a special
keyword meaning &#8220;netmask 255.255.255.255.&#8221; The second entry
on each line is the IP address to which to apply the netmask.</P
><P
>A third option is to use the secure portmapper instead of the
<CODE
CLASS="OPTION"
>securenets</CODE
> option in
<B
CLASS="COMMAND"
>ypserv</B
>. The secure portmapper
(<TT
CLASS="FILENAME"
>portmap-5.0</TT
>) uses the <TT
CLASS="FILENAME"
>hosts.allow</TT
> scheme as well, but
offers this for all RPC servers, not just <B
CLASS="COMMAND"
>ypserv</B
>.<A
NAME="X-087-2-FNNI07"
HREF="#FTN.X-087-2-FNNI07"
><SPAN
CLASS="footnote"
>[78]</SPAN
></A
>
However, you should not use both the <CODE
CLASS="OPTION"
>securenets</CODE
> option and the secure
portmapper at the same time, because of the overhead this
authorization incurs.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NIS.YP"
>13.6. Setting Up an NIS Client with GNU libc</A
></H2
><P
>&#13;
 
We will now describe and discuss the configuration of an NIS client using 
the GNU libc library support.</P
><P
>&#13;


Your first step should be to tell the GNU libc NIS client which server to use
for NIS service. We mentioned earlier that the Linux <B
CLASS="COMMAND"
>ypbind</B
>
allows you to configure the NIS server to use. The default behavior is to
query the server on the local network. If the host you are configuring is
likely to move from one domain to another, such as a laptop, you 
would leave the <TT
CLASS="FILENAME"
>/etc/yp.conf</TT
> file empty and it would
query on the local network for the local NIS server wherever it happens to be.</P
><P
>A more secure configuration for most hosts is to set the server name in the
<TT
CLASS="FILENAME"
>/etc/yp.conf</TT
> configuration file. A very simple file for a
host on the Winery's network may look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># yp.conf - YP configuration for GNU libc library.
#
ypserver vbardolino</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>ypserver</SPAN
> statement tells your host
to use the host supplied as the NIS server for the local domain. In this
example we've specified the NIS server as <SPAN
CLASS="SYSTEMITEM"
>vbardolino</SPAN
>. Of course, the IP address corresponding to
<SPAN
CLASS="SYSTEMITEM"
>vbardolino</SPAN
> must be set
in the <TT
CLASS="FILENAME"
>hosts</TT
> file; alternatively, you may use the
IP address itself with the <SPAN
CLASS="SYSTEMITEM"
>server</SPAN
>
argument.</P
><P
>In the form shown in the example, the 
<B
CLASS="COMMAND"
>ypserver</B
> command tells 
<B
CLASS="COMMAND"
>ypbind</B
> to use the named server regardless of what the
current NIS domain may be. If, however, you are moving your machine between
different NIS domains frequently, you may want to keep information for several
domains in the <TT
CLASS="FILENAME"
>yp.conf</TT
> file. You can have information on
the servers for various NIS domains in <TT
CLASS="FILENAME"
>yp.conf</TT
> by
specifying the information using the
<SPAN
CLASS="SYSTEMITEM"
>domain</SPAN
> statement. For instance, you
might change the previous sample file to look like this for a laptop:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># yp.conf - YP configuration for GNU libc library.
# 
domain winery server vbardolino 
domain brewery server vstout </PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This lets you bring up the laptop in either of the two domains by simply
setting the desired NIS domain at boot time using the
<B
CLASS="COMMAND"
>domainname</B
> command. The NIS client then uses whichever
server is relevant for the current domain.</P
><P
>There is a third option you may want to use. It covers the case when you
don't know the name or IP address of the server to use in a particular domain,
but still want the ability use a fixed server on certain domains. Imagine
we want to insist on using a specified server while operating within the 
Winery domain, but want to probe for the server to use while
in the Brewery domain. We would modify our <TT
CLASS="FILENAME"
>yp.conf</TT
> 
file again to look like this instead:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># yp.conf - YP configuration for GNU libc library.
# 
domain winery server vbardolino 
domain brewery broadcast</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>broadcast</SPAN
> keyword tells
<B
CLASS="COMMAND"
>ypbind</B
> to use whichever NIS server it finds for the domain.&#13;</P
><P
>&#13;
After creating this basic configuration file and making sure it is
world-readable, you should run your first test to connect
to your server. Make sure to choose a map your server distributes, like
<TT
CLASS="FILENAME"
>hosts.byname</TT
>, and try to retrieve it by using the
<B
CLASS="COMMAND"
>ypcat</B
> utility:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ypcat hosts.byname</KBD
>
172.16.2.2      vbeaujolais.vbrew.com    vbeaujolais
172.16.2.3      vbardolino.vbrew.com     vbardolino
172.16.1.1      vlager.vbrew.com         vlager
172.16.2.1      vlager.vbrew.com         vlager
172.16.1.2      vstout.vbrew.com         vstout
172.16.1.3      vale.vbrew.com           vale
172.16.2.4      vchianti.vbrew.com       vchianti</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;The output you get should resemble that just shown. If you get an error
message instead that says: <TT
CLASS="LITERAL"
>Can't bind to server which serves
domain</TT
>, then either the NIS domain name you've set doesn't
have a matching server defined in <TT
CLASS="FILENAME"
>yp.conf</TT
>, or the server
is unreachable for some reason. In the latter case, make sure that a
<B
CLASS="COMMAND"
>ping</B
> to the host yields a positive result, and that it is
indeed running an NIS server. You can verify the latter by using
<B
CLASS="COMMAND"
>rpcinfo</B
>, which should produce the following output:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>rpcinfo -u</KBD
> <TT
CLASS="REPLACEABLE"
><I
>serverhost</I
></TT
> <KBD
CLASS="USERINPUT"
>ypserv</KBD
>
program 100004 version 1 ready and waiting
program 100004 version 2 ready and waiting</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NIS.NSSWITCH"
>13.7. Choosing the Right Maps</A
></H2
><P
>&#13;
Having made sure you can reach the NIS server, you have to decide which
configuration files to replace or augment with NIS maps. Commonly, you
will want to use NIS maps for the host and password lookup functions. The
former is especially useful if you do not have the BIND name service. The
password lookup lets all users log into their accounts from any system in the
NIS domain; this usually goes along with sharing a central
<TT
CLASS="FILENAME"
>/home</TT
> directory among all hosts via NFS. The password
map is explained detail in the next section. </P
><P
>Other maps, like <TT
CLASS="FILENAME"
>services.byname</TT
>, don't provide such
dramatic gains, but do save you some editing work. The
<TT
CLASS="FILENAME"
>services.byname</TT
> map is valuable if you install
any network applications that use a service name not in the standard
<TT
CLASS="FILENAME"
>services</TT
> file.</P
><P
>Generally, you want to have some choice of when a lookup function uses the
local files, when it queries the NIS server, and when it uses other servers 
such as DNS. GNU libc allows you to configure the order in which a function
accesses these services. This is controlled through the
<TT
CLASS="FILENAME"
>/etc/nsswitch.conf</TT
> file, which stands for
<EM
>Name Service Switch</EM
>, but of course isn't limited to
the name service. For any of the data lookup functions supported by GNU libc,
the file contains a line naming the services to use.</P
><P
>&#13;The right order of services depends on the type of data each service is 
offering. It is unlikely that the <TT
CLASS="FILENAME"
>services.byname</TT
> map 
will contain entries differing from those in the local 
<TT
CLASS="FILENAME"
>services</TT
> file; it will only contain additional entries. 
So it appears reasonable to query the local files first and check NIS only 
if the service name isn't found. Hostname information, on the other hand, 
may change very frequently, so DNS or the NIS server should always have the 
most accurate account, while the local <TT
CLASS="FILENAME"
>hosts</TT
> file is 
only kept as a backup if DNS and NIS should fail. For hostnames, therefore, 
you normally want to check the local file last.</P
><P
> 
 
 
The following example shows how to force <CODE
CLASS="FUNCTION"
>gethostbyname</CODE
>
and <CODE
CLASS="FUNCTION"
>gethostbyaddr</CODE
> to look in NIS and DNS before the
<TT
CLASS="FILENAME"
>hosts</TT
> file and how to have the
<CODE
CLASS="FUNCTION"
>getservbyname</CODE
> function look in the local files before
querying NIS. These resolver functions will try each of the listed services 
in turn; if a lookup succeeds, the result is returned; otherwise, they will 
try the next service in the list. The file setting for these priorities is:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># small sample /etc/nsswitch.conf
#
hosts:     nis dns files 
services:  files nis</PRE
></FONT
></TD
></TR
></TABLE
><P
>The following is a complete list of services and locations that may be used 
with an entry in the <TT
CLASS="FILENAME"
>nsswitch.conf</TT
> file. The actual maps,
files, servers, and objects queried depend on the entry name. The 
following can appear to the right of a colon: </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>nis</SPAN
></DT
><DD
><P
>Use the current domain NIS server. The location of the server queried
is configured in the <TT
CLASS="FILENAME"
>yp.conf</TT
> file, as shown in the
previous section.  For the <SPAN
CLASS="SYSTEMITEM"
>hosts</SPAN
> entry,
the <TT
CLASS="FILENAME"
>hosts.byname</TT
> and <TT
CLASS="FILENAME"
>hosts.byaddr</TT
> 
maps are queried.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>nisplus</SPAN
> or
<SPAN
CLASS="SYSTEMITEM"
>nis+</SPAN
></DT
><DD
><P
>Use the NIS+ server for this domain. The location of the server is obtained
from the <TT
CLASS="FILENAME"
>/etc/nis.conf</TT
> file.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>dns</SPAN
></DT
><DD
><P
>Use the DNS name server. This service type is useful only with the
<SPAN
CLASS="SYSTEMITEM"
>hosts</SPAN
> entry. The name servers queried
are still determined by the standard <TT
CLASS="FILENAME"
>resolv.conf</TT
> file.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>files</SPAN
></DT
><DD
><P
>Use the local file, such as the <TT
CLASS="FILENAME"
>/etc/hosts</TT
> file for the
<SPAN
CLASS="SYSTEMITEM"
>hosts</SPAN
> entry.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>compat</SPAN
></DT
><DD
><P
>Be compatible with older file formats. This option can be used when either 
NYS or glibc 2.x is used for NIS or NIS+ lookups. While these versions 
normally can't interpret older NIS entries in <TT
CLASS="FILENAME"
>passwd</TT
> 
and <TT
CLASS="FILENAME"
>group</TT
> files, 
<SPAN
CLASS="SYSTEMITEM"
>compat</SPAN
> option allows them to work with 
those formats.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>db</SPAN
></DT
><DD
><P
>Look up the information from DBM files located in the
<TT
CLASS="FILENAME"
>/var/db</TT
> directory. The corresponding NIS map name is used for that file.</P
></DD
></DL
></DIV
><P
>Currently, the NIS support in GNU libc caters to the following
<TT
CLASS="FILENAME"
>nsswitch.conf</TT
> databases:
<SPAN
CLASS="SYSTEMITEM"
>aliases</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>ethers.group</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>hosts</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>netgroup</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>network</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>passwd</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>protocols</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>publickey</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>rpc</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>services</SPAN
>, and
<SPAN
CLASS="SYSTEMITEM"
>shadow</SPAN
>.
More entries are likely to be added.</P
><P
><A
HREF="#X-087-2-NIS.FIG.SWITCH"
>Example 13-2</A
> shows a more complete example that
introduces another feature of <TT
CLASS="FILENAME"
>nsswitch.conf</TT
>. The
<SPAN
CLASS="SYSTEMITEM"
>[NOTFOUND=return]</SPAN
> keyword in the
<SPAN
CLASS="SYSTEMITEM"
>hosts</SPAN
> entry tells the NIS client to
return if the desired item couldn't be found in the NIS or DNS database. That
is, the NIS client will continue searching the local files
<EM
>only</EM
> if calls to the NIS and DNS servers fail for some
other reason. The local files will then be used only at boot time and as a
backup when the NIS server is down.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-NIS.FIG.SWITCH"
></A
><P
><B
>Example 13-2. Sample nsswitch.conf File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/nsswitch.conf
#
hosts:      nis dns [NOTFOUND=return] files
networks:   nis [NOTFOUND=return] files
services:   files nis
protocols:  files nis
rpc:        files nis</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>GNU libc provides some other actions that are described in the
<TT
CLASS="FILENAME"
>nsswitch</TT
> manpage.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NIS.PASSWD"
>13.8. Using the passwd and group Maps</A
></H2
><P
>&#13;


One of the major applications of NIS is synchronizing user and account
information on all hosts in an NIS domain. Consequently, you usually keep
only a small local <TT
CLASS="FILENAME"
>/etc/passwd</TT
> file, to which
site-wide information from the NIS maps is appended. However, simply
enabling NIS lookups for this service in <TT
CLASS="FILENAME"
>nsswitch.conf</TT
>
is not nearly enough.</P
><P
>When relying on the password information distributed by NIS, you first
have to make sure that the numeric user IDs of any users you have in
your local <TT
CLASS="FILENAME"
>passwd</TT
> file match the NIS server's idea of
user IDs. Consistency in user IDs is important for other purposes as
well, like mounting NFS volumes from other hosts in your network.</P
><P
> 
 
If any of the numeric IDs in <TT
CLASS="FILENAME"
>/etc/passwd</TT
> or
<TT
CLASS="FILENAME"
>/etc/group</TT
> differ from those in the maps, you have to
adjust file ownerships for all files that belong to that user. First, you
should change all uids and gids in <TT
CLASS="FILENAME"
>passwd</TT
> and
<TT
CLASS="FILENAME"
>group</TT
> to the new values, then find that all files
that belong to the users just changed and change their
ownership.  Assume <SPAN
CLASS="SYSTEMITEM"
>news</SPAN
>
used to have a user ID of 9 and <SPAN
CLASS="SYSTEMITEM"
>okir</SPAN
>
had a user ID of 103, which were changed to some other value; you could
then
issue the following commands as root:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>find / -uid   9 -print &#62;/tmp/uid.9</KBD
>
# <KBD
CLASS="USERINPUT"
>find / -uid 103 -print &#62;/tmp/uid.103</KBD
>
# <KBD
CLASS="USERINPUT"
>cat /tmp/uid.9   | xargs chown news</KBD
>
# <KBD
CLASS="USERINPUT"
>cat /tmp/uid.103 | xargs chown okir</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>It is important that you execute these commands with the new
<TT
CLASS="FILENAME"
>passwd</TT
> file installed, and that you collect all
filenames before you change the ownership of any of them. To update the
group ownerships of files, use a similar method with the gid instead of the 
uid, and chgrp instead of chown.</P
><P
>Once you do this, the numerical uids and gids on your system will
agree with those on all other hosts in your NIS domain.  The next step
is to add configuration lines to <TT
CLASS="FILENAME"
>nsswitch.conf</TT
>
that enable NIS lookups for user and group information:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/nsswitch.conf - passwd and group treatment
passwd: nis files
group:  nis files</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
> 
This affects where the <B
CLASS="COMMAND"
>login</B
> command and all its
friends look for user information. When a user tries to log in,
<B
CLASS="COMMAND"
>login</B
> queries the NIS maps first, and if this
lookup fails, falls back to the local files. Usually, you will remove
almost all users from your local files, and only leave entries for
<SPAN
CLASS="SYSTEMITEM"
>root</SPAN
> and generic accounts like
<SPAN
CLASS="SYSTEMITEM"
>mail</SPAN
> in it.  This is because
some vital system tasks may have to map uids to usernames or vice
versa.  For example, administrative <B
CLASS="COMMAND"
>cron</B
> jobs may
execute the <TT
CLASS="FILENAME"
>su</TT
> command to temporarily become
<SPAN
CLASS="SYSTEMITEM"
>news</SPAN
>, or the UUCP subsystem may
mail a status report.  If <SPAN
CLASS="SYSTEMITEM"
>news</SPAN
>
and <SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
> don't have entries in
the local <TT
CLASS="FILENAME"
>passwd</TT
> file, these jobs will fail
miserably during an NIS brownout.</P
><P
>Lastly, if you are using either the old NIS implementation (supported by the
<SPAN
CLASS="SYSTEMITEM"
>compat</SPAN
> mode for the
<TT
CLASS="FILENAME"
>passwd</TT
> and <TT
CLASS="FILENAME"
>group</TT
> files in the
NYS or glibc implementations), you must insert the unwieldy special entries
into them. These entries represent where the NIS derived records will
be inserted into the database of information. The entries can be added
anywhere, but are usually just added to the end. The entries to add for the 
<TT
CLASS="FILENAME"
>/etc/passwd</TT
> file are:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>+::::::</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

and for the <TT
CLASS="FILENAME"
>/etc/groups</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>+:::</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>With both glibc 2.x and NYS you can override parameters in a user&#8217;s 
record received from the NIS server by creating entries with a &#8220;+&#8221;
prepended to the login name, and exclude specified users by creating
entries with a &#8220;-&#8221; prepended to the login name.
For example the entries:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>+stuart::::::/bin/jacl</KBD
>
<KBD
CLASS="USERINPUT"
>-jedd::::::</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

would override the shell specified for the user
<SPAN
CLASS="SYSTEMITEM"
>stuart</SPAN
> supplied by the NIS server,
and would disallow the user <SPAN
CLASS="SYSTEMITEM"
>jedd</SPAN
> from
logging in on this machine. Any fields left blank use the information
supplied by the NIS server.</P
><P
>There are two big caveats in order here. First, the setup as described up to
here works only for login suites that don't use shadow passwords. The
intricacies of using shadow passwords with NIS will be discussed in the next 
section.
Second, the login commands are not the only ones that access the
<TT
CLASS="FILENAME"
>passwd</TT
> file&#8212;look at the <B
CLASS="COMMAND"
>ls</B
>
command, which most people use almost constantly. Whenever compiling a long
listing, <B
CLASS="COMMAND"
>ls</B
> displays the symbolic names for user
and group owners of a file; that is, for each uid and gid it encounters,
it has to query the NIS server. An NIS query takes slightly longer to
perform than the equivalent lookup in a local file. You may find that sharing
your <TT
CLASS="FILENAME"
>passwd</TT
> and <TT
CLASS="FILENAME"
>group</TT
> information
using NIS causes a noticable reduction in the performance of some programs that
use this information frequently.</P
><P
>Still, this is not the whole story. Imagine what happens if a user wants to
change her password. Usually, she will invoke <B
CLASS="COMMAND"
>passwd</B
>, which
reads the new password and updates the local <TT
CLASS="FILENAME"
>passwd</TT
> file.
This is impossible with NIS, since that file isn't available locally anymore,
but having users log into the NIS server whenever they want to change their
passwords is not an option, either. Therefore, NIS provides a drop-in
replacement for <B
CLASS="COMMAND"
>passwd</B
> called <B
CLASS="COMMAND"
>yppasswd</B
>,
which handles password changes under NIS. To change the password
on the server host, it contacts the <B
CLASS="COMMAND"
>yppasswdd</B
> daemon on
that host via RPC, and provides it with the updated password information.
Usually you install <B
CLASS="COMMAND"
>yppasswd</B
> over the normal program by
doing something like this:

 
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>cd /bin</KBD
>
# <KBD
CLASS="USERINPUT"
>mv passwd passwd.old</KBD
>
# <KBD
CLASS="USERINPUT"
>ln yppasswd passwd</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>At the same time, you have to install <B
CLASS="COMMAND"
>rpc.yppasswdd</B
> on the
server and start it from a network script. This will effectively hide any of
the contortions of NIS from your users.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NIS.SHADOW"
>13.9. Using NIS with Shadow Support</A
></H2
><P
>&#13; 
Using NIS in conjunction with shadow password files is somewhat problematic.
First we have some bad news: using NIS defeats the goals of shadow passwords. 
The <TT
CLASS="FILENAME"
>shadow</TT
> password scheme was designed to prevent 
nonroot users from having access to the encrypted form of the login 
passwords. Using NIS to share <TT
CLASS="FILENAME"
>shadow</TT
> data by necessity 
makes the encrypted passwords available to any user who can listen to the NIS 
server replies on the network. A policy to enforce users to choose 
&#8220;good&#8221; passwords is arguably better than trying to shadow 
passwords in an NIS environment. Let's take a quick look at how you do it, 
should you decide to forge on ahead.</P
><P
>In libc5 there is no real solution to sharing <TT
CLASS="FILENAME"
>shadow</TT
> data
using NIS. The only way to distribute password and user information by NIS is
through the standard <TT
CLASS="FILENAME"
>passwd.*</TT
> maps. If you do have
shadow passwords installed, the easiest way to share them is to generate a
proper <TT
CLASS="FILENAME"
>passwd</TT
> file from <TT
CLASS="FILENAME"
>/etc/shadow</TT
>
using tools like <B
CLASS="COMMAND"
>pwuncov</B
>, and create the NIS maps from
that file.</P
><P
>Of course, there are some hacks necessary to use NIS and shadow passwords at
the same time, for instance, by installing an <TT
CLASS="FILENAME"
>/etc/shadow</TT
>
file on each host in the network, while distributing user information, through
NIS. However, this hack is really crude and defies the goal of NIS,
which is to ease system administration.</P
><P
>&#13;
The NIS support in the GNU libc library (libc6) provides support for shadow
password databases. It does not provide any real solution to making your 
passwords accessible, but it does simplify password management in 
environments in which you do want to use NIS with shadow passwords.
To use it, you must create a <TT
CLASS="FILENAME"
>shadow.byname</TT
> database
and add the following line to your <TT
CLASS="FILENAME"
>/etc/nsswitch.conf</TT
>&#8201;:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
># Shadow password support</KBD
>
<KBD
CLASS="USERINPUT"
>shadow:         compat</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>If you use shadow passwords along with NIS, you must try to maintain some 
security by restricting access to your NIS database.  See <A
HREF="#X-087-2-NIS.SECURENETS"
>Section 13.5</A
>&#8221; earlier in this chapter.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-NFS"
></A
>Chapter 14. The NetworkFile System</H1
><P
>The Network File System (NFS) is probably the most prominent network
service using RPC. It allows you to access files on remote hosts in
exactly the same way you would access local files. A mixture of kernel
support and user-space daemons on the client side, along with an NFS
server on the server side, makes this possible. This file access is
completely transparent to the client and works across a variety of
server and host architectures.</P
><P
>NFS offers a number of useful features:

<P
></P
><UL
><LI
><P
>Data accessed by all users can be kept on a central host, with clients
mounting this directory at boot time. For example, you can keep all user
accounts on one host and have all hosts on your network mount
<TT
CLASS="FILENAME"
>/home</TT
> from that host. If NFS is installed beside
NIS, users can log into any system and still work on one set of files.</P
></LI
><LI
><P
>Data consuming large amounts of disk space can be kept on a single host. For
example, all files and programs relating to LaTeX and METAFONT can be kept
and maintained in one place.</P
></LI
><LI
><P
>Administrative data can be kept on a single host. There is no need to use
<B
CLASS="COMMAND"
>rcp</B
> to install the same stupid file on 20 different
machines.</P
></LI
></UL
></P
><P
>It's not too hard to set up basic NFS operation on both the client and
server; this chapter tells you how.</P
><P
>Linux NFS is largely the work of
Rick Sladkey, who wrote the NFS kernel code and large parts of the NFS server.<A
NAME="X-087-2-FNNF01"
HREF="#FTN.X-087-2-FNNF01"
><SPAN
CLASS="footnote"
>[79]</SPAN
></A
> The latter is derived from the <EM
>unfsd</EM
> user space NFS server, originally written by Mark Shand, and the <EM
>hnfs</EM
> Harris NFS server, written by Donald Becker.
&#13;</P
><P
>&#13;Let's have a look at how NFS works. First, a client tries to mount a
directory from a remote host on a local directory just the same way it
does a physical device.  However, the syntax used to specify the
remote directory is different. For example, to mount
<TT
CLASS="FILENAME"
>/home</TT
> from host <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> to <TT
CLASS="FILENAME"
>/users</TT
> on
<SPAN
CLASS="SYSTEMITEM"
>vale</SPAN
>, the administrator
issues the following command on <SPAN
CLASS="SYSTEMITEM"
>vale</SPAN
>:<A
NAME="X-087-2-FNNF02"
HREF="#FTN.X-087-2-FNNF02"
><SPAN
CLASS="footnote"
>[80]</SPAN
></A
>

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>mount -t nfs vlager:/home /users</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
> 
<B
CLASS="COMMAND"
>mount</B
> will try to connect to the
<B
CLASS="COMMAND"
>rpc.mountd</B
> mount daemon on
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> via RPC. The
server will check if <SPAN
CLASS="SYSTEMITEM"
>vale</SPAN
> is
permitted to mount the directory in question, and if so, return it a
file handle. This file handle will be used in all subsequent requests to
files below <TT
CLASS="FILENAME"
>/users</TT
>.</P
><P
>&#13;


When someone accesses a file over NFS, the kernel places an RPC call
to <B
CLASS="COMMAND"
>rpc.nfsd</B
> (the NFS daemon) on the server
machine. This call takes the file handle, the name of the file to be
accessed, and the user and group IDs of the user as parameters. These
are used in determining access rights to the specified file. In order
to prevent unauthorized users from reading or modifying files, user
and group IDs must be the same on both hosts.</P
><P
>On most Unix implementations, the NFS functionality of both client and
server is implemented as kernel-level daemons that are started from
user space at system boot. These are the <EM
>NFS Daemon</EM
> 
(<B
CLASS="COMMAND"
>rpc.nfsd</B
>&#8201;) on the server host, and the
<EM
>Block I/O Daemon</EM
>
(<B
CLASS="COMMAND"
>biod</B
>&#8201;) on the client host. To improve
throughput, <B
CLASS="COMMAND"
>biod</B
> performs asynchronous I/O using
read-ahead and write-behind; also, several <B
CLASS="COMMAND"
>rpc.nfsd</B
>
daemons are usually run concurrently.</P
><P
>&#13;
The current NFS implementation of Linux is a little different from the
classic NFS in that the server code runs entirely in user space, so
running multiple copies simultaneously is more complicated. The
current <B
CLASS="COMMAND"
>rpc.nfsd</B
> implementation offers an
experimental feature that allows limited support for multiple
servers. Olaf Kirch developed kernel-based NFS server support 
featured in 2.2 Version Linux kernels. Its performance is
significantly better than the existing userspace implementation. We'll
describe it later in this chapter.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NFS.NFSD"
>14.1. Preparing NFS</A
></H2
><P
>&#13;Before you can use NFS, be it as server or client, you must make sure your
kernel has NFS support compiled in. Newer kernels have a simple interface
on the <TT
CLASS="FILENAME"
>proc</TT
> filesystem for this, the
<TT
CLASS="FILENAME"
>/proc/filesystems</TT
> file, which you can display
using <B
CLASS="COMMAND"
>cat</B
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>cat /proc/filesystems</KBD
>
	minix
	ext2
	msdos
nodev	proc
nodev	nfs</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>If <SPAN
CLASS="SYSTEMITEM"
>nfs</SPAN
> is missing from this
list, you have to compile your own kernel with NFS enabled, or perhaps
you will need to load the kernel module if your NFS support was
compiled as a module.  Configuring the kernel network options is
explained in the &#8220;Kernel Configuration&#8221; section of <A
HREF="#X-087-2-HARDWARE"
>Chapter 3</A
>.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NFS.MOUNTD"
>14.2. Mounting an NFS Volume</A
></H2
><P
>&#13;


The mounting of NFS volumes closely resembles regular file
systems. Invoke <B
CLASS="COMMAND"
>mount</B
> using the following syntax:<A
NAME="X-087-2-FNNF05"
HREF="#FTN.X-087-2-FNNF05"
><SPAN
CLASS="footnote"
>[81]</SPAN
></A
>

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>mount -t nfs</KBD
> <TT
CLASS="REPLACEABLE"
><I
>nfs_volume local_dir options</I
></TT
> </PRE
></FONT
></TD
></TR
></TABLE
></P
><P
><TT
CLASS="REPLACEABLE"
><I
>nfs_volume</I
></TT
> is given as
<TT
CLASS="REPLACEABLE"
><I
>remote_host</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>remote_dir</I
></TT
>.
Since this notation is unique to NFS filesystems, you can leave out
the <CODE
CLASS="OPTION"
>&#8211;t nfs</CODE
> option.</P
><P
>&#13;There are a number of additional options that you can specify to
<B
CLASS="COMMAND"
>mount</B
> upon mounting an NFS volume. These may be
given either following the <CODE
CLASS="OPTION"
>&#8211;o</CODE
> switch on the
command line or in the options field of the
<TT
CLASS="FILENAME"
>/etc/fstab</TT
> entry for the volume.  In both cases,
multiple options are separated by commas and must not
contain any whitespace characters. Options specified on the command
line always override those given in the <TT
CLASS="FILENAME"
>fstab</TT
>
file.</P
><P
>Here is a sample entry from <TT
CLASS="FILENAME"
>/etc/fstab</TT
>&#8201;:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># volume              mount point       type  options
news:/var/spool/news  /var/spool/news   nfs   timeo=14,intr</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This volume can then be mounted using this command:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>mount news:/var/spool/news</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>In the absence of an <TT
CLASS="FILENAME"
>fstab</TT
> entry, NFS
<B
CLASS="COMMAND"
>mount</B
> invocations look a lot uglier. For instance,
suppose you mount your users' home directories from a machine named
<SPAN
CLASS="SYSTEMITEM"
>moonshot</SPAN
>, which uses a default
block size of 4 K for read/write operations. You might increase the
block size to 8 K to obtain better performance by issuing the command:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>mount moonshot:/home /home -o rsize=8192,wsize=8192</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;The list of all valid options is described in its entirety in the
<TT
CLASS="FILENAME"
>nfs(5)</TT
> manual page. The following is a partial list
of options you would probably want to use:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><EM
>rsize=n</EM
> and <EM
>wsize=n</EM
></DT
><DD
><P
>These specify the datagram size used by the NFS clients on read and write
requests, respectively. The default depends on the version of kernel, but
is normally 1,024 bytes.</P
></DD
><DT
><EM
>timeo=n</EM
></DT
><DD
><P
>This sets the time (in tenths of a second) the NFS client will wait for a
request to complete. The default value is 7 (0.7 seconds). What happens after
a timeout depends on whether you use the <EM
>hard</EM
> or 
<EM
>soft</EM
> option.</P
></DD
><DT
><EM
>hard</EM
></DT
><DD
><P
>Explicitly mark this volume as hard-mounted. This is on by default.
This option causes the server to report a message to the console when a
major timeout occurs and continues trying indefinitely.</P
></DD
><DT
><EM
>soft</EM
></DT
><DD
><P
>Soft-mount (as opposed to hard-mount) the driver. This option causes
an I/O error to be reported to the process attempting a file operation when
a major timeout occurs.</P
></DD
><DT
><EM
>intr</EM
></DT
><DD
><P
>Allow signals to interrupt an NFS call. Useful for aborting when the
server doesn't respond.</P
></DD
></DL
></DIV
></P
><P
>Except for <EM
>rsize</EM
> and <EM
>wsize</EM
>, all of these options
apply to the client's behavior if the server should become temporarily
inaccessible. They work together in the following way: Whenever the
client sends a request to the NFS server, it expects the operation to
have finished after a given interval (specified in the
<EM
>timeout</EM
> option). If no confirmation
is received within this time, a so-called <EM
>minor timeout</EM
>
occurs, and the operation is retried with the timeout interval doubled. After
reaching a maximum timeout of 60 seconds, a <EM
>major timeout</EM
>
occurs.</P
><P
>&#13;
By default, a major timeout causes the client to print a message
to the console and start all over again, this time with an initial
timeout interval twice that of the previous cascade. Potentially, this
may go on forever. Volumes that stubbornly retry an operation until
the server becomes available again are called
<EM
>hard-mounted</EM
>. The opposite variety, called
<EM
>soft-mounted</EM
>, generate an I/O error for the
calling process whenever a major timeout occurs. Because of the
write-behind introduced by the buffer cache, this error condition is
not propagated to the process itself before it calls the
<CODE
CLASS="FUNCTION"
>write</CODE
> function the next time, so a program can
never be sure that a write operation to a soft-mounted volume has
succeeded at all.</P
><P
>Whether you hard- or soft-mount a volume depends partly on taste but
also on the type of information you want to access from a volume. For
example, if you mount your X programs by NFS, you certainly would not
want your X session to go berserk just because someone brought the
network to a grinding halt by firing up seven copies of Doom at the
same time or by pulling the Ethernet plug for a moment. By
hard-mounting the directory containing these programs, you make sure
that your computer waits until it is able to re-establish contact
with your NFS server. On the other hand, non-critical data such as
NFS-mounted news partitions or FTP archives may also be
soft-mounted, so if the remote machine is temporarily unreachable or
down, it doesn't hang your session. If your network connection to the
server is flaky or goes through a loaded router, you may either
increase the initial timeout using the <EM
>timeo</EM
> option or hard-mount the
volumes. NFS volumes are hard-mounted by default.</P
><P
>Hard mounts present a problem because, by default, the file operations
are not interruptible. Thus, if a process attempts, for example, a
write to a remote server and that server is unreachable, the user's
application hangs and the user can't do anything to abort the
operation. If you use the <EM
>intr</EM
>
option in conjuction with a hard mount, any signals received by the
process interrupt the NFS call so that users can still abort
hanging file accesses and resume work (although without saving the
file).</P
><P
>Usually, the <B
CLASS="COMMAND"
>rpc.mountd</B
> daemon in some way or other
keeps track of which directories have been mounted by what hosts. This
information can be displayed using the <B
CLASS="COMMAND"
>showmount</B
>
program, which is also included in the NFS server package:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>showmount -e moonshot</KBD
>
Export list for localhost:
/home &#60;anon clnt&#62;

# <KBD
CLASS="USERINPUT"
>showmount -d moonshot</KBD
>
Directories on localhost:
/home

# <KBD
CLASS="USERINPUT"
>showmount -a moonshot</KBD
>
All mount points on localhost:
localhost:/home</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NFS.DAEMONS"
>14.3. The NFS Daemons</A
></H2
><P
>&#13;

If you want to provide NFS service to other hosts, you have to run the
<B
CLASS="COMMAND"
>rpc.nfsd</B
> and <B
CLASS="COMMAND"
>rpc.mountd</B
> daemons on your
machine. As RPC-based programs, they are not managed by
<B
CLASS="COMMAND"
>inetd</B
>, but are started up at boot time and register
themselves with the portmapper; therefore, you have to make sure to start them
only after <B
CLASS="COMMAND"
>rpc.portmap</B
> is running. Usually, you'd use
something like the following example in one of your network boot scripts:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>if [ -x /usr/sbin/rpc.mountd ]; then
        /usr/sbin/rpc.mountd; echo -n " mountd"
fi
if [ -x /usr/sbin/rpc.nfsd ]; then
        /usr/sbin/rpc.nfsd; echo -n " nfsd"
fi</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;The ownership information of the files an NFS daemon provides to its clients
usually contains only numerical user and group IDs.  If both client and server
associate the same user and group names with these numerical IDs, they are
said to their share uid/gid space. For example, this is the case when you
use NIS to distribute the <TT
CLASS="FILENAME"
>passwd</TT
> information to all
hosts on your LAN.</P
><P
>On some occasions, however, the IDs on different hosts do not
match. Rather than updating the uids and gids of the client to match
those of the server, you can use the <B
CLASS="COMMAND"
>rpc.ugidd</B
>
mapping daemon to work around the disparity.  Using the <EM
>map_daemon</EM
> option explained a little later, you can
tell <B
CLASS="COMMAND"
>rpc.nfsd</B
> to map the server's uid/gid space to
the client's uid/gid space with the aid of the
<B
CLASS="COMMAND"
>rpc.ugidd</B
> on the client. Unfortunately, the
<B
CLASS="COMMAND"
>rpc.ugidd</B
> daemon isn't supplied on all modern Linux
distributions, so if you need it and yours doesn't have it, you will need to
compile it from source.</P
><P
><B
CLASS="COMMAND"
>rpc.ugidd</B
> is an RPC-based server that is started from your
network boot scripts, just like <B
CLASS="COMMAND"
>rpc.nfsd</B
> and
<B
CLASS="COMMAND"
>rpc.mountd</B
>:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>if [ -x /usr/sbin/rpc.ugidd ]; then
        /usr/sbin/rpc.ugidd; echo -n " ugidd"
fi</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NFS.EXPORTS"
>14.4. The exports File</A
></H2
><P
>&#13;



 
Now we'll look at how we configure the NFS server. Specifically, we'll
look at how we tell the NFS server what filesystems it should make
available for mounting, and the various parameters that control the
access clients will have to the filesystem. The server determines the
type of access that is allowed to the server's files. The
<TT
CLASS="FILENAME"
>/etc/exports</TT
> file lists the filesystems that the
server will make available for clients to mount and use.</P
><P
>By default, <B
CLASS="COMMAND"
>rpc.mountd</B
> disallows all directory mounts,
which is a rather sensible attitude. If you wish to permit one or more hosts
to NFS-mount a directory, you must <EM
>export</EM
> it, that is,
specify it in the <TT
CLASS="FILENAME"
>exports</TT
> file. A sample file may look
like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># exports file for vlager
/home             vale(rw) vstout(rw) vlight(rw)
/usr/X11R6        vale(ro) vstout(ro) vlight(ro)
/usr/TeX          vale(ro) vstout(ro) vlight(ro)
/                 vale(rw,no_root_squash)
/home/ftp         (ro)</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Each line defines a directory and the hosts that are allowed to mount it.  A
hostname is usually a fully qualified domain name but may additionally
contain the <SPAN
CLASS="SYSTEMITEM"
>*</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>?</SPAN
> wildcards, which act the way they
do with the Bourne shell. For instance, <TT
CLASS="LITERAL"
>lab*.foo.com</TT
>
matches <SPAN
CLASS="SYSTEMITEM"
>lab01.foo.com</SPAN
> as well as
<SPAN
CLASS="SYSTEMITEM"
>laboratory.foo.com</SPAN
>. The host may also
be specified using an IP address range in the form
<TT
CLASS="REPLACEABLE"
><I
>address</I
></TT
>/<TT
CLASS="REPLACEABLE"
><I
>netmask</I
></TT
>. If
no hostname is given, as with the <TT
CLASS="FILENAME"
>/home/ftp</TT
> directory
in the previous example, any host matches and is allowed to mount the
directory.</P
><P
>When checking a client host against the <TT
CLASS="FILENAME"
>exports</TT
> file,
<B
CLASS="COMMAND"
>rpx.mountd</B
> looks up the client's hostname using the
<CODE
CLASS="FUNCTION"
>gethostbyaddr</CODE
> call. With DNS, this call returns the
client's canonical hostname, so you must make sure not to use aliases in
<TT
CLASS="FILENAME"
>exports</TT
>. In an NIS environment the returned name is
the first match from the hosts database, and with neither DNS or NIS, the
returned name is the first hostname found in the <TT
CLASS="FILENAME"
>hosts</TT
>
file that matches the client's address.</P
><P
>The hostname is followed by an optional comma-separated list of flags,
enclosed in parentheses. Some of the values these flags may take are:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><EM
>secure</EM
></DT
><DD
><P
>This flag insists that requests be made from a reserved source port,
i.e., one that is less than 1,024. This flag is set by default.</P
></DD
><DT
><EM
>insecure</EM
></DT
><DD
><P
>This flag reverses the effect of the
<EM
>secure</EM
> flag.</P
></DD
><DT
><EM
>ro</EM
></DT
><DD
><P
>This flag causes the NFS mount to be read-only. This flag is enabled
by default.</P
></DD
><DT
><EM
>rw</EM
></DT
><DD
><P
>This option mounts file hierarchy read-write.</P
></DD
><DT
><EM
>root_squash</EM
></DT
><DD
><P
>&#13;This security feature denies the superusers on the specified hosts any
special access rights by mapping requests from uid 0 on the client to
the uid 65534 (that is, -2) on the server. This uid should be
associated with the user <SPAN
CLASS="SYSTEMITEM"
>nobody</SPAN
>.</P
></DD
><DT
><EM
>no_root_squash</EM
></DT
><DD
><P
>Don't map requests from uid 0.  This option is on by default, so
superusers have superuser access to your system's exported
directories.</P
></DD
><DT
><EM
>link_relative</EM
></DT
><DD
><P
>This option converts absolute symbolic links (where the link contents
start with a slash) into relative links. This option makes sense only
when a host's entire filesystem is mounted; otherwise, some of the
links might point to nowhere, or even worse, to files they were never
meant to point to. This option is on by default.</P
></DD
><DT
><EM
>link_absolute</EM
></DT
><DD
><P
>This option leaves all symbolic links as they are (the normal behavior
for Sun-supplied NFS servers).</P
></DD
><DT
><EM
>map_identity</EM
></DT
><DD
><P
>&#13;This option tells the server to assume that the client uses the same
uids and gids as the server. This option is on by default.</P
></DD
><DT
><EM
>map_daemon</EM
></DT
><DD
><P
>This option tells the NFS server to assume that client and server do not
share the same uid/gid space.  <B
CLASS="COMMAND"
>rpc.nfsd</B
> then builds a
list that maps IDs between client and server by querying the client's
<B
CLASS="COMMAND"
>rpc.ugidd</B
> daemon.</P
></DD
><DT
><EM
>map_static</EM
></DT
><DD
><P
>This option allows you to specify the name of a file that contains a
static map of uids and gids. For example,
<TT
CLASS="LITERAL"
>map_static=/etc/nfs/vlight.map</TT
> would specify the
<TT
CLASS="FILENAME"
>/etc/nfs/vlight.map</TT
> file as a uid/gid map. The
syntax of the map file is described in the
<TT
CLASS="FILENAME"
>exports(5)</TT
> manual page.</P
></DD
><DT
><EM
>map_nis</EM
></DT
><DD
><P
>This option causes the NIS server to do the uid and gid mapping.</P
></DD
><DT
><EM
>anonuid</EM
> and <EM
>anongid</EM
></DT
><DD
><P
>These options allow you to specify the uid and gid of the anonymous account.
This is useful if you have a volume exported for public mounts.</P
></DD
></DL
></DIV
></P
><P
>&#13;Any error in parsing the <TT
CLASS="FILENAME"
>exports</TT
> file is reported
to <B
CLASS="COMMAND"
>syslogd</B
>&#8201;'s <SPAN
CLASS="SYSTEMITEM"
>daemon</SPAN
> facility at level <SPAN
CLASS="SYSTEMITEM"
>notice</SPAN
> whenever
<B
CLASS="COMMAND"
>rpc.nfsd</B
> or <B
CLASS="COMMAND"
>rpc.mountd</B
> is
started up.</P
><P
>Note that hostnames are obtained from the client's IP address by
reverse mapping, so the resolver must be configured properly.
If you use BIND and are very security conscious, you should enable spoof
checking in your <TT
CLASS="FILENAME"
>host.conf</TT
> file. We discuss these
topics in <A
HREF="#X-087-2-RESOLV"
>Chapter 6</A
>.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NFS.KERNELV2"
>14.5. Kernel-Based NFSv2 Server Support</A
></H2
><P
>&#13;


The user-space NFS server traditionally used in Linux works reliably but
suffers performance problems when overworked. This is primarily because
of the overhead the system call interface adds to its operation, and because
it must compete for time with other, potentially less important, user-space
processes.</P
><P
>&#13;



The 2.2.0 kernel supports an experimental kernel-based NFS server developed
by Olaf Kirch and further developed by H.J. Lu, G. Allan Morris, and Trond
Myklebust. The kernel-based NFS support provides a significant boost in server
performance.</P
><P
>In current release distributions, you may find the server tools
available in prepackaged form. If not, you can locate them at
<SPAN
CLASS="SYSTEMITEM"
>http://csua.berkeley.edu/~gam3/knfsd/</SPAN
>.  You need to 
build a 2.2.0 kernel with the kernel-based NFS daemon
included in order to make use of the tools. You can check if your
kernel has the NFS daemon included by looking to see if the
<TT
CLASS="FILENAME"
>/proc/sys/sunrpc/nfsd_debug</TT
> file exists. If it's
not there, you may have to load the <B
CLASS="COMMAND"
>rpc.nfsd</B
> module
using the <B
CLASS="COMMAND"
>modprobe</B
> utility.</P
><P
>The kernel-based NFS daemon uses a standard
<TT
CLASS="FILENAME"
>/etc/exports</TT
> configuration file. The package
supplies replacement versions of the <B
CLASS="COMMAND"
>rpc.mountd</B
> and
<B
CLASS="COMMAND"
>rpc.nfsd</B
> daemons that you start much the same way
as their userspace daemon counterparts.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NFS.KERNELV3"
>14.6. Kernel-Based NFSv3 Server Support</A
></H2
><P
>The version of NFS that has been most commonly used is NFS Version 2.
Technology has rolled on ahead and it has begun to show weaknesses that only a
revision of the protocol could overcome. Version 3 of the Network File System
supports larger files and filesystems, adds significantly enhanced security,
and offers a number of performance improvements that most users will find
useful.</P
><P
>Olaf Kirch and Trond Myklebust are developing an experimental NFSv3 server. It is featured in the developer Version 2.3 kernels and a patch is
available against the 2.2 kernel source. It builds on the Version 2
kernel-based NFS daemon.</P
><P
>The patches are available from the Linux Kernel based NFS server home page at
<SPAN
CLASS="SYSTEMITEM"
>http://csua.berkeley.edu/~gam3/knfsd/</SPAN
>.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-IPX"
></A
>Chapter 15. IPX and the NCP Filesystem</H1
><P
>&#13;
Long before Microsoft learned about networking, and even before the
Internet was known outside academic circles, corporate environments
shared files and printers using file and print servers based on the
Novell NetWare operating system and associated protocols.<A
NAME="X-087-2-FNIX01"
HREF="#FTN.X-087-2-FNIX01"
><SPAN
CLASS="footnote"
>[82]</SPAN
></A
> Many of these corporate users
still have legacy networks using these protocols and want to integrate
this support with their new TCP/IP support.</P
><P
>Linux supports not only the TCP/IP protocols, but also the suite of
protocols used by the Novell Corporation's NetWare operating
system. These protocols are distant cousins of TCP/IP, and while they
perform similar sorts of functions, they differ in a number of ways
and are unfortunately incompatible.</P
><P
>Linux has both free and commercial software offerings to provide support 
for integration with the Novell products.&#13;</P
><P
>We'll provide a brief description of the protocols themselves in this
chapter, but we focus on how to configure and use free software to
allow Linux to interoperate with Novell products.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN11750"
>15.1. Xerox, Novell, and History</A
></H2
><P
>&#13;



 
First, let's look at where the protocols came from and what they look
like.  In the late 1970s, the Xerox Corporation developed and
published an open standard called the Xerox Network Specification
(XNS). The Xerox Network Specification described a series of protocols
designed for general purpose internetworking, with a strong emphasis
on the use of local area networks. There were two primary networking
protocols involved: the Internet Datagram Protocol (IDP), which
provided a connectionless and unreliable transport of datagrams from
one host to another, and the Sequenced Packet Protocol (SPP), which
was a modified form of IDP that was connection-based and reliable. The
datagrams of an XNS network were individually addressed. The
addressing scheme used a combination of a 4-byte IDP network
address (which was uniquely assigned to each Ethernet LAN segment),
and the 6-byte node address (the address of the NIC card).  Routers
were devices that switched datagrams between two or more separate IDP
networks. IDP has no notion of subnetworks; any new collection of
hosts requires another network address to be assigned. Network
addresses are chosen such that they are unique on the internetwork in
question. Sometimes administrators develop conventions by having each
byte encode some other information, such as geographic location, so that
network addresses are allocated in a systemic way; it isn't a
protocol requirement, however.</P
><P
>&#13;




The Novell Corporation chose to base their own networking suite on the
XNS suite. Novell made small enhancements to IDP and SPP and renamed
them IPX (Internet Packet eXchange) and SPX (Sequenced Packet
eXchange).  Novell added new protocols, such as the NetWare Core
Protocol (NCP), which provided file and printer sharing features that
ran over IPX, and the Service Advertisement Protocol (SAP), which
enabled hosts on a Novell network to know which hosts provided which
services.</P
><P
>&#13;<A
HREF="#X-087-2-IX.PROTOCOL.FAMILY"
>Table 15-1</A
> maps the relationship between
the XNS, Novell, and TCP/IP suites in terms of function. The relationships
are an approximation only, but should help you understand what is
happening when we refer to these protocols later on.</P
><DIV
CLASS="TABLE"
><A
NAME="X-087-2-IX.PROTOCOL.FAMILY"
></A
><P
><B
>Table 15-1. XNS, Novell, and TCP/IP Protocol Relationships</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><COL><COL><THEAD
><TR
><TH
>XNS</TH
><TH
>Novell</TH
><TH
>TCP/IP</TH
><TH
>Features</TH
></TR
></THEAD
><TBODY
><TR
><TD
>IDP</TD
><TD
>IPX</TD
><TD
>UDP/IP</TD
><TD
>Connectionless, unreliable transport</TD
></TR
><TR
><TD
>SPP</TD
><TD
>SPX</TD
><TD
>TCP</TD
><TD
>Connection-based, reliable transport</TD
></TR
><TR
><TD
></TD
><TD
>NCP</TD
><TD
>NFS</TD
><TD
>File services</TD
></TR
><TR
><TD
></TD
><TD
>RIP</TD
><TD
>RIP</TD
><TD
>Routing information exchange</TD
></TR
><TR
><TD
></TD
><TD
>SAP</TD
><TD
></TD
><TD
>Service availability information exchange</TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN11823"
>15.2. IPX and Linux</A
></H2
><P
>&#13;



Alan Cox first developed IPX support for the Linux kernel in
1985.<A
NAME="X-087-2-FNIX02"
HREF="#FTN.X-087-2-FNIX02"
><SPAN
CLASS="footnote"
>[83]</SPAN
></A
> Initially it was useful for little more than
routing IPX datagrams. Since then, other people, notably Greg Page,
have provided additional support.<A
NAME="X-087-2-FNIX03"
HREF="#FTN.X-087-2-FNIX03"
><SPAN
CLASS="footnote"
>[84]</SPAN
></A
>
Greg developed the IPX configuration utilities that we'll use in this chapter
to configure our interfaces. Volker Lendecke developed support for the NCP
filesystem to allow Linux to mount volumes on network-connected NetWare
fileservers.<A
NAME="X-087-2-FNIX04"
HREF="#FTN.X-087-2-FNIX04"
><SPAN
CLASS="footnote"
>[85]</SPAN
></A
>
He also created tools that allow printing to and from Linux. Ales
Dryak and Martin Stover each independently developed NCP fileserver
daemons for Linux that allow network-connected NetWare clients to
mount Linux directories exported as NCP volumes, just as the NFS
daemon allows Linux to serve filesystems to clients using the NFS
protocol.<A
NAME="X-087-2-FNIX05"
HREF="#FTN.X-087-2-FNIX05"
><SPAN
CLASS="footnote"
>[86]</SPAN
></A
> Caldera Systems, Inc. offers a commercial and fully
licensed NetWare client and server that supports the latest Novell
standards, including support for the NetWare Directory Service
(NDS).<A
NAME="X-087-2-FNIX07"
HREF="#FTN.X-087-2-FNIX07"
><SPAN
CLASS="footnote"
>[87]</SPAN
></A
></P
><P
>Today, therefore, Linux supports a wide range of services that allow
systems to be integrated with existing Novell-based networks.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN11853"
>15.2.1. Caldera Support</A
></H3
><P
>&#13;
Although we don't detail the Caldera NetWare support in this
chapter, it is important that we talk about it. Caldera was founded
by Ray Noorda, the former CEO of Novell. The Caldera NetWare support is a
commercial product and fully supported by Caldera. Caldera provides the
NetWare support as a component of their own Linux distribution called
Caldera OpenLinux. The Caldera solution is an ideal way of introducing Linux
into environments that demand both commercial support and the ability to
integrate into existing or new Novell networks.</P
><P
>The Caldera NetWare support is fully licensed by Novell, providing a
high degree of certainty that the two companies' products will be
interoperable.  The two exceptions to this certainty are "pure IP" operation for the client, and NDS server, though neither of these were available at
the time of writing. NetWare client and NetWare server are both available. A
suite of management tools is also provided that can simplify
management of not only your Linux-based NetWare machines, but your
Novell NetWare machines, too, by bringing the power of Unix scripting
languages to the task. More information on Caldera can be found at
their web site.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN11862"
>15.2.2. More on NDS Support</A
></H3
><P
>&#13;Along with Version 4 of NetWare, Novell introduced a feature called
the NetWare Directory Service (NDS). The NDS specifications are not
available without a nondisclosure agreement, a restriction that
hampers development of free support. Only Version 2.2.0 or later of
the <TT
CLASS="FILENAME"
>ncpfs</TT
> package, which we'll discuss later, has
any support for NDS. This support was developed by reverse engineering
the NDS protocol. The support seems to work, but is still officially
considered experimental. You can use the non-NDS tools with NetWare 4
servers, provided they have &#8220;bindery emulation mode&#8221;
enabled.</P
><P
>The Caldera software has full support for NDS because their implementation
is licensed from Novell. This implementation is not free, however. So
you will not have access to the source code and will not be able to
freely copy and distribute the software.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IPX.KERNEL"
>15.3. Configuring the Kernel for IPXand NCPFS</A
></H2
><P
>Configuring the kernel for IPX and the NCP filesystem is simply a matter of
selecting the appropriate kernel options at kernel build time. As with many
other parts of the kernel, IPX and NCPFS kernel components can be built into
the kernel, or compiled as modules and loaded using the
<B
CLASS="COMMAND"
>insmod</B
> command when you need them.</P
><P
>The following options must be selected if you want to have Linux support and
route the IPX protocol:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>General setup  ---&#62;
    [*] Networking support

Networking options  ---&#62;
    &#60;*&#62; The IPX protocol

Network device support  ---&#62;
    [*] Ethernet (10 or 100Mbit)
	... and appropriate Ethernet device drivers</PRE
></FONT
></TD
></TR
></TABLE
>

If you want Linux to support the NCP filesystem so it can mount remote
NetWare volumes, you must additionally select these options:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Filesystems  ---&#62;
    [*] /proc filesystem support
    &#60;*&#62; NCP filesystem support (to mount NetWare volumes)</PRE
></FONT
></TD
></TR
></TABLE
>

When you've compiled and installed your new kernel, you're ready to
run IPX.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IPX.INTERFACES"
>15.4. Configuring IPX Interfaces</A
></H2
><P
>Just as with TCP/IP, you must configure your IPX interfaces before you
can use them. The IPX protocol has some unique requirements;
consequently, a special set of configuration tools was developed. We
will use these tools to configure our IPX interfaces and routes.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IPX.DEVICES"
>15.4.1. Network Devices Supporting IPX</A
></H3
><P
>The IPX protocol assumes that any collection of hosts that can
transmit datagrams to each other without routing belong to the same
IPX network. All hosts belonging to a single Ethernet segment would
all belong to the same IPX network. Similarly (but less intuitively),
both hosts supporting a PPP-based serial link must belong to the IPX
network that is the serial link itself. In an Ethernet environment,
there are a number of different frame types that may be used to carry
IPX datagrams. The frame types represent different Ethernet protocols
and describe differing ways of carrying multiple protocols on the same
Ethernet network. The most common frame types you will encounter are
<TT
CLASS="LITERAL"
>802.2</TT
> and <TT
CLASS="LITERAL"
>ethernet_II</TT
>. We'll
talk more about frame types in the next section.</P
><P
>The Linux network devices that currently support the IPX protocol are the
Ethernet and PPP drivers. The Ethernet or PPP interface must be
active before it can be configured for IPX use. Typically, you configure an Ethernet device with both IP and IPX, so the device already exists, but if your 
network is IPX only, you need to use the <B
CLASS="COMMAND"
>ifconfig</B
> to change the Ethernet device status to the following:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ifconfig eth0 up</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IPX.TOOLS"
>15.4.2. IPX Interface Configuration Tools</A
></H3
><P
>Greg Page developed a set of configuration tools for IPX interfaces,
which is a precompiled package in modern distributions and may
also be obtained in source form by anonymous FTP from
<EM
>http://metalab.unc.edu/</EM
> in the
<TT
CLASS="FILENAME"
>/pub/Linux/system/filesystems/ncpfs/ipx.tgz</TT
>
file.</P
><P
>An <TT
CLASS="FILENAME"
>rc</TT
> script file usually runs the IPX tools at
boot time. Your distribution may already do this for you if you have
installed the prepackaged software.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IPX.IPX-CONFIGURE"
>15.4.3. The ipx_configure Command</A
></H3
><P
>Each IPX interface must know which IPX network it belongs to and which
frame type to use for IPX. Each host supporting IPX has at least one
interface that the rest of the network will use to refer to it, known
as the <I
CLASS="FIRSTTERM"
>primary</I
> interface. The Linux kernel IPX
support provides a means of automatically configuring these
parameters; the <B
CLASS="COMMAND"
>ipx_configure</B
> command enables or
disables this automatic configuration feature.</P
><P
>With no arguments, the <B
CLASS="COMMAND"
>ipx_configure</B
> command displays the
current setting of the automatic configuration flags:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipx_configure</KBD
>
Auto Primary Select is OFF
Auto Interface Create is OFF</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Both the Auto Primary and Auto Interface flags
are off by default. To set them and enable automatic configuration, you
simply supply arguments like these:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipx_configure --auto_interface=on --auto_primary=on</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>When the <TT
CLASS="LITERAL"
>-&#8201;-auto_&#8201;primary</TT
> argument is set to
<TT
CLASS="LITERAL"
>on</TT
>, the kernel will automatically ensure that at
least one active interface operates as the primary interface for the
host.</P
><P
>When the <TT
CLASS="LITERAL"
>-&#8201;-auto_interface</TT
> argument is
set to <TT
CLASS="LITERAL"
>on</TT
>, the kernel IPX driver will listen to all of the
frames received on the active network interfaces and attempt to determine
the IPX network address and frame type used.</P
><P
>The auto-detection mechanism works well on properly managed networks.
Sometimes network administrators take shortcuts and break rules, and
this can cause problems for the Linux auto-detection code. The most common
example of this is when one IPX network is configured to run over the same
Ethernet with multiple frame types. This is technically an invalid
configuration, as an <EM
>802.2</EM
> host cannot directly communicate with an
Ethernet-II host and therefore they cannot be on the same IPX network.
The Linux IPX network software listens on the segment to IPX datagrams
transmitted on it. From these, it attempts to identify which network
addresses are in use and which frame type is associated with each. If the
same network address is in use with multiple frame types or on multiple
interfaces, the Linux code detects this as a network address collision
and is unable to determine which is the correct frame type. You will know
this is occurring if you see messages in your system log that look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>IPX: Network number collision 0x3901ab00
eth0 etherII and eth0 802.3</PRE
></FONT
></TD
></TR
></TABLE
>

If you see this problem, disable the auto-detection
feature and configure the interfaces manually using the
<B
CLASS="COMMAND"
>ipx_interface</B
> command described in the next section.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-IPX.IPX-INTERFACE"
>15.4.4. The ipx_interface Command</A
></H3
><P
>The <B
CLASS="COMMAND"
>ipx_interface</B
> command is used to manually add,
modify, and delete IPX capability from an existing network device. You
should use <B
CLASS="COMMAND"
>ipx_interface</B
> when the automatic
configuration method just described does not work for you, or if you
don't want to leave your interface configuration to
chance. <B
CLASS="COMMAND"
>ipx_interface</B
> allows you to specify the IPX
network address, primary interface status, and IPX frame type that a
network device will use. If you are creating multiple IPX interfaces,
you need one <B
CLASS="COMMAND"
>ipx_interface</B
> for each.</P
><P
>The command syntax to add IPX to an existing device is straightforward
and best explained with an example. Let's add IPX to an existing
Ethernet device:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipx_interface add -p eth0 etherII 0x32a10103</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>
The parameters in turn mean:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>-p</DT
><DD
><P
>This parameter specifies that this interface should be a primary interface.
This parameter is optional.</P
></DD
><DT
>eth0</DT
><DD
><P
>This is the name of the network device to which we are adding IPX support.</P
></DD
><DT
>etherII</DT
><DD
><P
>This parameter is the frame type, in this case Ethernet-II. This value
may also be coded as <TT
CLASS="LITERAL"
>802.2</TT
>,
<TT
CLASS="LITERAL"
>802.3</TT
>, or <TT
CLASS="LITERAL"
>SNAP</TT
>.</P
></DD
><DT
>0x32a10103</DT
><DD
><P
>This is the IPX network address to which this interface belongs.</P
></DD
></DL
></DIV
>&#13;</P
><P
>The following command removes IPX from an interface:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipx_interface del eth0 etherII</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Lastly, to display the current IPX configuration of a network device,
use:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipx_interface check eth0 etherII</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <B
CLASS="COMMAND"
>ipx_interface</B
> command is explained more fully in its
manual page.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IPX.ROUTER"
>15.5. Configuring an IPX Router</A
></H2
><P
>You will recall from our short discussion of the protocols used in an
IPX environment that IPX is a routable protocol and that the Routing
Information Protocol (RIP) is used to propagate routing
information. The IPX version of RIP is quite similar to the IP
version. They operate in essentially the same way; routers
periodically broadcast the contents of their routing tables and other
routers learn of them by listening and integrating the information
they receive. Hosts need only know who their local network is and be
sure to send datagrams for all other destinations via their local
router. The router is responsible for carrying these datagrams and
forwarding them on to the next hop in the route.</P
><P
>&#13;
In an IPX environment, a second class of information must be
propagated around the network. The Service Advertisement Protocol
(SAP) carries information relating to which services are available at
which hosts around the network. It is the SAP protocol, for example,
that allows users to obtain lists of file or print servers on the
network. The SAP protocol works by having hosts that provide services
periodically broadcast the list of services they offer. The IPX
network routers collect this information and propagate it throughout
the network alongside the network routing information.  To be a
compliant IPX router, you must propagate both RIP and SAP information.</P
><P
>&#13;Just like IP, IPX on Linux provides a routing daemon named
<B
CLASS="COMMAND"
>ipxd</B
> to perform the tasks associated with managing
routing. Again, just as with IP, it is actually the kernel that
manages the forwarding of datagrams between IPX network interfaces,
but it performs this according to a set of rules called the IPX
routing table.  The <B
CLASS="COMMAND"
>ipxd</B
> daemon keeps that set of
rules up to date by listening on each of the active network interfaces
and analyzing when a routing change is necessary. The
<B
CLASS="COMMAND"
>ipxd</B
> daemon also answers requests from hosts on a
directly connected network that ask for routing information.</P
><P
>The <B
CLASS="COMMAND"
>ipxd</B
> command is available prepackaged in some
distributions, and in source form by anonymous FTP from 
<EM
>http://metalab.unc.edu/</EM
> in the
<TT
CLASS="FILENAME"
>/pub/Linux/system/filesystems/ncpfs/ipxripd-x.xx.tgz</TT
>
file.</P
><P
>No configuration is necessary for the <B
CLASS="COMMAND"
>ipxd</B
> daemon.
When it starts, it automatically manages routing among the IPX
devices that have been configured. The key is to ensure that you have
your IPX devices configured correctly using the
<B
CLASS="COMMAND"
>ipx_interface</B
> command before you start
<B
CLASS="COMMAND"
>ipxd</B
>. While auto-detection may work, when you're
performing a routing function it's best not to take chances, so
manually configure the interfaces and save yourself the pain of nasty
routing problems. Every 30 seconds, <B
CLASS="COMMAND"
>ipxd</B
>
rediscovers all of the locally attached IPX networks and automatically
manages them. This provides a means of managing networks on interfaces
that may not be active all of the time, such as PPP interfaces.</P
><P
>The <B
CLASS="COMMAND"
>ipxd</B
> would normally be started at boot time from
an <TT
CLASS="FILENAME"
>rc</TT
> boot script like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>/usr/sbin/ipxd</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

No <TT
CLASS="LITERAL"
>&#38;</TT
> character is necessary because <B
CLASS="COMMAND"
>ipxd</B
> will
move itself into the background by default. While the
<B
CLASS="COMMAND"
>ipxd</B
> daemon is most useful on machines acting as
IPX routers, it is also useful to hosts on segments where there are
multiple routers present. When you specify the
<TT
CLASS="LITERAL"
>&#8211;p</TT
> argument, <B
CLASS="COMMAND"
>ipxd</B
> will act
passively, listening to routing information from the segment and
updating the routing tables, but it will not transmit any routing
information. This way, a host can keep its routing tables up to date
without having to request routes each time it wants to contact a
remote host.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN12023"
>15.5.1. Static IPX Routing Using the ipx_route Command</A
></H3
><P
>&#13;There are occasions when we might want to hardcode an IPX
route. Just as with IP, we can do this with IPX. The
<B
CLASS="COMMAND"
>ipx_route</B
> command writes a route into the IPX
routing table without it needing to have been learned by the
<B
CLASS="COMMAND"
>ipxd</B
> routing daemon. The routing syntax is very
simple (since IPX does not support subnetworking) and looks like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipx_route add 203a41bc 31a10103 00002a02b102</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

The command shown would add a route to the remote IPX network
<EM
>203a41bc</EM
> via the router on our local network
<EM
>31a10103</EM
> with node address <EM
>00002a02b102</EM
>.</P
><P
>You can find the node address of a router by making judicious use of
the <B
CLASS="COMMAND"
>tcpdump</B
> command with the
<TT
CLASS="LITERAL"
>&#8211;e</TT
> argument to display link level
headers and look for traffic from the router. If the router is a Linux
machine, you can more simply use the <B
CLASS="COMMAND"
>ifconfig</B
>
command to display it.</P
><P
>You can delete a route using the <B
CLASS="COMMAND"
>ipx_route</B
> command:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipx_route del 203a41bc</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;You can list the routes that are active in the kernel by looking at
the <TT
CLASS="FILENAME"
>/proc/net/ipx_route</TT
> file. Our routing table
so far looks like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>cat ipx_route</KBD
>
Network    Router_Net   Router_Node
203A41BC   31A10103     00002a02b102
31A10103   Directly     Connected</PRE
></FONT
></TD
></TR
></TABLE
>

The route to the <EM
>31A10103</EM
> network was automatically created when we configured the IPX interface. Each of our local
networks will be represented by an <TT
CLASS="FILENAME"
>/proc/net/ipx_route</TT
> 
entry like this one. Naturally, if our machine is to act as a router, it will 
need at least one other interface.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN12051"
>15.5.2. Internal IPX Networks and Routing</A
></H3
><P
>&#13;IPX hosts with more than one IPX interface have a unique network/node
address combination for each of their interfaces. To connect to such a
host, you may use any of these network/node address combinations. When
SAP advertizes services, it supplies the network/node address
associated with the service that is offered. On hosts with multiple
interfaces, this means that one of the interfaces must be chosen as the
one to propagate; this is the function of the primary interface flag
we talked about earlier. But this presents a problem: the route to
this interface may not always be the optimal one, and if a network
failure occurs that isolates that network from the rest of the
network, the host will become unreachable even though there are other
<EM
>possible</EM
> routes to the other interfaces.  The
other routes are never known to other hosts because they are never
propagated, and the kernel has no way of knowing that it should choose
another primary interface. To avoid this problem, a device was
developed that allows an IPX host to be known by a single
route-independent network/node address for the purposes of SAP
propagation. This solves our problem because this new network/node
address is reachable via all of the host interfaces, and is the one
that is advertised by SAP.</P
><P
>To illustrate the problem and its solution, <A
HREF="#X-087-2-IPX.INTERNAL.NETWORK"
>Figure 15-1</A
> shows a server attached to two
IPX networks. The first network has no internal network, but the second
does. The host in diagram <A
HREF="#X-087-2-IPX.INTERNAL.NETWORK"
>Figure 15-1</A
> would 
choose one of its interfaces as its primary interface, let's assume
<EM
>0000001a:0800000010aa</EM
>, and that is what 
would be advertised as its service access point. This works well for hosts
on the <EM
>0000001a</EM
> network, but means that 
users on the <EM
>0000002c</EM
> network will route via 
the network to reach that port, despite the server having a port directly on 
that network if they've discovered this server from the SAP broadcasts.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-IPX.INTERNAL.NETWORK"
></A
><P
><B
>Figure 15-1. IPX internal network</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_1501.jpg"></P
></DIV
></DIV
><P
>Allowing such hosts to have a virtual network with virtual host
addresses that are entirely a software construct solves this
problem. This virtual network is best thought of as being
<EM
>inside</EM
> the IPX host. The SAP information then
needs only to be propagated for this virtual network/node address
combination. This virtual network is known as an <EM
>internal
network</EM
>. But how do other hosts know how to reach this
internal network? Remote hosts route to the internal network via
the directly connected networks of the host. This means that you 
see routing entries that refer to the internal network of hosts
supporting multiple IPX interfaces. Those routes should choose the
optimal route available at the time, and should one fail, the routing is 
automatically updated to the next best interface and route. In
<A
HREF="#X-087-2-IPX.INTERNAL.NETWORK"
>Figure 15-1</A
>, we've configured an
internal IPX network of address <EM
>0x10000010</EM
> 
and used a host address of <EM
>00:00:00:00:00:01</EM
>. It is this address that will be our primary interface and will be advertised via SAP. Our routing will reflect this network as being reachable via
<EM
>either</EM
> of our real network ports, so hosts will
always use the best network route to connect to our server.</P
><P
>To create this internal network, use the
<B
CLASS="COMMAND"
>ipx_internal_net</B
> command included in Greg Page's
IPX tools package. Again, a simple example demonstrates its use:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipx_internal_net add 10000010 000000000001</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

This command would create an IPX internal network with address
<EM
>10000010</EM
> and a node address of
<EM
>000000000001</EM
>. The network address, just like any other
IPX network address, must be unique on your network. The node address is
completely arbitrary, as there will normally be only one node on the network.
Each host may have only one IPX Internal Network, and if configured, the
Internal Network will always be the primary network.</P
><P
>To delete an IPX Internal Network, use:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ipx_internal_net del</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>An internal IPX network is of absolutely no use to you unless your host both
provides a service and has more than one IPX interface active.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IPX.NCPFS.CLIENT"
>15.6. Mounting a Remote NetWare Volume</A
></H2
><P
>IPX is commonly used to mount NetWare volumes in the Linux
filesystem. This allows file-based data sharing between other
operating systems and Linux. Volker Lendecke developed the NCP client
for Linux and a suite of associated tools that make data sharing
possible.</P
><P
>In an NFS environment, we'd use the Linux <B
CLASS="COMMAND"
>mount</B
>
command to mount the remote filesystem. Unfortunately, the NCP
filesystem has unique requirements that make it impractical to build
it into the normal <B
CLASS="COMMAND"
>mount</B
>. Linux has an
<B
CLASS="COMMAND"
>ncpmount</B
> command that we will use instead. The
<B
CLASS="COMMAND"
>ncpmount</B
> command is one of the tools in Volker's
<TT
CLASS="FILENAME"
>ncpfs</TT
> package, which is available prepackaged in
most modern distributions or in source form from <SPAN
CLASS="SYSTEMITEM"
>ftp.gwdg.de</SPAN
> in the
<TT
CLASS="FILENAME"
>/pub/linux/misc/ncpfs/</TT
> directory. The version
current at the time of writing is 2.2.0.</P
><P
>Before you can mount remote NetWare volumes, you must ensure your IPX network
interface is configured correctly (as described earlier). Next, you must know
your login details on the NetWare server you wish to mount; this includes
the user ID and password. Lastly, you need to know which volume you wish
to mount and what local directory you wish to mount it under.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN12106"
>15.6.1. A Simple ncpmount Example</A
></H3
><P
>&#13;A simple example of <B
CLASS="COMMAND"
>ncpmount</B
> usage looks like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ncpmount -S ALES_F1 -U rick -P d00-b-gud /mnt/brewery</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

This command mounts all volumes of the <TT
CLASS="LITERAL"
>ALES_F1</TT
>
fileserver under the <TT
CLASS="FILENAME"
>/mnt/brewery</TT
> directory,
using the NetWare login <TT
CLASS="LITERAL"
>rick</TT
> with the password
<TT
CLASS="LITERAL"
>d00-b-gud</TT
>.</P
><P
>The <B
CLASS="COMMAND"
>ncpmount</B
> command is normally setuid to
<SPAN
CLASS="SYSTEMITEM"
>root</SPAN
> and may therefore be used
by any Linux user. By default, that user owns the connection and
only he or the <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
> user will
be able to unmount it.</P
><P
>NetWare embodies the notion of a <EM
>volume</EM
>, which is
analogous to a filesystem in Linux. A NetWare volume is the logical
representation of a NetWare filesystem, which might be a single disk
partition be spread across many partitions. By default, the
Linux NCPFS support treats volumes as subdirectories of a larger
logical filesystem represented by the whole fileserver. The
<B
CLASS="COMMAND"
>ncpmount</B
> command causes each of the NetWare
volumes of the mounted fileserver to appear as a subdirectory under
the mount point. This is convenient if you want access to the whole
server, but for complex technical reasons you will be unable to
re-export these directories using NFS, should you wish to do so. We'll
discuss a more complex alternative that works around this problem in a
moment.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN12126"
>15.6.2. The ncpmount Command in Detail</A
></H3
><P
>&#13;The <B
CLASS="COMMAND"
>ncpmount</B
> has a large number of command line options
that allow you quite a lot of flexibility in how you manage your NCP mounts.
The most important of these are described in
<A
HREF="#X-087-2-IPX.NCPMOUNT.ARGS"
>Table 15-2</A
>.</P
><DIV
CLASS="TABLE"
><A
NAME="X-087-2-IPX.NCPMOUNT.ARGS"
></A
><P
><B
>Table 15-2. ncpmount Command Arguments</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL
WIDTH="1"><COL
WIDTH="3"><THEAD
><TR
><TH
>Argument</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><P
>&#8211;S <TT
CLASS="REPLACEABLE"
><I
>server</I
></TT
></P
></TD
><TD
><P
>The name of the fileserver to mount.</P
></TD
></TR
><TR
><TD
><P
>&#8211;U <TT
CLASS="REPLACEABLE"
><I
>user_name</I
></TT
></P
></TD
><TD
><P
>The NetWare user ID to use when logging in to the fileserver.</P
></TD
></TR
><TR
><TD
><P
>&#8211;P  <TT
CLASS="REPLACEABLE"
><I
>password</I
></TT
></P
></TD
><TD
><P
>The password to use for the NetWare login.</P
></TD
></TR
><TR
><TD
>&#8211;n</TD
><TD
><P
>This option must be used for NetWare logins that don't have a password
associated with them.</P
></TD
></TR
><TR
><TD
>&#8211;C</TD
><TD
><P
>This argument disables automatic conversion of passwords to uppercase.</P
></TD
></TR
><TR
><TD
>&#8211;c <TT
CLASS="REPLACEABLE"
><I
>client_name</I
></TT
></TD
><TD
><P
>This option allows you to specify who owns the connection to the
fileserver. This is useful for NetWare printing, which we will discuss in
more detail later.</P
></TD
></TR
><TR
><TD
>&#8211;u <TT
CLASS="REPLACEABLE"
><I
>uid</I
></TT
></TD
><TD
><P
>The Linux user ID that should be shown as the owner of files in the
mounted directory.  If this is not specified, it defaults to the
user ID of the user who invokes the <B
CLASS="COMMAND"
>ncpmount</B
>
command.</P
></TD
></TR
><TR
><TD
>&#8211;g <TT
CLASS="REPLACEABLE"
><I
>gid</I
></TT
></TD
><TD
><P
>The Linux group ID that should be shown as the owner of files in the
mounted directory.  If this is not specified, it will default to the
group ID of the user who invokes the <B
CLASS="COMMAND"
>ncpmount</B
>
command.</P
></TD
></TR
><TR
><TD
>&#8211;f <TT
CLASS="REPLACEABLE"
><I
>file_mode</I
></TT
></TD
><TD
><P
>This option allows you to specify the file mode (permissions) that
files in the mounted directory should have. The value should be
specified in octal, e.g., <TT
CLASS="LITERAL"
>0664</TT
>. The permissions
that you will actually have are the file mode permissions
specified with this option masked with the permissions that your
NetWare login ID has for the files on the fileserver.  You must have
rights on the server and rights specified by this option in order to
access a file. The default value is derived from the current
<TT
CLASS="LITERAL"
>umask</TT
>.</P
></TD
></TR
><TR
><TD
>&#8211;d <TT
CLASS="REPLACEABLE"
><I
>dir_mode</I
></TT
></TD
><TD
><P
>This option allows you to specify the directory permissions in the
mounted directory. It behaves in the same way as the
<EM
>&#8211;f</EM
> option, except that the default permissions are
derived from the current <TT
CLASS="LITERAL"
>umask</TT
>. Execute permissions
are granted where read access is granted.</P
></TD
></TR
><TR
><TD
>&#8211;V <TT
CLASS="REPLACEABLE"
><I
>volume</I
></TT
></TD
><TD
><P
>This option allows you to specify the name of a single NetWare
volume to mount under the mount point, rather than mounting all volumes of
the target server. This option is necessary if you wish to re-export a
mounted NetWare volume using NFS.</P
></TD
></TR
><TR
><TD
>&#8211;t <TT
CLASS="REPLACEABLE"
><I
>time_out</I
></TT
></TD
><TD
><P
>This option allows you to specify the time that the NCPFS client will wait
for a response from a server. The default value is 60mS and the timeout is
specified in hundredths of a second. If you experience any stability problems
with NCP mounts, you should try increasing this value.</P
></TD
></TR
><TR
><TD
>&#8211;r <TT
CLASS="REPLACEABLE"
><I
>retry_count</I
></TT
></TD
><TD
><P
>The NCP client code attempts to resend datagrams to the server
a number of times before deciding the connection is dead. This option allows
you to change the retry count from the default of 5.</P
></TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN12216"
>15.6.3. Hiding Your NetWare Login Password</A
></H3
><P
>&#13;It is somewhat of a security risk to be putting a password on the
command line, as we did with the <B
CLASS="COMMAND"
>ncpmount</B
> command.
Other active, concurrent users could see the password if they happen
to be running a program like <B
CLASS="COMMAND"
>top</B
> or
<B
CLASS="COMMAND"
>ps</B
>. To reduce the risk of others seeing and
stealing NetWare login passwords, <B
CLASS="COMMAND"
>ncpmount</B
> is able
to read certain details from a file in a user's home directory. In
this file, the user keeps the login name and password associated with
each of the fileservers he or she intends to mount. The file is called
<TT
CLASS="FILENAME"
>~/.nwclient</TT
> and it must have permissions of
<TT
CLASS="LITERAL"
>0600</TT
> to ensure that others cannot read it. If the
permissions are not correct, the <B
CLASS="COMMAND"
>ncpmount</B
> command
will refuse to use it.</P
><P
>The file has a very simple syntax. Any lines beginning with a #
character are treated as comments and ignored.
The remainder of the lines have the syntax:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="REPLACEABLE"
><I
>fileserver</I
></TT
>/<TT
CLASS="REPLACEABLE"
><I
>userid</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>password</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
>

The <TT
CLASS="REPLACEABLE"
><I
>fileserver</I
></TT
> is the name of the
fileserver supporting the volumes you wish to mount. The
<TT
CLASS="REPLACEABLE"
><I
>userid</I
></TT
> is the login name of your account on
that server. The <TT
CLASS="REPLACEABLE"
><I
>password</I
></TT
> field is
optional. If it is not supplied, the <B
CLASS="COMMAND"
>ncpmount</B
>
command prompts users for the password when they attempt the
mount. If the <TT
CLASS="REPLACEABLE"
><I
>password</I
></TT
> field is specified
as the &#8211; character, no password is used; this is equivalent
to the <TT
CLASS="LITERAL"
>&#8211;n</TT
> command-line argument.</P
><P
>You can supply any number of entries, but the fileserver field must be
unique. The first fileserver entry has special significance. The
<B
CLASS="COMMAND"
>ncpmount</B
> command uses the <TT
CLASS="LITERAL"
>&#8211;S</TT
>
command-line argument to determine which of the entries in
<TT
CLASS="FILENAME"
>~/.nwclient</TT
> to use. If no server is specified
using the <TT
CLASS="LITERAL"
>&#8211;S</TT
> argument, the first server entry
in <TT
CLASS="FILENAME"
>~/.nwclient</TT
> is assumed, and is treated as your
preferred server. You should place the fileserver you mount most
frequently in the first position in the file.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN12246"
>15.6.4. A More Complex ncpmount Example</A
></H3
><P
>&#13;
Let's look at a more complex <B
CLASS="COMMAND"
>ncpmount</B
> example involving
a number of the features we've described. First, let's build a simple
<TT
CLASS="FILENAME"
>~/.nwclient</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># NetWare login details for the Virtual Brewery and Winery
#
# Brewery Login
ALES_F1/MATT staoic1
#
# Winery Login
REDS01/MATT staoic1
#</PRE
></FONT
></TD
></TR
></TABLE
>
Make sure its permissions are correct:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>chmod 600 ~/.nwclient</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Let's mount one volume of the Winery's server under a subdirectory of a
shared directory, specifying the file and directory permissions such that
others may share the data from there:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ ncpmount -S REDS01 -V RESEARCH -f 0664 -d 0775 /usr/share/winery/data/</PRE
></FONT
></TD
></TR
></TABLE
>

This command, in combination with the <TT
CLASS="FILENAME"
>~/.nwclient</TT
> file
shown, would mount the <TT
CLASS="LITERAL"
>RESEARCH</TT
> volume of the
<TT
CLASS="LITERAL"
>REDS01</TT
> server onto the
<TT
CLASS="FILENAME"
>/usr/share/winery/data/</TT
> directory using the NetWare
login ID of <TT
CLASS="LITERAL"
>MATT</TT
> and the password retrieved
from the <TT
CLASS="FILENAME"
>~/.nwclient</TT
> file. The permissions of the
mounted files are <TT
CLASS="LITERAL"
>0664</TT
> and the directory permissions
are <TT
CLASS="LITERAL"
>0775</TT
>.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IPX.OTHERTOOLS"
>15.7. Exploring Some of the Other IPX Tools</A
></H2
><P
>The <TT
CLASS="FILENAME"
>ncpfs</TT
> package contains a number of useful
tools that we haven't described yet. Many of these tools emulate the
tools that are supplied with NetWare. We'll look at the most useful
ones in this section.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN12275"
>15.7.1. Server List</A
></H3
><P
>&#13;
The <B
CLASS="COMMAND"
>slist</B
> command lists all of the fileservers accessible
to the host. The information is actually retrieved from the nearest
IPX router. This command was probably originally intended to allow users to
see what fileservers were available to mount. But it has become useful as a
network diagnosis tool, allowing network admins to see where SAP information
is being propagated:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ slist
NPPWR-31-CD01                               23A91330  000000000001
V242X-14-F02                                A3062DB0  000000000001
QITG_284ELI05_F4                            78A20430  000000000001
QRWMA-04-F16                                B2030D6A  000000000001
VWPDE-02-F08                                35540430  000000000001
NMCS_33PARK08_F2                            248B0530  000000000001
NCCRD-00-CD01                               21790430  000000000001
NWGNG-F07                                   53171D02  000000000001
QCON_7TOMLI04_F7                            72760630  000000000001
W639W-F04                                   D1014D0E  000000000001
QCON_481GYM0G_F1                            77690130  000000000001
VITG_SOE-MAIL_F4R                           33200C30  000000000001</PRE
></FONT
></TD
></TR
></TABLE
><P
><B
CLASS="COMMAND"
>slist</B
> accepts no arguments. The output displays
the fileserver name, the IPX network address, and the host address.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN12288"
>15.7.2. Send Messages to NetWare Users</A
></H3
><P
>&#13;
NetWare supports a mechanism to send messages to logged-in users. The
<B
CLASS="COMMAND"
>nsend</B
> command implements this feature in Linux. You must
be logged in to the server to send messages, so you need to supply the
fileserver name and login details on the command line with the destination
user and the message to send:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>nsend -S vbrew_f1 -U gary -P j0yj0y supervisor
      &#8220;Join me for a lager before we do the print queues!&#8221;</KBD
></PRE
></FONT
></TD
></TR
></TABLE
><P
>Here a user with login name <TT
CLASS="LITERAL"
>gary</TT
> sends a tempting
invitation to the person using the <TT
CLASS="LITERAL"
>supervisor</TT
>
account on the <TT
CLASS="LITERAL"
>ALES_F1</TT
> fileserver. Our default
fileserver and login credentials will be used if we don't supply them.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN12304"
>15.7.3. Browsing and Manipulating Bindery Data</A
></H3
><P
>&#13;Each NetWare fileserver maintains a database of information about its
users and configuration. This database is called the
<EM
>bindery</EM
>. Linux supports a set of tools that allow
you to read it, and if you have supervisor permissions on the server, to set
and remove it. A summary of these tools is listed in 
<A
HREF="#X-087-2-CHIX-BINDERYTOOLS"
>Table 15-3</A
>.</P
><DIV
CLASS="TABLE"
><A
NAME="X-087-2-CHIX-BINDERYTOOLS"
></A
><P
><B
>Table 15-3. Linux Bindery Manipulation Tools</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL
WIDTH="1"><COL
WIDTH="3"><THEAD
><TR
><TH
>Command Name</TH
><TH
>Command Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><B
CLASS="COMMAND"
>nwfstime</B
></TD
><TD
><P
>Display or set a NetWare server's date and time</P
></TD
></TR
><TR
><TD
><B
CLASS="COMMAND"
>nwuserlist</B
></TD
><TD
><P
>List users logged in at a NetWare server</P
></TD
></TR
><TR
><TD
><B
CLASS="COMMAND"
>nwvolinfo</B
></TD
><TD
><P
>Display info about NetWare volumes</P
></TD
></TR
><TR
><TD
><B
CLASS="COMMAND"
>nwbocreate</B
></TD
><TD
><P
>Create a NetWare bindery object</P
></TD
></TR
><TR
><TD
><B
CLASS="COMMAND"
>nwbols</B
></TD
><TD
><P
>List NetWare bindery objects</P
></TD
></TR
><TR
><TD
><B
CLASS="COMMAND"
>nwboprops</B
></TD
><TD
><P
>List properties of a NetWare bindery object</P
></TD
></TR
><TR
><TD
><B
CLASS="COMMAND"
>nwborm</B
></TD
><TD
><P
>Remove a NetWare bindery object</P
></TD
></TR
><TR
><TD
><B
CLASS="COMMAND"
>nwbpcreate</B
></TD
><TD
><P
>Create a NetWare bindery property</P
></TD
></TR
><TR
><TD
><B
CLASS="COMMAND"
>nwbpvalues</B
></TD
><TD
><P
>Print a NetWare bindery property's contents</P
></TD
></TR
><TR
><TD
><B
CLASS="COMMAND"
>nwbpadd</B
></TD
><TD
><P
>Set the value of a NetWare bindery property</P
></TD
></TR
><TR
><TD
><B
CLASS="COMMAND"
>nwbprm</B
></TD
><TD
><P
>Remove a NetWare bindery property</P
></TD
></TR
></TBODY
></TABLE
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IPX.NCPFS.PRINTING"
>15.8. Printing to a NetWare Print Queue</A
></H2
><P
>The <TT
CLASS="FILENAME"
>ncpfs</TT
> package contains a small utility called
<B
CLASS="COMMAND"
>nprint</B
> that sends print jobs across an NCP
connection to a NetWare print queue.  This command creates the
connection if it doesn't currently exist and uses the
<TT
CLASS="FILENAME"
>~/.nwclient</TT
> file that we described earlier to
hide the username and password from prying eyes. The command-line
arguments used to manage the login process are the same as those used
by the <B
CLASS="COMMAND"
>ncpmount</B
>, so we won't go through those again
here.  We will cover the most important command-line options in our
examples; refer to the <TT
CLASS="FILENAME"
>nprint(1)</TT
> manual page for
details.</P
><P
>The only required option for <B
CLASS="COMMAND"
>nprint</B
> is the name of
the file to print. If the filename specified is &#8211; or if no filename
is specified at all, <B
CLASS="COMMAND"
>nprint</B
> will accept the print job
from <TT
CLASS="LITERAL"
>stdin</TT
>. The most important <B
CLASS="COMMAND"
>nprint</B
>
options specify the fileserver and print queue to which you wish the job to be
sent. <A
HREF="#X-087-2-IPX.NPRINT.OPTIONS"
>Table 15-4</A
> lists the most
important options.</P
><DIV
CLASS="TABLE"
><A
NAME="X-087-2-IPX.NPRINT.OPTIONS"
></A
><P
><B
>Table 15-4. nprint Command-Line Options</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL
WIDTH="1"><COL
WIDTH="3"><THEAD
><TR
><TH
>Option</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
>-S <TT
CLASS="REPLACEABLE"
><I
>server_name</I
></TT
></TD
><TD
><P
>The name of the NetWare fileserver supporting the print queue to which you wish
to print. Usually it is convenient for the server to have an entry in
<TT
CLASS="FILENAME"
>~/.nwclient</TT
>. This option is mandatory.</P
></TD
></TR
><TR
><TD
>-q <TT
CLASS="REPLACEABLE"
><I
>queue_name</I
></TT
></TD
><TD
><P
>The print queue to which to send the print job. This option is mandatory.</P
></TD
></TR
><TR
><TD
>-d <TT
CLASS="REPLACEABLE"
><I
>job_description</I
></TT
></TD
><TD
><P
>Text that will appear in the print console utility when displaying the
list of queued jobs.</P
></TD
></TR
><TR
><TD
>-l <TT
CLASS="REPLACEABLE"
><I
>lines</I
></TT
></TD
><TD
><P
>The number of lines per printed page. This defaults to 66.</P
></TD
></TR
><TR
><TD
>-r <TT
CLASS="REPLACEABLE"
><I
>columns</I
></TT
></TD
><TD
><P
>The number of columns per printed page. This defaults to 80.</P
></TD
></TR
><TR
><TD
>-c <TT
CLASS="REPLACEABLE"
><I
>copies</I
></TT
></TD
><TD
><P
>The number of copies of the job that will be printed. The default is 1.</P
></TD
></TR
></TBODY
></TABLE
></DIV
><P
>A simple example using <B
CLASS="COMMAND"
>nprint</B
> would look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ nprint -S REDS01 -q PSLASER -c 2 /home/matt/ethylene.ps</PRE
></FONT
></TD
></TR
></TABLE
>

This command would print two copies of the file
<TT
CLASS="FILENAME"
>/home/matt/ethylene.ps</TT
> to the printer named
<TT
CLASS="LITERAL"
>PSLASER</TT
> on the <TT
CLASS="LITERAL"
>REDS01</TT
>
fileserver using a username and password obtained from the
<TT
CLASS="FILENAME"
>~/.nwclient</TT
> file.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN12445"
>15.8.1. Using nprint with the Line Printer Daemon</A
></H3
><P
>&#13;
You will recall we previously mentioned that the
<CODE
CLASS="OPTION"
>&#8211;c</CODE
> option for the <B
CLASS="COMMAND"
>ncpmount</B
>
is useful for printing. At last we'll explain why and how.</P
><P
>Linux usually uses BSD-style line printer software. The line printer daemon
(<B
CLASS="COMMAND"
>lpd</B
>&#8201;) is a daemon that checks a local spool directory
for queued jobs that are to be printed. <B
CLASS="COMMAND"
>lpd</B
> reads the
printer name and some other parameters from the specially formatted spool
file and writes the data to the printer, optionally passing the data
through a filter to transform or manipulate it in some way.</P
><P
>The <B
CLASS="COMMAND"
>lpd</B
> daemon uses a simple database called
<TT
CLASS="FILENAME"
>/etc/printcap</TT
> to store printer configuration
information, including what filters are to be
run. <B
CLASS="COMMAND"
>lpd</B
> usually runs with the permissions of a
special system user called <SPAN
CLASS="SYSTEMITEM"
>lp</SPAN
>.</P
><P
>You could configure <B
CLASS="COMMAND"
>nprint</B
> as a filter for
the <B
CLASS="COMMAND"
>lpd</B
> to use, which allows users of your Linux machine to
output directly to remote printers hosted by a NetWare fileserver. To do this,
the <SPAN
CLASS="SYSTEMITEM"
>lp</SPAN
> user must be able to write NCP
requests to the NCP connection to the server.</P
><P
>An easy way to achieve this without requiring the
<SPAN
CLASS="SYSTEMITEM"
>lp</SPAN
> user to establish its own connection
and login is to specify <SPAN
CLASS="SYSTEMITEM"
>lp</SPAN
> as the owner
of a connection established by another user. A complete example of how to set 
up the Linux printing system to handle print jobs from clients over NetWare is listed in three steps:</P
><P
></P
><OL
TYPE="1"
><LI
><P
>Write a wrapper script.</P
><P
>The <TT
CLASS="FILENAME"
>/etc/printcap</TT
> file doesn't permit options to
be supplied to filters. Therefore, you need to write a short script
that invokes the command you want along with its options.  The wrapper
script could be as simple as:
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#!/bin/sh
# p2pslaser - simple script to redirect stdin to the
# PSLASER queue on the REDS01 server
#
/usr/bin/nprint -S REDS01 -U stuart -q PSLASER
#</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Store the script in the file <TT
CLASS="FILENAME"
>/usr/local/bin/p2pslaser</TT
>.</P
></LI
><LI
><P
>Write the <TT
CLASS="FILENAME"
>/etc/printcap</TT
> entry.</P
><P
>We'll need to configure the <TT
CLASS="FILENAME"
>p2pslaser</TT
> script we
created as the output filter in the <TT
CLASS="FILENAME"
>/etc/printcap</TT
>.
This would look something like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>pslaser|Postscript Laser Printer hosted by NetWare server:\                     
:lp=/dev/null:\                                                         
:sd=/var/spool/lpd/pslaser:\                                            
:if=/usr/local/bin/p2pslaser:\
:af=/var/log/lp-acct:\
:lf=/var/log/lp-errs:\
:pl#66:\                                                                
:pw#80:\                                                                
:pc#150:\                                                               
:mx#0:\                                                                 
:sh:                                                                    </PRE
></FONT
></TD
></TR
></TABLE
></P
></LI
><LI
><P
>Add the <CODE
CLASS="OPTION"
>&#8211;c</CODE
> option to the <B
CLASS="COMMAND"
>ncpmount</B
>.</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ncpmount -S REDS01 .... -c lp ....</PRE
></FONT
></TD
></TR
></TABLE
><P
>Our local user <SPAN
CLASS="SYSTEMITEM"
>stuart</SPAN
> must specify
the <SPAN
CLASS="SYSTEMITEM"
>lp</SPAN
> user as the owner of the
connection when he mounts the remote NetWare server.</P
></LI
></OL
><P
>Now any Linux user may choose to specify <TT
CLASS="LITERAL"
>pslaser</TT
> as the printer name
when invoking <EM
>lp</EM
>. The print job will be sent
to the specified NetWare server and spooled for printing.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN12496"
>15.8.2. Managing Print Queues</A
></H3
><P
>&#13;
The <B
CLASS="COMMAND"
>pqlist</B
> command lists all of the print queues available
to you on the specified server. If you do not specify a fileserver on
the command line using the <CODE
CLASS="OPTION"
>-S</CODE
> option, or a login name and
password, these will be taken from the default entry in your
<TT
CLASS="FILENAME"
>~/.nwclient</TT
> file:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>pqlist -S vbrew_f1 -U guest -n</KBD
>
Server: ALES_F1
Print queue name                                    Queue ID  
------------------------------------------------------------
TEST                                                AA02009E
Q2                                                  EF0200D9
NPI223761_P1                                        DA03007C
Q1                                                  F1060004
I-DATA                                              0D0A003B
NPI223761_P3                                        D80A0031</PRE
></FONT
></TD
></TR
></TABLE
><P
>Our example shows a list of the print queues available to the
<TT
CLASS="LITERAL"
>guest</TT
> user on the <TT
CLASS="LITERAL"
>ALES_F1</TT
>
fileserver.<A
NAME="X-087-2-FNIX09"
HREF="#FTN.X-087-2-FNIX09"
><SPAN
CLASS="footnote"
>[88]</SPAN
></A
></P
><P
>&#13;To view the print jobs on a print queue, use the
<B
CLASS="COMMAND"
>pqstat</B
> command. It takes the
print queue name as an argument and lists all of the jobs in that queue.
You may optionally supply another argument indicating how many of the jobs
in the queue you'd like to list. The following sample output has been
compressed a bit to fit the width of this book's page:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ pqstat -S ALES_F1 NPI223761_P1

Server: ALES_F1     Queue: NPI223761_P1          Queue ID: 6A0E000C
   Seq  Name      Description                    Status   Form  Job ID  
------------------------------------------------------------------------
     1  TOTRAN    LyX document - proposal.lyx    Active      0  02660001</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>We can see just one print job in the queue, owned by user
<TT
CLASS="LITERAL"
>TOTRAN</TT
>. The rest of the options include a
description of the job, its status, and its job identifier.</P
><P
>The <B
CLASS="COMMAND"
>pqrm</B
> command is used to remove print jobs from
a specified print queue. To remove the job in the queue we've just
obtained the status of, we'd use:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ pqrm -S ALES_F1 NPI223761_P1 02660001</PRE
></FONT
></TD
></TR
></TABLE
><P
>The command is pretty straightforward but is clumsy to use in a hurry. It
would be a worthwhile project to write a basic script to simplify this
operation.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-IPX.NCPFS.SERVER"
>15.9. NetWare Server Emulation</A
></H2
><P
>&#13;



There are two free software emulators for NetWare fileservers under
Linux. <B
CLASS="COMMAND"
>lwared</B
> was developed by Ales Dryak and
<B
CLASS="COMMAND"
>mars_nwe</B
> was developed by Martin Stover. Both of
these packages provide elementary NetWare fileserver emulation under
Linux, allowing NetWare clients to mount Linux directories exported as
NetWare volumes. While the <B
CLASS="COMMAND"
>lwared</B
> server is 
simpler to configure, the <B
CLASS="COMMAND"
>mars_nwe</B
> server is 
more fully featured. The installation and configuration of these packages is
beyond the scope of this chapter, but both are described in the
IPX-HOWTO.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-UUCP"
></A
>Chapter 16. ManagingTaylor UUCP</H1
><P
>UUCP was designed in the late seventies by Mike Lesk at AT&#38;T Bell
Laboratories to provide a simple dialup network over public telephone
lines. Despite the popularity of dialup PPP and SLIP connections to the
Internet, many people who want to have email and Usenet News on their home
machine still use UUCP because it is often cheaper, especially in countries
where Internet users have to pay by the minute for local telephone calls, or 
where they do not have a local ISP and must pay long distance toll rates to 
connect. Although there are many implementations of UUCP running on a wide 
variety of hardware platforms and operating systems, overall, they are highly 
compatible.</P
><P
>However, as with most software that has somehow become &#8220;standard&#8221;
over the years, there is no UUCP that one would call <EM
>the</EM
>
UUCP. It has undergone a steady evolution since the first version was
implemented in 1976.  Currently, there are two major species that differ
mainly in their hardware support and configuration. Of these two,
various implementations exist, each varying slightly from its siblings.</P
><P
>One species is known as Version 2 UUCP, which dates back to a 1977
implementation by Mike Lesk, David A. Novitz, and Greg Chesson. Although it
is fairly old, it is still frequently used. Recent implementations of
Version 2 provide much of the comfort that the newer UUCP species do.</P
><P
>The second species was developed in 1983 and is commonly referred to
as BNU (Basic Networking Utilities) or HoneyDanBer UUCP. The latter
name is derived from the authors' names (P. Honeyman, D. A. Novitz,
and B. E. Redman) and is often shortened further to HDB, which is the
term we'll use in this chapter. HDB was conceived to eliminate some of
Version 2 UUCP's deficiencies.  For example, new transfer protocols
were added, and the spool directory was split so that now there is one
directory for each site with which you have UUCP traffic.</P
><P
>&#13;The implementation of UUCP currently distributed with Linux is Taylor
UUCP 1.06, which is the version this
chapter is based upon.<A
NAME="X-087-2-FNUU01"
HREF="#FTN.X-087-2-FNUU01"
><SPAN
CLASS="footnote"
>[89]</SPAN
></A
>  Taylor UUCP Version 1.06 was released in August 1995.
Apart from traditional configuration files, Taylor UUCP can also be compiled
to understand the newstyle&#8212;a.k.a. Taylor&#8212;configuration files.</P
><P
>Taylor UUCP is usually compiled for HDB compatibility, the Taylor 
configuration scheme, or both.  Because the Taylor scheme is much more 
flexible and probably easier to understand than the often obscure HDB 
configuration files, we will describe the Taylor scheme below.</P
><P
>This chapter is not designed to exhaustively describe the command-line
options for the UUCP commands and what they do, but to give you an
introduction to how to set up a working UUCP node. The first section gives
a gentle introduction about how UUCP implements remote execution and file
transfers. If you are not entirely new to UUCP, you might want to skip to
the section <A
HREF="#X-087-2-UUCP.CONFIG.FILES"
>Section 16.2</A
>&#8221; later in this 
chapter, which explains the various files used to set up UUCP.</P
><P
>We will, however, assume that you are familiar with the user programs of
the UUCP suite, <B
CLASS="COMMAND"
>uucp</B
> and <B
CLASS="COMMAND"
>uux</B
>.
For a description, refer to the online manual pages.</P
><P
>&#13;Besides the publicly accessible programs <B
CLASS="COMMAND"
>uucp</B
> and
<B
CLASS="COMMAND"
>uux</B
>, the UUCP suite contains a number of commands used
for administrative purposes only. They are used to monitor UUCP traffic
across your node, remove old log files, or compile statistics. None of these
will be described here because they are peripheral to the main tasks of UUCP.
Besides, they're well documented and fairly easy to understand; refer to 
the manual pages for more information. However, there
is a third category, which comprise the actual UUCP
&#8220;work horses.&#8221;  They are called <B
CLASS="COMMAND"
>uucico</B
>
(where <EM
>cico</EM
> stands for copy-in copy-out), and
<B
CLASS="COMMAND"
>uuxqt</B
>, which executes jobs sent from remote systems.
We concentrate on these two important programs in this chapter.</P
><P
>If you're not satisfied with our coverage of these topics, you should read
the documentation that comes with the UUCP package.  This is a set of
Texinfo files that describe the setup using the Taylor configuration
scheme. You can convert the Texinfo files into a <B
CLASS="COMMAND"
>dvi</B
> file 
using the <B
CLASS="COMMAND"
>texi2dvi</B
> (found in the Texinfo package in your 
distribution) and view the <B
CLASS="COMMAND"
>dvi</B
> file using the 
<B
CLASS="COMMAND"
>xdvi</B
> command.</P
><P
>&#13;Guylhem Aznar's UUCP-HOWTO is another good source for information about UUCP 
in a Linux environment. It is available at any Linux Documentation
Project mirror and is posted regularly to
<SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.answers</SPAN
>.</P
><P
> 

There's also a newsgroup for the discussion of UUCP called <SPAN
CLASS="SYSTEMITEM"
>comp.mail.uucp</SPAN
>. If you have questions
specific to Taylor UUCP, you may be better off asking them there,
rather than on the <SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.*</SPAN
> groups.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-UUCP.INTRO.GRADES"
>16.1. UUCP Transfers and Remote Execution</A
></H2
><P
> 


The concept of jobs is vital to understanding UUCP.
Every transfer that a user initiates with <B
CLASS="COMMAND"
>uucp</B
> or
<B
CLASS="COMMAND"
>uux</B
> is called a <B
CLASS="COMMAND"
>job</B
>. It is made up of 
a command to be executed on a remote system, a collection of files to 
be transferred between sites, or both.</P
><P
>As an example, the following command makes UUCP copy the file
<TT
CLASS="FILENAME"
>netguide.ps</TT
> to a remote host named
<SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
> and execute the
<B
CLASS="COMMAND"
>lpr</B
> command on
<SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
>
to print the file:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>uux -r pablo!lpr !netguide.ps</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
> 
 

UUCP does not generally call the remote system immediately to execute a job
(or else you could make do with <B
CLASS="COMMAND"
>kermit</B
>). Instead, it
temporarily stores the job description away. This is called
<EM
>spooling</EM
>. The directory tree under which jobs are stored
is therefore called the <EM
>spool directory</EM
> and is generally
located in <TT
CLASS="FILENAME"
>/var/spool/uucp</TT
>. In our example, the job
description would contain information about the remote command to be executed
(<B
CLASS="COMMAND"
>lpr</B
>), the user who requested the execution, and a couple
of other items. In addition to the job description, UUCP has to store the
input file <TT
CLASS="FILENAME"
>netguide.ps</TT
>.</P
><P
>The exact location and naming of spool files may vary, depending on
some compile-time options. HDB-compatible UUCPs generally store spool
files in a <TT
CLASS="FILENAME"
>/var/spool/uucp</TT
> subdirectory with the name
of the remote site. When compiled for Taylor configuration, UUCP creates
subdirectories below the site-specific spool directory for different types
of spool files.</P
><P
>At regular intervals, UUCP dials up the remote system.  When a connection to
the remote machine is established, UUCP transfers the files describing the
job, plus any input files.  The incoming jobs will not be executed
immediately, but only after the connection terminates. Execution is handled 
by <B
CLASS="COMMAND"
>uuxqt</B
>, which also takes care of forwarding any jobs that
are designated for another site.</P
><P
>&#13;

To distinguish between more and less important jobs, UUCP associates a
<EM
>grade</EM
> with each job. This is a single digit ranging
from 0 through 9, A through Z, and a through z, in decreasing precedence. Mail
is customarily spooled with grade B or C, while news is spooled with grade
N. Jobs with higher grades are transferred earlier. Grades may be assigned
using the <CODE
CLASS="OPTION"
>&#8211;g</CODE
> flag when invoking <B
CLASS="COMMAND"
>uucp</B
>
or <B
CLASS="COMMAND"
>uux</B
>.</P
><P
>You can also prohibit the transfer of jobs below a given grade at certain
times. To do this we set the <EM
>maximum spool grade</EM
>
that will be prohibited during a conversation. The maximum spool grade 
defaults to z, meaning all grades will be transferred every time. Note the 
semantic ambiguity here: a file is transferred only if it has a grade 
<EM
>equal to</EM
> or <EM
>above</EM
> the maximum spool grade threshold.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-UUCICO.CONNECT"
>16.1.1. The Inner Workings of uucico</A
></H3
><P
>&#13; 
To understand why <B
CLASS="COMMAND"
>uucico</B
> needs to know particular 
information, a quick description of how it actually connects to a remote 
system is helpful.</P
><P
> 
When you execute <B
CLASS="COMMAND"
>uucico -s <TT
CLASS="REPLACEABLE"
><I
>system</I
></TT
></B
>
from the command line, <B
CLASS="COMMAND"
>uucico</B
> first has to connect
physically. The actions taken depend on the type of connection to
open. Thus, when using a telephone line, it has to find a modem and dial
out. Over TCP, it has to call <CODE
CLASS="FUNCTION"
>gethostbyname</CODE
> to convert
the name to a network address, find out which port to open, and bind the
address to the corresponding socket.</P
><P
>&#13;
A successful connection is followed by authorization. This procedure 
generally consists of the remote system
asking for a login name and possibly a password. This exchange is commonly
called the <EM
>login chat</EM
>. The authorization procedure is
performed either by the usual
<B
CLASS="COMMAND"
>getty/login</B
> suite,
or on TCP sockets by <B
CLASS="COMMAND"
>uucico</B
> itself.  If authorization
succeeds, the remote end fires up <B
CLASS="COMMAND"
>uucico</B
>. The local copy of
<B
CLASS="COMMAND"
>uucico</B
> that initiated the connection is referred to as
<EM
>master</EM
>, and the remote copy as <EM
>slave</EM
>.</P
><P
>&#13;

 
Next follows the <EM
>handshake phase</EM
>&#8201;: the master sends
its hostname plus several flags.  The slave checks this hostname for
permission to log in, send, and receive files, etc.  The flags describe
(among other things) the maximum grade of spool files to transfer. If
enabled, a conversation count or <EM
>call sequence number</EM
>
check takes place here. With this feature, both sites maintain a count of
successful connections, which are compared. If they do not match, the
handshake fails. This is useful to protect yourself against impostors.</P
><P
>Finally, the two <B
CLASS="COMMAND"
>uucico</B
>s try to agree on a common
<EM
>transfer protocol</EM
>. This protocol governs the way data is
transferred, checked for consistency, and retransmitted in case of an error.
There is a need for different protocols because of the differing types of
connections supported. For example, telephone lines require a
&#8220;safe&#8221; protocol, which is pessimistic about errors, while TCP
transmission is inherently reliable and can use a more efficient protocol that
foregoes most extra error checking.</P
><P
>After the handshake is complete, the actual transmission phase begins.
Both ends turn on the selected protocol driver. At this point, the drivers
possibly perform a protocol-specific initialization sequence.</P
><P
>The master then sends all files queued for the remote system whose
spool grade is high enough. When it has finished, it informs the slave
that it is done and that the slave may now hang up. The slave now can
either agree to hang up or take over the conversation.  This is a
change of roles: now the remote system becomes master, and the local one
becomes slave. The new master now sends its files.  When done, both
<B
CLASS="COMMAND"
>uucico</B
>&#8201;s exchange termination messages and close the
connection.</P
><P
>If you need additional information on UUCP, please refer to the
source code. There is also a really antique article floating around the Net, 
written by David A. Novitz, which gives a detailed description of the UUCP
protocol.<A
NAME="X-087-2-FNUU02"
HREF="#FTN.X-087-2-FNUU02"
><SPAN
CLASS="footnote"
>[90]</SPAN
></A
> The Taylor UUCP FAQ also
discusses some details UUCP's implementation. It is posted to
<SPAN
CLASS="SYSTEMITEM"
>comp.mail.uucp</SPAN
> regularly.
&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN12710"
>16.1.2. uucico Command-line Options</A
></H3
><P
>&#13;

 
In this section, we describe the most important command-line options for
<B
CLASS="COMMAND"
>uucico</B
>&#8201;:</P
><P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><CODE
CLASS="OPTION"
>&#8211; &#8211; system, &#8211;s <TT
CLASS="REPLACEABLE"
><I
>system</I
></TT
></CODE
></DT
><DD
><P
>Calls the named <TT
CLASS="REPLACEABLE"
><I
>system</I
></TT
> unless prohibited by call-time
restrictions.</P
></DD
><DT
><CODE
CLASS="OPTION"
>&#8211;S <TT
CLASS="REPLACEABLE"
><I
>system</I
></TT
></CODE
></DT
><DD
><P
>Calls the named <TT
CLASS="REPLACEABLE"
><I
>system</I
></TT
> unconditionally.</P
></DD
><DT
><CODE
CLASS="OPTION"
>&#8211; &#8211;master, &#8211;r1</CODE
></DT
><DD
><P
>Starts <B
CLASS="COMMAND"
>uucico</B
> in master mode. This is the default when
<CODE
CLASS="OPTION"
>&#8211;s</CODE
> or <CODE
CLASS="OPTION"
>&#8211;S</CODE
> is given. All by itself,
the <CODE
CLASS="OPTION"
>&#8211;r1</CODE
> option causes <B
CLASS="COMMAND"
>uucico</B
> to try
to call all systems in the <TT
CLASS="FILENAME"
>sys</TT
> file described in the 
next section of this chapter, unless prohibited by call or retry time 
restrictions.</P
></DD
><DT
><CODE
CLASS="OPTION"
>&#8211; &#8211;slave, &#8211;r0</CODE
></DT
><DD
><P
>Starts <B
CLASS="COMMAND"
>uucico</B
> in slave mode. This is the default
when no <CODE
CLASS="OPTION"
>&#8211;s</CODE
> or <CODE
CLASS="OPTION"
>&#8211;S</CODE
> is
given.  In slave mode, either standard input/output are assumed to be
connected to a serial port, or the TCP port specified by the
<CODE
CLASS="OPTION"
>&#8211;p</CODE
> option is used.</P
></DD
><DT
><CODE
CLASS="OPTION"
>&#8211; &#8211;ifwork, &#8211;C</CODE
></DT
><DD
><P
>This option supplements <CODE
CLASS="OPTION"
>&#8211;s</CODE
> or
<CODE
CLASS="OPTION"
>&#8211;S</CODE
> and tells <B
CLASS="COMMAND"
>uucico</B
> to call the
named system only if there are jobs spooled for it.</P
></DD
><DT
><CODE
CLASS="OPTION"
>&#8211; &#8211;debug <TT
CLASS="REPLACEABLE"
><I
>type</I
></TT
>, &#8211;x <TT
CLASS="REPLACEABLE"
><I
>type</I
></TT
></CODE
>, <CODE
CLASS="OPTION"
>&#8211;X <TT
CLASS="REPLACEABLE"
><I
>type</I
></TT
></CODE
></DT
><DD
><P
>Turns on debugging of the specified type. Several types can be given as a
comma-separated list. The following types are valid:
<SPAN
CLASS="SYSTEMITEM"
>abnormal</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>chat</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>handshake</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>uucp-proto</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>proto</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>port</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>config</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>spooldir</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>execute</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>incoming</SPAN
>, and
<SPAN
CLASS="SYSTEMITEM"
>outgoing</SPAN
>.
Using <SPAN
CLASS="SYSTEMITEM"
>all</SPAN
> turns on all options.  For
compatibility with other UUCP implementations, a number may be specified
instead, which turns on debugging for the first <TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
>
items from the above list.</P
><P
>Debugging messages will be logged to the <TT
CLASS="FILENAME"
>Debug</TT
>
file below <TT
CLASS="FILENAME"
>/var/spool/uucp</TT
>.</P
></DD
></DL
></DIV
></P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-UUCP.CONFIG.FILES"
>16.2. UUCP Configuration Files</A
></H2
><P
>&#13;
In contrast to simpler file transfer programs, UUCP was designed to be
able to handle all transfers automatically. Once it is set up
properly, interference by the administrator should not be necessary on
a day-to-day basis. The information required for automated transfer is
kept in a couple of configuration files that reside in the
<TT
CLASS="FILENAME"
>/usr/lib/uucp</TT
> directory. Most of these files are
used only when dialing out.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN12805"
>16.2.1. A Gentle Introduction to Taylor UUCP</A
></H3
><P
>To say that UUCP configuration is difficult would be an understatement. It 
is really a hairy subject, and the sometimes terse format of the 
configuration files doesn't make things easier (although the Taylor format is 
almost easy reading compared to the older formats in HDB or Version 2).</P
><P
>To give you a feel for how all the configuration files interact, we will
introduce you to the most important ones and have a look at sample entries
from these files. We won't explain everything in detail now; a more accurate
account is given in separate sections that follow. If you want to set up your
machine for UUCP, you had best start with some sample files and adapt
them gradually.  You can pick either those shown below or those included in
your favorite Linux distribution.</P
><P
>All files described in this section are kept in
<TT
CLASS="FILENAME"
>/etc/uucp</TT
> or a subdirectory thereof. Some Linux
distributions contain UUCP binaries that have support for both HDB and Taylor
configuration enabled, and use different subdirectories for each configuration
file set. There will usually be a <TT
CLASS="FILENAME"
>README</TT
> file in
<TT
CLASS="FILENAME"
>/usr/lib/uucp</TT
>.</P
><P
>For UUCP to work properly, these files must be owned by the
<SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
> user. Some of them contain
passwords and telephone numbers, and therefore should have permissions
of 600. Note that although most UUCP commands must be setuid to
<SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
>, you must make sure the
<B
CLASS="COMMAND"
>uuchk</B
> program is
<EM
>not</EM
>. Otherwise, users will be able to display
system passwords even though the files have mode 600.</P
><P
>The central UUCP configuration file is
<TT
CLASS="FILENAME"
>/etc/uucp/config</TT
>, which is used to set general
parameters.  The most important of them (and for now, the only one) is
your host's UUCP name. At the Virtual Brewery, they use <SPAN
CLASS="SYSTEMITEM"
>vstout</SPAN
> as their UUCP gateway:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/uucp/config - UUCP main configuration file
nodename         vstout</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <TT
CLASS="FILENAME"
>sys</TT
> file is the next important configuration file. It
contains all the system-specific information of sites to which you are linked. 
This includes the site's name and information on the link itself, such as the
telephone number when using a modem link.  A typical entry for a
modem-connected site called <SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
> 
would look like this:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /usr/lib/uucp/sys - name UUCP neighbors
# system: pablo
system          pablo
time            Any
phone           555-22112
port            serial1
speed           38400
chat            ogin: vstout ssword: lorca</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
><SPAN
CLASS="SYSTEMITEM"
>time</SPAN
> specifies the times at
which the remote system may be called.  <SPAN
CLASS="SYSTEMITEM"
>chat</SPAN
> describes the login chat
scripts&#8212;the sequence of strings that must be exchanged to allow
<B
CLASS="COMMAND"
>uucico</B
> to log into <SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
>. We will get back to chat scripts
later. The <SPAN
CLASS="SYSTEMITEM"
>port</SPAN
> keyword simply
names an entry in the <TT
CLASS="FILENAME"
>port</TT
> file.  (Refer to <A
HREF="#X-087-2-UUCP.FIG.FILES"
>Figure 16-1</A
>.) You can assign whatever name you
like as long as it refers to a valid entry in
<TT
CLASS="FILENAME"
>port</TT
>.</P
><P
>The <TT
CLASS="FILENAME"
>port</TT
> file holds information specific to the
link itself. For modem links, it describes the device special file to
be used, the range of speeds supported, and the type of dialing
equipment connected to the port. The following entry describes
<TT
CLASS="FILENAME"
>/dev/ttyS1</TT
> (a.k.a. COM 2), to which the
administrator has connected a NakWell modem capable of running at
speeds up to 38,400 bps. The port's name is chosen to match the port
name given in the <TT
CLASS="FILENAME"
>sys</TT
> file:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/uucp/port - UUCP ports
# /dev/ttyS1 (COM2)
port            serial1
type            modem
device          /dev/ttyS1
speed           38400
dialer          nakwell</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The information pertaining to the dialers is kept in yet another file
called&#8212;you guessed it&#8212;<TT
CLASS="FILENAME"
>dial</TT
>. For each dialer
type, it basically contains the sequence of commands that are issued to dial up
a remote site, given the telephone number. Again, this is specified as a chat
script. For example, the entry for NakWell might look like this:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/uucp/dial - per-dialer information
# NakWell modems
dialer          nakwell
chat            "" AT&#38;F OK ATDT\T CONNECT</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The line starting with <SPAN
CLASS="SYSTEMITEM"
>chat</SPAN
>
specifies the modem chat, which is the sequence of commands sent to
and received from the modem to initialize it and make it dial the
desired number. The <SPAN
CLASS="SYSTEMITEM"
>\T</SPAN
>
sequence will be replaced with the phone number by
<B
CLASS="COMMAND"
>uucico</B
>.</P
><P
>To give you a rough idea how <B
CLASS="COMMAND"
>uucico</B
> deals with these
configuration files, assume you issue the following command:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>uucico -s pablo</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The first thing <B
CLASS="COMMAND"
>uucico</B
> does is look up <SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
> in the <TT
CLASS="FILENAME"
>sys</TT
>
file. From the <TT
CLASS="FILENAME"
>sys</TT
> file entry for <SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
>, it sees that it should use the
<SPAN
CLASS="SYSTEMITEM"
>serial1</SPAN
> port to establish the
connection.  The <TT
CLASS="FILENAME"
>port</TT
> file tells
<B
CLASS="COMMAND"
>uucico</B
> that this is a modem port, and that it has a
NakWell modem attached.</P
><P
><B
CLASS="COMMAND"
>uucico</B
> now searches <TT
CLASS="FILENAME"
>dial</TT
> for
the entry describing the NakWell modem, and having found one, opens
the serial port <TT
CLASS="FILENAME"
>/dev/cua1</TT
> and executes the dialer
chat. That is, it sends <B
CLASS="COMMAND"
>AT&#38;F</B
>, waits for the
<B
CLASS="COMMAND"
>OK</B
> response, etc. When encountering the string
<SPAN
CLASS="SYSTEMITEM"
>\T</SPAN
>, it substitutes the phone
number (555-22112) extracted from the <TT
CLASS="FILENAME"
>sys</TT
> file.</P
><P
>After the modem returns <B
CLASS="COMMAND"
>CONNECT</B
>, the connection has been
established, and the modem chat is complete. <B
CLASS="COMMAND"
>uucico</B
> now
returns to the <TT
CLASS="FILENAME"
>sys</TT
> file and executes the login chat. In
our example, it would wait for the <B
CLASS="COMMAND"
>login:</B
> prompt, then send
its username (<EM
>vstout</EM
>), wait for the
<B
CLASS="COMMAND"
>password:</B
> prompt, and send its password
(<B
CLASS="COMMAND"
>lorca</B
>).</P
><P
>After completing authorization, the remote end is assumed to fire up its own
<B
CLASS="COMMAND"
>uucico</B
>. The two then enter the handshake phase
described in the previous section.</P
><P
><A
HREF="#X-087-2-UUCP.FIG.FILES"
>Figure 16-1</A
> illustrates the dependencies among 
configuration files.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-UUCP.FIG.FILES"
></A
><P
><B
>Figure 16-1. Interaction of Taylor UUCP configuration files</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_1601.jpg"></P
></DIV
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-UUCP.STARTING.PARAMETERS"
>16.2.2. What UUCP Needs to Know</A
></H3
><P
>Before you start writing the UUCP configuration files, you have to gather some
information that UUCP requires.</P
><P
>First, you have to figure out what serial device your modem is
attached to.  Usually, the (DOS) ports COM1: through COM4: map to the
device special files <TT
CLASS="FILENAME"
>/dev/ttyS0</TT
> through
<TT
CLASS="FILENAME"
>/dev/ttyS3</TT
>.  Some distributions, such as
Slackware, create a link called <TT
CLASS="FILENAME"
>/dev/modem</TT
> to the
appropriate <TT
CLASS="FILENAME"
>ttyS*</TT
> device file, and configure
<B
CLASS="COMMAND"
>kermit</B
>, <B
CLASS="COMMAND"
>seyon</B
>, and any other
communication programs to use this generic file. In this case, you
should use <TT
CLASS="FILENAME"
>/dev/modem</TT
> in your UUCP configuration,
too.</P
><P
>The reason for using a symbolic link is that all dial-out programs use
so-called <EM
>lock files</EM
> to signal when a serial port is
in use. The names of these lock files are a concatenation of the string
<TT
CLASS="FILENAME"
>LCK..</TT
> and the device filename, for instance
<TT
CLASS="FILENAME"
>LCK..ttyS1</TT
>. If programs use different names for the
same device, they will fail to recognize each other's lock files.  As a
consequence, they will disrupt each other's session when started at the
same time. This is quite possible when you schedule your UUCP calls
using a <TT
CLASS="FILENAME"
>crontab</TT
> entry.
For details on serial port setup, please refer to
<A
HREF="#X-087-2-SERIAL"
>Chapter 4</A
>.</P
><P
>Next, you must find out at what speed your modem and Linux will communicate.
You have to set this speed to the maximum effective transfer rate you expect
to get. The effective transfer rate may be much higher than the raw physical
transfer rate your modem is capable of. For instance, many modems send and
receive data at 56 kbps. Using compression protocols such as V.42bis, the
actual transfer rate may climb over 100 kbps.</P
><P
>Of course, if UUCP is to do anything at all, you need the phone number 
of a system to call.  Also, you need a valid login ID and possibly a 
password for the remote machine.<A
NAME="X-087-2-FNUU04"
HREF="#FTN.X-087-2-FNUU04"
><SPAN
CLASS="footnote"
>[91]</SPAN
></A
>&#13;</P
><P
>&#13;You also have to know <EM
>exactly</EM
> how to log into the
system. Do you have to press the Enter key before the login prompt appears?
Does it display <TT
CLASS="LITERAL"
>login:</TT
> or <TT
CLASS="LITERAL"
>user:</TT
>? This
is necessary for composing the <EM
>chat script</EM
>. If you don't
know, or if the usual chat script fails, try to call the system with a terminal
program like <B
CLASS="COMMAND"
>kermit</B
> or <B
CLASS="COMMAND"
>minicom</B
> and 
record exactly what you have to do.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-UUCP.STARTING.SITENAME"
>16.2.3. Site Naming</A
></H3
><P
>&#13;


As with TCP/IP-based networking, your host has to have a name for UUCP
networking. As long as you simply want to use UUCP for file transfers to or
from sites you dial up directly, or on a local network, this name does not
have to meet any standards.<A
NAME="X-087-2-FNUU05"
HREF="#FTN.X-087-2-FNUU05"
><SPAN
CLASS="footnote"
>[92]</SPAN
></A
>&#13;</P
><P
>However, if you use UUCP for a mail or news link, you should think
about having the name registered with the UUCP Mapping Project.<A
NAME="X-087-2-FNUU06"
HREF="#FTN.X-087-2-FNUU06"
><SPAN
CLASS="footnote"
>[93]</SPAN
></A
> The UUCP Mapping Project is described in
<A
HREF="#X-087-2-MAIL"
>Chapter 17</A
>. Even if you participate in a domain,
you might consider having an official UUCP name for your site.</P
><P
>Frequently, people choose their UUCP name to match the first component of
their fully qualified domain name. Suppose your site's domain address is
<SPAN
CLASS="SYSTEMITEM"
>swim.twobirds.com</SPAN
>; then your UUCP
hostname would be <SPAN
CLASS="SYSTEMITEM"
>swim</SPAN
>. Think of UUCP
sites as knowing each other on a first-name basis.  Of course, you can also
use a UUCP name completely unrelated to your fully qualified domain name.</P
><P
>&#13;However, make sure not to use the unqualified site name in mail addresses
unless you have registered it as your official UUCP
name. At the very best, mail to an unregistered UUCP host will vanish in some big black bit bucket. If you use a name already held by some other site, this 
mail will be routed to that site and cause its postmaster a lot of headaches.</P
><P
>By default, the UUCP suite uses the name set by <B
CLASS="COMMAND"
>hostname</B
> as
the site's UUCP name. This name is commonly set by a command on the boot
time <TT
CLASS="FILENAME"
>rc</TT
> scripts, and is usually stored in the
<TT
CLASS="FILENAME"
>/etc/hostname</TT
>. If your UUCP name is different from what
you set your hostname to, you have to use the
<B
CLASS="COMMAND"
>hostname</B
> option in the
<TT
CLASS="FILENAME"
>config</TT
> file to tell <B
CLASS="COMMAND"
>uucico</B
> about your
UUCP name. This is described next.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN12959"
>16.2.4. Taylor Configuration Files</A
></H3
><P
> 
We now return to the configuration files. Taylor UUCP gets its information
from the following files:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="FILENAME"
>config</TT
></DT
><DD
><P
>This is the main configuration file. You can define your site's UUCP name here.</P
></DD
><DT
><TT
CLASS="FILENAME"
>sys</TT
></DT
><DD
><P
>This file describes all known sites.  For each site, it specifies its
name, what times to call it, which number to dial (if any), what type of device
to use, and how to log on.</P
></DD
><DT
><TT
CLASS="FILENAME"
>port</TT
></DT
><DD
><P
>This file contains entries describing each available port, together with the line speed
supported and the dialer to be used.</P
></DD
><DT
><TT
CLASS="FILENAME"
>dial</TT
></DT
><DD
><P
>This file describes dialers used to establish a telephone connection.</P
></DD
><DT
><TT
CLASS="FILENAME"
>dialcode</TT
></DT
><DD
><P
>This file contains expansions for symbolic dial codes.</P
></DD
><DT
><TT
CLASS="FILENAME"
>call</TT
></DT
><DD
><P
>This file contains the login name and password to be used when calling a system.
Rarely used.</P
></DD
><DT
><TT
CLASS="FILENAME"
>passwd</TT
></DT
><DD
><P
>This file contains login names and passwords that systems may use when logging in. It is used only when <B
CLASS="COMMAND"
>uucico</B
> does its own password
checking.</P
></DD
></DL
></DIV
></P
><P
>Taylor configuration files are generally made up of lines containing
keyword-value pairs. A hash sign introduces a comment that extends to the
end of the line. To use a hash sign to mean itself, escape it with a
backslash like this: <TT
CLASS="LITERAL"
>\#</TT
>.</P
><P
>There are quite a number of options you can tune with these configuration
files.  We can't go into all the parameters, but we will cover the
most important ones here. Then you should be able to configure a modem-based 
UUCP link. Additional sections describe the modifications necessary if you
want to use UUCP over TCP/IP or over a direct serial line. A complete
reference is given in the Texinfo documents that accompany the Taylor UUCP
sources.</P
><P
>&#13;

When you think you have configured your UUCP system completely, you can check
your configuration using the <B
CLASS="COMMAND"
>uuchk</B
> tool (located in
<TT
CLASS="FILENAME"
>/usr/lib/uucp</TT
>). <B
CLASS="COMMAND"
>uuchk</B
> reads your
configuration files and prints out a detailed report of the configuration
values used for each system.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13018"
>16.2.5. General Configuration Options Using the config File</A
></H3
><P
>&#13;
You won't generally use this file to describe much beside your UUCP hostname.
By default, UUCP will use the name you set with the <B
CLASS="COMMAND"
>hostname</B
>
command, but it is generally a good idea to set the UUCP name explicitly. Here's a sample <TT
CLASS="FILENAME"
>config</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /usr/lib/uucp/config - UUCP main configuration file
hostname        vstout</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>A number of miscellaneous parameters can be set here too, such as the name of
the spool directory or access rights for anonymous UUCP. The latter will be
described later in this chapter in the section &#8220;Anonymous UUCP.&#8221;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-UUCP.SYSTEMS.FILE"
>16.2.6. How to Tell UUCP About Other Systems Using the sys File</A
></H3
><P
>&#13;
The <TT
CLASS="FILENAME"
>sys</TT
> file describes the systems that your
machine knows about. An entry is introduced by the <SPAN
CLASS="SYSTEMITEM"
>system</SPAN
> keyword; the subsequent lines up to
the next <SPAN
CLASS="SYSTEMITEM"
>system</SPAN
> directive
detail the parameters specific to that site. Commonly, a system entry
defines parameters such as the telephone number and login chat.</P
><P
>Parameters before the very first <SPAN
CLASS="SYSTEMITEM"
>system</SPAN
> line set default values used for
all systems. Usually, you set protocol parameters and the like in
the defaults section.</P
><P
>&#13;The most prominent fields are discussed in detail in the following sections.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN13046"
>16.2.6.1. System name</A
></H4
><P
>&#13;The <EM
>system</EM
> command names the remote
system. You must specify the correct name of the remote system, not an alias
you invented, because <B
CLASS="COMMAND"
>uucico</B
> will check it against what
the remote system says it is called when you log
on.<A
NAME="X-087-2-FNUU07"
HREF="#FTN.X-087-2-FNUU07"
><SPAN
CLASS="footnote"
>[94]</SPAN
></A
>&#13;</P
><P
>Each system name can appear only once. If you want to use several sets of
configurations for the same system (such as different telephone numbers
<B
CLASS="COMMAND"
>uucico</B
> should try in turn), you can specify
<EM
>alternates</EM
>, which we'll describe after the basic 
configuration options.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN13059"
>16.2.6.2. Telephone number</A
></H4
><P
>&#13;If the remote system is to be reached over a telephone line, the
<SPAN
CLASS="SYSTEMITEM"
>phone</SPAN
> field specifies the number the
modem should dial. It may contain several tokens interpreted by
<B
CLASS="COMMAND"
>uucico</B
>'s dialing procedure. An equal sign (=) means wait
for a secondary dial tone, and a dash (-) generates a one-second pause. Some 
telephone installations choke when you don't pause between
dialing a special access code and the telephone
number.<A
NAME="X-087-2-FNUU08"
HREF="#FTN.X-087-2-FNUU08"
><SPAN
CLASS="footnote"
>[95]</SPAN
></A
>&#13;</P
><P
>&#13;It is often convenient to use names instead of numbers to describe
area dialing codes. The <TT
CLASS="FILENAME"
>dialcode</TT
> file allows you to
associate a name with a code that you may subsequently use when specifying
telephone numbers for remote hosts. Suppose you have the following
<TT
CLASS="FILENAME"
>dialcode</TT
> file:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /usr/lib/uucp/dialcode - dialcode translation
Bogoham         024881
Coxton          035119</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>With these translations, you can use a phone number such as
<SPAN
CLASS="SYSTEMITEM"
>Bogoham7732</SPAN
> in the
<TT
CLASS="FILENAME"
>sys</TT
> file, which will probably make things a little more
legible and a whole lot easier to update should the dialing code for
Bogoham ever change.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN13080"
>16.2.6.3. port and speed</A
></H4
><P
>&#13;The <SPAN
CLASS="SYSTEMITEM"
>port</SPAN
> and <SPAN
CLASS="SYSTEMITEM"
>speed</SPAN
> options are used to select the
device used for calling the remote system and the maximum speed to
which the device should be set.<A
NAME="X-087-2-FNUU09"
HREF="#FTN.X-087-2-FNUU09"
><SPAN
CLASS="footnote"
>[96]</SPAN
></A
>
A <SPAN
CLASS="SYSTEMITEM"
>system</SPAN
> entry may
use either option alone or both options in conjunction. When looking
up a suitable device in the <TT
CLASS="FILENAME"
>port</TT
> file, only ports that have a matching port name and/or speed range are selected.</P
><P
>Generally, using the <SPAN
CLASS="SYSTEMITEM"
>speed</SPAN
>
option only should suffice. If you have only one serial device defined
in <TT
CLASS="FILENAME"
>port</TT
>, <B
CLASS="COMMAND"
>uucico</B
> always picks the right one anyway, so you only have to give it the desired
speed. If you have several modems attached to your systems, you still
often don't want to name a particular port, because if
<B
CLASS="COMMAND"
>uucico</B
> finds that there are several matches, it
tries each device in turn until it finds an unused one.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN13098"
>16.2.6.4. The login chat</A
></H4
><P
>&#13;


We already encountered the login chat script, which tells
<B
CLASS="COMMAND"
>uucico</B
> how to log in to the remote system. It
consists of a list of tokens specifying strings expected and sent by
the local <B
CLASS="COMMAND"
>uucico</B
> process. <B
CLASS="COMMAND"
>uucico</B
>
waits until the remote machine sends a login prompt, then returns the
login name, waits for the remote system to send the password prompt,
and sends the password. Expect and send strings appear in alternation
in the script.  <B
CLASS="COMMAND"
>uucico</B
> automatically appends a
carriage return character (<SPAN
CLASS="SYSTEMITEM"
>\r</SPAN
>)
to any send string. Thus, a simple chat script would look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
> ogin: vstout ssword: catch22</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>You will probably notice that the expect fields don't contain the
whole prompts. This ensures that the login succeeds, even if the
remote system transmits <B
CLASS="COMMAND"
>Login:</B
> instead of
<B
CLASS="COMMAND"
>login:</B
>. If the string you are expecting or sending
contains spaces or other white-space characters, you must use quotes
to surround the text.</P
><P
><B
CLASS="COMMAND"
>uucico</B
> also allows for some sort of conditional execution. 
Let's say the remote machine's <B
CLASS="COMMAND"
>getty</B
>
needs to be reset before sending a prompt. For this, you can attach a subchat
to an expect string, set off by a dash.  The subchat is executed only if the
main expect fails, i.e., a timeout occurs.  One way to use this feature is to
send a BREAK if the remote site doesn't display a login prompt. The following
example gives a general-purpose chat script that should also work in case you
have to press Enter before the login appears. The empty first argument,
<TT
CLASS="LITERAL"
>""</TT
>, tells UUCP to not wait for anything, but to continue 
with the next send string:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
> "" \n\r\d\r\n\c ogin:-BREAK-ogin: vstout ssword: catch22</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>A couple of special strings and escape characters can occur in the chat
script. The following is a partial list of characters legal in expect strings:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>""</TT
></DT
><DD
><P
>The empty string. It tells <B
CLASS="COMMAND"
>uucico</B
> to not wait for anything,
but to proceed with the next send string immediately.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>\t</SPAN
></DT
><DD
><P
>Tab character.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>\r</SPAN
></DT
><DD
><P
>Carriage return character.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>\s</SPAN
></DT
><DD
><P
>Space character. You need this to embed spaces in a chat string.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>\n</SPAN
></DT
><DD
><P
>Newline character.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>\\</SPAN
></DT
><DD
><P
>Backslash character.</P
></DD
></DL
></DIV
></P
><P
>On send strings, the following escape characters and strings are legal in
addition to the above:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>EOT</SPAN
></DT
><DD
><P
>End of transmission character (<B
CLASS="COMMAND"
>^D</B
>).</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>BREAK</SPAN
></DT
><DD
><P
>Break character.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>\c</SPAN
></DT
><DD
><P
>Suppress sending of carriage return at end of string.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>\d</SPAN
></DT
><DD
><P
>Delay sending for 1 second.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>\E</SPAN
></DT
><DD
><P
>Enable echo checking. This requires <B
CLASS="COMMAND"
>uucico</B
> to wait for the
echo of everything it writes to be read back from the device before it can
continue with the chat. It is primarily useful when used in modem chats
(which we will encounter later). Echo checking is off by default.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>\e</SPAN
></DT
><DD
><P
>Disable echo checking.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>\K</SPAN
></DT
><DD
><P
>Same as <SPAN
CLASS="SYSTEMITEM"
>BREAK</SPAN
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>\p</SPAN
></DT
><DD
><P
>Pause for fraction of a second.</P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN13205"
>16.2.6.5. Alternates</A
></H4
><P
>&#13;Sometimes you want to have multiple entries for a single system, for
instance if the system can be reached on different modem lines. With Taylor
UUCP, you can do this by defining a so-called <EM
>alternate</EM
>.</P
><P
>An alternate entry retains all settings from the main system entry and
specifies only those values that should be overridden in the default system
entry or added to it.  An alternate is offset from the system entry by a
line containing the keyword <SPAN
CLASS="SYSTEMITEM"
>alternate</SPAN
>.</P
><P
>To use two phone numbers for <SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
>,
you would modify its <TT
CLASS="FILENAME"
>sys</TT
> entry in the following way:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>system       pablo
phone        123-456
.. entries as above ...
alternate
phone        123-455</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>When calling <SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
>,
<B
CLASS="COMMAND"
>uucico</B
> will first dial 123-456, and if this fails, it will
try the alternate.  The alternate entry retains all settings from the main
system entry and overrides the telephone number only.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN13221"
>16.2.6.6. Restricting call times</A
></H4
><P
>&#13;
Taylor UUCP provides a number of ways you may restrict the times when calls
can be placed to a remote system.  You might do this either because of
limitations the remote host places on its services during business hours, or
simply to avoid times with high call rates. Note that it is always possible
to override call-time restrictions by giving <B
CLASS="COMMAND"
>uucico</B
> the
<CODE
CLASS="OPTION"
>&#8211;S</CODE
> or <CODE
CLASS="OPTION"
>&#8211;f</CODE
> option.</P
><P
>By default, Taylor UUCP disallows connections at any time, so you
<EM
>have</EM
> to use some sort of time specification in the
<TT
CLASS="FILENAME"
>sys</TT
> file. If you don't care about call time restrictions,
you can specify the <B
CLASS="COMMAND"
>time</B
> option with a
value of <SPAN
CLASS="SYSTEMITEM"
>Any</SPAN
> in your
<TT
CLASS="FILENAME"
>sys</TT
> file.</P
><P
>The simplest way to restrict call time is to include a
<SPAN
CLASS="SYSTEMITEM"
>time</SPAN
> entry, followed by a string made
up of a day and a time subfield. Day may be any combination of
<SPAN
CLASS="SYSTEMITEM"
>Mo, Tu, We, Th, Fr, Sa,</SPAN
> and <SPAN
CLASS="SYSTEMITEM"
>Su</SPAN
>. You can 
also specify <SPAN
CLASS="SYSTEMITEM"
>Any</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>Never</SPAN
>, or
<SPAN
CLASS="SYSTEMITEM"
>Wk</SPAN
> for weekdays. The time consists of
two 24-hour clock values, separated by a dash. They specify the range during
which calls may be placed. The combination of these tokens is written without
white space in between.  Any number of day and time specifications may be
grouped together with commas, as this line shows:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>time            MoWe0300-0730,Fr1805-2200</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This example allows calls on Mondays and Wednesdays from 3:00 a.m. to 7:30 a.m.,
and on Fridays between 6:05 p.m. and 10:00 p.m. When a time field spans
midnight, say <SPAN
CLASS="SYSTEMITEM"
>Mo1830-0600</SPAN
>, it actually
means Monday, between midnight and 6:00 a.m. and between 6:30 p.m. and midnight.</P
><P
>The special time strings <SPAN
CLASS="SYSTEMITEM"
>Any</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>Never</SPAN
> mean what they say: calls may be
placed at any or no time, respectively.</P
><P
>Taylor UUCP also has a number of special tokens you may use in time strings,
such as <SPAN
CLASS="SYSTEMITEM"
>NonPeak</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>Night</SPAN
>.  These special tokens are shorthand for
<SPAN
CLASS="SYSTEMITEM"
>Any2300-0800,SaSu0800-1700</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>Any1800-0700,SaSu</SPAN
>, respectively.</P
><P
>&#13;The <EM
>time</EM
> command takes an optional
second argument that describes a retry time in minutes. When an attempt to
establish a connection fails, <B
CLASS="COMMAND"
>uucico</B
> will not allow another
attempt to dial up the remote host within a certain interval. For instance,
when you specify a retry time of 5 minutes, <B
CLASS="COMMAND"
>uucico</B
> will
refuse to call the remote system within 5 minutes after the last failure. By
default, <B
CLASS="COMMAND"
>uucico</B
> uses an exponential backoff scheme, where
the retry interval increases with each repeated failure.</P
><P
>&#13;
The <B
CLASS="COMMAND"
>timegrade</B
> command allows you to
attach a maximum spool grade to a schedule. For instance, assume you have the
following <B
CLASS="COMMAND"
>timegrade</B
> commands in a
<SPAN
CLASS="SYSTEMITEM"
>system</SPAN
> entry:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>timegrade           N Wk1900-0700,SaSu 
timegrade           C Any</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This allows jobs with a spool grade of C or higher (usually mail is queued
with grade B or C) to be transferred whenever a call is established, while
news (usually queued with grade N) are transferred only during the night
and at weekends.</P
><P
>Just like <B
CLASS="COMMAND"
>time</B
>, the <B
CLASS="COMMAND"
>timegrade</B
> command takes a retry interval in minutes as an optional third argument.</P
><P
>However, a caveat about spool grades is in order here. First, the
<B
CLASS="COMMAND"
>timegrade</B
> option applies only to what
<EM
>your</EM
> systems sends; the remote system may still transfer
anything it likes.  You can use the
<B
CLASS="COMMAND"
>call-timegrade</B
> option to explicitly
request it to send only jobs above some given spool grade; but there's no
guarantee it will obey this request.<A
NAME="X-087-2-FNUU10"
HREF="#FTN.X-087-2-FNUU10"
><SPAN
CLASS="footnote"
>[97]</SPAN
></A
></P
><P
>Similarly, the <TT
CLASS="REPLACEABLE"
><I
>timegrade</I
></TT
> field is not
checked when a remote system calls in, so any jobs queued for the calling
system will be sent. However, the remote system can explicitly request your
<B
CLASS="COMMAND"
>uucico</B
> to restrict itself to a certain spool grade.&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13291"
>16.2.7. Identifying Available Devices Through the port File</A
></H3
><P
>&#13;

The <TT
CLASS="FILENAME"
>port</TT
> file tells <B
CLASS="COMMAND"
>uucico</B
> about the
available ports. These are usually modem ports, but other types, such as direct
serial lines and TCP sockets, are supported as well.</P
><P
>Like the <TT
CLASS="FILENAME"
>sys</TT
> file, <TT
CLASS="FILENAME"
>port</TT
>
consists of separate entries starting with the keyword
<SPAN
CLASS="SYSTEMITEM"
>port</SPAN
> followed by the port name. This
name may be used in the <TT
CLASS="FILENAME"
>sys</TT
> file's
<SPAN
CLASS="SYSTEMITEM"
>port</SPAN
> statement. The name need not
be unique; if there are several ports with the same name,
<B
CLASS="COMMAND"
>uucico</B
> will try each in turn until it finds one that
is not currently being used.</P
><P
>The <B
CLASS="COMMAND"
>port</B
> command should be followed
immediately by the <SPAN
CLASS="SYSTEMITEM"
>type</SPAN
> statement,
which indicates what type of port is described. Valid types are
<SPAN
CLASS="SYSTEMITEM"
>modem</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>direct</SPAN
> for direct connections, and
<SPAN
CLASS="SYSTEMITEM"
>tcp</SPAN
> for TCP sockets. If the
<B
CLASS="COMMAND"
>port</B
> command is missing, the port
type defaults to modem.</P
><P
>In this section, we cover only modem ports; TCP ports and direct lines are
discussed in a later section.</P
><P
>For modem and direct ports, you have to specify the device for calling out
using the <SPAN
CLASS="SYSTEMITEM"
>device</SPAN
> directive. Usually,
this is the name of a device special file in the <TT
CLASS="FILENAME"
>/dev</TT
>
directory, like <TT
CLASS="FILENAME"
>/dev/ttyS1</TT
>.</P
><P
>In the case of a modem device, the port entry also determines what type of
modem is connected to the port.  Different types of modems have to be
configured differently. Even modems that claim to be Hayes-compatible aren't
always really compatible with one another. Therefore, you have to tell
<B
CLASS="COMMAND"
>uucico</B
> how to initialize the modem and make it dial
the desired number. Taylor UUCP keeps the descriptions of all dialers in a
file named <TT
CLASS="FILENAME"
>dial</TT
>.  To use any of these, you have to specify
the dialer's name using the <B
CLASS="COMMAND"
>dialer</B
>
command.</P
><P
>Sometimes, you will want to use a modem in different ways, depending on which
system you call.  For instance, some older modems don't understand when a
high-speed modem attempts to connect at 56 kbps; they simply drop the line
instead of negotiating a connect at 9,600 bps, for instance. When you know site
<SPAN
CLASS="SYSTEMITEM"
>drop</SPAN
> uses such a dumb modem, you have
to set up your modem differently when calling them. For this, you need an
additional port entry in the <TT
CLASS="FILENAME"
>port</TT
> file that specifies a
different dialer. Now you can give the new port a different name, such as
<SPAN
CLASS="SYSTEMITEM"
>serial1-slow</SPAN
>, and use the
<SPAN
CLASS="SYSTEMITEM"
>port</SPAN
> directive in the
<SPAN
CLASS="SYSTEMITEM"
>drop</SPAN
> system entry in
<TT
CLASS="FILENAME"
>sys</TT
>.</P
><P
>A better to distinguish the ports is by the speeds they support. For
instance, the two port entries for the above situation may look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># NakWell modem; connect at high speed
port            serial1         # port name
type            modem           # modem port
device          /dev/ttyS1      # this is COM2
speed           115200          # supported speed
dialer          nakwell         # normal dialer
# NakWell modem; connect at low speed
port            serial1         # port name
type            modem           # modem port
device          /dev/ttyS1      # this is COM2
speed           9600            # supported speed
dialer          nakwell-slow    # don't attempt fast connect</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The system entry for site <SPAN
CLASS="SYSTEMITEM"
>drop</SPAN
> would
now give <SPAN
CLASS="SYSTEMITEM"
>serial1</SPAN
> as the port name, but
request to use it at only 9,600 bps.  <B
CLASS="COMMAND"
>uucico</B
> then
automatically uses the second port entry. All remaining sites that have a
speed of 115,200 bps in the system entry will be called using the first port
entry. By default, the first entry with a matching speed will be used.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13341"
>16.2.8. How to Dial a Number Using the dial File</A
></H3
><P
>&#13;

The <TT
CLASS="FILENAME"
>dial</TT
> file describes the way various dialers are used.
Traditionally, UUCP talks of dialers rather than modems, because in earlier
times, it was usual practice to have one (expensive) automatic dialing device
serve a whole bank of modems. Today, most modems have dialing support built
in, so this distinction gets a little blurred.</P
><P
>Nevertheless, different dialers or modems may require a different
configuration. You can describe each of them in the
<TT
CLASS="FILENAME"
>dial</TT
> file. Entries in <TT
CLASS="FILENAME"
>dial</TT
>
start with the <B
CLASS="COMMAND"
>dialer</B
> command
that gives the dialer's name.</P
><P
>The most important entry besides <B
CLASS="COMMAND"
>dialer</B
> is the modem chat, specified by the <B
CLASS="COMMAND"
>chat</B
> command. Similar to the
login chat, it consists of a sequence of strings
<B
CLASS="COMMAND"
>uucico</B
> sends to the dialer and the responses it
expects in return. It is commonly used to reset the modem to some
known state and dial the number. The following sample <SPAN
CLASS="SYSTEMITEM"
>dialer</SPAN
> entry shows a typical modem chat
for a Hayes-compatible modem:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># NakWell modem; connect at high speed
dialer          nakwell         # dialer name
chat            "" AT&#38;F OK\r ATH1E0Q0 OK\r ATDT\T CONNECT
chat-fail       BUSY
chat-fail       ERROR
chat-fail       NO\sCARRIER
dtr-toggle      true</PRE
></FONT
></TD
></TR
></TABLE
><P
>The modem chat begins with <TT
CLASS="LITERAL"
>""</TT
>, the empty expect
string.  <B
CLASS="COMMAND"
>uucico</B
> therefore sends the first
command <B
CLASS="COMMAND"
>AT&#38;F</B
> right
away. <B
CLASS="COMMAND"
>AT&#38;F</B
> is the Hayes command to reset the
modem to factory default configuration.  <B
CLASS="COMMAND"
>uucico</B
>
then waits until the modem has sent <TT
CLASS="LITERAL"
>OK</TT
> and sends
the next command, which turns off local echo and the like. After the
modem returns <TT
CLASS="LITERAL"
>OK</TT
> again, <B
CLASS="COMMAND"
>uucico</B
>
sends the dialing command <B
CLASS="COMMAND"
>ATDT</B
>.  The escape
sequence <TT
CLASS="LITERAL"
>\T</TT
> in this string is replaced with the
phone number taken from the system entry <TT
CLASS="FILENAME"
>sys</TT
>
file. <B
CLASS="COMMAND"
>uucico</B
> then waits for the modem to return the
string <TT
CLASS="LITERAL"
>CONNECT</TT
>, which signals that a connection
with the remote modem has been established successfully.</P
><P
>Sometimes the modem fails to connect to the remote system; for instance,
if the other system is talking to someone else and the line is busy. In this
case, the modem returns an error message indicating the reason. Modem
chats are not capable of detecting such messages; <B
CLASS="COMMAND"
>uucico</B
> 
continues to wait for the expected string until it times out. The UUCP
log file therefore only shows a bland &#8220;timed out in chat
script&#8221; instead of the specific reason.</P
><P
>However, Taylor UUCP allows you to tell <B
CLASS="COMMAND"
>uucico</B
> about these
error messages using the <B
CLASS="COMMAND"
>chat-fail</B
>
command as shown above. When <B
CLASS="COMMAND"
>uucico</B
> detects a chat-fail
string while executing the modem chat, it aborts the call and logs the error
message in the UUCP log file.</P
><P
>The last command in the example shown above tells UUCP to toggle the Data Terminal Ready (DTR) control line before starting the modem chat. Normally, 
the serial driver raises DTR when a process opens the device to tell the 
attached modem that someone wants to talk to it. The 
<SPAN
CLASS="SYSTEMITEM"
>dtr-toggle</SPAN
> feature then drops DTR, 
waits a moment, and raises it again.  Many modems can be configured 
to react to a drop of DTR by going off-hook, entering command state, or 
resetting themselves.<A
NAME="X-087-2-FNUU11"
HREF="#FTN.X-087-2-FNUU11"
><SPAN
CLASS="footnote"
>[98]</SPAN
></A
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13386"
>16.2.9. UUCP Over TCP</A
></H3
><P
>&#13;
Absurd as it may sound, using UUCP to transfer data over TCP is not that bad
an idea, especially when transferring large amounts of data such as Usenet
news.  On TCP-based links, news is generally exchanged using the NNTP
protocol, through which articles are requested and sent individually without
compression or any other optimization. Although adequate for large sites
with several concurrent newsfeeds, this technique is very unfavorable for
small sites that receive their news over a relatively slow connection such
as ISDN. These sites will usually want to combine the qualities of TCP with
the advantages of sending news in large batches, which can be compressed and
thus transferred with very low overhead. A common way to transfer these
batches is to use UUCP over TCP.</P
><P
>In <TT
CLASS="FILENAME"
>sys</TT
>, you would specify a system to be called via TCP 
like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>system          gmu
address         news.groucho.edu
time            Any
port            tcp-conn
chat            ogin: vstout word: clouseau</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <B
CLASS="COMMAND"
>address</B
> command gives the
IP address of the host or its fully qualified domain name.  The
corresponding <TT
CLASS="FILENAME"
>port</TT
> entry would read:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>port            tcp-conn
type            tcp
service         540</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The entry states that a TCP connection should be used when a
<TT
CLASS="FILENAME"
>sys</TT
> entry references
<SPAN
CLASS="SYSTEMITEM"
>tcp-conn</SPAN
>, and that
<B
CLASS="COMMAND"
>uucico</B
> should attempt to connect to the TCP network port
540 on the remote host. This is the default port number of the UUCP service.
Instead of the port number, you may also give a symbolic port name to the
<B
CLASS="COMMAND"
>service</B
> command. The port number
corresponding to this name will be looked up in
<TT
CLASS="FILENAME"
>/etc/services</TT
>. The common name for the UUCP service is
<SPAN
CLASS="SYSTEMITEM"
>uucpd</SPAN
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13409"
>16.2.10. Using a Direct Connection</A
></H3
><P
>&#13;Assume you use a direct line to connect your system
<SPAN
CLASS="SYSTEMITEM"
>vstout</SPAN
> to
<SPAN
CLASS="SYSTEMITEM"
>tiny</SPAN
>. Much like in the modem case,
you have to write a system entry in the <TT
CLASS="FILENAME"
>sys</TT
> file. The
<B
CLASS="COMMAND"
>port</B
> command identifies the serial port
<SPAN
CLASS="SYSTEMITEM"
>tiny</SPAN
> is hooked up to:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>system          tiny
time            Any
port            direct1
speed           38400
chat            ogin: cathcart word: catch22</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>In the <TT
CLASS="FILENAME"
>port</TT
> file, you have to describe the serial port
for the direct connection. A <SPAN
CLASS="SYSTEMITEM"
>dialer</SPAN
>
entry is not needed because there's no need for dialing:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>port            direct1
type            direct
speed           38400
device		    /dev/ttyS1</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-UUCP.PERMISSIONS"
>16.3. Controlling Access to UUCP Features</A
></H2
><P
>&#13;
UUCP is quite a flexible system. With that flexibility comes a need to
carefully control access to its features to prevent abuse, whether it be 
intentional or accidental. The primary features of concern to the UUCP 
administrator are remote command execution, file transfer, and forwarding. 
Taylor UUCP provides a means of limiting the freedom that remote UUCP hosts 
have in exercising each of these features. With careful selection of 
permissions, the UUCP administrator can ensure that the host's security is 
preserved.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13436"
>16.3.1. Command Execution</A
></H3
><P
>&#13;
UUCP's task is to copy files from one system to another and to request
execution of certain commands on remote hosts. Of course, you as an
administrator would want to control what rights you grant other
systems&#8212;allowing them to execute any command they choose on your system 
is definitely not a good idea.</P
><P
>&#13;




By default, the only commands Taylor UUCP allows other systems to execute on
your machine are <B
CLASS="COMMAND"
>rmail</B
> and <B
CLASS="COMMAND"
>rnews</B
>, which
are commonly used to exchange email and Usenet News over UUCP. To change the
set of commands for a particular system, you can use the
<SPAN
CLASS="SYSTEMITEM"
>commands</SPAN
> keyword in the
<TT
CLASS="FILENAME"
>sys</TT
> file. Similarly, you may want to limit the search
path to just those directories containing the allowed commands. You can
change the search path allowed for a remote host with the
<SPAN
CLASS="SYSTEMITEM"
>command-path</SPAN
> statement. For instance,
you may want to allow system
<SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
> to execute the
<B
CLASS="COMMAND"
>bsmtp</B
> command in addition to <B
CLASS="COMMAND"
>rmail</B
>
and <B
CLASS="COMMAND"
>rnews</B
>:<A
NAME="X-087-2-FNUU12"
HREF="#FTN.X-087-2-FNUU12"
><SPAN
CLASS="footnote"
>[99]</SPAN
></A
>

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>system          pablo
...
commands        rmail rnews bsmtp</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13476"
>16.3.2. File Transfers</A
></H3
><P
>&#13;
Taylor UUCP also allows you to fine-tune file transfers in great
detail. At one extreme, you can disable transfers to and from a
particular system. Just set <SPAN
CLASS="SYSTEMITEM"
>request</SPAN
> to <SPAN
CLASS="SYSTEMITEM"
>no</SPAN
>, and the remote system will not be able
to either retrieve files from your system or send it any
files. Similarly, you can prohibit your users from transferring files
to or from a system by setting <SPAN
CLASS="SYSTEMITEM"
>transfer</SPAN
> to <SPAN
CLASS="SYSTEMITEM"
>no</SPAN
>.  By default, users on both the local
and the remote system are allowed to upload and download files.</P
><P
>In addition, you can configure the directories that files may be
copied to and from. Usually you will want to restrict access from
remote systems to a single directory hierarchy, but still allow your
users to send files from their home directory. Commonly, remote users are 
allowed to receive files only from the public UUCP directory
<TT
CLASS="FILENAME"
>/var/spool/uucppublic</TT
>.  This is the traditional
place to make files publicly available, very much like FTP servers on
the Internet.<A
NAME="X-087-2-UUCP-FNUU13"
HREF="#FTN.X-087-2-UUCP-FNUU13"
><SPAN
CLASS="footnote"
>[100]</SPAN
></A
></P
><P
>Taylor UUCP provides four different commands to configure the
directories for sending and receiving files. They are: 
<B
CLASS="COMMAND"
>local-send</B
>, which specifies the list of
directories a user may ask UUCP to send files from; 
<B
CLASS="COMMAND"
>local-receive</B
>, which gives the list of
directories a user may ask to receive files to; and 
<B
CLASS="COMMAND"
>remote-send</B
> and <B
CLASS="COMMAND"
>remote-receive</B
>, 
which do the analogous for
requests from a foreign system. Consider the following example:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>system          pablo
...
local-send      /home ~
local-receive   /home ~/receive
remote-send     ~ !~/incoming !~/receive
remote-receive  ~/incoming</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <B
CLASS="COMMAND"
>local-send</B
> command allows
users on your host to send any files below <TT
CLASS="FILENAME"
>/home</TT
>
and from the public UUCP directory to <SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
>. The <B
CLASS="COMMAND"
>local-receive</B
> 
command allows them to
receive files either to the world-writable
<TT
CLASS="FILENAME"
>receive</TT
> directory in the
<TT
CLASS="FILENAME"
>uucppublic</TT
>, or any world-writable directory below
<TT
CLASS="FILENAME"
>/home</TT
>. The <B
CLASS="COMMAND"
>remote-send</B
> 
directive allows <SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
> to request files from
<TT
CLASS="FILENAME"
>/var/spool/uucppublic</TT
>, except for files from the
<TT
CLASS="FILENAME"
>incoming</TT
> and <TT
CLASS="FILENAME"
>receive</TT
>
directories.  This is signaled to <B
CLASS="COMMAND"
>uucico</B
> by
preceding the directory names with exclamation marks. Finally, the
last line allows <SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
> to
upload files to <SPAN
CLASS="SYSTEMITEM"
>incoming</SPAN
>.</P
><P
>A major problem with file transfers using UUCP is that it receives files
only to directories that are world-writable. This may tempt some users to set
up traps for other users. However, there's no way to escape this problem
outside of disabling UUCP file transfers altogether.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13518"
>16.3.3. Forwarding</A
></H3
><P
>&#13;
UUCP provides a mechanism to have other systems execute file transfers on your
behalf. For instance, suppose your system has <B
CLASS="COMMAND"
>uucp</B
> access 
to a system called <SPAN
CLASS="SYSTEMITEM"
>seci</SPAN
>, but not to 
another system called <SPAN
CLASS="SYSTEMITEM"
>uchile</SPAN
>. This 
allows you to make <SPAN
CLASS="SYSTEMITEM"
>seci</SPAN
> retrieve a 
file from <SPAN
CLASS="SYSTEMITEM"
>uchile</SPAN
> for you and send it 
to your system. The following command would achieve this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>uucp -r seci!uchile!~/find-ls.gz ~/uchile.files.gz</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This technique of passing a job through several systems is called
<EM
>forwarding</EM
>. On your own UUCP system, you would want to 
limit the forwarding service to a few hosts you trust not to run up a 
horrendous phone bill by making you download the latest X11R6 source release 
for them.</P
><P
>By default, Taylor UUCP prohibits forwarding altogether. To enable
forwarding for a particular system, you can use the 
<B
CLASS="COMMAND"
>forward</B
> command. This command specifies a
list of sites the system may request you to forward jobs to and
from. For instance, the UUCP administrator of <SPAN
CLASS="SYSTEMITEM"
>seci</SPAN
> would have to add the following
lines to the <TT
CLASS="FILENAME"
>sys</TT
> file to allow <SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
> to request files from <SPAN
CLASS="SYSTEMITEM"
>uchile</SPAN
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>####################
# pablo
system          pablo
...
forward         uchile
####################
# uchile
system          uchile
...
forward-to      pablo</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>forward-to</SPAN
> entry for
<SPAN
CLASS="SYSTEMITEM"
>uchile</SPAN
> is necessary so that any files
returned by it are actually passed on to
<SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
>. Otherwise UUCP would drop them.
This entry uses a variation of the
<B
CLASS="COMMAND"
>forward</B
> command that permits
<SPAN
CLASS="SYSTEMITEM"
>uchile</SPAN
> to send files only to
<SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
> through
<SPAN
CLASS="SYSTEMITEM"
>seci</SPAN
>, not the other way round.</P
><P
>To permit forwarding to any system, use the special keyword
<SPAN
CLASS="SYSTEMITEM"
>ANY</SPAN
> (capital letters required).</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-UUCP.DIALIN"
>16.4. Setting Up Your System for Dialing In</A
></H2
><P
>&#13;

If you want to set up your site for dialing in, you have to permit logins on
your serial port and customize some system files to provide UUCP accounts, 
which we will cover in this section. </P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-UUCP.DIALIN.ACCOUNTS"
>16.4.1. Providing UUCP Accounts</A
></H3
><P
>&#13;
To begin with, you have to set up user accounts that let remote sites log into
your system and establish a UUCP connection. Generally, you will provide
a separate login name to each system that polls you. When setting up an
account for system <SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
>, you might
give it the username <SPAN
CLASS="SYSTEMITEM"
>Upablo</SPAN
>. There is
no enforced policy on login names; they can be just about anything, but it
will be convenient for you if the login name is easily related to the remote
host name.</P
><P
>For systems that dial in through the serial port, you usually have to add
these accounts to the system password file <TT
CLASS="FILENAME"
>/etc/passwd</TT
>.
It is good practice to put all UUCP logins in a special group, such as
<SPAN
CLASS="SYSTEMITEM"
>uuguest</SPAN
>. The account's home directory
should be set to the public spool directory
<TT
CLASS="FILENAME"
>/var/spool/uucppublic</TT
>&#8201;; its login shell must be
<B
CLASS="COMMAND"
>uucico</B
>.</P
><P
> 
To serve UUCP systems that connect to your site over TCP, you have to
set up <B
CLASS="COMMAND"
>inetd</B
> to handle incoming connections on the
<SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
> port by adding the
following line to
<TT
CLASS="FILENAME"
>/etc/inetd.conf</TT
>&#8201;:<A
NAME="X-087-2-FNUU14"
HREF="#FTN.X-087-2-FNUU14"
><SPAN
CLASS="footnote"
>[101]</SPAN
></A
>

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>uucp   stream  tcp   nowait  root  /usr/sbin/tcpd  /usr/lib/uucp/uucico -l</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13; 
The <CODE
CLASS="OPTION"
>&#8211;l</CODE
> option makes <B
CLASS="COMMAND"
>uucico</B
> perform
its own login authorization. It prompts for a login name and a password
just like the standard <B
CLASS="COMMAND"
>login</B
> program, but relies on its
private password database instead of <TT
CLASS="FILENAME"
>/etc/passwd</TT
>. This
private password file is named <TT
CLASS="FILENAME"
>/etc/uucp/passwd</TT
> and
contains pairs of login names and passwords:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Upablo  IslaNegra
Ulorca  co'rdoba</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This file must be owned by
<SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
> and have permissions of 600.</P
><P
>&#13;Does this database sound like such a good idea that you would like to use
it on normal serial logins, too? Well, in some cases you can. What you
need is a <B
CLASS="COMMAND"
>getty</B
> program that you can tell to invoke
<B
CLASS="COMMAND"
>uucico</B
> instead of <B
CLASS="COMMAND"
>/bin/login</B
> for
your UUCP users.<A
NAME="X-087-2-FNUU15"
HREF="#FTN.X-087-2-FNUU15"
><SPAN
CLASS="footnote"
>[102]</SPAN
></A
> The invocation of
<B
CLASS="COMMAND"
>uucico</B
> would look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>/usr/lib/uucp/uucico -l -u <TT
CLASS="REPLACEABLE"
><I
>user</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
>

The <CODE
CLASS="OPTION"
>&#8211;u</CODE
> option tells it to use the specified user
name rather than prompting for it.<A
NAME="X-087-2-FNUU16"
HREF="#FTN.X-087-2-FNUU16"
><SPAN
CLASS="footnote"
>[103]</SPAN
></A
>&#13;</P
><P
>To protect your UUCP users from callers who might give a false system name and
snarf all their mail, you should add
<B
CLASS="COMMAND"
>called-login</B
> commands to each system
entry in the <TT
CLASS="FILENAME"
>sys</TT
> file. This is described in the next
section.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-UUCP.SECURITY.CALLED-LOGIN"
>16.4.2. Protecting Yourself Against Swindlers</A
></H3
><P
>&#13; 
A major problem with UUCP is that the calling system can lie about its name;
it announces its name to the called system after logging in, but the server
doesn't have any way to check it. Thus, an attacker could log into his or her
own UUCP account, pretend to be someone else, and pick up that other site's
mail. This is particularly troublesome if you offer login via anonymous UUCP,
where the password is made public.</P
><P
>You <EM
>must</EM
> guard against this sort of impostor. The cure
for this disease is to require each system to use a particular login name
by specifying a <SPAN
CLASS="SYSTEMITEM"
>called-login</SPAN
> in
<TT
CLASS="FILENAME"
>sys</TT
>. A sample system entry may look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>system          pablo
... usual options ...
called-login    Upablo</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The upshot is that whenever a system logs in and pretends it is
<SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
>,
<B
CLASS="COMMAND"
>uucico</B
> checks whether it has logged in as
<SPAN
CLASS="SYSTEMITEM"
>Upablo</SPAN
>. If it hasn't, the
calling system is turned down, and the connection is dropped. You
should make it a habit to add the <B
CLASS="COMMAND"
>called-login</B
> command to every system entry
you add to your <TT
CLASS="FILENAME"
>sys</TT
> file. It is important that
you do this for <EM
>all</EM
> systems in your
<B
CLASS="COMMAND"
>sys</B
> file, regardless of whether they will ever call
your site or not. For those sites that never call you, you should
probably set <SPAN
CLASS="SYSTEMITEM"
>called-login</SPAN
> to
some totally bogus user name, such as <SPAN
CLASS="SYSTEMITEM"
>neverlogsin</SPAN
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13652"
>16.4.3. Be Paranoid: Call Sequence Checks</A
></H3
><P
>&#13;Another way to fend off and detect impostors is to use <B
CLASS="COMMAND"
>call sequence 
checks</B
>. These help you protect against intruders who somehow manage to find out the password with which you log into your UUCP system.</P
><P
>When using call sequence checks, both machines keep track of the number of
connections established so far. The counter is incremented with each 
connection. After logging in, the caller sends its call sequence number, and 
the receiver checks it against its own number. If they don't match, the 
connection attempt is rejected. If the initial number is chosen at 
random, attackers will have a hard time guessing the correct call sequence 
number.</P
><P
>But call sequence checks do more for you. Even if some very clever
person should detect your call sequence number as well as your password, you
will find out. When the attacker calls your UUCP feed and steals your
mail, this will increase the feeds call sequence number by one. The next time
<EM
>you</EM
> call your feed and try to log in, the remote
<B
CLASS="COMMAND"
>uucico</B
> will refuse you, because the numbers don't match
anymore!</P
><P
>If you have enabled call sequence checks, you should check your log files
regularly for error messages that hint at possible attacks. If your system
rejects the call sequence number the calling system offers,
<B
CLASS="COMMAND"
>uucico</B
> will put a message into the log file saying
something like, &#8220;Out of sequence call rejected.&#8221; If your system
is rejected by its feed because the sequence numbers are out of sync, it
will put a message in the log file saying, &#8220;Handshake failed
(RBADSEQ).&#8221;</P
><P
>To enable call sequence checks, add the following command to the
system entry:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># enable call sequence checks
sequence        true</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;In addition, you have to create the file containing the sequence
number itself.  Taylor UUCP keeps the sequence number in a file called
<TT
CLASS="FILENAME"
>.Sequence</TT
> in the remote site's spool
directory. It <EM
>must</EM
> be owned by <SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
> and must be mode 600 (i.e., readable
and writeable only by <SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
>). It
is best to initialize this file with an arbitrary, previously
agreed-upon start value. A simple way to create this file is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>cd /var/spool/uucp/pablo</KBD
>
# <KBD
CLASS="USERINPUT"
>echo 94316 &#62; .Sequence</KBD
>
# <KBD
CLASS="USERINPUT"
>chmod 600 .Sequence</KBD
>
# <KBD
CLASS="USERINPUT"
>chown uucp.uucp .Sequence</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Of course, the remote site has to enable call sequence checks as well and
start by using exactly the same sequence number as you.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13685"
>16.4.4. Anonymous UUCP</A
></H3
><P
>&#13;
 
If you want to provide anonymous UUCP access to your system, you first have to
set up a special account for it as previously described.  A common practice 
is to give the anonymous account a login name and a password of
<SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
>.</P
><P
>In addition, you have to set a few of the security options for unknown systems.
For instance, you may want to prohibit them from executing any commands on
your system. However, you cannot set these parameters in a
<TT
CLASS="FILENAME"
>sys</TT
> file entry because the
<B
CLASS="COMMAND"
>system</B
> command requires the system's
name, which you don't have. Taylor UUCP solves this dilemma through the
<B
CLASS="COMMAND"
>unknown</B
> command.
<B
CLASS="COMMAND"
>unknown</B
> can be used in the
<TT
CLASS="FILENAME"
>config</TT
> file to specify any command that can usually
appear in a system entry:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>unknown         remote-receive ~/incoming
unknown         remote-send ~/pub
unknown         max-remote-debug none
unknown         command-path /usr/lib/uucp/anon-bin
unknown         commands rmail</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This will restrict unknown systems to downloading files from below the
<TT
CLASS="FILENAME"
>pub</TT
> directory and uploading files to the
<TT
CLASS="FILENAME"
>incoming</TT
> directory below
<TT
CLASS="FILENAME"
>/var/spool/uucppublic</TT
>. The next line will make
<B
CLASS="COMMAND"
>uucico</B
> ignore any requests from the remote system to
turn on debugging locally. The last two lines permit unknown systems to
execute <B
CLASS="COMMAND"
>rmail</B
>&#8201;; but the command path specified makes
<B
CLASS="COMMAND"
>uucico</B
> look for the <B
CLASS="COMMAND"
>rmail</B
> command in
a private directory named <TT
CLASS="FILENAME"
>anon-bin</TT
> only. This restriction
allows you to provide some special <B
CLASS="COMMAND"
>rmail</B
> that, for instance,
forwards all mail to the superuser for examination. This allows anonymous
users to reach the maintainer of the system, but at the same time prevents 
them from injecting any mail to other sites.</P
><P
>To enable anonymous UUCP, you must specify at least one
<SPAN
CLASS="SYSTEMITEM"
>unknown</SPAN
> statement in
<TT
CLASS="FILENAME"
>config</TT
>. Otherwise <B
CLASS="COMMAND"
>uucico</B
> will
reject all unknown systems.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-UUCP.PROTOCOLS"
>16.5. UUCP Low-Level Protocols</A
></H2
><P
>&#13;To negotiate session control and file transfers with the remote end,
<B
CLASS="COMMAND"
>uucico</B
> uses a set of standardized messages. This is often
referred to as the <B
CLASS="COMMAND"
>high-level protocol</B
>. During the 
initialization phase and the hangup phase these are simply sent across as 
strings. However, during the real transfer phase, an additional low-level 
protocol that is mostly transparent to the higher levels is employed. This 
protocol offers some added benefits, such as allowing error checks on data 
sent over unreliable links.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13727"
>16.5.1. Protocol Overview</A
></H3
><P
>&#13;UUCP is used over different types of connections, such as serial lines, TCP, 
or sometimes even X.25; it is advantageous to transport UUCP within
protocols designed specifically for the underlying network protocol. In
addition, several implementations of UUCP have introduced different
protocols that do roughly the same thing.</P
><P
>Protocols can be divided into two categories: <B
CLASS="COMMAND"
>streaming</B
> 
and <B
CLASS="COMMAND"
>packet</B
> protocols. Protocols of the streaming variety 
transfer a file as a whole, possibly computing a checksum over it. This is 
nearly free of overhead, but requires a reliable connection because any 
error will cause the whole file to be retransmitted. These protocols are 
commonly used over TCP connections but are not suitable for use over 
telephone lines. Although modern modems do quite a good job at error 
correction, they are not perfect, nor is there any error detection between 
your computer and the modem.</P
><P
>On the other hand, packet-oriented protocols split up the file into
several chunks of equal size. Each packet is sent and received
separately, a checksum is computed, and an acknowledgment is returned
to the sender. To make this more efficient, sliding-window protocols
have been invented, which allow for a limited number (a window) of
outstanding acknowledgments at any time. This greatly reduces the
amount of time <B
CLASS="COMMAND"
>uucico</B
> has to wait during a
transmission. Still, the relatively large overhead compared to a
streaming protocol makes packet protocols inefficient for TCP use, but
ideal for telephone lines.</P
><P
>The width of the data path also makes a difference. Sometimes sending 8-bit
characters over a serial connection is impossible; for instance, the
connection could go through a stupid terminal server that strips off the eighth
bit. When you transmit 8-bit characters over a 7-bit connection, they have to
be quoted on transmission. In the worst-case scenerio, quoting doubles the 
amount of data to be transmitted, although compression done by the hardware may
compensate. Lines that can transmit arbitrary 8-bit characters
are usually called <EM
>8-bit clean</EM
>. This is the case for all
TCP connections, as well as for most modem connections.</P
><P
>Taylor UUCP 1.06 supports a wide variety of UUCP protocols. The most common
of these are:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><EM
>g</EM
></DT
><DD
><P
>This is the most common protocol and should be understood by virtually all
<B
CLASS="COMMAND"
>uucico</B
>s. It does thorough error checking and is therefore
well suited for noisy telephone links. <EM
>g</EM
> requires an
8-bit clean connection. It is a packet-oriented protocol that uses a
sliding-window technique.</P
></DD
><DT
><EM
>i</EM
></DT
><DD
><P
>This is a bidirectional packet protocol, which can send and receive files at
the same time. It requires a full-duplex connection and an 8-bit clean data
path. It is currently understood by Taylor UUCP only.</P
></DD
><DT
><EM
>t</EM
></DT
><DD
><P
>This protocol is intended for use over a TCP connection or other truly
error-free networks.  It uses packets of 1,024 bytes and requires an 8-bit
clean connection.</P
></DD
><DT
><EM
>e</EM
></DT
><DD
><P
>This should basically do the same as <EM
>t</EM
>. The main
difference is that <EM
>e</EM
> is a streaming protocol and is
thus suited only to reliable network connections.</P
></DD
><DT
><EM
>f</EM
></DT
><DD
><P
>This is intended for use with reliable X.25 connections. It is a streaming
protocol and expects a 7-bit data path. 8-bit characters are quoted, which
can make it very inefficient.</P
></DD
><DT
><EM
>G</EM
></DT
><DD
><P
>This is the System V Release 4 version of the <EM
>g</EM
> protocol.
It is also understood by some other versions of UUCP.</P
></DD
><DT
><EM
>a</EM
></DT
><DD
><P
>This protocol is similiar to ZMODEM. It requires an 8-bit connection, but
quotes certain control characters like XON and XOFF.</P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13782"
>16.5.2. Tuning the Transmission Protocol</A
></H3
><P
>&#13;All protocols allow for some variation in packet sizes, timeouts, etc. 
Usually, the defaults work well under standard circumstances, but may
not be optimal for your situation.  The <EM
>g</EM
> protocol, for
instance, uses window sizes from 1 to 7, and packet sizes in powers of 2
ranging from 64 through 4096. If your telephone line is usually so noisy that
it drops more than 5 percent of all packets, you should probably lower the
packet size and shrink the window. On the other hand, on very good telephone
lines the protocol overhead of sending acknowledgments for every 128 bytes may
prove wasteful, so you might increase the packet size to 512 or even 1,024.
Most binaries included in Linux distributions default to a window size of 7
and 128-byte packets.</P
><P
>Taylor UUCP lets you tune parameters with the 
<B
CLASS="COMMAND"
>protocol-parameter</B
> command in the
<TT
CLASS="FILENAME"
>sys</TT
> file.  For instance, to set the
<EM
>g</EM
> protocol's packet size to 512 when talking to
<SPAN
CLASS="SYSTEMITEM"
>pablo</SPAN
>, you have to add:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>system          pablo
...
protocol-parameter g  packet-size  512</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The tunable parameters and their names vary from protocol to protocol. For a
complete list of them, refer to the documentation enclosed in the Taylor UUCP
source.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13797"
>16.5.3. Selecting Specific Protocols</A
></H3
><P
>&#13;Not every implementation of <B
CLASS="COMMAND"
>uucico</B
> speaks and understands
each protocol, so during the initial handshake phase, both processes have to
agree on a common one.  The master <B
CLASS="COMMAND"
>uucico</B
> offers the
slave a list of supported protocols by sending
<TT
CLASS="LITERAL"
>P</TT
><TT
CLASS="REPLACEABLE"
><I
>protlist</I
></TT
>, from which the slave
may pick one.</P
><P
>Based on the type of port used (modem, TCP, or direct),
<B
CLASS="COMMAND"
>uucico</B
> will compose a default list of
protocols. For modem and direct connections, this list usually
comprises <EM
>i</EM
>, <EM
>a</EM
>,
<EM
>g</EM
>, <EM
>G</EM
>, and
<EM
>j</EM
>.  For TCP connections, the list is
<EM
>t</EM
>, <EM
>e</EM
>,
<EM
>i</EM
>, <EM
>a</EM
>,
<EM
>g</EM
>, <EM
>G</EM
>,
<EM
>j</EM
>, and <EM
>f</EM
>. You can override
this default list with the <B
CLASS="COMMAND"
>protocols</B
> command, which may be specified
in a system entry as well as a port entry. For instance, you might
edit the <TT
CLASS="FILENAME"
>port</TT
> file entry for your modem port like
this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>port            serial1
...
protocols       igG</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This will require any incoming or outgoing connection through this port to use
<EM
>i</EM
>, <EM
>g</EM
>, or <EM
>G</EM
>. If
the remote system does not support any of these, the conversation will fail.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-UUCP.MISC.FAQ"
>16.6. Troubleshooting</A
></H2
><P
>&#13;This section describes what may go wrong with your UUCP connection and makes
location suggestions to fix the error. Although these problems are 
encountered on a regular basis, there is much more that can go wrong
than what we have listed.</P
><P
>&#13;If you have a problem, enable debugging with <CODE
CLASS="OPTION"
>&#8211;xall</CODE
>,
and take a look at the output in <TT
CLASS="FILENAME"
>Debug</TT
> in the spool
directory. The file should help you to quickly recognize the problem. It is 
often helpful to turn on the modem's speaker when it doesn't 
connect. With Hayes-compatible modems, you can turn on the speaker by adding
<TT
CLASS="LITERAL"
>ATL1M1 OK</TT
> to the modem chat in the
<TT
CLASS="FILENAME"
>dial</TT
> file.</P
><P
>The first check should always be whether all file permissions are set
correctly. <B
CLASS="COMMAND"
>uucico</B
> should be setuid <SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
>, and all files in
<TT
CLASS="FILENAME"
>/usr/lib/uucp</TT
>,
<TT
CLASS="FILENAME"
>/var/spool/uucp</TT
>, and
<TT
CLASS="FILENAME"
>/var/spool/uucppublic</TT
> should be owned by
<SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
>. There are also some
hidden files in the spool directory which must be owned by <SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
> as well.<A
NAME="X-087-2-FNUU17"
HREF="#FTN.X-087-2-FNUU17"
><SPAN
CLASS="footnote"
>[104]</SPAN
></A
></P
><P
>When you're sure you have the permissions of all files set correctly, and
you're still experiencing problems, you can then begin to take error
messages more literally. We'll now look at some of the more common errors
and problems.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13857"
>16.6.1. uucico Keeps Saying &#8220;Wrong Time to Call&#8221;</A
></H3
><P
>This probably means that in the system entry in <TT
CLASS="FILENAME"
>sys</TT
>, you
didn't specify a <B
CLASS="COMMAND"
>time</B
> command that
details when the remote system may be called, or you gave one that actually
forbids calling at the current time. If no call schedule is given,
<B
CLASS="COMMAND"
>uucico</B
> assumes the system can never be called.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13863"
>16.6.2. uucico Complains That the Site Is Already Locked</A
></H3
><P
>This means that <B
CLASS="COMMAND"
>uucico</B
> detects a lock file for the remote
system in <TT
CLASS="FILENAME"
>/var/spool/uucp</TT
>. The lock file may be from an
earlier call to the system that crashed or was killed. Another possible
explanation is that there's another <B
CLASS="COMMAND"
>uucico</B
> process
sitting around that is trying to dial the remote system and has gotten stuck
in a chat script, or stalled for some other reason.</P
><P
>To correct this error, kill all <B
CLASS="COMMAND"
>uucico</B
> processes
open for the site with a hangup signal, and remove all lock files that
they have left lying around.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13871"
>16.6.3. You Can Connect to the Remote Site, but the Chat Script Fails</A
></H3
><P
>Look at the text you receive from the remote site. If it's garbled, you might
have a speed-related problem. Otherwise, confirm that it really agrees with what
your chat script expects.  Remember, the chat script starts with an expect
string. If you receive the login prompt and send your name, but never get the
password prompt, insert some delays before sending it, or even in between the
letters. You might be too fast for your modem.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13874"
>16.6.4. Your Modem Does Not Dial</A
></H3
><P
>If your modem doesn't indicate that the DTR line has been raised when
<B
CLASS="COMMAND"
>uucico</B
> calls out, you might not have given the
right device to <B
CLASS="COMMAND"
>uucico</B
>. If your modem recognizes
DTR, check with a terminal program that you can write to the modem. If
this works, turn on echoing with <SPAN
CLASS="SYSTEMITEM"
>\E</SPAN
> at the start of the modem chat. If the
modem doesn't echo your commands during the modem chat, check if your
line speed is too high or low. If you see the echo, check if you have
disabled modem responses or set them to number codes.  Verify that the
chat script itself is correct. Remember that you have to write two
backslashes to send one to the modem.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13880"
>16.6.5. Your Modem Tries to Dial but Doesn't Get Out</A
></H3
><P
>Insert a delay into the phone number, especially if you have to dial a
special sequence to gain an outside line from a corporate telephone network.
Make sure you are using the correct dial type, as some telephone networks
support only one type of dialing. Additionally, double check the telephone
number to make sure it's correct.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN13883"
>16.6.6. Login Succeeds, but the Handshake Fails</A
></H3
><P
>Well, there can be a number of problems in this situation. The output in the 
log file should tell you a lot. Look at what protocols the remote site 
offers (it sends a string <TT
CLASS="LITERAL"
>P</TT
>
<TT
CLASS="REPLACEABLE"
><I
>protlist</I
></TT
> during the handshake). For the handshake 
to succeed, both ends must support at least one common protocol, so check 
that they do.</P
><P
>If the remote system sends <B
CLASS="COMMAND"
>RLCK</B
>, there is a stale lockfile
for you on the remote system already connected to the remote system on a 
different line.  Otherwise, ask the remote system administrator to remove the 
file.</P
><P
>If the remote system sends <B
CLASS="COMMAND"
>RBADSEQ</B
>, it has conversation 
count checks enabled for you, but the numbers didn't match. If it sends
<B
CLASS="COMMAND"
>RLOGIN</B
>, you were not permitted to log in under this ID.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN13893"
>16.7. Log Files and Debugging</A
></H2
><P
>&#13;

When compiling the UUCP suite to use Taylor-style logging, you have only three
global log files, all of which reside in the spool directory. The main log
file is named <TT
CLASS="FILENAME"
>Log</TT
> and contains all the information about
established connections and transferred files. A typical excerpt looks like
this (after a little reformatting to make it fit the page):

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>uucico pablo - (1994-05-28 17:15:01.66 539) Calling system pablo (port cua3)
uucico pablo - (1994-05-28 17:15:39.25 539) Login successful
uucico pablo - (1994-05-28 17:15:39.90 539) Handshake successful
               (protocol 'g' packet size 1024 window 7)
uucico pablo postmaster (1994-05-28 17:15:43.65 539) Receiving D.pabloB04aj
uucico pablo postmaster (1994-05-28 17:15:46.51 539) Receiving X.pabloX04ai
uucico pablo postmaster (1994-05-28 17:15:48.91 539) Receiving D.pabloB04at
uucico pablo postmaster (1994-05-28 17:15:51.52 539) Receiving X.pabloX04as
uucico pablo postmaster (1994-05-28 17:15:54.01 539) Receiving D.pabloB04c2
uucico pablo postmaster (1994-05-28 17:15:57.17 539) Receiving X.pabloX04c1
uucico pablo - (1994-05-28 17:15:59.05 539) Protocol 'g' packets: sent 15,
                resent 0, received 32
uucico pablo - (1994-05-28 17:16:02.50 539) Call complete (26 seconds)
uuxqt pablo postmaster (1994-05-28 17:16:11.41 546) Executing X.pabloX04ai
               (rmail okir)
uuxqt pablo postmaster (1994-05-28 17:16:13.30 546) Executing X.pabloX04as
               (rmail okir)
uuxqt pablo postmaster (1994-05-28 17:16:13.51 546) Executing X.pabloX04c1
               (rmail okir)</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;The next important log file is <TT
CLASS="FILENAME"
>Stats</TT
>, which lists file
transfer statistics. The section of <TT
CLASS="FILENAME"
>Stats</TT
> corresponding
to the above transfer looks like this (again, the lines have been split to fit
the page):

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>postmaster pablo (1994-05-28 17:15:44.78)
                  received 1714 bytes in 1.802 seconds (951 bytes/sec)
postmaster pablo (1994-05-28 17:15:46.66)
                  received 57 bytes in 0.634 seconds (89 bytes/sec)
postmaster pablo (1994-05-28 17:15:49.91)
                  received 1898 bytes in 1.599 seconds (1186 bytes/sec)
postmaster pablo (1994-05-28 17:15:51.67)
                  received 65 bytes in 0.555 seconds (117 bytes/sec)
postmaster pablo (1994-05-28 17:15:55.71)
                  received 3217 bytes in 2.254 seconds (1427 bytes/sec)
postmaster pablo (1994-05-28 17:15:57.31)
                  received 65 bytes in 0.590 seconds (110 bytes/sec)</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The third file is <TT
CLASS="FILENAME"
>Debug</TT
>. Debugging information is 
written here. If you use debugging, make sure this file
has protection mode 600. Depending on the debug mode you select, it may
contain the login and password you use to connect to the remote system.</P
><P
>&#13;If you have some tools around that expect your log files to be in the 
traditional format used by HDB-compatible UUCP implementations, you can also
compile Taylor UUCP to produce HDB-style logs. This is simply a matter of 
enabling a compile-time option in <TT
CLASS="FILENAME"
>config.h</TT
>.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-MAIL"
></A
>Chapter 17. Electronic Mail</H1
><P
>Electronic mail transport has been one of the most prominent uses of
networking since the first networks were devised. Email started as a
simple service that copied a file from one machine to another and
appended it to the recipient's <EM
>mailbox</EM
> file. The
concept remains the same, although an ever-growing net, with its
complex routing requirements and its ever increasing load of messages,
has made a more elaborate scheme necessary.</P
><P
>&#13;
 
Various standards of mail exchange have been devised. Sites on the
Internet adhere to one laid out in RFC-822, augmented by some RFCs
that describe a machine-independent way of transferring just about
<EM
>anything</EM
>, including graphics, sound files, and
special characters sets, by email.<A
NAME="X-087-2-FNMA01"
HREF="#FTN.X-087-2-FNMA01"
><SPAN
CLASS="footnote"
>[105]</SPAN
></A
>
CCITT has defined another standard, X.400. It is still used in some
large corporate and government environments, but is progressively being
retired.</P
><P
> 


Quite a number of mail transport programs have been implemented for
Unix systems. One of the best known is <B
CLASS="COMMAND"
>sendmail</B
>,
which was developed by Eric Allman at the University of California at
Berkeley. Eric Allman now offers <B
CLASS="COMMAND"
>sendmail</B
> through a
commercial venture, but the program remains free
software. <B
CLASS="COMMAND"
>sendmail</B
> is supplied as the standard mail
agent in some Linux distributions. We describe <B
CLASS="COMMAND"
>sendmail</B
>
configuration in <A
HREF="#X-087-2-SENDMAIL"
>Chapter 18</A
>.</P
><P
> 


Linux also uses <B
CLASS="COMMAND"
>Exim</B
>, written by Philip
Hazel of the University of Cambridge. We describe <B
CLASS="COMMAND"
>Exim</B
>
configuration in <A
HREF="#X-087-2-EXIM"
>Chapter 19</A
>.</P
><P
>Compared to <B
CLASS="COMMAND"
>sendmail</B
>, <B
CLASS="COMMAND"
>Exim</B
> is rather
young. For the vast bulk of sites with email requirements, their capabilities
are pretty close.</P
><P
>Both <B
CLASS="COMMAND"
>Exim</B
> and <B
CLASS="COMMAND"
>sendmail</B
> support a
set of configuration files that have to be customized for your
system. Apart from the information that is required to make the mail
subsystem run (such as the local hostname), there are many parameters
that may be tuned. <B
CLASS="COMMAND"
>sendmail</B
>&#8201;'s main
configuration file is very hard to understand at first. It looks as if
your cat has taken a nap on your keyboard with the shift key pressed.
<B
CLASS="COMMAND"
>Exim</B
> configuration files are more structured and
easier to understand than
<B
CLASS="COMMAND"
>sendmail</B
>&#8201;'s. <B
CLASS="COMMAND"
>Exim</B
>,
however, does not provide direct support for UUCP and handles only
domain addresses. Today that isn't as big a limitation as it once might 
have been; most sites stay within <B
CLASS="COMMAND"
>Exim</B
>'s
limitations.  However, for most sites, the work required in setting up
either of them is roughly the same.</P
><P
>In this chapter, we deal with what email is and what issues administrators 
have to deal with. 
<A
HREF="#X-087-2-SENDMAIL"
>Chapter 18</A
> and <A
HREF="#X-087-2-EXIM"
>Chapter 19</A
> provide instructions on setting
up <B
CLASS="COMMAND"
>sendmail</B
> and <B
CLASS="COMMAND"
>Exim</B
> and for the
first time.  The included information should help smaller sites 
become operational, but there are several more options and you can
spend many happy hours in front of your computer configuring the
fanciest features.</P
><P
>Toward the end of this chapter we briefly cover setting up
<B
CLASS="COMMAND"
>elm</B
>, a very common mail user agent on many
Unix-like systems, including Linux.</P
><P
> 
For more information about issues specific to electronic mail on Linux, please

refer to the Electronic Mail HOWTO by
Guylhem Aznar,<A
NAME="X-087-2-FNMA02"
HREF="#FTN.X-087-2-FNMA02"
><SPAN
CLASS="footnote"
>[106]</SPAN
></A
>
which is posted to
<SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.answers</SPAN
> regularly.
The source distributions of <B
CLASS="COMMAND"
>elm</B
>, <B
CLASS="COMMAND"
>Exim</B
>,
and <B
CLASS="COMMAND"
>sendmail</B
> also contain extensive documentation
that should answer most questions on setting them up, and we provide
references to this documentation in their respective chapters. If you need 
general information on email, a number of RFCs deal with this
topic. They are listed in the bibliography at the end of the book.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-MAIL.MESSAGE-FORMAT"
>17.1. What Is a Mail Message?</A
></H2
><P
>A mail message generally consists of a message body, which is the text
of the message, and special administrative data specifying recipients,
transport medium, etc., like what you see when you look at a physical
letter's envelope.</P
><P
> 
This administrative data falls into two categories. In the first category is
any data that is specific to the transport medium, like the address of sender
and recipient. It is therefore called the <EM
>envelope</EM
>. It
may be transformed by the transport software as the message is passed along.</P
><P
> 

The second variety is any data necessary for handling the mail message, which
is not particular to any transport mechanism, such as the message's subject
line, a list of all recipients, and the date the message was sent. In many
networks, it has become standard to prepend this data to the mail message,
forming the so-called <EM
>mail header</EM
>. It is offset from the
<EM
>mail body</EM
> by an empty
line.<A
NAME="X-087-2-FNMA03"
HREF="#FTN.X-087-2-FNMA03"
><SPAN
CLASS="footnote"
>[107]</SPAN
></A
></P
><P
>Most mail transport software in the Unix world use a header format outlined
in RFC-822. Its original purpose was to specify a standard for use on the
ARPANET, but since it was designed to be independent from any environment, it
has been easily adapted to other networks, including many UUCP-based networks.</P
><P
>RFC-822 is only the lowest common denominator, however. More recent
standards have been conceived to cope with growing needs such as
data encryption, international character set support, and MIME


(Multipurpose Internet Mail Extensions, described in RFC-1341 and other RFCs).</P
><P
>In all these standards, the header consists of several lines separated
by an end-of-line sequence. A line is made up of a field name, beginning in
column one, and the field itself, offset by a colon and white space. The
format and semantics of each field vary depending on the field name. A
header field can be continued across a newline if the next line begins
with a whitespace character such as tab. Fields can appear in any order.</P
><P
>A typical mail header may look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Return-Path: &#60;ph10@cus.cam.ac.uk&#62;
Received: ursa.cus.cam.ac.uk (cusexim@ursa.cus.cam.ac.uk [131.111.8.6])
    by al.animats.net (8.9.3/8.9.3/Debian 8.9.3-6) with ESMTP id WAA04654
    for &#60;terry@animats.net&#62;; Sun, 30 Jan 2000 22:30:01 +1100
Received: from ph10 (helo=localhost) by ursa.cus.cam.ac.uk with local-smtp
    (Exim 3.13 #1) id 12EsYC-0001eF-00; Sun, 30 Jan 2000 11:29:52 +0000
Date: Sun, 30 Jan 2000 11:29:52 +0000 (GMT)
From: Philip Hazel &#60;ph10@cus.cam.ac.uk&#62;
Reply-To: Philip Hazel &#60;ph10@cus.cam.ac.uk&#62;
To: Terry Dawson &#60;terry@animats.net&#62;, Andy Oram &#60;andyo@oreilly.com&#62;
Subject: Electronic mail chapter
In-Reply-To: &#60;38921283.A58948F2@animats.net&#62;
Message-ID: &#60;Pine.SOL.3.96.1000130111515.5800A-200000@ursa.cus.cam.ac.uk&#62;</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Usually, all necessary header fields are generated by the mailer interface you
use, like <B
CLASS="COMMAND"
>elm</B
>, <B
CLASS="COMMAND"
>pine</B
>,
<B
CLASS="COMMAND"
>mush</B
>, or <B
CLASS="COMMAND"
>mailx</B
>. However, some are
optional and may be added by the user. <B
CLASS="COMMAND"
>elm</B
>, for example,
allows you to edit part of the message header. Others are added by the mail
transport software. If you look into a local mailbox file, you may see each
mail message preceded by a &#8220;From&#8221; line (note: no colon). This is
<EM
>not</EM
> an RFC-822 header; it has been inserted by your mail
software as a convenience to programs reading the mailbox. To avoid potential
trouble with lines in the message body that also begin with
&#8220;From,&#8221; it has become standard procedure to escape any such
occurrence by preceding it with a &#62; character.</P
><P
>This list is a collection of common header fields and their meanings:


<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>From:</TT
></DT
><DD
><P
>This contains the sender's email address and possibly the
&#8220;real name.&#8221; A complete zoo of formats is used here.</P
></DD
><DT
><TT
CLASS="LITERAL"
>To:</TT
></DT
><DD
><P
>This is a list of recipient email addresses. Multiple recipient addresses
are separated by a comma.</P
></DD
><DT
><TT
CLASS="LITERAL"
>Cc:</TT
></DT
><DD
><P
>This is a list of email addresses that will receive &#8220;carbon copies&#8221;
of the message. Multiple recipient addresses are separated by a comma.</P
></DD
><DT
><TT
CLASS="LITERAL"
>Bcc:</TT
></DT
><DD
><P
>This is a list of email addresses that will receive &#8220;carbon copies&#8221;
of the message. The key difference between a &#8220;Cc:&#8221; and a
&#8220;Bcc:&#8221; is that the addresses listed in a &#8220;Bcc:&#8221; will
not appear in the header of the mail messages delivered to any
recipient. It's a way of alerting recipients that you've sent copies of the
message to other people without telling them who those others are. Multiple
recipient addresses are separated by a comma.</P
></DD
><DT
><TT
CLASS="LITERAL"
>Subject:</TT
></DT
><DD
><P
>Describes the content of the mail in a few words.</P
></DD
><DT
><TT
CLASS="LITERAL"
>Date:</TT
></DT
><DD
><P
>Supplies the date and time the mail was sent.</P
></DD
><DT
><TT
CLASS="LITERAL"
>Reply-To:</TT
></DT
><DD
><P
>Specifies the address the sender wants the recipient's reply directed to.
This may be useful if you have several accounts, but want to receive the bulk
of mail only on the one you use most frequently. This field is optional.</P
></DD
><DT
><TT
CLASS="LITERAL"
>Organization:</TT
></DT
><DD
><P
>The organization that owns the machine from which the mail originates. If your
machine is owned by you privately, either leave this out, or insert
&#8220;private&#8221; or some complete nonsense. This field is not described
by any RFC and is completely optional. Some mail programs support it directly,
many don't.</P
></DD
><DT
><TT
CLASS="LITERAL"
>Message-ID:</TT
></DT
><DD
><P
>A string generated by the mail transport on the originating system. It uniquely
identifies this message.</P
></DD
><DT
><TT
CLASS="LITERAL"
>Received:</TT
></DT
><DD
><P
>Every site that processes your mail (including the machines of sender and
recipient) inserts such a field into the header, giving its site name, a
message ID, time and date it received the message, which site it is from,
and which transport software was used. These lines allow you to trace which
route the message took, and you can complain to the person responsible if
something went wrong.</P
></DD
><DT
><TT
CLASS="LITERAL"
>X-</TT
><TT
CLASS="REPLACEABLE"
><I
>anything:</I
></TT
></DT
><DD
><P
>No mail-related programs should complain about any header that starts
with <TT
CLASS="LITERAL"
>X-</TT
>. It is used to implement
additional features that have not yet made it into an RFC, or never
will. For example, there was once a very large Linux mailing list server that
allowed you to specify which channel you wanted the mail to go to by
adding the string <KBD
CLASS="USERINPUT"
>X-Mn-Key:</KBD
> followed by the channel name.</P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-MAIL.DELIVERY"
>17.2. How Is Mail Delivered?</A
></H2
><P
> 
 
Generally, you will compose mail using a mailer interface like
<B
CLASS="COMMAND"
>mail</B
> or <B
CLASS="COMMAND"
>mailx</B
>, or more
sophisticated ones like <B
CLASS="COMMAND"
>mutt</B
>, <B
CLASS="COMMAND"
>tkrat</B
>,
or <B
CLASS="COMMAND"
>pine</B
>. These programs are called
<EM
>mail user agents</EM
>, or MUAs.  If you send a mail
message, the interface program will in most cases hand it to another
program for delivery. This is called the <EM
>mail transport
agent</EM
>, or MTA. On most systems the same MTA is used for both
local and remote delivery and is usually invoked as
<B
CLASS="COMMAND"
>/usr/sbin/sendmail</B
>, or on non-FSSTND compliant systems as
<B
CLASS="COMMAND"
>/usr/lib/sendmail</B
>. On UUCP systems it is not uncommon to
see mail delivery handled by two separate programs: <B
CLASS="COMMAND"
>rmail</B
>
for remote mail delivery and <B
CLASS="COMMAND"
>lmail</B
> for local mail delivery.</P
><P
>&#13;
Local delivery of mail is, of course, more than just appending the
incoming message to the recipient's mailbox. Usually, the local MTA understands aliasing (setting up local recipient addresses
pointing to other addresses) and forwarding (redirecting a user's mail
to some other destination). Also, messages that cannot be delivered
must usually be <EM
>bounced</EM
>, that is, returned to the
sender along with some error message.</P
><P
>&#13; 
For remote delivery, the transport software used depends on the nature
of the link. Mail delivered over a network using TCP/IP commonly uses
<EM
>Simple Mail Transfer Protocol</EM
> (SMTP), which is
described in RFC-821. SMTP was designed to deliver
 mail directly to a
recipient's machine, negotiating the message transfer with the remote
side's SMTP daemon. Today it is common practice for organizations to
establish special hosts that accept all mail for recipients in the
organization and for that host to manage appropriate delivery to the
intended recipient.</P
><P
>&#13;

Mail is usually not delivered directly in UUCP networks, but
rather is forwarded to the destination host by a number of intermediate
systems. To send a message over a UUCP link, the sending MTA usually executes <B
CLASS="COMMAND"
>rmail</B
> on the forwarding system using
<B
CLASS="COMMAND"
>uux</B
>, and feeds it the message on standard input.</P
><P
>&#13;



Since <B
CLASS="COMMAND"
>uux</B
> is invoked for each message separately, it may
produce a considerable workload on a major mail hub, as well as clutter the
UUCP spool queues with hundreds of small files taking up a disproportionate
amount of disk space.<A
NAME="X-087-2-FNMA04"
HREF="#FTN.X-087-2-FNMA04"
><SPAN
CLASS="footnote"
>[108]</SPAN
></A
> Some MTAs
therefore allow you to collect several messages for a remote system in a
single batch file. The batch file contains the SMTP commands that the local
host would normally issue if a direct SMTP connection were used. This is
called BSMTP, or <EM
>batched</EM
> SMTP. The batch is then fed
to the <B
CLASS="COMMAND"
>rsmtp</B
> or <B
CLASS="COMMAND"
>bsmtp</B
> program on the
remote system, which processes the input almost as if a normal SMTP
connection has occurred.&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-MAIL.ADDRESS"
>17.3. Email Addresses</A
></H2
><P
>Email addresses are made up of at least two parts. One part is the
name of a <EM
>mail domain</EM
> that will ultimately
translate to either the recipient's host or some host that accepts
mail on behalf of the recipient. The other part is some form of unique
user identification that may be the login name of that user, the real
name of that user in &#8220;Firstname.Lastname&#8221; format, or an
arbitrary alias that will be translated into a user or list of
users. Other mail addressing schemes, like X.400, use a more general
set of &#8220;attributes&#8221; that are used to look up the
recipient's host in an X.500 directory server.</P
><P
>How email addresses are interpreted depends greatly on what type of
network you use. We'll concentrate on how TCP/IP and UUCP networks
interpret email addresses.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-MAIL.ADDRESS.RFC822"
>17.3.1. RFC-822</A
></H3
><P
> 
 
Internet sites adhere to the RFC-822 standard, which requires the
familiar notation of <SPAN
CLASS="SYSTEMITEM"
>user@host.domain</SPAN
>, for which <SPAN
CLASS="SYSTEMITEM"
>host.domain</SPAN
> is the host's fully
qualified domain name. The character separating the two is properly
called a &#8220;commercial at&#8221; sign, but it helps if you read it
as &#8220;at.&#8221; This notation does not specify a route to the
destination host. Routing of the mail message is left to the
mechanisms we'll describe shortly.</P
><P
>You will see a lot of RFC-822 if you run an Internet connected site. Its
use extends not only to mail, but has also spilled over into other services,
such as news. We discuss how RFC-822 is used for news in
<A
HREF="#X-087-2-NEWS"
>Chapter 20</A
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-MAIL.ADDRESS.OBSOLETE"
>17.3.2. Obsolete Mail Formats</A
></H3
><P
> 
 


In the original UUCP environment, the prevalent form was
<SPAN
CLASS="SYSTEMITEM"
>path!host!user</SPAN
>, for which 
<SPAN
CLASS="SYSTEMITEM"
>path</SPAN
> described a sequence of hosts
the message had to travel through before reaching the destination
<SPAN
CLASS="SYSTEMITEM"
>host</SPAN
>. This construct is called
the <EM
>bang path</EM
> notation, because an exclamation mark
is colloquially called a &#8220;bang.&#8221; Today, many UUCP-based networks
have adopted RFC-822 and understand domain-based addresses.</P
><P
> 
Other networks have still different means of addressing. DECnet-based
networks, for example, use two colons as an address separator,
yielding an address of <SPAN
CLASS="SYSTEMITEM"
>host::user</SPAN
>.<A
NAME="X-087-2-FNMA05"
HREF="#FTN.X-087-2-FNMA05"
><SPAN
CLASS="footnote"
>[109]</SPAN
></A
>
The X.400 standard uses an entirely different scheme, describing a
recipient by a set of attribute-value pairs, like country and organization.  </P
><P
>Lastly, on FidoNet, each user is identified by a code like <SPAN
CLASS="SYSTEMITEM"
>2:320/204.9</SPAN
>, consisting of four numbers
denoting zone (2 is for Europe), net (320 being Paris and Banlieue),
node (the local hub), and point (the individual user's PC). Fidonet
addresses can be mapped to RFC-822; the above, for example, would be written as <SPAN
CLASS="SYSTEMITEM"
>Thomas.Quinot@p9.f204.n320.z2.fidonet.org</SPAN
>. Now didn't we say domain names were easy to remember?</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-MAIL.ADDRESS.MIXING"
>17.3.3. Mixing Different Mail Formats</A
></H3
><P
>It is inevitable that when you bring together a number of different
systems and a number of clever people, they will seek ways to
interconnect the differing systems so they are capable of
internetworking. Consequently, there are a number of different mail
gateways that are able to link two different email systems together so
that mail may be forwarded from one to another. Addressing is the
critical question when linking two systems. We won't look at the
gateways themselves in any detail, but let's take a look at some of
the addressing complications that may arise when gateways of this sort
are used.</P
><P
> 
 

Consider mixing the UUCP style bang-path notation and RFC-822. These
two types of addressing don't mix too well. Assume there is an address
of <SPAN
CLASS="SYSTEMITEM"
>domainA!user@domainB</SPAN
>. It
is not clear whether the <SPAN
CLASS="SYSTEMITEM"
>@</SPAN
>
sign takes precedence over the path, or vice versa: do we have to send
the message to <SPAN
CLASS="SYSTEMITEM"
>domainB</SPAN
>,
which mails it to <SPAN
CLASS="SYSTEMITEM"
>domainA!user</SPAN
>, or should it be sent to
<SPAN
CLASS="SYSTEMITEM"
>domainA</SPAN
>, which forwards it
to <SPAN
CLASS="SYSTEMITEM"
>user@domainB</SPAN
>&#8201;?</P
><P
> 
Addresses that mix different types of address operators are called
<EM
>hybrid addresses</EM
>. The most common type, which we
just illustrated, is usually resolved by giving the <SPAN
CLASS="SYSTEMITEM"
>@</SPAN
> sign precedence over the path. In
<SPAN
CLASS="SYSTEMITEM"
>domainA!user@domainB</SPAN
>, this
means sending the message to <SPAN
CLASS="SYSTEMITEM"
>domainB</SPAN
> first.</P
><P
>&#13;However, there is a way to specify routes in RFC-822 conformant ways:
<SPAN
CLASS="SYSTEMITEM"
>&#60;@domainA,@domainB:user@domainC&#8201;&#62;</SPAN
> denotes the address of <SPAN
CLASS="SYSTEMITEM"
>user</SPAN
> on
<SPAN
CLASS="SYSTEMITEM"
>domainC</SPAN
>, where
<SPAN
CLASS="SYSTEMITEM"
>domainC</SPAN
> is to be reached through
<SPAN
CLASS="SYSTEMITEM"
>domainA</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>domainB</SPAN
> (in that order). This type
of address is frequently called a <EM
>source routed</EM
> address.
It's not a good idea to rely on this behavior, as revisions to the
RFCs describing mail routing recommend that source routing in a mail
address be ignored and instead an attempt should be made to deliver directly
to the remote destination.</P
><P
> 
 

Then there is the <SPAN
CLASS="SYSTEMITEM"
>%</SPAN
> address
operator: <SPAN
CLASS="SYSTEMITEM"
>user&#8201;%domainB@domainA</SPAN
> is first sent
to <SPAN
CLASS="SYSTEMITEM"
>domainA</SPAN
>, which expands
the rightmost (in this case, the only) percent sign to an <SPAN
CLASS="SYSTEMITEM"
>@</SPAN
> sign. The address is now <SPAN
CLASS="SYSTEMITEM"
>user@domainB</SPAN
>, and the mailer happily
forwards your message to <SPAN
CLASS="SYSTEMITEM"
>domainB</SPAN
>, which delivers it to
<SPAN
CLASS="SYSTEMITEM"
>user</SPAN
>. This type of address
is sometimes referred to as &#8220;Ye Olde ARPAnet Kludge,&#8221; and
its use is discouraged.</P
><P
>There are some implications to using these different types of
addressing that will be described throughout the following
sections. In an RFC-822 environment, you should avoid using anything
other than absolute addresses, such as <SPAN
CLASS="SYSTEMITEM"
>user@host.domain</SPAN
>.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-MAIL.ROUTING"
>17.4. How Does Mail Routing Work?</A
></H2
><P
>The process of directing a message to the recipient's host is called
<EM
>routing</EM
>. Apart from finding a path from the sending
site to the destination, it involves error checking and may involve speed and
cost optimization.</P
><P
>There is a big difference between the way a UUCP site handles routing
and the way an Internet site does. On the Internet, the main job of
directing data to the recipient host (once it is known by its
IP address) is done by the IP networking layer, while in the UUCP zone,
the route has to be supplied by the user or generated by the mail
transfer agent.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-MAIL.ROUTING.INTERNET"
>17.4.1. Mail Routing on the Internet</A
></H3
><P
>On the Internet, the destination host's configuration determines
whether any specific mail routing is performed. The default is to
deliver the message to the destination by first determining what host
the message should be sent to and then delivering it directly to that
host.
 
Most Internet sites want to direct all inbound mail to a highly
available mail server that is capable of handling all this traffic and
have it distribute the mail locally. To announce this service, the
site publishes a so-called MX record for its local domain in its DNS
database. MX stands for <EM
>Mail Exchanger</EM
> and
basically states that the server host is willing to act as a mail
forwarder for all mail addresses in the domain. MX records can also be
used to handle traffic for hosts that are not connected to the
Internet themselves, like UUCP networks or FidoNet hosts that must
have their mail passed through a gateway.</P
><P
>MX records are always assigned a <EM
>preference</EM
>. This
is a positive integer. If several mail exchangers exist for one host,
the mail transport agent will try to transfer the message to the
exchanger with the lowest preference value, and only if this fails
will it try a host with a higher value. If the local host is itself a
mail exchanger for the destination address, it is allowed to forward
messages only to MX hosts with a lower preference than its own; this
is a safe way of avoiding mail loops. If there is no MX record for a
domain, or no MX records left that are suitable, the mail transport
agent is permitted to see if the domain has an IP address associated
with it and attempt delivery directly to that host.</P
><P
>Suppose that an organization, say Foobar, Inc., wants all its mail
handled by its machine <SPAN
CLASS="SYSTEMITEM"
>mailhub</SPAN
>.
It will then have MX records like this in the DNS database:
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>green.foobar.com.        IN   MX      5    mailhub.foobar.com.</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This announces <SPAN
CLASS="SYSTEMITEM"
>mailhub.foobar.com</SPAN
> as
a mail exchanger for <SPAN
CLASS="SYSTEMITEM"
>green.foobar.com</SPAN
>
with a preference of 5. A host that wishes to deliver a message to
<SPAN
CLASS="SYSTEMITEM"
>joe@green.foobar.com</SPAN
> checks DNS and finds the MX record pointing at
<SPAN
CLASS="SYSTEMITEM"
>mailhub</SPAN
>.
If there's no MX with a preference smaller than 5, the message is delivered to <SPAN
CLASS="SYSTEMITEM"
>mailhub</SPAN
>, which then
dispatches it to <SPAN
CLASS="SYSTEMITEM"
>green</SPAN
>.</P
><P
>&#13;

This is a very simple description of how MX records work. For more information
on mail routing on the Internet, refer to RFC-821, RFC-974, and RFC-1123.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-MAIL.ROUTING.UUCP"
>17.4.2. Mail Routing in the UUCP World</A
></H3
><P
>Mail routing on UUCP networks is much more complicated than on the
Internet because the transport software does not perform any routing
itself.  In earlier times, all mail had to be addressed using bang paths.
Bang paths specified a list of hosts through which to forward the
message, separated by exclamation marks and followed by the user's
name.  To address a letter to a user called Janet on a machine named
<SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
>, you would use the path
<SPAN
CLASS="SYSTEMITEM"
>eek!swim!moria!janet</SPAN
>. This would 
send the mail from your host to
<SPAN
CLASS="SYSTEMITEM"
>eek</SPAN
>, from there on to
<SPAN
CLASS="SYSTEMITEM"
>swim</SPAN
>, and finally to
<SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
>.</P
><P
>The obvious drawback of this technique is that it requires you to
remember much more about network topology, fast links, etc. than
Internet routing requires. Much worse than that, changes in the
network topology&#8212;like links being deleted or hosts being
removed&#8212;may cause messages to fail simply because you aren't
aware of the change. And finally, in case you move to a different
place, you will most likely have to update all these routes.</P
><P
>&#13;One thing, however, that made the use of source routing necessary was
the presence of ambiguous hostnames. For instance, assume there are two
sites named <SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
>, one in the U.S.
and one in France. Which site does
<SPAN
CLASS="SYSTEMITEM"
>moria!janet</SPAN
> refer to now? This can
be made clear by specifying what path to reach
<SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
> through.</P
><P
>&#13;


The first step in disambiguating hostnames was the founding of the UUCP
Mapping Project. It is located at Rutgers University and registers all
official UUCP hostnames, along with information on their UUCP neighbors
and their geographic location, making sure no hostname is used twice. The
information gathered by the Mapping Project is published as the
<EM
>Usenet Maps</EM
>, which are distributed regularly through
Usenet. A typical system entry in a
map (after removing the comments) looks like this:<A
NAME="X-087-2-FNMA06"
HREF="#FTN.X-087-2-FNMA06"
><SPAN
CLASS="footnote"
>[110]</SPAN
></A
>

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>moria
        bert(DAILY/2),
        swim(WEEKLY)</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This entry says <SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
> has a link
to <SPAN
CLASS="SYSTEMITEM"
>bert</SPAN
>, which it calls twice a day,
and <SPAN
CLASS="SYSTEMITEM"
>swim</SPAN
>, which it calls weekly. We
will return to the map file format in more detail later.</P
><P
>&#13;

Using the connectivity information provided in the maps, you can
automatically generate the full paths from your host to any
destination site. This information is usually stored in the
<TT
CLASS="FILENAME"
>paths</TT
> file, also called the <EM
>pathalias
database</EM
>. Assume the maps state that you can reach
<SPAN
CLASS="SYSTEMITEM"
>bert</SPAN
> through <SPAN
CLASS="SYSTEMITEM"
>ernie</SPAN
>; a pathalias entry for <SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
> generated from the previous map
snippet may then look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>moria           ernie!bert!moria!%s</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>If you now give a destination address of
<SPAN
CLASS="SYSTEMITEM"
>janet@moria.uucp</SPAN
>, your MTA will pick
the route shown above and send the message to
<SPAN
CLASS="SYSTEMITEM"
>ernie</SPAN
> with an envelope address of
<SPAN
CLASS="SYSTEMITEM"
>bert!moria!janet</SPAN
>.</P
><P
>&#13;





Building a <TT
CLASS="FILENAME"
>paths</TT
> file from the full Usenet maps is not
a very good idea, however. The information provided in them is usually rather
distorted and occasionally out of date.  Therefore, only a number of major
hosts use the complete UUCP world maps to build their
<TT
CLASS="FILENAME"
>paths</TT
> files. Most sites maintain routing information only
for sites in their neighborhood and send any mail to sites they don't
find in their databases to a smarter host with more complete routing
information. This scheme is called <EM
>smart-host routing</EM
>.
Hosts that have only one UUCP mail link (so-called
<EM
>leaf sites</EM
>) don't do any routing of their own; they
rely entirely on their smart host.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN14436"
>17.4.3. Mixing UUCP and RFC-822</A
></H3
><P
>The best cure for the problems of mail routing in UUCP networks so far is the
adoption of the domain name system in UUCP networks. Of course, you can't
query a name server over UUCP. Nevertheless, many UUCP sites have formed small
domains that coordinate their routing internally. In the maps, these domains
announce one or two hosts as their mail gateways so that there doesn't have to
be a map entry for each host in the domain. The gateways handle all mail that
flows into and out of the domain. The routing scheme inside the domain is
completely invisible to the outside world.</P
><P
>This works very well with the smart-host routing scheme.
Global routing information is maintained by the gateways only; minor hosts
within a domain get along with only a small, handwritten
<TT
CLASS="FILENAME"
>paths</TT
> file that lists the routes inside their domain and
the route to the mail hub.  Even the mail gateways do not need routing information for every single UUCP host in the world anymore. Besides
the complete routing information for the domain they serve, they only need to
have routes to entire domains in their databases now. For instance, this
pathalias entry will route all mail for sites in the
<SPAN
CLASS="SYSTEMITEM"
>sub.org</SPAN
> domain to
<SPAN
CLASS="SYSTEMITEM"
>smurf</SPAN
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>.sub.org        swim!smurf!%s</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Mail addressed to <SPAN
CLASS="SYSTEMITEM"
>claire@jones.sub.org</SPAN
>
will be sent to <SPAN
CLASS="SYSTEMITEM"
>swim</SPAN
> with an envelope
address of <SPAN
CLASS="SYSTEMITEM"
>smurf!jones!claire</SPAN
>.</P
><P
>The hierarchical organization of the domain namespace allows mail
servers to mix more specific routes with less specific ones. For
instance, a system in France may have specific routes for subdomains
of <SPAN
CLASS="SYSTEMITEM"
>fr</SPAN
>, but route any mail for hosts
in the <SPAN
CLASS="SYSTEMITEM"
>us</SPAN
> domain toward some system
in the U.S.  In this way, domain-based routing (as this technique is called)
greatly reduces the size of routing databases, as well as the administrative
overhead needed.</P
><P
>The main benefit of using domain names in a UUCP environment, however, is that
compliance with RFC-822 permits easy gatewaying between UUCP networks and the
Internet. Many UUCP domains nowadays have a link with an Internet gateway that
acts as their smart host. Sending messages across the Internet is faster, and
routing information is much more reliable because Internet hosts can use DNS
instead of the Usenet Maps.</P
><P
>In order to be reachable from the Internet, UUCP-based domains usually
have their Internet gateway announce an MX record for them (MX records
were described previously in the section <A
HREF="#X-087-2-MAIL.ROUTING.INTERNET"
>Section 17.4.1</A
>&#8221;). For instance, assume that
<SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
> belongs to the
<SPAN
CLASS="SYSTEMITEM"
>orcnet.org</SPAN
> domain.
<SPAN
CLASS="SYSTEMITEM"
>gcc2.groucho.edu</SPAN
> acts as its Internet
gateway. <SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
> would therefore use
<SPAN
CLASS="SYSTEMITEM"
>gcc2</SPAN
> as its smart host so that all
mail for foreign domains is delivered across the Internet. On the other hand,
<SPAN
CLASS="SYSTEMITEM"
>gcc2</SPAN
> would announce an MX record for
<SPAN
CLASS="SYSTEMITEM"
>*.orcnet.org</SPAN
> and deliver all incoming
mail for <SPAN
CLASS="SYSTEMITEM"
>orcnet</SPAN
> sites to
<SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
>. The asterisk in
<SPAN
CLASS="SYSTEMITEM"
>*.orcnet.org</SPAN
> is a wildcard that
matches all hosts in that domain that don't have any other record associated
with them. This should normally be the case for UUCP-only domains.</P
><P
>The only remaining problem is that the UUCP transport programs can't deal
with fully qualified domain names.  Most UUCP suites were designed to cope
with site names of up to eight characters, some even less, and using
nonalphanumeric characters such as dots is completely out of the question
for most.</P
><P
>Therefore, we need mapping between RFC-822 names and UUCP hostnames.
This mapping is completely implementation-dependent. One
common way of mapping FQDNs to UUCP names is to use the pathalias file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>moria.orcnet.org  ernie!bert!moria!%s</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This will produce a pure UUCP-style bang path from an address that specifies
a fully qualified domain name. Some mailers provide a special file for this;
<B
CLASS="COMMAND"
>sendmail</B
>, for instance, uses the
<TT
CLASS="FILENAME"
>uucpxtable</TT
>.</P
><P
>The reverse transformation (colloquially called
<EM
>domainizing</EM
>&#8201;) is sometimes required when sending
mail from a UUCP network to the Internet. As long as the mail sender
uses the fully qualified domain name in the destination address, this
problem can be avoided by not removing the domain name from the
envelope address when forwarding the message to the smart
host. However, there are still some UUCP sites that are not part of
any domain. They are usually domainized by appending the pseudo-domain
<SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
>.</P
><P
>The pathalias database provides the main routing information in
UUCP-based networks. A typical entry looks like this (site name
and path are separated by tabs):

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>moria.orcnet.org  ernie!bert!moria!%s
moria             ernie!bert!moria!%s</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This makes any message to <SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
> be
delivered via <SPAN
CLASS="SYSTEMITEM"
>ernie</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>bert</SPAN
>. Both
<SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
>'s fully qualified name and
its UUCP name have to be given if the mailer does not have a separate way to
map between these namespaces.</P
><P
>&#13;

If you want to direct all messages to hosts inside a domain to its
mail relay, you may also specify a path in the pathalias database,
giving the domain name preceded by a dot as the target. For example, if
all hosts in <SPAN
CLASS="SYSTEMITEM"
>sub.org</SPAN
> can be reached
through <SPAN
CLASS="SYSTEMITEM"
>swim!smurf</SPAN
>, the pathalias
entry might look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>.sub.org        swim!smurf!%s</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Writing a pathalias file is acceptable only when you are running a site
that does not have to do much routing.  If you have to do routing for a
large number of hosts, a better way is to use the <B
CLASS="COMMAND"
>pathalias</B
>
command to create the file from map files. Maps can be maintained much more
easily, because you may simply add or remove a system by editing the system's
map entry and recreating the map file.  Although the maps published by the
Usenet Mapping Project aren't used for routing very much anymore, smaller
UUCP networks may provide routing information in their own set of maps.</P
><P
>&#13;


A map file mainly consists of a list of sites that each system polls
or is polled by.  The system name begins in the first column and is
followed by a comma-separated list of links. The list may be continued
across newlines if the next line begins with a tab.  Each link
consists of the name of the site followed by a cost given in
brackets. The cost is an arithmetic expression made up of numbers and
symbolic expressions like DAILY or WEEKLY. Lines beginning with a hash
sign are ignored.</P
><P
>As an example, consider <SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
>, which
polls <SPAN
CLASS="SYSTEMITEM"
>swim.twobirds.com</SPAN
> twice a day
and <SPAN
CLASS="SYSTEMITEM"
>bert.sesame.com</SPAN
> once per week.
The link to <SPAN
CLASS="SYSTEMITEM"
>bert</SPAN
> uses a
slow 2,400 bps modem. <SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
> would
publish the following maps entry:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>moria.orcnet.org
        bert.sesame.com(DAILY/2),
        swim.twobirds.com(WEEKLY+LOW)
moria.orcnet.org = moria</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The last line makes <SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
> known
under its UUCP name, as well. Note that its cost must be specified as
<SPAN
CLASS="SYSTEMITEM"
>DAILY/2</SPAN
> because calling
twice a day actually halves the cost for this link.</P
><P
>Using the information from such map files, <B
CLASS="COMMAND"
>pathalias</B
> is
able to calculate optimal routes to any destination site listed in the paths
file and produce a pathalias database from this which can then be used
for routing to these sites.</P
><P
>&#13;<B
CLASS="COMMAND"
>pathalias</B
> provides a couple of other features like
site-hiding (i.e., making sites accessible only through a gateway). See
the <B
CLASS="COMMAND"
>pathalias</B
> manual page for details and a
complete list of link costs.</P
><P
>Comments in the map file generally contain additional information on
the sites described in it. There is a rigid format in which to specify
this information so that it can be retrieved from the maps.  For
instance, a program called <B
CLASS="COMMAND"
>uuwho</B
> uses a database
created from the map files to display this information in a nicely
formatted way. When you register your site with an organization that
distributes map files to its members, you generally have to fill out
such a map entry. Below is a sample map entry (in fact, it's the one
for Olaf's site):

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#N      monad, monad.swb.de, monad.swb.sub.org
#S      AT 486DX50; Linux 0.99
#O      private
#C      Olaf Kirch
#E      okir@monad.swb.de
#P      Kattreinstr. 38, D-64295 Darmstadt, FRG
#L      49 52 03 N / 08 38 40 E
#U      brewhq
#W      okir@monad.swb.de (Olaf Kirch); Sun Jul 25 16:59:32 MET DST 1993
#
monad   brewhq(DAILY/2)
# Domains
monad = monad.swb.de
monad = monad.swb.sub.org</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The whitespace after the first two characters is a tab. The meaning of
most of the fields is pretty obvious; you will receive a detailed
description from whichever domain you register with. The
<SPAN
CLASS="SYSTEMITEM"
>L</SPAN
> field is the most fun to find out:
it gives your geographical position in latitude/longitude and is used to
draw the PostScript maps that show all sites for each country, as well as
worldwide.<A
NAME="X-087-2-FNMA07"
HREF="#FTN.X-087-2-FNMA07"
><SPAN
CLASS="footnote"
>[111]</SPAN
></A
></P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-MAIL.ELM"
>17.5. Configuring elm</A
></H2
><P
><B
CLASS="COMMAND"
>elm</B
> stands for &#8220;electronic mail&#8221; and is one
of the more reasonably named Unix tools. It provides a full-screen interface
with a good help feature. We won't discuss how to use <B
CLASS="COMMAND"
>elm</B
>
here, but only dwell on its configuration options.</P
><P
>Theoretically, you can run <B
CLASS="COMMAND"
>elm</B
> unconfigured, and everything
works well&#8212;if you are lucky. But there are a few options that must be
set, although they are required only on occasion.</P
><P
>When it starts, <B
CLASS="COMMAND"
>elm</B
> reads a set of configuration variables
from the <TT
CLASS="FILENAME"
>elm.rc</TT
> file in <TT
CLASS="FILENAME"
>/etc/elm</TT
>.
Then it attempts to read the file <TT
CLASS="FILENAME"
>.elm/elmrc</TT
> in your
home directory. You don't usually write this file yourself. It is created when
you choose &#8220;Save new options&#8221; from <B
CLASS="COMMAND"
>elm</B
>'s options
menu.</P
><P
>The set of options for the private <TT
CLASS="FILENAME"
>elmrc</TT
> file is also
available in the global <TT
CLASS="FILENAME"
>elm.rc</TT
> file. Most settings in
your private <TT
CLASS="FILENAME"
>elmrc</TT
> file override those of the global file.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-MAIL.ELM.GLOBAL"
>17.5.1. Global elm Options</A
></H3
><P
>In the global <TT
CLASS="FILENAME"
>elm.rc</TT
> file, you must set the options
that pertain to your host's name. For example, at the Virtual Brewery, the file
for <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> contains the following:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#
# The local hostname
hostname = vlager
#
# Domain name
hostdomain = .vbrew.com
#
# Fully qualified domain name
hostfullname = vlager.vbrew.com</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>These options set <B
CLASS="COMMAND"
>elm</B
>'s idea of the local hostname.
Although this information is rarely used, you should set the options.
Note that these particular options only take effect when giving them in
the global configuration file; when found in your private
<TT
CLASS="FILENAME"
>elmrc</TT
>, they will be ignored.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-MAIL.ELM.CHARSETS"
>17.5.2. National Character Sets</A
></H3
><P
>A set of standards and RFCs have been developed that amend the RFC-822
standard to support various types of messages, such as plain text,
binary data, PostScript files, etc. These standards are commonly
referred to as MIME, or Multipurpose Internet Mail Extensions. Among
other things, MIME also lets the recipient know if a character set
other than standard ASCII has been used when writing the message, for
example, using French accents or German
umlauts. <B
CLASS="COMMAND"
>elm</B
> supports these characters to some
extent.</P
><P
>The character set used by Linux internally to represent characters is
usually referred to as ISO-8859-1, which is the name of the standard it
conforms to. It is also known as Latin-1.  Any message using characters
from this character set should have the following line in its header:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Content-Type: text/plain; charset=iso-8859-1</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The receiving system should recognize this field and take appropriate
measures when displaying the message. The default for
<SPAN
CLASS="SYSTEMITEM"
>text/plain</SPAN
> messages is a
<SPAN
CLASS="SYSTEMITEM"
>charset</SPAN
> value of
<SPAN
CLASS="SYSTEMITEM"
>us-ascii</SPAN
>.</P
><P
>To be able to display messages with character sets other than ASCII,
<B
CLASS="COMMAND"
>elm</B
> must know how to print these characters. By default,
when <B
CLASS="COMMAND"
>elm</B
> receives a message with a
<TT
CLASS="REPLACEABLE"
><I
>charset</I
></TT
> field other than
<SPAN
CLASS="SYSTEMITEM"
>us-ascii</SPAN
> (or a content type other than
<SPAN
CLASS="SYSTEMITEM"
>text/plain</SPAN
>, for that matter), it
tries to display the message using a command called
<B
CLASS="COMMAND"
>metamail</B
>. Messages that require <B
CLASS="COMMAND"
>metamail</B
>
to be displayed are shown with an <B
CLASS="COMMAND"
>M</B
> in the very first
column in the overview screen.</P
><P
>Since Linux's native character set is ISO-8859-1, calling
<B
CLASS="COMMAND"
>metamail</B
> is not necessary to display messages using
this character set. If <B
CLASS="COMMAND"
>elm</B
> is told that the display
understands ISO-8859-1, it will not use <B
CLASS="COMMAND"
>metamail</B
>,
but will display the message directly instead. This can be enabled by
setting the following option in the global
<TT
CLASS="FILENAME"
>elm.rc</TT
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>displaycharset = iso-8859-1</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Note that you should set this option even when you are never going to
send or receive any messages that actually contain characters other than
ASCII. This is because people who do send such messages usually
configure their mailer to put the proper <TT
CLASS="LITERAL"
>Content-Type:</TT
>
field into the mail header by default, whether or not they are sending
ASCII-only messages.</P
><P
>However, setting this option in <TT
CLASS="FILENAME"
>elm.rc</TT
> is not
enough. When displaying the message with its built-in pager,
<B
CLASS="COMMAND"
>elm</B
> calls a library function for each character to
determine whether it is printable. By default, this function will only
recognize ASCII characters as printable and display all other
characters as <TT
CLASS="LITERAL"
>^?</TT
>. You may overcome this function by setting
the environment variable <SPAN
CLASS="SYSTEMITEM"
>LC_CTYPE</SPAN
> to <SPAN
CLASS="SYSTEMITEM"
>ISO-8859-1</SPAN
>, which tells the library to
accept Latin-1 characters as printable. Support for this and other
features have been available since Version 4.5.8 of the Linux standard library.</P
><P
>When sending messages that contain special characters from ISO-8859-1,
you should make sure to set two more variables in the
<TT
CLASS="FILENAME"
>elm.rc</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>charset = iso-8859-1
textencoding = 8bit</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This makes <B
CLASS="COMMAND"
>elm</B
> report the character set as ISO-8859-1
in the mail header and send it as an 8-bit value (the default is to strip all
characters to 7-bit).</P
><P
>Of course, all character set options we've discussed here may also be
set in the private <TT
CLASS="FILENAME"
>elmrc</TT
> file instead of the global one
so individual users can have their own default settings if the global one
doesn't suit them.</P
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-SENDMAIL"
></A
>Chapter 18. Sendmail</H1
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN14660"
>18.1. Introduction to sendmail</A
></H2
><P
>It's been said that you aren't a <EM
>real</EM
> Unix system
administrator until you've edited a <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file.
It's also been said that you're crazy if you've attempted to do so twice.</P
><P
><B
CLASS="COMMAND"
>sendmail</B
> is an incredibly powerful mail
program. It's also incredibly difficult to learn and understand. Any
program whose definitive reference (<B
CLASS="COMMAND"
>sendmail</B
>, by
Bryan Costales and Eric Allman, published by O'Reilly) is 1,050 pages long scares most people
off. Information on the <B
CLASS="COMMAND"
>sendmail</B
> reference is
contained in the bibliography at the end of this book.</P
><P
>&#13;Fortunately, new versions of sendmail are different. You no longer need to 
directly edit the cryptic <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file; the 
new version provides a configuration utility that will create the
<TT
CLASS="FILENAME"
>sendmail.cf</TT
> file for you based on much simpler macro
files. You do not need to understand the
complex syntax of the <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file; the macro files 
don't require you to. Instead, you need only list items, such as the name of 
features you wish to include in your configuration, and specify some of the 
parameters that determine how that feature operates. A traditional 
Unix utility called <B
CLASS="COMMAND"
>m4</B
> then takes your
macro configuration data and mixes it with the data it reads from template
files containing the actual <TT
CLASS="FILENAME"
>sendmail.cf</TT
> syntax, to
produce your <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file.</P
><P
>In this chapter we introduce <B
CLASS="COMMAND"
>sendmail</B
> and describe
how to install, configure and test it, using the Virtual Brewery as an
example. If the information presented here helps make the task of
configuring <B
CLASS="COMMAND"
>sendmail</B
> less daunting for you, we hope
you'll gain the confidence to tackle more complex configurations on
your own.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN14681"
>18.2. Installing sendmail</A
></H2
><P
>&#13;
The <B
CLASS="COMMAND"
>sendmail</B
> mail transport agent is included in
prepackaged form in most Linux distributions. Installation in this case is
relatively simple. Despite this fact, there are some good reasons to install
<B
CLASS="COMMAND"
>sendmail</B
> from source, especially if you are security
conscious. The <B
CLASS="COMMAND"
>sendmail</B
> program is very complex and has
earned a reputation over the years for containing bugs that allow security
breaches. One of the best known examples is the RTM Internet worm that
exploited a buffer overflow problem in early versions of
<B
CLASS="COMMAND"
>sendmail</B
>. We touched on this briefly in 
<A
HREF="#X-087-2-FIREWALL"
>Chapter 9</A
>. Most security exploits involving buffer 
overflows rely on all copies of <B
CLASS="COMMAND"
>sendmail</B
> on different 
machines being identical, as the exploits rely on data being stored in 
specific locations. This, of course, is precisely what happens with 
<B
CLASS="COMMAND"
>sendmail</B
> installed from Linux distributions. Compiling 
<B
CLASS="COMMAND"
>sendmail</B
> from source yourself can help reduce this risk. 
Modern versions of <B
CLASS="COMMAND"
>sendmail</B
> are less vulnerable because 
they have come under exceedingly close scrutiny as security has become a more 
widespread concern throughout the Internet community.</P
><P
>&#13;The <B
CLASS="COMMAND"
>sendmail</B
> source code is available via anonymous FTP from
<SPAN
CLASS="SYSTEMITEM"
>ftp.sendmail.org</SPAN
>.</P
><P
>Compilation is very simple bceause the <B
CLASS="COMMAND"
>sendmail</B
> source
package directly supports Linux. The steps involved in compiling
<B
CLASS="COMMAND"
>sendmail</B
> are:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
># cd /usr/local/src
# tar xvfz sendmail.8.9.3.tar.gz
# cd src
# ./Build</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

You need <TT
CLASS="LITERAL"
>root</TT
> permissions to complete the installation
of the resulting binary files using:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
># cd obj.Linux.2.0.36.i586
# make install</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

You have now installed the <B
CLASS="COMMAND"
>sendmail</B
> binary into the 
<TT
CLASS="FILENAME"
>/usr/sbin</TT
> directory. Several symbolic links to
the <B
CLASS="COMMAND"
>sendmail</B
> binary will be installed into the
<TT
CLASS="FILENAME"
>/usr/bin/</TT
> directory. We'll talk about those links when 
we discuss common tasks in running <B
CLASS="COMMAND"
>sendmail</B
>.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN14718"
>18.3. Overview of Configuration Files</A
></H2
><P
>&#13;
Traditionally, <B
CLASS="COMMAND"
>sendmail</B
> was set up through a system
configuration file (typically called
<TT
CLASS="FILENAME"
>/etc/mail/sendmail.cf</TT
>, or in older distributions,
<TT
CLASS="FILENAME"
>/etc/sendmail.cf</TT
>, or even
<TT
CLASS="FILENAME"
>/usr/lib/sendmail.cf</TT
>&#8201;) that is not
anything close to any language you've seen before. Editing the
<TT
CLASS="FILENAME"
>sendmail.cf</TT
> file to provide customized behavior
can be a humbling experience.</P
><P
>Today <B
CLASS="COMMAND"
>sendmail</B
> makes all configuration
options macro driven with an easy-to-understand syntax. The macro method 
generates configurations to cover most installations, but you always have
the option of tuning the resultant <TT
CLASS="FILENAME"
>sendmail.cf</TT
> manually
to work in a more complex environment.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN14735"
>18.4. The sendmail.cf and sendmail.mc Files</A
></H2
><P
>&#13;


The <B
CLASS="COMMAND"
>m4</B
> macro processor program generates the 
<TT
CLASS="FILENAME"
>sendmail.df</TT
> file when it processes the macro 
configuration file provided by the local system administrator. Throughout the 
remainder of this chapter we will refer to this configuration file as the 
<TT
CLASS="FILENAME"
>sendmail.mc</TT
> file.</P
><P
>The configuration process is basically a matter of creating a suitable
<TT
CLASS="FILENAME"
>sendmail.mc</TT
> file that includes macros that describe
your desired configuration. The macros are expressions that the
<B
CLASS="COMMAND"
>m4</B
> macro processor understands and expands into
the complex <TT
CLASS="FILENAME"
>sendmail.cf</TT
> syntax. The macro expressions
are made up of the macro name (the text in capital letters at the start),
which can be likened to a function in a programming language, and some
parameters (the text within brackets) that are used in the expansion. The
parameters may be passed literally into the <TT
CLASS="FILENAME"
>sendmail.cf</TT
>
output or may be used to govern the way the macro processing occurs.</P
><P
>A <TT
CLASS="FILENAME"
>sendmail.mc</TT
> file for a minimal configuration (UUCP or
SMTP with all nonlocal mail being relayed to a directly connected
smart host) can be as short as 10 or 15 lines, excluding comments.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN14756"
>18.4.1. Two Example sendmail.mc Files</A
></H3
><P
>&#13;If you're an administator of a number of different mail hosts, you might not
want to name your configuration file <TT
CLASS="FILENAME"
>sendmail.mc</TT
>.
Instead, it is common practice to name it after the
host&#8212;<TT
CLASS="FILENAME"
>vstout.m4</TT
> in our case. The name doesn't
really matter as long as the output is called
<TT
CLASS="FILENAME"
>sendmail.cf</TT
>. Providing a unique name for the
configuration file for each host allows you to keep all configuration files
in the same directory and is just an administrative convenience. Let's look
at two example macro configuration files so we know where we are
heading.</P
><P
>&#13;Most <B
CLASS="COMMAND"
>sendmail</B
> configurations today use SMTP only. It is
very simple to configure <B
CLASS="COMMAND"
>sendmail</B
> for SMTP. 
<A
HREF="#X-087-2-SENDMAIL.MC.SMTP"
>Example 18-1</A
> expects a DNS name server to be 
available to resolve hosts and will attempt to accept and deliver all mail 
for hosts using just SMTP.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-SENDMAIL.MC.SMTP"
></A
><P
><B
>Example 18-1. Sample Configuration File vstout.smtp.m4</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>divert(-1)
#
# Sample configuration file for vstout - smtp only
#
divert(0)
VERSIONID(`@(#)sendmail.mc	8.7 (Linux) 3/5/96')
OSTYPE(`linux')
#
# Include support for the local and smtp mail transport protocols.
MAILER(`local')
MAILER(`smtp')
#
FEATURE(rbl)
FEATURE(access_db)
# end</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>A <TT
CLASS="FILENAME"
>sendmail.mc</TT
> file for
<SPAN
CLASS="SYSTEMITEM"
>vstout</SPAN
> at the Virtual Brewery is shown
in <A
HREF="#X-087-2-SENDMAIL.MC.UUCPSMTP"
>Example 18-2</A
>.
<SPAN
CLASS="SYSTEMITEM"
>vstout</SPAN
> uses SMTP to talk to all hosts
on the Brewery's LAN, and you'll see the commonality with the generic SMTP-only 
configuration just presented. In addition, the 
<SPAN
CLASS="SYSTEMITEM"
>vstout</SPAN
> configuration sends all mail 
for other destinations to <SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
>, 
its Internet relay host, via UUCP.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-SENDMAIL.MC.UUCPSMTP"
></A
><P
><B
>Example 18-2. Sample Configuration File vstout.uucpsmtp.m4</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>divert(-1)
#
# Sample configuration file for vstout
#
divert(0)
VERSIONID(`@(#)sendmail.mc	8.7 (Linux) 3/5/96')
OSTYPE(`linux')
dnl
# moria is our smart host, using the "uucp-new" transport.
define(`SMART_HOST', `uucp-new:moria')
dnl
# Support the local, smtp and uucp mail transport protocols.
MAILER(`local')
MAILER(`smtp')
MAILER(`uucp')
LOCAL_NET_CONFIG
# This rule ensures that all local mail is delivered using the
# smtp transport, everything else will go via the smart host.
R$* &#60; @ $* .$m. &#62; $*	$#smtp $@ $2.$m. $: $1 &#60; @ $2.$m. &#62; $3
dnl
#
FEATURE(rbl)
FEATURE(access_db)
# end</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>If you compare and contrast the two configurations, you might be able to
work out what each of the configuration parameters does. We'll explain them
all in detail.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN14787"
>18.4.2. Typically Used sendmail.mc Parameters</A
></H3
><P
>&#13;
A few of the items in the <TT
CLASS="FILENAME"
>sendmail.mc</TT
> file are required
all the time; others can be ignored if you can get away with defaults.
The general sequence of the definitions in the <TT
CLASS="FILENAME"
>sendmail.mc</TT
>
is as follows:

<P
></P
><OL
TYPE="1"
><LI
><P
><SPAN
CLASS="SYSTEMITEM"
>VERSIONID</SPAN
></P
></LI
><LI
><P
><SPAN
CLASS="SYSTEMITEM"
>OSTYPE</SPAN
></P
></LI
><LI
><P
><SPAN
CLASS="SYSTEMITEM"
>DOMAIN</SPAN
></P
></LI
><LI
><P
><SPAN
CLASS="SYSTEMITEM"
>FEATURE</SPAN
></P
></LI
><LI
><P
>Local macro definitions</P
></LI
><LI
><P
><SPAN
CLASS="SYSTEMITEM"
>MAILER</SPAN
></P
></LI
><LI
><P
><SPAN
CLASS="SYSTEMITEM"
>LOCAL_*</SPAN
> rulesets</P
></LI
></OL
>

We'll talk about each of these in turn in the following sections and refer
to our examples in <A
HREF="#X-087-2-SENDMAIL.MC.SMTP"
>Example 18-1</A
> and
<A
HREF="#X-087-2-SENDMAIL.MC.UUCPSMTP"
>Example 18-2</A
>, when appropriate, to explain them.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN14820"
>18.4.2.1. Comments</A
></H4
><P
>Lines in the <TT
CLASS="FILENAME"
>sendmail.mc</TT
> file that begin with the
<TT
CLASS="LITERAL"
>#</TT
> character are not parsed by <B
CLASS="COMMAND"
>m4</B
>, and
will by default be output directly into the
<TT
CLASS="FILENAME"
>sendmail.cf</TT
> file. This is useful if you want to comment 
on what your configuration is doing in both the input and output files.</P
><P
>To allow comments in your <TT
CLASS="FILENAME"
>sendmail.mc</TT
> that are 
<EM
>not</EM
> placed into the
<TT
CLASS="FILENAME"
>sendmail.cf</TT
>, you can use the <B
CLASS="COMMAND"
>m4</B
>
<SPAN
CLASS="SYSTEMITEM"
>divert</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>dnl</SPAN
> tokens.
<SPAN
CLASS="SYSTEMITEM"
>divert(-1)</SPAN
> will cause all output to
cease. <SPAN
CLASS="SYSTEMITEM"
>divert(0)</SPAN
> will cause output to
be restored to the default. Any output generated by lines between
these will be discarded. In our example, we've used this mechanism to
provide a comment that appears only in the <TT
CLASS="FILENAME"
>sendmail.mc</TT
>
file. To achieve the same result for a single line, you can use the
<SPAN
CLASS="SYSTEMITEM"
>dnl</SPAN
> token that means, literally,
&#8220;starting at the beginning of the next line, delete all characters up
to and including the next newline.&#8221; We've used this in
our example, too.</P
><P
>These are standard <B
CLASS="COMMAND"
>m4</B
> features, and you can obtain more
information on them from its manual page.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN14840"
>18.4.2.2. VERSIONID and OSTYPE</A
></H4
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>VERSIONID(`@(#)sendmail.mc  8.9 (Linux) 01/10/98')</PRE
></FONT
></TD
></TR
></TABLE
>
The <TT
CLASS="LITERAL"
>VERSIONID</TT
> macro is optional, but is useful to record
the version of the sendmail configuration in the
<TT
CLASS="FILENAME"
>sendmail.cf</TT
> file. So you'll often encounter it, and we 
recommend it. In any case, be sure to include:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>OSTYPE(`linux')</PRE
></FONT
></TD
></TR
></TABLE
>


This is probably the most important definition. The
<TT
CLASS="LITERAL"
>OSTYPE</TT
> macro causes a file of definitions to be
included that are good defaults for your operating system. Most of the
definitions in an <TT
CLASS="LITERAL"
>OSTYPE</TT
> macro file set the
pathnames of various configuration files, mailer program paths and
arguments, and the location of directories sendmail uses to store
messages. The standard sendmail source code release includes such
a file for Linux, which would be included by the previous
example. Some Linux distributions, notably the Debian distribution,
include their own definition file that is completely Linux-FHS
compliant. When your distribution does this, you should probably use
its definition instead of the Linux default one.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>OSTYPE</SPAN
> definition should
be one of the first definitions to appear in your
<TT
CLASS="FILENAME"
>sendmail.mc</TT
> file, as many other definitions
depend upon it.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN14857"
>18.4.2.3. DOMAIN</A
></H4
><P
>&#13;The <SPAN
CLASS="SYSTEMITEM"
>DOMAIN</SPAN
> macro is useful
when you wish to configure a large number of machines on the same
network in a standard way. It you're configuring a small number of
hosts, it probably isn't worth bothering with. You typically configure
items, such as the name of mail relay hosts or hubs that all hosts on
your network will use.</P
><P
>The standard installation contains a directory of <B
CLASS="COMMAND"
>m4</B
> macro 
templates used to drive the configuration process. This directory is usually 
named <TT
CLASS="FILENAME"
>/usr/share/sendmail.cf</TT
> or something similar. Here 
you will find a subdirectory called <TT
CLASS="FILENAME"
>domain</TT
> that 
contains domain-specific configuration templates. To make use of the 
<SPAN
CLASS="SYSTEMITEM"
>DOMAIN</SPAN
> macro, you must create your 
own macro file containing the standard definitions you require for your site, 
and write it into the <TT
CLASS="FILENAME"
>domain</TT
> subdirectory. You'd 
normally include only the macro definitions that were unique to your domain 
here, such as smart host definitions or relay hosts, but you are not limited 
to these.</P
><P
>The <B
CLASS="COMMAND"
>sendmail</B
> source distribution comes with a number of
sample domain macro files that you can use to model your own.</P
><P
>If you saved your domain macro file as
<TT
CLASS="FILENAME"
>/usr/share/sendmail.cf/domain/vbrew.m4</TT
>, you'd
include definitions in your <TT
CLASS="FILENAME"
>sendmail.mc</TT
> using:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>DOMAIN(`vbrew')</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN14875"
>18.4.2.4. FEATURE</A
></H4
><P
>&#13;The <SPAN
CLASS="SYSTEMITEM"
>FEATURE</SPAN
> macro enables you to
include predefined <B
CLASS="COMMAND"
>sendmail</B
> features in your configuration.
These <B
CLASS="COMMAND"
>sendmail</B
> features make the supported configurations
very simple to use. There are a large number, and throughout this
chapter we'll talk about only a few of the more useful and important ones.
You can find full details of the features available in the
<TT
CLASS="FILENAME"
>CF</TT
> file included in the source package.</P
><P
>To use any of the features listed, you should include a line in your
<TT
CLASS="FILENAME"
>sendmail.mc</TT
> that looks like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>FEATURE(<TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
>)</PRE
></FONT
></TD
></TR
></TABLE
>

where <TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
> is substituted with the feature name. 
Some features take one optional parameter. If you wish to use
something other than the default, you should use an entry that looks like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>FEATURE(<TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
>, <TT
CLASS="REPLACEABLE"
><I
>param</I
></TT
>)</PRE
></FONT
></TD
></TR
></TABLE
>

where <TT
CLASS="REPLACEABLE"
><I
>param</I
></TT
> is the parameter to supply.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN14893"
>18.4.2.5. Local macro definitions</A
></H4
><P
>&#13;The standard <B
CLASS="COMMAND"
>sendmail</B
> macro configuration files provide
lots of hooks and variables with which you can customize your configuration.
These are called <B
CLASS="COMMAND"
>local macro definitions</B
>. Many of them 
are listed in the <TT
CLASS="FILENAME"
>CF</TT
> file in the 
<B
CLASS="COMMAND"
>sendmail</B
> source package.</P
><P
>The local macro definitions are usually invoked by supplying the name of the
macro with an argument representing the value you wish to assign to the
variable the macro manages. Again, we'll explore some of the more common
local macro definitions in the examples we present later in the chapter.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN14903"
>18.4.2.6. Defining mail transport protocols</A
></H4
><P
>&#13;If you want <B
CLASS="COMMAND"
>sendmail</B
> to transport mail in any way other
than by local delivery, you must tell it which transports to use. The
<TT
CLASS="LITERAL"
>MAILER</TT
> macro makes this very easy. The current version of
<B
CLASS="COMMAND"
>sendmail</B
> supports a variety of mail transport protocols;
some of these are experimental, others are probably rarely used.</P
><P
>In our network we need the SMTP transport to send and receive mail
among the hosts on our local area network, and the UUCP transport to send
and receive mail from our smart host. To achieve this, we simply include both
the <TT
CLASS="LITERAL"
>smtp</TT
> and <TT
CLASS="LITERAL"
>uucp</TT
> mail transports. The
<TT
CLASS="LITERAL"
>local</TT
> mail transport is included by default, but may be
defined for clarity, if you wish. If you are including both the
<TT
CLASS="LITERAL"
>smtp</TT
> and the <TT
CLASS="LITERAL"
>uucp</TT
> mailers in your
configuration, you must always be sure to define the <TT
CLASS="LITERAL"
>smtp</TT
>
mailer first.</P
><P
>The more commonly used transports available to you using the
<SPAN
CLASS="SYSTEMITEM"
>MAILER</SPAN
> macro are described in the
following list:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>local</SPAN
></DT
><DD
><P
>	This transport includes both the local delivery agent used to send
	mail into the mailbox of users on this machine and the
	<SPAN
CLASS="SYSTEMITEM"
>prog</SPAN
> mailer used to send messages
	to local programs. This transport is included by default.
	</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>smtp</SPAN
></DT
><DD
><P
>	This transport implements the Simple Mail Transport Protocol (SMTP),
	which is the most common means of transporting mail on the Internet.
	When you include this transport, four mailers are configured: 
        <TT
CLASS="LITERAL"
>smtp</TT
> (basic SMTP), <TT
CLASS="LITERAL"
>esmtp</TT
> (Extended SMTP), <TT
CLASS="LITERAL"
>smtp8</TT
> (8bit binary clean SMTP), 
        and <TT
CLASS="LITERAL"
>relay</TT
> (specifically designed for gatewaying 
        messages between hosts).
	</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
></DT
><DD
><P
>	The <SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
> transport provides
	support for two mailers: 
        <SPAN
CLASS="SYSTEMITEM"
>uucp-old</SPAN
>, which is the 
        traditional UUCP, and
	<SPAN
CLASS="SYSTEMITEM"
>uucp-new</SPAN
>, which allows multiple
	recipients to be handled in one transfer.
	</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>usenet</SPAN
></DT
><DD
><P
>	This mailer allows you to send mail messages directly into
	Usenet style news networks. Any local message directed to an address
	of <EM
>news.group.usenet</EM
> will be fed into the 
        news network for the <EM
>news.group</EM
> newsgroup.
	</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>fax</SPAN
></DT
><DD
><P
>	If you have the HylaFAX software installed, this mailer will
	allow you to direct email to it so that you may build an email-fax
	gateway. This feature is experimental at the time of writing and more
	information may be obtained from
	<SPAN
CLASS="SYSTEMITEM"
>http://www.vix.com/hylafax/</SPAN
>.
	</P
></DD
></DL
></DIV
></P
><P
>There are others, such as the <SPAN
CLASS="SYSTEMITEM"
>pop</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>procmail</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>mail11</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>phquery</SPAN
>, and
<SPAN
CLASS="SYSTEMITEM"
>cyrus</SPAN
> that are useful, but less
common. If your curiosity is piqued, you can read about these
in the sendmail book or the documentation supplied in the source package.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN14963"
>18.4.2.7. Configure mail routing for local hosts</A
></H4
><P
>&#13;The Virtual Brewery's configuration is probably more complex than most sites 
require. Most sites today would use the SMTP transport only and do not
have to deal with UUCP at all. In our configuration we've configured a
&#8220;smart host&#8221; that is used to handle all outgoing mail.
Since we are using the SMTP transport on our local network we must tell
<B
CLASS="COMMAND"
>sendmail</B
> that it is not to send local mail via the
smart host. The <TT
CLASS="LITERAL"
>LOCAL_NET_CONFIG</TT
> macro allows you to
insert sendmail rules directly into the output <TT
CLASS="FILENAME"
>sendmail.cf</TT
>
to modify the way that local mail is handled. We'll talk more about rewrite
rules later on, but for the moment you should accept that the rule we've
supplied in our example specifies that any mail destined for hosts in the
<SPAN
CLASS="SYSTEMITEM"
>vbrew.com</SPAN
> domain should be delivered
directly to the target hosts using the SMTP mail transport.</P
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN14977"
>18.5. Generating the sendmail.cf File</A
></H2
><P
>&#13;When you have completed editing your <B
CLASS="COMMAND"
>m4</B
> configuration file, you must process it
to produce the <TT
CLASS="FILENAME"
>/etc/mail/sendmail.cf</TT
> file read by
<B
CLASS="COMMAND"
>sendmail</B
>. This is straightforward, as illustrated by the 
following example:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>cd /etc/mail</KBD
>
# <KBD
CLASS="USERINPUT"
>m4 /usr/share/sendmail.cf/m4/cf.m4 vstout.uucpsmtp.mc &#62;sendmail.cf</KBD
></PRE
></FONT
></TD
></TR
></TABLE
><P
>This command invokes the <B
CLASS="COMMAND"
>m4</B
> macro processor,
supplying it the name of two macro definition files to
process. <B
CLASS="COMMAND"
>m4</B
> processes the files in the order
given. The first file is a standard <B
CLASS="COMMAND"
>sendmail</B
> macro
template supplied with the <B
CLASS="COMMAND"
>sendmail</B
> source package,
the second, of course, is the file containing our own macro
definitions. The output of the command is directed to the
<TT
CLASS="FILENAME"
>/etc/mail/sendmail.cf</TT
> file, which is our target
file.</P
><P
>You may now start <B
CLASS="COMMAND"
>sendmail</B
> with the new configuration.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN14997"
>18.6. Interpreting and Writing Rewrite Rules</A
></H2
><P
>&#13;
Arguably the most powerful feature of <B
CLASS="COMMAND"
>sendmail</B
> is the
rewrite rule. Rewrite rules are used by <B
CLASS="COMMAND"
>sendmail</B
> to
determine how to process a received mail message. <B
CLASS="COMMAND"
>sendmail</B
>
passes the addresses from the <EM
>headers</EM
> of a mail message
through collections of rewrite rules called <EM
>rulesets</EM
> The
rewrite rules transform a mail address from one form to another and you can
think of them as being similar to a command in your editor that replaces all
text matching a specified pattern with another.</P
><P
>Each rule has a lefthand side and a righthand side, separated by at least
one tab character. When <B
CLASS="COMMAND"
>sendmail</B
> is processing mail it
scans through the rewriting rules looking for a match on the lefthand side.
If an address matches the lefthand side of a rewrite rule, the address is
replaced by the righthand side and processed again.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN15012"
>18.6.1. sendmail.cf R and S Commands</A
></H3
><P
>&#13;In the <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file, the rulesets are defined using
commands coded as
<TT
CLASS="LITERAL"
>S</TT
><TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
>, where
<TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
> specifies the ruleset that is
considered the current one.</P
><P
>The rules themselves appear in commands coded as
<B
CLASS="COMMAND"
>R</B
>. As each <B
CLASS="COMMAND"
>R</B
> command is read, it is 
added to the current ruleset.</P
><P
>If you're dealing only with the <TT
CLASS="FILENAME"
>sendmail.mc</TT
> file,
you won't need to worry about <B
CLASS="COMMAND"
>S</B
> commands at
all, as the macros will build those for you. You will need to manually code
your <B
CLASS="COMMAND"
>R</B
> rules.</P
><P
>A <B
CLASS="COMMAND"
>sendmail</B
> ruleset therefore looks like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="LITERAL"
>S</TT
><TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
>
<TT
CLASS="LITERAL"
>R</TT
><TT
CLASS="REPLACEABLE"
><I
>lhs</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>rhs</I
></TT
>
<TT
CLASS="LITERAL"
>R</TT
><TT
CLASS="REPLACEABLE"
><I
>lhs2</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>rhs2</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN15040"
>18.6.2. Some Useful Macro Definitions</A
></H3
><P
><B
CLASS="COMMAND"
>sendmail</B
> uses a number of standard macro definitions
internally. The most useful of these in writing rulesets are:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>$j</DT
><DD
><P
>The fully qualified domain name of this host.</P
></DD
><DT
>$w</DT
><DD
><P
>The hostname component of the FQDN.</P
></DD
><DT
>$m</DT
><DD
><P
>The domain name component of the FQDN.</P
></DD
></DL
></DIV
><P
>We can incorporate these macro definitions in our rewrite rules. Our
Virtual Brewery configuration uses the <TT
CLASS="LITERAL"
>$m</TT
> macro.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN15059"
>18.6.3. The Lefthand Side</A
></H3
><P
>            
In the lefthand side of a rewriting rule, you specify a pattern that will
match an address you wish to transform. Most characters are matched literally,
but there are a number of characters that have special meaning; these are
described in the following list. The rewrite rules 
for the lefthand side are:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>$@</TT
></DT
><DD
><P
>Match exactly zero tokens</P
></DD
><DT
><TT
CLASS="LITERAL"
>$*</TT
></DT
><DD
><P
>Match zero or more tokens</P
></DD
><DT
><TT
CLASS="LITERAL"
>$+</TT
></DT
><DD
><P
>Match one or more tokens</P
></DD
><DT
><TT
CLASS="LITERAL"
>$-</TT
></DT
><DD
><P
>Match exactly one token</P
></DD
><DT
><TT
CLASS="LITERAL"
>$=</TT
><TT
CLASS="REPLACEABLE"
><I
>x</I
></TT
></DT
><DD
><P
>Match any phrase in class <TT
CLASS="REPLACEABLE"
><I
>x</I
></TT
></P
></DD
><DT
><TT
CLASS="LITERAL"
>$~</TT
><TT
CLASS="REPLACEABLE"
><I
>x</I
></TT
></DT
><DD
><P
>Match any word not in class <TT
CLASS="REPLACEABLE"
><I
>x</I
></TT
></P
></DD
></DL
></DIV
><P
>A token is a string of characters delimited by spaces. There is no way
to include spaces in a token, nor is it necessary, as the expression
patterns are flexible enough to work around this need. When a rule
matches an address, the text matched by each of the patterns in the
expression will be assigned to special variables that we'll use in the
righthand side. The only exception to this is the
<TT
CLASS="LITERAL"
>$@</TT
>, which matches no tokens and therefore will
never generate text to be used on the righthand side.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN15099"
>18.6.4. The Righthand Side</A
></H3
><P
>When the lefthand side of a rewrite rule matches an address, the
original text is deleted and replaced by the righthand side of the
rule. All tokens in the righthand side are copied literally, unless
they begin with a dollar sign.  Just as for the lefthand side, a
number of metasymbols may be used on the righthand side. These are
described in the following list. The rewrite rules for the righthand
side are:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>$</TT
><TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
></DT
><DD
><P
>This metasymbol is replaced with the <TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
>'th
expression from the lefthand side.</P
></DD
><DT
><TT
CLASS="LITERAL"
>$[</TT
><TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
><TT
CLASS="LITERAL"
>$]</TT
></DT
><DD
><P
>This metasymbol resolves hostname to canonical name. It is replaced
by the canonical form of the host name supplied.</P
></DD
><DT
><TT
CLASS="LITERAL"
>$(</TT
><TT
CLASS="REPLACEABLE"
><I
>map key</I
></TT
><TT
CLASS="LITERAL"
> $@</TT
><TT
CLASS="REPLACEABLE"
><I
>arguments</I
></TT
><TT
CLASS="LITERAL"
> $:</TT
><TT
CLASS="REPLACEABLE"
><I
>default</I
></TT
><TT
CLASS="LITERAL"
> $)</TT
></DT
><DD
><P
>This is the more general form of lookup. The output is the result of
looking up <TT
CLASS="REPLACEABLE"
><I
>key</I
></TT
> in the map named
<EM
>map</EM
> passing
<TT
CLASS="REPLACEABLE"
><I
>arguments</I
></TT
> as arguments. The
<EM
>map</EM
> can be any of the maps that
<B
CLASS="COMMAND"
>sendmail</B
> supports such as the
<TT
CLASS="LITERAL"
>virtusertable</TT
> that we describe a little later. If
the lookup is unsuccessful, <TT
CLASS="REPLACEABLE"
><I
>default</I
></TT
> will be
output. If a default is not supplied and lookup fails, the input is
unchanged and <TT
CLASS="REPLACEABLE"
><I
>key</I
></TT
> is output.</P
></DD
><DT
><TT
CLASS="LITERAL"
>$&#62;</TT
><TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
></DT
><DD
><P
>This will cause the rest of this line to be parsed and then given to
ruleset <TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
> to evaluate. The output of the called
ruleset will be written as output to this rule. This is the mechanism
that allows rules to call other rulesets.</P
></DD
><DT
><TT
CLASS="LITERAL"
>$#</TT
><TT
CLASS="REPLACEABLE"
><I
>mailer</I
></TT
></DT
><DD
><P
>This metasymbol causes ruleset evaluation to halt and specifies the
mailer that should be used to transport this message in the next step
of its delivery. This metasymbol should be called only from ruleset
0 or one of its subroutines. This is the final stage of address parsing
and should be accompanied by the next two metasymbols.</P
></DD
><DT
><TT
CLASS="LITERAL"
>$@</TT
><TT
CLASS="REPLACEABLE"
><I
>host</I
></TT
></DT
><DD
><P
>This metasymbol specifies the host that this message will be forwarded to. If
the destination host is the local host, it may be omitted. The
<TT
CLASS="REPLACEABLE"
><I
>host</I
></TT
> may be a colon-separated list of destination
hosts that will be tried in sequence to deliver the message.</P
></DD
><DT
><TT
CLASS="LITERAL"
>$:</TT
><TT
CLASS="REPLACEABLE"
><I
>user</I
></TT
></DT
><DD
><P
>This metasymbol specifies the target user for the mail message.</P
></DD
></DL
></DIV
><P
>A rewrite rule that matches is normally tried repeatedly until it fails to
match, then parsing moves on to the next rule. This behavior can be changed
by preceding the righthand side with one of two special righthand side metaymbols described in the following list.
The rewrite rules for a righthand side loop control metasymbols are:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>$@</TT
></DT
><DD
><P
>This metasymbol causes the ruleset to return with the remainder of
the righthand side as the value. No other rules in the ruleset are
evaluated.</P
></DD
><DT
><TT
CLASS="LITERAL"
>$:</TT
></DT
><DD
><P
>This metasymbol causes this rule to terminate immediately, but the
rest of the current ruleset is evaluated.</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN15174"
>18.6.5. A Simple Rule Pattern Example</A
></H3
><P
>To better see how the macro substitution patterns operate, consider the
following rule lefthand side:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$* &#60; $+ &#62;</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This rule matches &#8220;Zero or more tokens, followed by the &#60;
character, followed by one or more tokens, followed by the &#62;
character.&#8221;</P
><P
>If this rule were applied to <TT
CLASS="LITERAL"
>brewer@vbrew.com</TT
> or
<TT
CLASS="LITERAL"
>Head Brewer &#60; &#62;</TT
>, the rule would not
match. The first string would not match because it does not include a
&#60; character, and the second would fail because
<TT
CLASS="LITERAL"
>$+</TT
> matches <EM
>one or more</EM
> tokens
and there are no tokens between the <TT
CLASS="LITERAL"
>&#60;&#62;</TT
> characters. In any case
in which a rule does not match, the righthand side of the rule is not
used.</P
><P
>If the rule were applied to <TT
CLASS="LITERAL"
>Head Brewer &#60; brewer@vbrew.com
&#62;</TT
>, the rule would match, and on the righthand side
<TT
CLASS="LITERAL"
>$1</TT
> would be substituted with <TT
CLASS="LITERAL"
>Head
Brewer</TT
> and <TT
CLASS="LITERAL"
>$2</TT
> would be substituted with
<TT
CLASS="LITERAL"
>brewer@vbrew.com</TT
>.</P
><P
>If the rule were applied to <TT
CLASS="LITERAL"
>&#60; brewer@vbrew.com
&#62;</TT
> the rule would match because <TT
CLASS="LITERAL"
>$*</TT
>
matches <EM
>zero</EM
> or more tokens, and on the righthand
side <TT
CLASS="LITERAL"
>$1</TT
> would be substituted with the empty string.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN15196"
>18.6.6. Ruleset Semantics</A
></H3
><P
>&#13;
Each of the <B
CLASS="COMMAND"
>sendmail</B
> rulesets is called upon to
perform a different task in mail processing. When you are writing
rules, it is important to understand what each of the rulesets are
expected to do.  We'll look at each of the rulesets that the
<B
CLASS="COMMAND"
>m4</B
> configuration scripts allow us to modify:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>LOCAL_RULE_3</DT
><DD
><P
>&#13;Ruleset 3 is responsible for converting an address in an arbitrary
format into a common format that <B
CLASS="COMMAND"
>sendmail</B
> will then
process.  The output format expected is the familiar looking
<TT
CLASS="REPLACEABLE"
><I
>local-part</I
></TT
><TT
CLASS="LITERAL"
>@</TT
><TT
CLASS="REPLACEABLE"
><I
>host-domain-spec</I
></TT
>.</P
><P
>Ruleset 3 should place the hostname part of the converted address inside the
<TT
CLASS="LITERAL"
>&#60;</TT
> and <TT
CLASS="LITERAL"
>&#62;</TT
> characters to make parsing by later rulesets easier. Ruleset
3 is applied before <B
CLASS="COMMAND"
>sendmail</B
> does any other processing
of an email address, so if you want <B
CLASS="COMMAND"
>sendmail</B
> to gateway mail from some system
that uses some unusual address format, you should add a rule using the
<TT
CLASS="LITERAL"
>LOCAL_RULE_3</TT
> macro to convert addresses into the common 
format.</P
></DD
><DT
>LOCAL_RULE_0 and LOCAL_NET_CONFIG</DT
><DD
><P
>&#13;
Ruleset 0 is applied to recipient addresses by <B
CLASS="COMMAND"
>sendmail</B
>
after Ruleset 3. The <TT
CLASS="LITERAL"
>LOCAL_NET_CONFIG</TT
> macro causes rules to
be inserted into the <EM
>bottom half</EM
> of Ruleset 0.</P
><P
>Ruleset 0 is expected to perform the delivery of the message to the recipient,
so it must resolve to a triple that specifies each of the mailer, host, and
user. The rules will be placed before any smart host definition you may
include, so if you add rules that resolve addresses appropriately, any address
that matches a rule will not be handled by the smart host. This is how we
handle the direct <B
CLASS="COMMAND"
>smtp</B
> for the users on our local LAN in 
our example.</P
></DD
><DT
>LOCAL_RULE_1 and LOCAL_RULE_2</DT
><DD
><P
>&#13;
Ruleset 1 is applied to all sender addresses and Ruleset 2 is applied to all
recipient addresses. They are both usually empty.</P
></DD
></DL
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN15244"
>18.6.6.1. Interpreting the rule in our example</A
></H4
><P
>Our sample in <A
HREF="#X-087-2-SENDMAIL.REWRITE.EXAMPLE"
>Example 18-3</A
> uses the
<TT
CLASS="LITERAL"
>LOCAL_NET_CONFIG</TT
> macro to declare a local rule that
ensures that any mail within our domain is delivered directly using the
<B
CLASS="COMMAND"
>smtp</B
> mailer. Now that we've looked at how rewrite rules
are constructed, we will be able to understand how this rule works. Let's take
another look at it.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-SENDMAIL.REWRITE.EXAMPLE"
></A
><P
><B
>Example 18-3. Rewrite Rule from vstout.uucpsmtp.m4</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>LOCAL_NET_CONFIG
# This rule ensures that all local mail is delivered using the
# smtp transport, everything else will go via the smart host.
R$* &#60; @ $* .$m. &#62; $*  $#smtp $@ $2.$m. $: $1 &#60; @ $2.$m. &#62; $3</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>We know that the <TT
CLASS="LITERAL"
>LOCAL_NET_CONFIG</TT
> macro will cause the
rule to be inserted somewhere near the end of ruleset 0, but before any
smart host definition. We also know that ruleset 0 is the last ruleset to
be executed and that it should resolve to a three-tuple specifying the
mailer, user, and host.</P
><P
>We can ignore the two comment lines; they don't do anything useful. The rule
itself is the line beginning with <TT
CLASS="LITERAL"
>R</TT
>. We know
that the <TT
CLASS="LITERAL"
>R</TT
> is a <B
CLASS="COMMAND"
>sendmail</B
> command and that
it adds this rule to the current ruleset, in this case ruleset
<TT
CLASS="LITERAL"
>0</TT
>. Let's look at the lefthand side and the righthand side
in turn.</P
><P
>The lefthand side looks like: 
<TT
CLASS="LITERAL"
>$* &#60; @ $* .$m. &#62; $*</TT
>.</P
><P
>Ruleset 0 expects &#60; and &#62; characters because it is fed by ruleset 3.
Ruleset 3 converts addresses into a common form and to make parsing easier,
it also places the host part of the mail address inside &#60;&#62;s.</P
><P
>This rule matches any mail address that looks like:
<TT
CLASS="LITERAL"
>'DestUser &#60; @ somehost.ourdomain. &#62; Some Text'</TT
>. That is, it matches mail for any user at any host within our domain.</P
><P
>You will remember that the text matched by metasymbols on the lefthand
side of a rewrite rule is assigned to macro definitions for use on the
righthand side. In our example, the first <TT
CLASS="LITERAL"
>$*</TT
> matches 
all text from the start of the address until the &#60; character.
All of this text is assigned to <TT
CLASS="LITERAL"
>$1</TT
> for use on
the righthand side. Similarly the second <TT
CLASS="LITERAL"
>$*</TT
> in our
rewrite rule is assigned to <TT
CLASS="LITERAL"
>$2</TT
>, and the last is 
assigned to <TT
CLASS="LITERAL"
>$3</TT
>.</P
><P
>We now have enough to understand the lefthand side. This rule matches
mail for any user at any host within our domain. It assigns the username to
$1, the hostname to <TT
CLASS="LITERAL"
>$2</TT
>, and any trailing text to 
<TT
CLASS="LITERAL"
>$3</TT
>. The righthand side is then invoked to process these.</P
><P
>Let's now look at what we're expecting to see outputed. The righthand side of
our example rewrite rule looks like:

<TT
CLASS="LITERAL"
>$#smtp $@ $2.$m. $: $1 &#60; @ $2.$m. &#62; $3</TT
>.</P
><P
>When the righthand side of our ruleset is processed, each of the metasymbols
are interpreted and relevant substitutions are made.</P
><P
>The <TT
CLASS="LITERAL"
>$#</TT
> metasymbol causes this rule to resolve
to a specific mailer, <EM
>smtp</EM
> in our case.</P
><P
>The <TT
CLASS="LITERAL"
>$@</TT
> resolves the target host. In our example,
the target host is specified as <TT
CLASS="LITERAL"
>$2.$m.</TT
>, which
is the fully qualified domain name of the host on in our domain. The FQDN is
constructed of the hostname component assigned to 
<TT
CLASS="LITERAL"
>$2</TT
> from our lefthand side with our domain
name (<TT
CLASS="LITERAL"
>.$m.</TT
>) appended.</P
><P
>The <TT
CLASS="LITERAL"
>$:</TT
> metasymbol specifies the target user,
which we again captured from the lefthand side and had stored in 
<TT
CLASS="LITERAL"
>$1</TT
>.</P
><P
>We preserve the contents of the &#60;&#62; section, and any
trailing text, using the data we collected from the lefthand side of the
rule.</P
><P
>Since this rule resolves to a mailer, the message is forwarded to the mailer
for delivery. In our example, the message would be forwarded to the destination
host using the SMTP protocol.</P
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN15294"
>18.7. Configuring sendmail Options</A
></H2
><P
>&#13;<B
CLASS="COMMAND"
>sendmail</B
> has a number of options that allow you to
customize the way it performs certain tasks. There are a large number of
these, so we've listed only a few of the more commonly used ones in
the upcoming list.</P
><P
>&#13;
To configure any of these options, you may either define them in the
<B
CLASS="COMMAND"
>m4</B
> configuration file, which is the preferable method,
or you may insert them directly into the <TT
CLASS="FILENAME"
>sendmail.cf</TT
>
file. For example, if we wished to have <B
CLASS="COMMAND"
>sendmail</B
> fork
a new job for each mail message to be delivered, we might add the following
line to our <B
CLASS="COMMAND"
>m4</B
> configuration file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>define(&#8216;confSEPARATE_PROC&#8217;,&#8216;true&#8217;)</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The corresponding <TT
CLASS="FILENAME"
>sendmail.cf</TT
> entry created is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>O ForkEachJob=true</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;The following list describes common <EM
>sendmail m4</EM
> options (and
<TT
CLASS="FILENAME"
>sendmail.cf</TT
> equivalents):</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>confMIN_FREE_BLOCKS</TT
>
<TT
CLASS="LITERAL"
>(MinFreeBlocks)</TT
></DT
><DD
><P
> There are
occasions when a problem might prevent the immediate delivery of mail
messages, causing messages to be queued in the mail spool. If your
mail host processes large volumes of mail, it is possible for the mail
spool to grow to such a size that it fills the filesystem supporting
the spool.  To prevent this, <B
CLASS="COMMAND"
>sendmail</B
> provides this
option to specify the minimum number of free disk blocks that must
exist before a mail message will be accepted. This allows you to
ensure that <B
CLASS="COMMAND"
>sendmail</B
> never causes your spool
filesystem to be filled (Default: 100).  </P
></DD
><DT
><TT
CLASS="LITERAL"
>confME_TOO</TT
> <TT
CLASS="LITERAL"
>(MeToo)</TT
></DT
><DD
><P
>When a mail target such as an email alias is expanded, it is sometimes 
possible for the sender to appear in the
recipient list. This option determines whether the originators of an
email message will receive a copy if they appear in the expanded
recipient list. Valid values are &#8220;true&#8221; and
&#8220;false&#8221; (Default: false).</P
></DD
><DT
><TT
CLASS="LITERAL"
>confMAX_DAEMON_CHILDREN</TT
> <TT
CLASS="LITERAL"
>(MaxDaemonChildren)</TT
></DT
><DD
><P
>Whenever <B
CLASS="COMMAND"
>sendmail</B
> receives an SMTP connection
from a remote host, it spawns a new copy of itself to deal with the
incoming mail message. This way, it is possible for
<B
CLASS="COMMAND"
>sendmail</B
> to be processing multiple incoming mail messages
simulatanenously. While this is useful, each new copy of
<B
CLASS="COMMAND"
>sendmail</B
> consumes memory in the host computer. If
an unusually large number of incoming connections are received,
by chance, because of a problem or a malicious attack, it
is possible for <B
CLASS="COMMAND"
>sendmail</B
> daemons to consume all
system memory. This option provides you with a means of limiting the
maximum number of daemon children that will be spawned. When this
number is reached, new connections are rejected until some of
the existing children have terminated
(Default: undefined).</P
></DD
><DT
><TT
CLASS="LITERAL"
>confSEPARATE_PROC</TT
> <TT
CLASS="LITERAL"
>(ForkEachJob)</TT
></DT
><DD
><P
>When processing the mail queue and sending mail messages,
<B
CLASS="COMMAND"
>sendmail</B
> processes one mail message at a time. When this
option is enabled, <B
CLASS="COMMAND"
>sendmail</B
> will fork a new copy of
itself for each message to be delivered. This is particularly useful
when there are some mail messages that are stuck in the queue because
of a problem with the target host
(Default: false).</P
></DD
><DT
><TT
CLASS="LITERAL"
>confSMTP_LOGIN_MSG</TT
> <TT
CLASS="LITERAL"
>(SmtpGreetingMessage)</TT
></DT
><DD
><P
>Whenever a connection is made to <B
CLASS="COMMAND"
>sendmail</B
>, a
greeting message is sent. By default, this message contains the hostname,
name of the mail transfer agent, the sendmail version number, the local
version number, and the current date. RFC821 specifies that the first word
of the greeting should be the fully qualified domain name of the host, but
the rest of the greeting can be configured however you please. You can specify
sendmail macros here and they will be expanded when used. The only people
who will see this message are suffering system administrators diagnosing
mail delivery problems or strongly curious people interested in discovering
how your machine is configured. You can relieve some of the tedium of their
task by customizing the welcome message with some witticisms; be nice.
The word &#8220;EMSTP&#8221; will be inserted between the first and second
words by <B
CLASS="COMMAND"
>sendmail</B
>, as this is the signal to remote hosts
that we support the ESMTP protocol
(Default: <TT
CLASS="LITERAL"
>$j Sendmail $v/$Z; $b</TT
>).</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN15365"
>18.8. Some Useful sendmail Configurations</A
></H2
><P
>&#13;There are myriad possible <B
CLASS="COMMAND"
>sendmail</B
> configurations.
In this space we'll illustrate just a few important types of configuration
that will be useful in many <B
CLASS="COMMAND"
>sendmail</B
> installations.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN15373"
>18.8.1. Trusting Users to Set the From: Field</A
></H3
><P
>It is sometimes useful to overwrite the <TT
CLASS="LITERAL"
>From:</TT
> field of
an outgoing mail message. Let's say you have a web-based program that 
generates email. Normally the
mail message would appear to come from the user who owned the web server
process. We might want to specify some other source address so that the mail
appears to have originated from some other user or address on that machine.
<B
CLASS="COMMAND"
>sendmail</B
> provides a means of specifying which systems
users are to be entrusted with the ability to do this.</P
><P
>The <TT
CLASS="LITERAL"
>use_ct_file</TT
> feature enables the specification and
use of a file that lists the names of trusted users. By default, a small
number of system users are trusted by <B
CLASS="COMMAND"
>sendmail</B
>
(<TT
CLASS="LITERAL"
>root</TT
>, for example). The default filename for this feature
is <TT
CLASS="FILENAME"
>/etc/mail/trusted-users</TT
> in systems exploiting the
<TT
CLASS="FILENAME"
>/etc/mail/</TT
> configuration directory and
<TT
CLASS="FILENAME"
>/etc/sendmail.ct</TT
> in those that don't. You can specify
the name and location of the file by overriding the
<TT
CLASS="LITERAL"
>confCT_FILE</TT
> definition.</P
><P
>Add FEATURE(use_ct_file) to your 
<TT
CLASS="FILENAME"
>sendmail.mc</TT
> file to enable the feature.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN15388"
>18.8.2. Managing Mail Aliases</A
></H3
><P
>&#13;

Mail aliases are a powerful feature that enable mail to be directed to
mailboxes that are alternate names for users or processes on a
destination host. For example, it is common practice to have feedback
or comments relating to a World Wide Web server to be directed to
&#8220;webmaster.&#8221; Often there isn't a user known as
&#8220;webmaster&#8221; on the target machine, instead it is an alias
of another system user. Another common use of mail aliases is
exploited by mailing list server programs in which an alias directs
incoming messages to the list server program for handling.</P
><P
>&#13;The <TT
CLASS="FILENAME"
>/etc/aliases</TT
> file is where the aliases are stored.
The <B
CLASS="COMMAND"
>sendmail</B
> program consults this file when determining
how to handle an incoming mail message. If it finds an entry in this file
matching the target user in the mail message, it redirects the message to
wherever the entry describes.</P
><P
>Specifically there are three things that aliases allow to happen:

<P
></P
><UL
><LI
><P
>They provide a shorthand or well-known name for mail to be addressed to in
order to go to one or more persons.</P
></LI
><LI
><P
>They can invoke a program with the mail message as the input to the program.</P
></LI
><LI
><P
>They can send mail to a file.</P
></LI
></UL
></P
><P
>All systems require aliases for
<SPAN
CLASS="SYSTEMITEM"
>Postmaster</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>MAILER-DAEMON</SPAN
> to be RFC-compliant.</P
><P
>Always be extremely aware of security when defining aliases that invoke
programs or write to programs, since <B
CLASS="COMMAND"
>sendmail</B
> generally
runs with <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
> permissions.</P
><P
>Details concerning mail aliases may be found in the
<TT
CLASS="FILENAME"
>aliases(5)</TT
> manual page. A sample
<TT
CLASS="FILENAME"
>aliases</TT
> file is shown
in <A
HREF="#X-087-2-SAMP.ALIAS.FIG"
>Example 18-4</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-SAMP.ALIAS.FIG"
></A
><P
><B
>Example 18-4. Sample aliases File</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#
# The following two aliases must be present to be RFC-compliant.
# It is important to resolve them to 'a person' who reads mail routinely.
#
postmaster:    root                            # required entry
MAILER-DAEMON: postmaster                      # required entry
#
#
# demonstrate the common types of aliases
#
usenet:        janet                           # alias for a person
admin:         joe,janet                       # alias for several people
newspak-users: :include:/usr/lib/lists/newspak # read recipients from file
changefeed:    |/usr/local/lib/gup             # alias that invokes program
complaints:    /var/log/complaints             # alias writes mail to file
#</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>Whenever you update the <TT
CLASS="FILENAME"
>/etc/aliases</TT
> file, be
sure to run the command:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>/usr/bin/newaliases</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

to rebuild the database that <B
CLASS="COMMAND"
>sendmail</B
> uses internally.
The <B
CLASS="COMMAND"
>/usr/bin/newaliases</B
> command is a symbolic link to the
<B
CLASS="COMMAND"
>sendmail</B
> executable, and when invoked this way,
behaves exactly as though it were invoked as:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>/usr/lib/sendmail -bi</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

The <B
CLASS="COMMAND"
>newaliases</B
> command is an alternative and more
convenient way to do this.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN15436"
>18.8.3. Using a Smart Host</A
></H3
><P
>&#13;
Sometimes a host finds mail that it is unable to deliver directly to
the desired remote host. It is often convenient to have a single host on a
network take on the role of managing transmission of mail to remote hosts
that are difficult to reach, rather than have each local host try to do this
independently.</P
><P
>There are a few good reasons to have a single host take on mail
management.  You can simplify management by having only one host 
with a comprehensive mail configuration that knows how to handle all
of the different mail transport types, such as UUCP, Usenet, etc. All
other hosts need only a single tranport protocol to send their mail to
this central host. Hosts that fill this central mail routing and
forwarding role are called <EM
>smart hosts</EM
>.  If you
have a smart host that will accept mail from you, you can send it mail
of any sort and it will manage the routing and transmission of that
mail to the desired remote destinations.</P
><P
>Another good application for smart host configurations is to manage
transmission of mail across a private firewall. An organization may
elect to install a private IP network and use their own,
unregistered IP addresses.  The private network may be connected to
the Internet through a firewall.  Sending mail to and from hosts in
the private network to the outside world using SMTP would not be
possible in a conventional configuration because the hosts are not
able to accept or establish direct network connections to hosts on the
Internet. Instead, the organization could elect to have the firewall
provide a mail smart host function. The smart host running on the
firewall is able to establish direct network connections with hosts
both on the private network and on the Internet. The smart host would
accept mail from both hosts on the private network and the Internet,
store them in local storage and then manage the retransmission of that
mail to the correct host directly.</P
><P
>Smart hosts are usually used when all other methods of delivery have
failed.  In the case of the organization with the private network, it
would be perfectly reasonable to have the hosts attempt to deliver
mail directly first, and if that fails then to send it to the smart
host. This relieves the smart host of a lot of traffic because other
hosts can directly send mail to other hosts on the private network.</P
><P
>&#13;<B
CLASS="COMMAND"
>sendmail</B
> provides a simple method of configuring
a smart host using the <TT
CLASS="LITERAL"
>SMART_HOST</TT
> feature; when 
implementing it in the Virtual Brewery configuration, we do exactly this. The 
relevant portions of our configuration that define the smart host are:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>define(`SMART_HOST', `uucp-new:moria')
LOCAL_NET_CONFIG
# This rule ensures that all local mail is delivered using the
# smtp transport, everything else will go via the smart host.
R$* &#60; @ $* .$m. &#62; $*	$#smtp $@ $2.$m. $: $1 &#60; @ $2.$m. &#62; $3</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <TT
CLASS="LITERAL"
>SMART_HOST</TT
> macro allows you to specify the host that
should relay all outgoing mail that you are unable to deliver directly,
and the mail transport protocol to use to talk to it.</P
><P
>In our configuration we are using the <TT
CLASS="LITERAL"
>uucp-new</TT
> transport
to UUCP host <EM
>moria</EM
>. If we wanted to configure
<B
CLASS="COMMAND"
>sendmail</B
> to use an SMTP-based Smart Host, we would instead
use something like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>&#13;define(`SMART_HOST', `mail.isp.net')</PRE
></FONT
></TD
></TR
></TABLE
>

We don't need to specify SMTP as the transport, as it is the default.</P
><P
>Can you guess what the <TT
CLASS="LITERAL"
>LOCAL_NET_CONFIG</TT
> macro and the
rewrite rule might be doing?</P
><P
>The <TT
CLASS="LITERAL"
>LOCAL_NET_CONFIG</TT
> macro allows you to add raw
<B
CLASS="COMMAND"
>sendmail</B
> rewrite rules to your configuration that define
what mail should stay within the local mail system. In our example, we've used 
a rule that matches any email address where the host belongs to our
domain (<TT
CLASS="LITERAL"
>.$m.</TT
>) and rewrite it so that it is sent directly 
to the <TT
CLASS="LITERAL"
>SMTP</TT
> mailer.
This ensures that any message for a host on our local domain is directed
immediately to the SMTP mailer and forwarded to that host, rather than falling
through to our smart host, which is the default treatment.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN15468"
>18.8.4. Managing Unwanted or Unsolicited Mail (Spam)</A
></H3
><P
>&#13;


If you've subscribed to a mailing list, published your email address on a
web site, or posted an article to UseNet, you will most likely have
begun to receive unsolicited advertising email. It is commonplace now
for people to scour the net in search of email addresses to add to mailing
lists that they then sell to companies seeking to advertise their products.
This sort of mass-mailing behavior is commonly called spamming. </P
><P
>The Free
On-line Dictionary of Computing offers a mail-specific definition of 
spam as:<A
NAME="X-087-2-FNSD01"
HREF="#FTN.X-087-2-FNSD01"
><SPAN
CLASS="footnote"
>[112]</SPAN
></A
>&#13;</P
><A
NAME="AEN15485"
></A
><BLOCKQUOTE
CLASS="BLOCKQUOTE"
><P
>2. (A narrowing of sense 1, above) To indiscrimately send large amounts of
unsolicited e-mail meant to promote a product or service. Spam in this sense
is sort of like the electronic equivalent of junk mail sent to "Occupant."</P
><P
>In the 1990s, with the rise in commercial awareness of the net, there are
actually scumbags who offer spamming as a "service" to companies wishing to
advertise on the net. They do this by mailing to collections of e-mail
addresses, Usenet news, or mailing lists.  Such practises have caused outrage
and aggressive reaction by many net users against the individuals concerned.</P
></BLOCKQUOTE
><P
>Fortunately, <B
CLASS="COMMAND"
>sendmail</B
> includes some support for mechanisms
that can help you deal with unsolicited mail.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN15490"
>18.8.4.1. The Real-time Blackhole List</A
></H4
><P
>&#13;The Real-time Blackhole List is a public facility provided to help reduce the
volume of unsolicited advertising you have to contend with. Known email
sources and hosts are listed in a queryable database on the Internet. They're
entered there by people who have received unsolicited advertising from some
email address. Major domains sometimes find themselves on the list because of 
slip-ups in shutting down spam. While some people complain about 
particular choices made by the maintainers of the list, it remains 
very popular and disagreements are usually worked out quickly. Full details 
on how the service is operated may be found
from the home site of the Mail Abuse Protection System at
<EM
>http://maps.vix.com/rbl/</EM
>.</P
><P
>If you enable this <B
CLASS="COMMAND"
>sendmail</B
> feature, it will test the source
address of each incoming mail message against the Real-time Blackhole List to
determine whether to accept the message. If you run a large site
with many users, this feature could save a considerable volume of disk space.
This feature accepts a parameter to specify the name of the
server to use. The default is the main server at
<SPAN
CLASS="SYSTEMITEM"
>rbl.maps.vix.com</SPAN
>.</P
><P
>To configure the Real-time Blackhole List feature, add the following
macro declaration to your <TT
CLASS="FILENAME"
>sendmail.mc</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>FEATURE(rbl)</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Should you wish to specify some other RBL server, you would use a
declaration that looks like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>FEATURE(rbl,`rbl.host.net')</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="X-087-2-SENDMAIL.ACCESSDB"
>18.8.4.2. The access database</A
></H4
><P
>&#13;
An alternative system that offers greater flexibility and control at
the cost of manual configuration is the <B
CLASS="COMMAND"
>sendmail</B
>
<SPAN
CLASS="SYSTEMITEM"
>access_db</SPAN
> feature. The access
database allows you to configure which hosts or users you will accept
mail from and which you will relay mail for.</P
><P
>Managing who you will relay mail for is important, as it is another technique
commonly employed by spamming hosts to circumvent systems such as the Real-time
Blackhole List just described. Instead of sending the mail to you directly,
spammers will relay the mail via some other unsuspecting host who allows it.
The incoming SMTP connection then doesn't come from the known spamming host,
it instead comes from the relay host. To ensure that your own mail hosts
aren't used in this way, you should relay mail only for known hosts. Versions
of <B
CLASS="COMMAND"
>sendmail</B
> that are 8.9.0 or newer have
relaying disabled by default, so for those you'll need to use the access
database to enable individual hosts to relay.</P
><P
>The general idea is simple. When a new incoming SMTP connection is received,
<B
CLASS="COMMAND"
>sendmail</B
> retrieves the message header information and then
consults the access database to see whether it should proceed to accept
the body of the message itself.</P
><P
>The access database is a collection of rules that describe what action should
be taken for messages received from nominated hosts. The default access control
file is called <TT
CLASS="FILENAME"
>/etc/mail/access</TT
>. The table has a simple
format. Each line of the table contains an access rule. The lefthand side of
each rule is a pattern used to match the sender of an incoming mail message.
It may be a complete email address, a hostname, or an IP address. The 
righthand side is the action to take. There are five types of action you may
configure. These are:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>OK</DT
><DD
><P
>Accept the mail message.</P
></DD
><DT
>RELAY</DT
><DD
><P
>Accept messages from this host or user even if they are not destined
for our host; that is, accept messages for relaying to other hosts from
this host.</P
></DD
><DT
>REJECT</DT
><DD
><P
>Reject the mail with a generic message.</P
></DD
><DT
>DISCARD</DT
><DD
><P
>Discard the message using the <TT
CLASS="LITERAL"
>$#discard</TT
> mailer.</P
></DD
><DT
>### any text</DT
><DD
><P
>Return an error message using <TT
CLASS="REPLACEABLE"
><I
>###</I
></TT
> as
the error code (which should be RFC-821 compliant) and &#8220;any
text&#8221; as the message.</P
></DD
></DL
></DIV
><P
>An example <TT
CLASS="FILENAME"
>/etc/mail/access</TT
> might look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>friends@cybermail.com   REJECT
aol.com                 REJECT
207.46.131.30           REJECT
postmaster@aol.com      OK
linux.org.au            RELAY</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This example would reject any email received from
<SPAN
CLASS="SYSTEMITEM"
>friends@cybermail.com</SPAN
>,
any host in the domain <EM
>aol.com</EM
>
and the host <EM
>207.46.131.30</EM
>.
The next rule would accept email from
<SPAN
CLASS="SYSTEMITEM"
>postmaster@aol.com</SPAN
> despite the fact
that the domain itself has a reject rule. The last rule allows relaying
of mail from any host in the
<EM
>linux.org.au</EM
> domain.</P
><P
>To enable the access database feature, use the following declaration in your
<TT
CLASS="FILENAME"
>sendmail.mc</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>FEATURE(access_db)</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The default definition builds the database using
<TT
CLASS="LITERAL"
>hash -o /etc/mail/access</TT
>, which generates
a simple hashed database from the plain text file. This is perfectly adequate
in most installations. There are other options that you should consider if
you intend to have a large access database. Consult the <EM
>sendmail</EM
> book or
other <B
CLASS="COMMAND"
>sendmail</B
> documentation for details.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN15559"
>18.8.4.3. Barring users from receiving mail</A
></H4
><P
>&#13;
If you have users or automated processes that send mail but will never
need to receive it, it is sometimes useful to refuse to accept mail destined
for them. This saves wasted disk-space storing mail that will never be
read. The <SPAN
CLASS="SYSTEMITEM"
>blacklist_recipients</SPAN
>
feature, when used in combination with the
<SPAN
CLASS="SYSTEMITEM"
>access_db</SPAN
> feature, allows you to
disable the receipt of mail for local users.</P
><P
>To enable the feature, you add the following lines to your
<TT
CLASS="FILENAME"
>sendmail.mc</TT
> file, if they're not already there:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>FEATURE(access_db)
FEATURE(blacklist_recipients)</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>To disable receipt of mail for a local user, simply add his details
into the access database. Usually you would use the
<TT
CLASS="REPLACEABLE"
><I
>###</I
></TT
> entry style that would return a
meaningful error message to the sender so they know why the mail is
not being delivered. This feature applies equally well to users in
virtual mail domains, and you must include the virtual mail domain
in the access database specification. Some sample
<TT
CLASS="FILENAME"
>/etc/mail/access</TT
> entries might look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>daemon          550 Daemon does not accept or read mail.
flacco          550 Mail for this user has been administratively disabled.
grump@dairy.org 550 Mail disabled for this recipient.</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN15580"
>18.8.5. Configuring Virtual Email Hosting</A
></H3
><P
>&#13;
Virtual email hosting provides a host the capability of accepting and
delivering mail on behalf of a number of different domains as though it were
a number of separate mail hosts. Most commonly, virtual hosting is exploited by
Internet Application Providers in combination with virtual web hosting, but
it's simple to configure and you never know when you might be in a position to
virtual host a mailing list for your favorite Linux project, so we'll
describe it here.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN15589"
>18.8.5.1. Accepting mail for other domains</A
></H4
><P
>&#13;When <B
CLASS="COMMAND"
>sendmail</B
> receives an email message, it compares the
destination host in the message headers to the local host name. If they
match, <B
CLASS="COMMAND"
>sendmail</B
> accepts the message for local delivery;
if they differ, <B
CLASS="COMMAND"
>sendmail</B
> may decide to accept the message
and attempt to forward it on to the final destination (See
<A
HREF="#X-087-2-SENDMAIL.ACCESSDB"
>Section 18.8.4.2</A
>&#8221; earlier in this chapter for details on how to configure
<B
CLASS="COMMAND"
>sendmail</B
> to accept mail for forwarding&#8201;).</P
><P
>If we wish to configure virtual email hosting, the first thing we need to do
is to convince <B
CLASS="COMMAND"
>sendmail</B
> that it should also accept mail
for the domains that we are hosting. Fortunately, this is a very simple thing
to do.</P
><P
>The <B
CLASS="COMMAND"
>sendmail</B
>
<SPAN
CLASS="SYSTEMITEM"
>use_cw_file</SPAN
> feature allows us to
specify the name of a file where we store domain names for which 
<B
CLASS="COMMAND"
>sendmail</B
> accepts mail. To configure the feature, add the 
feature declaration to your <TT
CLASS="FILENAME"
>sendmail.mc</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>FEATURE(use_cw_file)</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The default name of the file will be
<TT
CLASS="FILENAME"
>/etc/mail/local-host-names</TT
> for distributions using
the <TT
CLASS="FILENAME"
>/etc/mail/</TT
> configuration directory or
<TT
CLASS="FILENAME"
>/etc/sendmail.cw</TT
> for those that don't. Alternatively,
you can specify the name and location of the file by overriding the
<TT
CLASS="LITERAL"
>confCW_FILE</TT
> macro using a variation on:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>define(`confCW_FILE',`/etc/virtualnames')</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>To stick with the default filename, if we wished to offer virtual hosting to 
the <EM
>bovine.net</EM
>, <EM
>dairy.org</EM
>, and
<EM
>artist.org</EM
> domains, we would create a
<TT
CLASS="FILENAME"
>/etc/mail/local-host-names</TT
> that looks like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>bovine.net
dairy.org
artist.org</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>When this is done, and assuming appropriate DNS records exist that point those
domain names to our host, <B
CLASS="COMMAND"
>sendmail</B
> will accept mail
messages for those domains as though they were destined for our real domain
name.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN15622"
>18.8.5.2. Forwarding virtual-hosted mail to other destinations</A
></H4
><P
>&#13;

The <B
CLASS="COMMAND"
>sendmail</B
>
<SPAN
CLASS="SYSTEMITEM"
>virtusertable</SPAN
> feature configures
support for the virtual user table, where we configure virtual
email hosting. The virtual user table maps incoming mail destined for some 
<EM
>user@host</EM
> to some <EM
>otheruser@otherhost</EM
>.
You can think of this as an advanced mail alias feature, one that operates
using not just the destination user, but also the destination domain.</P
><P
>To configure the <SPAN
CLASS="SYSTEMITEM"
>virtusertable</SPAN
>
feature, add the feature to your <TT
CLASS="FILENAME"
>sendmail.mc</TT
>
configuration as shown:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>FEATURE(virtusertable)</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>By default, the file containing the rules to perform translations will be
<TT
CLASS="FILENAME"
>/etc/mail/virtusertable</TT
>. You can override this by
supplying an argument to the macro definition; consult a
detailed <B
CLASS="COMMAND"
>sendmail</B
> reference to learn about what options
are available.</P
><P
>The format of the virtual user table is very simple. The lefthand side of
each line contains a pattern representing the original destination mail
address; the righthand side has a pattern representing the mail address the
virtual hosted address will be mapped to.</P
><P
>The following example shows three possible types of entries:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>samiam@bovine.net     colin
sunny@bovine.net      darkhorse@mystery.net
@dairy.org            mail@jhm.org
@artist.org           $1@red.firefly.com</PRE
></FONT
></TD
></TR
></TABLE
>

In this example, we are virtual hosting three domains:
<EM
>bovine.net</EM
>, <EM
>dairy.org</EM
>, and
<EM
>artist.org</EM
>.</P
><P
>The first entry redirects mail sent to a user in the
<EM
>bovine.net</EM
> virtual domain to a local
user on the machine. The second entry redirects mail to a user in the same
virtual domain to a user in another domain. The third example redirects all
mail addressed to any user in the <EM
>dairly.org</EM
> virtual
domain to a single remote mail address. Finally, the last entry redirects
any mail to a user in the <EM
>artist.org</EM
> virtual domain to
the same user in another domain; for example,
<SPAN
CLASS="SYSTEMITEM"
>julie@artists.org</SPAN
> would be redirected to
<SPAN
CLASS="SYSTEMITEM"
>julie@red.firefly.com</SPAN
>.</P
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN15657"
>18.9. Testing Your Configuration</A
></H2
><P
>&#13;
The <B
CLASS="COMMAND"
>m4</B
> command processes the macro definition files
according to its own syntax rules without understanding anything about correct
<B
CLASS="COMMAND"
>sendmail</B
> syntax; so there won't be any error messages if
you've gotten anything wrong in your macro definition file. For this reason,
it is very important that you thoroughly test your configuration. Fortunately,
<B
CLASS="COMMAND"
>sendmail</B
> provides a relatively easy way of doing this.</P
><P
><B
CLASS="COMMAND"
>sendmail</B
> supports an &#8220;address test&#8221; mode that 
allows us to test our configuration and identify any errors. In this mode
of operation, we invoke <B
CLASS="COMMAND"
>sendmail</B
> from the command line,
and it prompts us for a ruleset specification and a destination mail address.
<B
CLASS="COMMAND"
>sendmail</B
> then processes that destination address using
the rules specified, displaying the output of each rewrite rule as it proceeds.
To place <B
CLASS="COMMAND"
>sendmail</B
> into this mode, we invoke it with the
<TT
CLASS="LITERAL"
>&#8211;bt</TT
> argument: </P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>/usr/sbin/sendmail -bt</KBD
>
ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &#60;ruleset&#62; &#60;address&#62;
&#62;</PRE
></FONT
></TD
></TR
></TABLE
><P
>The default configuration file used is the
<TT
CLASS="FILENAME"
>/etc/mail/sendmail.cf</TT
> file; you can specify an alternate
configuration file using the <TT
CLASS="LITERAL"
>&#8211;C</TT
> argument. To test our configuration, we need to select a number of addresses to process
that will tell us that each of our mail-handing requirements are met. To
illustrate this, we'll work through a test of our more complicated UUCP
configuration shown in <A
HREF="#X-087-2-SENDMAIL.MC.UUCPSMTP"
>Example 18-2</A
>.</P
><P
>First we'll test that <B
CLASS="COMMAND"
>sendmail</B
> is able to deliver mail to
local users on the system. In these tests we expect all addresses to be
rewritten to the <EM
>local</EM
> mailer on this machine:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>/usr/sbin/sendmail -bt</KBD
>
ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &#60;ruleset&#62; &#60;address&#62;
&#62; <KBD
CLASS="USERINPUT"
>3,0 isaac</KBD
>
rewrite: ruleset   3   input: isaac
rewrite: ruleset  96   input: isaac
rewrite: ruleset  96 returns: isaac
rewrite: ruleset   3 returns: isaac
rewrite: ruleset   0   input: isaac
rewrite: ruleset 199   input: isaac
rewrite: ruleset 199 returns: isaac
rewrite: ruleset  98   input: isaac
rewrite: ruleset  98 returns: isaac
rewrite: ruleset 198   input: isaac
rewrite: ruleset 198 returns: $# local $: isaac
rewrite: ruleset   0 returns: $# local $: isaac</PRE
></FONT
></TD
></TR
></TABLE
><P
>This output shows us how <B
CLASS="COMMAND"
>sendmail</B
> processes mail addressed
to <EM
>isaac</EM
> on this system. Each line shows us what information
has been supplied to a ruleset or the result obtained from processing by a
ruleset. We told <B
CLASS="COMMAND"
>sendmail</B
> we wished to use rulesets 3 and
0 to process the address. Ruleset 0 is what is normally invoked and we forced
ruleset 3 because it is not tested by default. The last line shows us that
the result of ruleset 0 does indeed direct mail to <EM
>isaac</EM
> to the
<EM
>local</EM
> mailer.</P
><P
>Next we'll test mail addressed to our SMTP address: <EM
>isaac@vstout.vbrew.com</EM
>. We should be able
to produce the same end result as our last example:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>/usr/sbin/sendmail -bt</KBD
>
ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &#60;ruleset&#62; &#60;address&#62;
&#62; 3,0 isaac@vstout.vbrew.com
rewrite: ruleset   3   input: isaac @ vstout . vbrew . com
rewrite: ruleset  96   input: isaac &#60; @ vstout . vbrew . com &#62;
rewrite: ruleset  96 returns: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset   3 returns: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset   0   input: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset 199   input: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset 199 returns: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset  98   input: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset  98 returns: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset 198   input: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset 198 returns: $# local $: isaac
rewrite: ruleset   0 returns: $# local $: isaac</PRE
></FONT
></TD
></TR
></TABLE
><P
>Again, this test passed. Next we'll test mail to our UUCP style address:
<EM
>vstout!isaac</EM
>.</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>/usr/sbin/sendmail -bt</KBD
>
ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &#60;ruleset&#62; &#60;address&#62;
&#62; 3,0 vstout!isaac
rewrite: ruleset   3   input: vstout ! isaac
rewrite: ruleset  96   input: isaac &#60; @ vstout . UUCP &#62;
rewrite: ruleset  96 returns: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset   3 returns: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset   0   input: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset 199   input: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset 199 returns: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset  98   input: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset  98 returns: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset 198   input: isaac &#60; @ vstout . vbrew . com . &#62;
rewrite: ruleset 198 returns: $# local $: isaac
rewrite: ruleset   0 returns: $# local $: isaac</PRE
></FONT
></TD
></TR
></TABLE
><P
>This test has also passed. These tests confirm that any mail received
for local users on this machine will be properly delivered irrespective of
how the address is formatted. If you've defined any aliases for your machine, such as virtual hosts, you should repeat these tests for each of the
alternate names by which this host is known to ensure they also work correctly.</P
><P
>Next we will test that mail addressed to other hosts in the
<EM
>vbrew.com</EM
> domain is delivered
directly to that host using the SMTP mailer:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>/usr/sbin/sendmail -bt</KBD
>
ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &#60;ruleset&#62; &#60;address&#62;
&#62; 3,0 isaac@vale.vbrew.com
rewrite: ruleset   3   input: isaac @ vale . vbrew . com
rewrite: ruleset  96   input: isaac &#60; @ vale . vbrew . com &#62;
rewrite: ruleset  96 returns: isaac &#60; @ vale . vbrew . com . &#62;
rewrite: ruleset   3 returns: isaac &#60; @ vale . vbrew . com . &#62;
rewrite: ruleset   0   input: isaac &#60; @ vale . vbrew . com . &#62;
rewrite: ruleset 199   input: isaac &#60; @ vale . vbrew . com . &#62;
rewrite: ruleset 199 returns: isaac &#60; @ vale . vbrew . com . &#62;
rewrite: ruleset  98   input: isaac &#60; @ vale . vbrew . com . &#62;
rewrite: ruleset  98 returns: isaac &#60; @ vale . vbrew . com . &#62;
rewrite: ruleset 198   input: isaac &#60; @ vale . vbrew . com . &#62;
rewrite: ruleset 198 returns: $# smtp $@ vale . vbrew . com . /
    $: isaac &#60; @ vale . vbrew . com . &#62;
rewrite: ruleset   0 returns: $# smtp $@ vale . vbrew . com . /
    $: isaac &#60; @ vale . vbrew . com . &#62;</PRE
></FONT
></TD
></TR
></TABLE
><P
>We can see that this test has directed the message to the SMTP mailer
to be forwarded directly to the <EM
>vale.vbrew.com</EM
> host and
specifies the user <EM
>isaac</EM
>. This test confirms that our
<TT
CLASS="LITERAL"
>LOCAL_NET_CONFIG</TT
> definition works correctly. For
this test to succeed, the destination hostname must be able to be
resolved correctly, so it must either have an entry in our
<TT
CLASS="FILENAME"
>/etc/hosts</TT
> file, or in our local DNS. We can see
what happens if the destination hostname isn't able to be resolved by
intentionally specifying an unknown host:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>/usr/sbin/sendmail -bt</KBD
>
ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &#60;ruleset&#62; &#60;address&#62;
&#62; 3,0 isaac@vXXXX.vbrew.com
rewrite: ruleset   3   input: isaac @ vXXXX . vbrew . com
rewrite: ruleset  96   input: isaac &#60; @ vXXXX . vbrew . com &#62;
vXXXX.vbrew.com: Name server timeout
rewrite: ruleset  96 returns: isaac &#60; @ vXXXX . vbrew . com &#62;
rewrite: ruleset   3 returns: isaac &#60; @ vXXXX . vbrew . com &#62;
== Ruleset 3,0 (3) status 75
rewrite: ruleset   0   input: isaac &#60; @ vXXXX . vbrew . com &#62;
rewrite: ruleset 199   input: isaac &#60; @ vXXXX . vbrew . com &#62;
rewrite: ruleset 199 returns: isaac &#60; @ vXXXX . vbrew . com &#62;
rewrite: ruleset  98   input: isaac &#60; @ vXXXX . vbrew . com &#62;
rewrite: ruleset  98 returns: isaac &#60; @ vXXXX . vbrew . com &#62;
rewrite: ruleset 198   input: isaac &#60; @ vXXXX . vbrew . com &#62;
rewrite: ruleset  95   input: &#60; uucp-new : moria &#62; isaac &#60;/
    @ vXXXX . vbrew . com &#62;
rewrite: ruleset  95 returns: $# uucp-new $@ moria $: isaac &#60;/
    @ vXXXX . vbrew . com &#62;
rewrite: ruleset 198 returns: $# uucp-new $@ moria $: isaac &#60;/
    @ vXXXX . vbrew . com &#62;
rewrite: ruleset   0 returns: $# uucp-new $@ moria $: isaac &#60;/
    @ vXXXX . vbrew . com &#62;</PRE
></FONT
></TD
></TR
></TABLE
><P
>This result is very different. First, ruleset 3
returned an error message indicating the hostname could not be resolved.
Second, we deal with this situation by relying
on the other key feature of our configuration, the smart host. The smart host
will is to handle any mail that is otherwise undeliverable. The hostname
we specified in this test was unable to be resolved and the rulesets determined
that the mail should be forwarded to our smart host 
<EM
>moria</EM
> using
the <EM
>uucp-new</EM
> mailer. Our smart host might be better connected 
and know what to do with the address.</P
><P
>Our final test ensures that any mail addressed to a host not within our
domain is delivered to our smart host. This should produce a result similar
to our previous example:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>/usr/sbin/sendmail -bt</KBD
>
ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &#60;ruleset&#62; &#60;address&#62;
&#62; 3,0 isaac@linux.org.au
rewrite: ruleset   3   input: isaac @ linux . org . au
rewrite: ruleset  96   input: isaac &#60; @ linux . org . au &#62;
rewrite: ruleset  96 returns: isaac &#60; @ linux . org . au . &#62;
rewrite: ruleset   3 returns: isaac &#60; @ linux . org . au . &#62;
rewrite: ruleset   0   input: isaac &#60; @ linux . org . au . &#62;
rewrite: ruleset 199   input: isaac &#60; @ linux . org . au . &#62;
rewrite: ruleset 199 returns: isaac &#60; @ linux . org . au . &#62;
rewrite: ruleset  98   input: isaac &#60; @ linux . org . au . &#62;
rewrite: ruleset  98 returns: isaac &#60; @ linux . org . au . &#62;
rewrite: ruleset 198   input: isaac &#60; @ linux . org . au . &#62;
rewrite: ruleset  95   input: &#60; uucp-new : moria &#62; isaac &#60;/
    @ linux . org . au . &#62;
rewrite: ruleset  95 returns: $# uucp-new $@ moria $: isaac &#60;/
    @ linux . org . au . &#62;
rewrite: ruleset 198 returns: $# uucp-new $@ moria $: isaac &#60;/
    @ linux . org . au . &#62;
rewrite: ruleset   0 returns: $# uucp-new $@ moria $: isaac &#60;/
    @ linux . org . au . &#62;</PRE
></FONT
></TD
></TR
></TABLE
><P
>The results of this test indicate that the hostname was resolved, and that the
message would still have been routed to our smart host. This proves that our
<TT
CLASS="LITERAL"
>LOCAL_NET_CONFIG</TT
> definition works correctly and it handled
both cases correctly. This test was also successful, so we can happily assume
our configuration is correct and use it.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN15723"
>18.10. Running sendmail</A
></H2
><P
>&#13;The <B
CLASS="COMMAND"
>sendmail</B
> daemon can be run in either of two
ways. One way is to have to have it run from the <B
CLASS="COMMAND"
>inetd</B
>
daemon; the alternative, and more commonly used method is to run
<B
CLASS="COMMAND"
>sendmail</B
> as a standalone daemon. It is also common for
mailer programs to invoke <B
CLASS="COMMAND"
>sendmail</B
> as a user command
to accept locally generated mail for delivery.</P
><P
>When running <B
CLASS="COMMAND"
>sendmail</B
> in standalone mode, place the command
in an <TT
CLASS="FILENAME"
>rc</TT
> file so it starts at boot time. The syntax
used is commonly:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>/usr/sbin/sendmail -bd -q10m</PRE
></FONT
></TD
></TR
></TABLE
>

The <TT
CLASS="LITERAL"
>-bd</TT
> argument tells <B
CLASS="COMMAND"
>sendmail</B
> to run
as a daemon. It will fork and run in the background. The
<TT
CLASS="LITERAL"
>-q10m</TT
> argument tells <B
CLASS="COMMAND"
>sendmail</B
>
to check its queue every ten minutes. You may choose to use a different queue to check time.</P
><P
>To run <B
CLASS="COMMAND"
>sendmail</B
> from the <B
CLASS="COMMAND"
>inetd</B
> network
daemon, you'd use an entry like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>smtp  stream  tcp nowait  nobody  /usr/sbin/sendmail -bs</PRE
></FONT
></TD
></TR
></TABLE
>

The <TT
CLASS="LITERAL"
>-bs</TT
> argument here tells <B
CLASS="COMMAND"
>sendmail</B
>
to use the SMTP protocol on stdin/stdout, which is required for use with
<B
CLASS="COMMAND"
>inetd</B
>.</P
><P
>The <B
CLASS="COMMAND"
>runq</B
> command is usually a symlink to the
<B
CLASS="COMMAND"
>sendmail</B
> binary and is a more convenient form of:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>sendmail -q</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>When <B
CLASS="COMMAND"
>sendmail</B
> is invoked this way, it processes any mail
waiting in the queue to be transmitted. When running
<B
CLASS="COMMAND"
>sendmail</B
> from <B
CLASS="COMMAND"
>inetd</B
> you must also create
a <B
CLASS="COMMAND"
>cron</B
> job that runs the <B
CLASS="COMMAND"
>runq</B
> command
periodically to ensure that the mail spool is serviced periodically.</P
><P
>A suitable <B
CLASS="COMMAND"
>cron</B
> table entry would be similar to:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># Run the mail spool every fifteen minutes
0,15,30,45     *     *     *     *     /usr/bin/runq</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>In most installations <B
CLASS="COMMAND"
>sendmail</B
> processes the queue
every 15 minutes as shown in our <TT
CLASS="FILENAME"
>crontab</TT
> example,
attempting to transmit any messages there.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN15765"
>18.11. Tips and Tricks</A
></H2
><P
>&#13;There are a number of things you can do to make managing a
<B
CLASS="COMMAND"
>sendmail</B
> site efficient. A number of management tools are
provided in the <B
CLASS="COMMAND"
>sendmail</B
> package; let's look at the most
important of these.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN15773"
>18.11.1. Managing the Mail Spool</A
></H3
><P
>&#13;
Mail is queued in the <TT
CLASS="FILENAME"
>/var/spool/mqueue</TT
> directory
before being transmitted. This directory is called the mail spool.
The <B
CLASS="COMMAND"
>sendmail</B
> program provides a means of displaying a
formatted list of all spooled mail messages and their status.</P
><P
>The <B
CLASS="COMMAND"
>/usr/bin/mailq</B
> command is a symbolic link to the
<B
CLASS="COMMAND"
>sendmail</B
> executable and behaves indentically to:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>sendmail -bp</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

The output displays the message ID, its size, the time it was placed in the
queue, who sent it, and a message indicating its current status. The following
example shows a mail message stuck in the queue with a  problem:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>mailq</KBD
>
                Mail Queue (1 request)
--Q-ID-- --Size-- -----Q-Time----- ------------Sender/Recipient------------
RAA00275      124 Wed Dec  9 17:47 root
                 (host map: lookup (tao.linux.org.au): deferred)
                                   terry@tao.linux.org.au</PRE
></FONT
></TD
></TR
></TABLE
>

This message is still in the mail queue because the destination host
IP address could not be resolved.</P
><P
>We can force <B
CLASS="COMMAND"
>sendmail</B
> to process the queue now by issuing
the <TT
CLASS="FILENAME"
>/usr/bin/runq</TT
> command.</P
><P
>The <B
CLASS="COMMAND"
>runq</B
> command produces no output.
<B
CLASS="COMMAND"
>sendmail</B
> will begin processing the mail queue in the
background.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN15796"
>18.11.2. Forcing a Remote Host to Process its Mail Queue</A
></H3
><P
>&#13;
If you use a temporary dial-up Internet connection with a
<EM
>fixed</EM
> IP address and rely on an MX host to collect your
mail while you are disconnected, you will find it useful to force the MX host
to process its mail queue soon after you establish your connection.</P
><P
>A small <B
CLASS="COMMAND"
>perl</B
> program is included with the
<B
CLASS="COMMAND"
>sendmail</B
> distribution that makes this simple for mail
hosts that support it. The <B
CLASS="COMMAND"
>etrn</B
> script has much the same
effect on a remote host as the <B
CLASS="COMMAND"
>runq</B
> command has on our
own. If we invoke the command as shown in this example:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>etrn vstout.vbrew.com</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

we will force the host <EM
>vstout.vbrew.com</EM
> to process any mail queued for our local machine.</P
><P
>Typically you'd add this command to your PPP <TT
CLASS="FILENAME"
>ip-up</TT
> script
so that it is executed soon after your network connection is established.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN15816"
>18.11.3. Analyzing Mail Statistics</A
></H3
><P
>&#13;<B
CLASS="COMMAND"
>sendmail</B
> collects data on mail traffic volumes and
some information on hosts to which it has delivered mail. There are
two commands available to display this information,
<B
CLASS="COMMAND"
>mailstats</B
>, and <B
CLASS="COMMAND"
>hoststat</B
>.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN15825"
>18.11.3.1. mailstats</A
></H4
><P
>&#13;
The <B
CLASS="COMMAND"
>mailstats</B
> command displays statistics on the
volume of mail processed by <B
CLASS="COMMAND"
>sendmail</B
>. The time at
which data collection commenced is printed first, followed by a table
with one row for each configured mailer and one showing a summary
total of all mail. Each line presents eight items of information:

<DIV
CLASS="INFORMALTABLE"
><P
></P
><A
NAME="AEN15835"
></A
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><THEAD
><TR
><TH
>Field</TH
><TH
>Meaning</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="LITERAL"
>M</TT
></TD
><TD
>The mailer (transport protocol) number</TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>msgsfr</TT
></TD
><TD
>The number of messages received from the mailer</TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>bytes_from</TT
></TD
><TD
>The Kbytes of mail from the mailer</TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>msgsto</TT
></TD
><TD
>The number of messages sent to the mailer</TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>bytes_to</TT
></TD
><TD
>The Kbytes of mail sent to the mailer</TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>msgsreg</TT
></TD
><TD
>The number of messages rejected</TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>msgsdis</TT
></TD
><TD
>The number of messages discarded</TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>Mailer</TT
></TD
><TD
>The name of the mailer</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
>

A sample of the output of the <B
CLASS="COMMAND"
>mailstats</B
> command is shown
in <A
HREF="#X-087-2-SENDMAIL.MAILSTATS"
>Example 18-5</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-SENDMAIL.MAILSTATS"
></A
><P
><B
>Example 18-5. Sample Output of the mailstats Command</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>/usr/sbin/mailstats</KBD
>
Statistics from Sun Dec 20 22:47:02 1998
 M   msgsfr  bytes_from   msgsto    bytes_to  msgsrej msgsdis  Mailer
 0        0          0K       19        515K        0       0  prog
 3       33        545K        0          0K        0       0  local
 5       88        972K      139       1018K        0       0  esmtp
=============================================================
 T      121       1517K      158       1533K        0       0</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>This data is collected if the <EM
>StatusFile</EM
> option is enabled
in the <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file and the status file exists.
Typically you'd add the following to your <TT
CLASS="FILENAME"
>sendmail.cf</TT
>
file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># status file
O StatusFile=/var/log/sendmail.st</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>To restart the statistics collection, you need to make the statistics
file zero length:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>&#62; /var/log/sendmail.st</PRE
></FONT
></TD
></TR
></TABLE
>

and restart <B
CLASS="COMMAND"
>sendmail</B
>.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN15889"
>18.11.3.2. hoststat</A
></H4
><P
>&#13;
The <B
CLASS="COMMAND"
>hoststat</B
> command displays information about the
status of hosts that
<B
CLASS="COMMAND"
>sendmail</B
> has attempted to deliver mail to. The
<B
CLASS="COMMAND"
>hoststat</B
> command is equivalent to invoking
<B
CLASS="COMMAND"
>sendmail</B
> as:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>sendmail -bh</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The output presents each host on a line of its own, and for each the
time since delivery was attempted to it, and the status message
received at that time.</P
><P
><A
HREF="#X-087-2-SENDMAIL.HOSTSTAT"
>Example 18-6</A
> shows the sort of output you can
expect from the <B
CLASS="COMMAND"
>hoststat</B
> command. Note that most of the
results indicate successful delivery. The result for
<EM
>earthlink.net</EM
>, on the other hand, indicates
that delivery was unsuccessful. The status message can sometimes help 
determine the cause of the failure. In this case, the connection timed out, 
probably because the host was down or unreachable at the time delivery was 
attempted.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-SENDMAIL.HOSTSTAT"
></A
><P
><B
>Example 18-6. Sample Output of the oststat Command</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="PROMPT"
>#</SAMP
> <KBD
CLASS="USERINPUT"
>hoststat</KBD
>
 -------------- Hostname ---------- How long ago ---------Results---------
 mail.telstra.com.au                    04:05:41 250 Message accepted for
 scooter.eye-net.com.au              81+08:32:42 250 OK id=0zTGai-0008S9-0
 yarrina.connect.com.a               53+10:46:03 250 LAA09163 Message acce
 happy.optus.com.au                  55+03:34:40 250 Mail accepted
 mail.zip.com.au                        04:05:33 250 RAA23904 Message acce
 kwanon.research.canon.com.au        44+04:39:10 250 ok 911542267 qp 21186
 linux.org.au                        83+10:04:11 250 IAA31139 Message acce
 albert.aapra.org.au                    00:00:12 250 VAA21968 Message acce
 field.medicine.adelaide.edu.au      53+10:46:03 250 ok 910742814 qp 721
 copper.fuller.net                   65+12:38:00 250 OAA14470 Message acce
 amsat.org                            5+06:49:21 250 UAA07526 Message acce
 mail.acm.org                        53+10:46:17 250 TAA25012 Message acce
 extmail.bigpond.com                 11+04:06:20 250 ok
 earthlink.net                       45+05:41:09 Deferred: Connection time </PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>The <B
CLASS="COMMAND"
>purgestat</B
> command flushes the collected host data and
is equivalent to invoking sendmail as:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>sendmail -bH</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>The statistics will continue to grow until you purge them. You might 
want to periodically run the <B
CLASS="COMMAND"
>purgestat</B
> command to make it 
easier to search and find recent entries, especially if you have a busy site. 
You could put the command into a <TT
CLASS="FILENAME"
>crontab</TT
> file so it 
runs automatically, or just do it yourself occasionally.</P
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-EXIM"
></A
>Chapter 19. Getting EximUp and Running</H1
><P
>This chapter gives you a quick introduction to setting up Exim and an overview
of its functionality. Although Exim is largely compatible with
<B
CLASS="COMMAND"
>sendmail</B
> in its behavior, its configuration files are
completely different.</P
><P
> 
The main configuration file is usually called
<TT
CLASS="FILENAME"
>/etc/exim.conf</TT
> or <TT
CLASS="FILENAME"
>/etc/exim/config</TT
>
in most Linux distributions, or <TT
CLASS="FILENAME"
>/usr/lib/exim/config</TT
> in
older configurations. You can find out where the configuration file is by
running the command:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>exim -bP configure_file</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>You may have to edit the configuration file to reflect values specific to your
site. In most common configurations there isn't a great deal to change, and a
working configuration should rarely have to be modified.</P
><P
>&#13;By default, Exim processes and delivers all incoming mail immediately. If you
have relatively high traffic, you may instead have Exim collect all messages
in the so-called <EM
>queue</EM
>, and process them at regular
intervals only.</P
><P
>&#13;When handling mail within a TCP/IP network, Exim is frequently run in daemon
mode: at system boot time, it is invoked from
<TT
CLASS="FILENAME"
>/etc/init.d/exim</TT
><A
NAME="X-087-2-FNEX01"
HREF="#FTN.X-087-2-FNEX01"
><SPAN
CLASS="footnote"
>[113]</SPAN
></A
>
and puts itself in the background, where it waits for incoming TCP connections
on the SMTP port (usually port 25). This is beneficial whenever you expect to
have a significant amount of traffic because Exim doesn't have to start up
for every incoming connection. Alternatively, <B
CLASS="COMMAND"
>inetd</B
> could 
manage the SMTP port and have it spawn Exim whenever there is a connection 
on this port. This configuration might be useful when you have limited 
memory and low mail traffic volumes.</P
><P
>&#13;
Exim has a complicated set of command-line options, including many
that match those of sendmail. Instead of trying to put together
exactly the right options for your needs, you can implement the most
common types of operation by invoking traditional commands like
<B
CLASS="COMMAND"
>rmail</B
> or <B
CLASS="COMMAND"
>rsmtp</B
>. These are
symbolic links to Exim (or if they're not, you can easily link
them to it). When you run one of the commands, Exim checks the
name you used to invoke it and sets the proper options itself.</P
><P
>There are two links to Exim that you should have under all circumstances:
<B
CLASS="COMMAND"
>/usr/bin/rmail</B
> and <B
CLASS="COMMAND"
>/usr/sbin/sendmail</B
>.<A
NAME="X-087-2-FNEX02"
HREF="#FTN.X-087-2-FNEX02"
><SPAN
CLASS="footnote"
>[114]</SPAN
></A
>
When you compose and send a mail message with a user agent like
<B
CLASS="COMMAND"
>elm</B
>, the message is piped to <B
CLASS="COMMAND"
>sendmail</B
>
or <B
CLASS="COMMAND"
>rmail</B
> for delivery, which is why both
<B
CLASS="COMMAND"
>/usr/sbin/sendmail</B
> and <B
CLASS="COMMAND"
>/usr/bin/rmail</B
>
should point to Exim. The list of recipients for the message is passed to Exim
on the command line.<A
NAME="X-087-2-FNEX03"
HREF="#FTN.X-087-2-FNEX03"
><SPAN
CLASS="footnote"
>[115]</SPAN
></A
>
The same happens with mail coming in via UUCP. You can set up the required
pathnames to point to Exim by typing the following at a shell prompt:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>ln -s /usr/sbin/exim /usr/bin/rmail</KBD
>
$ <KBD
CLASS="USERINPUT"
>ln -s /usr/sbin/exim /usr/sbin/sendmail</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>If you want to dig further into the details of configuring Exim, you should
consult the full Exim specification. If this isn't included in your favorite
Linux distribution, you can get it from the source to Exim, or read it online
from Exim's web site at
<SPAN
CLASS="SYSTEMITEM"
>http://www.exim.org</SPAN
>.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN15983"
>19.1. Running Exim</A
></H2
><P
>&#13;To run Exim, you must first decide whether you want it to handle incoming SMTP
messages by running as a separate daemon, or whether to have
<B
CLASS="COMMAND"
>inetd</B
> manage the SMTP port and invoke Exim only whenever an
SMTP connection is requested from a client. Usually, you will prefer daemon
operation on the mail server because it loads the machine far less than
spawning Exim over and over again for each connection. As the mail server also
delivers most incoming mail directly to the users, you should choose
<B
CLASS="COMMAND"
>inetd</B
> operation on most other hosts.</P
><P
>&#13; 
Whatever mode of operation you choose for each individual host, you
have to make sure you have the following entry in your
<TT
CLASS="FILENAME"
>/etc/services</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>smtp            25/tcp          # Simple Mail Transfer Protocol</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This defines the TCP port number that is used for SMTP conversations.
Port number 25 is the standard defined by the &#8220;Assigned Numbers&#8221;
RFC (RFC-1700).</P
><P
>When run in daemon mode, Exim puts itself in the background and waits for
connections on the SMTP port. When a connection occurs, it forks, and the
child process conducts an SMTP conversation with the peer process on the
calling host.  The Exim daemon is usually started by invoking it from the
<TT
CLASS="FILENAME"
>rc</TT
> script at boot time using the following command:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>/usr/sbin/exim -bd -q15m</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <CODE
CLASS="OPTION"
>&#8211;bd</CODE
> flag turns on daemon mode, and
<CODE
CLASS="OPTION"
>&#8211;q15m</CODE
> makes it process whatever messages have
accumulated in the message queue every 15 minutes.</P
><P
>&#13; 
If you want to use <B
CLASS="COMMAND"
>inetd</B
> instead, your
<TT
CLASS="FILENAME"
>/etc/inetd.conf</TT
> file should contain a line like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>smtp    stream  tcp nowait  root  /usr/sbin/exim  in.exim -bs</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Remember you have to make <B
CLASS="COMMAND"
>inetd</B
> re-read
<TT
CLASS="FILENAME"
>inetd.conf</TT
> by sending it an
<SPAN
CLASS="SYSTEMITEM"
>HUP</SPAN
> signal after
making any changes.<A
NAME="X-087-2-FNEX04"
HREF="#FTN.X-087-2-FNEX04"
><SPAN
CLASS="footnote"
>[116]</SPAN
></A
></P
><P
>Daemon and <B
CLASS="COMMAND"
>inetd</B
> modes are mutually exclusive. If
you run Exim in daemon mode, you should make sure to comment out any line in
<TT
CLASS="FILENAME"
>inetd.conf</TT
> for the
<SPAN
CLASS="SYSTEMITEM"
>smtp</SPAN
> service. Equivalently, when
having <B
CLASS="COMMAND"
>inetd</B
> manage Exim, make sure that no
<TT
CLASS="FILENAME"
>rc</TT
> script starts the Exim daemon.</P
><P
>You can check that Exim is correctly set up for receiving incoming SMTP
messages by telnetting to the SMTP port on your machine. This is what a
successful connect to the SMTP server looks like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>telnet localhost smtp</KBD
>
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
220 richard.vbrew.com ESMTP Exim 3.13 #1 Sun, 30 Jan 2000 16:23:55 +0600
<KBD
CLASS="USERINPUT"
>quit</KBD
>
221 richard.brew.com closing connection
Connection closed by foreign host.</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>If this test doesn't produce the SMTP banner (the line starting with the
220 code), check that you are either running an Exim daemon process or 
have <B
CLASS="COMMAND"
>inetd</B
> correctly configured. If that doesn't reveal 
the problem, look in the Exim log files (described next) in case 
there is an error in Exim's configuration file.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN16038"
>19.2. If Your Mail Doesn't Get Through</A
></H2
><P
>&#13;
A number of features are available for troubleshooting installation problems.
The first place to check is Exim's log files. On Linux systems they are
normally kept in <TT
CLASS="FILENAME"
>/var/log/exim/log</TT
> and are named
<TT
CLASS="FILENAME"
>exim_mainlog</TT
>, <TT
CLASS="FILENAME"
>exim_rejectlog</TT
>, and
<TT
CLASS="FILENAME"
>exim_paniclog</TT
>. On other operating systems, they are
often kept in <TT
CLASS="FILENAME"
>/var/spool/exim/log</TT
>. You can find out
where the log files are by running the command:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>exim -bP log_file_path</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The main log lists all transactions, the reject log contains details of
messages that were rejected for policy reasons, and the panic log is
for messages related to configuration errors and the like.</P
><P
>Typical entries in the main log are shown below. Each entry in the log itself 
is a single line of text, starting with a date and time. They have
been split into several lines here in order to fit them on the page:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>2000-01-30 15:46:37 12EwYe-0004WO-00 &#60;= jack@vstout.vbrew.com 
  H=vstout.vbrew.com [192.168.131.111] U=exim P=esmtp S=32100 
  id=38690D72.286F@vstout.vbrew.com
2000-01-30 15:46:37 12EwYe-0004WO-00 =&#62; jill &#60;jill@vbrew.com&#62; 
  D=localuser T=local_delivery
2000-01-30 15:46:37 12EwYe-0004WO-00 Completed</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>These entries show that a message from
<SPAN
CLASS="SYSTEMITEM"
>jack@vstout.vbrew.com</SPAN
> 
to <SPAN
CLASS="SYSTEMITEM"
>jill@vbrew.com</SPAN
> was
successfully delivered to a mailbox on the local host. Message arrivals 
are flagged with <TT
CLASS="LITERAL"
>&#60;=</TT
>, and deliveries with
<TT
CLASS="LITERAL"
>=&#62;</TT
>.</P
><P
>There are two kinds of delivery errors: permanent and temporary. A permanent
delivery error is recorded in a log entry like this, flagged with
&#8220;<TT
CLASS="LITERAL"
>**</TT
>&#8221;:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>2000-01-30 14:48:28 12EvcH-0003rC-00 ** bill@lager.vbrew.com 
  R=lookuphost T=smtp: SMTP error from remote mailer after RCPT TO:
  &#60;bill@lager.vbrew.com&#62;: host lager.vbrew.com [192.168.157.2]: 
  550 &#60;bill@lager.vbrew.com&#62;... User unknown</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>After a failure like this, Exim sends a delivery failure report, often called a
<EM
>bounce message</EM
> back to the sender.</P
><P
> Temporary errors are
flagged with &#8220;<TT
CLASS="LITERAL"
>==</TT
>&#8221;:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>2000-01-30 12:50:50 12E9Un-0004Wq-00 == jim@bitter.vbrew.com 
  T=smtp defer (145): Connection timed out</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This error is typical for a situation in which Exim properly recognizes
that the message should be delivered to a remote host, but is not able to
connect to the SMTP service on that host. The host may be down or there 
could be a network problem. Whenever a message is
<EM
>deferred</EM
> like this, it remains on Exim's queue and is
retried at intervals. However, if it fails to be delivered for a sufficiently
long time (usually several days), a permanent error occurs and the message is
bounced.</P
><P
>If you are unable to locate your problem from the error message Exim 
generates, you may want to turn on debugging messages. You can do this 
using the <CODE
CLASS="OPTION"
>&#8211;d</CODE
> flag, optionally followed by a number 
specifying the level of verbosity (a value of 9 gives maximum information). 
Exim then displays a report of its operation on the screen, which may 
give you more hints about what is going wrong.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN16073"
>19.3. Compiling Exim</A
></H2
><P
>&#13;Exim is still under active development; the version of Exim included in
Linux distributions is probably not the latest release. If you need a 
feature or a bugfix found in a later release, you have to obtain a 
copy of the source code and compile it yourself. The latest release can be 
found via Exim's web page at 
<SPAN
CLASS="SYSTEMITEM"
>http://www.exim.org</SPAN
>.</P
><P
>Linux is one of the many operating systems supported by the Exim source. To
compile Exim for Linux, you should edit the <TT
CLASS="FILENAME"
>src/EDITME</TT
>
file and put the result in a file called <TT
CLASS="FILENAME"
>Local/Makefile</TT
>.
There are comments in <TT
CLASS="FILENAME"
>src/EDITME</TT
> that tell you what the
various settings are used for. Then run <B
CLASS="COMMAND"
>make</B
>.  See the Exim
manual for detailed information on building Exim from source.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-EXIM.QUEUE"
>19.4. Mail Delivery Modes</A
></H2
><P
>&#13;


As noted previously, Exim is able to deliver messages immediately or
queue them for later processing. All incoming mail is stored in the
<TT
CLASS="FILENAME"
>input</TT
> directory below
<TT
CLASS="FILENAME"
>/var/spool/exim</TT
>. When queueing is not in
operation, a delivery process is started for each message as soon as
it arrives. Otherwise, it is left on the queue until a
<EM
>queue-runner</EM
> process picks it up. Queueing can be
made unconditional by setting <CODE
CLASS="OPTION"
>queue_only</CODE
> in the
configuration file, or it can be conditional on the 1-minute system
load by a setting such as:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>queue_only_load = 4</PRE
></FONT
></TD
></TR
></TABLE
>

which causes messages to be queued if the system load exceeds
4.<A
NAME="AEN16104"
HREF="#FTN.AEN16104"
><SPAN
CLASS="footnote"
>[117]</SPAN
></A
></P
><P
>If your host is not permanently connected to the Internet, you may
want to turn on queueing for remote addresses, while allowing Exim to
perform local deliveries immediately. You can do this by setting:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>queue_remote_domains = *</PRE
></FONT
></TD
></TR
></TABLE
>

in the configuration file.</P
><P
> 
If you turn on any form of queuing, you have to make sure the queues
are checked regularly, probably every 10 or 15 minutes. Even without
any explicit queueing options, the queues need to be checked for
messages that have been deferred because of temporary delivery
failures. If you run Exim in daemon mode, you must add the
<CODE
CLASS="OPTION"
>&#8211;q15m</CODE
> option on the command line to process the
queue every 15 minutes.  You can also invoke <B
CLASS="COMMAND"
>exim
&#8211;q</B
> from <B
CLASS="COMMAND"
>cron</B
> at these intervals.</P
><P
>&#13;
You can display the current mail queue by invoking Exim with the
<CODE
CLASS="OPTION"
>&#8211;bp</CODE
> option. Equivalently, you can make
<B
CLASS="COMMAND"
>mailq</B
> a link to Exim, and invoke
<B
CLASS="COMMAND"
>mailq</B
>&#8201;:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>mailq</KBD
>
 2h   52K 12EwGE-0005jD-00 &#60;sam@vbrew.com&#62;
        D bob@vbrew.com
          harry@example.net  </PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;This shows a single message from <SPAN
CLASS="SYSTEMITEM"
>sam@vbrew.com</SPAN
> to two recipients sitting
in the message queue. It has been successfully delivered to
<SPAN
CLASS="SYSTEMITEM"
>bob@vbrew.com</SPAN
>, but has not
yet been delivered to <SPAN
CLASS="SYSTEMITEM"
>harry@example.net</SPAN
>, though it has been on
the queue for two hours. The size of the message is 52K, and the ID by
which Exim identifies this message is
<TT
CLASS="LITERAL"
>12EwGE-0005jD-00</TT
>. You can find out why the delivery
is not yet complete by looking at the message's individual log file,
which is kept in the <TT
CLASS="FILENAME"
>msglog</TT
> directory in Exim's
spool directory. The <CODE
CLASS="OPTION"
>&#8211;Mvl</CODE
> option is an easy way
of doing this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>exim &#8211;Mvl 12EwGE-0005jD-00</KBD
>
2000-01-30 17:28:13 example.net [192.168.8.2]: Connection timed out
2000-01-30 17:28:13 harry@example.net: remote_smtp transport deferred: 
  Connection timed out</PRE
></FONT
></TD
></TR
></TABLE
>

Individual log files keep a copy of log entries for each message so you can
easily inspect them. The same information could have been extracted from the
main log file using the <B
CLASS="COMMAND"
>exigrep</B
> utility:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>exigrep 12EwGE-0005jD-00 /var/log/exim/exim_mainlog</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

That would take longer, especially on a busy system where the log files
can get quite big. The <B
CLASS="COMMAND"
>exigrep</B
> utility comes into its own
when looking for information about more than one message. Its first argument
is a regular expression, and it picks out all the log lines concerned with any
messages that have at least one log line that matches the expression. Thus it
can be used to pick out all messages for one specific address, or all those to
or from a specific host.</P
><P
>You can keep a general watch on what a running Exim is doing by running
<B
CLASS="COMMAND"
>tail</B
> on its main log file. Another way of doing this is to
run the <B
CLASS="COMMAND"
>eximon</B
> utility that comes with Exim. This is an X11
application that puts up a scrolling display of the main log, and also shows
a list of messages that are awaiting delivery, as well as some stripcharts
about delivery activity.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-EXIM.OPTIONS"
>19.5. Miscellaneous config Options</A
></H2
><P
>&#13;Here are a few of the more useful options you can set in the
configuration file:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><EM
>message_size_limit</EM
></DT
><DD
><P
>Setting this option limits the size of message that Exim will accept.</P
></DD
><DT
><EM
>return_size_limit</EM
></DT
><DD
><P
>Setting this option limits the amount of an incoming message that Exim will 
return as part of a bounce message.</P
></DD
><DT
><EM
>deliver_load_max</EM
></DT
><DD
><P
>If the system load exceeds the value given for this option, all mail delivery 
is suspended, though messages are still accepted.</P
></DD
><DT
><EM
>smtp_accept_max</EM
></DT
><DD
><P
>This is the maximum number of simultaneous incoming SMTP calls Exim is prepared
to accept. </P
></DD
><DT
><EM
>log_level</EM
></DT
><DD
><P
>This option controls the amount of material that is written to the log. There 
are also some options with names beginning with <CODE
CLASS="OPTION"
>log&#8201;_</CODE
> that 
control the logging of specific information.</P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-EXIM.DELIVERY"
>19.6. Message Routing and Delivery</A
></H2
><P
>Exim splits up mail delivery into three different tasks: routing,
directing, and transporting. There are a number of code modules of
each type, and each is separately configurable. Usually a number of
different routers, directors, and transports are set up in the
configuration file.</P
><P
>&#13;Routers resolve remote addresses, determining which host the message
should be sent to and which transport should be used. In
Internet-connected hosts there is often just one router, which does
the resolution by looking up the domain in the DNS. Alternatively,
there may be one router that handles addresses destined for hosts on a
local LAN, and a second to send any other addresses to a single
<EM
>smart host</EM
>&#8201;; for example, an ISP's mail server.</P
><P
>&#13;Local addresses are given to the directors, of which there are
normally several, to handle aliasing and forwarding as well as
identifying local mailboxes. Mailing lists can be handled by aliasing
or forwarding directors. If an address gets aliased or forwarded, any
generated addresses are handled independently by the routers or
directors, as necessary. By far the most common case will be delivery
to a mailbox, but messages may also be piped into a command or
appended to a file other than the default mailbox.</P
><P
>&#13;A transport is responsible for implementing a method of delivery; for
example, sending the message over an SMTP connection or adding it to
a specific mailbox. Routers and directors select which transport to
use for each recipient address. If a transport fails, Exim either
generates a bounce message or defers the address for a later retry.</P
><P
>With Exim, you have a lot of freedom in configuring these tasks. For each of 
them, a number of drivers are available, from which you can choose those you 
need. You describe them to Exim in different sections of its configuration 
file. The transports are defined first, followed by the directors, and then 
the routers. There are no built-in defaults, though Exim is distributed with 
a default configuration file that covers simple cases. If you want to change 
Exim's routing policy or modify a transport, it is easiest to start from the 
default configuration and make changes rather than attempt to set up a 
complete configuration from scratch.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-EXIM.ROUTING"
>19.6.1. Routing Messages</A
></H3
><P
>&#13;
When given an address to deliver, Exim first checks whether the domain
is one that is handled on the local host by matching it against a
list in the <TT
CLASS="LITERAL"
>local_domains</TT
> configuration
variable. If this option is not set, the local host name is used as
the only local domain. If the domain is local, the address is handed
to the directors. Otherwise, it is handed to the routers to find out
which host to forward a message to.<A
NAME="X-087-2-FNEX05"
HREF="#FTN.X-087-2-FNEX05"
><SPAN
CLASS="footnote"
>[118]</SPAN
></A
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-EXIM.DIRECTORS"
>19.6.2. Delivering Messages to Local Addresses</A
></H3
><P
>&#13;
Most commonly, a local address is just a user's login name, in which case
the message is delivered to the user's mailbox,
<TT
CLASS="FILENAME"
>/var/spool/mail</TT
>/<TT
CLASS="REPLACEABLE"
><I
>user-name</I
></TT
>.
Other cases include aliases, mailing list names, and mail forwarding by the
user. In these cases, the local address expands to a new list of addresses,
which may be either local or remote.</P
><P
>Apart from these &#8220;normal&#8221; addresses, Exim can handle other
types of local message destinations, like filenames and pipe commands.
When delivering to a file, Exim appends the message, creating the file
if necessary. File and pipe destinations are not addresses in their
own right, so you can't send mail to, say, <SPAN
CLASS="SYSTEMITEM"
>/etc/passwd@vbrew.com</SPAN
> and expect to
overwrite the password file; deliveries to a specific file are valid
only if they come from forwarding or alias files.  Note, however, that
<SPAN
CLASS="SYSTEMITEM"
>/etc/passwd@vbrew.com</SPAN
> is a
syntactically valid email address, but if Exim received it, it would
(typically) search for a user whose login name was <SPAN
CLASS="SYSTEMITEM"
>/etc/passwd</SPAN
>, fail to find one, and
bounce the message.</P
><P
>&#13;
 
In an alias list or forwarding file, a <EM
>filename</EM
> is
anything that begins with a slash (/&#8201;) that does not parse as a fully qualified
email address. For example, <TT
CLASS="FILENAME"
>/tmp/junk</TT
> in a forwarding or
alias file is interpreted as a file name, but
<SPAN
CLASS="SYSTEMITEM"
>/tmp/junk@vbrew.com</SPAN
>
is an email address, though it is not likely to be a very useful one. However, 
valid addresses of this type are seen when sending mail through X.400 gateways,
because X.400 addresses start with a slash.</P
><P
>&#13;
Similarly, a <EM
>pipe command</EM
> may be any Unix command preceded
by the pipe symbol (|), unless the string parses as a valid email address
complete with domain. Unless you have changed the configuration, Exim does not 
use a shell to run the command; instead, it splits it up into a command name, arguments itself, and runs it directly. The message is fed to the command
on its standard input.</P
><P
>For example, to gate a mailing list into a local newsgroup, you might use a
shell script named <B
CLASS="COMMAND"
>gateit</B
>, and set up a local alias that
delivers all messages from this mailing list to the script using
<TT
CLASS="LITERAL"
>|gateit</TT
>. If the command line contains a comma, it and the 
preceding pipe symbol must be enclosed in double quotes. </P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN16247"
>19.6.2.1. Local users</A
></H4
><P
>&#13;
A local address most commonly denotes a user's mailbox. This is normally
located in <TT
CLASS="FILENAME"
>/var/spool/mail</TT
> and has the name of the
user, who also owns the file. If it does not exist, it is created by
Exim. </P
><P
>In some configurations, the group is set to the user's group and the
mode is 0600. In these cases, delivery processes are run as the user,
and the user may delete the mailbox entirely. In other
configurations, the mailbox's group is <SPAN
CLASS="SYSTEMITEM"
>mail</SPAN
>, and it has mode 660; delivery processes 
are run under a system uid and group <SPAN
CLASS="SYSTEMITEM"
>mail</SPAN
>, and users cannot delete their
mailbox files, though they can empty them.</P
><P
>Note that although <TT
CLASS="FILENAME"
>/var/spool/mail</TT
> is currently
the standard place to put the mailbox files, some mail software may be
compiled to use different paths, for example,
<TT
CLASS="FILENAME"
>/usr/spool/mail</TT
>. If delivery to users on your
machine fails consistently, you should see if it helps to make this a
symbolic link to <TT
CLASS="FILENAME"
>/var/spool/mail</TT
>.</P
><P
>The addresses <SPAN
CLASS="SYSTEMITEM"
>MAILER-DAEMON</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>postmaster</SPAN
> should normally
appear in your alias file, expanding into the email address of the
system administrator.  <SPAN
CLASS="SYSTEMITEM"
>MAILER-DAEMON</SPAN
> is used by Exim as the sender
address in bounce messages. It is also recommended that <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
> be set up as an alias for an
administrator, especially when deliveries are being run under the
permissions of the recipient users, in order to avoid running any
delivery as <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
>.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN16269"
>19.6.2.2. Forwarding</A
></H4
><P
>&#13;

Users can redirect their mail to alternative addresses by creating a
<TT
CLASS="FILENAME"
>.forward</TT
> file in their home directories. This contains 
a list of recipients separated by commas and/or newlines.
All lines of the file are read and interpreted. Any type of address may
be used. A practical example of a <TT
CLASS="FILENAME"
>.forward</TT
>
file for vacations might be:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>janet, "|vacation"</PRE
></FONT
></TD
></TR
></TABLE
>

In other descriptions of <TT
CLASS="FILENAME"
>.forward</TT
> files, you might 
see the username at the start preceded by a backslash. This was
necessary in some older MTAs to stop a search for a 
<TT
CLASS="FILENAME"
>.forward</TT
> for the new name, which could lead to 
looping. The backslash is not necessary in Exim, which automatically 
avoids loops of this kind.<A
NAME="AEN16286"
HREF="#FTN.AEN16286"
><SPAN
CLASS="footnote"
>[119]</SPAN
></A
>
However, a backslash is permitted, and in fact it does make a difference 
in configurations where several domains are being handled at once. 
Without a backslash, an unqualified username is qualified with a
default domain; with a backslash the incoming domain is preserved.</P
><P
>The first address in the forward file delivers the incoming message 
to <EM
>janet</EM
>'s mailbox, 
while the <B
CLASS="COMMAND"
>vacation</B
> command returns a short notification to 
the sender.<A
NAME="X-087-2-FNEX07"
HREF="#FTN.X-087-2-FNEX07"
><SPAN
CLASS="footnote"
>[120]</SPAN
></A
></P
><P
>&#13;
In addition to supporting &#8220;traditional&#8221; forwarding files,
Exim can be configured to allow more complex files called
<EM
>filters</EM
>.  Instead of being just a list of
forwarding addresses, a filter file can contain tests on the contents
of the incoming message so that, for example, messages could be
forwarded only if the subject contained the message &#8220;urgent.&#8221; The
system administrator must decide whether to allow users this
flexibility.</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN16302"
>19.6.3. Alias Files</A
></H3
><P
>&#13;




Exim is able to handle alias files compatible with Berkeley's
<B
CLASS="COMMAND"
>sendmail</B
> alias files. Entries in the alias file can have 
the following form:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="REPLACEABLE"
><I
>alias</I
></TT
>: <TT
CLASS="REPLACEABLE"
><I
>recipients</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
><TT
CLASS="REPLACEABLE"
><I
>recipients</I
></TT
> is a comma-separated list of
addresses that will be substituted for the alias. The recipient list
may be continued across newlines if the next line begins with whitespace.</P
><P
>A special feature allows Exim to handle mailing lists that are held
separately from the alias file: if you specify
<TT
CLASS="LITERAL"
>:include:</TT
><TT
CLASS="REPLACEABLE"
><I
>filename</I
></TT
> as a
recipient, Exim reads the specified file and substitutes its contents
as a list of recipients. An alternative to handling mailing lists is
shown later in this chapter in <A
HREF="#X-087-2-EXIM.DIRECTOR.MAILING-LISTS"
>Section 19.6.4</A
>.&#8221;</P
><P
>&#13;The main aliases file is <TT
CLASS="FILENAME"
>/etc/aliases</TT
>. If you
make this file world-writable or group-writeable, Exim will refuse to
use it and will defer local deliveries. You can control the test it
applies to the file's permissions by setting <CODE
CLASS="OPTION"
>modemask</CODE
>
in the <TT
CLASS="FILENAME"
>system_aliases</TT
> director.</P
><P
>This is a sample <TT
CLASS="FILENAME"
>aliases</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># vbrew.com /etc/aliases file
hostmaster: janet
postmaster: janet
usenet: phil
# The development mailing list.
development: joe, sue, mark, biff,
        /var/mail/log/development
owner-development: joe
# Announcements of general interest are mailed to all
# of the staff
announce: :include: /etc/Exim/staff,
        /var/mail/log/announce
owner-announce: root
# gate the ppp mailing list to a local newsgroup
ppp-list: "|/usr/local/bin/gateit local.lists.ppp"</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>When there are file names and pipe commands in an alias file, as here,
Exim needs to be told which userid to run the deliveries under. The
<CODE
CLASS="OPTION"
>user</CODE
> option (and possibly <CODE
CLASS="OPTION"
>group</CODE
>,
too) must be set in Exim's configuration file, either on the director
that is handling the aliases, or on the transports to which it directs
these items.</P
><P
>If an error occurs while delivering to an address generated from the
<TT
CLASS="FILENAME"
>aliases</TT
> file, Exim will send a bounce message to
the sender of the message, as usual, but this might not be
appropriate. The <CODE
CLASS="OPTION"
>errors_to</CODE
> option can be used to
specify that bounce messages are to be sent elsewhere; for example, to
the postmaster.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-EXIM.DIRECTOR.MAILING-LISTS"
>19.6.4. Mailing Lists</A
></H3
><P
>&#13; 

Instead of the <TT
CLASS="FILENAME"
>aliases</TT
> file, mailing lists may
also be managed by means a <TT
CLASS="FILENAME"
>forwardfile</TT
> director. The
lists are all kept in a single directory such as
<TT
CLASS="FILENAME"
>/etc/exim/lists/</TT
>, and a mailing list named
<SPAN
CLASS="SYSTEMITEM"
>nag-bugs</SPAN
> is described by the file
<TT
CLASS="FILENAME"
>lists/nag-bugs</TT
>. This should contain the members'
addresses separated by commas or newlines. Lines beginning with a hash sign
(<TT
CLASS="LITERAL"
>#</TT
>) are treated as comments. A simple director to use such
data is as follows:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>lists:
  driver = forwardfile
  file = /etc/exim/lists/${local_part}
  no_check_local_user
  errors_to = ${local_part}-request</PRE
></FONT
></TD
></TR
></TABLE
>

When this director runs, the values of the <CODE
CLASS="OPTION"
>file</CODE
> and 
<CODE
CLASS="OPTION"
>errors_to</CODE
> options are <EM
>expanded</EM
>. 
Expansion causes certain portions of the strings beginning with dollar 
characters to be replaced every time the string is used. The simplest 
kind of expansion is the insertion of the value of one of Exim's 
variables, and this is what is happening here. The substring 
<TT
CLASS="LITERAL"
>${local_&#8201;part}</TT
> substitutes the value of the 
<TT
CLASS="LITERAL"
>$local_&#8201;part</TT
>, which is the local part of the address 
that is being processed.</P
><P
>For each mailing list, a user (or alias or mailing list) named
<TT
CLASS="REPLACEABLE"
><I
>listname-request</I
></TT
> should exist; any errors
occurring when resolving an address or delivering to a list member are
reported to this address.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN16372"
>19.7. Protecting Against Mail Spam</A
></H2
><P
>&#13;





<CODE
CLASS="OPTION"
>Mail spam</CODE
>, or unsolicited email advertising, is an
annoying problem for many users. A project has been formed to address
this problem called the Mail Abuse Protection System (MAPS), and a
mechanism has been built that reduces the problem, called the Real
Time Blackhole List (RBL).  Information on how the MAPS RBL works can
be obtained from its online documentation at <SPAN
CLASS="SYSTEMITEM"
>http://maps.vix.com/rbl/</SPAN
>. The idea is
simple. Sites that are caught generating mail spam are added into the
database and mail transfer agents like Exim are able to query the
database to confirm that a source is not a spammer before accepting
mail from it.</P
><P
>Since the advent of the RBL, several other similar lists have been
created. One of the most useful is the Dial-Up List (DUL), which lists
the IP addresses of dial-up hosts. These should normally send outgoing
mail only to their ISP's mail servers. Many sites block mail from
external dial-ups because when such a host avoids its own ISP's
server, it is usually up to no good.</P
><P
>Exim provides support for the real-time and other blacklists. It is
very easily configured. To enable it, add the following lines to your
<TT
CLASS="FILENAME"
>/etc/exim.conf</TT
> file:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># Vixie / MAPS RBL (http://maps.vix.com/rbl)
rbl_domains = rbl.maps.vix.com : dul.maps.vix.com</PRE
></FONT
></TD
></TR
></TABLE
><P
>This example checks both the RBL and the DUL, rejecting any messages
from hosts that are on either list. The <CODE
CLASS="OPTION"
>rbl_hosts</CODE
>
option allows you to specify groups of hosts to which RBL checking
does (or does not) apply. The default setting is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>rbl_hosts = *</PRE
></FONT
></TD
></TR
></TABLE
>

which means that all hosts are subject to RBL checking. If you wanted to 
override blacklisting and accept mail from a specific host without 
performing the RBL checking you could, for example, use:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>rbl_hosts = ! nocheck.example.com : *</PRE
></FONT
></TD
></TR
></TABLE
>

The exclamation mark before the first item in this list indicates a 
negated item: if the calling host is 
<SPAN
CLASS="SYSTEMITEM"
>nocheck.example.com</SPAN
>, 
it will match this item. But because of the negation, RBL checking is 
not performed. Any other host matches the second item in the list.&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-EXIM.SIMPLE"
>19.8. UUCP Setup</A
></H2
><P
>&#13;
Exim does not have any specific code for transporting mail via UUCP, nor does 
it support UUCP bang path addresses. However, if domain addressing is being 
used, Exim can be interfaced to UUCP fairly simply. Here is a configuration 
fragment for sending certain domains to UUCP, taken from a real installation:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># Transport
uucp:
  driver = pipe
  user = nobody
  command = "/usr/local/bin/uux -r - \
    ${substr_-5:$host}!rmail ${local_part}"
  return_fail_output = true

# Router
uucphost:
  transport = uucp
  driver = domainlist
  route_file = /usr/exim/uucphosts
  search_type = lsearch</PRE
></FONT
></TD
></TR
></TABLE
><P
>In a complete configuration file, the transport would be inserted
among the other transports, and the router probably defined as the
first router. The file <TT
CLASS="FILENAME"
>/usr/exim/uucphosts</TT
>
contains entries like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>darksite.example.com:           darksite.UUCP</PRE
></FONT
></TD
></TR
></TABLE
>

which is interpreted to mean, &#8220;Send mail addressed to the domain
<EM
>darksite.example.com</EM
> to the
UUCP host <EM
>darksite</EM
>.&#8221;
This configuration could be set up more simply without the router
adding the suffix .UUCP to <EM
>darksite</EM
> only to have the transport take
it off again, but this way is useful because it makes clear the distinction between the
domain name <EM
>darksite.example.com</EM
> and the UUCP host
name <EM
>darksite</EM
>.</P
><P
>Whenever the router comes across a domain that is in the route file,
it will send the address to the UUCP transport, which subsequently pipes it to the
<B
CLASS="COMMAND"
>uux</B
> command (described in <A
HREF="#X-087-2-UUCP"
>Chapter 16</A
>). If there is a problem,
<B
CLASS="COMMAND"
>uux</B
> will generate some output and terminate with a
non-zero error code. The setting of
<TT
CLASS="LITERAL"
>return_fail_output</TT
> makes sure that the output is
returned to the sender.</P
><P
>If incoming UUCP messages are grouped into files in batched SMTP
format, they can be passed directly to Exim using a command like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>exim -bS &#60;/var/uucp/incoming/001</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>However, there is one catch. When Exim receives a message locally, it
insists that the sender is the logged-in user that calls it, but for a
UUCP batch we want the senders to be taken from the incoming
messages. Exim will do this if the process that calls it is running as
a <EM
>trusted user</EM
>. If you arrange for incoming UUCP
to be handled by a user called <SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
>, for example, you need to specify:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>trusted_users = uucp</PRE
></FONT
></TD
></TR
></TABLE
>

in the Exim configuration file to ensure that sender addresses are correctly 
handled.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-NEWS"
></A
>Chapter 20. Netnews</H1
><P
>&#13;Netnews, or Usenet news, remains one of the most important and highly
valued services on computer networks today. Dismissed by some as a
mire of unsolicited commercial email and pornography, Netnews still
maintains several cases of the high-quality discussion groups that
made it a critical resource in pre-web days. Even in these times of a
billion web pages, Netnews is still a source for online help and
community on many topics.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NEWS.HISTORY"
>20.1. Usenet History</A
></H2
><P
>&#13;The idea of network news was born in 1979 when two graduate students, Tom
Truscott and Jim Ellis, thought of using UUCP to connect machines for 
information exchange among Unix users. They set up
a small network of three machines in North Carolina.</P
><P
>Initially, traffic was handled by a number of shell scripts (later
rewritten in C), but they were never released to the public. They
were quickly replaced by &#8220;A News,&#8221; the first public release of news
software.</P
><P
>A News was not designed to handle more than a few articles
per group and day. When the volume continued to grow, it was rewritten
by Mark Horton and Matt Glickman, who called it the &#8220;B&#8221; release
(a.k.a. B News). The first public release of B News was version 2.1
in 1982. It was expanded continuously, with several new features 
added. Its current version is B News 2.11. It is slowly
becoming obsolete; its last official maintainer switched to
INN.</P
><P
>&#13;

Geoff Collyer and Henry Spencer rewrote B News and released it in 1987; this 
is release &#8220;C,&#8221; or C News. Since its release, there
have been a number of patches to C News, the most prominent being the
C News Performance Release. On sites that carry a large number of groups,
the overhead involved in frequently invoking <B
CLASS="COMMAND"
>relaynews</B
>,
which is responsible for dispatching incoming articles to other hosts, is
significant. The Performance Release adds an option to
<B
CLASS="COMMAND"
>relaynews</B
> that allows it to run in
<EM
>daemon mode</EM
>, through which the program puts
itself in the background. The Performance Release is the C News version
currently included in most Linux releases. We describe C News in detail in
<A
HREF="#X-087-2-CNEWS"
>Chapter 21</A
>.</P
><P
>&#13; 
All news releases up to C were primarily targeted for UUCP networks,
although they could be used in other environments, as well. Efficient news
transfer over networks like TCP/IP or DECNet required a new scheme. So in
1986, the <EM
>Network News Transfer Protocol</EM
> (NNTP) was
introduced. It is based on network connections and specifies a number of
commands to interactively transfer and retrieve articles.</P
><P
> 
There are a number of NNTP-based applications available from the Net. One of
them is the <B
CLASS="COMMAND"
>nntpd</B
> package by Brian Barber and Phil Lapsley,
which you can use to provide newsreading service to a number of hosts inside a
local network. <B
CLASS="COMMAND"
>nntpd</B
> was designed to complement news
packages, such as B News or C News, to give them NNTP features. If you want
to use NNTP with the C News server, you should read
<A
HREF="#X-087-2-NNTP"
>Chapter 22</A
>, which explains how to configure the
<B
CLASS="COMMAND"
>nntpd</B
> daemon and run it with C News.</P
><P
>&#13; 
An alternative package supporting NNTP is INN, or
<EM
>Internet News</EM
>. It is not just a frontend, but a news
system in its own right. It comprises a sophisticated news relay daemon that
can maintain several concurrent NNTP links efficiently, and is therefore the
news server of choice for many Internet sites. We discuss it in detail in
<A
HREF="#X-087-2-INN"
>Chapter 23</A
>.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NEWS.USENET"
>20.2. What Is Usenet, Anyway?</A
></H2
><P
>&#13;



One of the most astounding facts about Usenet is that it isn't part of
any organization, nor does it have any sort of centralized network management
authority. In fact, it's part of Usenet lore that except for a technical
description, you cannot define <EM
>what</EM
> it is; at the risk of sounding stupid, one might define Usenet as a collaboration
of separate sites that exchange Usenet news. To be a Usenet site, all you
have to do is find another Usenet site and strike an agreement with its
owners and maintainers to exchange news with you. Providing another site
with news is called <EM
>feeding</EM
> it, whence another
common axiom of Usenet philosophy originates: &#8220;Get a feed, and you're
on it.&#8221;</P
><P
>&#13; 
The basic unit of Usenet news is the
<EM
>article</EM
>. This is a message a user writes and
&#8220;posts&#8221; to the net. In order to enable news systems to
deal with it, it is prepended with administrative information, the
so-called article header. It is very similar to the mail header format
laid down in the Internet mail standard RFC-822, in that it consists
of several lines of text, each beginning with a field name terminated
by a colon, which is followed by the field's value.<A
NAME="X-087-2-FNUN01"
HREF="#FTN.X-087-2-FNUN01"
><SPAN
CLASS="footnote"
>[121]</SPAN
></A
>&#13;</P
><P
>&#13; 
Articles are submitted to one or more <EM
>newsgroup</EM
>. One may
consider a newsgroup a forum for articles relating to a common topic. All
newsgroups are organized in a hierarchy, with each group's name indicating
its place in the hierarchy. This often makes it easy to see what a group is
all about. For example, anybody can see from the newsgroup name that
<SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.announce</SPAN
> is used for
announcements concerning a computer operating system named Linux.</P
><P
>&#13;
These articles are then exchanged between all Usenet sites that are
willing to carry news from this group.  When two sites agree to exchange
news, they are free to exchange whatever newsgroups they like, and
may even add their own local news hierarchies. For example,
<SPAN
CLASS="SYSTEMITEM"
>groucho.edu</SPAN
> might have a news link
to <SPAN
CLASS="SYSTEMITEM"
>barnyard.edu</SPAN
>, which
is a major news feed, and several links to minor sites which it feeds
news. Now Barnyard College might receive all Usenet groups, while GMU
only wants to carry a few major hierarchies like
<SPAN
CLASS="SYSTEMITEM"
>sci</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>comp</SPAN
>, or 
<SPAN
CLASS="SYSTEMITEM"
>rec</SPAN
>. Some of the downstream
sites, say a UUCP site called <SPAN
CLASS="SYSTEMITEM"
>brewhq</SPAN
>,
will want to carry even fewer groups, because they don't have the network or
hardware resources. On the other hand,
<SPAN
CLASS="SYSTEMITEM"
>brewhq</SPAN
> might want to receive
newsgroups from the <SPAN
CLASS="SYSTEMITEM"
>fj</SPAN
>
hierarchy, which GMU doesn't carry. It therefore maintains another link
with <SPAN
CLASS="SYSTEMITEM"
>gargleblaster.com</SPAN
>, which carries
all <SPAN
CLASS="SYSTEMITEM"
>fj</SPAN
> groups and feeds
them to <SPAN
CLASS="SYSTEMITEM"
>brewhq</SPAN
>. The news flow is
shown in <A
HREF="#X-087-2-NEWS.FIG.ARTICLE-FLOW"
>Figure 20-1</A
>.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-NEWS.FIG.ARTICLE-FLOW"
></A
><P
><B
>Figure 20-1. Usenet newsflow through Groucho Marx University</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_2001.jpg"></P
></DIV
></DIV
><P
>The labels on the arrows originating from
<SPAN
CLASS="SYSTEMITEM"
>brewhq</SPAN
> may require some explanation,
though.  By default, it wants all locally generated news to be sent to
<SPAN
CLASS="SYSTEMITEM"
>groucho.edu</SPAN
>.  However, as
<SPAN
CLASS="SYSTEMITEM"
>groucho.edu</SPAN
> does not carry the
<SPAN
CLASS="SYSTEMITEM"
>fj</SPAN
> groups, there's no point in
sending it any messages from those groups. Therefore, the feed from
<SPAN
CLASS="SYSTEMITEM"
>brewhq</SPAN
> to GMU is labeled
<TT
CLASS="LITERAL"
>all,!fj</TT
>, meaning that all groups
except those below <SPAN
CLASS="SYSTEMITEM"
>fj</SPAN
> are sent to it.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NEWS.ALGORITHM"
>20.3. How Does Usenet Handle News?</A
></H2
><P
>&#13;


Today, Usenet has grown to enormous proportions. Sites that carry the
whole of Netnews usually transfer something like a paltry 60 MB a day.<A
NAME="X-087-2-FNUN02"
HREF="#FTN.X-087-2-FNUN02"
><SPAN
CLASS="footnote"
>[122]</SPAN
></A
> Of course, this requires much
more than pushing files around. So let's take a look at the way most Unix
systems handle Usenet news.</P
><P
> 
News begins when users create and post articles. Each user enters a 
message into a special application called a newsreader, which 
formats it appropriately for transmission to the local 
news server. In Unix environments the newsreader commonly uses the 
<B
CLASS="COMMAND"
>inews</B
> command to transmit articles to the 
newsserver using the TCP/IP protocol. But it's also possible to 
write the article directly into a file in a special directory called 
the news spool. Once the posting is delivered to the local 
news server, it takes responsibility for delivering the article to 
other news users.</P
><P
>&#13;News is distributed through the net by various transports. The medium used to be UUCP, but today the main traffic is carried by Internet
sites. The routing algorithm used is called <EM
>flooding</EM
>.
Each site maintains a number of links (<EM
>news feeds</EM
>) to
other sites. Any article generated or received by the local news system is
forwarded to them, unless it has already been at that site, in which case it
is discarded. A site may find out about all other sites the article has
already traversed by looking at the <TT
CLASS="LITERAL"
>Path:</TT
> header field. This
header contains a list of all systems through which the article has been 
forwarded in bang path notation.</P
><P
>&#13;
To distinguish articles and recognize duplicates, Usenet articles have
to carry a message ID (specified in the <TT
CLASS="LITERAL"
>Message-Id:</TT
> header
field), which combines the posting site's name and a serial number into
&#60;<TT
CLASS="REPLACEABLE"
><I
>serial</I
></TT
>@<TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
>&#8201;&#62;.
For each article processed, the news system logs this ID into a
<EM
>history</EM
> file, against which all newly arrived articles
are checked.</P
><P
>&#13;
The flow between any two sites may be limited by two criteria. For one,
an article is assigned a distribution (in the <TT
CLASS="LITERAL"
>Distribution:</TT
>
header field), which may be used to confine it to a certain group of
sites. On the other hand, the newsgroups exchanged may be limited by
both the sending and receiving systems.  The set of newsgroups and
distributions allowed to be transmitted to a site are usually kept in the
<TT
CLASS="FILENAME"
>sys</TT
> file.</P
><P
>&#13;

The sheer number of articles usually requires that improvements be made
to the above scheme. On UUCP networks, systems collect articles over a period 
of time and combine them into a single file, which is compressed and sent to 
the remote site. This is called
<EM
>batching</EM
>.</P
><P
>&#13; 
An alternative technique is the <EM
>ihave/sendme</EM
> protocol that
prevents duplicate articles from being transferred,
thus saving net bandwidth. Instead of putting all articles in batch
files and sending them along, only the message IDs of articles are
combined into a giant &#8220;ihave&#8221; message and sent to the remote
site. The remote site reads this message, compares it to its history file,
and returns the list of articles it wants in a &#8220;sendme&#8221; message.
Only the requested articles are sent.</P
><P
>Of course, ihave/sendme makes sense only if it involves two big sites
that receive news from several independent feeds each, and that poll each
other often enough for an efficient flow of news.</P
><P
>&#13;Sites that are on the Internet generally rely on TCP/IP-based software that
uses the Network News Transfer Protocol (NNTP). NNTP is described in RFC-977; 
it is responsible for the transfer of news between news servers and provides
Usenet access to single users on remote hosts.</P
><P
>&#13;
NNTP knows three different ways to transfer news. One is a real-time version
of ihave/sendme, also referred to as <EM
>pushing</EM
> news. The
second technique is called <EM
>pulling</EM
> news, in which the
client requests a list of articles in a given newsgroup or hierarchy that have
arrived at the server's site after a specified date, and chooses those it
cannot find in its history file. The third technique is for interactive 
newsreading and allows you or your newsreader to retrieve articles from 
specified newgroups, as well as post articles with incomplete header 
information. </P
><P
>&#13;
At each site, news is kept in a directory hierarchy below
<TT
CLASS="FILENAME"
>/var/spool/news</TT
>, each article in a separate file, and
each newsgroup in a separate directory. The directory name is made up of the
newsgroup name, with the components being the path components. Thus,
<SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.misc</SPAN
> articles are kept
in <TT
CLASS="FILENAME"
>/var/spool/news/comp/os/linux/misc</TT
>. The articles in a
newsgroup are assigned numbers in the order they arrive. This number serves as
the file's name. The range of numbers of articles currently online is kept
in a file called <TT
CLASS="FILENAME"
>active</TT
>, which at the same time serves
as a list of newsgroups your site knows.</P
><P
>&#13;
Since disk space is a finite resource, you have to start throwing away
articles after some time.<A
NAME="X-087-2-FNUN03"
HREF="#FTN.X-087-2-FNUN03"
><SPAN
CLASS="footnote"
>[123]</SPAN
></A
> This is called
<EM
>expiring</EM
>. Usually, articles from certain groups and
hierarchies are expired at a fixed number of days after they arrive. This
may be overridden by the poster by specifying a date of expiration in the
<TT
CLASS="LITERAL"
>Expires:</TT
> field of the article header.&#13;</P
><P
>You now have enough information to choose what to read next. UUCP users 
should read about C-News in <A
HREF="#X-087-2-CNEWS"
>Chapter 21</A
>. If you're using 
a TCP/IP network, read about NNTP in <A
HREF="#X-087-2-NNTP"
>Chapter 22</A
>. If you 
need to transfer moderate amounts of news over TCP/IP, the server described 
in that chapter may be enough for you. To install a heavy-duty news server 
that can handle huge volumes of material, go on to read about InterNet News 
in <A
HREF="#X-087-2-INN"
>Chapter 23</A
>.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-CNEWS"
></A
>Chapter 21. C News</H1
><P
>One of the most popular software packages for Netnews is C News. It was
designed for sites that carry news over UUCP links. This chapter
will discuss the central concepts of C News, basic installation,
and maintenance tasks.</P
><P
>&#13;
C News stores its configuration files in
<TT
CLASS="FILENAME"
>/etc/news</TT
>, and most of its binaries are kept
below the <TT
CLASS="FILENAME"
>/usr/lib/news/</TT
> directory.  Articles are
kept below <TT
CLASS="FILENAME"
>/var/spool/news</TT
>.  You should make sure
that virtually all files in these directories are owned by user
<SPAN
CLASS="SYSTEMITEM"
>news</SPAN
> or group <SPAN
CLASS="SYSTEMITEM"
>news</SPAN
>. Most problems arise from files being
inaccessible to C News. Use <B
CLASS="COMMAND"
>su</B
> to become the user
<SPAN
CLASS="SYSTEMITEM"
>news</SPAN
> before you touch anything
in the directory.  The only exception is the
<B
CLASS="COMMAND"
>setnewsids</B
> command, which is used to set the real
user ID of some news programs. It must be owned by <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
> and have the setuid bit set.</P
><P
>In this chapter, we describe all C News configuration files in detail
and show you what you have to do to keep your site running.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-CNEWS.RNEWS"
>21.1. Delivering News</A
></H2
><P
>&#13;
 
 
 

Articles can be fed to C News in several ways. When a local user posts
an article, the newsreader usually hands it to the
<B
CLASS="COMMAND"
>inews</B
> command, which completes the header
information. News from remote sites, be it a single article or a whole
batch, is given to the <B
CLASS="COMMAND"
>rnews</B
> command, which stores
it in the <TT
CLASS="FILENAME"
>/var/spool/news/in.coming</TT
> directory,
from where it will be picked up at a later time by
<B
CLASS="COMMAND"
>newsrun</B
>. With any of these two techniques, however,
the article will eventually be handed to the
<B
CLASS="COMMAND"
>relaynews</B
> command.</P
><P
>&#13;





For each article, the <B
CLASS="COMMAND"
>relaynews</B
> command first checks if the
article has already been seen at the local site by looking up the message ID
in the <TT
CLASS="FILENAME"
>history</TT
> file. Duplicate articles are dropped.
Then <B
CLASS="COMMAND"
>relaynews</B
> looks at the <TT
CLASS="LITERAL"
>Newsgroups:</TT
>
header line to find out if the local site requests articles from any of these
groups.  If it does, and the newsgroup is listed in the
<TT
CLASS="FILENAME"
>active</TT
> file, <B
CLASS="COMMAND"
>relaynews</B
> tries to store
the article in the corresponding directory in the news spool area. If this
directory does not exist, it is created. The article's message ID is then 
logged to the <TT
CLASS="FILENAME"
>history</TT
> file.  Otherwise,
<B
CLASS="COMMAND"
>relaynews</B
> drops the article.</P
><P
>&#13;Sometimes <B
CLASS="COMMAND"
>relaynews</B
> fails to store an incoming
article because a group to which it has been posted is not listed in
your <TT
CLASS="FILENAME"
>active</TT
> file. In this case, the article is moved to the <SPAN
CLASS="SYSTEMITEM"
>junk</SPAN
>
group.<A
NAME="X-087-2-FNCN01"
HREF="#FTN.X-087-2-FNCN01"
><SPAN
CLASS="footnote"
>[124]</SPAN
></A
>
<B
CLASS="COMMAND"
>relaynews</B
> also checks for stale or misdated articles
and reject them. Incoming batches that fail for any other reason are moved
to <TT
CLASS="FILENAME"
>/var/spool/news/in.coming/bad</TT
>, and an error message
is logged.</P
><P
>After this, the article is relayed to all other sites that request news
from these groups, using the transport specified for each particular site. To
make sure an article isn't sent to a site that has already seen it, each
destination site is checked against the article's <TT
CLASS="LITERAL"
>Path:</TT
>
header field, which contains the list of sites the article has traversed so
far, written in the UUCP-style bang-path source-routing style described in
<A
HREF="#X-087-2-MAIL"
>Chapter 17</A
>. If the destination site's name does not
appear in this list, the article is sent to it.</P
><P
>&#13;
C News is commonly used to relay news between UUCP sites, although it is
also possible to use it in an NNTP environment. To deliver news to a remote
UUCP site, either in single articles or whole batches, <B
CLASS="COMMAND"
>uux</B
>
is used to execute the <B
CLASS="COMMAND"
>rnews</B
> command on the remote site and
feed the article or batch to it on standard input.
Refer to <A
HREF="#X-087-2-UUCP"
>Chapter 16</A
>, for more information on UUCP.</P
><P
>&#13;
Batching is the term used to describe sending large bundles of
individual articles all in one transmission. When batching is
enabled for a given site, C News does not send any incoming article
immediately; instead, it appends its path name to a file, usually called
<TT
CLASS="FILENAME"
>out.going/site/togo</TT
>. Periodically, a program is executed
from a <B
CLASS="COMMAND"
>crontab</B
> entry by the <B
CLASS="COMMAND"
>cron</B
> program,
which reads this file and bundles all of the listed articles into one or more
file, optionally compressing them and sending them to <B
CLASS="COMMAND"
>rnews</B
>
at the remote site.<A
NAME="X-087-2-FNCN02"
HREF="#FTN.X-087-2-FNCN02"
><SPAN
CLASS="footnote"
>[125]</SPAN
></A
>&#13;</P
><P
><A
HREF="#X-087-2-CNEWS.FIG.FLOW"
>Figure 21-1</A
> shows the news flow through
<B
CLASS="COMMAND"
>relaynews</B
>. Articles may be relayed to the local site
(denoted by <SPAN
CLASS="SYSTEMITEM"
>ME</SPAN
>), to a site named
<SPAN
CLASS="SYSTEMITEM"
>ponderosa</SPAN
> via email, and a site
named <SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
>, for which batching is
enabled.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-CNEWS.FIG.FLOW"
></A
><P
><B
>Figure 21-1. News flow through relaynews</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_2101.jpg"></P
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN16782"
>21.2. Installation</A
></H2
><P
>&#13;
 
C News should be available in a prepackaged format for any modern Linux
distribution, so installation will be easy. If not, or if you want to
install from the original source distribution, then of course you
can.<A
NAME="X-087-2-FNCN03"
HREF="#FTN.X-087-2-FNCN03"
><SPAN
CLASS="footnote"
>[126]</SPAN
></A
> No matter how you install it, you will need to edit the C
News configuration files. Their formats are described in the following
list:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="FILENAME"
>sys</TT
></DT
><DD
><P
>&#13;The <TT
CLASS="FILENAME"
>sys</TT
> file controls which newsgroups your site
receives and forwards. We discuss it in detail in the following
section.</P
></DD
><DT
><TT
CLASS="FILENAME"
>active</TT
></DT
><DD
><P
>Not usually edited by the administration; contains directions for handling 
articles in each newsgroup the site handles.&#13;</P
></DD
><DT
><TT
CLASS="FILENAME"
>organization</TT
></DT
><DD
><P
>This file should contain your organization's name, for example,
&#8220;Virtual Brewery, Inc.&#8221; On your home machine, enter
&#8220;private site,&#8221; or anything else you like. Most people
will not consider your site properly configured if you haven't customized
this file.</P
></DD
><DT
><TT
CLASS="FILENAME"
>newsgroups</TT
></DT
><DD
><P
>This file is a list of all newsgroups, with a one-line description of each
one's purpose. These descriptions are frequently used by your newsreader
when displaying the list of all groups to which you are subscribed.</P
></DD
><DT
><TT
CLASS="FILENAME"
>mailname</TT
></DT
><DD
><P
>Your site's mail name, e.g., <SPAN
CLASS="SYSTEMITEM"
>vbrew.com</SPAN
>.</P
></DD
><DT
><TT
CLASS="FILENAME"
>whoami</TT
></DT
><DD
><P
>Your site's name for news purposes. Quite often, the UUCP site name is used,
e.g., <SPAN
CLASS="SYSTEMITEM"
>vbrew</SPAN
>.</P
></DD
><DT
><TT
CLASS="FILENAME"
>explist</TT
></DT
><DD
><P
>You should probably edit this file to reflect your preferred expiration times
for special newsgroups. Disk space may play an important role in your choices.</P
></DD
></DL
></DIV
><P
>&#13;
To create an initial hierarchy of newsgroups, obtain 
<TT
CLASS="FILENAME"
>active</TT
> and <TT
CLASS="FILENAME"
>newsgroups</TT
> files
from the site that feeds you. Install them in <TT
CLASS="FILENAME"
>/etc/news</TT
>,
making sure they are owned by <SPAN
CLASS="SYSTEMITEM"
>news</SPAN
> and
have a mode of 644, using the <B
CLASS="COMMAND"
>chmod</B
> command. Remove all
<SPAN
CLASS="SYSTEMITEM"
>to.*</SPAN
> groups from the active file,
and add <SPAN
CLASS="SYSTEMITEM"
>to.my-site</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>to.feed-site</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>junk</SPAN
>, and
<SPAN
CLASS="SYSTEMITEM"
>control</SPAN
>. The
<SPAN
CLASS="SYSTEMITEM"
>to.*</SPAN
> groups are normally used for
exchanging ihave/sendme messages, but you should list them regardless of
whether you plan to use ihave/sendme or not. Next, replace all article
numbers in the second and third field of <TT
CLASS="FILENAME"
>active</TT
> using
the following commands:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>cp active active.old</KBD
>
# <KBD
CLASS="USERINPUT"
>sed 's/ [0-9]* [0-9]* / 0000000000 00001 /' active.old &#62; active</KBD
>
# <KBD
CLASS="USERINPUT"
>rm active.old</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
> 
The second command invokes the <B
CLASS="COMMAND"
>sed</B
> stream
editor. This invocation replaces two strings of digits with a string of
zeroes and the string <TT
CLASS="LITERAL"
>000001</TT
>, respectively.</P
><P
>Finally, create the news spool directory and the subdirectories used for
incoming and outgoing news:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>cd /var/spool</KBD
>
# <KBD
CLASS="USERINPUT"
>mkdir news news/in.coming news/out.going news/out.master</KBD
>
# <KBD
CLASS="USERINPUT"
>chown -R news.news news</KBD
>
# <KBD
CLASS="USERINPUT"
>chmod -R 755 news</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>If you're using precompiled newsreaders sourced from a different
distribution to the C News server you have running, you may find that
some expect the news spool in <TT
CLASS="FILENAME"
>/usr/spool/news</TT
>
rather than <TT
CLASS="FILENAME"
>/var/spool/news</TT
>. If your newsreader
doesn't seem to find any articles, create a symbolic link from
<TT
CLASS="FILENAME"
>/usr/spool/news</TT
> to
<TT
CLASS="FILENAME"
>/var/spool/news</TT
> like this:
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>ln -sf /usr/spool/news /var/spool/news</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Now you are ready to receive news. Note that you don't have to create the
individual newsgroup spool directories. C News automatically creates
spool directories for any newsgroup it receives an article for, if one doesn't
already exist.</P
><P
>In particular, this happens to <EM
>all</EM
> groups to which an 
article has been cross-posted. So, after a while, you will find your news spool
cluttered with directories for newsgroups you have never subscribed
to, like <SPAN
CLASS="SYSTEMITEM"
>alt.lang.teco</SPAN
>. You may
prevent this by either removing all unwanted groups from
<TT
CLASS="FILENAME"
>active</TT
>, or by regularly running a shell script that 
removes all empty directories below <TT
CLASS="FILENAME"
>/var/spool/news</TT
>
(except <TT
CLASS="FILENAME"
>out.going</TT
> and <TT
CLASS="FILENAME"
>in.coming</TT
>,
of course).</P
><P
>&#13;


C News needs a user to send error messages and status reports to. By
default, this is <SPAN
CLASS="SYSTEMITEM"
>usenet</SPAN
>. If you
use the default, you have to set up an alias for it that forwards all
of its mail to one or more responsible person. You may also override
this behavior by setting the environment variable <SPAN
CLASS="SYSTEMITEM"
>NEWSMASTER</SPAN
> to the appropriate name. You
have to do so in <SPAN
CLASS="SYSTEMITEM"
>news</SPAN
>'s
<TT
CLASS="FILENAME"
>crontab</TT
> file, as well as every time you invoke an
administrative tool manually, so installing an alias is probably
easier. Mail aliases are described in <A
HREF="#X-087-2-SENDMAIL"
>Chapter 18</A
>, and <A
HREF="#X-087-2-EXIM"
>Chapter 19</A
>.</P
><P
>&#13;

While you're hacking <TT
CLASS="FILENAME"
>/etc/passwd</TT
>, make sure that every
user has her real name in the <SPAN
CLASS="SYSTEMITEM"
>pw_gecos</SPAN
>
field of the password file (this is the fourth field). It is a question of
Usenet netiquette that the sender's real name appears in the
<TT
CLASS="LITERAL"
>From:</TT
> field of the article. Of course, you will want to
do so anyway when you use mail.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-CNEWS.SYS"
>21.3. The sys File</A
></H2
><P
>&#13;
The <TT
CLASS="FILENAME"
>sys</TT
> file, located in
<TT
CLASS="FILENAME"
>/etc/news</TT
>, controls which hierarchies you receive
and forward to other sites. Although there are maintenance tools named
<B
CLASS="COMMAND"
>addfeed</B
> and <B
CLASS="COMMAND"
>delfeed</B
>, we think
it's better to maintain this file by hand.</P
><P
>The <TT
CLASS="FILENAME"
>sys</TT
> file contains entries for each site to
which you forward news, as well as a description of the groups you
will accept. The first line is a
<SPAN
CLASS="SYSTEMITEM"
>ME</SPAN
> entry that describes your
system. It's a safe bet to use the following:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ME:all/all::</PRE
></FONT
></TD
></TR
></TABLE
>

You also have to add a line for each site to which you feed news.
Each line looks like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
>[/<TT
CLASS="REPLACEABLE"
><I
>exclusions</I
></TT
>]:<TT
CLASS="REPLACEABLE"
><I
>grouplist</I
></TT
>[/<TT
CLASS="REPLACEABLE"
><I
>distlist</I
></TT
>][:<TT
CLASS="REPLACEABLE"
><I
>flags</I
></TT
>[:<TT
CLASS="REPLACEABLE"
><I
>cmds</I
></TT
>]]</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Entries may be continued across newlines using a backslash
(<SPAN
CLASS="SYSTEMITEM"
>\</SPAN
>) at the end of the line to be
continued. A hash sign (<SPAN
CLASS="SYSTEMITEM"
>#</SPAN
>) denotes a
comment.</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
></DT
><DD
><P
>This is the name of the site the entry applies to. One usually
chooses the site's UUCP name for this.  There has to be an entry
for your site in the <TT
CLASS="FILENAME"
>sys</TT
> file too, or you will not
receive any articles yourself.</P
><P
>&#13;

The special site name <SPAN
CLASS="SYSTEMITEM"
>ME</SPAN
> denotes your
site. The <SPAN
CLASS="SYSTEMITEM"
>ME</SPAN
> entry defines all groups
you are willing to store locally. Articles that aren't matched by the
<SPAN
CLASS="SYSTEMITEM"
>ME</SPAN
> line will go to the
<SPAN
CLASS="SYSTEMITEM"
>junk</SPAN
> group.</P
><P
>&#13;

C News rejects any articles that have already passed through this site to
prevent loops. C News does this by ensuring that the local site name does not
appear in the <TT
CLASS="LITERAL"
>Path:</TT
> of the article. Some sites may be known
by a number of valid names. For example, some sites use their fully qualified
domain name in this field, or an alias like
<TT
CLASS="LITERAL"
>news.</TT
><TT
CLASS="REPLACEABLE"
><I
>site.domain</I
></TT
>. To ensure the
loop prevention mechanism works, it is important to add all aliases to the 
exclusion list, separating them by commas.</P
><P
>For the entry applying to site <SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
>,
for instance, the <TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
> field would contain
<SPAN
CLASS="SYSTEMITEM"
>moria/moria.orcnet.org</SPAN
>. If
<SPAN
CLASS="SYSTEMITEM"
>moria</SPAN
> were also by an alias of
<SPAN
CLASS="SYSTEMITEM"
>news.orcnet.org</SPAN
>, then our
<TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
> field would contain
<SPAN
CLASS="SYSTEMITEM"
>moria/moria.orcnet.org,news.orcnet.org</SPAN
>.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>grouplist</I
></TT
></DT
><DD
><P
>&#13;
This is a comma-separated subscription list of groups and hierarchies
for this particular site. A hierarchy may be specified by giving the
hierarchy's prefix (such as <SPAN
CLASS="SYSTEMITEM"
>comp.os</SPAN
> for all groups whose names start
with this prefix), optionally followed by the keyword <SPAN
CLASS="SYSTEMITEM"
>all</SPAN
> (e.g., <SPAN
CLASS="SYSTEMITEM"
>comp.os.all</SPAN
>&#8201;).</P
><P
>You can exclude a hierarchy or group from forwarding by preceding it with an
exclamation mark. If a newsgroup is checked against the list, the longest
match applies. For example, if <TT
CLASS="REPLACEABLE"
><I
>grouplist</I
></TT
>
contains this list:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>!comp,comp.os.linux,comp.folklore.computers</PRE
></FONT
></TD
></TR
></TABLE
>

no groups from the <SPAN
CLASS="SYSTEMITEM"
>comp</SPAN
> hierarchy
except <SPAN
CLASS="SYSTEMITEM"
>comp.folklore.computers</SPAN
> and
all groups below <SPAN
CLASS="SYSTEMITEM"
>comp.os.linux</SPAN
> will
be fed to that site.</P
><P
>If the site requests to be forwarded all news you receive yourself, enter
<SPAN
CLASS="SYSTEMITEM"
>all</SPAN
> as
<TT
CLASS="REPLACEABLE"
><I
>grouplist</I
></TT
>.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>distlist</I
></TT
></DT
><DD
><P
>&#13;
This value is offset from the <TT
CLASS="REPLACEABLE"
><I
>grouplist</I
></TT
> by
a slash and contains a list of distributions to be forwarded. Again,
you may exclude certain distributions by preceding them with an
exclamation mark. All distributions are denoted by <SPAN
CLASS="SYSTEMITEM"
>all</SPAN
>.  Omitting
<TT
CLASS="REPLACEABLE"
><I
>distlist</I
></TT
> implies a list of <SPAN
CLASS="SYSTEMITEM"
>all</SPAN
>.</P
><P
>For example, you may use a distribution list of
<SPAN
CLASS="SYSTEMITEM"
>all,!local</SPAN
> to prevent news meant only 
for local use from being sent to remote sites.</P
><P
>There are usually at least two distributions:
<SPAN
CLASS="SYSTEMITEM"
>world</SPAN
>, which is often the default
distribution used when none is specified by the user, and
<SPAN
CLASS="SYSTEMITEM"
>local</SPAN
>. There may be other
distributions that apply to a certain region, state, country,
etc. Finally, there are two distributions used by C News only;
these are <SPAN
CLASS="SYSTEMITEM"
>sendme</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>ihave</SPAN
>, and are used for
the sendme/ihave protocol.</P
><P
>The use of distributions is a subject of debate. The distribution
field in a news article can be created arbitrarily, but for a
distribution to be effective, the news servers in the network must
know it. Some misbehaving newsreaders create bogus distributions by
simply assuming the top-level newsgroup hierarchy of the article
destination is a reasonable distribution.  For example, one might
assume <SPAN
CLASS="SYSTEMITEM"
>comp</SPAN
> to be a
reasonable distribution to use when posting to the <SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.networking</SPAN
>
newsgroup. Distributions that apply to regions are often questionable,
too, because news may travel outside of your region when sent across
the Internet.<A
NAME="X-087-2-FNCN04"
HREF="#FTN.X-087-2-FNCN04"
><SPAN
CLASS="footnote"
>[127]</SPAN
></A
>
Distributions applying to an organization, however, are
very meaningful; e.g., to prevent confidential information from
leaving the company network.  This purpose, however, is generally
served better by creating a separate newsgroup or hierarchy.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>flags</I
></TT
></DT
><DD
><P
>This option describes certain parameters for the feed. It may be
empty or a combination of the following:

 <P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>F</TT
></DT
><DD
><P
>&#13; This flag enables batching.
 </P
></DD
><DT
><TT
CLASS="LITERAL"
>f</TT
></DT
><DD
><P
>&#13; This is almost identical to the <TT
CLASS="LITERAL"
>F</TT
> flag,
 but allows C News to calculate the size of outgoing batches more precisely,
 and should probably be used in preference.
 </P
></DD
><DT
><TT
CLASS="LITERAL"
>I</TT
></DT
><DD
><P
>&#13; This flag makes C News produce an article list suitable
 for use by ihave/sendme. Additional modifications to the
 <TT
CLASS="FILENAME"
>sys</TT
> and the <TT
CLASS="FILENAME"
>batchparms</TT
> file are
 required to enable ihave/sendme.
 </P
></DD
><DT
><TT
CLASS="LITERAL"
>n</TT
></DT
><DD
><P
>&#13; This creates batch files for active NNTP transfer clients like
 <B
CLASS="COMMAND"
>nntpxmit</B
> (see <A
HREF="#X-087-2-NNTP"
>Chapter 22</A
>).
 The batch files contain the article's filename along with its message ID.
 </P
></DD
><DT
><TT
CLASS="LITERAL"
>L</TT
></DT
><DD
><P
> This tells C News to transmit only articles posted at your site. This flag
 may be followed by a decimal number <TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
>, which
 makes C News transfer articles posted only within <TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
>
 hops from your site. C News determines the number of hops from the
 <TT
CLASS="REPLACEABLE"
><I
>Path:</I
></TT
> field.
 </P
></DD
><DT
><TT
CLASS="LITERAL"
>u</TT
></DT
><DD
><P
> This tells C News to batch only articles from unmoderated groups. 
 </P
></DD
><DT
><TT
CLASS="LITERAL"
>m</TT
></DT
><DD
><P
> This tells C News to batch only articles from moderated groups. 
 </P
></DD
></DL
></DIV
></P
><P
>You may use at most one of <TT
CLASS="LITERAL"
>F</TT
>,
<TT
CLASS="LITERAL"
>f</TT
>,
<TT
CLASS="LITERAL"
>I</TT
>, or
<TT
CLASS="LITERAL"
>n</TT
>.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>cmds</I
></TT
></DT
><DD
><P
>&#13;

This field contains a command that will be executed for each article,
unless you enable batching. The article will be fed to the command on
standard input. This should be used for very small feed only;
otherwise, the load on both systems will be too high.</P
><P
>The default command is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>uux - -r -z <TT
CLASS="REPLACEABLE"
><I
>remote-system</I
></TT
>!rnews</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This invokes <B
CLASS="COMMAND"
>rnews</B
> on the remote system, feeding it
the article on standard input.</P
><P
>The default search path for commands given in this field is
<TT
CLASS="FILENAME"
>/bin:/usr/bin:/usr/lib/news/batch</TT
>. The latter
directory contains a number of shell scripts whose names start with
<B
CLASS="COMMAND"
>via</B
>&#8201;; they are briefly described later in this chapter.</P
><P
>&#13;
If batching is enabled using one of the
<TT
CLASS="LITERAL"
>F</TT
>,
<TT
CLASS="LITERAL"
>f</TT
>,
<TT
CLASS="LITERAL"
>I</TT
>, or
<TT
CLASS="LITERAL"
>n</TT
> flags, C News expects to find a
filename in this field rather than a command. If the filename does not
begin with a slash (/&#8201;), it is assumed to be relative to
<TT
CLASS="FILENAME"
>/var/spool/news/out.going</TT
>. If the field is
empty, it defaults to <TT
CLASS="FILENAME"
>remote-system/togo</TT
>. The file is
expected to be in the same format as the <TT
CLASS="FILENAME"
>remote-system/togo</TT
> file and contain a list of articles to transmit.</P
></DD
></DL
></DIV
><P
>When setting up C News, you will most probably have to write your own
<TT
CLASS="FILENAME"
>sys</TT
> file. Here is a sample file for
<SPAN
CLASS="SYSTEMITEM"
>vbrew.com</SPAN
>, from which you may copy 
what you need:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># We take whatever they give us.
ME:all/all::
# We send everything we receive to moria, except for local and
# brewery-related articles. We use batching.
moria/moria.orcnet.org:all,!to,to.moria/all,!local,!brewery:f:
# We mail comp.risks to jack@ponderosa.uucp
ponderosa:comp.risks/all::rmail jack@ponderosa.uucp
# swim gets a minor feed
swim/swim.twobirds.com:comp.os.linux,rec.humor.oracle/all,!local:f:
# Log mail map articles for later processing
usenet-maps:comp.mail.maps/all:F:/var/spool/uumaps/work/batch</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-CNEWS.ACTIVE"
>21.4. The active File</A
></H2
><P
>&#13;
 
The <TT
CLASS="FILENAME"
>active</TT
> file is located in
<TT
CLASS="FILENAME"
>/etc/</TT
>, and lists all groups known at your site
and the articles currently online. You will rarely have to touch it, but
we explain it nevertheless for sake of completion. Entries take the
following form:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="REPLACEABLE"
><I
>newsgroup</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>high</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>low</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>perm</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
><TT
CLASS="REPLACEABLE"
><I
>newsgroup</I
></TT
> is the group's name.
<TT
CLASS="REPLACEABLE"
><I
>low</I
></TT
> and <TT
CLASS="REPLACEABLE"
><I
>high</I
></TT
> are the
lowest and highest numbers of articles currently available. If none are
available at the moment, <TT
CLASS="REPLACEABLE"
><I
>low</I
></TT
> is equal to
<TT
CLASS="REPLACEABLE"
><I
>high</I
></TT
>+1.</P
><P
>&#13;At least that's what the <TT
CLASS="REPLACEABLE"
><I
>low</I
></TT
> field is meant to do.
However, for efficiency, C News doesn't update this field. This wouldn't be
such a big loss if there weren't newsreaders that depend on it. For
instance, <B
CLASS="COMMAND"
>trn</B
> checks this field to see if it can purge any
articles from its thread database. To update the <TT
CLASS="REPLACEABLE"
><I
>low</I
></TT
>
field, you therefore have to run the <B
CLASS="COMMAND"
>updatemin</B
> command
regularly (or, in earlier versions of C News, the <B
CLASS="COMMAND"
>upact</B
>
script).</P
><P
><TT
CLASS="REPLACEABLE"
><I
>perm</I
></TT
> is a parameter detailing the access users are
granted to the group. It takes one of the following values:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>y</SPAN
></DT
><DD
><P
>Users are allowed to post to this group.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>n</SPAN
></DT
><DD
><P
>Users are not allowed to post to this group. However, the group may still
be read.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>x</SPAN
></DT
><DD
><P
>This group has been disabled locally. This happens sometimes when news
administrators (or their superiors) take offense at articles posted to
certain groups.</P
><P
>Articles received for this group are not stored locally, although they are
forwarded to the sites that request them.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>m</SPAN
></DT
><DD
><P
>This denotes a moderated group. When a user tries to post to this group,
an intelligent newsreader notifies her of this and send the article to
the moderator instead. The moderator's address is taken from the
<TT
CLASS="FILENAME"
>moderators</TT
> file in <TT
CLASS="FILENAME"
>/var/lib/news</TT
>.</P
></DD
><DT
><TT
CLASS="LITERAL"
>=</TT
><TT
CLASS="REPLACEABLE"
><I
>real-group</I
></TT
></DT
><DD
><P
>This marks <TT
CLASS="REPLACEABLE"
><I
>newsgroup</I
></TT
> as being a local alias for
another group, namely <TT
CLASS="REPLACEABLE"
><I
>real-group</I
></TT
>. All articles
posted to <TT
CLASS="REPLACEABLE"
><I
>newsgroup</I
></TT
> will be redirected to it.</P
></DD
></DL
></DIV
></P
><P
>In C News, you will generally not have to access this file directly.
Groups can be added or deleted locally using
<B
CLASS="COMMAND"
>addgroup</B
> and <B
CLASS="COMMAND"
>delgroup</B
> (see the
section <A
HREF="#X-087-2-CNEWS.MAINT"
>Section 21.10</A
>&#8221; later in this chapter).  A
<SPAN
CLASS="SYSTEMITEM"
>newgroup</SPAN
> control message adds
a group for the whole of Usenet, while a <SPAN
CLASS="SYSTEMITEM"
>rmgroup</SPAN
> message deletes a group.
<EM
>Never send such a message yourself!</EM
> For
instructions on how to create a newsgroup, read the monthly postings
in <SPAN
CLASS="SYSTEMITEM"
>news.announce.newusers</SPAN
>.</P
><P
> 
The <TT
CLASS="FILENAME"
>active.times</TT
> file is closely related to the 
<TT
CLASS="FILENAME"
>active</TT
> file. Whenever a group is created, C News logs
a message to this file containing the name of the group created, the date of
creation, whether it was done by a
<SPAN
CLASS="SYSTEMITEM"
>newgroup</SPAN
> control message or locally,
and who did it. This is convenient for newsreaders that may notify
the user of any recently created groups. It is also used by the
<B
CLASS="COMMAND"
>NEWGROUPS</B
> command of NNTP.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-CNEWS.BATCHER"
>21.5. Article Batching</A
></H2
><P
>&#13;



News batches follow a particular format that is the same for
B News, C News, and INN. Each article is preceded by a line like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#! rnews <TT
CLASS="REPLACEABLE"
><I
>count</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
><TT
CLASS="REPLACEABLE"
><I
>count</I
></TT
> is the number of bytes in the article. When
you use batch compression, the resulting file is compressed as a whole and
preceded by another line, indicated by the message to be used for unpacking.
The standard compression tool is
<SPAN
CLASS="SYSTEMITEM"
>compress</SPAN
>, which is marked by:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#! cunbatch</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Sometimes, when the news server sends batches via mail software that
removes the eighth bit from all data, a compressed batch may be
protected using what is called <EM
>c7-encoding</EM
>; these
batches will be marked by <B
CLASS="COMMAND"
>c7unbatch</B
>.</P
><P
>When a batch is fed to <B
CLASS="COMMAND"
>rnews</B
> on the remote site, it
checks for these markers and processes the batch appropriately.  Some
sites also use other compression tools, like <B
CLASS="COMMAND"
>gzip</B
>,
and precede their gzipped files with the word
<B
CLASS="COMMAND"
>zunbatch</B
> instead. C News does not recognize
nonstandard headers like these; you have to modify the source to
support them.</P
><P
>&#13;
In C News, article batching is performed by
<TT
CLASS="FILENAME"
>/usr/lib/news/batch/sendbatches</TT
>,
which takes a list of articles from the <TT
CLASS="FILENAME"
>site/togo</TT
> file
and puts them into several newsbatches.  It should be executed once per hour,
or even more frequently, depending on the volume of traffic. Its operation
is controlled by the <TT
CLASS="FILENAME"
>batchparms</TT
> file in
<TT
CLASS="FILENAME"
>/var/lib/news</TT
>. This file describes the maximum batch
size allowed for each site, the batching and optional compression program
to be used, and the transport for delivering it to the remote site. You
may specify batching parameters on a per-site basis, as well as a set of
default parameters for sites not explicitly mentioned.</P
><P
>When installing C News, you will most likely find a
<TT
CLASS="FILENAME"
>batchparms</TT
> file in your distribution that contains
a reasonable default entry, so there's a good chance that you won't have
to touch the file. Just in case, we describe its format. Each line consists
of six fields, separated by spaces or tabs:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>size</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>max</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>batcher</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>muncher</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>transport</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
></DT
><DD
><P
><TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
> is the name of the site to which the entry 
applies. The <TT
CLASS="FILENAME"
>togo</TT
> file for this site must reside in
<TT
CLASS="FILENAME"
>out.going&#8201;/togo</TT
> below the news spool. A site name of
<SPAN
CLASS="SYSTEMITEM"
>/default/</SPAN
> denotes the default entry and
is to match any site not directly specified with an entry unique to it.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>size</I
></TT
></DT
><DD
><P
><TT
CLASS="REPLACEABLE"
><I
>size</I
></TT
> is the maximum size of article batches
created (before compression). For single articles larger than this, C News
makes an exception and puts each in a single batch by itself.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>max</I
></TT
></DT
><DD
><P
><TT
CLASS="REPLACEABLE"
><I
>max</I
></TT
> is the maximum number of batches created and
scheduled for transfer before batching stalls for this particular site. This
is useful in case the remote site should be down for a long time,
because it prevents C News from cluttering your UUCP spool directories 
with zillions of newsbatches.</P
><P
>C News determines the number of queued batches using the
<B
CLASS="COMMAND"
>queuelen</B
> script in <TT
CLASS="FILENAME"
>/usr/lib/news/</TT
>.
If you've installed C News in a prepackaged format, the script should not
need any editing, but if you choose to use a different flavor of spool
directories, for example, Taylor UUCP, you might have to write your
own. If you don't care about the number of spool files (because you're the only
person using your computer and you don't write articles by the megabyte),
you may replace the script's contents by a simple <B
CLASS="COMMAND"
>exit 0</B
>
statement.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>batcher</I
></TT
></DT
><DD
><P
>&#13;The <TT
CLASS="REPLACEABLE"
><I
>batcher</I
></TT
> field contains the command used for
producing a batch from the list of articles in the <TT
CLASS="FILENAME"
>togo</TT
>
file. For regular feeds, this is usually <B
CLASS="COMMAND"
>batcher</B
>. For
other purposes, alternative batchers may be provided. For instance, the
ihave/sendme protocol requires the article list to be turned into 
<EM
>ihave</EM
> or <EM
>sendme</EM
> control messages, 
which are posted to the newsgroup
<SPAN
CLASS="SYSTEMITEM"
>to.site</SPAN
>. This is performed by
<B
CLASS="COMMAND"
>batchih</B
> and <B
CLASS="COMMAND"
>batchsm</B
>.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>muncher</I
></TT
></DT
><DD
><P
>&#13;The <TT
CLASS="REPLACEABLE"
><I
>muncher</I
></TT
> field specifies the compression
command. Usually, this is <SPAN
CLASS="SYSTEMITEM"
>compcun</SPAN
>, a script that produces a
compressed batch.<A
NAME="X-087-2-FNCN06"
HREF="#FTN.X-087-2-FNCN06"
><SPAN
CLASS="footnote"
>[128]</SPAN
></A
>
 Alternatively, suppose you create a muncher that uses
<B
CLASS="COMMAND"
>gzip</B
>, say <KBD
CLASS="USERINPUT"
>gzipcun</KBD
> (note that you
have to write it yourself&#8201;).  You have to make sure that
<B
CLASS="COMMAND"
>uncompress</B
> on the remote site is patched to
recognize files compressed with <B
CLASS="COMMAND"
>gzip</B
>.</P
><P
>If the remote site does not have an <B
CLASS="COMMAND"
>uncompress</B
> command,
you may specify <B
CLASS="COMMAND"
>nocomp</B
>, which does not do any compression.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>transport</I
></TT
></DT
><DD
><P
>The last field, <TT
CLASS="REPLACEABLE"
><I
>transport</I
></TT
>, describes the
transport to be used. A number of standard commands for different
transports are available; their names begin with
<B
CLASS="COMMAND"
>via</B
>.  <B
CLASS="COMMAND"
>sendbatches</B
> passes them
the destination sitename on the command line. If the
<TT
CLASS="FILENAME"
>batchparms</TT
> entry is not <SPAN
CLASS="SYSTEMITEM"
>/default/</SPAN
>, <B
CLASS="COMMAND"
>sendbatches</B
>
derives the sitename from the <TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
> field by
stripping it of anything after and including the first dot or
slash. If the <SPAN
CLASS="SYSTEMITEM"
>batchparms</SPAN
> entry
is <SPAN
CLASS="SYSTEMITEM"
>/default/</SPAN
>, the directory
names in <TT
CLASS="FILENAME"
>out.going</TT
> are used.</P
></DD
></DL
></DIV
><P
>To perform batching for a specific site, use the following command:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>su news -c "/usr/lib/news/batch/sendbatches site"</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;When invoked without arguments, <B
CLASS="COMMAND"
>sendbatches</B
> handles all
batch queues. The interpretation of &#8220;all&#8221; depends on the presence
of a default entry in <TT
CLASS="FILENAME"
>batchparms</TT
>. If one is found, all
directories in <TT
CLASS="FILENAME"
>/var/spool/news/out.going</TT
> are checked;
otherwise, <B
CLASS="COMMAND"
>sendbatches</B
> cycles through all entries in
<TT
CLASS="FILENAME"
>batchparms</TT
>, processing just the sites found there.
Note that <B
CLASS="COMMAND"
>sendbatches</B
>, when scanning the
<TT
CLASS="FILENAME"
>out.going</TT
> directory, takes only those directories
that contain no dots or at signs (<SPAN
CLASS="SYSTEMITEM"
>@</SPAN
>)
as sitenames.</P
><P
>&#13;

There are two commands that use <B
CLASS="COMMAND"
>uux</B
> to execute
<B
CLASS="COMMAND"
>rnews</B
> on the remote system:
<B
CLASS="COMMAND"
>viauux</B
> and <B
CLASS="COMMAND"
>viauuxz</B
>. The latter
sets the <CODE
CLASS="OPTION"
>&#8211;z</CODE
> flag for <B
CLASS="COMMAND"
>uux</B
> to
keep older versions from returning success messages for each article
delivered. Another command, <B
CLASS="COMMAND"
>viamail</B
>, sends article
batches to the user <SPAN
CLASS="SYSTEMITEM"
>rnews</SPAN
> on
the remote system via mail.  Of course, this requires that the remote
system somehow feeds all mail for <SPAN
CLASS="SYSTEMITEM"
>rnews</SPAN
> to its local news system.  For a
complete list of these transports, refer to the
<TT
CLASS="FILENAME"
>newsbatch</TT
> manual page.</P
><P
>All commands from the last three fields must be located in either
<TT
CLASS="FILENAME"
>out.going/site</TT
> or
<TT
CLASS="FILENAME"
>/usr/lib/news/batch</TT
>. Most of them are scripts; you 
can easily tailor new tools for your personal needs. They are
invoked through pipes. The list of articles is fed to the batcher on standard
input, which produces the batch on standard output. This is piped into the
muncher, and so on.</P
><P
>Here is a sample file:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># batchparms file for the brewery
# site        | size   |max    |batcher  |muncher    |transport
#-------------+--------+-------+---------+-----------+-----------
/default/       100000  22      batcher   compcun     viauux
swim             10000  10      batcher   nocomp      viauux</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-CNEWS.EXPLIST"
>21.6. Expiring News</A
></H2
><P
>&#13;
 
In B News, expiration needs to be performed by a program called
<B
CLASS="COMMAND"
>expire</B
>, which took a list of newsgroups as arguments,
along with a time specification after which articles had to be expired.
To have different hierarchies expire at different times, you had to write a
script that invoked <B
CLASS="COMMAND"
>expire</B
> for each of them separately.
C News offers a more convenient solution. In a file called
<TT
CLASS="FILENAME"
>explist</TT
>, you may specify newsgroups and expiration
intervals.  A command called <B
CLASS="COMMAND"
>doexpire</B
> is usually run once
a day from <B
CLASS="COMMAND"
>cron</B
> and processes all groups according to this
list.</P
><P
>&#13;
Occasionally, you may want to retain articles from certain groups even
after they have been expired; for example, you might want to keep
programs posted to <SPAN
CLASS="SYSTEMITEM"
>comp.sources.unix</SPAN
>.
This is called <EM
>archiving</EM
>. <TT
CLASS="FILENAME"
>explist</TT
>
permits you to mark groups for archiving.</P
><P
>An entry in <TT
CLASS="FILENAME"
>explist</TT
> looks like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="REPLACEABLE"
><I
>grouplist</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>perm</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>times</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>archive</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
><TT
CLASS="REPLACEABLE"
><I
>grouplist</I
></TT
> is a comma-separated list of
newsgroups to which the entry applies. Hierarchies may be specified by
giving the group name prefix, optionally appended with <SPAN
CLASS="SYSTEMITEM"
>all</SPAN
>. For example, for an entry applying to
all groups below <SPAN
CLASS="SYSTEMITEM"
>comp.os</SPAN
>,
enter either <KBD
CLASS="USERINPUT"
>comp.os</KBD
> or
<KBD
CLASS="USERINPUT"
>comp.os.all</KBD
>.</P
><P
>When <EM
>expiring</EM
> news from a group, the name is
checked against all entries in <TT
CLASS="FILENAME"
>explist</TT
> in the
order given. The first matching entry applies. For example, to throw
away the majority of <SPAN
CLASS="SYSTEMITEM"
>comp</SPAN
>
after four days, except for <SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.announce</SPAN
>, which you want
to keep for a week, you simply have an entry for the latter, which
specifies a seven-day expiration period, followed by an expiration
period for <SPAN
CLASS="SYSTEMITEM"
>comp</SPAN
>, which
specifies four days.</P
><P
>The <TT
CLASS="REPLACEABLE"
><I
>perm</I
></TT
> field details if the entry applies to
moderated, unmoderated, or any groups. It may take the values
<SPAN
CLASS="SYSTEMITEM"
>m</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>u</SPAN
>, or
<SPAN
CLASS="SYSTEMITEM"
>x</SPAN
>, which denote moderated, unmoderated,
or any type.</P
><P
>The third field, <TT
CLASS="REPLACEABLE"
><I
>times</I
></TT
>, usually contains
only a single number. This is the number of days after which articles 
expire if they haven't been assigned an artificial expiration
date in an <TT
CLASS="LITERAL"
>Expires:</TT
> field in the article
header. Note that this is the number of days counting from its
<EM
>arrival</EM
> at your site, not the date of posting.</P
><P
>The <TT
CLASS="REPLACEABLE"
><I
>times</I
></TT
> field may, however, be more
complex than that. It may be a combination of up to three numbers
separated from one another by dashes. The first denotes the number of
days that have to pass before the article is considered a candidate
for expiration, even if the <TT
CLASS="LITERAL"
>Expires:</TT
> field would
have it expire already. It is rarely useful to use a value other than
zero. The second field is the previously mentioned default number of days
after which it will be expired. The third is the number of days after
which an article will be expired unconditionally, regardless of
whether it has an <TT
CLASS="LITERAL"
>Expires:</TT
> field or not.  If only
the middle number is given, the other two take default values. These
may be specified using the special entry <SPAN
CLASS="SYSTEMITEM"
>/bounds/</SPAN
>, which is described a little
later.</P
><P
>The fourth field, <TT
CLASS="REPLACEABLE"
><I
>archive</I
></TT
>, denotes whether the
newsgroup is to be archived and where.  If no archiving is intended, a dash
should be used. Otherwise, you either use a full pathname (pointing to a
directory) or an at sign (@). The at sign denotes the default archive
directory, which must then be given to <B
CLASS="COMMAND"
>doexpire</B
> by using
the <CODE
CLASS="OPTION"
>&#8211;a</CODE
> flag on the command line.  An archive directory
should be owned by <SPAN
CLASS="SYSTEMITEM"
>news</SPAN
>. When
<B
CLASS="COMMAND"
>doexpire</B
> archives an article from say,
<SPAN
CLASS="SYSTEMITEM"
>comp.sources.unix</SPAN
>, it stores it in
the directory <SPAN
CLASS="SYSTEMITEM"
>comp/sources/unix</SPAN
> below
the archive directory, creating it if necessary. The archive directory itself,
however, will not be created.</P
><P
>There are two special entries in your <TT
CLASS="FILENAME"
>explist</TT
> file that
<B
CLASS="COMMAND"
>doexpire</B
> relies on.  Instead of a list of newsgroups, they
have the keywords <SPAN
CLASS="SYSTEMITEM"
>/bounds/</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>/expired/</SPAN
>. The
<SPAN
CLASS="SYSTEMITEM"
>/bounds/</SPAN
> entry contains the default
values for the three values of the <TT
CLASS="REPLACEABLE"
><I
>times</I
></TT
> field
described previously.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>/expired/</SPAN
> field determines how
long C News will hold onto lines in the <TT
CLASS="FILENAME"
>history</TT
> file. 
C News will not remove a line from the history file
once the corresponding article(s) have been expired, but will hold onto it
in case a duplicate should arrive after this date. If you are fed by only
one site, you can keep this value small. Otherwise, a couple of weeks is
advisable on UUCP networks, depending on the delays you experience with
articles from these sites.</P
><P
>Here is a sample <TT
CLASS="FILENAME"
>explist</TT
> file with rather tight
expiry intervals:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># keep history lines for two weeks. No article gets more than three months
/expired/                       x       14      -
/bounds/                        x       0-1-90  -
# groups we want to keep longer than the rest
comp.os.linux.announce          m       10      -
comp.os.linux                   x       5       -
alt.folklore.computers          u       10      -
rec.humor.oracle                m       10      -
soc.feminism                    m       10      -
# Archive *.sources groups
comp.sources,alt.sources        x       5       @
# defaults for tech groups
comp,sci                        x       7       -
# enough for a long weekend
misc,talk                       x       4       -
# throw away junk quickly
junk                            x       1       -
# control messages are of scant interest, too
control                         x       1       -
# catch-all entry for the rest of it
all                             x       2       -</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>&#13;Expiring presents several potential problems. One is that your newsreader
might rely on the third field of the <EM
>active</EM
> file 
described earlier, which contains the number
of the lowest article online. When expiring articles, C News does not update
this field. If you need (or want) to have this field represent the real
situation, you need to run a program called <B
CLASS="COMMAND"
>updatemin</B
> after
each run of <B
CLASS="COMMAND"
>doexpire</B
>. (In older versions of C News, a 
script called <B
CLASS="COMMAND"
>upact</B
> did this.)</P
><P
>&#13;C News does not expire by scanning the newsgroup's directory, but simply
checks the <TT
CLASS="FILENAME"
>history</TT
> file if the article is due for
expiration.<A
NAME="X-087-2-FNCN07"
HREF="#FTN.X-087-2-FNCN07"
><SPAN
CLASS="footnote"
>[129]</SPAN
></A
>
If your history file somehow gets out of sync, articles may be around on
your disk forever because C News has literally forgotten
them.<A
NAME="X-087-2-FNCN08"
HREF="#FTN.X-087-2-FNCN08"
><SPAN
CLASS="footnote"
>[130]</SPAN
></A
>
You can repair this by using the <B
CLASS="COMMAND"
>addmissing</B
> script in
<TT
CLASS="FILENAME"
>/usr/lib/news/maint</TT
>, which will add missing articles
to the <TT
CLASS="FILENAME"
>history</TT
> file or <B
CLASS="COMMAND"
>mkhistory</B
>,
which rebuilds the entire file from scratch. Don't forget to become user
<SPAN
CLASS="SYSTEMITEM"
>news</SPAN
> before invoking it, or else you
will wind up with a <TT
CLASS="FILENAME"
>history</TT
> file unreadable by
C News.
&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-CNEWS.MISC"
>21.7. Miscellaneous Files</A
></H2
><P
>There are a number of files that control the behavior of C News, but are not
essential. All of them reside in <TT
CLASS="FILENAME"
>/etc/news</TT
>. We describe 
them briefly here:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="FILENAME"
>newsgroups</TT
></DT
><DD
><P
>&#13; 
This is a companion file of <TT
CLASS="FILENAME"
>active</TT
> that contains a list
of each newsgroup name along with a one-line description of its main topic.
This file is automatically updated when C News receives a
<SPAN
CLASS="SYSTEMITEM"
>checknews</SPAN
> control message.</P
></DD
><DT
><TT
CLASS="FILENAME"
>localgroups</TT
></DT
><DD
><P
> 
If you have a lot of local groups, you can keep C News from complaining about 
them each time you receive a <TT
CLASS="LITERAL"
>checkgroups</TT
> message by putting their names and descriptions in this file, just as they would
appear in <TT
CLASS="FILENAME"
>newsgroups</TT
>.</P
></DD
><DT
><TT
CLASS="FILENAME"
>mailpaths</TT
></DT
><DD
><P
>&#13; 
This file contains the moderator's address for each moderated group. Each
line contains the group name followed by the moderator's email address
(offset by a tab).</P
><P
>Two special entries are provided as defaults:
<SPAN
CLASS="SYSTEMITEM"
>backbone</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>internet</SPAN
>. Both provide, in bang-path
notation, the path to the nearest backbone site and the site that understands
RFC-822 style addresses (<SPAN
CLASS="SYSTEMITEM"
>user@host</SPAN
>).
The default entries are:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>internet           backbone</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>You do not have to change the <SPAN
CLASS="SYSTEMITEM"
>internet</SPAN
> entry if you have
<B
CLASS="COMMAND"
>exim</B
> or <B
CLASS="COMMAND"
>sendmail</B
> installed; they
understand RFC-822 addressing.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>backbone</SPAN
> entry is used whenever a
user posts to a moderated group whose moderator is not listed explicitly. If
the newsgroup's name is <SPAN
CLASS="SYSTEMITEM"
>alt.sewer</SPAN
>
and the <SPAN
CLASS="SYSTEMITEM"
>backbone</SPAN
> entry contains
<SPAN
CLASS="SYSTEMITEM"
>path!%s</SPAN
>, C News will mail the
article to <SPAN
CLASS="SYSTEMITEM"
>path!alt-sewer</SPAN
>, hoping
that the backbone machine is able to forward the article. To find out which
path to use, ask the news-admin at the site that feeds you. As a last resort,
you can also use <SPAN
CLASS="SYSTEMITEM"
>uunet.uu.net!%s</SPAN
>.</P
></DD
><DT
><TT
CLASS="FILENAME"
>distributions</TT
></DT
><DD
><P
>&#13;This file is not really a C News file, but is used by some newsreaders
and <B
CLASS="COMMAND"
>nntpd</B
>. It contains the list of distributions recognized
by your site and a description of their (intended) effects. For example,
Virtual Brewery has the following file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>world         everywhere in the world
local         Only local to this site
nl            Netherlands only
mugnet        MUGNET only
fr            France only
de            Germany only
brewery       Virtual Brewery only</PRE
></FONT
></TD
></TR
></TABLE
></P
></DD
><DT
><TT
CLASS="FILENAME"
>log</TT
></DT
><DD
><P
>&#13;This file contains a log of all C News activities. It is culled regularly by
running <B
CLASS="COMMAND"
>newsdaily</B
>&#8201;; copies of the old log files are kept in
<TT
CLASS="FILENAME"
>log.o</TT
>, <TT
CLASS="FILENAME"
>log.oo</TT
>, etc.</P
></DD
><DT
><TT
CLASS="FILENAME"
>errlog</TT
></DT
><DD
><P
>This is a log of all error messages created by C News. These messages do not include
logs of articles junked due to being sent to an invalid wrong group or other
user errors. This file is mailed to the newsmaster
(<SPAN
CLASS="SYSTEMITEM"
>usenet</SPAN
> by default)
automatically by <B
CLASS="COMMAND"
>newsdaily</B
> if it is not found empty.</P
><P
><TT
CLASS="FILENAME"
>errlog</TT
> is cleared by <B
CLASS="COMMAND"
>newsdaily</B
>.
<TT
CLASS="FILENAME"
>errlog.o</TT
> keeps old copies and companions.</P
></DD
><DT
><TT
CLASS="FILENAME"
>batchlog</TT
></DT
><DD
><P
>This file logs all runs of <B
CLASS="COMMAND"
>sendbatches</B
>. It is usually of scant
interest. It is also attended by <B
CLASS="COMMAND"
>newsdaily</B
>.</P
></DD
><DT
><TT
CLASS="FILENAME"
>watchtime</TT
></DT
><DD
><P
>This is an empty file created each time <B
CLASS="COMMAND"
>newswatch</B
> runs.</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-CNEWS.CONTROL"
>21.8. Control Messages</A
></H2
><P
>&#13; 
The Usenet news protocol knows a special category of articles that
evoke certain responses or actions by the news system. These are called
<EM
>control</EM
> messages. They are recognized by the presence of a
<TT
CLASS="REPLACEABLE"
><I
>Control:</I
></TT
> field in the article header, which contains the
name of the control operation to be performed. There are several types of them,
all of which are handled by shell scripts located in
<TT
CLASS="FILENAME"
>/usr/lib/news/ctl</TT
>.</P
><P
>Most of these messages perform their action automatically at the time the article
is processed by C News without notifying the newsmaster. By default, only
<SPAN
CLASS="SYSTEMITEM"
>checkgroups</SPAN
> messages will be handed
to the newsmaster, but you may change this by editing the scripts.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-CNEWS.CONTROL.CANCEL"
>21.8.1. The cancel Message</A
></H3
><P
>&#13;
The most widely known message is <SPAN
CLASS="SYSTEMITEM"
>cancel</SPAN
>, with which a user can cancel an
article sent earlier. This effectively removes the article from the
spool directories, if it exists. The <SPAN
CLASS="SYSTEMITEM"
>cancel</SPAN
> message is forwarded to all sites
that receive news from the groups affected, regardless of whether the
article has been seen already. This takes into account the possibility
that the original article has been delayed over the cancellation
message. Some news systems allow users to cancel other people's
messages; this is, of course, a definite no-no.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-CNEWS.CONTROL.ADDGROUP"
>21.8.2. newgroup and rmgroup</A
></H3
><P
>&#13;


 
 
Two messages dealing with creation or removal of newsgroups are the
<SPAN
CLASS="SYSTEMITEM"
>newgroup</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>rmgroup</SPAN
> messages. Newsgroups below the
&#8220;usual&#8221; hierarchies may be created only after a discussion and
voting has been held among Usenet readers. The rules applying to the
<SPAN
CLASS="SYSTEMITEM"
>alt</SPAN
> hierarchy allow for something
close to anarchy. For more information, see the regular postings in
<SPAN
CLASS="SYSTEMITEM"
>news.announce.newusers</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>news.announce.newgroups</SPAN
>.  Never send
a <SPAN
CLASS="SYSTEMITEM"
>newgroup</SPAN
> or
<SPAN
CLASS="SYSTEMITEM"
>rmgroup</SPAN
> message yourself unless you
definitely know that you are allowed to.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-CNEWS.CONTROL.CHECKGROUPS"
>21.8.3. The checkgroups Message</A
></H3
><P
>&#13;

<SPAN
CLASS="SYSTEMITEM"
>checkgroups</SPAN
> messages are sent by news
administrators to make all sites within a network synchronize their
<TT
CLASS="FILENAME"
>active</TT
> files with the realities of Usenet. For example,
commercial Internet Service Providers might send out such a message to their
customers' sites.  Once a month, the &#8220;official&#8221;
<SPAN
CLASS="SYSTEMITEM"
>checkgroups</SPAN
> message for the major
hierarchies is posted to
<SPAN
CLASS="SYSTEMITEM"
>comp.announce.newgroups</SPAN
> by its
moderator. However, it is posted as an ordinary article, not as a control
message. To perform the <SPAN
CLASS="SYSTEMITEM"
>checkgroups</SPAN
>
operation, save this article to a file, say <TT
CLASS="FILENAME"
>/tmp/check</TT
>,
remove everything up to the beginning of the control message itself, and feed
it to the <SPAN
CLASS="SYSTEMITEM"
>checkgroups</SPAN
> script using the
following command:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>su news -c "/usr/lib/news/ctl/checkgroups" &#60; /tmp/check</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This will update your <TT
CLASS="FILENAME"
>newsgroups</TT
> file from the new list 
of groups, adding the groups
listed in <TT
CLASS="FILENAME"
>localgroups</TT
>. The old
<TT
CLASS="FILENAME"
>newsgroups</TT
> file will be moved to
<TT
CLASS="FILENAME"
>newsgroups.bac</TT
>. Note that posting the message locally 
rarely works, because <B
CLASS="COMMAND"
>inews</B
>, the command that accepts 
and posts articles from users, refuses to accept that large an article.</P
><P
>If C News finds mismatches between the
<SPAN
CLASS="SYSTEMITEM"
>checkgroups</SPAN
> list and the
<TT
CLASS="FILENAME"
>active</TT
> file, it produces a list of commands that
would bring your site up to date and mails it to the news administrator. </P
><P
>The output typically looks like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>From news Sun Jan 30 16:18:11 1994
Date: Sun, 30 Jan 94 16:18 MET
From: news (News Subsystem)
To: usenet
Subject: Problems with your active file
The following newsgroups are not valid and should be removed.
        alt.ascii-art
        bionet.molbio.gene-org
        comp.windows.x.intrisics
        de.answers
You can do this by executing the commands:
         /usr/lib/news/maint/delgroup alt.ascii-art
         /usr/lib/news/maint/delgroup bionet.molbio.gene-org
         /usr/lib/news/maint/delgroup comp.windows.x.intrisics
         /usr/lib/news/maint/delgroup de.answers
The following newsgroups were missing.
        comp.binaries.cbm
        comp.databases.rdb
        comp.os.geos
        comp.os.qnx
        comp.unix.user-friendly
        misc.legal.moderated
        news.newsites
        soc.culture.scientists
        talk.politics.crypto
        talk.politics.tibet</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>When you receive a message like this from your news system, don't
believe it automatically. Depending on who sent the
<SPAN
CLASS="SYSTEMITEM"
>checkgroups</SPAN
> message, it may lack a few
groups or even entire hierarchies; you should be careful about removing
any groups. If you find groups are listed as missing that you want to carry
at your site, you have to add them using the <B
CLASS="COMMAND"
>addgroup</B
>
script. Save the list of missing groups to a file and feed it to the
following little script:

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>#!/bin/sh
#
WHOIAM=`whoami`
if [ "$WHOIAM" != "news" ]
then
	echo "You must run $0 as user 'news'" &#62;&#38;2
	exit 1
fi
#
cd /usr/lib/news
while read group; do
    if grep -si "^$group[[:space:]].*moderated" newsgroup; then
        mod=m
    else
        mod=y
    fi
    /usr/lib/news/maint/addgroup $group $mod
done</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="X-087-2-CNEWS.CONTROL.SENDSYS"
>21.8.4. sendsys, version, and senduuname</A
></H3
><P
>&#13;Finally, there are three messages that can be used to find out about
the network's topology. These are <SPAN
CLASS="SYSTEMITEM"
>sendsys</SPAN
>, <SPAN
CLASS="SYSTEMITEM"
>version</SPAN
>, and <SPAN
CLASS="SYSTEMITEM"
>senduuname</SPAN
>. They cause C News to return
the <TT
CLASS="FILENAME"
>sys</TT
> file to the sender, as well as a software
version string and the output of <B
CLASS="COMMAND"
>uuname</B
>,
respectively. C News is very laconic about <SPAN
CLASS="SYSTEMITEM"
>version</SPAN
> messages; it returns a simple,
unadorned <TT
CLASS="LITERAL"
>C</TT
>.</P
><P
>Again, you should <EM
>never</EM
> issue such a message unless you
have made sure that it cannot leave your (regional) network. Replies to
<SPAN
CLASS="SYSTEMITEM"
>sendsys</SPAN
> messages can quickly bring down
a UUCP network.<A
NAME="X-087-2-FNCN09"
HREF="#FTN.X-087-2-FNCN09"
><SPAN
CLASS="footnote"
>[131]</SPAN
></A
></P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-CNEWS.NFS"
>21.9. C News in an NFS Environment</A
></H2
><P
>&#13;
 

A simple way to distribute news within a local network is to keep all
news on a central host and export the relevant directories via NFS so
that newsreaders may scan the articles directly. The overhead involved
in retrieving and threading articles is significantly lower than
NNTP. NNTP, on the other hand, wins in a heterogeneous network where
equipment varies widely among hosts, or where users don't have
equivalent accounts on the server machine.</P
><P
>When you use NFS, articles posted on a local host have to be forwarded to
the central machine because accessing adminstrative files might
otherwise expose the system to race conditions that leave the files
inconsistent. Also, you might want to protect your news spool area by
exporting it read-only, which also requires forwarding to the central
machine.</P
><P
>C News handles this central machine configuration transparently to the user.
When you post an article, your newsreader usually invokes
<B
CLASS="COMMAND"
>inews</B
> to inject the article into the news system. This
command runs a number of checks on the article, completes the header, and
checks the file <TT
CLASS="FILENAME"
>server</TT
> in <TT
CLASS="FILENAME"
>/etc/news</TT
>.
If this file exists and contains a hostname different from the local host's
name, <B
CLASS="COMMAND"
>inews</B
> is invoked on that server host via
<B
CLASS="COMMAND"
>rsh</B
>. Since the <B
CLASS="COMMAND"
>inews</B
> script uses a
number of binary commands and support files from C News, you have to either
have C News installed locally or mount the news software from the server.</P
><P
>For the <B
CLASS="COMMAND"
>rsh</B
> invocation to work properly, each user who
posts news must have an equivalent account on the server system, i.e., one
to which she can log in without being asked for a password.</P
><P
>Make sure that the hostname given in <TT
CLASS="FILENAME"
>server</TT
> literally
matches the output of the <B
CLASS="COMMAND"
>hostname</B
> command on the server
machine, or else C News will loop forever in an attempt to deliver the article.
We discuss NFS is detail in <A
HREF="#X-087-2-NFS"
>Chapter 14</A
>.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-CNEWS.MAINT"
>21.10. Maintenance Tools and Tasks</A
></H2
><P
> 
Despite the complexity of C News, a news administrator's life can be fairly
easy; C News provides you with a wide variety of maintenance tools.
Some of these are intended to be run regularly from <B
CLASS="COMMAND"
>cron</B
>,
like <B
CLASS="COMMAND"
>newsdaily</B
>.  Using these scripts greatly reduces
daily care and feeding requirements of your C News installation.</P
><P
>Unless stated otherwise, these commands are located in
<TT
CLASS="FILENAME"
>/usr/lib/news/maint</TT
>.  (Note that you must become user
<SPAN
CLASS="SYSTEMITEM"
>news</SPAN
> before invoking these commands.
Running them as a superuser may render critical newsfiles inaccessible to C News.):</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><B
CLASS="COMMAND"
>newsdaily</B
></DT
><DD
><P
>The name already says it: run this once a day.  It is an important script
that helps you keep log files small, retaining copies of each from the last
three runs.  It also tries to sense anomalies, like stale batches in the
incoming and outgoing directories, postings to unknown or moderated newsgroups,
etc. Resulting error messages are mailed to the newsmaster.</P
></DD
><DT
><B
CLASS="COMMAND"
>newswatch</B
></DT
><DD
><P
>This script should be run regularly to look for anomalies in the
news system, once an hour or so. It is intended to detect problems that will
have an immediate effect on the operability of your news system, in which case it mails a trouble report to the newsmaster. Things checked include stale lock files
that don't get removed, unattended input batches, and disk space shortage.</P
></DD
><DT
><B
CLASS="COMMAND"
>addgroup</B
></DT
><DD
><P
>This script adds a group to your site locally. The proper invocation is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>addgroup <TT
CLASS="REPLACEABLE"
><I
>groupname</I
></TT
> y|n|m|=<TT
CLASS="REPLACEABLE"
><I
>realgroup</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The second argument has the same meaning as the flag in the
<TT
CLASS="FILENAME"
>active</TT
> file, meaning that anyone may post to the group
(<SPAN
CLASS="SYSTEMITEM"
>y</SPAN
>), that no one may post
(<SPAN
CLASS="SYSTEMITEM"
>n</SPAN
>), that it is moderated
(<SPAN
CLASS="SYSTEMITEM"
>m</SPAN
>), or that it is an alias for another
group (<SPAN
CLASS="SYSTEMITEM"
>=</SPAN
><TT
CLASS="REPLACEABLE"
><I
>realgroup</I
></TT
>).  You might also want to use <B
CLASS="COMMAND"
>addgroup</B
> when the 
first articles in a newly created group arrive earlier than the
<SPAN
CLASS="SYSTEMITEM"
>newgroup</SPAN
> control message that is
intended to create it.</P
></DD
><DT
><B
CLASS="COMMAND"
>delgroup</B
></DT
><DD
><P
>This script allows you to delete a group locally. Invoke it as:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>delgroup <TT
CLASS="REPLACEABLE"
><I
>groupname</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>You still have to delete the articles that remain in the newsgroup's spool
directory. Alternatively, you might leave it to the natural course of events
(i.e., expiration) to make them go away.</P
></DD
><DT
><B
CLASS="COMMAND"
>addmissing</B
></DT
><DD
><P
>This script adds missing articles to the <TT
CLASS="FILENAME"
>history</TT
> 
file. Run it when there are articles that seem to hang around forever.</P
></DD
><DT
><B
CLASS="COMMAND"
>newsboot</B
></DT
><DD
><P
>This script should be run at system boot time. It removes any lock files
left over when news processes were killed at shutdown, and closes and executes
any batches left over from NNTP connections that were terminated when shutting
down the system.</P
></DD
><DT
><B
CLASS="COMMAND"
>newsrunning</B
></DT
><DD
><P
>This script resides in <TT
CLASS="FILENAME"
>/usr/lib/news/input</TT
> and may be used to disable unbatching of incoming news, for instance during work hours. You may turn off unbatching by invoking:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>/usr/lib/news/input/newsrunning off</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>It is turned on by using <SPAN
CLASS="SYSTEMITEM"
>on</SPAN
> instead of
<SPAN
CLASS="SYSTEMITEM"
>off</SPAN
>.</P
></DD
></DL
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-NNTP"
></A
>Chapter 22. NNTP and thenntpd Daemon</H1
><P
>Network News Transfer Protocol (NNTP) provides for a vastly different 
approach to news exchange from C News and other news servers without native 
NNTP support. Rather than rely on a batch technology like UUCP to transfer 
news articles between machines, it allows articles to be exchanged via an 
interactive network connection. NNTP is not a particular software package, 
but an Internet standard described in RFC-977. It is based on a 
stream-oriented connection, usually over TCP, between a client anywhere in 
the network and a server on a host that keeps Netnews on disk storage. The 
stream connection allows the client and server to interactively negotiate 
article transfer with nearly no turnaround delay, thus keeping the number of 
duplicate articles low. Together with the Internet's high-transfer rates, 
this adds up to a news transport that surpasses the original UUCP networks by 
far. While some years ago it was not uncommon for an article to take two 
weeks or more before it arrived in the last corner of Usenet; it is now often 
less than two days. On the Internet itself, it is even within the range of 
minutes.</P
><P
>Various commands allow clients to retrieve, send, and post articles. The
difference between sending and posting is that the latter may involve articles
with incomplete header information; it generally means that the user has just 
written the article.<A
NAME="X-087-2-FNNN01"
HREF="#FTN.X-087-2-FNNN01"
><SPAN
CLASS="footnote"
>[132]</SPAN
></A
>
Article retrieval may be used by news transfer clients as well as newsreaders.
This makes NNTP an excellent tool for providing news access to many clients on
a local network without going through the contortions that are necessary when
using NFS.</P
><P
>&#13;
 
 


NNTP also provides for an active and a passive way to transfer news,
colloquially called &#8220;pushing&#8221; and &#8220;pulling.&#8221; Pushing
is basically the same as the ihave/sendme protocol used by C News (described in
<A
HREF="#X-087-2-CNEWS"
>Chapter 21</A
>). The client offers an article to the server
through the <B
CLASS="COMMAND"
>IHAVE msgid</B
> 
command, and the server returns a response code that indicates whether
it already has the article or if it wants it. If the server wants the 
article, the client sends the article, terminated by a single dot on a 
separate line.</P
><P
>Pushing news has the single disadvantage that it places a heavy load on
the server system, since the system has to search its history database for 
every single article.</P
><P
>&#13;
The opposite technique is pulling news, in which the client requests a
list of all (available) articles from a group that have arrived after a
specified date. This query is performed by the
<B
CLASS="COMMAND"
>NEWNEWS</B
> command. From the returned
list of message IDs, the client selects those articles it does not yet have,
using the <B
CLASS="COMMAND"
>ARTICLE</B
> command for
each of them in turn.</P
><P
>Pulling news needs tight control by the server over which groups and 
distributions it allows a client to request. For example, it has to make 
sure that no confidential material from newsgroups local to the site is sent 
to unauthorized clients.</P
><P
>There are also a number of convenience commands for newsreaders that
permit them to retrieve the article header and body separately, or even
single header lines from a range of articles. This lets you keep all
news on a central host, with all users on the (presumably local) network
using NNTP-based client programs for reading and posting. This is an
alternative to exporting the news directories via NFS, as described
in <A
HREF="#X-087-2-CNEWS"
>Chapter 21</A
>.</P
><P
>&#13; 
An overall problem of NNTP is that it allows a knowledgeable person to insert
articles into the news stream with false sender specification. This is
called <EM
>news faking</EM
> or
<EM
>spoofing</EM
>.<A
NAME="X-087-2-FNNN02"
HREF="#FTN.X-087-2-FNNN02"
><SPAN
CLASS="footnote"
>[133]</SPAN
></A
>
An extension to NNTP allows you to require user authentication for
certain commands, providing some measure of protection against people abusing
your news server in this way.</P
><P
>&#13;

There are a number of NNTP packages. One of the more widely known is
the NNTP daemon, also known as the
<EM
>reference implementation</EM
>.
Originally, it was written by Stan Barber and Phil Lapsley to illustrate the
details of RFC-977. As with much of the good software available today, you may
find it prepackaged for your Linux distribution, or you can obtain the source
and compile it yourself. If you choose to compile it yourself, you will need to
be quite familiar with your distribution to ensure you configure all of the
file paths correctly.</P
><P
>The <B
CLASS="COMMAND"
>nntpd</B
> package has a server, two clients for
pulling and pushing news, and an <B
CLASS="COMMAND"
>inews</B
>
replacement. They live in a B News environment, but with a little
tweaking, they will be happy with C News, too.  However, if you plan to
use NNTP for more than offering newsreaders access to your news server,
the reference implementation is not really an option.  We will therefore
discuss only the NNTP daemon contained in the <B
CLASS="COMMAND"
>nntpd</B
> package
and leave out the client programs.</P
><P
>&#13;
If you wish to run a large news site, you should look at
the <EM
>InterNet News</EM
> package, or INN, that was written by
Rich Salz. It provides both NNTP and UUCP-based news transport. News transport is definitely better than
<B
CLASS="COMMAND"
>nntpd</B
>. We discuss INN in detail in
<A
HREF="#X-087-2-INN"
>Chapter 23</A
>.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NNTP.PROTOCOL"
>22.1. The NNTP Protocol</A
></H2
><P
>We've mentioned two NNTP commands that are key to how news articles are pushed
or pulled between servers. Now we'll look at these in the context of an actual
NNTP session to show you how simple the protocol is. For the purposes of our
illustration, we'll use a simple <B
CLASS="COMMAND"
>telnet</B
> client to connect to
an INN-based news server at the Virtual Brewery called
<EM
>news.vbrew.com</EM
>. The server is running
a minimal configuration to keep the examples short. We'll look at how to
complete the configuration of this server in <A
HREF="#X-087-2-INN"
>Chapter 23</A
>.
In our testing we'll be very careful to generate articles in the
<EM
>junk</EM
> newsgroup only, to avoid 
disturbing anyone else.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN17894"
>22.1.1. Connecting to the News Server</A
></H3
><P
>&#13;Connecting to the news server is a simple as opening a TCP connection to
its NNTP port. When you are connected, you will be greeted with a welcome
banner. One of the first commands you might try is <SPAN
CLASS="SYSTEMITEM"
>help</SPAN
>. The response you get generally depends upon whether
the server believes you are a remote NNTP server or a newsreader, as there are
different command sets required. You can change your operating mode using the
<B
CLASS="COMMAND"
>mode</B
> command; we'll look at that in a
moment:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>telnet news.vbrew.com nntp</KBD
>
Trying 172.16.1.1...
Connected to localhost.
Escape character is '^]'.
200 news.vbrew.com InterNetNews server INN 1.7.2 08-Dec-1997 ready
<KBD
CLASS="USERINPUT"
>help</KBD
>
100 Legal commands
        authinfo
		help
		ihave
		check
		takethis
		list
		mode
		xmode
		quit
		head
		stat
		xbatch
		xpath
		xreplic
For more information, contact "usenet" at this machine.
.</PRE
></FONT
></TD
></TR
></TABLE
><P
>The responses to NNTP commands always end with a period (.) on a
line by itself. The numbers you see in the output listing are 
<EM
>response codes</EM
> and are used by the server to indicate success or
failure of a command. The response codes are described in RFC-977; we'll talk
about the most important ones as we proceed.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN17907"
>22.1.2. Pushing a News Article onto a Server</A
></H3
><P
>&#13;


We mentioned the <B
CLASS="COMMAND"
>IHAVE</B
> command
when we talked about pushing news articles onto a news server. Let's
now have a look at how the <B
CLASS="COMMAND"
>IHAVE</B
> command actually works:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>ihave &#60;123456@gw.vk2ktj.ampr.org&#62;</KBD
>
335
<KBD
CLASS="USERINPUT"
>From: terry@gw.vk2ktj.ampr.org
Subject: test message sent with ihave
Newsgroups: junk
Distribution: world
Path: gw.vk2ktj.ampr.org
Date: 26 April 1999
Message-ID: &#60;123456@gw.vk2ktj.ampr.org&#62;
Body: 

This is a test message sent using the NNTP IHAVE command.

.</KBD
>
235</PRE
></FONT
></TD
></TR
></TABLE
><P
>All NNTP commands are case insensitive, so you may enter them in
either upper- or lowercase. The <B
CLASS="COMMAND"
>IHAVE</B
> command takes one 
mandatory argument, it being the Message ID of the article that is being pushed. Every news article is assigned a unique message ID when
it is created. The <B
CLASS="COMMAND"
>IHAVE</B
> command provides a way of the NNTP server to say which articles it has
when it wants to push articles to another server. The sending server
will issue an <B
CLASS="COMMAND"
>IHAVE</B
> command
for each article it wishes to push. If the command response code
generated by the receiving NNTP server is in the &#8220;3xx&#8221;
range, the sending NNTP server will transmit the complete article,
including it's full header, terminating the article with a period on a
line by itself. If the response code was in the &#8220;4xx&#8221;
range, the receiving server has chosen not to accept this article,
possibly because it already has it, or because of some problem, such
as running out of disk space.</P
><P
>When the article has been transmitted, the receiving serve issues another
response code indicating whether the article transmission was successful.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN17931"
>22.1.3. Changing to NNRP Reader Mode</A
></H3
><P
>&#13;
Newsreaders use their own set of commands when talking to a
news server. To activate these commands, the news server has to be
operating in <EM
>reader</EM
> mode. Most news servers default
to reader mode, unless the IP address of the connecting host is listed
as a news-forwarding peer.  In any case, NNTP provides a command to
explicitly switch into reader mode:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>mode reader</KBD
>
200 news.vbrew.com InterNetNews NNRP server INN 1.7.2 08-Dec-1997 ready/
    (posting ok).
<KBD
CLASS="USERINPUT"
>help</KBD
>
100 Legal commands
  authinfo user Name|pass Password|generic &#60;prog&#62; &#60;args&#62;
  article [MessageID|Number]
  body [MessageID|Number]
  date
  group newsgroup
  head [MessageID|Number]
  help
  ihave
  last
  list [active|active.times|newsgroups|distributions|distrib.pats|/
      overview.fmt|subscriptions]
  listgroup newsgroup
  mode reader
  newgroups yymmdd hhmmss ["GMT"] [&#60;distributions&#62;]
  newnews newsgroups yymmddhhmmss ["GMT"] [&#60;distributions&#62;]
  next
  post
  slave
  stat [MessageID|Number]
  xgtitle [group_pattern]
  xhdr header [range|MessageID]
  xover [range]
  xpat header range|MessageID pat [morepat...]
  xpath MessageID
Report problems to &#60;usenet@vlager.vbrew.com&#62;
.</PRE
></FONT
></TD
></TR
></TABLE
><P
>NNTP reader mode has a lot of commands. Many of these are designed to
make the life of a newsreader easier. We mentioned earlier that there are
commands that instruct the server to send the head and the body of articles
separately. There are also commands that list the available groups and 
articles, and others that allow posting, an alternate means of sending news 
articles to the server.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN17945"
>22.1.4. Listing Available Groups</A
></H3
><P
>&#13;


The <B
CLASS="COMMAND"
>list</B
> command lists a number
of different types of information; notably the groups supported by the server:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>list newsgroups</KBD
>
215 Descriptions in form "group description".
control                 News server internal group
junk                    News server internal group
local.general           General local stuff
local.test              Local test group
.</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN17962"
>22.1.5. Listing Active Groups</A
></H3
><P
>&#13;
<CODE
CLASS="OPTION"
>list active</CODE
> shows each supported group and provides information
about them. The two numbers in each line of the output are the high-water
mark and the low-water mark&#8212;that is, the highest numbered article and
lowest numbered article in each group. The newsreader is able to form an
idea of the number of articles in the group from these. We'll talk a little
more about these numbers in a moment. The last field in the output displays flags
that control whether posting is allowed to the group, whether the group is
moderated, and whether articles posted are actually stored or
just passed on. These flags are described in detail in <A
HREF="#X-087-2-INN"
>Chapter 23</A
>. 
An example looks like this:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>list active</KBD
>
215 Newsgroups in form "group high low flags".
control 0000000000 0000000001 y
junk 0000000003 0000000001 y
alt.test 0000000000 0000000001 y
.</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN17974"
>22.1.6. Posting an Article</A
></H3
><P
>&#13;


We mentioned there was a difference between pushing an article and posting
an article. When you are pushing an article, there is an implicit assumption 
that the article already exists, that it has a message identifier that has 
been uniquely assigned to it by the server to which it was originally posted, 
and that it has a complete set of headers. When posting an article, you are 
creating the article for the first time and the only headers you supply are 
those that are meaningful to you, such as the Subject and the Newgroups to 
which you are posting the article. The news server you post the article on 
will add all the other headers for you and create a message ID that it will 
use when pushing the article onto other servers.</P
><P
>All of this means that posting an article is even easier than pushing one.
An example posting looks like this:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>post</KBD
>
340 Ok
<KBD
CLASS="USERINPUT"
>From: terry@richard.geek.org.au
Subject: test message number 1
Newsgroups: junk
Body: 

This is a test message, please feel free to ignore it.

.</KBD
>
240 Article posted</PRE
></FONT
></TD
></TR
></TABLE
><P
>We've generated two more messages like this one to give our following examples
some realism.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN17994"
>22.1.7. Listing New Articles</A
></H3
><P
>&#13;


When a newsreader first connects to a new server and the user chooses a
newsgroup to browse, the newsreader will want to retrieve a list of new
articles, those posted or received since the last login by the user. The
<CODE
CLASS="OPTION"
>newnews</CODE
> command is used for this
purpose. Three mandatory arguments must be supplied: the name of
the group or groups to query, the start date, and the start time from which
to list. The date and time are each specified as six-digit numbers, with the
most significant information first; 
<TT
CLASS="REPLACEABLE"
><I
>yymmdd</I
></TT
> and
<TT
CLASS="REPLACEABLE"
><I
>hhmmss</I
></TT
>, respectively:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>newnews junk 990101 000000</KBD
>
230 New news follows
&#60;7g2o5r$aa$6@news.vbrew.com&#62;
&#60;7g5bhm$8f$2@news.vbrew.com&#62;
&#60;7g5bk5$8f$3@news.vbrew.com&#62;
.</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN18014"
>22.1.8. Selecting a Group on Which to Operate</A
></H3
><P
>&#13;

When the user selects a newsgroup to browse, the newsreader may tell the
news server that the group was selected. This simplifies the interaction
between newsreader and news server; it removes the need to constantly 
send the name of the newsgroup with each command. The 
<CODE
CLASS="OPTION"
>group</CODE
> command simply takes the name of the selected group as 
an argument. Many following commands use the group selected as the 
default, unless another newsgroup is specified explicitly:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>group junk</KBD
>
211 3 1 3 junk</PRE
></FONT
></TD
></TR
></TABLE
><P
>The <CODE
CLASS="OPTION"
>group</CODE
> command returns a message
indicating the number of active messages, the low-water mark, the high-water
mark, and the name of the group, respectively. Note that while the number of
active messages and the high-water mark are the same in our example, this is
not often the case; in an active news server, some articles may have expired
or been deleted, lowering the number of active messages but leaving the 
high-water mark untouched.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN18030"
>22.1.9. Listing Articles in a Group</A
></H3
><P
>&#13;

To address newsgroup articles, the newsreader must know
which article numbers represent active articles. The 
<CODE
CLASS="OPTION"
>listgroup</CODE
> command offers a list of the active 
article numbers in the current group, or an explicit group if the group name is 
supplied:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>listgroup junk</KBD
>
211 Article list follows
1
2
3
.</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN18044"
>22.1.10. Retrieving an Article Header Only</A
></H3
><P
>&#13;


The user must have some information about an article before she can know
whether she wishes to read it. We mentioned earlier that some commands allow the article header and body to be transferred separately. The
<CODE
CLASS="OPTION"
>head</CODE
> command is used to request that the server transmit 
just the header of the specified article to the newsreader. If the user 
doesn't want to read this article, we haven't wasted time and network 
bandwidth transferring a potentially large article body unnecessarily.</P
><P
>Articles may be referenced using either their number (from the 
<CODE
CLASS="OPTION"
>listgroup</CODE
> command) or their message identifier:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>head 2</KBD
>
221 2 &#60;7g5bhm$8f$2@news.vbrew.com&#62; head
Path: news.vbrew.com!not-for-mail
From: terry@richard.geek.org.au
Newsgroups: junk
Subject: test message number 2
Date: 27 Apr 1999 21:51:50 GMT
Organization: The Virtual brewery
Lines: 2
Message-ID: &#60;7g5bhm$8f$2@news.vbrew.com&#62;
NNTP-Posting-Host: localhost
X-Server-Date: 27 Apr 1999 21:51:50 GMT
Body: 
Xref: news.vbrew.com junk:2
.</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN18064"
>22.1.11. Retrieving an Article Body Only</A
></H3
><P
>&#13;
If, on the other hand, the user decides she does want to read the article, her
newsreader needs a way of requesting that the message body be transmitted. The
<CODE
CLASS="OPTION"
>body</CODE
> command is used for this purpose. It operates in much 
the same way as the <CODE
CLASS="OPTION"
>head</CODE
> command, except that only the message 
body is returned:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>body 2</KBD
>
222 2 &#60;7g5bhm$8f$2@news.vbrew.com&#62; body
This is another test message, please feel free to ignore it too.

.</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN18076"
>22.1.12. Reading an Article from a Group</A
></H3
><P
>&#13;


While it is normally most efficient to separately transfer the headers
and bodies of selected articles, there are occasions when we are better off
transferring the complete article. A good example of this is in applications
through which we want to transfer all of the artices in a group without any sort of
preselection, such as when we are using an NNTP cache program like
<B
CLASS="COMMAND"
>leafnode</B
>.<A
NAME="X-087-2-FNNN03"
HREF="#FTN.X-087-2-FNNN03"
><SPAN
CLASS="footnote"
>[134]</SPAN
></A
>&#13;</P
><P
>Naturally, NNTP provides a means of doing this, and not surprisingly, it
operates almost identically to the <CODE
CLASS="OPTION"
>head</CODE
> command as well. 
The <CODE
CLASS="OPTION"
>article</CODE
> command also accepts an article number or 
message ID as an argument, but returns the whole article including its header:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>article 1</KBD
>
220 1 &#60;7g2o5r$aa$6@news.vbrew.com&#62; article
Path: news.vbrew.com!not-for-mail
From: terry@richard.geek.org.au
Newsgroups: junk
Subject: test message number 1
Date: 26 Apr 1999 22:08:59 GMT
Organization: The Virtual brewery
Lines: 2
Message-ID: &#60;7g2o5r$aa$6@news.vbrew.com&#62;
NNTP-Posting-Host: localhost
X-Server-Date: 26 Apr 1999 22:08:59 GMT
Body: 
Xref: news.vbrew.com junk:1

This is a test message, please feel free to ignore it.

.</PRE
></FONT
></TD
></TR
></TABLE
><P
>If you attempt to retrieve an unknown article, the server will return
a message with an appropriately coded response code and perhaps a readable 
text message:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><KBD
CLASS="USERINPUT"
>article 4</KBD
>
423 Bad article number</PRE
></FONT
></TD
></TR
></TABLE
><P
>We've described how the most important NNTP commands are used in this section.
If you're interested in developing software that implements the NNTP protocol,
you should refer to the relevant RFC documents; they provide a great deal of
detail that we couldn't include here.</P
><P
>Let's now look at NNTP in action through the <EM
>nntpd</EM
> server.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NNTP.NNTPD"
>22.2. Installing the NNTP Server</A
></H2
><P
>&#13;The NNTP server (<EM
>nntpd</EM
>) may be compiled in
two ways, depending on the expected load on the news system.  There are no
compiled versions available, because of some site-specific defaults that are
hardcoded into the executable.  All configuration is done through
macros defined in <TT
CLASS="FILENAME"
>common/conf.h</TT
>.</P
><P
><EM
>nntpd</EM
> may be configured as either a standalone server that
is started at system boot time from an <B
CLASS="COMMAND"
>rc</B
> file, or a daemon
managed by <B
CLASS="COMMAND"
>inetd</B
>. In the latter case, you have to have the
following entry in <TT
CLASS="FILENAME"
>/etc/inetd.conf</TT
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>nntp    stream  tcp nowait      news    /usr/etc/in.nntpd    nntpd</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <TT
CLASS="FILENAME"
>inetd.conf</TT
> syntax is described in detail in <A
HREF="#X-087-2-APPL"
>Chapter 12</A
>. If you configure <B
CLASS="COMMAND"
>nntpd</B
> as standalone, 
make sure that any such line in <B
CLASS="COMMAND"
>inetd.conf</B
> is commented 
out. In either case, you have to make sure the following line appears in
<TT
CLASS="FILENAME"
>/etc/services</TT
>:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>nntp    119/tcp   readnews untp    # Network News Transfer Protocol</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>To temporarily store any incoming articles, <B
CLASS="COMMAND"
>nntpd</B
> also needs
a <TT
CLASS="FILENAME"
>.tmp</TT
> directory in your news spool. You should create it
using the following commands:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>mkdir /var/spool/news/.tmp</KBD
>
# <KBD
CLASS="USERINPUT"
>chown news.news /var/spool/news/.tmp</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NNTP.ACCESS"
>22.3. Restricting NNTP Access</A
></H2
><P
>&#13;

Access to NNTP resources is governed by the file
<TT
CLASS="FILENAME"
>nntp_access</TT
> in <TT
CLASS="FILENAME"
>/etc/news</TT
>. Lines
in this file describe the access rights granted to foreign hosts. Each line
has the following format:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
>   read|xfer|both|no    post|no      [!<TT
CLASS="REPLACEABLE"
><I
>exceptgroups</I
></TT
>]</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>If a client connects to the NNTP port, <EM
>nntpd</EM
> attempts to
obtain the host's fully qualified domain name from its IP address using reverse
lookup. The client's hostname and IP address are checked against the
<TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
> field of each entry in the order in which they
appear in the file. Matches may be either partial or exact. If an entry
matches exactly, it applies; if the match is partial, it applies only if there
is no other match following it that is at least as good.
<TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
> may be specified in one of the following ways:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Hostname</DT
><DD
><P
>This is a fully qualified domain name of a host. If this matches the client's
canonical hostname literally, the entry applies, and all following entries are
ignored.</P
></DD
><DT
>IP address</DT
><DD
><P
>This is an IP address in dotted quad notation.  If the client's IP address
matches this, the entry applies, and all following entries are ignored.</P
></DD
><DT
>Domain name</DT
><DD
><P
>This is a domain name, specified as
<SPAN
CLASS="SYSTEMITEM"
>*.</SPAN
><TT
CLASS="REPLACEABLE"
><I
>domain</I
></TT
>.
If the client's hostname matches the domain name, the entry matches.</P
></DD
><DT
>Network name</DT
><DD
><P
>This is the name of a network as specified in
<TT
CLASS="FILENAME"
>/etc/networks</TT
>. If the network number of the client's
IP address matches the network number associated with the network name, the
entry matches.</P
></DD
><DT
>Default</DT
><DD
><P
>The string <TT
CLASS="LITERAL"
>default</TT
> matches any client.</P
></DD
></DL
></DIV
></P
><P
>Entries with a more general site specification should be specified earlier,
because any matches will be overridden by later, more exact matches.</P
><P
>The second and third fields describe the access rights granted to the
client. The second field details the permissions to retrieve news by pulling
(<SPAN
CLASS="SYSTEMITEM"
>read</SPAN
>), and transmit news by pushing
(<SPAN
CLASS="SYSTEMITEM"
>xfer</SPAN
>). A value of
<SPAN
CLASS="SYSTEMITEM"
>both</SPAN
> enables both;
<SPAN
CLASS="SYSTEMITEM"
>no</SPAN
> denies access
altogether. The third field grants the client the right to post
articles, i.e., deliver articles with incomplete header information,
which is completed by the news software.  If the second field contains
<SPAN
CLASS="SYSTEMITEM"
>no</SPAN
>, the third field is ignored.</P
><P
>The fourth field is optional and contains a comma-separated list of groups to 
which the client is denied access.</P
><P
>This is a sample <TT
CLASS="FILENAME"
>nntp_access</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#
# by default, anyone may transfer news, but not read or post
default                 xfer            no
#
# public.vbrew.com offers public access via modem. We allow
# them to read and post to any but the local.* groups
public.vbrew.com        read            post    !local
#
# all other hosts at the brewery may read and post
*.vbrew.com             read            post</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NNTP.AUTHORIZE"
>22.4. NNTP Authorization</A
></H2
><P
>&#13;


The <B
CLASS="COMMAND"
>nntpd</B
> daemon provides a simple authorization scheme.
If you capitalize any of the access tokens in the
<TT
CLASS="FILENAME"
>nntp_access</TT
> file, <B
CLASS="COMMAND"
>nntpd</B
> requires
authorization from the client for the respective operation. For instance,
when specifying a permission of <SPAN
CLASS="SYSTEMITEM"
>Xfer</SPAN
> or
<SPAN
CLASS="SYSTEMITEM"
>XFER</SPAN
>, (as opposed to
<SPAN
CLASS="SYSTEMITEM"
>xfer</SPAN
>), <B
CLASS="COMMAND"
>nntpd</B
> will not
let the client transfer articles to your site unless it passes authorization.</P
><P
>The authorization procedure is implemented by means of a new NNTP command
named <B
CLASS="COMMAND"
>AUTHINFO</B
>. Using this command, the
client transmits a username and a password to the NNTP server.
<B
CLASS="COMMAND"
>nntpd</B
> validates them by checking them against the
<TT
CLASS="FILENAME"
>/etc/passwd</TT
> database and verifies that the user belongs to
the <SPAN
CLASS="SYSTEMITEM"
>nntp</SPAN
> group.</P
><P
>The current implementation of NNTP authorization is only experimental
and has therefore not been implemented very portably.  The result of
this is that it works only with plain-style password databases; shadow
passwords are not recognized. If you are compiling from source and
have the PAM package installed, the password check is fairly simple to 
change.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NNTP.INTERACT"
>22.5. nntpd Interaction with C News</A
></H2
><P
>&#13;
When <B
CLASS="COMMAND"
>nntpd</B
> receives an article, it has to deliver
it to the news subsystem. Depending on whether it was received as a
result of an <B
CLASS="COMMAND"
>IHAVE</B
> or <B
CLASS="COMMAND"
>POST</B
> command, the article is handed to
<B
CLASS="COMMAND"
>rnews</B
> or <B
CLASS="COMMAND"
>inews</B
>,
respectively. Instead of invoking <B
CLASS="COMMAND"
>rnews</B
>, you may
also configure it (at compile time), to batch the incoming articles
and move the resulting batches to
<TT
CLASS="FILENAME"
>/var/spool/news/in.coming</TT
>, where they are left
for <B
CLASS="COMMAND"
>relaynews</B
> to pick them up at the next queue
run.</P
><P
>&#13;
<B
CLASS="COMMAND"
>nntpd</B
> has to have access to the
<TT
CLASS="FILENAME"
>history</TT
> file to be able to properly perform the 
ihave/sendme protocol. At compile time, you have to
make sure the path to that file is set correctly.  If you use C News, make 
sure that C News and <B
CLASS="COMMAND"
>nntpd</B
> agree on the format of your 
history file. C News uses <TT
CLASS="FILENAME"
>dbm</TT
> hashing functions to 
access it; however, there are quite a number of different and slightly 
incompatible implementations of the <TT
CLASS="FILENAME"
>dbm</TT
> library.  If 
C News has been linked with a different <TT
CLASS="FILENAME"
>dbm</TT
> library 
than you have in your standard <TT
CLASS="FILENAME"
>libc</TT
>, you have to 
link <B
CLASS="COMMAND"
>nntpd</B
> with this library, too.</P
><P
>&#13;<B
CLASS="COMMAND"
>nntpd</B
> and C news disagreement sometimes produces error 
messages in the system log that <B
CLASS="COMMAND"
>nntpd</B
> can not open it 
properly, or you might see duplicate articles being received via NNTP.  A 
good test of a malfunctioning news transfer is to pick an article from your
spool area, telnet to the <EM
>nntp</EM
> port, 
and offer it to <B
CLASS="COMMAND"
>nntpd</B
> as shown in the next example. Of 
course, you have to replace <TT
CLASS="REPLACEABLE"
><I
>msg@id</I
></TT
> with the
message ID of the article you want to feed to <B
CLASS="COMMAND"
>nntpd</B
>:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>telnet localhost nntp</KBD
>
Trying 127.0.0.1...
Connected to localhost
Escape characters is '^ ]'.
201 vstout NNTP[auth] server version 1.5.11t (16 November 1991) ready at
Sun Feb 6 16:02:32 1194 (no posting)
<KBD
CLASS="USERINPUT"
>IHAVE</KBD
> <TT
CLASS="REPLACEABLE"
><I
>msg@id</I
></TT
>
435 Got it.
<KBD
CLASS="USERINPUT"
>QUIT</KBD
></PRE
></FONT
></TD
></TR
></TABLE
><P
>This conversation shows <B
CLASS="COMMAND"
>nntpd</B
>'s proper reaction;
the message <TT
CLASS="LITERAL"
>Got it</TT
> tells you that it already
has this article. If you get a message of
<B
CLASS="COMMAND"
>335 Ok</B
> instead, the lookup in the history
file failed for some reason. Terminate the conversation by typing Ctrl-D.
You can check what has gone wrong by checking the system log;
<B
CLASS="COMMAND"
>nntpd</B
> logs all kinds of messages to the
<SPAN
CLASS="SYSTEMITEM"
>daemon</SPAN
> facility of
<B
CLASS="COMMAND"
>syslog</B
>. An incompatible <TT
CLASS="FILENAME"
>dbm</TT
> library
usually manifests itself in a message complaining that
<CODE
CLASS="FUNCTION"
>dbminit</CODE
> failed.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-INN"
></A
>Chapter 23. Internet News</H1
><P
>The Internet News daemon (INN) is arguably the most popular Netnews
server in use today. INN is extremely flexible and is suitable for all
but the smallest news sites.<A
NAME="X-087-2-FNIN01"
HREF="#FTN.X-087-2-FNIN01"
><SPAN
CLASS="footnote"
>[135]</SPAN
></A
> INN scales well and is suited to large news server
configurations.</P
><P
>The INN server comprises a number of components, each with their own
configuration files that we will discuss in turn. Configuration of INN
can be a little involved, but we'll describe each of the stages in this
chapter and arm you with enough information to make
sense of the INN manual pages and documentation and build configurations for
just about any application.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN18283"
>23.1. Some INN Internals</A
></H2
><P
>&#13;INN's core program is the <B
CLASS="COMMAND"
>innd</B
> daemon.
<B
CLASS="COMMAND"
>innd&#8201;</B
>'s task is to handle all incoming articles,
storing them locally, and to pass them on to any outgoing newsfeeds if
required.  It is started at boot time and runs continually as a background
process. Running as a daemon improves performance because it has to read 
its status files only once when starting. Depending
on the volume of your news feed, certain files such as
<TT
CLASS="FILENAME"
>history</TT
> (which contain a list of all recently
processed articles) may range from a few megabytes to tens of megabytes.</P
><P
>Another important feature of INN is that there is always only one
instance of <B
CLASS="COMMAND"
>innd</B
> running at any time. This is also very 
beneficial to performance, because the daemon can process all articles
without having to worry about synchronizing its internal states with
other copies of <B
CLASS="COMMAND"
>innd</B
> rummaging around the news spool at
the same time. However, this choice affects the overall design
of the news system. Because it is so important that incoming news is
processed as quickly as possible, it is unacceptable that the server be
tied up with such mundane tasks as serving newsreaders accessing the news
spool via NNTP, or decompressing newsbatches arriving via UUCP. Therefore,
these tasks have been broken out of the main server and implemented in separate support programs.
<A
HREF="#X-087-2-INN.INN.ARCHITECTURE"
>Figure 23-1</A
> attempts to illustrate the
relationships between <B
CLASS="COMMAND"
>innd</B
>, the other local tasks, and
remote news servers and newsreaders.</P
><P
>&#13;


Today, NNTP is the most common means of transporting news articles around,
and <B
CLASS="COMMAND"
>innd</B
> doesn't directly support anything else.
This means that <B
CLASS="COMMAND"
>innd</B
> listens on a TCP socket (port 119)
for connections and accepts news articles using the &#8220;ihave&#8221;
protocol.</P
><P
>Articles arriving by transports other than NNTP are supported indirectly
by having another process accept the articles and forward them to
<B
CLASS="COMMAND"
>innd</B
> via NNTP. Newsbatches coming in over a UUCP link,
for instance, are traditionally handled by the <B
CLASS="COMMAND"
>rnews</B
>
program. INN's <B
CLASS="COMMAND"
>rnews</B
> decompresses the batch if necessary,
and breaks it up into individual articles; it then offers them to
<B
CLASS="COMMAND"
>innd</B
> one by one.</P
><P
>Newsreaders can deliver news when a user
posts an article. Since the handling of newsreaders deserves special 
attention, we will come back to this a little later.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-INN.INN.ARCHITECTURE"
></A
><P
><B
>Figure 23-1. INN architecture (simplified for clarity)</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_2301.jpg"></P
></DIV
></DIV
><P
>When receiving an article, <B
CLASS="COMMAND"
>innd</B
> first looks up its
message ID in the <TT
CLASS="FILENAME"
>history</TT
> file. Duplicate
articles are dropped and the occurrences are optionally logged. The
same goes for articles that are too old or lack some required header
field, such as <TT
CLASS="LITERAL"
>Subject:</TT
>.<A
NAME="AEN18328"
HREF="#FTN.AEN18328"
><SPAN
CLASS="footnote"
>[136]</SPAN
></A
> If <B
CLASS="COMMAND"
>innd</B
> finds
that the article is acceptable, it looks at the
<TT
CLASS="LITERAL"
>Newsgroups:</TT
> header line to find out what groups it
has been posted to. If one or more of these groups are found in the
<TT
CLASS="FILENAME"
>active</TT
> file, the article is filed to
disk. Otherwise, it is filed to the special group <SPAN
CLASS="SYSTEMITEM"
>junk</SPAN
>.</P
><P
>Individual articles are kept below <TT
CLASS="FILENAME"
>/var/spool/news</TT
>, also
called the <EM
>news spool</EM
>. Each newsgroup has a
separate directory, in which each article is stored in a separate file. The
file names are consecutive numbers, so that an article in
<SPAN
CLASS="SYSTEMITEM"
>comp.risks</SPAN
> may be filed
as <TT
CLASS="FILENAME"
>comp/risks/217</TT
>, for instance. When
<B
CLASS="COMMAND"
>innd</B
> finds that the directory it wants to store the
article in does not exist, it creates it automatically.</P
><P
>&#13;Apart from storing articles locally, you may also want to pass them on to
outgoing feeds. This is governed by the <TT
CLASS="FILENAME"
>newsfeeds</TT
> file
that lists all downstream sites along with the newsgroups that should be fed
to them.</P
><P
>Just like <B
CLASS="COMMAND"
>innd&#8201;</B
>'s receiving end, the
processing of outgoing news is handled by a single interface, too.
Instead of doing all the transport-specific handling itself,
<B
CLASS="COMMAND"
>innd</B
> relies on various backends to manage the
transmission of articles to other news servers.  Outgoing facilities
are collectively dubbed <EM
>channels</EM
>.  Depending on
its purpose, a channel can have different attributes that determine
exactly what information <B
CLASS="COMMAND"
>innd</B
> passes on to it.</P
><P
>&#13;For an outgoing NNTP feed, for instance, <B
CLASS="COMMAND"
>innd</B
> might
fork the <B
CLASS="COMMAND"
>innxmit</B
> program at startup, and, for each
article that should be sent across that feed, pass its message ID,
size, and filename to <B
CLASS="COMMAND"
>innxmit</B
>&#8201;'s standard input. For
an outgoing UUCP feed, on the other hand, it might write the article's
size and file name to a special logfile, which is head by a different
process at regular intervals in order to create batches and queue them
to the UUCP subsystem.</P
><P
>Besides these two examples, there are other types of channels that are
not strictly outgoing feeds. These are used, for instance, when
archiving certain newsgroups, or when generating overview
information. Overview information is intended to help newsreaders
thread articles more efficiently.  Old-style newsreaders had to scan
all articles separately in order to obtain the header information
required for threading. This would put an immense strain on the server
machine, especially when using NNTP; furthermore, it was very
slow.<A
NAME="AEN18357"
HREF="#FTN.AEN18357"
><SPAN
CLASS="footnote"
>[137]</SPAN
></A
> The
overview mechanism alleviates this problem by prerecording all
relevant headers in a separate file (called
<TT
CLASS="FILENAME"
>.overview</TT
>) for each newsgroup. This information
can then be picked up by newsreaders either by reading it directly
from the spool directory, or by using the <B
CLASS="COMMAND"
>XOVER</B
>
command when connected via NNTP. INN has the <B
CLASS="COMMAND"
>innd</B
>
daemon feed all articles to the <B
CLASS="COMMAND"
>overchan</B
> command,
which is attached to the daemon through a channel. We'll see how this
is done when we discuss configuring news feeds later.&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN18364"
>23.2. Newsreaders and INN</A
></H2
><P
>&#13;
Newsreaders running on the same machine as the server (or having mounted 
the server's news spool via NFS) can read articles from the
spool directly. To post an article composed by the user, they invoke the
<B
CLASS="COMMAND"
>inews</B
> program, which adds any header fields that are
missing and forwards them to the daemon via NNTP.</P
><P
>&#13;Alternatively, newsreaders can access the server remotely via
NNTP. This type of connection is handled differently from NNTP-based
news feeds, to avoid tying up the daemon. Whenever a newsreader
connects to the NNTP server, <B
CLASS="COMMAND"
>innd</B
> forks a
separate program called <B
CLASS="COMMAND"
>nnrpd</B
>, which handles
the session while <B
CLASS="COMMAND"
>innd</B
> returns to the more
important things (receiving incoming news, for
example).<A
NAME="AEN18380"
HREF="#FTN.AEN18380"
><SPAN
CLASS="footnote"
>[138]</SPAN
></A
> You may be wondering how the
<B
CLASS="COMMAND"
>innd</B
> process can distinguish between an incoming
news feed and a connecting newsreader. The answer is quite simple: the
NNTP protocol requires that an NNTP-based newsreader issue a
<B
CLASS="COMMAND"
>mode reader</B
> command after connecting to the server;
when this command is received, the server starts the
<B
CLASS="COMMAND"
>nnrpd</B
> process, hands the connection to it, and
returns to listening for connections from another news server. There
used to be at least one DOS-based newsreader which was not configured
to do this, and hence failed miserably when talking to INN, because
<B
CLASS="COMMAND"
>innd</B
> itself does not recognize any of the commands
used to read news if it doesn't know the connection is from a news
reader.</P
><P
>We'll talk a little more about newsreader access to INN under
"Controlling Newsreader Access," later in the chapter.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN18387"
>23.3. Installing INN</A
></H2
><P
>&#13;
Before diving into INN's configuration, let's talk about its installation. 
Read this section, even if you've installed INN from one of the various
Linux distributions; it contains some hints about security and compatibility.</P
><P
>Linux distributions included Verson INN-1.4sec for quite some time.
Unfortunately, this version had two subtle security problems. Modern
versions don't have these problems and most distributions include
a precompiled Linux binary of INN Version 2 or later.</P
><P
>If you choose, you can build INN yourself. You can obtain the
source from <SPAN
CLASS="SYSTEMITEM"
>ftp.isc.org</SPAN
> in the
<TT
CLASS="FILENAME"
>/isc/inn/</TT
> directory. Building INN requires that
you edit a configuration file that tells INN some detail about your
operating system, and some features may require minor modifications to
the source itself.</P
><P
>Compiling the package itself is pretty simple; there's a script called
<B
CLASS="COMMAND"
>BUILD</B
> that will guide you through the process. The
source also contains extensive documentation on how to install and
configure INN.</P
><P
>After installing all binaries, some manual fixups may be required to
reconcile INN with any other applications that may want to access its
<B
CLASS="COMMAND"
>rnews</B
> or <B
CLASS="COMMAND"
>inews</B
> programs. UUCP,
for instance, expects to find the <B
CLASS="COMMAND"
>rnews</B
> program in
<TT
CLASS="FILENAME"
>/usr/bin</TT
> or <TT
CLASS="FILENAME"
>/bin</TT
>, while INN
installs it in <TT
CLASS="FILENAME"
>/usr/lib/bin</TT
> by default. Make sure
<TT
CLASS="FILENAME"
>/usr/lib/bin/</TT
> is in the default search path, or
that there are symbolic links pointing to the actual location of the
<B
CLASS="COMMAND"
>rnews</B
> and <B
CLASS="COMMAND"
>inews</B
> commands.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN18412"
>23.4. Configuring INN: the Basic Setup</A
></H2
><P
>One of the greatest obstacles beginners may face is that INN requires a
working network setup to function properly, even when running on a standalone
host. Therefore, it is essential that your kernel supports TCP/IP networking 
when running INN, and that you have set up the loopback interface as
explained in <A
HREF="#X-087-2-IFACE"
>Chapter 5</A
>.</P
><P
>Next, you have to make sure that <B
CLASS="COMMAND"
>innd</B
> is started at
boot time. The default INN installation provides a script file called
<TT
CLASS="FILENAME"
>boot</TT
> in the <TT
CLASS="FILENAME"
>/etc/news/</TT
>
directory.  If your distribution uses the SystemV-style
<B
CLASS="COMMAND"
>init</B
> package, all you have to do is create a
symbolic link from your <TT
CLASS="FILENAME"
>/etc/init.d/inn</TT
> file
pointing to <TT
CLASS="FILENAME"
>/etc/news/boot</TT
>. For other flavors of
<B
CLASS="COMMAND"
>init</B
>, you have to make sure
<TT
CLASS="FILENAME"
>/etc/news/boot</TT
> is executed from one of your
<TT
CLASS="FILENAME"
>rc</TT
> scripts. Since INN requires networking
support, the startup script should be run <EM
>after</EM
>
the network interfaces are configured.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN18427"
>23.5. INN Configuration Files</A
></H2
><P
>&#13;
Having completed these general tasks, you can now turn to the really
interesting part of INN: its configuration files. All these files reside in
<TT
CLASS="FILENAME"
>/etc/news</TT
>. Some changes to configurations files were
introduced in Version 2, and it is Version 2 that we describe here. If you're
running an older version, you should find this chapter useful to guide you in
upgrading your configuration. During the next few sections, we will discuss
them one by one, building the Virtual Brewery's configuration as an example.</P
><P
>If you want to find out more about the features of individual configuration
files, you can also consult the manual pages; the INN distribution contains
individual manual pages for each of them.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN18438"
>23.5.1. Global Parameters</A
></H3
><P
>&#13;There are a number of INN parameters that are global in nature; they
are relevant to all newsgroups carried.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN18444"
>23.5.1.1. The inn.conf file</A
></H4
><P
>&#13;INN's main configuration file is <TT
CLASS="FILENAME"
>inn.conf</TT
>. Among other
things, it determines the name by which your machine is known on Usenet.
Version 2 of INN allows a baffling number of parameters to be configured in 
this file. Fortunately, most parameters have default values that are 
reasonable for most sites. The <TT
CLASS="FILENAME"
>inn.conf(5)</TT
> file details 
all of the parameters, and you should read it carefully if you experience any 
problems.</P
><P
>A simple example <TT
CLASS="FILENAME"
>inn.conf</TT
> might look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># Sample inn.conf for the Virtual Brewery
server:          vlager.vbrew.com
domain:          vbrew.com
fromhost:        vbrew.com
pathhost:        news.vbrew.com
organization:    The Virtual Brewery
mta:             /usr/sbin/sendmail -oi %s
moderatormailer: %s@uunet.uu.net
#
# Paths to INN components and files.
#
pathnews:               /usr/lib/news
pathbin:                /usr/lib/news/bin
pathfilter:             /usr/lib/news/bin/filter
pathcontrol:            /usr/lib/news/bin/control
pathdb:                 /var/lib/news
pathetc:                /etc/news
pathrun:                /var/run/news
pathlog:                /var/log/news
pathhttp:               /var/log/news
pathtmp:                /var/tmp
pathspool:              /var/spool/news
patharticles:           /var/spool/news/articles
pathoverview:           /var/spool/news/overview
pathoutgoing:           /var/spool/news/outgoing
pathincoming:           /var/spool/news/incoming
patharchive:            /var/spool/news/archive
pathuniover:            /var/spool/news/uniover
overviewname:           .overview</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The first line tells the programs <B
CLASS="COMMAND"
>rnews</B
> and
<B
CLASS="COMMAND"
>inews</B
> which host to contact when delivering articles.
This entry is absolutely crucial; to pass articles to
<B
CLASS="COMMAND"
>innd</B
>, they have to establish an NNTP connection with
the server.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>domain</SPAN
> keyword should specify
the domain portion of the host's fully qualified domain name. A couple of
programs must look up your host's fully qualified domain name; if your
resolver library returns the unqualified hostname only, the name given in the
<SPAN
CLASS="SYSTEMITEM"
>domain</SPAN
> attribute is tacked onto it. It's not a problem to configure it either way, so it's best
to define <SPAN
CLASS="SYSTEMITEM"
>domain</SPAN
>.</P
><P
>The next line defines what hostname <B
CLASS="COMMAND"
>inews</B
> is going to use
when adding a <TT
CLASS="REPLACEABLE"
><I
>From:</I
></TT
> line to articles posted by local users.
Most newsreaders use the <TT
CLASS="REPLACEABLE"
><I
>From:</I
></TT
> field when composing a
reply mail message to the author of an article. If you omit this field, it
will default to your news host's fully qualifed domain name. This is ot
always the best choice. You might, for example, have news and mail handled
by two different hosts. In this case, you would supply the fully qualified
domain name of your mail host after the
<SPAN
CLASS="SYSTEMITEM"
>fromhost</SPAN
> statement.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>pathhost</SPAN
> line defines the hostname
INN is to add to the <TT
CLASS="LITERAL"
>Path:</TT
> header field whenever it
receives an article. In most cases, you will want to use the fully
qualified domain name of your news server; you can then omit this field since
that is the default. Occasionally you may want to use a generic name, such as
<EM
>news.vbrew.com</EM
>, when serving a large
domain. Doing this allows you to move the news system easily to a different
host, should you choose to at some time.</P
><P
>The next line contains the <SPAN
CLASS="SYSTEMITEM"
>organization</SPAN
>
keyword.  This statement allows you to configure what text
<B
CLASS="COMMAND"
>inews</B
> will put into the <TT
CLASS="LITERAL"
>Organization:</TT
>
line of articles posted by your local users. Formally, you would place a
description of your organization or your organization's name in full here.
Should you not wish to be so formal, it is fashionable for organizations with
a sense of humor to exhibit it here.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>organization</SPAN
> keyword is mandatory
and specifies the pathname of the mail transport agent that will be used
for posting moderator messages. <TT
CLASS="LITERAL"
>%s</TT
> is replaced by the 
moderator email address.</P
><P
>The <SPAN
CLASS="SYSTEMITEM"
>moderatormailer</SPAN
> entry defines a
default address used when a user tries to post to a moderated newsgroup. The
list of moderator addresses for each newsgroup is usually kept in a separate
file, but you will have a hard time keeping track of all of them. The
<SPAN
CLASS="SYSTEMITEM"
>moderatormailer</SPAN
> entry is therefore
consulted as a last resort; if it is defined, <B
CLASS="COMMAND"
>inews</B
> will
replace the <TT
CLASS="LITERAL"
>%s</TT
> string with the (slightly transformed)
newsgroup name and send the entire article to this address. For instance, 
when posting to <SPAN
CLASS="SYSTEMITEM"
>soc.&#8201;feminism</SPAN
>, the 
article is mailed to 
<SPAN
CLASS="SYSTEMITEM"
>soc-feminism@uunet.uu.net</SPAN
>, given
the above configuration. At UUNET, there should be a mail alias installed for
each of these submissions addresses that automatically forwards all messages
to the appropriate moderator.</P
><P
>Finally, each of the remaining entries specifies the location of some component
file or executable belonging to INN. If you've installed INN from a package,
these paths should have been configured for you. If you're installing from
source, you'll need to ensure that they reflect where you've installed INN.</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN18487"
>23.5.2. Configuring Newsgroups</A
></H3
><P
>&#13;

The news administrator on a system is able to control which newsgroups
users have access to. INN provides two configuration files that
allow the administrator to decide which newsgroups to support and provide
descriptions for them.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN18500"
>23.5.2.1. The active and newsgroups files</A
></H4
><P
>&#13;
The <TT
CLASS="FILENAME"
>active</TT
> and <TT
CLASS="FILENAME"
>newsgroups</TT
> files
are used to store and describe the newsgroups hosted by this news server.
They list which newsgroups we are interested in receiving and serving
articles for, and administrative information about them. These files are 
found in the <TT
CLASS="FILENAME"
>/var/lib/news/</TT
> directory.</P
><P
>The <TT
CLASS="FILENAME"
>active</TT
> file determines which newsgroups this
server supports. Its syntax is straightforward. Each line in the
<TT
CLASS="FILENAME"
>active</TT
> file has four fields delimited by whitespace:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>name himark lomark flags</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
> field is the name of the
newsgroup.  The <TT
CLASS="REPLACEABLE"
><I
>himark</I
></TT
> field is the highest
number that has been used for an article in that newsgroup. The
<TT
CLASS="REPLACEABLE"
><I
>lomark</I
></TT
> field is the lowest active number in
use in the newsgroup. To illustrate how this works, consider the
follow scenario.  Imagine that we have a newly created newsgroup:
<TT
CLASS="REPLACEABLE"
><I
>himark</I
></TT
> and
<TT
CLASS="REPLACEABLE"
><I
>lowmark</I
></TT
> are both 0 because there are no
articles. If we post 5 articles, they will be numbered 1 through
5. <TT
CLASS="REPLACEABLE"
><I
>himark</I
></TT
> will now equal 5, the highest
numbered article, and <TT
CLASS="REPLACEABLE"
><I
>lowmark</I
></TT
> will equal 1,
the lowest active article. If article 5 is cancelled there will be no
change; <TT
CLASS="REPLACEABLE"
><I
>himark</I
></TT
> will remain at 5 to ensure
that the article number is not reallocated and
<TT
CLASS="REPLACEABLE"
><I
>lowmark</I
></TT
> will remain at 1, the lowest active
article. If we now cancel article 1, <TT
CLASS="REPLACEABLE"
><I
>himark</I
></TT
>
will remain unchanged, but <TT
CLASS="REPLACEABLE"
><I
>lowmark</I
></TT
> will now
equal 2, because 1 is no longer active. If we now post a new article,
it will be assigned article number 6, so
<TT
CLASS="REPLACEABLE"
><I
>himark</I
></TT
> will now equal 6. Article 5 has been
in use, so we won't reassign it. <TT
CLASS="REPLACEABLE"
><I
>lowmark</I
></TT
>
remains at 2. This mechanism allows us to easily allocate unique
article numbers for new articles and to calculate approximately how
many active articles there are in the group:
<TT
CLASS="REPLACEABLE"
><I
>himark</I
></TT
>&#8211;<TT
CLASS="REPLACEABLE"
><I
>lowmark</I
></TT
>.</P
><P
>The field may contain one of the following:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>y</DT
><DD
><P
>Posting directly to this news server is allowed. </P
></DD
><DT
>n</DT
><DD
><P
>Posting directly to this news server is not allowed. This prevents newsreaders
from posting directly to this news server. New articles may only be received
from other news servers.</P
></DD
><DT
>m</DT
><DD
><P
>The group is moderated. Any articles posted to this newsgroup are forwarded 
to the newsgroup moderator for approval before they enter the newsgroup. Most 
newsgroups are unmoderated.</P
></DD
><DT
>j</DT
><DD
><P
>Articles in this group are not kept, but only passed on. This causes the
news server to accept the article, but all it will do with it is pass it to
the &#8220;up-stream&#8221; news servers. It will not make the articles
available to newsreaders reading from this server.</P
></DD
><DT
>x</DT
><DD
><P
>Articles cannot be posted to this newsgroup. The only way that news articles
are delivered to this server is by feeding them from another news server.
Newsreaders may not directly write articles to this server.</P
></DD
><DT
>=<TT
CLASS="REPLACEABLE"
><I
>foo.bar</I
></TT
></DT
><DD
><P
>Articles are locally filed into the ``foo.bar'' group.</P
></DD
></DL
></DIV
>

In our simple server configuration we'll carry a small number of
newsgroups, so our <TT
CLASS="FILENAME"
>/var/lib/news/active</TT
> file will
look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>control 0000000000 0000000001 y
junk 0000000000 0000000001 y
rec.crafts.brewing 0000000000 0000000001 y
rec.crafts.brewing.ales 0000000000 0000000001 y
rec.crafts.brewing.badtaste 0000000000 0000000001 y
rec.crafts.brewing.brandy 0000000000 0000000001 y
rec.crafts.brewing.champagne 0000000000 0000000001 y
rec.crafts.brewing.private 0000000000 0000000001 y</PRE
></FONT
></TD
></TR
></TABLE
>

The <TT
CLASS="REPLACEABLE"
><I
>himark</I
></TT
> and <TT
CLASS="REPLACEABLE"
><I
>lomark</I
></TT
> 
numbers in this example are those you would use when creating new newsgroups. 
The <TT
CLASS="REPLACEABLE"
><I
>himark</I
></TT
> and <TT
CLASS="REPLACEABLE"
><I
>lomark</I
></TT
> 
numbers will look quite different for a newsgroup that has been active for 
some time.</P
><P
>The <TT
CLASS="FILENAME"
>newsgroups</TT
> file is even simpler. It provides 
one-line descriptions of newsgroups. Some newsreaders are
able to read and present this information to a user to help them decide 
whether they want to subscribe.</P
><P
>The format of the <TT
CLASS="FILENAME"
>newsgroups</TT
> file is simply:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>name description</PRE
></FONT
></TD
></TR
></TABLE
>

The <TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
> field is the name of a newsgroup, and the &#60;<TT
CLASS="REPLACEABLE"
><I
>description</I
></TT
> is a single line description of that newsgroup.</P
><P
>We want to describe the newsgroups that our server supports, so we'll build
our <TT
CLASS="FILENAME"
>newsgroups</TT
> file as follows:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>rec.crafts.brewing.ales         Home brewing Ales and Lagers
rec.crafts.brewing.badtaste     Home brewing foul tasting brews
rec.crafts.brewing.brandy       Home brewing your own Brandy
rec.crafts.brewing.champagne    Home brew your own Champagne
rec.crafts.brewing.private      The Virtual Brewery home brewers group</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN18576"
>23.5.3. Configuring Newsfeeds</A
></H3
><P
>&#13;

INN provides the news administrator the ability to control which
newsgroups are forwarded on to other news servers and how they will be
forwarded. The most common method uses the NNTP protocol described
earlier, but INN also allows newsfeeds via other protocols, such as UUCP.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN18588"
>23.5.3.1. The newsfeeds file</A
></H4
><P
>&#13;The <TT
CLASS="FILENAME"
>newsfeeds</TT
> file determines where news articles
will be sent. It normally resides in the <TT
CLASS="FILENAME"
>/etc/news/</TT
>
directory.</P
><P
>The format of the <TT
CLASS="FILENAME"
>newsfeeds</TT
> is a little complicated at
first. We'll describe the general layout here, and the
<TT
CLASS="FILENAME"
>newsfeeds(5)</TT
> manual page describes
what we leave out. The format is as follows:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># newsfeeds file format
site:pattern:flags:param
site2:pattern2\
	:flags2:param2</PRE
></FONT
></TD
></TR
></TABLE
>

Each news feed to a site is described by a single line, or may be
spread across multiple lines using the \ continuation character. The
: characters delimit the fields in each line. The # character at the
start of a line marks that line as a comment.</P
><P
>The <TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
> field names the site to which this feed
description relates. The sitename can be coded any way you like and
doesn't have to be the domain name of the site. The site name will be
used later and will refer to an entry in a table that supplies the
hostname to the <B
CLASS="COMMAND"
>innxmit</B
> program that transmits the
news articles by NNTP to the remote server. You may have multiple
entries for each site; each entry will be treated individually.</P
><P
>The <TT
CLASS="REPLACEABLE"
><I
>pattern</I
></TT
> field specifies which news groups are
to be sent to this site. The default is to send all groups, so if that
is what you want, just make this field empty. This field is usually a
comma-delimited list of pattern-matching expressions. The * character
matches zero or more of any character, the . character has no special
significance, the ! character (if used at the start of an expression)
performs a logical NOT, and the @ character at the start of a
newsgroup name means &#8220;Do not forward any articles that are
posted or crossposted to this group.&#8221; The list is read and
parsed from left to right, so you should ensure that you place the
more specific rules first.  The pattern:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>rec.crafts.brewing*,!rec.crafts.brewing.poison,@rec.crafts.brewing.private</PRE
></FONT
></TD
></TR
></TABLE
><P
>would send all of the <EM
>rec.crafts.brewing</EM
> news heirarchy
<EM
>except</EM
> the <EM
>rec.crafts.brewing.poison</EM
>. 
It would not feed any articles that were either posted or crossposted to the
<EM
>rec.crafts.brewing.private</EM
> newsgroup; these articles will
be trapped and available only to those people who use this server.
If you reversed the first two patterns, the first pattern would be overridden
by the second and you would end up feeding articles for the
<EM
>rec.crafts.brewing.poison</EM
> newsgroup. The same is true of
the first and last patterns; you must always place the more specific
patterns before any less specific patterns for them to take effect.</P
><P
><TT
CLASS="REPLACEABLE"
><I
>flags</I
></TT
> controls and places constraints on the feed
of news articles to this site. The <TT
CLASS="REPLACEABLE"
><I
>flags</I
></TT
> field is a
comma delimited list can contain any of the items from the following list, delimited by commands:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>&#60;<TT
CLASS="REPLACEABLE"
><I
>size</I
></TT
></DT
><DD
><P
>Article must be less then size bytes.</P
></DD
><DT
><TT
CLASS="LITERAL"
>A</TT
><TT
CLASS="REPLACEABLE"
><I
>items</I
></TT
></DT
><DD
><P
>Article checks. <TT
CLASS="REPLACEABLE"
><I
>items</I
></TT
> can be one or more of
<TT
CLASS="LITERAL"
>d</TT
> (must have Distribution header) or
<TT
CLASS="LITERAL"
>p</TT
> (don't check for site in Path header).</P
></DD
><DT
><TT
CLASS="LITERAL"
>B</TT
><TT
CLASS="REPLACEABLE"
><I
>high</I
></TT
>/<TT
CLASS="REPLACEABLE"
><I
>low</I
></TT
></DT
><DD
><P
>Internal buffer size before writing to output.</P
></DD
><DT
><TT
CLASS="LITERAL"
>H</TT
>[<TT
CLASS="REPLACEABLE"
><I
>count</I
></TT
>]</DT
><DD
><P
>Article must have less then <TT
CLASS="REPLACEABLE"
><I
>count</I
></TT
> hops; the default is 1.</P
></DD
><DT
><TT
CLASS="LITERAL"
>I</TT
><TT
CLASS="REPLACEABLE"
><I
>size</I
></TT
></DT
><DD
><P
>Internal buffer size (for a file feed).</P
></DD
><DT
><TT
CLASS="LITERAL"
>M</TT
><TT
CLASS="REPLACEABLE"
><I
>pattern</I
></TT
></DT
><DD
><P
>Only moderated groups that match the pattern.</P
></DD
><DT
><TT
CLASS="LITERAL"
>N</TT
><TT
CLASS="REPLACEABLE"
><I
>pattern</I
></TT
></DT
><DD
><P
>Only unmoderated groups that match the pattern.</P
></DD
><DT
><TT
CLASS="LITERAL"
>S</TT
><TT
CLASS="REPLACEABLE"
><I
>size</I
></TT
></DT
><DD
><P
>Start spooling if more than size bytes get queued.</P
></DD
><DT
><TT
CLASS="LITERAL"
>T</TT
><TT
CLASS="REPLACEABLE"
><I
>type</I
></TT
></DT
><DD
><P
>Feed types: <TT
CLASS="LITERAL"
>f</TT
> (file), <TT
CLASS="LITERAL"
>m</TT
> (funnel; the
<TT
CLASS="REPLACEABLE"
><I
>param</I
></TT
> field names the entry that articles will be
funneled to), <TT
CLASS="LITERAL"
>p</TT
> (pipe to program), <TT
CLASS="LITERAL"
>c</TT
>
(send to stdin channel of the <TT
CLASS="REPLACEABLE"
><I
>param</I
></TT
> field's
subprocess), and <TT
CLASS="LITERAL"
>x</TT
> (like c, but handles commands on stdin).</P
></DD
><DT
><TT
CLASS="LITERAL"
>W</TT
><TT
CLASS="REPLACEABLE"
><I
>items</I
></TT
></DT
><DD
><P
>What to write: <TT
CLASS="LITERAL"
>b</TT
> (article bytesize), <TT
CLASS="LITERAL"
>f</TT
>
(full path), <TT
CLASS="LITERAL"
>g</TT
> (first newsgroup), <TT
CLASS="LITERAL"
>m</TT
>
(Message ID), <TT
CLASS="LITERAL"
>n</TT
> (relative path), <TT
CLASS="LITERAL"
>s</TT
> (site
that fed article), <TT
CLASS="LITERAL"
>t</TT
> (time received), <TT
CLASS="LITERAL"
>*</TT
>
(names of funnel feed-ins or all sites that get the article),
<TT
CLASS="LITERAL"
>N</TT
> (newsgroups header), <TT
CLASS="LITERAL"
>D</TT
> (distribution
header), <TT
CLASS="LITERAL"
>H</TT
> (all headers), <TT
CLASS="LITERAL"
>O</TT
> (overview
data), and <TT
CLASS="LITERAL"
>R</TT
> (replication data).</P
></DD
></DL
></DIV
><P
>The <TT
CLASS="LITERAL"
>param</TT
> field has special coding that is dependent on
the type of feed. In the most common configuration it is where you specify
the name of the output file to which you will write the outgoing feed.
In other configurations you can leave it out. In yet other configurations
it takes on different meanings. If you want to do something unusual, the
<TT
CLASS="FILENAME"
>newsfeeds(5)</TT
> manual page will explain the use of the
<TT
CLASS="LITERAL"
>param</TT
> field in some detail.</P
><P
>There is a special site name that should be coded as <TT
CLASS="LITERAL"
>ME</TT
>
and should be the first entry in the file. This entry is used to control
the default settings for your news feeds. If the <TT
CLASS="LITERAL"
>ME</TT
>
entry has a distribution list associated with it, this list will
be prepended to each of the other site entries before they are sent.
This allows you to, for example, declare some
newsgroups to be automatically fed, or automatically blocked from
feeding, without having to repeat the pattern in each site entry.</P
><P
>We mentioned earlier that it was possible to use some special feeds to
generate thread data that makes the newsreader's job easier. We'll do this
by exploiting the <B
CLASS="COMMAND"
>overchan</B
> command that is part of the
INN distribution. To do this, we've created a special local feed called
<TT
CLASS="LITERAL"
>overview</TT
> that will pass the news articles to the
<B
CLASS="COMMAND"
>overchan</B
> command for processing into overview data.</P
><P
>Our news server will provide only one external news feed, which goes to 
the Groucho Marx University, and they receive articles for
all newsgroups except the <EM
>control</EM
> and
<EM
>junk</EM
> newsgroups, the
<EM
>rec.crafts.brewing.private</EM
> newsgroup, which will be 
kept locally, and the <EM
>rec.crafts.brewing.poison</EM
>
newsgroup, which we don't want people from our brewery seen posting to.</P
><P
>We'll use the <B
CLASS="COMMAND"
>nntpsend</B
> command to transport the news via
NNTP to the <SPAN
CLASS="SYSTEMITEM"
>news.groucho.edu</SPAN
> server. <B
CLASS="COMMAND"
>nntpsend</B
> requires us to use the &#8220;file&#8221;
delivery method and to write the article's pathname and article ID. Note
that we've set the <TT
CLASS="REPLACEABLE"
><I
>param</I
></TT
> field to the name of the output 
file. We'll talk a little more about the <B
CLASS="COMMAND"
>nntpsend</B
> 
command in a moment. Our resulting newsfeed's configuration is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/news/newsfeeds file for the Virtual Brewery
#
# Send all newsgroups except the control and junk ones by default
ME:!control,!junk::
#
# Generate overview data for any newsreaders to use.
overview::Tc,WO:/usr/lib/news/bin/overchan
#
# Feed the Groucho Marx University everything except our private newsgroup
# and any articles posted to the rec.crafts.brewing.poison newsgroup.
gmarxu:!rec.crafts.brewing.poison,@rec.crafts.brewing.private:\
	Tf,Wnm:news.groucho.edu
#</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN18723"
>23.5.3.2. The nntpsend.ctl file</A
></H4
><P
>&#13;
The <B
CLASS="COMMAND"
>nntpsend</B
> program manages the transmission of
news articles using the NNTP protocol by calling the
<B
CLASS="COMMAND"
>innxmit</B
> command. We saw a simple use of the
<B
CLASS="COMMAND"
>nntpsend</B
> command earlier, but it too has a
configuration file that provides us with some flexibility in how we
configure our news feeds.</P
><P
>The <B
CLASS="COMMAND"
>nntpsend</B
> command expects to find batch files
for the sites it will feed. It expects those batch files to be named
<TT
CLASS="FILENAME"
>/var/spool/news/out.going/<TT
CLASS="REPLACEABLE"
><I
>sitename</I
></TT
></TT
>. <B
CLASS="COMMAND"
>innd</B
>
creates these batch files when acting on an entry in the
<TT
CLASS="FILENAME"
>newsfeeds</TT
>, which we saw in the previous
sections. We specified the sitename as the filename in the
<TT
CLASS="REPLACEABLE"
><I
>param</I
></TT
> field, and that satisfies the
<B
CLASS="COMMAND"
>nntpsend</B
> command's input requirements.</P
><P
>The <B
CLASS="COMMAND"
>nntpsend</B
> command has a configuration file called
<TT
CLASS="FILENAME"
>nntpsend.ctl</TT
> that is usually stored in the
<TT
CLASS="FILENAME"
>/etc/news/</TT
> directory.</P
><P
>The <TT
CLASS="FILENAME"
>nntpsend.ctl</TT
> file allows us to associate a fully
qualified domain name, some news feed size constraints, and a number of
transmission parameters with a news feed site name. The sitename is a means
of uniquely identifying a logical feed of articles.
The general format of the file is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>sitename:fqdn:max_size:[args]</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The following list describes the elements of this format:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>sitename</I
></TT
></DT
><DD
><P
>The sitename as supplied in the <TT
CLASS="FILENAME"
>newsfeeds</TT
> file</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>fqdn</I
></TT
></DT
><DD
><P
>The fully qualified domain name of the news server to which we will be feeding
the news articles</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>max_size</I
></TT
></DT
><DD
><P
>The maximum volume of news to feed in any single transfer</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>args</I
></TT
></DT
><DD
><P
>Additional arguments to pass to the <B
CLASS="COMMAND"
>innxmit</B
> command</P
></DD
></DL
></DIV
><P
>Our sample configuration requires a very simple
<TT
CLASS="FILENAME"
>nntpsend.ctl</TT
> file. We have only one news feed. We'll
restrict the feed to a maximum of 2 MB of traffic and we'll pass an
argument to the <B
CLASS="COMMAND"
>innxmit</B
> that sets a 3-minute
(180 second) timeout. If we were a larger site and had many news feeds,
we'd simply create new entries for each new feed site that looked much
the same as this one:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># /etc/news/nntpsend.ctl
#
gmarxu:news.groucho.edu:2m:-t 180
#</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN18779"
>23.5.4. Controlling Newsreader Access</A
></H3
><P
>&#13;
Not so many years ago, it was common for organizations to provide public
access to their news servers. Today it is difficult to locate public news
servers; most organizations carefully control who has access to their
servers, typically restricting access to users supported on their network.
INN provides configuration files to control this access.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN18789"
>23.5.4.1. The incoming.conf file</A
></H4
><P
>&#13;
We mentioned in our introduction to INN that it achieves some of its
efficiency and size by separating the news feed mechanism from the
newsreading mechanism.  The
<TT
CLASS="FILENAME"
>/etc/news/incoming.conf</TT
> file is where you specify
which hosts will be feeding you news using the NNTP protocol, as well
as where you define some parameters that control the way articles are
fed to you from these hosts.  Any host not listed in this file that
connects to the news socket will not be handled by the
<B
CLASS="COMMAND"
>innd</B
> daemon; instead, it will be handled by the
<B
CLASS="COMMAND"
>nnrpd</B
> daemon.</P
><P
>The <TT
CLASS="FILENAME"
>/etc/news/incoming.conf</TT
> file syntax is
very simple, but it takes a moment to come to terms with. Three types of
valid entries are allowed: key/value pairs, which are how you specify
attributes and their values; peers, which is how you specify the name
of a host allowed to send articles to us using NNTP; and groups, a means 
of applying key/value pairs to groups of peers.  Key/value
pairs can have three different types of scope. Global pairs apply to
every peer defined in the file. Group pairs apply to all peers defined
within that group. Peer pairs apply only to that one peer. Specific
definitions override less specific ones: therefore, peer definitions
override group definitions, which in turn override global pairs.</P
><P
>Curly brace characters (<TT
CLASS="LITERAL"
>{}</TT
>) are used to delimit the
start and end of the <TT
CLASS="LITERAL"
>group</TT
> and <TT
CLASS="LITERAL"
>peer</TT
>
specifications. The # character marks the rest of the
line it appears on as a comment. Key/value pairs are separated by the
colon character and appear one to a line.</P
><P
>A number of different keys may be specified. The more common
and useful are:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>hostname</DT
><DD
><P
>This key specifies a comma-separated list of fully qualifed names or IP
addresses of the peers that we'll allow to send us articles. If this key is
not supplied, the hostname defaults to the label of the peer.</P
></DD
><DT
>streaming</DT
><DD
><P
>This key determines whether streaming commands are allowed from this host.
It is a Boolean value that defaults to <TT
CLASS="LITERAL"
>true</TT
>.</P
></DD
><DT
>max-connections</DT
><DD
><P
>This key specifies the maximum number of connections allowed from this group
or peer. A value of zero means unlimited (which can also be specified using
<TT
CLASS="LITERAL"
>none</TT
>).</P
></DD
><DT
>password</DT
><DD
><P
>This key allows you to specify the password that must be used by a peer if it
is to be allowed to transfer news. The default is to not require a password.</P
></DD
><DT
>patterns</DT
><DD
><P
>This key specifies the newsgroups that we accept from the associated peer.
This field is coded according to precisely the same rules as we used in our
<TT
CLASS="FILENAME"
>newsfeeds</TT
> file.</P
></DD
></DL
></DIV
>&#13;</P
><P
>In our example we have only one host that we are expecting to feed us
news: our upstream news provider at Groucho Marx
University. We'll have no password, but we will ensure that we don't
accept any articles for our private newsgroup from outside. Our
<TT
CLASS="FILENAME"
>hosts.nntp</TT
> looks like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># Virtual Brewery incoming.conf file.

# Global settings
streaming:       true
max-connections: 5

# Allow NNTP posting from our local host.
peer ME {
    hostname: "localhost, 127.0.0.1"
}

# Allow groucho to send us all newsgroup except our local ones.
peer groucho {
    hostname: news.groucho.edu
    patterns: !rec.crafts.brewing.private
}</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN18835"
>23.5.4.2. The nnrp.access file</A
></H4
><P
>&#13;
We mentioned earlier that newsreaders, and in fact any host not listed
in the <TT
CLASS="FILENAME"
>hosts.nntp</TT
>, that connect to the INN news
server are handled by the <B
CLASS="COMMAND"
>nnrpd</B
> program. <B
CLASS="COMMAND"
>nnrpd</B
> uses the
<TT
CLASS="FILENAME"
>/etc/news/nnrp.access</TT
> file to determine who is
allowed to make use of the news server, and what permissions they
should have.</P
><P
>The <TT
CLASS="FILENAME"
>nnrp.access</TT
> file has a similar structure to the other
configuration files we've looked at. It comprises a set of patterns used to
match against the connecting host's domain name or IP address, and fields
that determine what access and permission it should be given. Each entry
should appear on a line by itself, and fields are separated by colons. The
last entry in this file that matches the connecting host will be the one
used, so again, you should put general patterns first and follow them with
more specific ones later in the file. The five fields of each entry in
the order they should appear are:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Hostname or IP address</DT
><DD
><P
>This field conforms to <TT
CLASS="FILENAME"
>wildmat(3)</TT
> pattern-matching rules. It is a pattern that describes the connecting host's name or IP address.</P
></DD
><DT
>Permissions</DT
><DD
><P
>This field determines what permissions the matching host should be granted.
There are two permissons you may configure: <TT
CLASS="LITERAL"
>R</TT
> gives
read permissions, and <TT
CLASS="LITERAL"
>P</TT
> gives posting permissions.</P
></DD
><DT
>Username</DT
><DD
><P
>This field is optional and allows you to specify a username that an NNTP
client must log into the server before being allowed to post news
articles. This field may be left blank. No user authentication is required
to read articles.</P
></DD
><DT
>Password</DT
><DD
><P
>This field is optional and is the password accompanying the
<TT
CLASS="REPLACEABLE"
><I
>username</I
></TT
> field. Leaving this field blank means that no
password is required to post articles.</P
></DD
><DT
>Newsgroups</DT
><DD
><P
>This field is a pattern specifying which newsgroups the client is allowed to
access. The pattern follows the same rules as those used in the
<TT
CLASS="FILENAME"
>newsfeeds</TT
> file. The default for this field is no
newsgroups, so you would normally have a pattern configured here.</P
></DD
></DL
></DIV
>&#13;</P
><P
>In the virtual brewery example, we will allow any NNTP client in the Virtual 
Brewery domain to both read and post to all newsgroups. We will allow any NNTP
client read-only access to all newsgroups except our private internal
newsgroup. Our <TT
CLASS="FILENAME"
>nnrp.access</TT
> file will look like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># Virtual Brewery - nnrp.access
# We will allow public reading of all newsgroups except our private one.
*:R:::*,!rec.crafts.brewing.private

# Any host with the Virtual Brewery domain may Read and Post to all 
# newsgroups
*.vbrew.com:RP::*</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN18879"
>23.5.5. Expiring News Articles</A
></H3
><P
>&#13;

When news articles are received by a news server, they are stored to
disk. News articles need to be available to users for some period of
time to be useful, so a large operating news server can consume lots
of disk space. To ensure that the disk space is used effectively, you
can opt to delete news articles automatically after a period of
time. This is called <B
CLASS="COMMAND"
>article expiration</B
>. Naturally,
INN provides a means of automatically expiring news articles.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN18893"
>23.5.5.1. The expire.ctl file</A
></H4
><P
>&#13;The INN server uses a program called <B
CLASS="COMMAND"
>expire</B
> to delete
expired news articles. The <B
CLASS="COMMAND"
>expire</B
> program in turn uses a
file called <TT
CLASS="FILENAME"
>/etc/news/expire.ctl</TT
> to configure
the rules that govern article expiration.</P
><P
>The syntax of <TT
CLASS="FILENAME"
>/etc/news/expire.ctl</TT
> is fairly simple.
As with most configuration files, empty lines or lines beginning with the # 
character are ignored. The general idea is that you specify
one rule per line. Each rule defines how article expiration will be performed
on newsgroups matching a supplied pattern. The rule syntax looks like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="REPLACEABLE"
><I
>pattern</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>modflag</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>keep</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>default</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>purge</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The following list describes the fields:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>pattern</DT
><DD
><P
>This field is a comma-delimited list of patterns matching names of
newsgroups.  The <TT
CLASS="FILENAME"
>wildmat</TT
>&#8201;(3) routine is used to
match these patterns. The last rule matching a newsgroup name is the
one that is applied, so if you want to specify wildcard (*) rules,
they should be listed first in this file.</P
></DD
><DT
>modflag</DT
><DD
><P
>This flag describes how this rule applies to moderated newsgroups. It can be
coded with an <TT
CLASS="LITERAL"
>M</TT
> to mean that this rule applies only to
moderated newsgroups, a <TT
CLASS="LITERAL"
>U</TT
> to mean that this rule applies 
only to unmoderated newsgroups, or an <TT
CLASS="LITERAL"
>A</TT
> to mean that this 
rule ignores the moderated status and applies to all groups.</P
></DD
><DT
>keep</DT
><DD
><P
>This field allows you to specify the minimum time an article with an
&#8220;Expires&#8221; header will be kept before it is expired. The units
are days, and are a floating point, so you may specify values like
<TT
CLASS="LITERAL"
>7.5</TT
> for seven-and-a-half days. You may also specify 
<TT
CLASS="LITERAL"
>never</TT
> if you wish articles to stay in a newsgroup forever.</P
></DD
><DT
>default</DT
><DD
><P
>This field is the most important. This field allows you to specify the
time an article without an <TT
CLASS="LITERAL"
>Expires</TT
> header will be
kept. Most articles won't have an <TT
CLASS="LITERAL"
>Expires</TT
>
header. This field is coded in the same way as the
<TT
CLASS="REPLACEABLE"
><I
>keep</I
></TT
> field, with <TT
CLASS="LITERAL"
>never</TT
> meaning
that articles without <TT
CLASS="LITERAL"
>Expires</TT
> headers will never be
expired.</P
></DD
><DT
>purge</DT
><DD
><P
>This field allows you to specify the maximum time an article with an 
<TT
CLASS="LITERAL"
>Expires</TT
> header will be kept before it is expired. The coding
of this field is the same as for the <TT
CLASS="LITERAL"
>keep</TT
> field.</P
></DD
></DL
></DIV
></P
><P
>Our requirements are simple. We will keep all articles in all newsgroups
for 14 days by default, and between 7 and 21 days for articles that have
an <TT
CLASS="LITERAL"
>Expires</TT
> header.
The <EM
>rec.crafts.brewing.private</EM
> newsgroup is our internal
newsgroup, so we'll make sure we don't expire any articles from it:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># expire.ctl file for the Virtual Brewery

# Expire all articles in 14 days by default, 7-21 days for those with
# Expires: headers
*:A:7:14:21

# This is a special internal newsgroup, which we will never expire.
rec.crafts.brewing.private:A:never:never:never</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>We will mention one special type of entry you may have in your
<TT
CLASS="FILENAME"
>/etc/news/expires.ctl</TT
> file.
You may have exactly one line that looks like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>/remember/:<TT
CLASS="REPLACEABLE"
><I
>days</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
>

This entry allows you to specify the minimum number of days that an article
will be remembered in the history file, irrespective of whether the article
itself has been expired or not. This might be useful if one of the sites that
is feeding you articles is infrequent and has a habit of sending you old
articles every now and again. Setting the <TT
CLASS="REPLACEABLE"
><I
>/remember/</I
></TT
>
field helps to prevent the upstream server from sending you the article again,
even if it has already been expired from your server. If your server remembers
it has already received the article, it will reject attempts to resend it.
It is important to remember that this setting has no effect at all on article
expiration; it affects only the time that details of an article are kept in the history database.</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN18953"
>23.5.6. Handling Control Messages</A
></H3
><P
>&#13;Just as with C News, INN can automatically process control messages.
INN provides a powerful configuration mechanism to control what action will
occur for each of a variety of control messages, and an access control
mechanism to control who can initiate actions against which newsgroups.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN18959"
>23.5.6.1. The control.ctl file</A
></H4
><P
>&#13;The <TT
CLASS="FILENAME"
>control.ctl</TT
> file is fairly simple in structure.
The syntax rules for this file are much the same as for the other INN
configuration files. Lines beginning with <TT
CLASS="LITERAL"
>#</TT
>
are ignored, lines may be continued using <TT
CLASS="LITERAL"
>/</TT
>, and
fields are delimited by <TT
CLASS="LITERAL"
>:</TT
>.</P
><P
>When a control message is received, it is tested against each rule in turn.
The last rule in the file that matches the message is the rule that will be
used, so you should put any generic rules at the start of the file and
more specific rules at the end of the file. The general syntax of the file is:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><TT
CLASS="REPLACEABLE"
><I
>message</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>from</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>newsgroups</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>action</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The meanings of each of the fields are:

<P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>message</DT
><DD
><P
>This is the name of the control message. Typical control messages are
described later.</P
></DD
><DT
>from</DT
><DD
><P
>This is a shell-style pattern matching the email address of the person 
sending the message. The email address is converted to lowercase before comparison. </P
></DD
><DT
>newsgroups</DT
><DD
><P
>If the control message is <TT
CLASS="LITERAL"
>newgroup</TT
> or
<TT
CLASS="LITERAL"
>rmgroup</TT
>, this field is a shell-style pattern matching
the newsgroup created or removed.</P
></DD
><DT
>action</DT
><DD
><P
>This field specifies what action to take for any message matching the rule. 
There are quite a number of actions we can take; they are
described in the next list.</P
></DD
></DL
></DIV
></P
><P
>The <TT
CLASS="REPLACEABLE"
><I
>message</I
></TT
> field of each line can have one of the following values:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>checkgroups</DT
><DD
><P
>This message requests that news administrators resynchonrize their
active newsgroups database against the list of newsgroups supplied in
the control message.</P
></DD
><DT
>newgroup</DT
><DD
><P
>This message requests the creation of a new newsgroup. The body of the
control message should contain a short description of the purpose of
the newsgroup to be created.</P
></DD
><DT
>rmgroup</DT
><DD
><P
>requests that a newsgroup be removed.</P
></DD
><DT
>sendsys</DT
><DD
><P
>&#13;This message requests that the <TT
CLASS="FILENAME"
>sys</TT
> file of this
news server be transmitted by mail to the originator of the control
message. RFC-1036 states that it is a requirement of Usenet membership
that this information be publicly available because it is used to
keep the map of Usenet up to date.</P
></DD
><DT
>version</DT
><DD
><P
>&#13;This message requests that the hostname and version of news server
software be returned to the originator of the control message.&#13;</P
></DD
><DT
>all</DT
><DD
><P
>This is a special coding that will match any control message.</P
></DD
></DL
></DIV
><P
>The <TT
CLASS="REPLACEABLE"
><I
>message</I
></TT
> field may include the following actions:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>doit</DT
><DD
><P
>The requested command is performed. In many cases, a mail message will
be sent to the administrator to advise them that the action has taken place.</P
></DD
><DT
>doit=<TT
CLASS="REPLACEABLE"
><I
>file</I
></TT
></DT
><DD
><P
>This is the same as the <TT
CLASS="LITERAL"
>doit</TT
> action except
that a log message will be written to the <EM
>file</EM
>
log file. If the specified file is <EM
>mail</EM
>, the log
entry is sent by email. If the specified file is the null string, the
log message is written to <TT
CLASS="FILENAME"
>/dev/null</TT
> and is equivalent
to using the unqualified <TT
CLASS="LITERAL"
>doit</TT
> action. If the
<EM
>file</EM
> name begins with a / character, the name is 
taken to be an absolute filename for the logfile; otherwise, the specified 
name is translated to
<TT
CLASS="FILENAME"
>/var/log/news/file.log</TT
>.</P
></DD
><DT
>doifarg</DT
><DD
><P
>The requested command is performed if the command has an argument.
If the command has no argument, the control message is ignored.</P
></DD
><DT
>drop</DT
><DD
><P
>The requested command is ignored.</P
></DD
><DT
>log</DT
><DD
><P
>A log message is sent to the <TT
CLASS="LITERAL"
>stderr</TT
> output of the
<B
CLASS="COMMAND"
>innd</B
> process. This is normally directed out to the
<TT
CLASS="FILENAME"
>/var/log/news/errlog</TT
> file.</P
></DD
><DT
>log=<TT
CLASS="REPLACEABLE"
><I
>file</I
></TT
></DT
><DD
><P
>This is the same as a <TT
CLASS="LITERAL"
>log</TT
> action, except the
logfile is specified as per the rules given for the
<TT
CLASS="LITERAL"
>doit</TT
>=<TT
CLASS="REPLACEABLE"
><I
>file</I
></TT
> action.</P
></DD
><DT
>mail</DT
><DD
><P
>An email message is sent to the news administrator containing the
requested command details. No other action takes place.</P
></DD
><DT
>verify-*</DT
><DD
><P
>&#13;
If an action begins with the string &#8220;<TT
CLASS="LITERAL"
>verify-</TT
>&#8221;, 
then the control message is authenticated using PGP (or
GPG).<A
NAME="AEN19080"
HREF="#FTN.AEN19080"
><SPAN
CLASS="footnote"
>[139]</SPAN
></A
></P
></DD
></DL
></DIV
><P
>So that you can see what a <TT
CLASS="FILENAME"
>control.ctl</TT
> file would look 
like in practice, here is a very short illustrative sample:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>## Sample /etc/news/control.ctl
##
## Warning: You should not use this file, it is illustrative only.

##	Control Message Handling
all:*:*:mail
checkgroups:*:*:mail
ihave:*:*:drop
sendme:*:*:drop
sendsys:*:*:log=sendsys
senduuname:*:*:log=senduuname
version:*:*:log=version
newgroup:*:*:mail
rmgroup:*:*:mail

##  Handle control messages for the eight most important news heirarchies
##  COMP, HUMANITIES, MISC, NEWS, REC, SCI, SOC, TALK
checkgroups:*:comp.*|humanities.*|misc.*|news.*|rec.*|sci.*|soc.*|talk.*:drop
newgroup:*:comp.*|humanities.*|misc.*|news.*|rec.*|sci.*|soc.*|talk.*:drop
rmgroup:*:comp.*|humanities.*|misc.*|news.*|rec.*|sci.*|soc.*|talk.*:drop
checkgroups:group-admin@isc.org:*:verify-news.announce.newgroups
newgroup:group-admin@isc.org:comp.*|misc.*|news.*:verify-news.announce.newgroups
newgroup:group-admin@isc.org:rec.*|sci.*|soc.*:verify-news.announce.newgroups
newgroup:group-admin@isc.org:talk.*|humanities.*:verify-news.announce.newgroups
rmgroup:group-admin@isc.org:comp.*|misc.*|news.*:verify-news.announce.newgroups
rmgroup:group-admin@isc.org:rec.*|sci.*|soc.*:verify-news.announce.newgroups
rmgroup:group-admin@isc.org:talk.*|humanities.*:verify-news.announce.newgroups

## GNU ( Free Software Foundation )
newgroup:gnu@prep.ai.mit.edu:gnu.*:doit
newgroup:news@*ai.mit.edu:gnu.*:doit
rmgroup:gnu@prep.ai.mit.edu:gnu.*:doit
rmgroup:news@*ai.mit.edu:gnu.*:doit

## LINUX (Newsfeed from news.lameter.com)
checkgroups:christoph@lameter.com:linux.*:doit
newgroup:christoph@lameter.com:linux.*:doit
rmgroup:christoph@lameter.com:linux.*:doit</PRE
></FONT
></TD
></TR
></TABLE
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN19090"
>23.6. Running INN</A
></H2
><P
>&#13;
The <B
CLASS="COMMAND"
>inn</B
> source package provides a script suitable for
starting <B
CLASS="COMMAND"
>inn</B
> at boot time. The script is usually called
<TT
CLASS="FILENAME"
>/usr/lib/news/bin/rc.news</TT
>. The script reads arguments
from another script, usually called
<TT
CLASS="FILENAME"
>/usr/lib/news/innshellvars</TT
>, which contains definitions
of the filenames and filepaths that <B
CLASS="COMMAND"
>inn</B
> will use to locate
components it needs. It is generally considered a good idea to execute
<B
CLASS="COMMAND"
>inn</B
> with the permissions of a non-root user, such as 
<TT
CLASS="LITERAL"
>news</TT
>.</P
><P
>To ensure that <B
CLASS="COMMAND"
>inn</B
> is started at boot time, you should
check that <TT
CLASS="FILENAME"
>/usr/lib/news/innshellvars</TT
> is configured
correctly and then call the <TT
CLASS="FILENAME"
>/usr/lib/news/bin/rc.news</TT
>
script from a script executed at boot time.</P
><P
>Additionally, there are administrative tasks that must be performed
periodically. These tasks are usually configured to be executed by the
<B
CLASS="COMMAND"
>cron</B
> command. The best way to do this is to add the
appropriate commands to your <TT
CLASS="FILENAME"
>/etc/crontab</TT
> file, or
even better, create a file suitable for the <TT
CLASS="FILENAME"
>/etc/cron.d</TT
>
directory, if your distribution provides one. An example of such a file might
look like:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># Example /etc/cron.d/inn file, as used in the Debian distribution.
#
SHELL=/bin/sh
PATH=/usr/lib/news/bin:/sbin:/bin:/usr/sbin:/usr/bin

# Expire old news and overview entries nightly, generate reports.

15 0 * * *      news    news.daily expireover lowmark delayrm

# Every hour, run an rnews -U. This is not only for UUCP sites, but
# also to process queued up articles put there by in.nnrpd in case
# innd wasn't accepting any articles.

10 * * * *      news    rnews -U</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>These commands will ensure that old news is automatically expired each day,
and that any queued articles are processed each hour. Note also that they
are executed with the permissions of the <TT
CLASS="LITERAL"
>news</TT
> user.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN19116"
>23.7. Managing INN: The ctlinnd Command</A
></H2
><P
>&#13;
The INN news server comes with a command to manage its day-to-day operation.
The <B
CLASS="COMMAND"
>ctlinnd</B
> command can be used to manipulate newsgroups
and newsgroup feeds, to obtain the status, of the server, and to reload, stop,
and start the server.</P
><P
>You'd normally get a summary of the <B
CLASS="COMMAND"
>ctlinnd</B
> command
syntax using:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><EM
># ctlinnd -h</EM
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>We'll cover some of the more important uses of
<B
CLASS="COMMAND"
>ctlinnd</B
> here; please consult the
<B
CLASS="COMMAND"
>ctlinnd</B
> manual page for more detail.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN19132"
>23.7.1. Add a New Group</A
></H3
><P
>Use the following syntax to add a new group:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ctlinnd newgroup <TT
CLASS="REPLACEABLE"
><I
>group</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>rest</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>creator</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The arguments are defined as follows:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>group</I
></TT
></DT
><DD
><P
>The name of the group to create.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>rest</I
></TT
></DT
><DD
><P
>This argument should be coded in the same way as the
<TT
CLASS="REPLACEABLE"
><I
>flags</I
></TT
> field of the <TT
CLASS="FILENAME"
>active</TT
> file.
It defaults to <TT
CLASS="LITERAL"
>y</TT
> if not supplied.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>creator</I
></TT
></DT
><DD
><P
>The name of the person creating the group. Enclose it in quotes
if there are any spaces in the name.</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN19160"
>23.7.2. Change a Group</A
></H3
><P
>Use the following syntax to change a group:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ctlinnd changegroup <TT
CLASS="REPLACEABLE"
><I
>group</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>rest</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The arguments are defined as follows:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>group</I
></TT
></DT
><DD
><P
>The name of the group to change.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>rest</I
></TT
></DT
><DD
><P
>This argument should be coded in the same way as the <TT
CLASS="REPLACEABLE"
><I
>flags</I
></TT
> field of the <TT
CLASS="FILENAME"
>active</TT
> file.</P
></DD
></DL
></DIV
><P
>This command is useful to change the moderation status of a group.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN19182"
>23.7.3. Remove a Group</A
></H3
><P
>Use the following syntax to remove a group:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ctlinnd rmgroup <TT
CLASS="REPLACEABLE"
><I
>group</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The argument is defined as follows:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>group</I
></TT
></DT
><DD
><P
>The name of the group to remove.</P
></DD
></DL
></DIV
><P
>This command removes the specified newsgroup from the
<TT
CLASS="FILENAME"
>active</TT
> file. It has no effect on the news spool. All
articles in the spool for the specified group will be expired in the usual
fashion, but no new articles will be accepted.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN19197"
>23.7.4. Renumber a Group</A
></H3
><P
>Use the following syntax to renumber a group:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ctlinnd renumber <TT
CLASS="REPLACEABLE"
><I
>group</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The argument is defined as follows:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>group</I
></TT
></DT
><DD
><P
>The name of the group to renumber. If a <B
CLASS="COMMAND"
>group</B
> is an empty 
string, all groups are renumbered.</P
></DD
></DL
></DIV
><P
>This command updates the low-water mark for the specified group.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN19212"
>23.7.5. Allow/Disallow Newsreaders</A
></H3
><P
>Use the following syntax to allow or disallow newsreaders:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ctlinnd readers <TT
CLASS="REPLACEABLE"
><I
>flag</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>text</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The arguments are defined as follows:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>flag</I
></TT
></DT
><DD
><P
>Specifying <TT
CLASS="LITERAL"
>n</TT
> causes all newsreader connections to be
disallowed. Specifying <TT
CLASS="LITERAL"
>y</TT
> allows newsreader connections.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>text</I
></TT
></DT
><DD
><P
>The text supplied will be given to newsreaders who attempt to connect, and 
usually describes the reason for disabling newsreader access. When
reenabling newsreader access, this field must be either an empty 
string or a copy of the text supplied when the newsreader was disabled.</P
><P
>This command does not affect incoming newsfeeds. It only controls connections
from newsreaders.</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN19234"
>23.7.6. Reject Newsfeed Connections</A
></H3
><P
>Use the following syntax to reject newsfeed connections:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ctlinnd reject <TT
CLASS="REPLACEABLE"
><I
>reason</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
><P
>The argument is defined as follows:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>reason</I
></TT
></DT
><DD
><P
>The text supplied should explain why incoming connections to 
<B
CLASS="COMMAND"
>innd</B
> are rejected.</P
></DD
></DL
></DIV
><P
>This command does not affect connections that are handed off to
<B
CLASS="COMMAND"
>nnrpd</B
> (i.e., newsreaders); it only affects connections that
would be handled by <B
CLASS="COMMAND"
>innd</B
> directly, such as remote newsfeeds.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN19250"
>23.7.7. Allow Newsfeed Connections</A
></H3
><P
>Use the following syntax to allow newsfeed connections:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ctlinnd allow <TT
CLASS="REPLACEABLE"
><I
>reason</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The argument is defined as follows:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>reason</I
></TT
></DT
><DD
><P
>The supplied text must be the same as that supplied to the preceding
<B
CLASS="COMMAND"
>reject</B
> command or an empty string.</P
></DD
></DL
></DIV
><P
>This command reverses the effect of a <B
CLASS="COMMAND"
>reject</B
> command.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN19266"
>23.7.8. Disable News Server</A
></H3
><P
>Use the following syntax to disable the news server:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ctlinnd throttle <TT
CLASS="REPLACEABLE"
><I
>reason</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The argument is defined as follows:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>reason</I
></TT
></DT
><DD
><P
>The reason for throttling the server.</P
></DD
></DL
></DIV
><P
>This command is simultaneously equivalent to a 
<TT
CLASS="LITERAL"
>newsreaders no</TT
> and a <TT
CLASS="LITERAL"
>reject</TT
>, 
and is useful when emergency work is performed on the news database. 
It ensures that nothing attempts to update it while you are working on it.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN19282"
>23.7.9. Restart News Server</A
></H3
><P
>Use the following syntax to restart the news server:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ctlinnd go <TT
CLASS="REPLACEABLE"
><I
>reason</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The argument is defined as follows:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>reason</I
></TT
></DT
><DD
><P
>The reason given when stopping the server. If this field is an empty
string, the server will be reenabled unconditionally. If a reason is given, 
only those functions disabled with a reason matching the supplied text
will be restarted.</P
></DD
></DL
></DIV
><P
>This command is used to restart a server function after a
<B
CLASS="COMMAND"
>throttle</B
>, <B
CLASS="COMMAND"
>pause</B
>, or
<B
CLASS="COMMAND"
>reject</B
> command.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN19299"
>23.7.10. Display Status of a Newsfeed</A
></H3
><P
>Use the following syntax to display the status of a newsfeed:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ctlinnd feedinfo <TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The argument is defined as follows:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
></DT
><DD
><P
>The site name (taken from the <TT
CLASS="FILENAME"
>newsfeeds</TT
> file) for which 
you wish to display the newsfeed's status.</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN19313"
>23.7.11. Drop a Newsfeed</A
></H3
><P
>Use the following syntax to drop a newsfeed:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ctlinnd drop <TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The argument is defined as follows:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
></DT
><DD
><P
>The name of the site (taken from the <TT
CLASS="FILENAME"
>newsfeeds</TT
> file) to
which feeds are dropped. If this field is an empty string, all active feeds 
will be dropped.</P
></DD
></DL
></DIV
><P
>Dropping a newsfeed to a site halts any active feeds to the site. It is not
a permanent change. This command would be useful if you've modified the feed
details for a site and a feed to that site is active.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN19328"
>23.7.12. Begin a Newsfeed</A
></H3
><P
>Use the following syntax to begin a newsfeed:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ctlinnd begin <TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The argument is defined as follows:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>site</I
></TT
></DT
><DD
><P
>The name of the site from the <TT
CLASS="FILENAME"
>newsfeeds</TT
> file to
which feeds are started. If a feed to the site is already active, a 
<B
CLASS="COMMAND"
>drop</B
> command is done first automatically.</P
></DD
></DL
></DIV
><P
>This command causes the server to reread the <TT
CLASS="FILENAME"
>newsfeeds</TT
>
file, locate the matching entry, and commence a newsfeed to the named
site using the details found. You can use this command to test a new
news feed to a site after you've added or modified its entry in the
<TT
CLASS="FILENAME"
>newsfeeds</TT
> file.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN19346"
>23.7.13. Cancel an Article</A
></H3
><P
>Use the following syntax to cancel an article:</P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ctlinnd cancel <TT
CLASS="REPLACEABLE"
><I
>Message-Id</I
></TT
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The argument is defined as follows:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>Message-ID</I
></TT
></DT
><DD
><P
>The ID of the article to be cancelled.</P
></DD
></DL
></DIV
><P
>This command causes the specified article to be deleted from the server.
It does not generate a cancel message.</P
></DIV
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="X-087-2-NEWSREADERS"
></A
>Chapter 24. Newsreader Configuration</H1
><P
>A <B
CLASS="COMMAND"
>newsreader</B
> is a program that users invoke to view, 
store, and create news articles.  Several newsreaders have been ported to 
Linux. We will describe the basic setup for the three most popular 
newsreaders: <B
CLASS="COMMAND"
>tin</B
>, <B
CLASS="COMMAND"
>trn</B
>, and <B
CLASS="COMMAND"
>nn</B
>.</P
><P
>One of the most effective newsreaders is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>find /var/spool/news -name '[0-9]*' -exec cat {} \; | more</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This is the way Unix die-hards read their news.</P
><P
>Most newsreaders, however, are much more sophisticated. They usually offer
a full-screen interface with separate levels for displaying all groups the
user has subscribed to, an overview of all articles in each group, and
individual articles. Many web browsers double as newsreaders, but if you want 
to use a standalone newsreader, this chapter explains how to configure two 
classic ones: <B
CLASS="COMMAND"
>trn</B
> and <B
CLASS="COMMAND"
>nn</B
>.</P
><P
>At the newsgroup level, most newsreaders display a list of articles,
showing their subject lines and authors. In big groups, it is difficult
for the user to keep track of articles relating to each other, although
it is possible to identify responses to earlier articles.</P
><P
>&#13;
A response usually repeats the original article's subject, prepending it
with <TT
CLASS="LITERAL"
>Re:</TT
>. Additionally, the <TT
CLASS="LITERAL"
>References:</TT
> 
header line should include the message ID of the article on which the 
response is directly following up. Sorting articles by these two criteria 
generates small clusters (in fact, trees) of articles, which are called 
<EM
>threads</EM
>. One of the tasks of writing a newsreader is 
devising an efficient scheme of threading, because the time required for this 
is proportional to the square of the number of articles.</P
><P
>We will not go into how the user interfaces are built here. All newsreaders
currently available for Linux have a good help function; please refer to it 
for more details.</P
><P
>In the following sections, we will deal only with administrative tasks. Most of
these relate to the creation of threads databases and accounting.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NEWSREADERS.TIN"
>24.1. tin Configuration</A
></H2
><P
>The most versatile newsreader with respect to threading is
<B
CLASS="COMMAND"
>tin</B
>. It was written by Iain Lea and is loosely modeled
on an older newsreader named <B
CLASS="COMMAND"
>tass</B
> (written by Rich Skrenta).
It does its threading when the user enters the newsgroup, and it is
pretty fast unless you're getting posts via NNTP.</P
><P
>On a 486DX50, it takes roughly 30 seconds to thread 1,000 articles when
reading directly from disk.  It would take more than 5 minutes over NNTP 
to reach a loaded news server.<A
NAME="X-087-2-FNNR01"
HREF="#FTN.X-087-2-FNNR01"
><SPAN
CLASS="footnote"
>[140]</SPAN
></A
>
You may improve this time by regularly updating your index file by invoking
<B
CLASS="COMMAND"
>tin</B
> with the <CODE
CLASS="OPTION"
>&#8211;u</CODE
> option, so that when
you next start <B
CLASS="COMMAND"
>tin</B
> to read news the threads already exist.
Alternatively, you can invoke <B
CLASS="COMMAND"
>tin</B
> with the
<CODE
CLASS="OPTION"
>&#8211;U</CODE
> option to read news. When invoked this way,
<B
CLASS="COMMAND"
>tin</B
> forks a background process to build the index files
while you are reading news.&#13;</P
><P
>Usually, <B
CLASS="COMMAND"
>tin</B
> dumps its threading databases in the user's
home directory below <TT
CLASS="FILENAME"
>.tin/index</TT
>. This may be costly
in terms of resources, however, so you should keep a single copy of them in
a central location. This may be achieved by making <B
CLASS="COMMAND"
>tin</B
>
setuid to <SPAN
CLASS="SYSTEMITEM"
>news</SPAN
>, for
example. <B
CLASS="COMMAND"
>tin</B
> will then keep all thread databases below
<TT
CLASS="FILENAME"
>/var/spool/news/.index</TT
>. For any file access or shell
escape, it will reset its effective uid to the real uid of the user who
invoked it.<A
NAME="X-087-2-FNNR03"
HREF="#FTN.X-087-2-FNNR03"
><SPAN
CLASS="footnote"
>[141]</SPAN
></A
></P
><P
>The version of <B
CLASS="COMMAND"
>tin</B
> included in some Linux distributions
is compiled without NNTP support, but most do have it now.  When invoked as
<B
CLASS="COMMAND"
>rtin</B
> or with the <CODE
CLASS="OPTION"
>&#8211;r</CODE
> option,
<B
CLASS="COMMAND"
>tin</B
> tries to connect to the NNTP server specified in
the file <TT
CLASS="FILENAME"
>/etc/nntpserver</TT
> or in the
<SPAN
CLASS="SYSTEMITEM"
>NNTPSERVER</SPAN
> environment variable.
The <TT
CLASS="FILENAME"
>nntpserver</TT
> file simply contains the server's name
on a single line.
 
 
 </P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NEWSREADERS.TRN"
>24.2. trn Configuration</A
></H2
><P
><B
CLASS="COMMAND"
>trn</B
> is also the successor to an older newsreader, namely
<B
CLASS="COMMAND"
>rn</B
> (which means <EM
>read news</EM
>). The
&#8220;t&#8221; in its name stands for &#8220;threaded.&#8221;  It was
written by Wayne Davidson.</P
><P
>&#13;Unlike <B
CLASS="COMMAND"
>tin</B
>, <B
CLASS="COMMAND"
>trn</B
> has no provision for
generating its threading database at runtime. Instead, it uses those prepared
by a program called <B
CLASS="COMMAND"
>mthreads</B
> that has to be invoked
regularly from <B
CLASS="COMMAND"
>cron</B
> to update the index files.</P
><P
>&#13;You can still access new articles if you're not running
<B
CLASS="COMMAND"
>mthreads</B
>, but you will have all those
&#8220;A GENUINE INVESTMENT OPPORTUNITY&#8221; articles scattered across your
article selection menu, instead of a single thread you may easily skip.</P
><P
>To turn on threading for particular newsgroups, invoke
<B
CLASS="COMMAND"
>mthreads</B
> with the list of newsgroups on the command line.
The format of the list is the same as the one in the C News
<TT
CLASS="FILENAME"
>sys</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$ <KBD
CLASS="USERINPUT"
>mthreads &#8217;comp,rec,!rec.games.go&#8217;</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This command enables threading for all of
<SPAN
CLASS="SYSTEMITEM"
>comp</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>rec</SPAN
>, except for
<SPAN
CLASS="SYSTEMITEM"
>rec.games.go</SPAN
> (people who play Go don't
need fancy threads). After that, you simply invoke <B
CLASS="COMMAND"
>mthreads</B
>
with no options at all to make it thread any newly arrived articles. Threading
of all groups found in your <TT
CLASS="FILENAME"
>active</TT
> file can be turned on
by invoking <B
CLASS="COMMAND"
>mthreads</B
> with a group list of
<SPAN
CLASS="SYSTEMITEM"
>all</SPAN
>.</P
><P
>If you're receiving news during the night, you will customarily run
<B
CLASS="COMMAND"
>mthreads</B
> once in the morning, but you can also to do so
more frequently if necessary. Sites that have very heavy traffic may want to
run <B
CLASS="COMMAND"
>mthreads</B
> in daemon mode.  When it is started at boot
time using the <CODE
CLASS="OPTION"
>&#8211;d</CODE
> option, it puts itself in the
background, wakes up every ten minutes to check if there are any newly arrived
articles, and threads them. To run <B
CLASS="COMMAND"
>mthreads</B
> in daemon
mode, put the following line in your <TT
CLASS="FILENAME"
>rc.news</TT
> script:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>/usr/local/bin/rn/mthreads -deav</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <CODE
CLASS="OPTION"
>&#8211;a</CODE
> option makes <B
CLASS="COMMAND"
>mthreads</B
>
automatically turn on threading for new groups as they are created;
<CODE
CLASS="OPTION"
>&#8211;v</CODE
> enables verbose log messages to the
<B
CLASS="COMMAND"
>mthreads</B
> log file <TT
CLASS="FILENAME"
>mt.log</TT
> in
the directory where you have <B
CLASS="COMMAND"
>trn</B
> installed.</P
><P
>&#13;
Old articles that are no longer available must be removed from the index files
regularly.  By default, only articles with a number below the low-water 
mark will be removed.<A
NAME="X-087-2-FNNR04"
HREF="#FTN.X-087-2-FNNR04"
><SPAN
CLASS="footnote"
>[142]</SPAN
></A
>
Articles above this number that have been expired (because the
oldest article has been assigned a long expiration date by an
<TT
CLASS="REPLACEABLE"
><I
>Expires:</I
></TT
> header field) may nevertheless be removed by giving
<B
CLASS="COMMAND"
>mthreads</B
> the <CODE
CLASS="OPTION"
>&#8211;e</CODE
> option to force an
&#8220;enhanced&#8221; expiry run. When <B
CLASS="COMMAND"
>mthreads</B
> is running
in daemon mode, the <CODE
CLASS="OPTION"
>&#8211;e</CODE
> option makes 
<B
CLASS="COMMAND"
>mthreads</B
> put in such an enhanced expiry run once a day, 
shortly after midnight.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-NEWSREADERS.NN"
>24.3. nn Configuration</A
></H2
><P
><B
CLASS="COMMAND"
>nn</B
>, written by Kim F. Storm, claims to be a newsreader
whose ultimate goal is not to read news. Its name stands for
&#8220;No News,&#8221; and its motto is
&#8220;No news is good news. <B
CLASS="COMMAND"
>nn</B
> is better.&#8221;</P
><P
>To achieve this ambitious goal, <B
CLASS="COMMAND"
>nn</B
> comes with a large
assortment of maintenance tools that not only allow thread generation,
but also extensive database consistency checks, accounting,
gathering of usage statistics, and access restrictions. There is also an
administration program called <B
CLASS="COMMAND"
>nnadmin</B
>, which allows you
to perform these tasks interactively. It is very intuitive, so we will not
dwell on these aspects, but deal only with the generation of the index files.</P
><P
>&#13;The <B
CLASS="COMMAND"
>nn</B
> threads database manager is called
<B
CLASS="COMMAND"
>nnmaster</B
>. It is usually run as a daemon, started from an
<TT
CLASS="FILENAME"
>rc</TT
> file at boot time. It is invoked as:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>/usr/local/lib/nn/nnmaster -l -r -C</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>This enables threading for all newsgroups present in your
<TT
CLASS="FILENAME"
>active</TT
> file.</P
><P
> 
Equivalently, you may invoke <B
CLASS="COMMAND"
>nnmaster</B
> periodically from
<B
CLASS="COMMAND"
>cron</B
>, giving it a list of groups to act upon. This list is
very similar to the subscription list in the <TT
CLASS="FILENAME"
>sys</TT
> file,
except that it uses blanks instead of commas. Instead of the fake group name
<EM
>all</EM
>, an empty argument of <TT
CLASS="LITERAL"
>""</TT
> should be
used to denote all groups.  A sample invocation looks like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>/usr/local/lib/nn/nnmaster !rec.games.go rec comp</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Note that the order is significant. The leftmost group specification that
matches always wins. Thus, if we had put
<SPAN
CLASS="SYSTEMITEM"
>!rec.games.go</SPAN
> after
<SPAN
CLASS="SYSTEMITEM"
>rec</SPAN
>, all articles from this group
would have been threaded nevertheless.</P
><P
>&#13;<B
CLASS="COMMAND"
>nn</B
> offers several methods to remove expired articles from
its databases.  The first is to update the database by scanning the newsgroup 
directories and discarding the entries whose corresponding article
has exceeded its expiration date. This is the default operation obtained by
invoking <B
CLASS="COMMAND"
>nnmaster</B
> with the <CODE
CLASS="OPTION"
>&#8211;E</CODE
> option.
It is reasonably quick, unless you're doing this via NNTP.  </P
><P
>The second method behaves exactly like a default expiration run of
<B
CLASS="COMMAND"
>mthreads</B
>; it removes only those entries that refer
to articles with numbers below the low-water mark in the
<TT
CLASS="FILENAME"
>active</TT
> file. It may be enabled using the
<CODE
CLASS="OPTION"
>&#8211;e</CODE
> option.</P
><P
>Finally, the third strategy discards the entire database and recollects all
articles. It may be enabled using the <CODE
CLASS="OPTION"
>&#8211;E3</CODE
> option.</P
><P
>The list of groups to be expired is given by the <CODE
CLASS="OPTION"
>&#8211;F</CODE
>
option in the same fashion as above.  However, if you have
<B
CLASS="COMMAND"
>nnmaster</B
> running as daemon, you must kill it (using
<CODE
CLASS="OPTION"
>&#8211;k</CODE
>) before expiration can take place, and restart it 
with the original options afterward.  Thus the proper command to run 
expiration on all groups using the first method is:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># <KBD
CLASS="USERINPUT"
>nnmaster -kF ""</KBD
>
# <KBD
CLASS="USERINPUT"
>nnmaster -lrC</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>There are many more flags that fine-tune the <B
CLASS="COMMAND"
>nn</B
>'s 
behavior. If you are concerned about removing bad articles or
assembling article digests, read the <B
CLASS="COMMAND"
>nnmaster</B
> manual page.</P
><P
><B
CLASS="COMMAND"
>nnmaster</B
> relies on a file named <TT
CLASS="FILENAME"
>GROUPS</TT
>,
which is located in <TT
CLASS="FILENAME"
>/var/lib/nn</TT
>. If it does not exist
when <B
CLASS="COMMAND"
>nnmaster</B
> is first run, it is created. For each
newsgroup, it contains a line that begins with the group's name, optionally
followed by a time stamp and flags. You may edit these flags to enable certain
behavior for the group in question, but you may not change the order in which
the groups appear.<A
NAME="X-087-2-FNNR05"
HREF="#FTN.X-087-2-FNNR05"
><SPAN
CLASS="footnote"
>[143]</SPAN
></A
> The flags allowed and
their effects are detailed in the <B
CLASS="COMMAND"
>nnmaster</B
> manual page, too.

 
 </P
></DIV
></DIV
><DIV
CLASS="APPENDIX"
><HR><H1
><A
NAME="X-087-2-APPENDIX.BREWERY"
></A
>Appendix A. Example Network:The Virtual Brewery</H1
><P
>Throughout this book we've used the following example that is a little less
complex than Groucho Marx University and may be closer to the tasks you will
actually encounter.</P
><P
>The Virtual Brewery is a small company that brews, as the name suggests,
virtual beer. To manage their business more efficiently, the virtual brewers
want to network their computers, which all happen to be PCs running the
brightest and shiniest production Linux kernel. <A
HREF="#X-087-2-APPENDIX.BREWERY.DIAGRAM"
>Figure A-1</A
> shows the network configuration.</P
><P
>On the same floor, just across the hall, there's the Virtual Winery, which
works closely with the brewery.  The vintners run an Ethernet of their own.
Quite naturally, the two companies want to link their networks once they are
operational.  As a first step, they want to set up a gateway host that
forwards datagrams between the two subnets. Later, they also want to have a
UUCP link to the outside world, through which they exchange mail and news. In
the long run, they also want to set up PPP connections to connect to offsite
locations and to the Internet.</P
><P
>The Virtual Brewery and the Virtual Winery each have a class C subnet of 
the Brewery's class B network, and gateway to each other via the host
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>, which also supports the
UUCP connection. <A
HREF="#X-087-2-APPENDIX.BREWERY.SUBSIDIARY"
>Figure A-2</A
> shows the configuration.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-APPENDIX.BREWERY.DIAGRAM"
></A
><P
><B
>Figure A-1. The Virtual Brewery and Virtual Winery subnets</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_aa01.jpg"></P
></DIV
></DIV
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-APPENDIX.BREWERY.SUBSIDIARY"
></A
><P
><B
>Figure A-2. The Virtual Brewery Network</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_aa02.jpg"></P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN19613"
>A.1. Connecting the Virtual Subsidiary Network</A
></H2
><P
>The Virtual Brewery grows and opens a branch in another city. The
subsidiary runs an Ethernet of its own using the IP network number
<SPAN
CLASS="SYSTEMITEM"
>172.16.3.0</SPAN
>, which is subnet 3 of the
Brewery's class B network. The host
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> acts as the gateway for the
Brewery network and will support the PPP link; its peer at the new branch is
called <SPAN
CLASS="SYSTEMITEM"
>vbourbon</SPAN
> and has an IP address
of <SPAN
CLASS="SYSTEMITEM"
>172.16.3.1</SPAN
>. This network is
illustrated in <A
HREF="#X-087-2-APPENDIX.BREWERY.SUBSIDIARY"
>Figure A-2</A
>.</P
><P
>&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; </P
><P
>&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; </P
><P
>&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; </P
></DIV
></DIV
><DIV
CLASS="APPENDIX"
><HR><H1
><A
NAME="X-087-2-APPENDIX.CABLES"
></A
>Appendix B. Useful Cable Configurations</H1
><P
>If you wish to connect two computers together and you don't have an Ethernet
network, you will need either a serial null modem cable, or a PLIP parallel
cable.</P
><P
>These cables can be bought off the shelf, but are much cheaper and fairly
simple to make yourself.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-CABLE.PLIP"
>B.1. A PLIP Parallel Cable</A
></H2
><P
> 
To make a parallel cable to use for PLIP, you will need two 25-pin
connectors (called DB-25) and a cable with at least eleven conductors.
The cable must not be any longer than 15 meters (50 feet). The cable may or may
not have a shield, but if you are building a long cable, it is probably
a good idea to have one.</P
><P
>If you look at the connector, you should be able to read tiny numbers
at the base of each pin&#8212;from 1 for the pin at the top left (if you hold 
the broader side up) to 25 for the pin at the bottom right. For the null 
printer cable, you have to connect the following pins of both connectors
with each other, as shown in <A
HREF="#X-087-2-CABLE.PLIP.DIAGRAM"
>Figure B-1</A
>.</P
><P
>All remaining pins remain unconnected. If the cable is shielded, the
shield should be connected to the DB-25's metallic shell on just 
<EM
>one</EM
> end.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="X-087-2-CABLE.SERIAL"
>B.2. A Serial NULL Modem Cable</A
></H2
><P
> 
 
A serial null modem cable will work for both SLIP and PPP. Again, you
will need two DB-25 connectors. This time your cable requires only
eight conductors.</P
><P
>You may have seen other NULL modem cable designs, but this one allows you
to use hardware flow control&#8212;which is far superior to XON/XOFF
flow control&#8212;or none at all. The conductor configuration is
shown in <A
HREF="#X-087-2-CABLE.NULLMODEM.DIAGRAM"
>Figure B-2</A
>:</P
><P
>Again, if you have a shield, you should connect it to the first pin at one 
end only.</P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-CABLE.PLIP.DIAGRAM"
></A
><P
><B
>Figure B-1. Parallel PLIP cable</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_ab01.jpg"></P
></DIV
></DIV
><P
>&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; </P
><DIV
CLASS="FIGURE"
><A
NAME="X-087-2-CABLE.NULLMODEM.DIAGRAM"
></A
><P
><B
>Figure B-2. Serial NULL-Modem cable</B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/lag2_ab02.jpg"></P
></DIV
></DIV
><P
>&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; 
&#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; &#8199; </P
></DIV
></DIV
><DIV
CLASS="APPENDIX"
><HR><H1
><A
NAME="X-087-2-APPENDIX.GPL"
></A
>Appendix C. Linux Network Administrator's Guide, Second Edition Copyright Information</H1
><P
>Copyright  1993 Olaf Kirch
Copyright  2000 Terry Dawson
Copyright on O'Reilly printed version  2000 O'Reilly &#38; Associates</P
><P
>&#13;The online version of this book, which at this time of printing
contains exactly the same text as the O'Reilly printed version, is
available under the GNU FDL. Rights to reprint the document under the
FDL include the right to print and distribute printed copies of the
online version.  Rights to copy the O'Reilly printed version are
reserved.  You can find the online copy of the license at <SPAN
CLASS="SYSTEMITEM"
>http://www.oreilly.com/catalog/linag/licenseinfo.html</SPAN
>.
The book is available at <SPAN
CLASS="SYSTEMITEM"
>http://www.linuxdoc.org/LDP/nag/nag.html</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>http://www.oreilly.com/catalog/linag/</SPAN
>, and may
be reposted by others at other locations.</P
><P
>Permission is granted to copy, print, distribute, and modify the
online document under the terms of the GNU Free Documentation License,
Version 1.1, or any later version published by the Free Software
Foundation; with the Invariant Sections being the Acknowledgments (in
the <EM
>Preface</EM
> and <A
HREF="#X-087-2-APPENDIX.GPL"
>Appendix C</A
>." Further acknowledgments can be added outside
the Invariant Section. The Front-Cover Text must read:</P
><P
CLASS="LITERALLAYOUT"
><EM
>Linux Network Administrator's Guide</EM
><br>
by&nbsp;Olaf&nbsp;Kirch&nbsp;and&nbsp;Terry&nbsp;Dawson<br>
Copyright&nbsp;&nbsp;&nbsp;1993&nbsp;Olaf&nbsp;Kirch<br>
Copyright&nbsp;&nbsp;&nbsp;2000&nbsp;Terry&nbsp;Dawson<br>
Copyright&nbsp;on&nbsp;O'Reilly&nbsp;printed&nbsp;version&nbsp;&nbsp;2000&nbsp;O'Reilly&nbsp;&#38;&nbsp;Associates</P
><P
>&#13;The following is a copy of the GNU Free Documentation License, which
is also at <SPAN
CLASS="SYSTEMITEM"
>http://www.gnu.org/copyleft/fdl.html</SPAN
>.</P
><P
CLASS="LITERALLAYOUT"
>Version&nbsp;1.1,&nbsp;March&nbsp;2000<br>
Copyright&nbsp;&nbsp;2000&nbsp;&nbsp;Free&nbsp;Software&nbsp;Foundation,&nbsp;Inc.<br>
59&nbsp;Temple&nbsp;Place,&nbsp;Suite&nbsp;330,&nbsp;Boston,&nbsp;MA&nbsp;&nbsp;02111-1307&nbsp;&nbsp;USA<br>
Everyone&nbsp;is&nbsp;permitted&nbsp;to&nbsp;copy&nbsp;and&nbsp;distribute&nbsp;verbatim&nbsp;copies<br>
of&nbsp;this&nbsp;license&nbsp;document,&nbsp;but&nbsp;changing&nbsp;it&nbsp;is&nbsp;not&nbsp;allowed.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN19685"
>C.1. 0. Preamble</A
></H2
><P
>The purpose of this License is to make a manual, textbook, or other
written document "free" in the sense of freedom: to assure everyone
the effective freedom to copy and redistribute it, with or without
modifying it, either commercially or noncommercially.  Secondarily,
this License preserves for the author and publisher a way to get
credit for their work, while not being considered responsible for
modifications made by others.</P
><P
>This License is a kind of "copyleft," which means that derivative
works of the document must themselves be free in the same sense.  It
complements the GNU General Public License, which is a copyleft
license designed for free software.</P
><P
>We have designed this License in order to use it for manuals for free
software, because free software needs free documentation: a free
program should come with manuals providing the same freedoms that the
software does.  But this License is not limited to software manuals;
it can be used for any textual work, regardless of subject matter or
whether it is published as a printed book.  We recommend this License
principally for works whose purpose is instruction or reference.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN19690"
>C.2. 1. Applicability and Definitions</A
></H2
><P
>This License applies to any manual or other work that contains a
notice placed by the copyright holder saying it can be distributed
under the terms of this License.  The "Document," below, refers to any
such manual or work.  Any member of the public is a licensee, and is
addressed as "you."</P
><P
>A "Modified Version" of the Document means any work containing the
Document or a portion of it, either copied verbatim, or with
modifications and/or translated into another language.</P
><P
>A "Secondary Section" is a named appendix or a front-matter section of
the Document that deals exclusively with the relationship of the
publishers or authors of the Document to the Document's overall subject
(or to related matters) and contains nothing that could fall directly
within that overall subject.  (For example, if the Document is in part a
textbook of mathematics, a Secondary Section may not explain any
mathematics.)  The relationship could be a matter of historical
connection with the subject or with related matters, or of legal,
commercial, philosophical, ethical or political position regarding
them.</P
><P
>The "Invariant Sections" are certain Secondary Sections whose titles
are designated, as being those of Invariant Sections, in the notice
that says that the Document is released under this License.</P
><P
>The "Cover Texts" are certain short passages of text that are listed,
as Front-Cover Texts or Back-Cover Texts, in the notice that says that
the Document is released under this License.</P
><P
>A "Transparent" copy of the Document means a machine-readable copy,
represented in a format whose specification is available to the
general public, whose contents can be viewed and edited directly and
straightforwardly with generic text editors or (for images composed of
pixels) generic paint programs or (for drawings) some widely available
drawing editor, and that is suitable for input to text formatters or
for automatic translation to a variety of formats suitable for input
to text formatters.  A copy made in an otherwise Transparent file
format whose markup has been designed to thwart or discourage
subsequent modification by readers is not Transparent.  A copy that is
not "Transparent" is called "Opaque."</P
><P
>Examples of suitable formats for Transparent copies include plain
ASCII without markup, Texinfo input format, LaTeX input format, SGML
or XML using a publicly available DTD, and standard-conforming simple
HTML designed for human modification.  Opaque formats include
PostScript, PDF, proprietary formats that can be read and edited only
by proprietary word processors, SGML or XML for which the DTD and/or
processing tools are not generally available, and the
machine-generated HTML produced by some word processors for output
purposes only.</P
><P
>The "Title Page" means, for a printed book, the title page itself,
plus such following pages as are needed to hold, legibly, the material
this License requires to appear in the title page.  For works in
formats that do not have any title page as such, "Title Page" means
the text near the most prominent appearance of the work's title,
preceding the beginning of the body of the text.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN19700"
>C.3. 2. Verbatim Copying</A
></H2
><P
>You may copy and distribute the Document in any medium, either
commercially or noncommercially, provided that this License, the
copyright notices, and the license notice saying this License applies
to the Document are reproduced in all copies, and that you add no other
conditions whatsoever to those of this License.  You may not use
technical measures to obstruct or control the reading or further
copying of the copies you make or distribute.  However, you may accept
compensation in exchange for copies.  If you distribute a large enough
number of copies you must also follow the conditions in section 3.</P
><P
>You may also lend copies, under the same conditions stated above, and
you may publicly display copies.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN19704"
>C.4. 3. Copying in Quantity</A
></H2
><P
>If you publish printed copies of the Document numbering more than 100,
and the Document's license notice requires Cover Texts, you must enclose
the copies in covers that carry, clearly and legibly, all these Cover
Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
the back cover.  Both covers must also clearly and legibly identify
you as the publisher of these copies.  The front cover must present
the full title with all words of the title equally prominent and
visible.  You may add other material on the covers in addition.
Copying with changes limited to the covers, as long as they preserve
the title of the Document and satisfy these conditions, can be treated
as verbatim copying in other respects.</P
><P
>If the required texts for either cover are too voluminous to fit
legibly, you should put the first ones listed (as many as fit
reasonably) on the actual cover, and continue the rest onto adjacent
pages.</P
><P
>If you publish or distribute Opaque copies of the Document numbering
more than 100, you must either include a machine-readable Transparent
copy along with each Opaque copy, or state in or with each Opaque copy
a publicly-accessible computer-network location containing a complete
Transparent copy of the Document, free of added material, which the
general network-using public has access to download anonymously at no
charge using public-standard network protocols.  If you use the latter
option, you must take reasonably prudent steps, when you begin
distribution of Opaque copies in quantity, to ensure that this
Transparent copy will remain thus accessible at the stated location
until at least one year after the last time you distribute an Opaque
copy (directly or through your agents or retailers) of that edition to
the public.</P
><P
>It is requested, but not required, that you contact the authors of the
Document well before redistributing any large number of copies, to give
them a chance to provide you with an updated version of the Document.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN19710"
>C.5. 4. Modifications</A
></H2
><P
>You may copy and distribute a Modified Version of the Document under
the conditions of sections 2 and 3 above, provided that you release
the Modified Version under precisely this License, with the Modified
Version filling the role of the Document, thus licensing distribution
and modification of the Modified Version to whoever possesses a copy
of it.  In addition, you must do these things in the Modified Version:</P
><P
></P
><OL
TYPE="A"
><LI
><P
>Use in the Title Page (and on the covers, if any) a title distinct
   from that of the Document, and from those of previous versions
   (which should, if there were any, be listed in the History section
   of the Document).  You may use the same title as a previous version
   if the original publisher of that version gives permission.</P
></LI
><LI
><P
>List on the Title Page, as authors, one or more persons or entities
   responsible for authorship of the modifications in the Modified
   Version, together with at least five of the principal authors of the
   Document (all of its principal authors, if it has less than five).</P
></LI
><LI
><P
>State on the Title page the name of the publisher of the
   Modified Version, as the publisher.</P
></LI
><LI
><P
>Preserve all the copyright notices of the Document.</P
></LI
><LI
><P
>Add an appropriate copyright notice for your modifications
   adjacent to the other copyright notices.</P
></LI
><LI
><P
>Include, immediately after the copyright notices, a license notice
   giving the public permission to use the Modified Version under the
   terms of this License, in the form shown in the Addendum below.</P
></LI
><LI
><P
>Preserve in that license notice the full lists of Invariant Sections
   and required Cover Texts given in the Document's license notice.</P
></LI
><LI
><P
>Include an unaltered copy of this License.</P
></LI
><LI
><P
>Preserve the section entitled "History," and its title, and add to
   it an item stating at least the title, year, new authors, and
   publisher of the Modified Version as given on the Title Page.  If
   there is no section entitled "History" in the Document, create one
   stating the title, year, authors, and publisher of the Document as
   given on its Title Page, then add an item describing the Modified
   Version as stated in the previous sentence.</P
></LI
><LI
><P
>Preserve the network location, if any, given in the Document for
   public access to a Transparent copy of the Document, and likewise
   the network locations given in the Document for previous versions
   it was based on.  These may be placed in the "History" section.
   You may omit a network location for a work that was published at
   least four years before the Document itself, or if the original
   publisher of the version it refers to gives permission.</P
></LI
><LI
><P
>In any section entitled "Acknowledgements" or "Dedications,"
   preserve the section's title, and preserve in the section all the
   substance and tone of each of the contributor acknowledgements
   and/or dedications given therein.</P
></LI
><LI
><P
>Preserve all the Invariant Sections of the Document,
   unaltered in their text and in their titles.  Section numbers
   or the equivalent are not considered part of the section titles.</P
></LI
><LI
><P
>Delete any section entitled "Endorsements."  Such a section
   may not be included in the Modified Version.</P
></LI
><LI
><P
>Do not retitle any existing section as "Endorsements"
   or to conflict in title with any Invariant Section.</P
></LI
></OL
><P
>If the Modified Version includes new front-matter sections or
appendices that qualify as Secondary Sections and contain no material
copied from the Document, you may at your option designate some or all
of these sections as invariant.  To do this, add their titles to the
list of Invariant Sections in the Modified Version's license notice.
These titles must be distinct from any other section titles.</P
><P
>You may add a section entitled "Endorsements," provided it contains
nothing but endorsements of your Modified Version by various
parties&#8212;for example, statements of peer review or that the text has
been approved by an organization as the authoritative definition of a
standard.</P
><P
>You may add a passage of up to five words as a Front-Cover Text, and a
passage of up to 25 words as a Back-Cover Text, to the end of the list
of Cover Texts in the Modified Version.  Only one passage of
Front-Cover Text and one of Back-Cover Text may be added by (or
through arrangements made by) any one entity.  If the Document already
includes a cover text for the same cover, previously added by you or
by arrangement made by the same entity you are acting on behalf of,
you may not add another; but you may replace the old one, on explicit
permission from the previous publisher that added the old one.</P
><P
>The author(s) and publisher(s) of the Document do not by this License
give permission to use their names for publicity for or to assert or
imply endorsement of any Modified Version.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN19746"
>C.6. 5. Combining Documents</A
></H2
><P
>You may combine the Document with other documents released under this
License, under the terms defined in section 4 above for modified
versions, provided that you include in the combination all of the
Invariant Sections of all of the original documents, unmodified, and
list them all as Invariant Sections of your combined work in its
license notice.</P
><P
>The combined work need only contain one copy of this License, and
multiple identical Invariant Sections may be replaced with a single
copy.  If there are multiple Invariant Sections with the same name but
different contents, make the title of each such section unique by
adding at the end of it, in parentheses, the name of the original
author or publisher of that section if known, or else a unique number.
Make the same adjustment to the section titles in the list of
Invariant Sections in the license notice of the combined work.</P
><P
>In the combination, you must combine any sections entitled "History"
in the various original documents, forming one section entitled
"History"; likewise combine any sections entitled "Acknowledgements,"
and any sections entitled "Dedications."  You must delete all sections
entitled "Endorsements."</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN19751"
>C.7. 6. Collections of Documents</A
></H2
><P
>You may make a collection consisting of the Document and other documents
released under this License, and replace the individual copies of this
License in the various documents with a single copy that is included in
the collection, provided that you follow the rules of this License for
verbatim copying of each of the documents in all other respects.</P
><P
>You may extract a single document from such a collection, and distribute
it individually under this License, provided you insert a copy of this
License into the extracted document, and follow this License in all
other respects regarding verbatim copying of that document.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN19755"
>C.8. 7. Aggregation with Independent Works</A
></H2
><P
>A compilation of the Document or its derivatives with other separate
and independent documents or works, in or on a volume of a storage or
distribution medium, does not as a whole count as a Modified Version
of the Document, provided no compilation copyright is claimed for the
compilation.  Such a compilation is called an "aggregate," and this
License does not apply to the other self-contained works thus compiled
with the Document, on account of their being thus compiled, if they
are not themselves derivative works of the Document.</P
><P
>If the Cover Text requirement of section 3 is applicable to these
copies of the Document, then if the Document is less than one quarter
of the entire aggregate, the Document's Cover Texts may be placed on
covers that surround only the Document within the aggregate.
Otherwise they must appear on covers around the whole aggregate.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN19759"
>C.9. 8. Translation</A
></H2
><P
>Translation is considered a kind of modification, so you may
distribute translations of the Document under the terms of section 4.
Replacing Invariant Sections with translations requires special
permission from their copyright holders, but you may include
translations of some or all Invariant Sections in addition to the
original versions of these Invariant Sections.  You may include a
translation of this License provided that you also include the
original English version of this License.  In case of a disagreement
between the translation and the original English version of this
License, the original English version will prevail.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN19762"
>C.10. 9. Termination</A
></H2
><P
>You may not copy, modify, sublicense, or distribute the Document except
as expressly provided for under this License.  Any other attempt to
copy, modify, sublicense or distribute the Document is void, and will
automatically terminate your rights under this License.  However,
parties who have received copies, or rights, from you under this
License will not have their licenses terminated so long as such
parties remain in full compliance.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN19765"
>C.11. 10. Future Revisions of this License</A
></H2
><P
>The Free Software Foundation may publish new, revised versions
of the GNU Free Documentation License from time to time.  Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.  See
<SPAN
CLASS="SYSTEMITEM"
>http://www.gnu.org/copyleft/</SPAN
>.</P
><P
>Each version of the License is given a distinguishing version number.
If the Document specifies that a particular numbered version of this
License "or any later version" applies to it, you have the option of
following the terms and conditions either of that specified version or
of any later version that has been published (not as a draft) by the
Free Software Foundation.  If the Document does not specify a version
number of this License, you may choose any version ever published (not
as a draft) by the Free Software Foundation.</P
></DIV
></DIV
><DIV
CLASS="APPENDIX"
><HR><H1
><A
NAME="X-087-2-SAGE.APP"
></A
>Appendix D. SAGE: The SystemAdministrators Guild</H1
><P
>If you are not getting everything you need from posting to
<SPAN
CLASS="SYSTEMITEM"
>comp.os.linux.*</SPAN
> groups and reading documentation, maybe it's time to
consider joining SAGE, the System Administrators Guild, sponsored by
USENIX.  The main goal of SAGE is to advance system administration as
a profession.  SAGE brings together system and network administrators
to foster professional and technical development, share problems and
solutions, and communicate with users, management, and vendors on
system administration topics.</P
><P
>Current SAGE initiatives include:

<P
></P
><UL
><LI
><P
>Co-sponsoring the highly successful annual System
Administration Conferences (LISA) with USENIX.</P
></LI
><LI
><P
>Publishing <B
CLASS="COMMAND"
>Job Descriptions for System Administrators</B
>, edited by Tina
Darmohray, the first in a series of very practical booklets and resource
guides covering system administration issues and techniques.</P
></LI
><LI
><P
>Creating an archive site, <SPAN
CLASS="SYSTEMITEM"
>ftp.sage.usenix.org</SPAN
>, for papers from the System
Administration Conferences and sysadmin-related documentation.</P
></LI
><LI
><P
>Establishing working groups in areas important to system administrators,
such as jobs, publications, policies, electronic information distribution,
education, vendors, and standards.</P
></LI
></UL
></P
><P
>To learn more about the USENIX Association and its Special Technical
Group, SAGE, contact the USENIX Association office at (510) 528-8649 in
the U.S., or by email to
<SPAN
CLASS="SYSTEMITEM"
>office@usenix.org</SPAN
>.
To receive information electronically, contact 
<SPAN
CLASS="SYSTEMITEM"
>info@usenix.org</SPAN
>.
Annual SAGE membership is $25 (you must also be a member of USENIX).
Members enjoy free subscriptions to <EM
>login:</EM
> and
<B
CLASS="COMMAND"
>Computing Systems</B
>, a quarterly refereed technical journal;
discounts on conference and symposia registration; and
savings on SAGE publication purchases and other services.</P
></DIV
><DIV
CLASS="INDEX"
><HR><H1
><A
NAME="DOC-INDEX"
></A
>Index</H1
><DIV
CLASS="INDEXDIV"
><H2
CLASS="INDEXDIV"
><A
NAME="AEN19798"
>Symbols</A
></H2
><DL
><DT
>! (in email address),
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.OBSOLETE"
>Obsolete Mail Formats</A
>
  </DT
><DT
>% (in email address),
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.MIXING"
>Mixing Different Mail Formats</A
>
  </DT
><DT
>&#38; (in email address),
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.MIXING"
>Mixing Different Mail Formats</A
>
  </DT
><DT
>/etc/aliases file,
    <A
HREF="x15291.htm#AEN15314"
>Managing Mail Aliases</A
>
  </DT
><DT
>/usr/sbin/sendmail,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DT
>16450 UART,
    <A
HREF="x2912.htm"
>Serial Hardware</A
>
  </DT
><DT
>16550 UART,
    <A
HREF="x2912.htm"
>Serial Hardware</A
>
  </DT
><DT
>2.0 kernels
  </DT
><DD
><DL
><DT
>IP accounting,
    <A
HREF="c9157.htm#X-087-2-ACCOUNTING.KERNEL.CONFIG"
>Configuring the Kernel for IP Accounting</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP firewalls,
    <A
HREF="x7720.htm"
>Original IP Firewall (2.0 Kernels)</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>2.2 kernels
  </DT
><DD
><DL
><DT
>IP accounting,
    <A
HREF="c9157.htm#X-087-2-ACCOUNTING.KERNEL.CONFIG"
>Configuring the Kernel for IP Accounting</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP firewall chains,
    <A
HREF="x8114.htm"
>IP Firewall Chains (2.2 Kernels)</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP masquerade,
    <A
HREF="x9617.htm"
>Configuring the Kernel for IP Masquerade</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NFS server support,
    <A
HREF="c11260.htm"
>The NetworkFile System</A
>,
    <A
HREF="x11618.htm"
>Kernel-Based NFSv2 Server Support</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>2.4 kernels
  </DT
><DD
><DL
><DT
>IP accounting,
    <A
HREF="c9157.htm#X-087-2-ACCOUNTING.KERNEL.CONFIG"
>Configuring the Kernel for IP Accounting</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP masquerade,
    <A
HREF="x9617.htm"
>Configuring the Kernel for IP Masquerade</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>netfilter and IP tables,
    <A
HREF="x8543.htm"
>Netfilter and IP Tables (2.4 Kernels)</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>8250 UART,
    <A
HREF="x2912.htm"
>Serial Hardware</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN19849"
>A</A
></H2
><DL
><DT
>A (DNS record),
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DT
>absolute mail address,
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.RFC822"
>RFC-822</A
>
  </DT
><DT
>accept(&#38;#8201;),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>
  </DT
><DT
>access
  </DT
><DD
><DL
><DT
>granting,
    <A
HREF="x6039.htm"
>Using dip</A
>,
    <A
HREF="x6295.htm"
>Running in Server Mode</A
>,
    <A
HREF="x11486.htm"
>The exports File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NNTP,
    <A
HREF="x18051.htm"
>Restricting NNTP Access</A
>,
    <A
HREF="x18107.htm"
>NNTP Authorization</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PPP,
    <A
HREF="x7037.htm"
>General Security Considerations</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>restricting,
    <A
HREF="x1392.htm#X-087-2-INTRO.SECURITY"
>System Security</A
>,
    <A
HREF="x7080.htm#AEN7136"
>The CHAP Secrets File</A
>,
    <A
HREF="x9973.htm"
>The tcpd Access Control Facility</A
>,
    <A
HREF="x11486.htm"
>The exports File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>to remote files,
    <A
HREF="x11349.htm"
>Mounting an NFS Volume</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP,
    <A
HREF="x13353.htm"
>Controlling Access to UUCP Features</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>access network hardware
  </DT
><DD
><DL
><DT
>see interfaces</DT
></DL
></DD
><DT
>access_db feature (sendmail),
    <A
HREF="x15291.htm#X-087-2-SENDMAIL.ACCESSDB"
>The access database</A
>
  </DT
><DT
>active file (INN),
    <A
HREF="x18341.htm#AEN18414"
>The active and newsgroups files</A
>
  </DT
><DT
>active hubs,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DT
>active.times file (/var/lib/news),
    <A
HREF="x17062.htm"
>The active File</A
>
  </DT
><DT
>Address Resolution Protocol
  </DT
><DD
><DL
><DT
>see ARP</DT
></DL
></DD
><DT
>addresses
  </DT
><DD
><DL
><DT
>bang path,
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.OBSOLETE"
>Obsolete Mail Formats</A
>,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>broadcast,
    <A
HREF="x1507.htm"
>IP Addresses</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>choosing (IP),
    <A
HREF="x3385.htm"
>Assigning IP Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>DNS resource record,
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>email,
    <A
HREF="x14108.htm"
>Email Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Ethernet,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Hesiod,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.RECORDS"
>The DNS Database</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>hybrid,
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.MIXING"
>Mixing Different Mail Formats</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>,
    <A
HREF="x1507.htm"
>IP Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>loopback,
    <A
HREF="x1507.htm"
>IP Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>mapping to hostnames,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.IN-ADDR"
>Reverse Lookups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>negotiation with PPP,
    <A
HREF="x6560.htm"
>Running pppd</A
>,
    <A
HREF="x6777.htm#AEN6784"
>Choosing IP Addresses</A
>,
    <A
HREF="x7080.htm#AEN7136"
>The CHAP Secrets File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP hostname,
    <A
HREF="x12725.htm#X-087-2-UUCP.STARTING.SITENAME"
>Site Naming</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>alias files for Exim,
    <A
HREF="x16108.htm#AEN16228"
>Alias Files</A
>
  </DT
><DT
>aliases
  </DT
><DD
><DL
><DT
>C News and,
    <A
HREF="x16837.htm"
>The sys File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>email,
    <A
HREF="x15291.htm#AEN15314"
>Managing Mail Aliases</A
>,
    <A
HREF="x16108.htm#AEN16228"
>Alias Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>hostname,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.RECORDS"
>The DNS Database</A
>,
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>aliasing, IP (Internet Protocol),
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DT
>Allman, Eric,
    <A
HREF="c13847.htm"
>Electronic Mail</A
>
  </DT
><DT
>amateur radio protocols,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DT
>ampersand (in email address),
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.MIXING"
>Mixing Different Mail Formats</A
>
  </DT
><DT
>anonymous UUCP,
    <A
HREF="x13480.htm#AEN13611"
>Anonymous UUCP</A
>
  </DT
><DT
>ArcNet protocol driver,
    <A
HREF="x2714.htm"
>Other Network Types</A
>
  </DT
><DT
>ARP (Address Resolution Protocol),
    <A
HREF="x1625.htm"
>Address Resolution</A
>
  </DT
><DD
><DL
><DT
>display table,
    <A
HREF="x4395.htm"
>Checking the ARP Tables</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>enabling/disabling,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>proxy,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.PLIP"
>The PLIP Interface</A
>,
    <A
HREF="x4395.htm"
>Checking the ARP Tables</A
>,
    <A
HREF="x6777.htm#AEN6843"
>Routing Through a PPP Link</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>ARPANET,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.INTRO"
>Introduction to TCP/IP Networks</A
>
  </DT
><DT
>article command (NNTP),
    <A
HREF="c17725.htm#AEN17994"
>Reading an Article from a Group</A
>
  </DT
><DT
>articles (news),
    <A
HREF="x16402.htm"
>What Is Usenet, Anyway?</A
>
  </DT
><DD
><DL
><DT
>batching,
    <A
HREF="x17145.htm"
>Article Batching</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>expiring,
    <A
HREF="x18341.htm#AEN18793"
>Expiring News Articles</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>listing,
    <A
HREF="c17725.htm#AEN17912"
>Listing New Articles</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>posting,
    <A
HREF="c17725.htm#AEN17892"
>Posting an Article</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>retrieving headers/message body,
    <A
HREF="c17725.htm#AEN17962"
>Retrieving an Article Header Only</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>async map,
    <A
HREF="x6968.htm"
>Link Control Options</A
>
  </DT
><DT
>Asynchronous Control Character Map,
    <A
HREF="x6968.htm"
>Link Control Options</A
>
  </DT
><DT
>ATM (Asynchronous Transfer Mode),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>
  </DT
><DT
>authentication
  </DT
><DD
><DL
><DT
>issues,
    <A
HREF="x1392.htm#X-087-2-INTRO.SECURITY"
>System Security</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>on remote hosts,
    <A
HREF="x10204.htm"
>Configuring Remote Loginand Execution</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>with PPP,
    <A
HREF="x7080.htm"
>Authentication with PPP</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>authoritative name server,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.AUTH"
>Types of Name Servers</A
>,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.RECORDS"
>The DNS Database</A
>,
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DT
>authorization
  </DT
><DD
><DL
><DT
>with NNTP,
    <A
HREF="x18107.htm"
>NNTP Authorization</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>with PPP,
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>auto-IRQ,
    <A
HREF="x2465.htm#AEN2510"
>Ethernet Autoprobing</A
>
  </DT
><DT
>autoprobing
  </DT
><DD
><DL
><DT
>Ethernet,
    <A
HREF="x2465.htm#AEN2510"
>Ethernet Autoprobing</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>failure,
    <A
HREF="x2465.htm#AEN2510"
>Ethernet Autoprobing</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>AX.25 device,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>
  </DT
><DT
>AX.25 protocol,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DT
>AX25 HOWTO,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DT
>Aznar, Guylhem,
    <A
HREF="c13847.htm"
>Electronic Mail</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN20047"
>B</A
></H2
><DL
><DT
>Barber, Stan,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>
  </DT
><DT
>Basic Networking Utilities
  </DT
><DD
><DL
><DT
>see Taylor UUCP, HDB</DT
></DL
></DD
><DT
>batching
  </DT
><DD
><DL
><DT
>email,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>news,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>,
    <A
HREF="x17145.htm"
>Article Batching</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>BBS (Bulletin Board System),
    <A
HREF="c2740.htm#X-087-2-SERIAL.SOFTWARE"
>Communications Software for Modem Links</A
>
  </DT
><DT
>Becker, Donald,
    <A
HREF="x2465.htm"
>Ethernet Installation</A
>
  </DT
><DT
>Berkeley Internet Name Domain
  </DT
><DD
><DL
><DT
>see BIND</DT
></DL
></DD
><DT
>Berkeley Socket Library,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>
  </DT
><DT
>binaries, installing,
    <A
HREF="x3327.htm"
>Installing the Binaries</A
>
  </DT
><DT
>BIND (Berkeley Internet Name Domain),
    <A
HREF="c4495.htm"
>Name Service and Resolver Configuration</A
>,
    <A
HREF="x5256.htm"
>Running named</A
>
  </DT
><DT
>bind(&#38;#8201;),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>
  </DT
><DT
>bindery manipulation tools,
    <A
HREF="x12201.htm#AEN12234"
>Browsing and Manipulating Bindery Data</A
>
  </DT
><DT
>Biro, Ross,
    <A
HREF="x1312.htm"
>Linux Networking</A
>
  </DT
><DT
>blacklist_recipients feature (sendmail),
    <A
HREF="x15291.htm#AEN15485"
>Barring users from receiving mail</A
>
  </DT
><DT
>BNC connector,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DT
>BNU (Basic Networking Utilities)
  </DT
><DD
><DL
><DT
>see Taylor UUCP, HDB</DT
></DL
></DD
><DT
>body command (NNTP),
    <A
HREF="c17725.htm#AEN17982"
>Retrieving an Article Body Only</A
>
  </DT
><DT
>BOOTP,
    <A
HREF="x1625.htm"
>Address Resolution</A
>
  </DT
><DT
>bootup sequence,
    <A
HREF="c3268.htm"
>Configuring TCP/IP Networking</A
>
  </DT
><DT
>bounced mail,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DT
>Brewery, Virtual,
    <A
HREF="a19500.htm"
>Example Network:The Virtual Brewery</A
>
  </DT
><DT
>bridges,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DT
>broadcast address,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DT
>bsmtp program,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DT
>bulletin board,
    <A
HREF="c2740.htm#X-087-2-SERIAL.SOFTWARE"
>Communications Software for Modem Links</A
>
  </DT
><DT
>Burkett, B. Scott,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN20129"
>C</A
></H2
><DL
><DT
>C News,
    <A
HREF="c16357.htm#X-087-2-NEWS.HISTORY"
>Usenet History</A
>,
    <A
HREF="c16575.htm"
>C News</A
>
  </DT
><DD
><DL
><DT
>active file,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>,
    <A
HREF="x16700.htm"
>Installation</A
>,
    <A
HREF="x17062.htm"
>The active File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>archiving,
    <A
HREF="x17317.htm"
>Expiring News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>article batching,
    <A
HREF="x17145.htm"
>Article Batching</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>batch parameters,
    <A
HREF="x17145.htm"
>Article Batching</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>batching,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>,
    <A
HREF="x16837.htm"
>The sys File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>compressing batches,
    <A
HREF="x17145.htm"
>Article Batching</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>control messages in,
    <A
HREF="x17521.htm"
>Control Messages</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>creating initial configuration,
    <A
HREF="x16700.htm"
>Installation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>delivering news in,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>exchanging news,
    <A
HREF="x16837.htm"
>The sys File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>excluding sites,
    <A
HREF="x16837.htm"
>The sys File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>expiration of news in,
    <A
HREF="x17317.htm"
>Expiring News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>history file,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>,
    <A
HREF="x17317.htm"
>Expiring News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>hostname aliases,
    <A
HREF="x16837.htm"
>The sys File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>ihave/sendme,
    <A
HREF="x16837.htm"
>The sys File</A
>,
    <A
HREF="x17145.htm"
>Article Batching</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>in NFS,
    <A
HREF="x17623.htm"
>C News in an NFS Environment</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>installing,
    <A
HREF="x16700.htm"
>Installation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>limiting a feed,
    <A
HREF="x16837.htm"
>The sys File</A
>,
    <A
HREF="x17423.htm"
>Miscellaneous Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>list of current groups,
    <A
HREF="x17062.htm"
>The active File</A
>,
    <A
HREF="x17423.htm"
>Miscellaneous Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>log files,
    <A
HREF="x17423.htm"
>Miscellaneous Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>moderated groups,
    <A
HREF="x17423.htm"
>Miscellaneous Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>newsmaster,
    <A
HREF="x16700.htm"
>Installation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NNTP support,
    <A
HREF="x16837.htm"
>The sys File</A
>,
    <A
HREF="x18135.htm"
>nntpd Interaction with C News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>receiving news,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>,
    <A
HREF="x16837.htm"
>The sys File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>relaynews command,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>rnews command,
    <A
HREF="x16837.htm"
>The sys File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>sending news,
    <A
HREF="x16837.htm"
>The sys File</A
>,
    <A
HREF="x17145.htm"
>Article Batching</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>spool directory,
    <A
HREF="c16575.htm"
>C News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>sys  file,
    <A
HREF="x16837.htm"
>The sys File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>sys file,
    <A
HREF="x16700.htm"
>Installation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>togo file,
    <A
HREF="x16837.htm"
>The sys File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>update low water mark,
    <A
HREF="x17062.htm"
>The active File</A
>,
    <A
HREF="x17317.htm"
>Expiring News</A
>,
    <A
HREF="x19359.htm"
>trn Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>updating active files,
    <A
HREF="x17521.htm#X-087-2-CNEWS.CONTROL.CHECKGROUPS"
>The checkgroups Message</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>usenet,
    <A
HREF="x16700.htm"
>Installation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>,
    <A
HREF="x17145.htm"
>Article Batching</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>cache (BIND option),
    <A
HREF="x5256.htm#AEN5298"
>The named.boot File</A
>
  </DT
><DT
>caching-only name server,
    <A
HREF="x5256.htm#X-087-2-RESOLV.NAMED-CACHINGONLY"
>Caching-only named Configuration</A
>,
    <A
HREF="x6560.htm"
>Running pppd</A
>
  </DT
><DT
>Caldera (Linux distribution),
    <A
HREF="x16.htm#AEN317"
>Obtaining Linux</A
>
  </DT
><DD
><DL
><DT
>NetWare support,
    <A
HREF="x11757.htm#AEN11787"
>Caldera Support</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>call sequence checks,
    <A
HREF="c12477.htm#X-087-2-UUCICO.CONNECT"
>The Inner Workings of uucico</A
>
  </DT
><DT
>cancel control message,
    <A
HREF="x17521.htm#X-087-2-CNEWS.CONTROL.CANCEL"
>The cancel Message</A
>
  </DT
><DT
>canonical hostname,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.RECORDS"
>The DNS Database</A
>,
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DT
>centralized mail handling,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.INTERNET"
>Mail Routing on the Internet</A
>,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DT
>chains
  </DT
><DD
><DL
><DT
>IP firewall,
    <A
HREF="x8114.htm"
>IP Firewall Chains (2.2 Kernels)</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>user-defined,
    <A
HREF="x8114.htm#AEN8418"
>User-defined chains</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>CHAP (Challenge Handshake Authentication Protocol),
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>,
    <A
HREF="x7080.htm"
>Authentication with PPP</A
>,
    <A
HREF="x7080.htm#AEN7136"
>The CHAP Secrets File</A
>
  </DT
><DT
>character set in elm,
    <A
HREF="x14485.htm#X-087-2-MAIL.ELM.CHARSETS"
>National Character Sets</A
>
  </DT
><DT
>chargen (internal service),
    <A
HREF="c9830.htm#X-087-2-APPL.INETD"
>The inetd Super Server</A
>
  </DT
><DT
>chat program,
    <A
HREF="c6438.htm#AEN6507"
>PPP on Linux</A
>,
    <A
HREF="x6675.htm"
>Using chat to Automate Dialing</A
>
  </DT
><DD
><DL
><DT
>PPP,
    <A
HREF="x6675.htm"
>Using chat to Automate Dialing</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>SLIP,
    <A
HREF="x6039.htm#X-087-2-SLIP.DIP.SAMPLE"
>A Sample Script</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>chat script,
    <A
HREF="x6675.htm"
>Using chat to Automate Dialing</A
>
  </DT
><DD
><DL
><DT
>UUCP,
    <A
HREF="x12725.htm#AEN13024"
>The login chat</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>checkgroups control message,
    <A
HREF="x17521.htm#X-087-2-CNEWS.CONTROL.CHECKGROUPS"
>The checkgroups Message</A
>,
    <A
HREF="x17521.htm#X-087-2-CNEWS.CONTROL.SENDSYS"
>sendsys, version, and senduuname</A
>
  </DT
><DT
>checking
  </DT
><DD
><DL
><DT
>ARP tables,
    <A
HREF="x4395.htm"
>Checking the ARP Tables</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Ethernet interface,
    <A
HREF="x4395.htm"
>Checking the ARP Tables</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>hostnames,
    <A
HREF="x5256.htm#X-087-2-RESOLV.NSLOOKUP"
>Verifying the Name Server Setup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP routing table,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>mail queue,
    <A
HREF="x16011.htm"
>Mail Delivery Modes</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>name server,
    <A
HREF="x5256.htm#X-087-2-RESOLV.NSLOOKUP"
>Verifying the Name Server Setup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>network
  </DT
><DD
><DL
><DT
>configuration,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>
  </DT
><DT
>connections,
    <A
HREF="x4200.htm#X-087-2-IFACE.NETSTAT.-T-U-X"
>Displaying Connections</A
>
  </DT
><DT
>interface,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>,
    <A
HREF="x4200.htm#X-087-2-IFACE.NETSTAT.-I"
>Displaying Interface Statistics</A
>
  </DT
></DL
></DD
><DT
>NIS,
    <A
HREF="x10820.htm"
>Running an NIS Server</A
>,
    <A
HREF="x10953.htm"
>Setting Up an NIS Client with GNU libc</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NNTP,
    <A
HREF="x18135.htm"
>nntpd Interaction with C News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PPP,
    <A
HREF="x7261.htm"
>Debugging Your PPP Setup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>reachabilty,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>routing table,
    <A
HREF="x4200.htm#X-087-2-IFACE.NETSTAT.-R"
>Displaying the Routing Table</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>TCP server activity,
    <A
HREF="x4200.htm#X-087-2-IFACE.NETSTAT.-T-U-X"
>Displaying Connections</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP,
    <A
HREF="x12725.htm#AEN12885"
>Taylor Configuration Files</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>choosing
  </DT
><DD
><DL
><DT
>IP addresses,
    <A
HREF="x3385.htm"
>Assigning IP Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NIS domain,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NIS maps,
    <A
HREF="x11028.htm"
>Choosing the Right Maps</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP hostname,
    <A
HREF="x12725.htm#X-087-2-UUCP.STARTING.SITENAME"
>Site Naming</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>CNAME (DNS record),
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DT
>code, obtaining for
  </DT
><DD
><DL
><DT
>Linux network,
    <A
HREF="x16.htm#AEN317"
>Obtaining Linux</A
>,
    <A
HREF="x1312.htm#AEN1372"
>Where to Get the Code</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>sendmail,
    <A
HREF="x14607.htm"
>Installing sendmail</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>collisions (Ethernet),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DT
>Collyer, Geoff,
    <A
HREF="c16357.htm#X-087-2-NEWS.HISTORY"
>Usenet History</A
>
  </DT
><DT
>com domain,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DT
>COM port,
    <A
HREF="x2821.htm#X-087-2-SERIAL.DEVICEFILES"
>The Serial Device Special Files</A
>
  </DT
><DT
>comp.mail.uucp,
    <A
HREF="c12477.htm"
>ManagingTaylor UUCP</A
>
  </DT
><DT
>comp.os.linux.admin,
    <A
HREF="x16.htm#AEN190"
>Linux Usenet Newsgroups</A
>
  </DT
><DT
>comp.os.linux.announce,
    <A
HREF="x16.htm#AEN190"
>Linux Usenet Newsgroups</A
>
  </DT
><DT
>comp.os.linux.development,
    <A
HREF="x16.htm#AEN190"
>Linux Usenet Newsgroups</A
>
  </DT
><DT
>comp.os.linux.help,
    <A
HREF="x16.htm#AEN190"
>Linux Usenet Newsgroups</A
>
  </DT
><DT
>comp.os.linux.misc,
    <A
HREF="x16.htm#AEN190"
>Linux Usenet Newsgroups</A
>
  </DT
><DT
>comp.os.linux.networking,
    <A
HREF="x16.htm#AEN190"
>Linux Usenet Newsgroups</A
>
  </DT
><DT
>Compressed Serial Line IP
  </DT
><DD
><DL
><DT
>see CSLIP</DT
></DL
></DD
><DT
>configuration files
  </DT
><DD
><DL
><DT
>INN (Internet News),
    <A
HREF="x18341.htm"
>INN Configuration Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>sendmail,
    <A
HREF="x14644.htm"
>Overview of Configuration Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Taylor UUCP,
    <A
HREF="x12725.htm#AEN12885"
>Taylor Configuration Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP,
    <A
HREF="x12725.htm"
>UUCP Configuration Files</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>configuring
  </DT
><DD
><DL
><DT
>C News,
    <A
HREF="x16700.htm"
>Installation</A
>
  </DT
><DD
><DL
><DT
>on a LAN,
    <A
HREF="x17623.htm"
>C News in an NFS Environment</A
>
  </DT
></DL
></DD
><DT
>caching-only name server,
    <A
HREF="x5256.htm#X-087-2-RESOLV.NAMED-CACHINGONLY"
>Caching-only named Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>default domain,
    <A
HREF="c4495.htm#X-087-2-RESOLV.RESOLV"
>Configuring Name Server Lookups Using resolv.conf</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>dip program,
    <A
HREF="x6039.htm"
>Using dip</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>DNS over SLIP/PPP,
    <A
HREF="x5256.htm#X-087-2-RESOLV.NAMED-CACHINGONLY"
>Caching-only named Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>elm (electronic mail),
    <A
HREF="x14485.htm"
>Configuring elm</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Ethernet,
    <A
HREF="c2016.htm#AEN2131"
>Kernel Options in Linux 2.0 and Higher</A
>,
    <A
HREF="x2465.htm"
>Ethernet Installation</A
>,
    <A
HREF="x2465.htm#AEN2510"
>Ethernet Autoprobing</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Exim
  </DT
><DD
><DL
><DT
>see Exim</DT
></DL
></DD
><DT
>hostname,
    <A
HREF="x3343.htm"
>Setting the Hostname</A
>
  </DT
><DD
><DL
><DT
>resolution,
    <A
HREF="x3450.htm"
>Writing hosts and networks Files</A
>,
    <A
HREF="c4495.htm"
>Name Service and Resolver Configuration</A
>
  </DT
></DL
></DD
><DT
>IP accounting,
    <A
HREF="x9190.htm"
>Configuring IP Accounting</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP gateways,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.GATEWAY-CONF"
>Configuring a Gateway</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP masquerade,
    <A
HREF="x9680.htm"
>Configuring IP Masquerade</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IPX,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>kernel,
    <A
HREF="c2016.htm#AEN2131"
>Kernel Options in Linux 2.0 and Higher</A
>
  </DT
><DD
><DL
><DT
>for IP accounting,
    <A
HREF="c9157.htm#X-087-2-ACCOUNTING.KERNEL.CONFIG"
>Configuring the Kernel for IP Accounting</A
>
  </DT
><DT
>with IP firewall,
    <A
HREF="x7613.htm"
>Setting Up Linux for Firewalling</A
>
  </DT
><DT
>for IP masquerade,
    <A
HREF="x9617.htm"
>Configuring the Kernel for IP Masquerade</A
>
  </DT
></DL
></DD
><DT
>loopback interface device,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>name server,
    <A
HREF="x5256.htm"
>Running named</A
>
  </DT
><DD
><DL
><DT
>lookups,
    <A
HREF="c4495.htm#X-087-2-RESOLV.RESOLV"
>Configuring Name Server Lookups Using resolv.conf</A
>
  </DT
></DL
></DD
><DT
>networks
  </DT
><DD
><DL
><DT
>hardware,
    <A
HREF="c2016.htm"
>Configuringthe NetworkingHardware</A
>
  </DT
><DT
>interfaces,
    <A
HREF="x3515.htm"
>Interface Configuration for IP</A
>
  </DT
><DT
>services,
    <A
HREF="c9830.htm#X-087-2-APPL.INETD"
>The inetd Super Server</A
>
  </DT
></DL
></DD
><DT
>newsfeeds,
    <A
HREF="x18341.htm#AEN18490"
>Configuring Newsfeeds</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>newsgroups,
    <A
HREF="x18341.htm#AEN18401"
>Configuring Newsgroups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>newsreader,
    <A
HREF="c19276.htm"
>Newsreader Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NFS,
    <A
HREF="c2016.htm#AEN2131"
>Kernel Options in Linux 2.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NIS,
    <A
HREF="c10509.htm"
>The Network Information System</A
>,
    <A
HREF="x10820.htm"
>Running an NIS Server</A
>,
    <A
HREF="x10953.htm"
>Setting Up an NIS Client with GNU libc</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NNTP,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PLIP,
    <A
HREF="c2016.htm#AEN2131"
>Kernel Options in Linux 2.0 and Higher</A
>,
    <A
HREF="x2592.htm"
>The PLIP Driver</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.PLIP"
>The PLIP Interface</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PPP,
    <A
HREF="c2016.htm#AEN2131"
>Kernel Options in Linux 2.0 and Higher</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.SLIP"
>The SLIP and PPP Interfaces</A
>,
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>,
    <A
HREF="x6560.htm"
>Running pppd</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>remote login and execution,
    <A
HREF="x10204.htm"
>Configuring Remote Loginand Execution</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>sendmail,
    <A
HREF="c14579.htm"
>Sendmail</A
>
  </DT
><DD
><DL
><DT
>for SMTP,
    <A
HREF="x14661.htm#AEN14682"
>Two Example sendmail.mc Files</A
>
  </DT
></DL
></DD
><DT
>serial port,
    <A
HREF="x2943.htm"
>Using the Configuration Utilities</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>SLIP,
    <A
HREF="c2016.htm#AEN2131"
>Kernel Options in Linux 2.0 and Higher</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.SLIP"
>The SLIP and PPP Interfaces</A
>,
    <A
HREF="c5847.htm"
>Serial Line IP</A
>
  </DT
><DD
><DL
><DT
>server,
    <A
HREF="x6295.htm"
>Running in Server Mode</A
>
  </DT
></DL
></DD
><DT
>ssh command,
    <A
HREF="x10204.htm#AEN10275"
>Installing and Configuring ssh</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Taylor UUCP,
    <A
HREF="c12477.htm"
>ManagingTaylor UUCP</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Usenet news,
    <A
HREF="x16700.htm"
>Installation</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>connect(&#38;#8201;),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>
  </DT
><DT
>control.ctl file (INN),
    <A
HREF="x18341.htm#AEN18873"
>The control.ctl file</A
>
  </DT
><DT
>copyright information,
    <A
HREF="a19564.htm"
>Linux Network Administrator's Guide, Second Edition Copyright Information</A
>
  </DT
><DT
>Corel (Linux distribution),
    <A
HREF="x16.htm#AEN317"
>Obtaining Linux</A
>
  </DT
><DT
>Cox, Alan,
    <A
HREF="x1312.htm"
>Linux Networking</A
>,
    <A
HREF="x7720.htm"
>Original IP Firewall (2.0 Kernels)</A
>,
    <A
HREF="x11757.htm"
>IPX and Linux</A
>
  </DT
><DT
>creating
  </DT
><DD
><DL
><DT
>DNS zones,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.IN-ADDR"
>Reverse Lookups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NIS maps,
    <A
HREF="x10820.htm"
>Running an NIS Server</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>subdomains,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>subnets,
    <A
HREF="x3422.htm"
>Creating Subnets</A
>,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.IN-ADDR"
>Reverse Lookups</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>cron,
    <A
HREF="x1392.htm"
>Maintaining Your System</A
>
  </DT
><DD
><DL
><DT
>expiring mail from,
    <A
HREF="x17317.htm"
>Expiring News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>running
  </DT
><DD
><DL
><DT
>Exim via,
    <A
HREF="x16011.htm"
>Mail Delivery Modes</A
>
  </DT
><DT
>newsdaily in,
    <A
HREF="x17653.htm"
>Maintenance Tools and Tasks</A
>
  </DT
><DT
>nnmaster via,
    <A
HREF="x19426.htm"
>nn Configuration</A
>
  </DT
></DL
></DD
></DL
></DD
><DT
>CSLIP (Compressed Serial Line IP) protocol,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SLIP"
>IP Over Serial Lines</A
>,
    <A
HREF="x5881.htm"
>SLIP Operation</A
>,
    <A
HREF="x6295.htm"
>Running in Server Mode</A
>,
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>
  </DT
><DT
>ctlinnd command (INN),
    <A
HREF="x19030.htm"
>Managing INN: The ctlinnd Command</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN20532"
>D</A
></H2
><DL
><DT
>D-Link pocket adaptor,
    <A
HREF="x2465.htm"
>Ethernet Installation</A
>
  </DT
><DT
>daemons,
    <A
HREF="c9830.htm#X-087-2-APPL.INETD"
>The inetd Super Server</A
>
  </DT
><DD
><DL
><DT
>wrapping via tcpd,
    <A
HREF="x9973.htm"
>The tcpd Access Control Facility</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>datagram types, ICMP protocol,
    <A
HREF="x7720.htm#X-087-2-FIREWALL.IPFWADM.ICMP-TYPES"
>ICMP datagram types</A
>
  </DT
><DT
>datagrams,
    <A
HREF="x792.htm"
>TCP/IP Networks</A
>,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>
  </DT
><DD
><DL
><DT
>fragmentation of,
    <A
HREF="x9190.htm#X-087-2-ACCOUNTING.BY.SERVICE"
>Accounting by Service Port</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP chains vs. netfilter,
    <A
HREF="x8543.htm"
>Netfilter and IP Tables (2.4 Kernels)</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP filtering,
    <A
HREF="x7578.htm"
>What Is IP Filtering?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>masquerading,
    <A
HREF="c9580.htm"
>IP Masquerade and Network Address Translation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>stages of processing,
    <A
HREF="x7685.htm"
>Three Ways We Can Do Filtering</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Davies, David C.,
    <A
HREF="x2465.htm"
>Ethernet Installation</A
>
  </DT
><DT
>daytime (internal service),
    <A
HREF="c9830.htm#X-087-2-APPL.INETD"
>The inetd Super Server</A
>
  </DT
><DT
>dbmload program,
    <A
HREF="x10820.htm"
>Running an NIS Server</A
>
  </DT
><DT
>DDI (Device Driver Interface),
    <A
HREF="x1312.htm#AEN1352"
>Different Streaks of Development</A
>
  </DT
><DT
>Debian (Linux distribution),
    <A
HREF="x16.htm#AEN317"
>Obtaining Linux</A
>
  </DT
><DT
>debugging
  </DT
><DD
><DL
><DT
>DNS databases,
    <A
HREF="x5256.htm#AEN5795"
>Other Useful Tools</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PPP setup,
    <A
HREF="x7261.htm"
>Debugging Your PPP Setup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP setup,
    <A
HREF="c12477.htm#AEN12640"
>uucico Command-line Options</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>default email route,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DT
>default IP route
  </DT
><DD
><DL
><DT
>see IP (Internet Protocol), default route</DT
></DL
></DD
><DT
>delegating
  </DT
><DD
><DL
><DT
>DNS subdomains,
    <A
HREF="x4905.htm"
>How DNS Works</A
>,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.IN-ADDR"
>Reverse Lookups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP subnets,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.SUBNETS"
>Subnetworks</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>delivering
  </DT
><DD
><DL
><DT
>email,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>news,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>demand dialing,
    <A
HREF="x7297.htm#AEN7379"
>Demand Dialing</A
>
  </DT
><DT
>denial of service attacks,
    <A
HREF="c7478.htm#X-082-2-FIREWALL.ATTACKS"
>Methods of Attack</A
>
  </DT
><DT
>Dent, Arthur,
    <A
HREF="x6295.htm"
>Running in Server Mode</A
>
  </DT
><DT
>/dev/cua*,
    <A
HREF="x2821.htm"
>Accessing Serial Devices</A
>
  </DT
><DT
>/dev/modem,
    <A
HREF="x2821.htm#X-087-2-SERIAL.DEVICEFILES"
>The Serial Device Special Files</A
>
  </DT
><DT
>/dev/ttyS*,
    <A
HREF="x2821.htm"
>Accessing Serial Devices</A
>
  </DT
><DT
>Device Driver Interface (DDI),
    <A
HREF="x1312.htm#AEN1352"
>Different Streaks of Development</A
>
  </DT
><DT
>device drivers,
    <A
HREF="c2016.htm"
>Configuringthe NetworkingHardware</A
>
  </DT
><DT
>device files,
    <A
HREF="c2016.htm"
>Configuringthe NetworkingHardware</A
>
  </DT
><DT
>devices
  </DT
><DD
><DL
><DT
>Linux network,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>major/minor numbers,
    <A
HREF="c2016.htm"
>Configuringthe NetworkingHardware</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>serial,
    <A
HREF="c2740.htm"
>Configuring the Serial Hardware</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>supporting IPX,
    <A
HREF="x11819.htm#X-087-2-IPX.DEVICES"
>Network Devices Supporting IPX</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Dial-Up List (DUL),
    <A
HREF="x16298.htm"
>Protecting Against Mail Spam</A
>
  </DT
><DT
>dialin device,
    <A
HREF="x2821.htm"
>Accessing Serial Devices</A
>
  </DT
><DT
>dialing
  </DT
><DD
><DL
><DT
>demand,
    <A
HREF="x7297.htm#AEN7379"
>Demand Dialing</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>persistent,
    <A
HREF="x7297.htm#AEN7441"
>Persistent Dialing</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>dialout device,
    <A
HREF="x2821.htm"
>Accessing Serial Devices</A
>
  </DT
><DT
>dialup IP,
    <A
HREF="c5847.htm"
>Serial Line IP</A
>
  </DT
><DT
>dip program,
    <A
HREF="x6039.htm"
>Using dip</A
>
  </DT
><DT
>diphosts file,
    <A
HREF="x6295.htm"
>Running in Server Mode</A
>
  </DT
><DT
>diplogin command,
    <A
HREF="x6295.htm"
>Running in Server Mode</A
>
  </DT
><DT
>diskless clients,
    <A
HREF="x1625.htm"
>Address Resolution</A
>
  </DT
><DT
>DISPLAY (environment variable),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.INTRO"
>Introduction to TCP/IP Networks</A
>
  </DT
><DT
>displaying
  </DT
><DD
><DL
><DT
>active connections,
    <A
HREF="x4200.htm#X-087-2-IFACE.NETSTAT.-T-U-X"
>Displaying Connections</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>ARP table,
    <A
HREF="x4395.htm"
>Checking the ARP Tables</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>interface
  </DT
><DD
><DL
><DT
>configuration,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DT
>statistics,
    <A
HREF="x4200.htm#X-087-2-IFACE.NETSTAT.-I"
>Displaying Interface Statistics</A
>
  </DT
></DL
></DD
><DT
>IP routing table,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>,
    <A
HREF="x4200.htm#X-087-2-IFACE.NETSTAT.-R"
>Displaying the Routing Table</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>irtt,
    <A
HREF="x4200.htm#X-087-2-IFACE.NETSTAT.-R"
>Displaying the Routing Table</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NIS map nicknames,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP configuration,
    <A
HREF="x12725.htm#AEN12885"
>Taylor Configuration Files</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>DNS (Domain Name System),
    <A
HREF="x1966.htm"
>Resolving Host Names</A
>
  </DT
><DD
><DL
><DT
>checking,
    <A
HREF="x5256.htm#X-087-2-RESOLV.NSLOOKUP"
>Verifying the Name Server Setup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring server,
    <A
HREF="x5256.htm"
>Running named</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>converting /etc/hosts,
    <A
HREF="x5256.htm#AEN5795"
>Other Useful Tools</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>databases,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.RECORDS"
>The DNS Database</A
>,
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>debugging databases,
    <A
HREF="x5256.htm#AEN5795"
>Other Useful Tools</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>lookup,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.LOOKUPS"
>Name Lookups with DNS</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>query,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.LOOKUPS"
>Name Lookups with DNS</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>resolver and,
    <A
HREF="c4495.htm#X-087-2-RESOLV.NSSWITCH-CONF"
>The nsswitch.conf File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>resource record,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.RECORDS"
>The DNS Database</A
>,
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>reverse mapping,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.IN-ADDR"
>Reverse Lookups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>root name servers,
    <A
HREF="x5256.htm#AEN5685"
>Writing the Master Files</A
>,
    <A
HREF="x5256.htm#X-087-2-RESOLV.NSLOOKUP"
>Verifying the Name Server Setup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>RR
  </DT
><DD
><DL
><DT
>see DNS, resource record</DT
></DL
></DD
><DT
>time to live,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.LOOKUPS"
>Name Lookups with DNS</A
>,
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>tools,
    <A
HREF="x5256.htm#AEN5795"
>Other Useful Tools</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>zones,
    <A
HREF="x4905.htm"
>How DNS Works</A
>,
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>dnswalk program,
    <A
HREF="x5256.htm#AEN5795"
>Other Useful Tools</A
>
  </DT
><DT
>documentation (Linux)
  </DT
><DD
><DL
><DT
>commercial,
    <A
HREF="x16.htm#AEN133"
>Documentation Available Commercially</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>via FTP,
    <A
HREF="x16.htm#AEN107"
>Documentation Available via FTP</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>via WWW,
    <A
HREF="x16.htm#AEN119"
>Documentation Available via WWW</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>DOMAIN macro definition,
    <A
HREF="x14661.htm#AEN14783"
>DOMAIN</A
>
  </DT
><DT
>domain name servers,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.AUTH"
>Types of Name Servers</A
>
  </DT
><DT
>Domain Name System
  </DT
><DD
><DL
><DT
>see DNS</DT
></DL
></DD
><DT
>domainname command,
    <A
HREF="x3343.htm"
>Setting the Hostname</A
>,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DT
>domains,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DD
><DL
><DT
>mail routing,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>names,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DD
><DL
><DT
>default,
    <A
HREF="c4495.htm#X-087-2-RESOLV.RESOLV"
>Configuring Name Server Lookups Using resolv.conf</A
>
  </DT
><DT
>NIS versus DNS,
    <A
HREF="x3343.htm"
>Setting the Hostname</A
>
  </DT
></DL
></DD
><DT
>NIS,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>,
    <A
HREF="x10953.htm"
>Setting Up an NIS Client with GNU libc</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>top-level,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>dotted decimal notation,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>
  </DT
><DT
>dotted quad notation,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>,
    <A
HREF="x1507.htm"
>IP Addresses</A
>
  </DT
><DT
>drivers
  </DT
><DD
><DL
><DT
>ArcNet,
    <A
HREF="x2714.htm"
>Other Network Types</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>D-Link,
    <A
HREF="x2465.htm"
>Ethernet Installation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Ethernet,
    <A
HREF="x2465.htm"
>Ethernet Installation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>FDDI,
    <A
HREF="x2714.htm"
>Other Network Types</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PLIP,
    <A
HREF="x2592.htm"
>The PLIP Driver</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PPP,
    <A
HREF="x2695.htm"
>The PPP and SLIP Drivers</A
>,
    <A
HREF="c6438.htm#AEN6507"
>PPP on Linux</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>SLIP,
    <A
HREF="x2695.htm"
>The PPP and SLIP Drivers</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Token Ring,
    <A
HREF="x2714.htm"
>Other Network Types</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Dryak, Ales,
    <A
HREF="x11757.htm"
>IPX and Linux</A
>,
    <A
HREF="x12457.htm"
>NetWare Server Emulation</A
>
  </DT
><DT
>dummy interface configuration,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.DUMMY"
>The Dummy Interface</A
>
  </DT
><DT
>dynamic routing,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.TABLE"
>The Routing Table</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN20806"
>E</A
></H2
><DL
><DT
>eavesdropping programs,
    <A
HREF="c7478.htm#X-082-2-FIREWALL.ATTACKS"
>Methods of Attack</A
>
  </DT
><DT
>Echo Request/Echo Response messages,
    <A
HREF="x6968.htm"
>Link Control Options</A
>
  </DT
><DT
>echo service,
    <A
HREF="x10107.htm"
>The Services and Protocols Files</A
>
  </DT
><DT
>edu domain,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DT
>Ekwall, Bjrn,
    <A
HREF="x2465.htm"
>Ethernet Installation</A
>
  </DT
><DT
>electronic mail
  </DT
><DD
><DL
><DT
>see email</DT
></DL
></DD
><DT
>elm (electronic mail),
    <A
HREF="x14485.htm"
>Configuring elm</A
>
  </DT
><DD
><DL
><DT
>national character sets,
    <A
HREF="x14485.htm#X-087-2-MAIL.ELM.CHARSETS"
>National Character Sets</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>email,
    <A
HREF="c13847.htm"
>Electronic Mail</A
>
  </DT
><DD
><DL
><DT
>address formats,
    <A
HREF="x14108.htm"
>Email Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>aliases,
    <A
HREF="x15291.htm#AEN15314"
>Managing Mail Aliases</A
>,
    <A
HREF="x16108.htm#AEN16228"
>Alias Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>bang path notation,
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.OBSOLETE"
>Obsolete Mail Formats</A
>,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>barring users from receiving,
    <A
HREF="x15291.htm#AEN15485"
>Barring users from receiving mail</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>batching,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>bounced,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>centralizing,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.INTERNET"
>Mail Routing on the Internet</A
>,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>composing,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>default route,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>delivering,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>directing to a file,
    <A
HREF="x16108.htm#X-087-2-EXIM.DIRECTORS"
>Delivering Messages to Local Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>domain-based routing,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.INTERNET"
>Mail Routing on the Internet</A
>,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>elm,
    <A
HREF="x14485.htm"
>Configuring elm</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Exim,
    <A
HREF="c13847.htm"
>Electronic Mail</A
>,
    <A
HREF="x575.htm"
>Acknowledgments</A
>
  </DT
><DD
><DL
><DT
>see also Exim</DT
></DL
></DD
><DT
>feeding to a command,
    <A
HREF="x16108.htm#X-087-2-EXIM.DIRECTORS"
>Delivering Messages to Local Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>forwarding,
    <A
HREF="x16108.htm#AEN16195"
>Forwarding</A
>,
    <A
HREF="x16108.htm#AEN16228"
>Alias Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>gateway,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.INTERNET"
>Mail Routing on the Internet</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>managing spam,
    <A
HREF="x15291.htm#AEN15394"
>Managing Unwanted or Unsolicited Mail (Spam)</A
>,
    <A
HREF="x16298.htm"
>Protecting Against Mail Spam</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>map files,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>maps,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>message body,
    <A
HREF="c13847.htm#X-087-2-MAIL.MESSAGE-FORMAT"
>What Is a Mail Message?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>message format,
    <A
HREF="c13847.htm#X-087-2-MAIL.MESSAGE-FORMAT"
>What Is a Mail Message?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>message headers,
    <A
HREF="c13847.htm#X-087-2-MAIL.MESSAGE-FORMAT"
>What Is a Mail Message?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>multimedia,
    <A
HREF="c13847.htm"
>Electronic Mail</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>over UUCP,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>paths file,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>queue,
    <A
HREF="x15691.htm#AEN15722"
>Forcing a Remote Host to Process its Mail Queue</A
>,
    <A
HREF="c15849.htm"
>Getting EximUp and Running</A
>,
    <A
HREF="x16011.htm"
>Mail Delivery Modes</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>routing,
    <A
HREF="x14210.htm"
>How Does Mail Routing Work?</A
>
  </DT
><DD
><DL
><DT
>between Internet and UUCP,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.INTERNET"
>Mail Routing on the Internet</A
>
  </DT
><DT
>domain-based,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DT
>on Internet,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.INTERNET"
>Mail Routing on the Internet</A
>
  </DT
><DT
>smart host,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DT
>UUCP networks,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
></DL
></DD
><DT
>sendmail,
    <A
HREF="c13847.htm"
>Electronic Mail</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>unsolicited,
    <A
HREF="x15291.htm#AEN15394"
>Managing Unwanted or Unsolicited Mail (Spam)</A
>,
    <A
HREF="x16298.htm"
>Protecting Against Mail Spam</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>virtual hosting,
    <A
HREF="x15291.htm#AEN15506"
>Configuring Virtual Email Hosting</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>envelope,
    <A
HREF="c13847.htm#X-087-2-MAIL.MESSAGE-FORMAT"
>What Is a Mail Message?</A
>
  </DT
><DT
>environment variables
  </DT
><DD
><DL
><DT
>DISPLAY,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.INTRO"
>Introduction to TCP/IP Networks</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NNTPSERVER,
    <A
HREF="c19276.htm#X-087-2-NEWSREADERS.TIN"
>tin Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>resolver,
    <A
HREF="c4495.htm#X-087-2-RESOLV.ENVIRON"
>Resolver environment variables</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Eriksson, Peter,
    <A
HREF="c10509.htm"
>The Network Information System</A
>
  </DT
><DT
>errors, checking for,
    <A
HREF="x1392.htm"
>Maintaining Your System</A
>
  </DT
><DT
>establishing the connection,
    <A
HREF="x6675.htm"
>Using chat to Automate Dialing</A
>
  </DT
><DT
>/etc/aliases file,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>,
    <A
HREF="x16108.htm#AEN16228"
>Alias Files</A
>
  </DT
><DT
>/etc/dip.pid file,
    <A
HREF="x6039.htm#X-087-2-SLIP.DIP.SAMPLE"
>A Sample Script</A
>
  </DT
><DT
>/etc/diphosts file,
    <A
HREF="x6295.htm"
>Running in Server Mode</A
>
  </DT
><DT
>/etc/exports file,
    <A
HREF="x11486.htm"
>The exports File</A
>
  </DT
><DT
>/etc/fstab file,
    <A
HREF="c3268.htm#X-087-2-IFACE.PROCFS"
>Mounting the /proc Filesystem</A
>,
    <A
HREF="x11349.htm"
>Mounting an NFS Volume</A
>
  </DT
><DT
>/etc/group file,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>,
    <A
HREF="x11134.htm"
>Using the passwd and group Maps</A
>
  </DT
><DT
>/etc/host file,
    <A
HREF="c4495.htm#X-087-2-RESOLV.ROBUSTNESS"
>Resolver Robustness</A
>
  </DT
><DT
>/etc/host.conf file,
    <A
HREF="c4495.htm#X-087-2-RESOLV.ROBUSTNESS"
>Resolver Robustness</A
>
  </DT
><DT
>/etc/hosts file,
    <A
HREF="x3450.htm"
>Writing hosts and networks Files</A
>,
    <A
HREF="c10509.htm"
>The Network Information System</A
>,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DT
>/etc/hosts.allow file,
    <A
HREF="x9973.htm"
>The tcpd Access Control Facility</A
>
  </DT
><DT
>/etc/hosts.deny file,
    <A
HREF="x9973.htm"
>The tcpd Access Control Facility</A
>
  </DT
><DT
>/etc/inetd.conf file,
    <A
HREF="x13480.htm#X-087-2-UUCP.DIALIN.ACCOUNTS"
>Providing UUCP Accounts</A
>,
    <A
HREF="c15849.htm#AEN15909"
>Running Exim</A
>
  </DT
><DT
>/etc/named.boot file,
    <A
HREF="x5256.htm"
>Running named</A
>
  </DT
><DT
>/etc/networks file,
    <A
HREF="x3450.htm"
>Writing hosts and networks Files</A
>,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DT
>/etc/news/incoming.conf file (INN),
    <A
HREF="x18341.htm#AEN18703"
>The incoming.conf file</A
>
  </DT
><DT
>/etc/nntpserver file,
    <A
HREF="c19276.htm#X-087-2-NEWSREADERS.TIN"
>tin Configuration</A
>
  </DT
><DT
>/etc/nsswitch.conf file,
    <A
HREF="x11028.htm"
>Choosing the Right Maps</A
>
  </DT
><DT
>/etc/passwd file,
    <A
HREF="x7297.htm#AEN7303"
>PPP Server</A
>,
    <A
HREF="c9830.htm#X-087-2-APPL.INETD"
>The inetd Super Server</A
>,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>,
    <A
HREF="x11134.htm"
>Using the passwd and group Maps</A
>
  </DT
><DD
><DL
><DT
>real user names,
    <A
HREF="x16700.htm"
>Installation</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>/etc/ppp/chap-secrets file,
    <A
HREF="x7080.htm#AEN7101"
>PAP Versus CHAP</A
>,
    <A
HREF="x7080.htm#AEN7136"
>The CHAP Secrets File</A
>
  </DT
><DT
>/etc/ppp/options file,
    <A
HREF="x6638.htm"
>Using Options Files</A
>,
    <A
HREF="x7037.htm"
>General Security Considerations</A
>,
    <A
HREF="x7080.htm#AEN7101"
>PAP Versus CHAP</A
>
  </DT
><DT
>/etc/ppp/pap-secrets file,
    <A
HREF="x7080.htm#AEN7101"
>PAP Versus CHAP</A
>,
    <A
HREF="x7080.htm#AEN7224"
>The PAP Secrets File</A
>
  </DT
><DT
>/etc/protocols file,
    <A
HREF="x10107.htm"
>The Services and Protocols Files</A
>,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DT
>/etc/rpc file,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DT
>/etc/services file,
    <A
HREF="x10107.htm"
>The Services and Protocols Files</A
>,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>,
    <A
HREF="c15849.htm#AEN15909"
>Running Exim</A
>
  </DT
><DT
>/etc/shadow file,
    <A
HREF="x7297.htm#AEN7303"
>PPP Server</A
>,
    <A
HREF="x11226.htm"
>Using NIS with Shadow Support</A
>
  </DT
><DT
>/etc/ssh/ssh_config file,
    <A
HREF="x10204.htm#AEN10359"
>The ssh client</A
>
  </DT
><DT
>/etc/ssh/ssh_host_key file,
    <A
HREF="x10204.htm#AEN10291"
>The ssh daemon</A
>
  </DT
><DT
>/etc/ssh/ssh_host_key.pub file,
    <A
HREF="x10204.htm#AEN10291"
>The ssh daemon</A
>
  </DT
><DT
>/etc/yp.conf file,
    <A
HREF="x10953.htm"
>Setting Up an NIS Client with GNU libc</A
>
  </DT
><DT
>/etc/ypserv.securenets file,
    <A
HREF="x10887.htm"
>NIS Server Security</A
>
  </DT
><DT
>eth0 (Ethernet interface),
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>
  </DT
><DT
>eth1 device,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>
  </DT
><DT
>Ethernet
  </DT
><DD
><DL
><DT
>addresses,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>,
    <A
HREF="x1625.htm"
>Address Resolution</A
>
  </DT
><DD
><DL
><DT
>versus IP address,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>
  </DT
></DL
></DD
><DT
>autoprobing,
    <A
HREF="x2465.htm#AEN2510"
>Ethernet Autoprobing</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Becker drivers,
    <A
HREF="x2465.htm"
>Ethernet Installation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>cards,
    <A
HREF="c2016.htm"
>Configuringthe NetworkingHardware</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>collisions,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configurating interface,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>drawbacks,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>installation,
    <A
HREF="x2465.htm"
>Ethernet Installation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>promiscuous mode,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>thick/thin,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>through parallel port,
    <A
HREF="x2465.htm"
>Ethernet Installation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>twisted pair,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>exchanging
  </DT
><DD
><DL
><DT
>email,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>news,
    <A
HREF="x16402.htm"
>What Is Usenet, Anyway?</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>exclamation point (in email address),
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.OBSOLETE"
>Obsolete Mail Formats</A
>
  </DT
><DT
>Exim,
    <A
HREF="c13847.htm"
>Electronic Mail</A
>
  </DT
><DD
><DL
><DT
>alias files,
    <A
HREF="x16108.htm#AEN16228"
>Alias Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>check mail queue,
    <A
HREF="x16011.htm"
>Mail Delivery Modes</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>compiling,
    <A
HREF="x15999.htm"
>Compiling Exim</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuration files,
    <A
HREF="c15849.htm"
>Getting EximUp and Running</A
>
  </DT
><DD
><DL
><DT
>options,
    <A
HREF="x16074.htm"
>Miscellaneous config Options</A
>
  </DT
></DL
></DD
><DT
>daemon mode,
    <A
HREF="c15849.htm"
>Getting EximUp and Running</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>delivering messages to local addresses,
    <A
HREF="x16108.htm#X-087-2-EXIM.DIRECTORS"
>Delivering Messages to Local Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>directing mail to a file,
    <A
HREF="x16108.htm#X-087-2-EXIM.DIRECTORS"
>Delivering Messages to Local Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>directors,
    <A
HREF="x16108.htm"
>Message Routing and Delivery</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>feeding mail to a command,
    <A
HREF="x16108.htm#X-087-2-EXIM.DIRECTORS"
>Delivering Messages to Local Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>filter files,
    <A
HREF="x16108.htm#AEN16195"
>Forwarding</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>forwarding mail,
    <A
HREF="x16108.htm#AEN16195"
>Forwarding</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>log files,
    <A
HREF="x15964.htm"
>If Your Mail Doesn't Get Through</A
>,
    <A
HREF="x16011.htm"
>Mail Delivery Modes</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>mail delivery modes,
    <A
HREF="x16011.htm"
>Mail Delivery Modes</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>mailing lists,
    <A
HREF="x16108.htm#X-087-2-EXIM.DIRECTOR.MAILING-LISTS"
>Mailing Lists</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>queuing mail,
    <A
HREF="x16011.htm"
>Mail Delivery Modes</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>routers,
    <A
HREF="x16108.htm"
>Message Routing and Delivery</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>routing messages in,
    <A
HREF="x16108.htm#X-087-2-EXIM.ROUTING"
>Routing Messages</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>running,
    <A
HREF="c15849.htm#AEN15909"
>Running Exim</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>symbolic links to,
    <A
HREF="c15849.htm"
>Getting EximUp and Running</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>transports,
    <A
HREF="x16108.htm"
>Message Routing and Delivery</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>troubleshooting,
    <A
HREF="x15964.htm"
>If Your Mail Doesn't Get Through</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>user mailboxes,
    <A
HREF="x16108.htm#AEN16173"
>Local users</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>utilities,
    <A
HREF="c15849.htm"
>Getting EximUp and Running</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP setup,
    <A
HREF="x16328.htm"
>UUCP Setup</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>expect program,
    <A
HREF="x6675.htm"
>Using chat to Automate Dialing</A
>
  </DT
><DT
>expire.ctl file (INN),
    <A
HREF="x18341.htm#AEN18807"
>The expire.ctl file</A
>
  </DT
><DT
>exports file,
    <A
HREF="x11486.htm"
>The exports File</A
>
  </DT
><DT
>External Data Representation (XDR),
    <A
HREF="x10157.htm"
>Remote Procedure Call</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN21158"
>F</A
></H2
><DL
><DT
>FDDI (Fiber Distributed Data Interface),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="x2714.htm"
>Other Network Types</A
>
  </DT
><DT
>FEATURE macro definition,
    <A
HREF="x14661.htm#AEN14801"
>FEATURE</A
>
  </DT
><DT
>FHS (File Hierarchy Standard),
    <A
HREF="x394.htm"
>File System Standards</A
>
  </DT
><DT
>Fiber Distributed Data Interface (FDDI),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="x2714.htm"
>Other Network Types</A
>
  </DT
><DT
>FidoNet,
    <A
HREF="c2740.htm#X-087-2-SERIAL.SOFTWARE"
>Communications Software for Modem Links</A
>
  </DT
><DT
>file sharing,
    <A
HREF="c11260.htm"
>The NetworkFile System</A
>,
    <A
HREF="c11660.htm"
>IPX and the NCP Filesystem</A
>
  </DT
><DT
>File System Standard,
    <A
HREF="x394.htm"
>File System Standards</A
>
  </DT
><DT
>filter files,
    <A
HREF="x16108.htm#AEN16195"
>Forwarding</A
>
  </DT
><DT
>filtering,
    <A
HREF="x575.htm"
>Acknowledgments</A
>
  </DT
><DD
><DL
><DT
>see also masquerade</DT
><DT
>IP,
    <A
HREF="x7578.htm"
>What Is IP Filtering?</A
>
  </DT
><DT
>stages of,
    <A
HREF="x7685.htm"
>Three Ways We Can Do Filtering</A
>
  </DT
></DL
></DD
><DT
>finger daemon,
    <A
HREF="c9830.htm#X-087-2-APPL.INETD"
>The inetd Super Server</A
>
  </DT
><DD
><DL
><DT
>wrapping via tcpd,
    <A
HREF="x9973.htm"
>The tcpd Access Control Facility</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>fingerprints,
    <A
HREF="x10204.htm#X-087-2-FEATURES.SSH.USING"
>Using ssh</A
>
  </DT
><DT
>firewalls,
    <A
HREF="x6009.htm"
>Dealing with Private IP Networks</A
>,
    <A
HREF="x7559.htm"
>What Is a Firewall?</A
>
  </DT
><DD
><DL
><DT
>IP chains,
    <A
HREF="x8114.htm"
>IP Firewall Chains (2.2 Kernels)</A
>
  </DT
><DD
><DL
><DT
>restoring/saving,
    <A
HREF="x8114.htm#AEN8492"
>The ipchains support scripts</A
>
  </DT
></DL
></DD
><DT
>methods of attack,
    <A
HREF="c7478.htm#X-082-2-FIREWALL.ATTACKS"
>Methods of Attack</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>netfilter,
    <A
HREF="x8543.htm"
>Netfilter and IP Tables (2.4 Kernels)</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>netmask specification,
    <A
HREF="x7720.htm#X-087-2-FIREWALL.SIMPLEEXAMPLE"
>A nave example</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>original IP,
    <A
HREF="x7720.htm"
>Original IP Firewall (2.0 Kernels)</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>sample configuration,
    <A
HREF="x9130.htm"
>A Sample Firewall Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>security,
    <A
HREF="c7478.htm"
>TCP/IP Firewall</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>TCP/IP,
    <A
HREF="c7478.htm"
>TCP/IP Firewall</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>testing a configuration,
    <A
HREF="x9076.htm"
>Testing a Firewall Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>TOS bit manipulation,
    <A
HREF="x8932.htm"
>TOS Bit Manipulation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>user-defined chains,
    <A
HREF="x8114.htm#AEN8418"
>User-defined chains</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>warning,
    <A
HREF="c7478.htm"
>TCP/IP Firewall</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>flooding algorithm,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>
  </DT
><DT
>.forward file,
    <A
HREF="x16108.htm#X-087-2-EXIM.DIRECTORS"
>Delivering Messages to Local Addresses</A
>
  </DT
><DT
>forwardfile director,
    <A
HREF="x16108.htm#X-087-2-EXIM.DIRECTOR.MAILING-LISTS"
>Mailing Lists</A
>
  </DT
><DT
>forwarding
  </DT
><DD
><DL
><DT
>IP,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>mail,
    <A
HREF="x16108.htm#AEN16195"
>Forwarding</A
>,
    <A
HREF="x16108.htm#AEN16228"
>Alias Files</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>FRAD (Frame Relay Access Device),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>
  </DT
><DT
>fragmentation, datagram,
    <A
HREF="x9190.htm#X-087-2-ACCOUNTING.BY.SERVICE"
>Accounting by Service Port</A
>
  </DT
><DT
>Frampton, Steve,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DT
>FSSTND (File System Standard),
    <A
HREF="x394.htm"
>File System Standards</A
>
  </DT
><DT
>FTP (File Transfer Protocol), location of Linux code,
    <A
HREF="x1312.htm#AEN1372"
>Where to Get the Code</A
>
  </DT
><DT
>full user names,
    <A
HREF="x16700.htm"
>Installation</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN21268"
>G</A
></H2
><DL
><DT
>gated command,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.TABLE"
>The Routing Table</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.PLIP"
>The PLIP Interface</A
>,
    <A
HREF="x6777.htm#AEN6843"
>Routing Through a PPP Link</A
>
  </DT
><DT
>gateways,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.GATEWAY"
>Gateways</A
>
  </DT
><DD
><DL
><DT
>configuring,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.GATEWAY-CONF"
>Configuring a Gateway</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>email,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.INTERNET"
>Mail Routing on the Internet</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>routing networks through,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.GATEWAY"
>Routing Through a Gateway</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>get command,
    <A
HREF="x6039.htm#AEN6184"
>The get command</A
>
  </DT
><DT
>gethostbyaddr(&#38;#8201;),
    <A
HREF="x1966.htm"
>Resolving Host Names</A
>,
    <A
HREF="c4495.htm#X-087-2-RESOLV.LIBRARY"
>The Resolver Library</A
>,
    <A
HREF="x11028.htm"
>Choosing the Right Maps</A
>
  </DT
><DT
>gethostbyname(&#38;#8201;),
    <A
HREF="x1966.htm"
>Resolving Host Names</A
>,
    <A
HREF="c4495.htm#X-087-2-RESOLV.LIBRARY"
>The Resolver Library</A
>,
    <A
HREF="x11028.htm"
>Choosing the Right Maps</A
>
  </DT
><DD
><DL
><DT
>uucico and,
    <A
HREF="c12477.htm#X-087-2-UUCICO.CONNECT"
>The Inner Workings of uucico</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>getpwnam(&#38;#8201;),
    <A
HREF="x10799.htm"
>The Client Side of NIS</A
>
  </DT
><DT
>getpwuid(&#38;#8201;),
    <A
HREF="x10799.htm"
>The Client Side of NIS</A
>
  </DT
><DT
>getservbyname(&#38;#8201;),
    <A
HREF="x11028.htm"
>Choosing the Right Maps</A
>
  </DT
><DT
>glue records,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.RECORDS"
>The DNS Database</A
>
  </DT
><DT
>GNU Free Documentation License (FDL),
    <A
HREF="a19564.htm"
>Linux Network Administrator's Guide, Second Edition Copyright Information</A
>
  </DT
><DT
>GNU libc (NIS support),
    <A
HREF="c10509.htm"
>The Network Information System</A
>,
    <A
HREF="x11226.htm"
>Using NIS with Shadow Support</A
>
  </DT
><DT
>Goldt, Sven,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DT
>gov domain,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DT
>GPG (GNU Privacy Guard),
    <A
HREF="x18341.htm#AEN18873"
>The control.ctl file</A
>
  </DT
><DT
>Groucho Marx University (GMU),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.INTRO"
>Introduction to TCP/IP Networks</A
>,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.SUBNETS"
>Subnetworks</A
>
  </DT
><DT
>group command (NNTP),
    <A
HREF="c17725.htm#AEN17932"
>Selecting a Group on Which to Operate</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN21335"
>H</A
></H2
><DL
><DT
>ham radio,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="x1625.htm"
>Address Resolution</A
>
  </DT
><DT
>handshake, hardware,
    <A
HREF="x2912.htm"
>Serial Hardware</A
>,
    <A
HREF="x2943.htm#X-087-2-SERIAL-STTY"
>The stty Command</A
>,
    <A
HREF="x6560.htm"
>Running pppd</A
>
  </DT
><DT
>Hankins, Greg,
    <A
HREF="c2740.htm"
>Configuring the Serial Hardware</A
>
  </DT
><DT
>hardware
  </DT
><DD
><DL
><DT
>configuration of networking,
    <A
HREF="c2016.htm"
>Configuringthe NetworkingHardware</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring serial,
    <A
HREF="c2740.htm"
>Configuring the Serial Hardware</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>handshake,
    <A
HREF="x2912.htm"
>Serial Hardware</A
>,
    <A
HREF="x2943.htm#X-087-2-SERIAL-STTY"
>The stty Command</A
>,
    <A
HREF="x6560.htm"
>Running pppd</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Harper, John D.,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DT
>Hazel, Philip,
    <A
HREF="x425.htm"
>About This Book</A
>,
    <A
HREF="c13847.htm"
>Electronic Mail</A
>
  </DT
><DT
>HDB
  </DT
><DD
><DL
><DT
>see Taylor UUCP, HDB</DT
></DL
></DD
><DT
>HDLC (High-Level Data Link Control) protocol,
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>
  </DT
><DT
>head command (NNTP),
    <A
HREF="c17725.htm#AEN17962"
>Retrieving an Article Header Only</A
>
  </DT
><DT
>help, online,
    <A
HREF="x16.htm#AEN274"
>Online Linux Support</A
>
  </DT
><DT
>Hesiod addresses,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.RECORDS"
>The DNS Database</A
>
  </DT
><DT
>HoneyDanBer
  </DT
><DD
><DL
><DT
>see Taylor UUCP, HDB</DT
></DL
></DD
><DT
>host keys,
    <A
HREF="x10204.htm#AEN10291"
>The ssh daemon</A
>
  </DT
><DT
>host.conf file,
    <A
HREF="c4495.htm#X-087-2-RESOLV.HOST-CONF"
>The host.conf File</A
>,
    <A
HREF="c10509.htm"
>The Network Information System</A
>
  </DT
><DT
>hostat command,
    <A
HREF="x15691.htm#AEN15815"
>hoststat</A
>
  </DT
><DT
>hostcvt program,
    <A
HREF="x5256.htm#AEN5795"
>Other Useful Tools</A
>
  </DT
><DT
>hostname
  </DT
><DD
><DL
><DT
>aliases,
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>ambiguous,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>canonical,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.RECORDS"
>The DNS Database</A
>,
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>domain name and,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>fully qualified,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>lookup,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.LOOKUPS"
>Name Lookups with DNS</A
>,
    <A
HREF="x5256.htm#X-087-2-RESOLV.NSLOOKUP"
>Verifying the Name Server Setup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>mapping to addresses,
    <A
HREF="x1966.htm"
>Resolving Host Names</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>obtaining from address,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.IN-ADDR"
>Reverse Lookups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>resolution,
    <A
HREF="x1966.htm"
>Resolving Host Names</A
>,
    <A
HREF="x3450.htm"
>Writing hosts and networks Files</A
>,
    <A
HREF="c4495.htm"
>Name Service and Resolver Configuration</A
>,
    <A
HREF="c10509.htm"
>The Network Information System</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>setting,
    <A
HREF="x3343.htm"
>Setting the Hostname</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP,
    <A
HREF="x12725.htm#X-087-2-UUCP.STARTING.SITENAME"
>Site Naming</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>hosts,
    <A
HREF="c765.htm#X-087-2-INTRO.HISTORY"
>History</A
>
  </DT
><DD
><DL
><DT
>standalone,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.DUMMY"
>The Dummy Interface</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ALIAS"
>IP Alias</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>virtual,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ALIAS"
>IP Alias</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>hosts file,
    <A
HREF="x3450.htm"
>Writing hosts and networks Files</A
>
  </DT
><DD
><DL
><DT
>converting to BIND master files,
    <A
HREF="x5256.htm#AEN5795"
>Other Useful Tools</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>hosts.byaddr file,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DT
>hosts.byname file,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DT
>HOWTOs,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DD
><DL
><DT
>AX25,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>electronic mail,
    <A
HREF="c13847.htm"
>Electronic Mail</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IPCHAINS,
    <A
HREF="x8114.htm"
>IP Firewall Chains (2.2 Kernels)</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IPTABLES,
    <A
HREF="x9803.htm"
>More About Network Address Translation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IPX,
    <A
HREF="x12457.htm"
>NetWare Server Emulation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Networking,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PACKET-FILTERING,
    <A
HREF="x8543.htm"
>Netfilter and IP Tables (2.4 Kernels)</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PPP,
    <A
HREF="c6438.htm#AEN6507"
>PPP on Linux</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Serial,
    <A
HREF="c2740.htm"
>Configuring the Serial Hardware</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP,
    <A
HREF="c12477.htm"
>ManagingTaylor UUCP</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>hybrid addresses,
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.MIXING"
>Mixing Different Mail Formats</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN21472"
>I</A
></H2
><DL
><DT
>IBM Token Ring networks,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>
  </DT
><DT
>ICMP (Internet Control Message Protocol)
  </DT
><DD
><DL
><DT
>datagram accounting,
    <A
HREF="x9190.htm#X-087-2-ACCOUNTING.OF.ICMP"
>Accounting of ICMP Datagrams</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>datagram types,
    <A
HREF="x7720.htm#X-087-2-FIREWALL.IPFWADM.ICMP-TYPES"
>ICMP datagram types</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Port Unreachable message,
    <A
HREF="x1929.htm"
>The Internet Control Message Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Redirect message,
    <A
HREF="x1929.htm"
>The Internet Control Message Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>IETF (Internet Engineering Task Force),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.PORTS"
>More on Ports</A
>
  </DT
><DT
>ifconfig command,
    <A
HREF="x3515.htm"
>Interface Configuration for IP</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>,
    <A
HREF="x5881.htm"
>SLIP Operation</A
>,
    <A
HREF="x9564.htm"
>Passive Collection of Accounting Data</A
>
  </DT
><DT
>ihave command (NNTP),
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>,
    <A
HREF="c17725.htm#AEN17825"
>Pushing a News Article onto a Server</A
>,
    <A
HREF="x18135.htm"
>nntpd Interaction with C News</A
>
  </DT
><DT
>ihave/sendme protocol (news),
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>
  </DT
><DT
>in-addr.arpa domain,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.IN-ADDR"
>Reverse Lookups</A
>
  </DT
><DT
>incoming.conf file (INN),
    <A
HREF="x18341.htm#AEN18703"
>The incoming.conf file</A
>
  </DT
><DT
>inetd super server,
    <A
HREF="c9830.htm#X-087-2-APPL.INETD"
>The inetd Super Server</A
>,
    <A
HREF="x10157.htm"
>Remote Procedure Call</A
>
  </DT
><DD
><DL
><DT
>running Exim under,
    <A
HREF="c15849.htm#AEN15909"
>Running Exim</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>inetd.conf file,
    <A
HREF="c9830.htm#X-087-2-APPL.INETD"
>The inetd Super Server</A
>
  </DT
><DT
>inews command,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>
  </DT
><DT
>information on Linux,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DT
>initializing networking,
    <A
HREF="c3268.htm"
>Configuring TCP/IP Networking</A
>
  </DT
><DT
>INN (Internet News),
    <A
HREF="c16357.htm#X-087-2-NEWS.HISTORY"
>Usenet History</A
>
  </DT
><DD
><DL
><DT
>configuration files,
    <A
HREF="x18341.htm"
>INN Configuration Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring
  </DT
><DD
><DL
><DT
>newsfeeds,
    <A
HREF="x18341.htm#AEN18490"
>Configuring Newsfeeds</A
>
  </DT
><DT
>newsgroups,
    <A
HREF="x18341.htm#AEN18401"
>Configuring Newsgroups</A
>
  </DT
></DL
></DD
><DT
>control messages, handling,
    <A
HREF="x18341.htm#AEN18867"
>Handling Control Messages</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>expiring news articles,
    <A
HREF="x18341.htm#AEN18793"
>Expiring News Articles</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>global parameters,
    <A
HREF="x18341.htm#AEN18352"
>Global Parameters</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>ihave protocol,
    <A
HREF="c18193.htm#AEN18201"
>Some INN Internals</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>installing,
    <A
HREF="x18301.htm"
>Installing INN</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>managing,
    <A
HREF="x19030.htm"
>Managing INN: The ctlinnd Command</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>newsreaders,
    <A
HREF="x18278.htm"
>Newsreaders and INN</A
>
  </DT
><DD
><DL
><DT
>controlling access,
    <A
HREF="x18341.htm#AEN18693"
>Controlling Newsreader Access</A
>
  </DT
></DL
></DD
><DT
>NNTP and,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>,
    <A
HREF="c18193.htm#AEN18201"
>Some INN Internals</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>rnews,
    <A
HREF="c18193.htm#AEN18201"
>Some INN Internals</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>running,
    <A
HREF="x19004.htm"
>Running INN</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>inn source package,
    <A
HREF="x19004.htm"
>Running INN</A
>
  </DT
><DT
>inn.conf file (INN),
    <A
HREF="x18341.htm#AEN18358"
>The inn.conf file</A
>
  </DT
><DT
>innd command (INN),
    <A
HREF="c18193.htm#AEN18201"
>Some INN Internals</A
>
  </DT
><DT
>innxmit command (INN),
    <A
HREF="c18193.htm#AEN18201"
>Some INN Internals</A
>,
    <A
HREF="x18341.htm#AEN18637"
>The nntpsend.ctl file</A
>
  </DT
><DT
>installing
  </DT
><DD
><DL
><DT
>INN (Internet News),
    <A
HREF="x18301.htm"
>Installing INN</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>network binaries,
    <A
HREF="x3327.htm"
>Installing the Binaries</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>sendmail,
    <A
HREF="x14607.htm"
>Installing sendmail</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>interfaces,
    <A
HREF="c1476.htm#X-087-2-ISSUES.INTERFACES"
>Networking Interfaces</A
>,
    <A
HREF="c2016.htm"
>Configuringthe NetworkingHardware</A
>,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>
  </DT
><DD
><DL
><DT
>alias,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ALIAS"
>IP Alias</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>AX.25,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuration of,
    <A
HREF="x3515.htm"
>Interface Configuration for IP</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring IPX,
    <A
HREF="x11819.htm"
>Configuring IPX Interfaces</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>dummy,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.DUMMY"
>The Dummy Interface</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Ethernet,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>loopback,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>netmask,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.SUBNETS"
>Subnetworks</A
>,
    <A
HREF="x3422.htm"
>Creating Subnets</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PLIP,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.PLIP"
>The PLIP Interface</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PPP,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.SLIP"
>The SLIP and PPP Interfaces</A
>,
    <A
HREF="x6560.htm"
>Running pppd</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>SLIP,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.SLIP"
>The SLIP and PPP Interfaces</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>statistics, displaying,
    <A
HREF="x4200.htm#X-087-2-IFACE.NETSTAT.-I"
>Displaying Interface Statistics</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Token Ring,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>internationalization for elm,
    <A
HREF="x14485.htm#X-087-2-MAIL.ELM.CHARSETS"
>National Character Sets</A
>
  </DT
><DT
>Internet,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.INTRO"
>Introduction to TCP/IP Networks</A
>
  </DT
><DD
><DL
><DT
>connecting to,
    <A
HREF="c5847.htm"
>Serial Line IP</A
>,
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>,
    <A
HREF="x6560.htm"
>Running pppd</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>daemon,
    <A
HREF="c9830.htm#X-087-2-APPL.INETD"
>The inetd Super Server</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>email routing,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.INTERNET"
>Mail Routing on the Internet</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>versus internetworking,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Internet Control Message Protocol
  </DT
><DD
><DL
><DT
>see ICMP</DT
></DL
></DD
><DT
>Internet Datagram Protocol (IDP),
    <A
HREF="c11660.htm#AEN11684"
>Xerox, Novell, and History</A
>
  </DT
><DT
>Internet News
  </DT
><DD
><DL
><DT
>see INN (Internet News)</DT
></DL
></DD
><DT
>Internet Protocol
  </DT
><DD
><DL
><DT
>see IP</DT
></DL
></DD
><DT
>Internet Protocol Control Protocol
  </DT
><DD
><DL
><DT
>see IPCP</DT
></DL
></DD
><DT
>internetworking,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.GATEWAY"
>Gateways</A
>
  </DT
><DT
>IP (Internet Protocol),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>
  </DT
><DD
><DL
><DT
>addresses,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>,
    <A
HREF="x1507.htm"
>IP Addresses</A
>
  </DT
><DD
><DL
><DT
>assigning,
    <A
HREF="x3385.htm"
>Assigning IP Addresses</A
>
  </DT
><DT
>hostname and,
    <A
HREF="x1966.htm"
>Resolving Host Names</A
>,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.IN-ADDR"
>Reverse Lookups</A
>
  </DT
><DT
>negotiation in PPP,
    <A
HREF="x6560.htm"
>Running pppd</A
>,
    <A
HREF="x6777.htm#AEN6784"
>Choosing IP Addresses</A
>,
    <A
HREF="x7080.htm#AEN7136"
>The CHAP Secrets File</A
>
  </DT
><DT
>private,
    <A
HREF="x3385.htm"
>Assigning IP Addresses</A
>
  </DT
><DT
>versus hostname,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>
  </DT
></DL
></DD
><DT
>alias configuration,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ALIAS"
>IP Alias</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>aliasing,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>broadcast address,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>default route,
    <A
HREF="x1507.htm"
>IP Addresses</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.GATEWAY"
>Routing Through a Gateway</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>dialup,
    <A
HREF="c5847.htm"
>Serial Line IP</A
>,
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>dynamic routing,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.TABLE"
>The Routing Table</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>filtering,
    <A
HREF="x7578.htm"
>What Is IP Filtering?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Firewall Chains,
    <A
HREF="x8114.htm"
>IP Firewall Chains (2.2 Kernels)</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>forwarding,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>gateways,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.GATEWAY"
>Routing Through a Gateway</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>interface,
    <A
HREF="c2016.htm"
>Configuringthe NetworkingHardware</A
>
  </DT
><DD
><DL
><DT
>configuration,
    <A
HREF="x3515.htm"
>Interface Configuration for IP</A
>
  </DT
></DL
></DD
><DT
>IPv4,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IPv6,
    <A
HREF="x1312.htm#AEN1352"
>Different Streaks of Development</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>masquerade,
    <A
HREF="c9580.htm"
>IP Masquerade and Network Address Translation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>metric,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DD
><DL
><DT
>values,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.METRIC"
>Metric Values</A
>
  </DT
></DL
></DD
><DT
>MTU,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>multicast addresses,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>netmask,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.SUBNETS"
>Subnetworks</A
>,
    <A
HREF="x3422.htm"
>Creating Subnets</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Network Control Protocol (PPP),
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>networks,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.NETWORKS"
>IP Networks</A
>,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.IN-ADDR"
>Reverse Lookups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>parallel line
  </DT
><DD
><DL
><DT
>see PLIP (Parallel Line IP) protocol</DT
></DL
></DD
><DT
>private addresses,
    <A
HREF="x1507.htm"
>IP Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>routing,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>,
    <A
HREF="x1657.htm"
>IP Routing</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.GATEWAY"
>Routing Through a Gateway</A
>
  </DT
><DD
><DL
><DT
>effect of netmask,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.TABLE"
>The Routing Table</A
>
  </DT
><DT
>protocols,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.TABLE"
>The Routing Table</A
>
  </DT
><DT
>Redirect message (ICMP),
    <A
HREF="x1929.htm"
>The Internet Control Message Protocol</A
>
  </DT
><DT
>table,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.TABLE"
>The Routing Table</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>,
    <A
HREF="x4200.htm#X-087-2-IFACE.NETSTAT.-R"
>Displaying the Routing Table</A
>
  </DT
></DL
></DD
><DT
>serial line,
    <A
HREF="c5847.htm"
>Serial Line IP</A
>,
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>  
  </DT
><DD
><DL
><DT
>see SLIP (Serial Line IP) protocol</DT
></DL
></DD
><DT
>source routing,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>subnets,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.SUBNETS"
>Subnetworks</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.GATEWAY"
>Routing Through a Gateway</A
>,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.IN-ADDR"
>Reverse Lookups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>TOS (Type Of Service) bits,
    <A
HREF="x8932.htm"
>TOS Bit Manipulation</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>IP accounting,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DD
><DL
><DT
>by address,
    <A
HREF="x9190.htm#X-087-2-ACCOUNTING.BY.ADDRESS"
>Accounting by Address</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring,
    <A
HREF="x9190.htm"
>Configuring IP Accounting</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>flushing the rules,
    <A
HREF="x9543.htm"
>Flushing the Ruleset</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>of ICMP datagrams,
    <A
HREF="x9190.htm#X-087-2-ACCOUNTING.OF.ICMP"
>Accounting of ICMP Datagrams</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>kernel configuration,
    <A
HREF="c9157.htm#X-087-2-ACCOUNTING.KERNEL.CONFIG"
>Configuring the Kernel for IP Accounting</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>passive collection,
    <A
HREF="x9564.htm"
>Passive Collection of Accounting Data</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>by protocol,
    <A
HREF="x9190.htm#X-087-2-ACCOUNTING.BY.PROTOCOL"
>Accounting by Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>resetting the counters,
    <A
HREF="x9521.htm"
>Resetting the Counters</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>by service port,
    <A
HREF="x9190.htm#X-087-2-ACCOUNTING.BY.SERVICE"
>Accounting by Service Port</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>using results of,
    <A
HREF="x9439.htm"
>Using IP Accounting Results</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>ipchains command,
    <A
HREF="x7613.htm#X-087-2-FIREWALL.HOWTO.IPCHAINS"
>The ipchains Utility</A
>,
    <A
HREF="x8114.htm#X-087-2-FIREWALL.USINGIPCHAINS"
>Using ipchains</A
>
  </DT
><DD
><DL
><DT
>configuring IP accounting,
    <A
HREF="x9190.htm"
>Configuring IP Accounting</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring IP masquerade,
    <A
HREF="x9680.htm"
>Configuring IP Masquerade</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>firewall options,
    <A
HREF="x8114.htm#X-087-2-FIREWALL.IPCHAINS.SYNTAX"
>ipchains Command Syntax</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>listing accounting data with,
    <A
HREF="x9439.htm#AEN9489"
>Listing Accounting Data with ipchains</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>listing rules with,
    <A
HREF="x8114.htm#X-087-2-FIREWALL.LISTING.AGAIN"
>Listing Our Rules with ipchains</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>setting the TOS bits,
    <A
HREF="x8932.htm#AEN8961"
>Setting the TOS Bits Using ipfwadm or ipchains</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>support scripts,
    <A
HREF="x8114.htm#AEN8492"
>The ipchains support scripts</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>IPCHAINS-HOWTO,
    <A
HREF="x8114.htm"
>IP Firewall Chains (2.2 Kernels)</A
>
  </DT
><DT
>ipchains-restore command,
    <A
HREF="x8114.htm#AEN8492"
>The ipchains support scripts</A
>
  </DT
><DT
>ipchains-save command,
    <A
HREF="x8114.htm#AEN8492"
>The ipchains support scripts</A
>
  </DT
><DT
>IPCP (Internet Protocol Control Protocol),
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>,
    <A
HREF="x6777.htm"
>IP Configuration Options</A
>
  </DT
><DT
>ipfwadm command,
    <A
HREF="x7613.htm#X-087-2-FIREWALL.HOWTO.IPFWADM"
>The ipfwadm Utility</A
>,
    <A
HREF="x7720.htm"
>Original IP Firewall (2.0 Kernels)</A
>
  </DT
><DD
><DL
><DT
>configuring IP accounting,
    <A
HREF="x9190.htm"
>Configuring IP Accounting</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring IP masquerade,
    <A
HREF="x9680.htm"
>Configuring IP Masquerade</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>firewall options,
    <A
HREF="x7720.htm#X-087-2-FIREWALL.IPFWADMARGS"
>Summary of ipfwadm Arguments</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>listing accounting data with,
    <A
HREF="x9439.htm#AEN9449"
>Listing Accounting Data with ipfwadm</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>listing rules with,
    <A
HREF="x7720.htm#X-087-2-FIREWALL.LISTING"
>Listing our rules</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>setting the TOS bits,
    <A
HREF="x8932.htm#AEN8961"
>Setting the TOS Bits Using ipfwadm or ipchains</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>ipfwadm-wrapper command,
    <A
HREF="x7613.htm#X-087-2-FIREWALL.HOWTO.IPCHAINS"
>The ipchains Utility</A
>,
    <A
HREF="x8114.htm#X-087-2-FIREWALL.USINGIPCHAINS"
>Using ipchains</A
>,
    <A
HREF="x8114.htm#AEN8492"
>The ipchains support scripts</A
>
  </DT
><DT
>iptables command,
    <A
HREF="x7613.htm#X-087-2-FIREWALL.HOWTO.IPTABLES"
>The iptables Utility</A
>
  </DT
><DD
><DL
><DT
>configuring IP accounting,
    <A
HREF="x9190.htm"
>Configuring IP Accounting</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring IP masquerade,
    <A
HREF="x9680.htm"
>Configuring IP Masquerade</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>extensions,
    <A
HREF="x8543.htm#X-087-2-FIREWALL.IPTABLES.EXTENSIONS"
>Extensions</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>firewall options,
    <A
HREF="x8543.htm#X-087-2-FIREWALL.USINGIPTABLES"
>Using iptables</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>listing accounting data with,
    <A
HREF="x9439.htm#AEN9506"
>Listing Accounting Data with iptables</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>setting the TOS bits,
    <A
HREF="x8932.htm#AEN9022"
>Setting the TOS Bits Using iptables</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>IPTABLES-HOWTO,
    <A
HREF="x9803.htm"
>More About Network Address Translation</A
>
  </DT
><DT
>IPv4 (Internet Protocol),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>
  </DT
><DT
>IPv6 (Internet Protocol),
    <A
HREF="x1312.htm#AEN1352"
>Different Streaks of Development</A
>
  </DT
><DT
>IPX (Internet Packet eXchange),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>,
    <A
HREF="c11660.htm"
>IPX and the NCP Filesystem</A
>
  </DT
><DD
><DL
><DT
>interface configuration tools,
    <A
HREF="x11819.htm#X-087-2-IPX.TOOLS"
>IPX Interface Configuration Tools</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>internal networks,
    <A
HREF="x11912.htm#AEN11985"
>Internal IPX Networks and Routing</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>kernel configuration,
    <A
HREF="x11803.htm"
>Configuring the Kernel for IPXand NCPFS</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PPP network protocol,
    <A
HREF="c2016.htm#AEN2131"
>Kernel Options in Linux 2.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>routing,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>,
    <A
HREF="x11912.htm"
>Configuring an IPX Router</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>tools
  </DT
><DD
><DL
><DT
>nsend,
    <A
HREF="x12201.htm#AEN12218"
>Send Messages to NetWare Users</A
>
  </DT
><DT
>pqlist,
    <A
HREF="x12306.htm#AEN12426"
>Managing Print Queues</A
>
  </DT
><DT
>slist,
    <A
HREF="x12201.htm#AEN12205"
>Server List</A
>
  </DT
></DL
></DD
></DL
></DD
><DT
>IPX-HOWTO,
    <A
HREF="x12457.htm"
>NetWare Server Emulation</A
>
  </DT
><DT
>ipxd command,
    <A
HREF="x11912.htm"
>Configuring an IPX Router</A
>
  </DT
><DT
>ipx_configure command,
    <A
HREF="x11819.htm#X-087-2-IPX.IPX-CONFIGURE"
>The ipx_configure Command</A
>
  </DT
><DT
>ipx_interface command,
    <A
HREF="x11819.htm#X-087-2-IPX.IPX-INTERFACE"
>The ipx_interface Command</A
>
  </DT
><DT
>ipx_route command,
    <A
HREF="x11912.htm#AEN11957"
>Static IPX Routing Using the ipx_route Command</A
>
  </DT
><DT
>IRC Network, OpenProjects,
    <A
HREF="x16.htm#AEN274"
>Online Linux Support</A
>
  </DT
><DT
>IRQ (Interrupt Request),
    <A
HREF="c2016.htm"
>Configuringthe NetworkingHardware</A
>,
    <A
HREF="x2465.htm#AEN2510"
>Ethernet Autoprobing</A
>
  </DT
><DD
><DL
><DT
>setting,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>irtt parameter,
    <A
HREF="x4200.htm#X-087-2-IFACE.NETSTAT.-R"
>Displaying the Routing Table</A
>
  </DT
><DT
>ISO-8859-1,
    <A
HREF="x14485.htm#X-087-2-MAIL.ELM.CHARSETS"
>National Character Sets</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN21913"
>J</A
></H2
><DL
><DT
>jobs (UUCP),
    <A
HREF="c12477.htm#X-087-2-UUCP.INTRO.GRADES"
>UUCP Transfers and Remote Execution</A
>
  </DT
><DT
>junk newsgroup,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN21921"
>K</A
></H2
><DL
><DT
>Kempen, Fred van,
    <A
HREF="x1312.htm"
>Linux Networking</A
>
  </DT
><DT
>kermit (terminal program),
    <A
HREF="c2740.htm#X-087-2-SERIAL.SOFTWARE"
>Communications Software for Modem Links</A
>
  </DT
><DT
>kernel version numbering,
    <A
HREF="c2016.htm#X-087-2-HARDWARE.KERNEL.CONFIG"
>Kernel Configuration</A
>
  </DT
><DT
>kernels
  </DT
><DD
><DL
><DT
>configuration,
    <A
HREF="c2016.htm#X-087-2-HARDWARE.KERNEL.CONFIG"
>Kernel Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configured with IP firewall,
    <A
HREF="x7613.htm"
>Setting Up Linux for Firewalling</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring for IPX and NCPFS,
    <A
HREF="x11803.htm"
>Configuring the Kernel for IPXand NCPFS</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring for masquerade,
    <A
HREF="x9617.htm"
>Configuring the Kernel for IP Masquerade</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NFSv2/NFSv3 server support,
    <A
HREF="x11618.htm"
>Kernel-Based NFSv2 Server Support</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>key fingerprints,
    <A
HREF="x10204.htm#X-087-2-FEATURES.SSH.USING"
>Using ssh</A
>
  </DT
><DT
>keys
  </DT
><DD
><DL
><DT
>host,
    <A
HREF="x10204.htm#AEN10291"
>The ssh daemon</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>private,
    <A
HREF="x10204.htm#AEN10291"
>The ssh daemon</A
>,
    <A
HREF="x10204.htm#AEN10359"
>The ssh client</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>public,
    <A
HREF="x10204.htm#AEN10291"
>The ssh daemon</A
>,
    <A
HREF="x10204.htm#AEN10359"
>The ssh client</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Kirch, Olaf,
    <A
HREF="c11260.htm"
>The NetworkFile System</A
>,
    <A
HREF="x11618.htm"
>Kernel-Based NFSv2 Server Support</A
>
  </DT
><DT
>Kukuk, Thorsten,
    <A
HREF="c10509.htm"
>The Network Information System</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN21964"
>L</A
></H2
><DL
><DT
>LANs
  </DT
><DD
><DL
><DT
>see Local Area Networks</DT
></DL
></DD
><DT
>Lapsley, Phil,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>
  </DT
><DT
>Latin-1 character set,
    <A
HREF="x14485.htm#X-087-2-MAIL.ELM.CHARSETS"
>National Character Sets</A
>
  </DT
><DT
>LCP (Link Control Protocol),
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>
  </DT
><DD
><DL
><DT
>echo messages,
    <A
HREF="x6968.htm"
>Link Control Options</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>options,
    <A
HREF="x6968.htm"
>Link Control Options</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>LDP (Linux Documentation Project),
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DT
>leaf sites,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DT
>leafnode (NNTP cache program),
    <A
HREF="c17725.htm#AEN17994"
>Reading an Article from a Group</A
>
  </DT
><DT
>Learning Debian GNU/Linux,
    <A
HREF="x16.htm#AEN133"
>Documentation Available Commercially</A
>
  </DT
><DT
>Learning Red Hat Linux,
    <A
HREF="x16.htm#AEN133"
>Documentation Available Commercially</A
>
  </DT
><DT
>Lendecke, Volker,
    <A
HREF="x11757.htm"
>IPX and Linux</A
>
  </DT
><DT
>libc6 (NIS support),
    <A
HREF="c10509.htm"
>The Network Information System</A
>,
    <A
HREF="x11226.htm"
>Using NIS with Shadow Support</A
>
  </DT
><DT
>Libes, Don,
    <A
HREF="x6675.htm"
>Using chat to Automate Dialing</A
>
  </DT
><DT
>lilo command,
    <A
HREF="x2465.htm#AEN2510"
>Ethernet Autoprobing</A
>
  </DT
><DT
>line discipline,
    <A
HREF="x2804.htm"
>Introduction to Serial Devices</A
>,
    <A
HREF="x5881.htm"
>SLIP Operation</A
>,
    <A
HREF="c6438.htm#AEN6507"
>PPP on Linux</A
>
  </DT
><DT
>Link Control Protocol
  </DT
><DD
><DL
><DT
>see LCP</DT
></DL
></DD
><DT
>Linux
  </DT
><DD
><DL
><DT
>documentation,
    <A
HREF="x16.htm#AEN107"
>Documentation Available via FTP</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>HOWTOs,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>networks,
    <A
HREF="x1312.htm"
>Linux Networking</A
>
  </DT
><DD
><DL
><DT
>obtaining code for,
    <A
HREF="x16.htm#AEN317"
>Obtaining Linux</A
>,
    <A
HREF="x1312.htm#AEN1372"
>Where to Get the Code</A
>
  </DT
></DL
></DD
><DT
>sources of information on,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Linux distributions,
    <A
HREF="x16.htm#AEN317"
>Obtaining Linux</A
>
  </DT
><DD
><DL
><DT
>standard base,
    <A
HREF="x410.htm"
>Standard Linux Base</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Linux Documentation Project,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DT
>Linux in a Nutshell,
    <A
HREF="x16.htm#AEN133"
>Documentation Available Commercially</A
>
  </DT
><DT
>Linux Journal,
    <A
HREF="x16.htm#AEN175"
>Linux Journal and Linux Magazine</A
>
  </DT
><DT
>Linux kernel
  </DT
><DD
><DL
><DT
>version numbering of,
    <A
HREF="c2016.htm#X-087-2-HARDWARE.KERNEL.CONFIG"
>Kernel Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Linux Magazine,
    <A
HREF="x16.htm#AEN175"
>Linux Journal and Linux Magazine</A
>
  </DT
><DT
>Linux Standard Base (LSB),
    <A
HREF="x410.htm"
>Standard Linux Base</A
>
  </DT
><DT
>Linux User Groups (LUG),
    <A
HREF="x16.htm#AEN292"
>Linux User Groups</A
>
  </DT
><DT
>linux-kernel mailing list,
    <A
HREF="x16.htm#AEN243"
>Linux Mailing Lists</A
>
  </DT
><DT
>linux-net mailing list,
    <A
HREF="x16.htm#AEN243"
>Linux Mailing Lists</A
>
  </DT
><DT
>linux-ppp mailing list,
    <A
HREF="x16.htm#AEN243"
>Linux Mailing Lists</A
>
  </DT
><DT
>list active command (NNTP),
    <A
HREF="c17725.htm#AEN17880"
>Listing Active Groups</A
>
  </DT
><DT
>list command (NNTP),
    <A
HREF="c17725.htm#AEN17863"
>Listing Available Groups</A
>
  </DT
><DT
>listen(&#38;#8201;),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>
  </DT
><DT
>listgroup command (NNTP),
    <A
HREF="c17725.htm#AEN17948"
>Listing Articles in a Group</A
>
  </DT
><DT
>lo (loopback interface),
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>
  </DT
><DT
>local addresses,
    <A
HREF="x16108.htm#X-087-2-EXIM.DIRECTORS"
>Delivering Messages to Local Addresses</A
>
  </DT
><DT
>Local Area Networks (LANs),
    <A
HREF="x792.htm"
>TCP/IP Networks</A
>
  </DT
><DD
><DL
><DT
>connecting,
    <A
HREF="x6777.htm#AEN6843"
>Routing Through a PPP Link</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>hardware for,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>news,
    <A
HREF="x17623.htm"
>C News in an NFS Environment</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>passwords,
    <A
HREF="x11134.htm"
>Using the passwd and group Maps</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>remote login,
    <A
HREF="x10204.htm"
>Configuring Remote Loginand Execution</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>local macro definitions,
    <A
HREF="x14661.htm#AEN14819"
>Local macro definitions</A
>
  </DT
><DT
>localgroups file (/etc/news),
    <A
HREF="x17423.htm"
>Miscellaneous Files</A
>
  </DT
><DT
>localhost (dummy hostname),
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>
  </DT
><DT
>local_domains configuration variable,
    <A
HREF="x16108.htm#X-087-2-EXIM.ROUTING"
>Routing Messages</A
>
  </DT
><DT
>LOCAL_NET_CONFIG macro definition,
    <A
HREF="x14661.htm#AEN14889"
>Configure mail routing for local hosts</A
>,
    <A
HREF="x14923.htm#AEN15122"
>Ruleset Semantics</A
>
  </DT
><DT
>LOCAL_RULE_0 sendmail ruleset,
    <A
HREF="x14923.htm#AEN15122"
>Ruleset Semantics</A
>
  </DT
><DT
>LOCAL_RULE_1 sendmail ruleset,
    <A
HREF="x14923.htm#AEN15122"
>Ruleset Semantics</A
>
  </DT
><DT
>LOCAL_RULE_2 sendmail ruleset,
    <A
HREF="x14923.htm#AEN15122"
>Ruleset Semantics</A
>
  </DT
><DT
>LOCAL_RULE_3 sendmail ruleset,
    <A
HREF="x14923.htm#AEN15122"
>Ruleset Semantics</A
>
  </DT
><DT
>lock files and PPP,
    <A
HREF="x6638.htm"
>Using Options Files</A
>
  </DT
><DT
>Log file (UUCP),
    <A
HREF="x13819.htm"
>Log Files and Debugging</A
>
  </DT
><DT
>log files, debugging,
    <A
HREF="x13819.htm"
>Log Files and Debugging</A
>
  </DT
><DT
>login command and NIS maps,
    <A
HREF="x11134.htm"
>Using the passwd and group Maps</A
>
  </DT
><DT
>looking up addresses,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.IN-ADDR"
>Reverse Lookups</A
>
  </DT
><DT
>loopback
  </DT
><DD
><DL
><DT
>address,
    <A
HREF="x1507.htm"
>IP Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>interface device,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>
  </DT
><DD
><DL
><DT
>configuring,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>
  </DT
></DL
></DD
></DL
></DD
><DT
>lpd (line printer daemon),
    <A
HREF="x12306.htm#AEN12375"
>Using nprint with the Line Printer Daemon</A
>
  </DT
><DT
>LSB (Linux Standard Base),
    <A
HREF="x410.htm"
>Standard Linux Base</A
>
  </DT
><DT
>Lu, H.J.,
    <A
HREF="x11618.htm"
>Kernel-Based NFSv2 Server Support</A
>
  </DT
><DT
>LUG (Linux User Groups),
    <A
HREF="x16.htm#AEN292"
>Linux User Groups</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN22161"
>M</A
></H2
><DL
><DT
>m4 macro processor,
    <A
HREF="x14661.htm"
>The sendmail.cf and sendmail.mc Files</A
>
  </DT
><DD
><DL
><DT
>configuring sendmail options,
    <A
HREF="x15220.htm"
>Configuring sendmail Options</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>macro definitions, sendmail.mc file,
    <A
HREF="x14661.htm#AEN14713"
>Typically Used sendmail.mc Parameters</A
>
  </DT
><DT
>mail
  </DT
><DD
><DL
><DT
>see email</DT
></DL
></DD
><DT
>Mail Abuse Protection System (MAPS),
    <A
HREF="x16298.htm"
>Protecting Against Mail Spam</A
>
  </DT
><DT
>Mail Exchanger (DNS record),
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.INTERNET"
>Mail Routing on the Internet</A
>
  </DT
><DT
>mail spool, managing,
    <A
HREF="x15691.htm#AEN15699"
>Managing the Mail Spool</A
>
  </DT
><DT
>mail transport agent (MTA),
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DT
>mail user agent (MUA),
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DT
>mailbox files,
    <A
HREF="x16108.htm#AEN16173"
>Local users</A
>
  </DT
><DT
>MAILER macro definition,
    <A
HREF="x14661.htm#AEN14829"
>Defining mail transport protocols</A
>
  </DT
><DT
>mailing lists,
    <A
HREF="x16.htm#AEN243"
>Linux Mailing Lists</A
>
  </DT
><DD
><DL
><DT
>in Exim,
    <A
HREF="x16108.htm#X-087-2-EXIM.DIRECTOR.MAILING-LISTS"
>Mailing Lists</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>mailpaths file (/etc/news),
    <A
HREF="x17423.htm"
>Miscellaneous Files</A
>
  </DT
><DT
>mailstats command,
    <A
HREF="x15691.htm#AEN15751"
>mailstats</A
>
  </DT
><DT
>maintenance, system,
    <A
HREF="x1392.htm"
>Maintaining Your System</A
>
  </DT
><DT
>makedbm program,
    <A
HREF="x10820.htm"
>Running an NIS Server</A
>
  </DT
><DT
>manual configuration
  </DT
><DD
><DL
><DT
>Ethernet,
    <A
HREF="x2465.htm#AEN2510"
>Ethernet Autoprobing</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PLIP,
    <A
HREF="x2592.htm"
>The PLIP Driver</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>maps, Usenet,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DT
>Marx, Groucho,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.INTRO"
>Introduction to TCP/IP Networks</A
>
  </DT
><DT
>masquerade
  </DT
><DD
><DL
><DT
>configuration,
    <A
HREF="x9680.htm"
>Configuring IP Masquerade</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>how it works,
    <A
HREF="c9580.htm"
>IP Masquerade and Network Address Translation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>kernel configuration,
    <A
HREF="x9617.htm"
>Configuring the Kernel for IP Masquerade</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>listing rules,
    <A
HREF="x9680.htm"
>Configuring IP Masquerade</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>name server lookups,
    <A
HREF="x9793.htm"
>Handling Name Server Lookups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>setting timing parameters for,
    <A
HREF="x9680.htm#X-087-2-MASQ.SETTING.TIMING"
>Setting Timing Parameters for IP Masquerade</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>side effects of,
    <A
HREF="c9580.htm#X-087-2-MASQ.SIDE.EFFECTS"
>Side Effects and Fringe Benefits</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>master servers,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>,
    <A
HREF="x10820.htm"
>Running an NIS Server</A
>
  </DT
><DT
>Maximum Receive Unit (MRU),
    <A
HREF="x6968.htm"
>Link Control Options</A
>
  </DT
><DT
>Maximum Transfer Unit (MTU),
    <A
HREF="c1476.htm#X-087-2-ISSUES.INTERFACES"
>Networking Interfaces</A
>,
    <A
HREF="x6968.htm"
>Link Control Options</A
>
  </DT
><DT
>Maximum Transmission Unit (MTU),
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DD
><DL
><DT
>IP,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Meer, Sven van der,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DT
>messages, email,
    <A
HREF="c13847.htm#X-087-2-MAIL.MESSAGE-FORMAT"
>What Is a Mail Message?</A
>
  </DT
><DT
>metric values (for routing table entries),
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.METRIC"
>Metric Values</A
>
  </DT
><DT
>mgetty program,
    <A
HREF="x13480.htm#X-087-2-UUCP.DIALIN.ACCOUNTS"
>Providing UUCP Accounts</A
>
  </DT
><DT
>Middelink, Pauline,
    <A
HREF="x7720.htm"
>Original IP Firewall (2.0 Kernels)</A
>
  </DT
><DT
>mil domain,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DT
>MIME (Multipurpose Internet Mail Extensions),
    <A
HREF="c13847.htm#X-087-2-MAIL.MESSAGE-FORMAT"
>What Is a Mail Message?</A
>
  </DT
><DD
><DL
><DT
>format,
    <A
HREF="x14485.htm#X-087-2-MAIL.ELM.CHARSETS"
>National Character Sets</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>minicom (terminal program),
    <A
HREF="c2740.htm#X-087-2-SERIAL.SOFTWARE"
>Communications Software for Modem Links</A
>
  </DT
><DT
>modems
  </DT
><DD
><DL
><DT
>demand dialing,
    <A
HREF="x7297.htm#AEN7379"
>Demand Dialing</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>links
  </DT
><DD
><DL
><DT
>communication software for,
    <A
HREF="c2740.htm#X-087-2-SERIAL.SOFTWARE"
>Communications Software for Modem Links</A
>
  </DT
><DT
>configuring via dip,
    <A
HREF="x6039.htm#AEN6144"
>The modem commands</A
>
  </DT
></DL
></DD
><DT
>persistent dialing,
    <A
HREF="x7297.htm#AEN7441"
>Persistent Dialing</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Morris, G. Allan,
    <A
HREF="x11618.htm"
>Kernel-Based NFSv2 Server Support</A
>
  </DT
><DT
>mount command,
    <A
HREF="c11260.htm"
>The NetworkFile System</A
>
  </DT
><DT
>mountd daemon,
    <A
HREF="x11486.htm"
>The exports File</A
>
  </DT
><DT
>mounting
  </DT
><DD
><DL
><DT
>an NFS volume,
    <A
HREF="x11349.htm"
>Mounting an NFS Volume</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>the proc filesystem,
    <A
HREF="c3268.htm#X-087-2-IFACE.PROCFS"
>Mounting the /proc Filesystem</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>MRU (Maximum Receive Unit),
    <A
HREF="x6968.htm"
>Link Control Options</A
>
  </DT
><DT
>mthreads program,
    <A
HREF="x19359.htm"
>trn Configuration</A
>
  </DT
><DT
>multimedia mail,
    <A
HREF="c13847.htm"
>Electronic Mail</A
>
  </DT
><DT
>MX (DNS record),
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.INTERNET"
>Mail Routing on the Internet</A
>
  </DT
><DT
>Myklebust, Trond,
    <A
HREF="x11618.htm"
>Kernel-Based NFSv2 Server Support</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN22325"
>N</A
></H2
><DL
><DT
>name lookups
  </DT
><DD
><DL
><DT
>via DNS,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.LOOKUPS"
>Name Lookups with DNS</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>name servers,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.LOOKUPS"
>Name Lookups with DNS</A
>
  </DT
><DD
><DL
><DT
>authoritative,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.AUTH"
>Types of Name Servers</A
>,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.RECORDS"
>The DNS Database</A
>,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.IN-ADDR"
>Reverse Lookups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>cache,
    <A
HREF="x5256.htm#AEN5298"
>The named.boot File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>caching-only,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.AUTH"
>Types of Name Servers</A
>,
    <A
HREF="x5256.htm#X-087-2-RESOLV.NAMED-CACHINGONLY"
>Caching-only named Configuration</A
>,
    <A
HREF="x6560.htm"
>Running pppd</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>checking,
    <A
HREF="x5256.htm#X-087-2-RESOLV.NSLOOKUP"
>Verifying the Name Server Setup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring,
    <A
HREF="x5256.htm"
>Running named</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>for IP masquerade,
    <A
HREF="x9793.htm"
>Handling Name Server Lookups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>lookups,
    <A
HREF="c4495.htm#X-087-2-RESOLV.RESOLV"
>Configuring Name Server Lookups Using resolv.conf</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>primary,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.AUTH"
>Types of Name Servers</A
>,
    <A
HREF="x5256.htm#AEN5298"
>The named.boot File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>root,
    <A
HREF="x5256.htm#AEN5685"
>Writing the Master Files</A
>,
    <A
HREF="x5256.htm#X-087-2-RESOLV.NSLOOKUP"
>Verifying the Name Server Setup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>secondary,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.AUTH"
>Types of Name Servers</A
>,
    <A
HREF="x5256.htm#AEN5298"
>The named.boot File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>slave,
    <A
HREF="x5256.htm#AEN5298"
>The named.boot File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>synchronizing,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.AUTH"
>Types of Name Servers</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>name service configuration,
    <A
HREF="c4495.htm"
>Name Service and Resolver Configuration</A
>
  </DT
><DT
>named.boot file,
    <A
HREF="x5256.htm#AEN5298"
>The named.boot File</A
>
  </DT
><DT
>named.conf file,
    <A
HREF="x5256.htm#AEN5408"
>The BIND 8 host.conf File</A
>
  </DT
><DT
>named program,
    <A
HREF="c4495.htm"
>Name Service and Resolver Configuration</A
>,
    <A
HREF="x5256.htm"
>Running named</A
>
  </DT
><DT
>named-bootconf.pl command,
    <A
HREF="x5256.htm#AEN5408"
>The BIND 8 host.conf File</A
>
  </DT
><DT
>namespace (DNS),
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DT
>NAT (Network Address Translation),
    <A
HREF="c9580.htm"
>IP Masquerade and Network Address Translation</A
>,
    <A
HREF="x9803.htm"
>More About Network Address Translation</A
>
  </DT
><DT
>national character sets in elm,
    <A
HREF="x14485.htm#X-087-2-MAIL.ELM.CHARSETS"
>National Character Sets</A
>
  </DT
><DT
>NCP (Network Control Protocol),
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>
  </DT
><DT
>NCPFS (NetWare Core Protocol Filesystem),
    <A
HREF="c11660.htm"
>IPX and the NCP Filesystem</A
>
  </DT
><DD
><DL
><DT
>kernel configuration,
    <A
HREF="x11803.htm"
>Configuring the Kernel for IPXand NCPFS</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>mounting volume on,
    <A
HREF="x12021.htm"
>Mounting a Remote NetWare Volume</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>~/.nwclient file,
    <A
HREF="x12021.htm#AEN12176"
>A More Complex ncpmount Example</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>server emulation,
    <A
HREF="x12457.htm"
>NetWare Server Emulation</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>ncpmount command
  </DT
><DD
><DL
><DT
>command-line arguments,
    <A
HREF="x12021.htm#AEN12056"
>The ncpmount Command in Detail</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>complex example,
    <A
HREF="x12021.htm#AEN12176"
>A More Complex ncpmount Example</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>simple example,
    <A
HREF="x12021.htm#AEN12036"
>A Simple ncpmount Example</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>NCSA telnet,
    <A
HREF="x2592.htm"
>The PLIP Driver</A
>
  </DT
><DT
>net domain,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DT
>Net-1 network version,
    <A
HREF="x1312.htm"
>Linux Networking</A
>
  </DT
><DT
>Net-2d network version,
    <A
HREF="x1312.htm"
>Linux Networking</A
>
  </DT
><DT
>Net-2Debugged network version,
    <A
HREF="x1312.htm"
>Linux Networking</A
>
  </DT
><DT
>Net-2e network version,
    <A
HREF="x1312.htm#AEN1352"
>Different Streaks of Development</A
>
  </DT
><DT
>Net-3 network version,
    <A
HREF="x1312.htm"
>Linux Networking</A
>,
    <A
HREF="x1312.htm#AEN1372"
>Where to Get the Code</A
>
  </DT
><DT
>Net-4 network version,
    <A
HREF="x1312.htm"
>Linux Networking</A
>
  </DT
><DT
>netfilter
  </DT
><DD
><DL
><DT
>IP tables and,
    <A
HREF="x8543.htm"
>Netfilter and IP Tables (2.4 Kernels)</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>kernel modules,
    <A
HREF="x8543.htm#AEN8603"
>Backward Compatability with ipfwadmand ipchains</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Netnews
  </DT
><DD
><DL
><DT
>see news (network); Usenet</DT
></DL
></DD
><DT
>NetRom protocol,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DT
>netstat command,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>,
    <A
HREF="x4200.htm"
>The netstat Command</A
>
  </DT
><DD
><DL
><DT
>displaying connections,
    <A
HREF="x4200.htm#X-087-2-IFACE.NETSTAT.-T-U-X"
>Displaying Connections</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>NetWare,
    <A
HREF="c11660.htm"
>IPX and the NCP Filesystem</A
>
  </DT
><DD
><DL
><DT
>print queue, printing to,
    <A
HREF="x12306.htm"
>Printing to a NetWare Print Queue</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>NetWare Core Protocol (NCP),
    <A
HREF="c11660.htm#AEN11684"
>Xerox, Novell, and History</A
>
  </DT
><DT
>NetWare Directory Service (NDS),
    <A
HREF="x11757.htm#AEN11796"
>More on NDS Support</A
>
  </DT
><DT
>Network File System
  </DT
><DD
><DL
><DT
>see NFS</DT
></DL
></DD
><DT
>Network Information System
  </DT
><DD
><DL
><DT
>see NIS</DT
></DL
></DD
><DT
>network news
  </DT
><DD
><DL
><DT
>see news (network)</DT
></DL
></DD
><DT
>Network News Transfer Protocol
  </DT
><DD
><DL
><DT
>see NNTP</DT
></DL
></DD
><DT
>Network Unreachable error message,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>
  </DT
><DT
>Networking HOWTO,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DT
>networks,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>
  </DT
><DD
><DL
><DT
>ARPANET,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.INTRO"
>Introduction to TCP/IP Networks</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>booting,
    <A
HREF="c3268.htm"
>Configuring TCP/IP Networking</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>connections
  </DT
><DD
><DL
><DT
>see networks, ports</DT
></DL
></DD
><DT
>corporate,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.INTRO"
>Introduction to TCP/IP Networks</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>devices,
    <A
HREF="c2016.htm"
>Configuringthe NetworkingHardware</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>display connections,
    <A
HREF="x4200.htm#X-087-2-IFACE.NETSTAT.-T-U-X"
>Displaying Connections</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Ethernet,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>,
    <A
HREF="x2465.htm"
>Ethernet Installation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>hardware, configuring,
    <A
HREF="c2016.htm"
>Configuringthe NetworkingHardware</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>initialization scripts,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>interconnecting,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
> 
  </DT
><DD
><DL
><DT
>see internetworking</DT
></DL
></DD
><DT
>interfaces
  </DT
><DD
><DL
><DT
>see interfaces</DT
></DL
></DD
><DT
>Internet,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.INTRO"
>Introduction to TCP/IP Networks</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>introduction to,
    <A
HREF="c765.htm#X-087-2-INTRO.HISTORY"
>History</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP address,
    <A
HREF="x3385.htm"
>Assigning IP Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>kernel options,
    <A
HREF="c2016.htm#AEN2131"
>Kernel Options in Linux 2.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Linux,
    <A
HREF="x1312.htm"
>Linux Networking</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Local Area,
    <A
HREF="x792.htm"
>TCP/IP Networks</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>names of,
    <A
HREF="x3450.htm"
>Writing hosts and networks Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>packet-switched,
    <A
HREF="x792.htm"
>TCP/IP Networks</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>passwords,
    <A
HREF="x11134.htm"
>Using the passwd and group Maps</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>ports,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.TCP"
>The Transmission Control Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>private,
    <A
HREF="x6009.htm"
>Dealing with Private IP Networks</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>programming interfaces,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>protocols,
    <A
HREF="c765.htm#X-087-2-INTRO.HISTORY"
>History</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>services
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.PORTS"
>More on Ports</A
>
  </DT
><DD
><DL
><DT
>see ports</DT
></DL
></DD
><DT
>synchronizing passwords,
    <A
HREF="c10509.htm"
>The Network Information System</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>TCP/IP
    <A
HREF="x792.htm"
>TCP/IP Networks</A
>,
    <A
HREF="c1476.htm"
>Issues of TCP/IP Networking</A
>
  </DT
><DD
><DL
><DT
>see TCP/IP</DT
></DL
></DD
><DT
>thinnet,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Token Ring,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>unreachable,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP
    <A
HREF="x1298.htm"
>UUCP Networks</A
>
  </DT
><DD
><DL
><DT
>see UUCP</DT
></DL
></DD
></DL
></DD
><DT
>networks file,
    <A
HREF="x3450.htm"
>Writing hosts and networks Files</A
>
  </DT
><DT
>Neuling, Michael,
    <A
HREF="x8114.htm"
>IP Firewall Chains (2.2 Kernels)</A
>
  </DT
><DT
>newgroup control message,
    <A
HREF="x17521.htm#X-087-2-CNEWS.CONTROL.ADDGROUP"
>newgroup and rmgroup</A
>
  </DT
><DT
>newnews command (NNTP),
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>,
    <A
HREF="c17725.htm#AEN17912"
>Listing New Articles</A
>
  </DT
><DT
>news (network),
    <A
HREF="c16357.htm#X-087-2-NEWS.HISTORY"
>Usenet History</A
>
  </DT
><DD
><DL
><DT
>active file,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>adding new groups,
    <A
HREF="x17521.htm#X-087-2-CNEWS.CONTROL.ADDGROUP"
>newgroup and rmgroup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>archiving articles,
    <A
HREF="x17317.htm"
>Expiring News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>articles,
    <A
HREF="x16402.htm"
>What Is Usenet, Anyway?</A
>
  </DT
><DD
><DL
><DT
>batching,
    <A
HREF="x17145.htm"
>Article Batching</A
>
  </DT
><DT
>expiring,
    <A
HREF="x18341.htm#AEN18793"
>Expiring News Articles</A
>
  </DT
><DT
>listing,
    <A
HREF="c17725.htm#AEN17912"
>Listing New Articles</A
>
  </DT
><DT
>posting,
    <A
HREF="c17725.htm#AEN17892"
>Posting an Article</A
>
  </DT
><DT
>pushing news,
    <A
HREF="c17725.htm#AEN17825"
>Pushing a News Article onto a Server</A
>
  </DT
><DT
>retrieving headers/message body,
    <A
HREF="c17725.htm#AEN17962"
>Retrieving an Article Header Only</A
>
  </DT
></DL
></DD
><DT
>batching,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>C release
  </DT
><DD
><DL
><DT
>see C News</DT
></DL
></DD
><DT
>cancel article,
    <A
HREF="x17521.htm#X-087-2-CNEWS.CONTROL.CANCEL"
>The cancel Message</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>control messages,
    <A
HREF="x17521.htm"
>Control Messages</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>deleting old news,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>distribution,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>,
    <A
HREF="x16837.htm"
>The sys File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>exchanging,
    <A
HREF="x16402.htm"
>What Is Usenet, Anyway?</A
>,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>expiration of,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>,
    <A
HREF="x17317.htm"
>Expiring News</A
>,
    <A
HREF="x19359.htm"
>trn Configuration</A
>,
    <A
HREF="x19426.htm"
>nn Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>faking,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>feeding,
    <A
HREF="x16402.htm"
>What Is Usenet, Anyway?</A
>,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>flooding algorithm,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>follow-up,
    <A
HREF="c19276.htm"
>Newsreader Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>groups,
    <A
HREF="x16402.htm"
>What Is Usenet, Anyway?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>history,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>ihave/sendme,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Internet News,
    <A
HREF="c16357.htm#X-087-2-NEWS.HISTORY"
>Usenet History</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>limiting a feed,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>message IDs,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>newsmaster,
    <A
HREF="x16700.htm"
>Installation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NNTP,
    <A
HREF="c16357.htm#X-087-2-NEWS.HISTORY"
>Usenet History</A
>,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>pulling,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>pushing,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>receiving,
    <A
HREF="x16837.htm"
>The sys File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>removing old groups,
    <A
HREF="x17521.htm#X-087-2-CNEWS.CONTROL.ADDGROUP"
>newgroup and rmgroup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>spool,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>updating active files,
    <A
HREF="x17521.htm#X-087-2-CNEWS.CONTROL.CHECKGROUPS"
>The checkgroups Message</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Usenet,
    <A
HREF="x16402.htm"
>What Is Usenet, Anyway?</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>news (Usenet)
  </DT
><DD
><DL
><DT
>see news (network); Usenet</DT
></DL
></DD
><DT
>news faking,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>
  </DT
><DT
>news feeds,
    <A
HREF="x16468.htm"
>How Does Usenet Handle News?</A
>
  </DT
><DT
>news, C
  </DT
><DD
><DL
><DT
>see C News</DT
></DL
></DD
><DT
>newsfeeds file (INN),
    <A
HREF="c18193.htm#AEN18201"
>Some INN Internals</A
>,
    <A
HREF="x18341.htm#AEN18502"
>The newsfeeds file</A
>
  </DT
><DT
>newsfeeds, configuring,
    <A
HREF="x18341.htm#AEN18490"
>Configuring Newsfeeds</A
>
  </DT
><DT
>newsgroups,
    <A
HREF="x16402.htm"
>What Is Usenet, Anyway?</A
>
  </DT
><DD
><DL
><DT
>comp.mail.uucp,
    <A
HREF="c12477.htm"
>ManagingTaylor UUCP</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>comp.protocols.ppp,
    <A
HREF="c6438.htm#AEN6507"
>PPP on Linux</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>comp.protocols.tcp-ip.domains,
    <A
HREF="c4495.htm"
>Name Service and Resolver Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring,
    <A
HREF="x18341.htm#AEN18401"
>Configuring Newsgroups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>creating,
    <A
HREF="x17521.htm#X-087-2-CNEWS.CONTROL.ADDGROUP"
>newgroup and rmgroup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>deleting,
    <A
HREF="x17521.htm#X-087-2-CNEWS.CONTROL.ADDGROUP"
>newgroup and rmgroup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>file (/etc/news),
    <A
HREF="x17423.htm"
>Miscellaneous Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>listing,
    <A
HREF="c17725.htm#AEN17863"
>Listing Available Groups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>listing articles,
    <A
HREF="c17725.htm#AEN17948"
>Listing Articles in a Group</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>selecting,
    <A
HREF="c17725.htm#AEN17932"
>Selecting a Group on Which to Operate</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Usenet,
    <A
HREF="x16.htm#AEN190"
>Linux Usenet Newsgroups</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>newsgroups file (INN),
    <A
HREF="x18341.htm#AEN18414"
>The active and newsgroups files</A
>
  </DT
><DT
>newsmaster,
    <A
HREF="x16700.htm"
>Installation</A
>
  </DT
><DT
>newsreaders
  </DT
><DD
><DL
><DT
>changing to NNRP reader mode,
    <A
HREF="c17725.htm#AEN17849"
>Changing to NNRP Reader Mode</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring,
    <A
HREF="c19276.htm"
>Newsreader Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>controlling access,
    <A
HREF="x18341.htm#AEN18693"
>Controlling Newsreader Access</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>creating thread databases,
    <A
HREF="x19359.htm"
>trn Configuration</A
>,
    <A
HREF="x19426.htm"
>nn Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>INN (Internet News) and,
    <A
HREF="x18278.htm"
>Newsreaders and INN</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>nn,
    <A
HREF="x19426.htm"
>nn Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>tass,
    <A
HREF="c19276.htm#X-087-2-NEWSREADERS.TIN"
>tin Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>threading,
    <A
HREF="c19276.htm"
>Newsreader Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>tin,
    <A
HREF="c19276.htm#X-087-2-NEWSREADERS.TIN"
>tin Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>trn,
    <A
HREF="x19359.htm"
>trn Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>newsrun command,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>
  </DT
><DT
>NFS (Network File System),
    <A
HREF="c11260.htm"
>The NetworkFile System</A
>
  </DT
><DD
><DL
><DT
>C News in,
    <A
HREF="x17623.htm"
>C News in an NFS Environment</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>daemons,
    <A
HREF="x11455.htm"
>The NFS Daemons</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>exporting a volume,
    <A
HREF="x11486.htm"
>The exports File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>exports file,
    <A
HREF="x11486.htm"
>The exports File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>hard-mounting versus soft-mounting,
    <A
HREF="x11349.htm"
>Mounting an NFS Volume</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>kernel-based server support,
    <A
HREF="x11618.htm"
>Kernel-Based NFSv2 Server Support</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>matching uids and gids,
    <A
HREF="x11455.htm"
>The NFS Daemons</A
>,
    <A
HREF="x11486.htm"
>The exports File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>mounting volume on,
    <A
HREF="c11260.htm"
>The NetworkFile System</A
>,
    <A
HREF="x11349.htm"
>Mounting an NFS Volume</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>restricting block size,
    <A
HREF="x11349.htm"
>Mounting an NFS Volume</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>timeout,
    <A
HREF="x11349.htm"
>Mounting an NFS Volume</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>via TCP/IP,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.INTRO"
>Introduction to TCP/IP Networks</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>nfsd daemon,
    <A
HREF="c11260.htm"
>The NetworkFile System</A
>
  </DT
><DT
>NFSv2/NFSv3 server support,
    <A
HREF="x11618.htm"
>Kernel-Based NFSv2 Server Support</A
>
  </DT
><DT
>NIS (Network Information System),
    <A
HREF="x1966.htm"
>Resolving Host Names</A
>,
    <A
HREF="c10509.htm"
>The Network Information System</A
>
  </DT
><DD
><DL
><DT
>clients,
    <A
HREF="x10799.htm"
>The Client Side of NIS</A
>,
    <A
HREF="x10953.htm"
>Setting Up an NIS Client with GNU libc</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>creating maps,
    <A
HREF="x10820.htm"
>Running an NIS Server</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>databases,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>domains,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>,
    <A
HREF="x10953.htm"
>Setting Up an NIS Client with GNU libc</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>GNU libc,
    <A
HREF="c10509.htm"
>The Network Information System</A
>,
    <A
HREF="x10953.htm"
>Setting Up an NIS Client with GNU libc</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>locating servers,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>maps,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>nicknames,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>passwd maps,
    <A
HREF="x11134.htm"
>Using the passwd and group Maps</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>resolver and,
    <A
HREF="c4495.htm#X-087-2-RESOLV.HOST-CONF"
>The host.conf File</A
>,
    <A
HREF="c4495.htm#X-087-2-RESOLV.NSSWITCH-CONF"
>The nsswitch.conf File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>securenets option,
    <A
HREF="x10887.htm"
>NIS Server Security</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>security,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>,
    <A
HREF="x10887.htm"
>NIS Server Security</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>servers,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>shadow passwords and,
    <A
HREF="x11226.htm"
>Using NIS with Shadow Support</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>NIS+,
    <A
HREF="x10791.htm"
>NIS Versus NIS+</A
>
  </DT
><DT
>nn newsreader, configuration,
    <A
HREF="x19426.htm"
>nn Configuration</A
>
  </DT
><DT
>nnrp.access file (INN),
    <A
HREF="x18341.htm#AEN18749"
>The nnrp.access file</A
>
  </DT
><DT
>nnrpd command (INN),
    <A
HREF="x18278.htm"
>Newsreaders and INN</A
>,
    <A
HREF="x18341.htm#AEN18749"
>The nnrp.access file</A
>
  </DT
><DT
>NNTP (Network News Transfer Protocol),
    <A
HREF="c16357.htm#X-087-2-NEWS.HISTORY"
>Usenet History</A
>,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>
  </DT
><DD
><DL
><DT
>article command,
    <A
HREF="c17725.htm#AEN17994"
>Reading an Article from a Group</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>authorization,
    <A
HREF="x18107.htm"
>NNTP Authorization</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>body command,
    <A
HREF="c17725.htm#AEN17982"
>Retrieving an Article Body Only</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>C News and,
    <A
HREF="x18135.htm"
>nntpd Interaction with C News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>changing to NNRP reader mode,
    <A
HREF="c17725.htm#AEN17849"
>Changing to NNRP Reader Mode</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>connecting to a news server,
    <A
HREF="c17725.htm#AEN17812"
>Connecting to the News Server</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>group command,
    <A
HREF="c17725.htm#AEN17932"
>Selecting a Group on Which to Operate</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>head command,
    <A
HREF="c17725.htm#AEN17962"
>Retrieving an Article Header Only</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>ihave command,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>,
    <A
HREF="c17725.htm#AEN17825"
>Pushing a News Article onto a Server</A
>,
    <A
HREF="x18135.htm"
>nntpd Interaction with C News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>INN (Internet News) and,
    <A
HREF="c18193.htm#AEN18201"
>Some INN Internals</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>leafnode,
    <A
HREF="c17725.htm#AEN17994"
>Reading an Article from a Group</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>list active command,
    <A
HREF="c17725.htm#AEN17880"
>Listing Active Groups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>list command,
    <A
HREF="c17725.htm#AEN17863"
>Listing Available Groups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>listgroup command,
    <A
HREF="c17725.htm#AEN17948"
>Listing Articles in a Group</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>listing groups,
    <A
HREF="c17725.htm#AEN17863"
>Listing Available Groups</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>newnews command,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>,
    <A
HREF="c17725.htm#AEN17912"
>Listing New Articles</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>post command,
    <A
HREF="c17725.htm#AEN17892"
>Posting an Article</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>restricting access in,
    <A
HREF="x18051.htm"
>Restricting NNTP Access</A
>,
    <A
HREF="x18107.htm"
>NNTP Authorization</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>nntpd,
    <A
HREF="c16357.htm#X-087-2-NEWS.HISTORY"
>Usenet History</A
>
  </DT
><DD
><DL
><DT
>components,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>installing the server,
    <A
HREF="x18024.htm"
>Installing the NNTP Server</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>nntpsend.ctl file (INN),
    <A
HREF="x18341.htm#AEN18637"
>The nntpsend.ctl file</A
>
  </DT
><DT
>NNTPSERVER environment variables,
    <A
HREF="c19276.htm#X-087-2-NEWSREADERS.TIN"
>tin Configuration</A
>
  </DT
><DT
>nntp_access file,
    <A
HREF="x18051.htm"
>Restricting NNTP Access</A
>
  </DT
><DT
>Noorda, Ray,
    <A
HREF="x11757.htm#AEN11787"
>Caldera Support</A
>
  </DT
><DT
>Novell Corporation,
    <A
HREF="c11660.htm"
>IPX and the NCP Filesystem</A
>
  </DT
><DT
>nprint command,
    <A
HREF="x12306.htm"
>Printing to a NetWare Print Queue</A
>
  </DT
><DD
><DL
><DT
>using lpd (line printer daemon),
    <A
HREF="x12306.htm#AEN12375"
>Using nprint with the Line Printer Daemon</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>nsend command,
    <A
HREF="x12201.htm#AEN12218"
>Send Messages to NetWare Users</A
>
  </DT
><DT
>nslint program,
    <A
HREF="x5256.htm#AEN5795"
>Other Useful Tools</A
>
  </DT
><DT
>nslookup program,
    <A
HREF="x5256.htm#X-087-2-RESOLV.NSLOOKUP"
>Verifying the Name Server Setup</A
>
  </DT
><DT
>nsswitch.conf file,
    <A
HREF="c4495.htm#X-087-2-RESOLV.NSSWITCH-CONF"
>The nsswitch.conf File</A
>
  </DT
><DD
><DL
><DT
>action statements,
    <A
HREF="c4495.htm#X-087-2-RESOLV.NSSWITCH-CONF"
>The nsswitch.conf File</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>NYS,
    <A
HREF="c10509.htm"
>The Network Information System</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN22908"
>O</A
></H2
><DL
><DT
>octets,
    <A
HREF="x1507.htm"
>IP Addresses</A
>
  </DT
><DT
>Oja, Joanna,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DT
>online help,
    <A
HREF="x16.htm#AEN274"
>Online Linux Support</A
>
  </DT
><DT
>Open Source Writers Guild,
    <A
HREF="x16.htm#AEN119"
>Documentation Available via WWW</A
>
  </DT
><DT
>OpenProjects IRC network,
    <A
HREF="x16.htm#AEN274"
>Online Linux Support</A
>
  </DT
><DT
>org domain,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DT
>OSPF (Open Shortest Path First) protocol,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DT
>OSTYPE macro definition,
    <A
HREF="x14661.htm#AEN14766"
>VERSIONID and OSTYPE</A
>
  </DT
><DT
>OSWG (Open Source Writers Guild),
    <A
HREF="x16.htm#AEN119"
>Documentation Available via WWW</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN22937"
>P</A
></H2
><DL
><DT
>packet radio,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>
  </DT
><DT
>PACKET-FILTERING-HOWTO,
    <A
HREF="x8543.htm"
>Netfilter and IP Tables (2.4 Kernels)</A
>
  </DT
><DT
>packet-switched networks,
    <A
HREF="x792.htm"
>TCP/IP Networks</A
>
  </DT
><DT
>PAD (Packet Assembler Disassembler),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>
  </DT
><DT
>Page, Greg,
    <A
HREF="x11757.htm"
>IPX and Linux</A
>
  </DT
><DT
>PAP (Password Authentication Protocol),
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>,
    <A
HREF="x7080.htm"
>Authentication with PPP</A
>
  </DT
><DT
>Parallel Line IP
  </DT
><DD
><DL
><DT
>see PLIP (Parallel Line IP) protocol</DT
></DL
></DD
><DT
>parallel port
  </DT
><DD
><DL
><DT
>Ethernet,
    <A
HREF="x2465.htm"
>Ethernet Installation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP,
    <A
HREF="x2592.htm"
>The PLIP Driver</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Password Authentication Protocol
  </DT
><DD
><DL
><DT
>see PAP</DT
></DL
></DD
><DT
>passwords
  </DT
><DD
><DL
><DT
>hiding NetWare,
    <A
HREF="x12021.htm#AEN12146"
>Hiding Your NetWare Login Password</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>network-wide,
    <A
HREF="x11134.htm"
>Using the passwd and group Maps</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>remote login and,
    <A
HREF="x10204.htm"
>Configuring Remote Loginand Execution</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>pathalias command,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DT
>pathalias database,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DT
>paths file,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DT
>PC/TCP compatibility,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DT
>percent sign (in email address),
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.MIXING"
>Mixing Different Mail Formats</A
>
  </DT
><DT
>persistent dialing,
    <A
HREF="x7297.htm#AEN7441"
>Persistent Dialing</A
>
  </DT
><DT
>PGP (Pretty Good Privacy),
    <A
HREF="x18341.htm#AEN18873"
>The control.ctl file</A
>
  </DT
><DT
>ping command,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>
  </DT
><DT
>ping flooding,
    <A
HREF="x9190.htm#X-087-2-ACCOUNTING.OF.ICMP"
>Accounting of ICMP Datagrams</A
>
  </DT
><DT
>PLIP (Parallel Line IP) protocol
  </DT
><DD
><DL
><DT
>driver,
    <A
HREF="x2592.htm"
>The PLIP Driver</A
>,
    <A
HREF="x2695.htm"
>The PPP and SLIP Drivers</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>interface,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.PLIP"
>The PLIP Interface</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>null printer cable for,
    <A
HREF="a19530.htm#X-087-2-CABLE.PLIP"
>A PLIP Parallel Cable</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>routing,
    <A
HREF="x4395.htm"
>Checking the ARP Tables</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>plip1 device,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>
  </DT
><DT
>plipconfig command,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.PLIP"
>The PLIP Interface</A
>
  </DT
><DT
>point-to-point link,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.PLIP"
>The PLIP Interface</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.SLIP"
>The SLIP and PPP Interfaces</A
>,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>,
    <A
HREF="x4395.htm"
>Checking the ARP Tables</A
>,
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>
  </DT
><DT
>Point-to-Point Protocol
  </DT
><DD
><DL
><DT
>see PPP</DT
></DL
></DD
><DT
>Pomerantz, Ori,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DT
>portmap daemon,
    <A
HREF="x10157.htm"
>Remote Procedure Call</A
>
  </DT
><DT
>portmapper daemon,
    <A
HREF="x10157.htm"
>Remote Procedure Call</A
>
  </DT
><DT
>ports,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.TCP"
>The Transmission Control Protocol</A
>
  </DT
><DD
><DL
><DT
>COM,
    <A
HREF="x2821.htm#X-087-2-SERIAL.DEVICEFILES"
>The Serial Device Special Files</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>post command (NNTP),
    <A
HREF="c17725.htm#AEN17892"
>Posting an Article</A
>
  </DT
><DT
>PPP (Point-to-Point Protocol),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SLIP"
>IP Over Serial Lines</A
>,
    <A
HREF="c2740.htm#X-087-2-SERIAL.SOFTWARE"
>Communications Software for Modem Links</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.SLIP"
>The SLIP and PPP Interfaces</A
>,
    <A
HREF="c5847.htm#X-087-2-SLIP.GENERAL"
>General Requirements</A
>,
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>
  </DT
><DD
><DL
><DT
>advanced configurations,
    <A
HREF="x7297.htm"
>More Advanced PPP Configurations</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>async map,
    <A
HREF="x6968.htm"
>Link Control Options</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>authentication,
    <A
HREF="x7080.htm"
>Authentication with PPP</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>carrying IPX,
    <A
HREF="c2016.htm#AEN2131"
>Kernel Options in Linux 2.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>chat script,
    <A
HREF="x6675.htm"
>Using chat to Automate Dialing</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>compressing data,
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>,
    <A
HREF="x6968.htm"
>Link Control Options</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring demand dialing for,
    <A
HREF="x7297.htm#AEN7379"
>Demand Dialing</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring persistent dialing for,
    <A
HREF="x7297.htm#AEN7441"
>Persistent Dialing</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring server in,
    <A
HREF="x7297.htm#AEN7303"
>PPP Server</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>daemon,
    <A
HREF="c6438.htm#AEN6507"
>PPP on Linux</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>debugging setup of,
    <A
HREF="x7261.htm"
>Debugging Your PPP Setup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>default route,
    <A
HREF="x6560.htm"
>Running pppd</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>driver,
    <A
HREF="c6438.htm#AEN6507"
>PPP on Linux</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>dynamic address assignment,
    <A
HREF="x6777.htm#AEN6784"
>Choosing IP Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>escaping control characters,
    <A
HREF="x6968.htm"
>Link Control Options</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP addresses,
    <A
HREF="x6560.htm"
>Running pppd</A
>,
    <A
HREF="x6777.htm#AEN6784"
>Choosing IP Addresses</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>lock files,
    <A
HREF="x6638.htm"
>Using Options Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Maximum Receive Unit,
    <A
HREF="x6968.htm"
>Link Control Options</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>null modem cable for,
    <A
HREF="x19544.htm"
>A Serial NULL Modem Cable</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>option files,
    <A
HREF="x6638.htm"
>Using Options Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>proxy ARP,
    <A
HREF="x6777.htm#AEN6843"
>Routing Through a PPP Link</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>routing,
    <A
HREF="x4395.htm"
>Checking the ARP Tables</A
>,
    <A
HREF="x6777.htm#AEN6843"
>Routing Through a PPP Link</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>secrets files,
    <A
HREF="x7080.htm#AEN7136"
>The CHAP Secrets File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>security,
    <A
HREF="x7037.htm"
>General Security Considerations</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>using CHAP,
    <A
HREF="x7080.htm"
>Authentication with PPP</A
>,
    <A
HREF="x7080.htm#AEN7136"
>The CHAP Secrets File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>using PAP,
    <A
HREF="x7080.htm"
>Authentication with PPP</A
>,
    <A
HREF="x7080.htm#AEN7224"
>The PAP Secrets File</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>PPP-HOWTO,
    <A
HREF="c6438.htm#AEN6507"
>PPP on Linux</A
>
  </DT
><DT
>ppp0 (PPP interface),
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.SLIP"
>The SLIP and PPP Interfaces</A
>
  </DT
><DT
>ppp1 device,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>
  </DT
><DT
>pppd (kernel PPP module),
    <A
HREF="c6438.htm#AEN6507"
>PPP on Linux</A
>,
    <A
HREF="x6560.htm"
>Running pppd</A
>,
    <A
HREF="x7037.htm"
>General Security Considerations</A
>
  </DT
><DT
>.ppprc file,
    <A
HREF="x6638.htm"
>Using Options Files</A
>
  </DT
><DT
>pqlist command,
    <A
HREF="x12306.htm#AEN12426"
>Managing Print Queues</A
>
  </DT
><DT
>pqstat command,
    <A
HREF="x12306.htm#AEN12426"
>Managing Print Queues</A
>
  </DT
><DT
>primary option (BIND),
    <A
HREF="x5256.htm#AEN5298"
>The named.boot File</A
>
  </DT
><DT
>print command,
    <A
HREF="x6039.htm#AEN6199"
>The print command</A
>
  </DT
><DT
>print queues, NetWare,
    <A
HREF="x12306.htm"
>Printing to a NetWare Print Queue</A
>
  </DT
><DT
>private IP addresses,
    <A
HREF="x3385.htm"
>Assigning IP Addresses</A
>
  </DT
><DT
>private keys,
    <A
HREF="x10204.htm#AEN10291"
>The ssh daemon</A
>,
    <A
HREF="x10204.htm#AEN10359"
>The ssh client</A
>
  </DT
><DT
>proc filesystem, mounting,
    <A
HREF="c3268.htm#X-087-2-IFACE.PROCFS"
>Mounting the /proc Filesystem</A
>
  </DT
><DT
>/proc/filesystems file,
    <A
HREF="c11260.htm#X-087-2-NFS.NFSD"
>Preparing NFS</A
>
  </DT
><DT
>/proc/kmsg file,
    <A
HREF="x7261.htm"
>Debugging Your PPP Setup</A
>
  </DT
><DT
>/proc/net file,
    <A
HREF="c3268.htm#X-087-2-IFACE.PROCFS"
>Mounting the /proc Filesystem</A
>
  </DT
><DT
>/proc/net/ipx_route file,
    <A
HREF="x11912.htm#AEN11957"
>Static IPX Routing Using the ipx_route Command</A
>
  </DT
><DT
>protocol numbers,
    <A
HREF="x10107.htm"
>The Services and Protocols Files</A
>
  </DT
><DT
>protocols,
    <A
HREF="c765.htm#X-087-2-INTRO.HISTORY"
>History</A
>
  </DT
><DD
><DL
><DT
>ATM (Asynchronous Transfer Mode),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>AX.25,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>CSLIP,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SLIP"
>IP Over Serial Lines</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Ethernet,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Frame Relay,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>ICMP,
    <A
HREF="x1929.htm"
>The Internet Control Message Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Internet (IP),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.IP"
>The Internet Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Internet Datagram Protocol (IDP),
    <A
HREF="c11660.htm#AEN11684"
>Xerox, Novell, and History</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Internet Packet eXchange (IPX),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>,
    <A
HREF="c11660.htm"
>IPX and the NCP Filesystem</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>mapping XNS, Novell, and TCP/IP,
    <A
HREF="c11660.htm#AEN11684"
>Xerox, Novell, and History</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NetRom,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NetWare Core Protocol (NCP),
    <A
HREF="c11660.htm#AEN11684"
>Xerox, Novell, and History</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NNTP,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>OSPF,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PLIP,
    <A
HREF="x2592.htm"
>The PLIP Driver</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PPP,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SLIP"
>IP Over Serial Lines</A
>,
    <A
HREF="c2740.htm#X-087-2-SERIAL.SOFTWARE"
>Communications Software for Modem Links</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Rose,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Routing Information Protocol (RIP),
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>,
    <A
HREF="x11912.htm"
>Configuring an IPX Router</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Sequenced Packet eXchange (SPX),
    <A
HREF="c11660.htm#AEN11684"
>Xerox, Novell, and History</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Sequenced Packet Protocol (SPP),
    <A
HREF="c11660.htm#AEN11684"
>Xerox, Novell, and History</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Service Advertisement Protocol (SAP),
    <A
HREF="c11660.htm#AEN11684"
>Xerox, Novell, and History</A
>,
    <A
HREF="x11912.htm"
>Configuring an IPX Router</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>SLIP,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SLIP"
>IP Over Serial Lines</A
>,
    <A
HREF="c2740.htm#X-087-2-SERIAL.SOFTWARE"
>Communications Software for Modem Links</A
>,
    <A
HREF="x5881.htm"
>SLIP Operation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>SMTP,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>TCP,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.TCP"
>The Transmission Control Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>token-passing,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UDP,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.UDP"
>The User Datagram Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP,
    <A
HREF="x13645.htm#AEN13653"
>Protocol Overview</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>X.25,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>XNS,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>protocols file,
    <A
HREF="x10107.htm"
>The Services and Protocols Files</A
>
  </DT
><DT
>proxy ARP,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.PLIP"
>The PLIP Interface</A
>,
    <A
HREF="x4395.htm"
>Checking the ARP Tables</A
>,
    <A
HREF="x6777.htm#AEN6843"
>Routing Through a PPP Link</A
>
  </DT
><DT
>PTR (DNS record),
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DT
>public keys,
    <A
HREF="x10204.htm#AEN10291"
>The ssh daemon</A
>,
    <A
HREF="x10204.htm#AEN10359"
>The ssh client</A
>
  </DT
><DT
>pulling news,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>
  </DT
><DT
>pushing news,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>,
    <A
HREF="c17725.htm#AEN17825"
>Pushing a News Article onto a Server</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN23270"
>Q</A
></H2
><DL
><DT
>queuing mail,
    <A
HREF="x16011.htm"
>Mail Delivery Modes</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN23275"
>R</A
></H2
><DL
><DT
>RARP (Reverse Address Resolution Protocol),
    <A
HREF="x1625.htm"
>Address Resolution</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DT
>rc script,
    <A
HREF="c3268.htm"
>Configuring TCP/IP Networking</A
>
  </DT
><DT
>rcp command,
    <A
HREF="x10204.htm"
>Configuring Remote Loginand Execution</A
>
  </DT
><DT
>reaching a host,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>
  </DT
><DT
>real user names,
    <A
HREF="x16700.htm"
>Installation</A
>
  </DT
><DT
>Real-time Blackhole List (RBL),
    <A
HREF="x15291.htm#AEN15416"
>The Real-time Blackhole List</A
>,
    <A
HREF="x16298.htm"
>Protecting Against Mail Spam</A
>
  </DT
><DT
>receiving news,
    <A
HREF="x16837.htm"
>The sys File</A
>
  </DT
><DT
>RedHat (Linux distribution),
    <A
HREF="x16.htm#AEN317"
>Obtaining Linux</A
>
  </DT
><DT
>relaynews command,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>
  </DT
><DT
>remote
  </DT
><DD
><DL
><DT
>command execution,
    <A
HREF="x10204.htm"
>Configuring Remote Loginand Execution</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>execution,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>file access,
    <A
HREF="x10204.htm"
>Configuring Remote Loginand Execution</A
>,
    <A
HREF="c11260.htm"
>The NetworkFile System</A
>,
    <A
HREF="c11660.htm"
>IPX and the NCP Filesystem</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>filesystem,
    <A
HREF="x11349.htm"
>Mounting an NFS Volume</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>login,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.INTRO"
>Introduction to TCP/IP Networks</A
>,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.TCP"
>The Transmission Control Protocol</A
>,
    <A
HREF="x10204.htm"
>Configuring Remote Loginand Execution</A
>
  </DT
><DD
><DL
><DT
>via TCP/IP,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.INTRO"
>Introduction to TCP/IP Networks</A
>
  </DT
><DT
>X Windows session,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.INTRO"
>Introduction to TCP/IP Networks</A
>
  </DT
></DL
></DD
></DL
></DD
><DT
>Remote Procedure Call
  </DT
><DD
><DL
><DT
>see RPC</DT
></DL
></DD
><DT
>repeaters,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DT
>resolv.conf file,
    <A
HREF="c4495.htm#X-087-2-RESOLV.RESOLV"
>Configuring Name Server Lookups Using resolv.conf</A
>,
    <A
HREF="x5256.htm#X-087-2-RESOLV.NAMED-CACHINGONLY"
>Caching-only named Configuration</A
>
  </DT
><DT
>resolvers
  </DT
><DD
><DL
><DT
>configuring,
    <A
HREF="c4495.htm#X-087-2-RESOLV.HOST-CONF"
>The host.conf File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>environment variables,
    <A
HREF="c4495.htm#X-087-2-RESOLV.ENVIRON"
>Resolver environment variables</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>library,
    <A
HREF="c4495.htm#X-087-2-RESOLV.LIBRARY"
>The Resolver Library</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>robustness,
    <A
HREF="c4495.htm#X-087-2-RESOLV.ROBUSTNESS"
>Resolver Robustness</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>using a name server,
    <A
HREF="c4495.htm#X-087-2-RESOLV.HOST-CONF"
>The host.conf File</A
>,
    <A
HREF="c4495.htm#X-087-2-RESOLV.NSSWITCH-CONF"
>The nsswitch.conf File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>using NIS,
    <A
HREF="c4495.htm#X-087-2-RESOLV.HOST-CONF"
>The host.conf File</A
>,
    <A
HREF="c4495.htm#X-087-2-RESOLV.NSSWITCH-CONF"
>The nsswitch.conf File</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>RESOLV_ADD_TRIM_DOMAINS environment variable,
    <A
HREF="c4495.htm#X-087-2-RESOLV.ENVIRON"
>Resolver environment variables</A
>
  </DT
><DT
>RESOLV_HOST_CONF environment variable,
    <A
HREF="c4495.htm#X-087-2-RESOLV.ENVIRON"
>Resolver environment variables</A
>
  </DT
><DT
>RESOLV_MULTI environment variable,
    <A
HREF="c4495.htm#X-087-2-RESOLV.ENVIRON"
>Resolver environment variables</A
>
  </DT
><DT
>RESOLV_OVERRIDE_TRIM_DOMAINS environment variable,
    <A
HREF="c4495.htm#X-087-2-RESOLV.ENVIRON"
>Resolver environment variables</A
>
  </DT
><DT
>RESOLV_SERV_ORDER environment variable,
    <A
HREF="c4495.htm#X-087-2-RESOLV.ENVIRON"
>Resolver environment variables</A
>
  </DT
><DT
>RESOLV_SPOOF_CHECK environment variable,
    <A
HREF="c4495.htm#X-087-2-RESOLV.ENVIRON"
>Resolver environment variables</A
>
  </DT
><DT
>resource record (RR),
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DT
>restricting access to services,
    <A
HREF="x9973.htm"
>The tcpd Access Control Facility</A
>
  </DT
><DT
>Reverse Address Resolution Protocol
  </DT
><DD
><DL
><DT
>see RARP</DT
></DL
></DD
><DT
>reverse mapping,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.IN-ADDR"
>Reverse Lookups</A
>
  </DT
><DT
>rewrite rules (sendmail),
    <A
HREF="x14923.htm"
>Interpreting and Writing Rewrite Rules</A
>
  </DT
><DT
>RFC-1036,
    <A
HREF="x18341.htm#AEN18873"
>The control.ctl file</A
>
  </DT
><DT
>RFC-1123,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.INTERNET"
>Mail Routing on the Internet</A
>
  </DT
><DT
>RFC-1341,
    <A
HREF="c13847.htm#X-087-2-MAIL.MESSAGE-FORMAT"
>What Is a Mail Message?</A
>
  </DT
><DT
>RFC-1700,
    <A
HREF="x7720.htm#X-087-2-FIREWALL.IPFWADM.ICMP-TYPES"
>ICMP datagram types</A
>
  </DT
><DT
>RFC-793,
    <A
HREF="x8543.htm#AEN8816"
>TCP Extensions: used with -m tcp -p tcp</A
>
  </DT
><DT
>RFC-821,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.INTERNET"
>Mail Routing on the Internet</A
>
  </DT
><DT
>RFC-822,
    <A
HREF="c13847.htm"
>Electronic Mail</A
>,
    <A
HREF="c13847.htm#X-087-2-MAIL.MESSAGE-FORMAT"
>What Is a Mail Message?</A
>,
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.RFC822"
>RFC-822</A
>,
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.OBSOLETE"
>Obsolete Mail Formats</A
>
  </DT
><DD
><DL
><DT
>names,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>RFC-974,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.INTERNET"
>Mail Routing on the Internet</A
>
  </DT
><DT
>RIP (Routing Information Protocol),
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.TABLE"
>The Routing Table</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.PLIP"
>The PLIP Interface</A
>,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DT
>rlogin command,
    <A
HREF="x10204.htm"
>Configuring Remote Loginand Execution</A
>
  </DT
><DT
>rmail command,
    <A
HREF="x13353.htm#AEN13362"
>Command Execution</A
>
  </DT
><DT
>rmgroup control message,
    <A
HREF="x17521.htm#X-087-2-CNEWS.CONTROL.ADDGROUP"
>newgroup and rmgroup</A
>
  </DT
><DT
>rnews command,
    <A
HREF="x13353.htm#AEN13362"
>Command Execution</A
>,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>,
    <A
HREF="x17145.htm"
>Article Batching</A
>
  </DT
><DT
>root domain,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DT
>Rose protocol,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DT
>round-trip time (IP),
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>
  </DT
><DT
>route command,
    <A
HREF="x3515.htm"
>Interface Configuration for IP</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.PLIP"
>The PLIP Interface</A
>,
    <A
HREF="x5881.htm"
>SLIP Operation</A
>
  </DT
><DT
>route, default,
    <A
HREF="x1507.htm"
>IP Addresses</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.GATEWAY"
>Routing Through a Gateway</A
>,
    <A
HREF="x6560.htm"
>Running pppd</A
>
  </DT
><DT
>routed command,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.TABLE"
>The Routing Table</A
>
  </DT
><DT
>routers,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DT
>routing
  </DT
><DD
><DL
><DT
>daemon,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.TABLE"
>The Routing Table</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>dynamic,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.TABLE"
>The Routing Table</A
>,
    <A
HREF="x1929.htm"
>The Internet Control Message Protocol</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.PLIP"
>The PLIP Interface</A
>,
    <A
HREF="x4395.htm"
>Checking the ARP Tables</A
>,
    <A
HREF="x6777.htm#AEN6843"
>Routing Through a PPP Link</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>email
  </DT
><DD
><DL
><DT
>see email, routing</DT
></DL
></DD
><DT
>ICMP Redirect,
    <A
HREF="x1929.htm"
>The Internet Control Message Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP,
    <A
HREF="x1657.htm"
>IP Routing</A
>
  </DT
><DD
><DL
><DT
>datagrams
  </DT
><DD
><DL
><DT
>see IP, routing</DT
></DL
></DD
><DT
>gateways,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.GATEWAY"
>Routing Through a Gateway</A
>
  </DT
></DL
></DD
><DT
>IPX (Internet Packet eXchange),
    <A
HREF="x11912.htm"
>Configuring an IPX Router</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>metric,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.METRIC"
>Metric Values</A
>,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>over PPP,
    <A
HREF="x6777.htm#AEN6843"
>Routing Through a PPP Link</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>protocols,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.TABLE"
>The Routing Table</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>proxy ARP,
    <A
HREF="x4395.htm"
>Checking the ARP Tables</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>smart host,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Routing Information Protocol (RIP),
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.TABLE"
>The Routing Table</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.PLIP"
>The PLIP Interface</A
>,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>,
    <A
HREF="x11912.htm"
>Configuring an IPX Router</A
>
  </DT
><DT
>routing table,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.TABLE"
>The Routing Table</A
>
  </DT
><DD
><DL
><DT
>displaying via netstat,
    <A
HREF="x4200.htm#X-087-2-IFACE.NETSTAT.-R"
>Displaying the Routing Table</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>RPC (Remote Procedure Call),
    <A
HREF="x10157.htm"
>Remote Procedure Call</A
>
  </DT
><DD
><DL
><DT
>mapping ports to programs,
    <A
HREF="x10157.htm"
>Remote Procedure Call</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>program numbers,
    <A
HREF="x10157.htm"
>Remote Procedure Call</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>rpc file,
    <A
HREF="x10157.htm"
>Remote Procedure Call</A
>
  </DT
><DT
>rpc.mountd daemon,
    <A
HREF="x11455.htm"
>The NFS Daemons</A
>
  </DT
><DT
>rpc.nfsd daemon,
    <A
HREF="c11260.htm"
>The NetworkFile System</A
>,
    <A
HREF="x11455.htm"
>The NFS Daemons</A
>
  </DT
><DT
>rpc.portmap daemon,
    <A
HREF="x10157.htm"
>Remote Procedure Call</A
>
  </DT
><DT
>rpcinfo command,
    <A
HREF="x10953.htm"
>Setting Up an NIS Client with GNU libc</A
>
  </DT
><DT
>RR (resource record),
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DT
>RS-232 serial interface,
    <A
HREF="x2912.htm"
>Serial Hardware</A
>
  </DT
><DT
>rsh command,
    <A
HREF="x10204.htm"
>Configuring Remote Loginand Execution</A
>
  </DT
><DT
>rsmtp
  </DT
><DD
><DL
><DT
>command,
    <A
HREF="x13353.htm#AEN13362"
>Command Execution</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>program,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>RTS/CTS (Ready to Send/Clear to Send),
    <A
HREF="x2912.htm"
>Serial Hardware</A
>
  </DT
><DT
>ruleset semantics (sendmail),
    <A
HREF="x14923.htm#AEN15122"
>Ruleset Semantics</A
>
  </DT
><DT
>Running Linux,
    <A
HREF="x16.htm#AEN133"
>Documentation Available Commercially</A
>
  </DT
><DT
>Rusling, David A.,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DT
>Russell, Paul,
    <A
HREF="x8114.htm"
>IP Firewall Chains (2.2 Kernels)</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN23561"
>S</A
></H2
><DL
><DT
>SAGE (System Administrator's Guild),
    <A
HREF="a19669.htm"
>SAGE: The SystemAdministrators Guild</A
>
  </DT
><DT
>Salz, Rich,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>
  </DT
><DT
>scp command,
    <A
HREF="x10204.htm"
>Configuring Remote Loginand Execution</A
>,
    <A
HREF="x10204.htm#AEN10359"
>The ssh client</A
>,
    <A
HREF="x10204.htm#X-087-2-FEATURES.SSH.USING"
>Using ssh</A
>
  </DT
><DT
>secondary option (BIND),
    <A
HREF="x5256.htm#AEN5298"
>The named.boot File</A
>
  </DT
><DT
>securenets option,
    <A
HREF="x10887.htm"
>NIS Server Security</A
>
  </DT
><DT
>security,
    <A
HREF="x6295.htm"
>Running in Server Mode</A
>
  </DT
><DD
><DL
><DT
>Ethernet,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>false hostnames,
    <A
HREF="c4495.htm#X-087-2-RESOLV.HOST-CONF"
>The host.conf File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>filtering,
    <A
HREF="x7578.htm"
>What Is IP Filtering?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>firewalls,
    <A
HREF="c7478.htm"
>TCP/IP Firewall</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>methods of attack,
    <A
HREF="c7478.htm#X-082-2-FIREWALL.ATTACKS"
>Methods of Attack</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>network,
    <A
HREF="c7478.htm"
>TCP/IP Firewall</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>PPP,
    <A
HREF="x6675.htm"
>Using chat to Automate Dialing</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>remote login,
    <A
HREF="x10204.htm"
>Configuring Remote Loginand Execution</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>SLIP,
    <A
HREF="x6039.htm"
>Using dip</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>spoofing,
    <A
HREF="c4495.htm#X-087-2-RESOLV.HOST-CONF"
>The host.conf File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>system,
    <A
HREF="x1392.htm#X-087-2-INTRO.SECURITY"
>System Security</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>TCP servers,
    <A
HREF="c9830.htm#X-087-2-APPL.INETD"
>The inetd Super Server</A
>,
    <A
HREF="x9973.htm"
>The tcpd Access Control Facility</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>using NIS,
    <A
HREF="x10887.htm"
>NIS Server Security</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>using PPP,
    <A
HREF="x7037.htm"
>General Security Considerations</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP,
    <A
HREF="x13353.htm"
>Controlling Access to UUCP Features</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>sed command (UNIX),
    <A
HREF="x16700.htm"
>Installation</A
>
  </DT
><DT
>sendbatches command,
    <A
HREF="x17145.htm"
>Article Batching</A
>
  </DT
><DT
>sendmail,
    <A
HREF="c13847.htm"
>Electronic Mail</A
>,
    <A
HREF="c14579.htm"
>Sendmail</A
>
  </DT
><DD
><DL
><DT
>access database,
    <A
HREF="x15291.htm#X-087-2-SENDMAIL.ACCESSDB"
>The access database</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>analyzing mail statistics,
    <A
HREF="x15691.htm#AEN15742"
>Analyzing Mail Statistics</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuration files,
    <A
HREF="x14644.htm"
>Overview of Configuration Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>hostat command,
    <A
HREF="x15691.htm#AEN15815"
>hoststat</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>important configurations,
    <A
HREF="x15291.htm"
>Some Useful sendmail Configurations</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>installing,
    <A
HREF="x14607.htm"
>Installing sendmail</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>m4 options,
    <A
HREF="x15220.htm"
>Configuring sendmail Options</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>mailstats command,
    <A
HREF="x15691.htm#AEN15751"
>mailstats</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>managaing email aliases,
    <A
HREF="x15291.htm#AEN15314"
>Managing Mail Aliases</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>management tools,
    <A
HREF="x15691.htm"
>Tips and Tricks</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>managing the mail spool,
    <A
HREF="x15691.htm#AEN15699"
>Managing the Mail Spool</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>options, configuring,
    <A
HREF="x15220.htm"
>Configuring sendmail Options</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>processing mail queues,
    <A
HREF="x15691.htm#AEN15722"
>Forcing a Remote Host to Process its Mail Queue</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>rewrite rules,
    <A
HREF="x14923.htm"
>Interpreting and Writing Rewrite Rules</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>ruleset semantics,
    <A
HREF="x14923.htm#AEN15122"
>Ruleset Semantics</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>running,
    <A
HREF="x15649.htm"
>Running sendmail</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>smart host configurations,
    <A
HREF="x15291.htm#AEN15362"
>Using a Smart Host</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>testing the configuration,
    <A
HREF="x15583.htm"
>Testing Your Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>virtual email hosting,
    <A
HREF="x15291.htm#AEN15506"
>Configuring Virtual Email Hosting</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>virtusertable feature,
    <A
HREF="x15291.htm#AEN15548"
>Forwarding virtual-hosted mail to other destinations</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>sendmail.cf file,
    <A
HREF="c14579.htm#AEN14586"
>Introduction to sendmail</A
>,
    <A
HREF="x14661.htm"
>The sendmail.cf and sendmail.mc Files</A
>
  </DT
><DD
><DL
><DT
>configuring sendmail options,
    <A
HREF="x15220.htm"
>Configuring sendmail Options</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>generating,
    <A
HREF="x14903.htm"
>Generating the sendmail.cf File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>R and S commands,
    <A
HREF="x14923.htm#AEN14938"
>sendmail.cf R and S Commands</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>sendmail.df file,
    <A
HREF="x14661.htm"
>The sendmail.cf and sendmail.mc Files</A
>
  </DT
><DT
>sendmail.mc file,
    <A
HREF="x14661.htm"
>The sendmail.cf and sendmail.mc Files</A
>
  </DT
><DD
><DL
><DT
>parameters,
    <A
HREF="x14661.htm#AEN14713"
>Typically Used sendmail.mc Parameters</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>two examples,
    <A
HREF="x14661.htm#AEN14682"
>Two Example sendmail.mc Files</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>.Sequence file,
    <A
HREF="x13480.htm#AEN13578"
>Be Paranoid: Call Sequence Checks</A
>
  </DT
><DT
>Sequenced Packet eXchange (SPX),
    <A
HREF="c11660.htm#AEN11684"
>Xerox, Novell, and History</A
>
  </DT
><DT
>Sequenced Packet Protocol (SPP),
    <A
HREF="c11660.htm#AEN11684"
>Xerox, Novell, and History</A
>
  </DT
><DT
>serial devices
  </DT
><DD
><DL
><DT
>accessing,
    <A
HREF="x2821.htm"
>Accessing Serial Devices</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring,
    <A
HREF="c2740.htm"
>Configuring the Serial Hardware</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>serial line
  </DT
><DD
><DL
><DT
>device file,
    <A
HREF="x2821.htm"
>Accessing Serial Devices</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>hardware handshake,
    <A
HREF="x2912.htm"
>Serial Hardware</A
>,
    <A
HREF="x2943.htm#X-087-2-SERIAL-STTY"
>The stty Command</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>protecting characters,
    <A
HREF="x6968.htm"
>Link Control Options</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Serial Line Internet protocols,
    <A
HREF="x575.htm"
>Acknowledgments</A
>
  </DT
><DD
><DL
><DT
>see also SLIP; PPP</DT
></DL
></DD
><DT
>serial line IP
  </DT
><DD
><DL
><DT
>see SLIP; PPP</DT
></DL
></DD
><DT
>servers
  </DT
><DD
><DL
><DT
>inetd,
    <A
HREF="c9830.htm#X-087-2-APPL.INETD"
>The inetd Super Server</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>kernel-based support,
    <A
HREF="x11618.htm"
>Kernel-Based NFSv2 Server Support</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>master,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>,
    <A
HREF="x10820.htm"
>Running an NIS Server</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>nfsd daemon,
    <A
HREF="c11260.htm"
>The NetworkFile System</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NIS,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NNTP,
    <A
HREF="c17725.htm"
>NNTP and thenntpd Daemon</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>rpc.nfsd daemon,
    <A
HREF="c11260.htm"
>The NetworkFile System</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>slave,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>,
    <A
HREF="x10820.htm"
>Running an NIS Server</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>tcpd daemon wrapper,
    <A
HREF="x9973.htm"
>The tcpd Access Control Facility</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>UUCP,
    <A
HREF="x13480.htm"
>Setting Up Your System for Dialing In</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>ypserv command,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Service Advertisement Protocol (SAP),
    <A
HREF="c11660.htm#AEN11684"
>Xerox, Novell, and History</A
>,
    <A
HREF="x11912.htm"
>Configuring an IPX Router</A
>
  </DT
><DT
>services,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.PORTS"
>More on Ports</A
>
  </DT
><DD
><DL
><DT
>port numbers and,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.PORTS"
>More on Ports</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>restricting access to,
    <A
HREF="x1392.htm#X-087-2-INTRO.SECURITY"
>System Security</A
>,
    <A
HREF="x9973.htm"
>The tcpd Access Control Facility</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>setting up,
    <A
HREF="c9830.htm#X-087-2-APPL.INETD"
>The inetd Super Server</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>well-known,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.PORTS"
>More on Ports</A
>,
    <A
HREF="x10107.htm"
>The Services and Protocols Files</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>services file,
    <A
HREF="x10107.htm"
>The Services and Protocols Files</A
>
  </DT
><DT
>services.byname map,
    <A
HREF="x11028.htm"
>Choosing the Right Maps</A
>
  </DT
><DT
>setnewsids (C News),
    <A
HREF="c16575.htm"
>C News</A
>
  </DT
><DT
>setserial command,
    <A
HREF="x2943.htm#X-087-2-SERIAL-SETSERIAL"
>The setserial Command</A
>
  </DT
><DT
>setting
  </DT
><DD
><DL
><DT
>domain name,
    <A
HREF="x3343.htm"
>Setting the Hostname</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>hostname,
    <A
HREF="x3343.htm"
>Setting the Hostname</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IRQ,
    <A
HREF="x4013.htm"
>All About ifconfig</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>NIS domain,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>,
    <A
HREF="x10953.htm"
>Setting Up an NIS Client with GNU libc</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>shadow passwords and NIS,
    <A
HREF="x11226.htm"
>Using NIS with Shadow Support</A
>
  </DT
><DT
>Simple Mail Transfer Protocol (SMTP)
  </DT
><DD
><DL
><DT
>see SMTP</DT
></DL
></DD
><DT
>sites,
    <A
HREF="c765.htm#X-087-2-INTRO.HISTORY"
>History</A
>
  </DT
><DD
><DL
><DT
>leaf,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Skahan, Vince,
    <A
HREF="x425.htm"
>About This Book</A
>
  </DT
><DT
>sl0 (SLIP interface),
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.SLIP"
>The SLIP and PPP Interfaces</A
>
  </DT
><DT
>sl1 device,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>
  </DT
><DT
>Slackware (Linux distribution),
    <A
HREF="x16.htm#AEN317"
>Obtaining Linux</A
>
  </DT
><DT
>slattach program,
    <A
HREF="x5881.htm"
>SLIP Operation</A
>
  </DT
><DT
>slave servers,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>,
    <A
HREF="x10820.htm"
>Running an NIS Server</A
>
  </DT
><DT
>SLIP (Serial Line IP) protocol,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SLIP"
>IP Over Serial Lines</A
>,
    <A
HREF="c2740.htm#X-087-2-SERIAL.SOFTWARE"
>Communications Software for Modem Links</A
>,
    <A
HREF="c5847.htm#X-087-2-SLIP.GENERAL"
>General Requirements</A
>
  </DT
><DD
><DL
><DT
>driver,
    <A
HREF="x2695.htm"
>The PPP and SLIP Drivers</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>interface,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.SLIP"
>The SLIP and PPP Interfaces</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>let users initiate,
    <A
HREF="x6039.htm"
>Using dip</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>null modem cable for,
    <A
HREF="x19544.htm"
>A Serial NULL Modem Cable</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>operation,
    <A
HREF="x5881.htm"
>SLIP Operation</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>routing,
    <A
HREF="x4395.htm"
>Checking the ARP Tables</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>SLIPDISC (line discipline),
    <A
HREF="x5881.htm"
>SLIP Operation</A
>
  </DT
><DT
>sliplogin program,
    <A
HREF="x6295.htm"
>Running in Server Mode</A
>
  </DT
><DT
>slist command,
    <A
HREF="x12201.htm#AEN12205"
>Server List</A
>
  </DT
><DT
>slogin command,
    <A
HREF="x10204.htm"
>Configuring Remote Loginand Execution</A
>,
    <A
HREF="x10204.htm#AEN10359"
>The ssh client</A
>,
    <A
HREF="x10204.htm#X-087-2-FEATURES.SSH.USING"
>Using ssh</A
>
  </DT
><DT
>smart host configurations,
    <A
HREF="x15291.htm#AEN15362"
>Using a Smart Host</A
>
  </DT
><DT
>smart host routing,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DT
>SMART_HOST macro,
    <A
HREF="x15291.htm#AEN15362"
>Using a Smart Host</A
>
  </DT
><DT
>SMTP (Simple Mail Transfer Protocol),
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DD
><DL
><DT
>batched,
    <A
HREF="x13353.htm#AEN13362"
>Command Execution</A
>,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>service,
    <A
HREF="c15849.htm#AEN15909"
>Running Exim</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>SOA (DNS record),
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.RECORDS"
>The DNS Database</A
>,
    <A
HREF="x5256.htm#AEN5453"
>The DNS Database Files</A
>
  </DT
><DT
>sockets,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>
  </DT
><DT
>source routing,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DT
>source-routed address,
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.MIXING"
>Mixing Different Mail Formats</A
>
  </DT
><DT
>spamming,
    <A
HREF="x15291.htm#AEN15394"
>Managing Unwanted or Unsolicited Mail (Spam)</A
>,
    <A
HREF="x16298.htm"
>Protecting Against Mail Spam</A
>
  </DT
><DT
>Spencer, Henry,
    <A
HREF="c16357.htm#X-087-2-NEWS.HISTORY"
>Usenet History</A
>
  </DT
><DT
>spoofing
  </DT
><DD
><DL
><DT
>attacks,
    <A
HREF="c7478.htm#X-082-2-FIREWALL.ATTACKS"
>Methods of Attack</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>preventing,
    <A
HREF="c4495.htm#X-087-2-RESOLV.HOST-CONF"
>The host.conf File</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>spool directory,
    <A
HREF="c12477.htm#X-087-2-UUCP.INTRO.GRADES"
>UUCP Transfers and Remote Execution</A
>
  </DT
><DT
>spooling,
    <A
HREF="c12477.htm#X-087-2-UUCP.INTRO.GRADES"
>UUCP Transfers and Remote Execution</A
>
  </DT
><DT
>ssh command,
    <A
HREF="x10204.htm"
>Configuring Remote Loginand Execution</A
>
  </DT
><DD
><DL
><DT
>clients,
    <A
HREF="x10204.htm#AEN10359"
>The ssh client</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring,
    <A
HREF="x10204.htm#AEN10275"
>Installing and Configuring ssh</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>running clients,
    <A
HREF="x10204.htm#X-087-2-FEATURES.SSH.USING"
>Using ssh</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>sshd daemon,
    <A
HREF="x10204.htm#AEN10291"
>The ssh daemon</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>ssh tools,
    <A
HREF="x1392.htm#X-087-2-INTRO.SECURITY"
>System Security</A
>
  </DT
><DT
>ssh-keygen utility,
    <A
HREF="x10204.htm#AEN10291"
>The ssh daemon</A
>,
    <A
HREF="x10204.htm#AEN10359"
>The ssh client</A
>
  </DT
><DT
>.ssh/authorized_keys file,
    <A
HREF="x10204.htm#X-087-2-FEATURES.SSH.USING"
>Using ssh</A
>
  </DT
><DT
>sshd daemon,
    <A
HREF="x10204.htm#AEN10291"
>The ssh daemon</A
>
  </DT
><DT
>standalone host,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.DUMMY"
>The Dummy Interface</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ALIAS"
>IP Alias</A
>
  </DT
><DT
>standards, filesystem,
    <A
HREF="x394.htm"
>File System Standards</A
>
  </DT
><DT
>Start of Authority,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.RECORDS"
>The DNS Database</A
>
  </DT
><DT
>Storm, Kim F.,
    <A
HREF="x19426.htm"
>nn Configuration</A
>
  </DT
><DT
>Stover, Martin,
    <A
HREF="x11757.htm"
>IPX and Linux</A
>,
    <A
HREF="x12457.htm"
>NetWare Server Emulation</A
>
  </DT
><DT
>stty command,
    <A
HREF="x2943.htm#X-087-2-SERIAL-STTY"
>The stty Command</A
>
  </DT
><DT
>subdomains,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DD
><DL
><DT
>DNS,
    <A
HREF="x4905.htm"
>How DNS Works</A
>,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.IN-ADDR"
>Reverse Lookups</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>subnets
  </DT
><DD
><DL
><DT
>DNS, creating,
    <A
HREF="x3422.htm"
>Creating Subnets</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>IP,
    <A
HREF="x1657.htm#X-087-2-ISSUES.ROUTING.SUBNETS"
>Subnetworks</A
>,
    <A
HREF="c2016.htm#AEN2187"
>Kernel Networking Options in Linux 2.0.0 and Higher</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>sudo command,
    <A
HREF="x6039.htm"
>Using dip</A
>
  </DT
><DT
>support, online,
    <A
HREF="x16.htm#AEN274"
>Online Linux Support</A
>
  </DT
><DT
>SuSE (Linux distribution),
    <A
HREF="x16.htm#AEN317"
>Obtaining Linux</A
>
  </DT
><DT
>synchronizing name servers,
    <A
HREF="x4905.htm#X-087-2-RESOLV.DNS.AUTH"
>Types of Name Servers</A
>
  </DT
><DT
>sys file (/etc/news),
    <A
HREF="x16837.htm"
>The sys File</A
>
  </DT
><DT
>syslog,
    <A
HREF="x7261.htm"
>Debugging Your PPP Setup</A
>,
    <A
HREF="x9973.htm"
>The tcpd Access Control Facility</A
>,
    <A
HREF="x11486.htm"
>The exports File</A
>
  </DT
><DT
>system maintenance,
    <A
HREF="x1392.htm"
>Maintaining Your System</A
>
  </DT
><DT
>system security,
    <A
HREF="x1392.htm#X-087-2-INTRO.SECURITY"
>System Security</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN23974"
>T</A
></H2
><DL
><DT
>tass newsreader,
    <A
HREF="c19276.htm#X-087-2-NEWSREADERS.TIN"
>tin Configuration</A
>
  </DT
><DT
>Taylor UUCP,
    <A
HREF="c12477.htm"
>ManagingTaylor UUCP</A
>
  </DT
><DD
><DL
><DT
>accounts,
    <A
HREF="x13480.htm#X-087-2-UUCP.DIALIN.ACCOUNTS"
>Providing UUCP Accounts</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>alternates,
    <A
HREF="x12725.htm#AEN13131"
>Alternates</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>anonymous,
    <A
HREF="x13480.htm#AEN13611"
>Anonymous UUCP</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>call sequence check,
    <A
HREF="c12477.htm#X-087-2-UUCICO.CONNECT"
>The Inner Workings of uucico</A
>,
    <A
HREF="x13480.htm#AEN13578"
>Be Paranoid: Call Sequence Checks</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>call time,
    <A
HREF="x12725.htm#AEN13147"
>Restricting call times</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>calling in,
    <A
HREF="x13480.htm"
>Setting Up Your System for Dialing In</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>calling out,
    <A
HREF="c12477.htm#AEN12640"
>uucico Command-line Options</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>chat scripts,
    <A
HREF="x12725.htm#AEN13024"
>The login chat</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>checking,
    <A
HREF="x12725.htm#AEN12885"
>Taylor Configuration Files</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>command execution,
    <A
HREF="x13353.htm#AEN13362"
>Command Execution</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuration files,
    <A
HREF="x12725.htm"
>UUCP Configuration Files</A
>,
    <A
HREF="x12725.htm#AEN12944"
>General Configuration Options Using the config File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configure as server,
    <A
HREF="x13480.htm"
>Setting Up Your System for Dialing In</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>device,
    <A
HREF="x12725.htm#AEN13006"
>port and speed</A
>,
    <A
HREF="x12725.htm#AEN13217"
>Identifying Available Devices Through the port File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>dial file,
    <A
HREF="x12725.htm#AEN13267"
>How to Dial a Number Using the dial File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>dialcode file,
    <A
HREF="x12725.htm#AEN12985"
>Telephone number</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>direct lines,
    <A
HREF="x12725.htm#AEN13335"
>Using a Direct Connection</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>file transfer,
    <A
HREF="x13353.htm#AEN13402"
>File Transfers</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>forwarding,
    <A
HREF="x13353.htm#AEN13444"
>Forwarding</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>handshake,
    <A
HREF="c12477.htm#X-087-2-UUCICO.CONNECT"
>The Inner Workings of uucico</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>HDB,
    <A
HREF="x13819.htm"
>Log Files and Debugging</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>hostname,
    <A
HREF="x12725.htm#X-087-2-UUCP.STARTING.SITENAME"
>Site Naming</A
>,
    <A
HREF="x12725.htm#AEN12944"
>General Configuration Options Using the config File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>job,
    <A
HREF="c12477.htm#X-087-2-UUCP.INTRO.GRADES"
>UUCP Transfers and Remote Execution</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>logging and debugging,
    <A
HREF="c12477.htm#AEN12640"
>uucico Command-line Options</A
>,
    <A
HREF="x13819.htm"
>Log Files and Debugging</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>logging in,
    <A
HREF="x12725.htm#X-087-2-UUCP.STARTING.PARAMETERS"
>What UUCP Needs to Know</A
>,
    <A
HREF="x12725.htm#AEN13024"
>The login chat</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>login chat,
    <A
HREF="x12725.htm#AEN13024"
>The login chat</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>login security,
    <A
HREF="x13480.htm#X-087-2-UUCP.SECURITY.CALLED-LOGIN"
>Protecting Yourself Against Swindlers</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>mail,
    <A
HREF="x13353.htm#AEN13362"
>Command Execution</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Mapping Project,
    <A
HREF="x12725.htm#X-087-2-UUCP.STARTING.SITENAME"
>Site Naming</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>master,
    <A
HREF="c12477.htm#X-087-2-UUCICO.CONNECT"
>The Inner Workings of uucico</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>modem,
    <A
HREF="x12725.htm#AEN13217"
>Identifying Available Devices Through the port File</A
>,
    <A
HREF="x12725.htm#AEN13267"
>How to Dial a Number Using the dial File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>news,
    <A
HREF="x13353.htm#AEN13362"
>Command Execution</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>over TCP/IP,
    <A
HREF="x12725.htm#AEN13312"
>UUCP Over TCP</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>passwd file,
    <A
HREF="x13480.htm#X-087-2-UUCP.DIALIN.ACCOUNTS"
>Providing UUCP Accounts</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>phone number,
    <A
HREF="x12725.htm#AEN12985"
>Telephone number</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>port file,
    <A
HREF="x12725.htm#AEN13217"
>Identifying Available Devices Through the port File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>priorities,
    <A
HREF="c12477.htm#X-087-2-UUCP.INTRO.GRADES"
>UUCP Transfers and Remote Execution</A
>,
    <A
HREF="x12725.htm#AEN13147"
>Restricting call times</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>protocols,
    <A
HREF="c12477.htm#X-087-2-UUCICO.CONNECT"
>The Inner Workings of uucico</A
>
  </DT
><DD
><DL
><DT
>tuning,
    <A
HREF="x13645.htm#AEN13708"
>Tuning the Transmission Protocol</A
>
  </DT
></DL
></DD
><DT
>remote system,
    <A
HREF="x12725.htm#X-087-2-UUCP.SYSTEMS.FILE"
>How to Tell UUCP About Other Systems Using the sys File</A
>,
    <A
HREF="x12725.htm#AEN12972"
>System name</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>restrict
  </DT
><DD
><DL
><DT
>call time,
    <A
HREF="x12725.htm#AEN13147"
>Restricting call times</A
>
  </DT
><DT
>command execution,
    <A
HREF="x13353.htm#AEN13362"
>Command Execution</A
>
  </DT
><DT
>file transfer,
    <A
HREF="x13353.htm#AEN13402"
>File Transfers</A
>
  </DT
><DT
>forwarding,
    <A
HREF="x13353.htm#AEN13444"
>Forwarding</A
>
  </DT
></DL
></DD
><DT
>retry interval,
    <A
HREF="x12725.htm#AEN13147"
>Restricting call times</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>set up logins,
    <A
HREF="x13480.htm#X-087-2-UUCP.DIALIN.ACCOUNTS"
>Providing UUCP Accounts</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>slave,
    <A
HREF="c12477.htm#X-087-2-UUCICO.CONNECT"
>The Inner Workings of uucico</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>spool directory,
    <A
HREF="c12477.htm#X-087-2-UUCP.INTRO.GRADES"
>UUCP Transfers and Remote Execution</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>spool grade,
    <A
HREF="c12477.htm#X-087-2-UUCP.INTRO.GRADES"
>UUCP Transfers and Remote Execution</A
>,
    <A
HREF="x12725.htm#AEN13147"
>Restricting call times</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>statistics,
    <A
HREF="x13819.htm"
>Log Files and Debugging</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>sys file,
    <A
HREF="x12725.htm#X-087-2-UUCP.SYSTEMS.FILE"
>How to Tell UUCP About Other Systems Using the sys File</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>uucico,
    <A
HREF="c12477.htm#X-087-2-UUCICO.CONNECT"
>The Inner Workings of uucico</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>Taylor, Ian,
    <A
HREF="c12477.htm"
>ManagingTaylor UUCP</A
>
  </DT
><DT
>TCP (Transmission Control Protocol),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.TCP"
>The Transmission Control Protocol</A
>
  </DT
><DD
><DL
><DT
>UUCP,
    <A
HREF="x12725.htm#AEN13312"
>UUCP Over TCP</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>wrapper program,
    <A
HREF="x9973.htm"
>The tcpd Access Control Facility</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>TCP/IP (Transmission Control Protocol/Internet Protocol)
  </DT
><DD
><DL
><DT
>accounting,
    <A
HREF="c9157.htm"
>IP Accounting</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>compressing packets,
    <A
HREF="x5881.htm"
>SLIP Operation</A
>,
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>configuring networks,
    <A
HREF="c3268.htm"
>Configuring TCP/IP Networking</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>firewalls,
    <A
HREF="c7478.htm"
>TCP/IP Firewall</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>networks,
    <A
HREF="x792.htm"
>TCP/IP Networks</A
>,
    <A
HREF="c1476.htm"
>Issues of TCP/IP Networking</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>tcpd daemon wrapper,
    <A
HREF="x9973.htm"
>The tcpd Access Control Facility</A
>
  </DT
><DT
>telephones
  </DT
><DD
><DL
><DT
>demand dialing,
    <A
HREF="x7297.htm#AEN7379"
>Demand Dialing</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>persistent dialing,
    <A
HREF="x7297.htm#AEN7441"
>Persistent Dialing</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>sending data over,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SLIP"
>IP Over Serial Lines</A
>,
    <A
HREF="c5847.htm"
>Serial Line IP</A
>,
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>terminal programs,
    <A
HREF="c2740.htm#X-087-2-SERIAL.SOFTWARE"
>Communications Software for Modem Links</A
>
  </DT
><DT
>testing
  </DT
><DD
><DL
><DT
>network configuration,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.LOOPBACK"
>The Loopback Interface</A
>,
    <A
HREF="x3515.htm#X-087-2-IFACE.INTERFACE.ETHERNET"
>Ethernet Interfaces</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>sendmail configuration,
    <A
HREF="x15583.htm"
>Testing Your Configuration</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>TFTP (Trivial File Transfer Protocol),
    <A
HREF="x1392.htm#X-087-2-INTRO.SECURITY"
>System Security</A
>,
    <A
HREF="c9830.htm#X-087-2-APPL.INETD"
>The inetd Super Server</A
>
  </DT
><DT
>thinnet,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.HISTORY"
>Ethernets</A
>
  </DT
><DT
>Thmmler, Swen,
    <A
HREF="c10509.htm"
>The Network Information System</A
>
  </DT
><DT
>tin newsreader, configuration,
    <A
HREF="c19276.htm#X-087-2-NEWSREADERS.TIN"
>tin Configuration</A
>
  </DT
><DT
>TNC (Terminal Node Controller),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>
  </DT
><DT
>Token Ring
  </DT
><DD
><DL
><DT
>ARP and,
    <A
HREF="x1625.htm"
>Address Resolution</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>driver,
    <A
HREF="x2714.htm"
>Other Network Types</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>networks,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>TOS (Type Of Service) bits, manipulating,
    <A
HREF="x8932.htm"
>TOS Bit Manipulation</A
>
  </DT
><DT
>tr0 device,
    <A
HREF="x2367.htm"
>A Tour of Linux Network Devices</A
>
  </DT
><DT
>Transmission Control Protocol
  </DT
><DD
><DL
><DT
>see TCP</DT
></DL
></DD
><DT
>Tridgell, Andrew,
    <A
HREF="x1312.htm"
>Linux Networking</A
>
  </DT
><DT
>tripwire command,
    <A
HREF="x1392.htm#X-087-2-INTRO.SECURITY"
>System Security</A
>
  </DT
><DT
>Trivial File Transfer Protocol
  </DT
><DD
><DL
><DT
>see TFTP</DT
></DL
></DD
><DT
>trn newsreader, configuration,
    <A
HREF="x19359.htm"
>trn Configuration</A
>
  </DT
><DT
>T'so, Theodore,
    <A
HREF="x2943.htm#X-087-2-SERIAL-SETSERIAL"
>The setserial Command</A
>
  </DT
><DT
>ttys,
    <A
HREF="x2804.htm"
>Introduction to Serial Devices</A
>
  </DT
><DD
><DL
><DT
>line discipline,
    <A
HREF="x2804.htm"
>Introduction to Serial Devices</A
>,
    <A
HREF="x5881.htm"
>SLIP Operation</A
>,
    <A
HREF="c6438.htm#AEN6507"
>PPP on Linux</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN24197"
>U</A
></H2
><DL
><DT
>UART,
    <A
HREF="x2912.htm"
>Serial Hardware</A
>
  </DT
><DT
>UDP (User Datagram Protocol),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.UDP"
>The User Datagram Protocol</A
>
  </DT
><DT
>Unix-to-Unix Copy
  </DT
><DD
><DL
><DT
>see UUCP</DT
></DL
></DD
><DT
>unsolicited mail, managing,
    <A
HREF="x15291.htm#AEN15394"
>Managing Unwanted or Unsolicited Mail (Spam)</A
>,
    <A
HREF="x16298.htm"
>Protecting Against Mail Spam</A
>
  </DT
><DT
>Urlichs, Matthias,
    <A
HREF="x1312.htm#AEN1352"
>Different Streaks of Development</A
>
  </DT
><DT
>Usenet,
    <A
HREF="c16357.htm"
>Netnews</A
>
  </DT
><DD
><DL
><DT
>map files,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>maps,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>USENIX Association, SAGE,
    <A
HREF="a19669.htm"
>SAGE: The SystemAdministrators Guild</A
>
  </DT
><DT
>User Datagram Protocol (UDP),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.UDP"
>The User Datagram Protocol</A
>
  </DT
><DT
>user groups,
    <A
HREF="x16.htm#AEN292"
>Linux User Groups</A
>
  </DT
><DT
>/usr/lib/uucp/passwd file,
    <A
HREF="x13480.htm#X-087-2-UUCP.DIALIN.ACCOUNTS"
>Providing UUCP Accounts</A
>
  </DT
><DT
>uucico command,
    <A
HREF="c12477.htm"
>ManagingTaylor UUCP</A
>,
    <A
HREF="c12477.htm#X-087-2-UUCICO.CONNECT"
>The Inner Workings of uucico</A
>
  </DT
><DD
><DL
><DT
>command-line options,
    <A
HREF="c12477.htm#AEN12640"
>uucico Command-line Options</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>UUCP,
    <A
HREF="c2740.htm#X-087-2-SERIAL.SOFTWARE"
>Communications Software for Modem Links</A
>
  </DT
><DD
><DL
><DT
>anonymous,
    <A
HREF="x13480.htm#AEN13611"
>Anonymous UUCP</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>checking,
    <A
HREF="x13757.htm"
>Troubleshooting</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>email routing,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Exim interface to,
    <A
HREF="x16328.htm"
>UUCP Setup</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>jobs,
    <A
HREF="c12477.htm#X-087-2-UUCP.INTRO.GRADES"
>UUCP Transfers and Remote Execution</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>mail,
    <A
HREF="x14027.htm"
>How Is Mail Delivered?</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>map files,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Mapping Project,
    <A
HREF="x14210.htm#X-087-2-MAIL.ROUTING.UUCP"
>Mail Routing in the UUCP World</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>networks,
    <A
HREF="x1298.htm"
>UUCP Networks</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>news,
    <A
HREF="c16575.htm#X-087-2-CNEWS.RNEWS"
>Delivering News</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>protocols,
    <A
HREF="x13645.htm"
>UUCP Low-Level Protocols</A
>
  </DT
><DD
><DL
><DT
>selection,
    <A
HREF="x13645.htm#AEN13723"
>Selecting Specific Protocols</A
>
  </DT
></DL
></DD
><DT
>security,
    <A
HREF="x13480.htm#X-087-2-UUCP.SECURITY.CALLED-LOGIN"
>Protecting Yourself Against Swindlers</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>Taylor
  </DT
><DD
><DL
><DT
>see Taylor UUCP</DT
></DL
></DD
><DT
>troubleshooting,
    <A
HREF="x13757.htm"
>Troubleshooting</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>uucp domain,
    <A
HREF="x4905.htm"
>How DNS Works</A
>
  </DT
><DT
>uucpxtable,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DT
>uuwho command,
    <A
HREF="x14210.htm#AEN14362"
>Mixing UUCP and RFC-822</A
>
  </DT
><DT
>uux command,
    <A
HREF="x17145.htm"
>Article Batching</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN24285"
>V</A
></H2
><DL
><DT
>Van Jacobson header compression,
    <A
HREF="x5881.htm"
>SLIP Operation</A
>,
    <A
HREF="c6438.htm"
>The Point-to-Point Protocol</A
>
  </DT
><DT
>VERSIONID macro defintion,
    <A
HREF="x14661.htm#AEN14766"
>VERSIONID and OSTYPE</A
>
  </DT
><DT
>Virtual Brewery,
    <A
HREF="a19500.htm"
>Example Network:The Virtual Brewery</A
>
  </DT
><DT
>virtual email hosting
  </DT
><DD
><DL
><DT
>accepting mail for other domains,
    <A
HREF="x15291.htm#AEN15515"
>Accepting mail for other domains</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>forwarding mail to other destinations,
    <A
HREF="x15291.htm#AEN15548"
>Forwarding virtual-hosted mail to other destinations</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>virtusertable feature (sendmail),
    <A
HREF="x15291.htm#AEN15548"
>Forwarding virtual-hosted mail to other destinations</A
>
  </DT
><DT
>Vos, Jos,
    <A
HREF="x7720.htm"
>Original IP Firewall (2.0 Kernels)</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN24309"
>W</A
></H2
><DL
><DT
>Welsh, Matt,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DT
>Wirzenius, Lars,
    <A
HREF="x16.htm"
>Sources of Information</A
>
  </DT
><DT
>wrapper, TCP,
    <A
HREF="x9973.htm"
>The tcpd Access Control Facility</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN24320"
>X</A
></H2
><DL
><DT
>X Windows,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.INTRO"
>Introduction to TCP/IP Networks</A
>
  </DT
><DT
>X.25 protocol,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.OTHER-HARDWARE"
>Other Types of Hardware</A
>,
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>
  </DT
><DT
>XDR (External Data Representation),
    <A
HREF="x10157.htm"
>Remote Procedure Call</A
>
  </DT
><DT
>Xerox Corporation,
    <A
HREF="c11660.htm#AEN11684"
>Xerox, Novell, and History</A
>
  </DT
><DT
>Xerox Network Specification (XNS),
    <A
HREF="c11660.htm#AEN11684"
>Xerox, Novell, and History</A
>
  </DT
><DT
>XNS (Xerox Networking System),
    <A
HREF="x792.htm#X-087-2-INTRO.TCPIP.SOCKETS"
>The Socket Library</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN24341"
>Y</A
></H2
><DL
><DT
>Ye Olde ARPAnet kludge,
    <A
HREF="x14108.htm#X-087-2-MAIL.ADDRESS.MIXING"
>Mixing Different Mail Formats</A
>
  </DT
><DT
>Yellow Pages (YP),
    <A
HREF="x1966.htm"
>Resolving Host Names</A
>
  </DT
><DT
>yp-linux command,
    <A
HREF="c10509.htm"
>The Network Information System</A
>
  </DT
><DT
>ypbind command,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DT
>ypcat
  </DT
><DD
><DL
><DT
>command,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DD
><DL
></DL
></DD
><DT
>utility,
    <A
HREF="x10953.htm"
>Setting Up an NIS Client with GNU libc</A
>
  </DT
><DD
><DL
></DL
></DD
></DL
></DD
><DT
>yppasswd,
    <A
HREF="x11134.htm"
>Using the passwd and group Maps</A
>
  </DT
><DT
>ypserv command,
    <A
HREF="c10509.htm#AEN10579"
>Getting Acquainted with NIS</A
>
  </DT
><DT
>Yutaka, Niibe,
    <A
HREF="x2592.htm"
>The PLIP Driver</A
>
  </DT
></DL
></DIV
><DIV
CLASS="INDEXDIV"
><HR><H2
CLASS="INDEXDIV"
><A
NAME="AEN24370"
>Z</A
></H2
><DL
><DT
>Zen,
    <A
HREF="x16402.htm"
>What Is Usenet, Anyway?</A
>
  </DT
><DT
>zone files,
    <A
HREF="x5256.htm"
>Running named</A
>
  </DT
><DT
>zones, DNS
  </DT
><DD
><DL
><DT
>see DNS, zones</DT
></DL
></DD
></DL
></DIV
></DIV
></DIV
><H3
CLASS="FOOTNOTES"
>Notes</H3
><TABLE
BORDER="0"
CLASS="FOOTNOTES"
WIDTH="100%"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPR02"
HREF="#X-087-2-FNPR02"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>&#8230; or you are extremely impatient and know that the 24 hours it
might take to download the software from the Internet is faster than
the 72 hours it might take to wait for a CD-ROM to be delivered!</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPR04"
HREF="#X-087-2-FNPR04"
><SPAN
CLASS="footnote"
>[2]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Terry Dawson can be
reached at <SPAN
CLASS="SYSTEMITEM"
>terry@linux.org.au</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPR05"
HREF="#X-087-2-FNPR05"
><SPAN
CLASS="footnote"
>[3]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Philip Hazel can be reached at
<SPAN
CLASS="SYSTEMITEM"
>ph10@cus.cam.ac.uk</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPR06"
HREF="#X-087-2-FNPR06"
><SPAN
CLASS="footnote"
>[4]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Note that while you are allowed to print
out the online version, you may <EM
>not</EM
> run the
O'Reilly book through a photocopier, much less sell any of its
(hypothetical) copies.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIT01"
HREF="#X-087-2-FNIT01"
><SPAN
CLASS="footnote"
>[5]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The original spirit of which (see above) still shows on some occasions in
Europe.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIT02"
HREF="#X-087-2-FNIT02"
><SPAN
CLASS="footnote"
>[6]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The shell is a command-line interface to the Unix operating system. It's
similar to the DOS prompt in a Microsoft Windows environment, albeit much
more powerful.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIT03"
HREF="#X-087-2-FNIT03"
><SPAN
CLASS="footnote"
>[7]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> The Ethernet
FAQ at <SPAN
CLASS="SYSTEMITEM"
>http://www.faqs.org/faqs/LANs/ethernet-faq/</SPAN
>
talks about this issue, and a wealth of detailed historical and
technical information is available at Charles Spurgeon's Ethernet web
site at <SPAN
CLASS="SYSTEMITEM"
>http://wwwhost.ots.utexas.edu/ethernet/</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIT04"
HREF="#X-087-2-FNIT04"
><SPAN
CLASS="footnote"
>[8]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Alan can be reached at
<SPAN
CLASS="SYSTEMITEM"
>alan@lxorguk.ukuu.org.uk</SPAN
></P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIT05"
HREF="#X-087-2-FNIT05"
><SPAN
CLASS="footnote"
>[9]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> NCP is the protocol on which Novell file
and print services are based.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIT06"
HREF="#X-087-2-FNIT06"
><SPAN
CLASS="footnote"
>[10]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> We will come back to this topic in <A
HREF="#X-087-2-APPL"
>Chapter 12</A
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIT07"
HREF="#X-087-2-FNIT07"
><SPAN
CLASS="footnote"
>[11]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> There
have been commercial Unix systems (that you have to pay lots of money
for) that came with a setuid-<SPAN
CLASS="SYSTEMITEM"
>root</SPAN
> shell script, which allowed users to
gain <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
> privilege using a
simple standard trick.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIT08"
HREF="#X-087-2-FNIT08"
><SPAN
CLASS="footnote"
>[12]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>In 1988, the RTM worm brought much of the Internet to a grinding halt, partly
by exploiting a gaping hole in some programs including the
<B
CLASS="COMMAND"
>sendmail</B
> program. This hole has long since been fixed.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIS01"
HREF="#X-087-2-FNIS01"
><SPAN
CLASS="footnote"
>[13]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The version of the Internet Protocol most frequently used on the
Internet is Version 4. A lot of effort has been expended in designing
a replacement called IP Version 6. IPv6 uses a different addressing
scheme and larger addresses. Linux has an implementation of IPv6, but
it isn't ready to document it in this book yet. The Linux kernel
support for IPv6 is good, but a large number of network applications
need to be modified to support it as well. Stay tuned.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIS02"
HREF="#X-087-2-FNIS02"
><SPAN
CLASS="footnote"
>[14]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Frequently, IP addresses will be assigned to you by the provider from
whom you buy your IP connectivity. However, you may also apply to the
NIC directly for an IP address for your network by sending email to
<SPAN
CLASS="SYSTEMITEM"
>hostmaster@internic.net</SPAN
>, or
by using the form at <SPAN
CLASS="SYSTEMITEM"
>http://www.internic.net/</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIS03"
HREF="#X-087-2-FNIS03"
><SPAN
CLASS="footnote"
>[15]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Autonomous systems are slightly more general. They may comprise more than
one IP network.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIS05"
HREF="#X-087-2-FNIS05"
><SPAN
CLASS="footnote"
>[16]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> The cost of a
route can be thought of, in a simple case, as the number of hops
required to reach the destination. Proper calculation of route costs
can be a fine art in complex network designs.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNHW01"
HREF="#X-087-2-FNHW01"
><SPAN
CLASS="footnote"
>[17]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> IRQs 2 and
9 are the same because the IBM PC design has two cascaded interrupt
processors with eight IRQs each; the secondary processor is connected
to IRQ 2 of the primary one.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNHW02"
HREF="#X-087-2-FNHW02"
><SPAN
CLASS="footnote"
>[18]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>People should use development kernels and report bugs if they are
found; this is a very useful thing to do if you have a machine you can use 
as a test machine. Instructions on how to report bugs are detailed in
<TT
CLASS="FILENAME"
>/usr/src/linux/REPORTING-BUGS</TT
> in the Linux kernel
source.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNHW03"
HREF="#X-087-2-FNHW03"
><SPAN
CLASS="footnote"
>[19]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Remember, the IP protocol can be carried over many different types of
network, and not all network types will support packet sizes as large
as Ethernet.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNHW04"
HREF="#X-087-2-FNHW04"
><SPAN
CLASS="footnote"
>[20]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Paul can be reached at <SPAN
CLASS="SYSTEMITEM"
>gpg109@rsphy1.anu.edu.au</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNHW05"
HREF="#X-087-2-FNHW05"
><SPAN
CLASS="footnote"
>[21]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Fight to clear the hacking name! Always use &#8220;cracker&#8221; when
you are referring to people who are consciously trying to defeat the
security of a system, and &#8220;hacker&#8221; when you are referring
to people who have found a clever way of solving a problem. Hackers
can be crackers, but the two should never be confused. Consult the New
Hackers Dictionary (popularly found as the Jargon file) for a more
complete understanding of the terms.  </P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNHW06"
HREF="#X-087-2-FNHW06"
><SPAN
CLASS="footnote"
>[22]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The enhanced parallel port adaptor patch for 2.0 kernel is available from
<SPAN
CLASS="SYSTEMITEM"
>http://www.cyberelk.demon.co.uk/parport.html</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNHW07"
HREF="#X-087-2-FNHW07"
><SPAN
CLASS="footnote"
>[23]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>NCSA <B
CLASS="COMMAND"
>telnet</B
> is a popular program for DOS that runs TCP/IP
over Ethernet or PLIP, and supports <B
CLASS="COMMAND"
>telnet</B
> and FTP.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNHW08"
HREF="#X-087-2-FNHW08"
><SPAN
CLASS="footnote"
>[24]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Niibe can be reached at
<SPAN
CLASS="SYSTEMITEM"
>gniibe@mri.co.jp</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNHW09"
HREF="#X-087-2-FNHW09"
><SPAN
CLASS="footnote"
>[25]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>You can reach Philip at <EM
><SPAN
CLASS="SYSTEMITEM"
>Philip.Blundell@pobox.com</SPAN
></EM
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNSE1"
HREF="#X-087-2-FNSE1"
><SPAN
CLASS="footnote"
>[26]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>David can be reached at
<SPAN
CLASS="SYSTEMITEM"
>bf347@lafn.org</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-SERIAL-FIXME"
HREF="#X-087-2-SERIAL-FIXME"
><SPAN
CLASS="footnote"
>[27]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Note that we are not talking about WinModem&#8482; here! WinModems
have very simple hardware and rely completely on the main CPU of your
computer instead of dedicated hardware to do all of the hard work. If
you're purchasing a modem, it is our strongest recommendation to
<EM
>not</EM
> purchase such a modem; get a real modem. You
may find Linux support for WinModems, but that makes them only a
marginally more attractive solution.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNTC02"
HREF="#X-087-2-FNTC02"
><SPAN
CLASS="footnote"
>[28]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The first number on each subnet is the subnetwork address, and the last number
on each subnet is reserved as the broadcast address, so it's actually 62 hosts
per subnet.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNTC03"
HREF="#X-087-2-FNTC03"
><SPAN
CLASS="footnote"
>[29]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>You need the address of an NIS server only if you use Peter Eriksson's
NYS. Other NIS implementations locate their servers only at runtime by
using <B
CLASS="COMMAND"
>ypbind</B
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNTC04"
HREF="#X-087-2-FNTC04"
><SPAN
CLASS="footnote"
>[30]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Note that names in
<TT
CLASS="FILENAME"
>networks</TT
> must not collide with hostnames from the
<TT
CLASS="FILENAME"
>hosts</TT
> file, or else some programs may produce
strange results.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNTC05"
HREF="#X-087-2-FNTC05"
><SPAN
CLASS="footnote"
>[31]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Anyone remember Pink Floyd's &#8220;Echoes&#8221;?</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNTC06"
HREF="#X-087-2-FNTC06"
><SPAN
CLASS="footnote"
>[32]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> For example, all applications based on RPC
use the loopback interface to register themselves with the
<B
CLASS="COMMAND"
>portmapper</B
> daemon at startup. These applications
include NIS and NFS.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNTC07"
HREF="#X-087-2-FNTC07"
><SPAN
CLASS="footnote"
>[33]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Note that <KBD
CLASS="USERINPUT"
>pointopoint</KBD
> is not a typo. It's really spelled like
this.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNTC08"
HREF="#X-087-2-FNTC08"
><SPAN
CLASS="footnote"
>[34]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> As a matter of caution, you should
configure a PLIP or SLIP link only after you have completely set up
the routing table entries for your Ethernets. With some older kernels,
your network route might otherwise end up pointing at the
point-to-point link.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNTC09"
HREF="#X-087-2-FNTC09"
><SPAN
CLASS="footnote"
>[35]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The dummy device is called <TT
CLASS="FILENAME"
>dummy0</TT
> if you have
loaded it as a module rather than choosing it as an inbuilt kernel
option. This is because you are able to load multiple modules and have
more than one dummy device.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNTC10"
HREF="#X-087-2-FNTC10"
><SPAN
CLASS="footnote"
>[36]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> More correctly, using
IP aliasing is known as network layer virtual hosting. It is more
common in the WWW and STMP worlds to use application layer virtual
hosting, in which the same IP address is used for each virtual host,
but a different hostname is passed with each application layer
request. Services like FTP are not capable of operating in this way,
and they demand network layer virtual hosting.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNTC11"
HREF="#X-087-2-FNTC11"
><SPAN
CLASS="footnote"
>[37]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>RIP chooses the optimal route to a given host based on the &#8220;length&#8221;
of the path. It is computed by summing up the individual metric values of each
host-to-host link. By default, a hop has length 1, but this may be any
positive integer less than 16. (A route length of 16 is equal to infinity.
Such routes are considered unusable.) The <CODE
CLASS="OPTION"
>metric</CODE
> parameter
sets this hop cost, which is then broadcast by the routing daemon.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNTC12"
HREF="#X-087-2-FNTC12"
><SPAN
CLASS="footnote"
>[38]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> ssh can be obtained
from <SPAN
CLASS="SYSTEMITEM"
>ftp.cs.hut.fi</SPAN
> in
<TT
CLASS="FILENAME"
>/pub/ssh</TT
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNTC13"
HREF="#X-087-2-FNTC13"
><SPAN
CLASS="footnote"
>[39]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> You can tell whether a connection is
outgoing from the port numbers. The port number shown for the
<EM
>calling</EM
> host will always be a simple integer. On
the host being called, a well-known service port will be in use for
which <B
CLASS="COMMAND"
>netstat</B
> uses the symbolic name such as
<TT
CLASS="LITERAL"
>smtp</TT
>, found in <TT
CLASS="FILENAME"
>/etc/services</TT
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIS06"
HREF="#X-087-2-FNIS06"
><SPAN
CLASS="footnote"
>[40]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> If information weren't cached, then DNS
would be as inefficient as any other method because each query would
involve the root name servers.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIS07"
HREF="#X-087-2-FNIS07"
><SPAN
CLASS="footnote"
>[41]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Well, almost. A name server has to provide at least name service for
<SPAN
CLASS="SYSTEMITEM"
>localhost</SPAN
> and reverse lookups of
<SPAN
CLASS="SYSTEMITEM"
>127.0.0.1</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNDN01"
HREF="#X-087-2-FNDN01"
><SPAN
CLASS="footnote"
>[42]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>BIND 4.9 was developed by Paul Vixie,
<SPAN
CLASS="SYSTEMITEM"
>paul@vix.com</SPAN
>,
but BIND is now maintained by the Internet Software Consortium,
<SPAN
CLASS="SYSTEMITEM"
>bind-bugs@isc.org</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNDN03"
HREF="#X-087-2-FNDN03"
><SPAN
CLASS="footnote"
>[43]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Note that you can't query your name server for the root servers if you don't
have any root server hints installed. To escape this dilemma, you can either
make <B
CLASS="COMMAND"
>nslookup</B
> use a different name server, or use
the sample file in <A
HREF="#X-087-2-RESOLV.FIG.NAMED.CACHE"
>Example 6-10</A
> as a
starting point, and then obtain the full list of valid servers.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNSL1"
HREF="#X-087-2-FNSL1"
><SPAN
CLASS="footnote"
>[44]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
><B
CLASS="COMMAND"
>diplogin</B
> must be run as
setuid to <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
>, too. See the
section at the end of this chapter.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP01"
HREF="#X-087-2-FNPP01"
><SPAN
CLASS="footnote"
>[45]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Relevant RFCs are listed
in the Bibiliography at the end of this book.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP02"
HREF="#X-087-2-FNPP02"
><SPAN
CLASS="footnote"
>[46]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> In fact, HDLC is a much
more general protocol devised by the International Standards
Organization (ISO) and is also an essential component of the X.25
specification.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP03"
HREF="#X-087-2-FNPP03"
><SPAN
CLASS="footnote"
>[47]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> If you have any general
questions about PPP, ask the people on the Linux-net mailing
list at <SPAN
CLASS="SYSTEMITEM"
>vger.rutgers.edu</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP04"
HREF="#X-087-2-FNPP04"
><SPAN
CLASS="footnote"
>[48]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Karl can be reached at
<SPAN
CLASS="SYSTEMITEM"
>karl@morningstar.com</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP05"
HREF="#X-087-2-FNPP05"
><SPAN
CLASS="footnote"
>[49]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> The default network route is installed only
if none is already present.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP06"
HREF="#X-087-2-FNPP06"
><SPAN
CLASS="footnote"
>[50]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>If you edit <TT
CLASS="FILENAME"
>syslog.conf</TT
> to redirect these log messages to
a file, make sure this file isn't world readable, as <B
CLASS="COMMAND"
>chat</B
>
also logs the entire chat script by default&#8212;including passwords.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP07"
HREF="#X-087-2-FNPP07"
><SPAN
CLASS="footnote"
>[51]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> More information on two dynamic host
assignment mechanisms can be found at
<SPAN
CLASS="SYSTEMITEM"
>http://www.dynip.com/</SPAN
> and
<SPAN
CLASS="SYSTEMITEM"
>http://www.justlinux.com/dynamic_dns.html</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP08"
HREF="#X-087-2-FNPP08"
><SPAN
CLASS="footnote"
>[52]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Using hostnames in this option has
consequences for CHAP authentication. Please refer to the <A
HREF="#X-087-2-PPP.AUTHENTICATION"
>Section 8.8</A
>&#8221; section later in this
chapter.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP09"
HREF="#X-087-2-FNPP09"
><SPAN
CLASS="footnote"
>[53]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The <CODE
CLASS="OPTION"
>ipcp-accept-local</CODE
> and <CODE
CLASS="OPTION"
>ipcp-accept-remote</CODE
>
options instruct your <B
CLASS="COMMAND"
>pppd</B
> to accept the local and remote
IP addresses being offered by the remote PPP, even if you've supplied some in
your configuration. If these options are not configured, your
<B
CLASS="COMMAND"
>pppd</B
> will reject any attempt to negotiate the IP addresses
used.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP10"
HREF="#X-087-2-FNPP10"
><SPAN
CLASS="footnote"
>[54]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> If we
wanted to have routes for other sites created when they dial in, we'd
add appropriate case statements to cover those in which the
<TT
CLASS="LITERAL"
>...</TT
> appears in the example.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP11"
HREF="#X-087-2-FNPP11"
><SPAN
CLASS="footnote"
>[55]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>&#8220;Secret&#8221; is just the PPP name for passwords. PPP secrets
don't have the same length limitation as Linux login passwords.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP12"
HREF="#X-087-2-FNPP12"
><SPAN
CLASS="footnote"
>[56]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The double quotes are not part of the secret; they merely serve to protect the
whitespace within it.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP13"
HREF="#X-087-2-FNPP13"
><SPAN
CLASS="footnote"
>[57]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>This hostname is taken from the CHAP challenge.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP14"
HREF="#X-087-2-FNPP14"
><SPAN
CLASS="footnote"
>[58]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> The
<B
CLASS="COMMAND"
>useradd</B
> or <B
CLASS="COMMAND"
>adduser</B
> utility, if you have it, will
simplify this task.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FW-FN01"
HREF="#X-087-2-FW-FN01"
><SPAN
CLASS="footnote"
>[59]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> The
term <EM
>firewall</EM
> comes from a device used to protect
people from fire. The firewall is a shield of material resistant to
fire that is placed between a potential fire and the people it is
protecting.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FW-FN02"
HREF="#X-087-2-FW-FN02"
><SPAN
CLASS="footnote"
>[60]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Firewall packet logging
is a special feature that writes a line of information about each
datagram that matches a particular firewall rule out to a special
device so you can see them.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FW-FN03"
HREF="#X-087-2-FW-FN03"
><SPAN
CLASS="footnote"
>[61]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>FTP active mode is somewhat nonintuitively enabled using the
<B
CLASS="COMMAND"
>PORT</B
> command. FTP passive mode is enabled using the
<B
CLASS="COMMAND"
>PASV</B
> command.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FW-FN04"
HREF="#X-087-2-FW-FN04"
><SPAN
CLASS="footnote"
>[62]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The ProFTPd daemon is a good example of an FTP server that doesn't, at least
in older versions.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FN05"
HREF="#X-087-2-FN05"
><SPAN
CLASS="footnote"
>[63]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Paul can be reached at
<SPAN
CLASS="SYSTEMITEM"
>Paul.Russell@rustcorp.com.au</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-X-087-2-FW-FN06"
HREF="#X-087-2-X-087-2-FW-FN06"
><SPAN
CLASS="footnote"
>[64]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Take a look at <TT
CLASS="FILENAME"
>/etc/protocols</TT
> for protocol names and numbers.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNAC01"
HREF="#X-087-2-FNAC01"
><SPAN
CLASS="footnote"
>[65]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>This isn't a good thing to do if your Linux machine serves as a router. If
you disable IP forwarding, it will cease to route! Do this only on a
machine with a single physical network interface.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-MQ01"
HREF="#X-087-2-MQ01"
><SPAN
CLASS="footnote"
>[66]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>RealAudio is a trademark of the Progressive Networks Corporation.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNMQ02"
HREF="#X-087-2-FNMQ02"
><SPAN
CLASS="footnote"
>[67]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>You can contact Ambrose at
<SPAN
CLASS="SYSTEMITEM"
>ambrose@writeme.com</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN9893"
HREF="#AEN9893"
><SPAN
CLASS="footnote"
>[68]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>... and perhaps even a whole book!</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNFE01"
HREF="#X-087-2-FNFE01"
><SPAN
CLASS="footnote"
>[69]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Written by Wietse Venema,
<SPAN
CLASS="SYSTEMITEM"
>wietse@wzv.win.tue.nl</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNFE02"
HREF="#X-087-2-FNFE02"
><SPAN
CLASS="footnote"
>[70]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Usually only local hostnames obtained from lookups in
<TT
CLASS="FILENAME"
>/etc/hosts</TT
> contain no dots.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNFE03"
HREF="#X-087-2-FNFE03"
><SPAN
CLASS="footnote"
>[71]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>While its name suggests it is an extreme measure, the <SPAN
CLASS="SYSTEMITEM"
>PARANOID</SPAN
> keyword is
a good default, as it protects you against mailicious hosts pretending to
be someone they are not. Not all <B
CLASS="COMMAND"
>tcpd</B
> are supplied with
<SPAN
CLASS="SYSTEMITEM"
>PARANOID</SPAN
> compiled in; if yours is not, you need to recompile
<B
CLASS="COMMAND"
>tcpd</B
> to use it.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNFE04"
HREF="#X-087-2-FNFE04"
><SPAN
CLASS="footnote"
>[72]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>OpenSSH was developed by the OpenBSD project and is a fine example of the
benefit of free software.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNI01"
HREF="#X-087-2-FNNI01"
><SPAN
CLASS="footnote"
>[73]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Swen can be reached at
<SPAN
CLASS="SYSTEMITEM"
>swen@uni-paderborn.de</SPAN
>. The NIS clients
are available as <TT
CLASS="FILENAME"
>yp-linux.tar.gz</TT
> from
<SPAN
CLASS="SYSTEMITEM"
>metalab.unc.edu</SPAN
> in
<TT
CLASS="FILENAME"
>system/Network</TT
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNI02"
HREF="#X-087-2-FNNI02"
><SPAN
CLASS="footnote"
>[74]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Peter may be reached at
<SPAN
CLASS="SYSTEMITEM"
>pen@lysator.liu.se</SPAN
>.
The current version of NYS is 1.2.8.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNI04"
HREF="#X-087-2-FNNI04"
><SPAN
CLASS="footnote"
>[75]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Thorsten may be reached at
<SPAN
CLASS="SYSTEMITEM"
>kukuk@uni-paderborn.de</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNI05"
HREF="#X-087-2-FNNI05"
><SPAN
CLASS="footnote"
>[76]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>DBM is a simple database management library that uses hashing techniques
to speed up search operations. There's a free DBM implementation from the
GNU project called <TT
CLASS="FILENAME"
>gdbm</TT
>, which is part of most Linux
distributions.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNI06"
HREF="#X-087-2-FNNI06"
><SPAN
CLASS="footnote"
>[77]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> To
enable use of the <TT
CLASS="FILENAME"
>/etc/hosts.allow</TT
> method, you may
have to recompile the server. Please read the instructions in the
<TT
CLASS="FILENAME"
>README</TT
> included in the distribution.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNI07"
HREF="#X-087-2-FNNI07"
><SPAN
CLASS="footnote"
>[78]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The secure portmapper is available via anonymous FTP from
<SPAN
CLASS="SYSTEMITEM"
>ftp.win.tue.nl</SPAN
> below the
<TT
CLASS="FILENAME"
>/pub/security/</TT
> directory.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNF01"
HREF="#X-087-2-FNNF01"
><SPAN
CLASS="footnote"
>[79]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Rick can be reached at
<SPAN
CLASS="SYSTEMITEM"
>jrs@world.std.com</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNF02"
HREF="#X-087-2-FNNF02"
><SPAN
CLASS="footnote"
>[80]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Actually, you can omit the <TT
CLASS="LITERAL"
>&#8211;t nfs</TT
> argument
because <B
CLASS="COMMAND"
>mount</B
> sees from the colon that this
specifies an NFS volume.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNF05"
HREF="#X-087-2-FNNF05"
><SPAN
CLASS="footnote"
>[81]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> One doesn't say filesystem
because these are not proper filesystems.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIX01"
HREF="#X-087-2-FNIX01"
><SPAN
CLASS="footnote"
>[82]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Novell and NetWare are trademarks of the
Novell Corporation.  </P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIX02"
HREF="#X-087-2-FNIX02"
><SPAN
CLASS="footnote"
>[83]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Alan can be reached at
<SPAN
CLASS="SYSTEMITEM"
>alan@lxorguk.ukuu.org.uk</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIX03"
HREF="#X-087-2-FNIX03"
><SPAN
CLASS="footnote"
>[84]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Greg can be reached at <SPAN
CLASS="SYSTEMITEM"
>gpage@sovereign.org</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIX04"
HREF="#X-087-2-FNIX04"
><SPAN
CLASS="footnote"
>[85]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Volker can be reached at
<SPAN
CLASS="SYSTEMITEM"
>lendecke@namu01.gwdg.de</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIX05"
HREF="#X-087-2-FNIX05"
><SPAN
CLASS="footnote"
>[86]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Ales can be reached at <SPAN
CLASS="SYSTEMITEM"
>A.Dryak@sh.cvut.cz</SPAN
>. Martin can be reached at <SPAN
CLASS="SYSTEMITEM"
>mstover@freeway.de</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIX07"
HREF="#X-087-2-FNIX07"
><SPAN
CLASS="footnote"
>[87]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Information on Caldera can
be found at <EM
>http://www.caldera.com/</EM
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIX09"
HREF="#X-087-2-FNIX09"
><SPAN
CLASS="footnote"
>[88]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> It looks like the
system administrators had been sampling some of the Virtual Brewery's
wares before they chose some of those print queue names. Hopefully
your print queue names are more meaningful!</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU01"
HREF="#X-087-2-FNUU01"
><SPAN
CLASS="footnote"
>[89]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Written and copyrighted by Ian Taylor, 1995.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU02"
HREF="#X-087-2-FNUU02"
><SPAN
CLASS="footnote"
>[90]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>It's also included in the 4.4BSD <EM
>System Manager's Manual</EM
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU04"
HREF="#X-087-2-FNUU04"
><SPAN
CLASS="footnote"
>[91]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>If you're just going to try out UUCP, get the number of an archive site near
you. Write down the login and password&#8212;they're public to make anonymous
downloads possible. In most cases, they're something like
<SPAN
CLASS="SYSTEMITEM"
>uucp/uucp</SPAN
> or
<SPAN
CLASS="SYSTEMITEM"
>nuucp/uucp</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU05"
HREF="#X-087-2-FNUU05"
><SPAN
CLASS="footnote"
>[92]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The only limitation is that it shouldn't be longer than seven characters, so
as to not confuse UUCP implementations that run on an operating system that
imposes a narrow limit on filenames. Names that are longer than seven
characters are often truncated by UUCP. Some versions even limit the name to
six characters.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU06"
HREF="#X-087-2-FNUU06"
><SPAN
CLASS="footnote"
>[93]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> The UUCP Mapping Project
registers all UUCP hostnames worldwide and makes sure they are
unique.  </P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU07"
HREF="#X-087-2-FNUU07"
><SPAN
CLASS="footnote"
>[94]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Older Version 2 UUCPs don't broadcast their name when being called; however,
newer implementations often do, and so does Taylor UUCP.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU08"
HREF="#X-087-2-FNUU08"
><SPAN
CLASS="footnote"
>[95]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>For instance, most companies' private installations require you to dial a 0 or
9 to get a line to the outside.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU09"
HREF="#X-087-2-FNUU09"
><SPAN
CLASS="footnote"
>[96]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The bit rate of the <EM
>tty</EM
> must be at least as high as the maximum
transfer speed.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU10"
HREF="#X-087-2-FNUU10"
><SPAN
CLASS="footnote"
>[97]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>If the remote system runs Taylor UUCP, it will obey.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU11"
HREF="#X-087-2-FNUU11"
><SPAN
CLASS="footnote"
>[98]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Some modems don't seem to like this and occasionally hang.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU12"
HREF="#X-087-2-FNUU12"
><SPAN
CLASS="footnote"
>[99]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
><B
CLASS="COMMAND"
>bsmtp</B
> is used to deliver mail with batched SMTP.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-UUCP-FNUU13"
HREF="#X-087-2-UUCP-FNUU13"
><SPAN
CLASS="footnote"
>[100]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> You may use a
tilde (<TT
CLASS="LITERAL"
>~</TT
>) character to refer to the UUCP public
directory, but only in UUCP configuration files; outside it usually
translates to the user's home directory.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU14"
HREF="#X-087-2-FNUU14"
><SPAN
CLASS="footnote"
>[101]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Note that <B
CLASS="COMMAND"
>tcpd</B
> usually
has mode 700, so that you must invoke it as user <SPAN
CLASS="SYSTEMITEM"
>root</SPAN
>, not <SPAN
CLASS="SYSTEMITEM"
>uucp</SPAN
>. <B
CLASS="COMMAND"
>tcpd</B
> is discussed
in more detail in <A
HREF="#X-087-2-APPL"
>Chapter 12</A
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU15"
HREF="#X-087-2-FNUU15"
><SPAN
CLASS="footnote"
>[102]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Gert Doering's <B
CLASS="COMMAND"
>mgetty</B
> is such a beast. It runs on a
variety of platforms, including SCO Unix, AIX, SunOS, HP-UX, and Linux.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU16"
HREF="#X-087-2-FNUU16"
><SPAN
CLASS="footnote"
>[103]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>This option is not present in Version 1.04.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUU17"
HREF="#X-087-2-FNUU17"
><SPAN
CLASS="footnote"
>[104]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> That is, files with names beginning with a
dot. Such files aren't normally displayed by the <B
CLASS="COMMAND"
>ls</B
>
command.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNMA01"
HREF="#X-087-2-FNMA01"
><SPAN
CLASS="footnote"
>[105]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Read RFC-1437 if you don't believe this statement!  </P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNMA02"
HREF="#X-087-2-FNMA02"
><SPAN
CLASS="footnote"
>[106]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Guylhem can be reached at
<SPAN
CLASS="SYSTEMITEM"
>guylhem@danmark.linux.eu.org</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNMA03"
HREF="#X-087-2-FNMA03"
><SPAN
CLASS="footnote"
>[107]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>It is customary to append a <EM
>signature</EM
> or
<TT
CLASS="FILENAME"
>.sig</TT
> to a mail message, usually containing information
on the author along with a joke or a motto. It is offset from the mail
message by a line containing &#8220;<TT
CLASS="LITERAL"
>--</TT
>&#8221; followed
by a space.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNMA04"
HREF="#X-087-2-FNMA04"
><SPAN
CLASS="footnote"
>[108]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>This is because disk space is usually allocated in blocks of 1,024 bytes. So
even a message of a few dozen bytes will eat a full kilobyte.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNMA05"
HREF="#X-087-2-FNMA05"
><SPAN
CLASS="footnote"
>[109]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> When trying to reach a DECnet address from
an RFC-822 environment, you can use <SPAN
CLASS="SYSTEMITEM"
>&#8220;host::user"@relay</SPAN
>, for which 
<SPAN
CLASS="SYSTEMITEM"
>relay</SPAN
> is the name of a known
Internet-DECnet relay.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNMA06"
HREF="#X-087-2-FNMA06"
><SPAN
CLASS="footnote"
>[110]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Maps for sites registered with the UUCP Mapping Project are distributed
through the newsgroup <SPAN
CLASS="SYSTEMITEM"
>comp.mail.maps</SPAN
>&#8201;;
other organizations may publish separate maps for their networks.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNMA07"
HREF="#X-087-2-FNMA07"
><SPAN
CLASS="footnote"
>[111]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>They are posted regularly in
<SPAN
CLASS="SYSTEMITEM"
>news.lists.ps-maps</SPAN
>.
Beware. They're HUGE.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNSD01"
HREF="#X-087-2-FNSD01"
><SPAN
CLASS="footnote"
>[112]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The Free On-Line 
Dictionary of Computing can be found packaged in many Linux
distributions, or online at its home page at
<SPAN
CLASS="SYSTEMITEM"
>http://wombat.doc.ic.ac.uk/foldoc/</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNEX01"
HREF="#X-087-2-FNEX01"
><SPAN
CLASS="footnote"
>[113]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Other possible locations are
<TT
CLASS="FILENAME"
>/etc/rc.d/init.d</TT
> and
<TT
CLASS="FILENAME"
>rc.inet2</TT
>. The latter is common on systems
using a BSD-style structure for system administration files in the
<TT
CLASS="FILENAME"
>/etc</TT
> directory.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNEX02"
HREF="#X-087-2-FNEX02"
><SPAN
CLASS="footnote"
>[114]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>This is the new standard location of <B
CLASS="COMMAND"
>sendmail</B
> according to
the Linux File System Standard. Another common location is
<TT
CLASS="FILENAME"
>/usr/lib/sendmail</TT
>, which is likely to be used by mail
programs that are not specially configured for Linux.
You can define both filenames as symbolic links to
Exim so that programs and scripts invoking <EM
>sendmail</EM
> will instead
invoke Exim to do the same things.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNEX03"
HREF="#X-087-2-FNEX03"
><SPAN
CLASS="footnote"
>[115]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Some user agents, however, use the SMTP protocol to pass messages to the 
transport agent, calling it with the <CODE
CLASS="OPTION"
>&#8211;bs</CODE
> option.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNEX04"
HREF="#X-087-2-FNEX04"
><SPAN
CLASS="footnote"
>[116]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Use <TT
CLASS="LITERAL"
>kill HUP</TT
> <TT
CLASS="REPLACEABLE"
><I
>pid,</I
></TT
> for which <TT
CLASS="REPLACEABLE"
><I
>pid</I
></TT
> is the process ID of the <B
CLASS="COMMAND"
>inetd</B
> process retrieved from a 
<B
CLASS="COMMAND"
>ps</B
> listing.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN16104"
HREF="#AEN16104"
><SPAN
CLASS="footnote"
>[117]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The system load is a standard Unix measure of the
average number of processes that are queued up, waiting to run. The
<B
CLASS="COMMAND"
>uptime</B
> shows load averages taken over the previous
1, 5, and 15 minutes.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNEX05"
HREF="#X-087-2-FNEX05"
><SPAN
CLASS="footnote"
>[118]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> This is a simplification. It is possible
for directors to pass addresses to transports that deliver to remote
hosts, and similarly, it is possible for routers to pass addresses to
local transports that write the messsage to a file or a pipe. It is
also possible for routers to pass addresses to the directors in some
circumstances.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN16286"
HREF="#AEN16286"
><SPAN
CLASS="footnote"
>[119]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>A director is skipped if the address it is about to process is one that 
it has previously processed in the course of generating the present 
address.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNEX07"
HREF="#X-087-2-FNEX07"
><SPAN
CLASS="footnote"
>[120]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Please, if you choose to use a vacation program, make sure it will not reply
to messages sent from mailing lists! It is very annoying to discover that
someone has gone on vacation and find a vacation message for every message
they've received. Mailing list administrators: this is a good example of why it
is bad practice to force the <TT
CLASS="LITERAL"
>Reply-To:</TT
> field of mailing list
messages to that of the list submission address.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUN01"
HREF="#X-087-2-FNUN01"
><SPAN
CLASS="footnote"
>[121]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> The format of Usenet news messages is
specified in RFC-1036, &#8220;Standard for interchange of USENET
messages.&#8221;</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUN02"
HREF="#X-087-2-FNUN02"
><SPAN
CLASS="footnote"
>[122]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Wait a minute: 60
Megs at 9,600 bps, that's 60 million multiplied by 1,024, that
is&#8230; mutter, mutter&#8230; Hey! That's 34 hours!</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNUN03"
HREF="#X-087-2-FNUN03"
><SPAN
CLASS="footnote"
>[123]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Some people claim that Usenet is a conspiracy by modem and hard disk vendors.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNCN01"
HREF="#X-087-2-FNCN01"
><SPAN
CLASS="footnote"
>[124]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> There may be a difference
between the groups that exist at your site and those that your site
is willing to receive. For example, the subscription list might
specify <SPAN
CLASS="SYSTEMITEM"
>comp.all</SPAN
>, which
should send all newsgroups below the <SPAN
CLASS="SYSTEMITEM"
>comp</SPAN
> hierarchy, but at your site you
might not list several of the <SPAN
CLASS="SYSTEMITEM"
>comp</SPAN
> newsgroups in the
<TT
CLASS="FILENAME"
>active</TT
> file. Articles posted to those groups will
be moved to <SPAN
CLASS="SYSTEMITEM"
>junk</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNCN02"
HREF="#X-087-2-FNCN02"
><SPAN
CLASS="footnote"
>[125]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Note that this should be the <B
CLASS="COMMAND"
>crontab</B
> of
<SPAN
CLASS="SYSTEMITEM"
>news</SPAN
>; file permissions will not be 
mangled.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNCN03"
HREF="#X-087-2-FNCN03"
><SPAN
CLASS="footnote"
>[126]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>You can obtain the C News source distribution from its home site at
<SPAN
CLASS="SYSTEMITEM"
>ftp.cs.toronto.edu</SPAN
>
<TT
CLASS="FILENAME"
>/pub/c-news/c-news.tar.Z</TT
></P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNCN04"
HREF="#X-087-2-FNCN04"
><SPAN
CLASS="footnote"
>[127]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> It is not uncommon
for an article posted in say, Hamburg, to go to Frankfurt via
<SPAN
CLASS="SYSTEMITEM"
>reston.ans.net</SPAN
> in the
Netherlands, or even via some site in the U.S.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNCN06"
HREF="#X-087-2-FNCN06"
><SPAN
CLASS="footnote"
>[128]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> As shipped with
C News, <SPAN
CLASS="SYSTEMITEM"
>compcun</SPAN
> uses
<SPAN
CLASS="SYSTEMITEM"
>compress</SPAN
> with the 12-bit
option, since this is the lowest common denominator for most
sites. You may produce a copy of the script, say <SPAN
CLASS="SYSTEMITEM"
>compcun16</SPAN
>, for which you use 16-bit
compression. The improvement is not too impressive, though.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNCN07"
HREF="#X-087-2-FNCN07"
><SPAN
CLASS="footnote"
>[129]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The article's date of arrival is kept in the middle field of the history
line and given in seconds since January 1, 1970.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNCN08"
HREF="#X-087-2-FNCN08"
><SPAN
CLASS="footnote"
>[130]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>I don't know <EM
>why</EM
> this happens, but it does from
time to time.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNCN09"
HREF="#X-087-2-FNCN09"
><SPAN
CLASS="footnote"
>[131]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>I wouldn't try this on the Internet, either.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNN01"
HREF="#X-087-2-FNNN01"
><SPAN
CLASS="footnote"
>[132]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> When posting an 
article over NNTP, the server always adds at least one header field, <TT
CLASS="LITERAL"
>NNTP-Posting-Host:</TT
>. The field contains the client's hostname.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNN02"
HREF="#X-087-2-FNNN02"
><SPAN
CLASS="footnote"
>[133]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The same problem exists with the Simple Mail Transfer Protocol (SMTP), although
most mail transport agents now provide mechanisms to prevent spoofing.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNN03"
HREF="#X-087-2-FNNN03"
><SPAN
CLASS="footnote"
>[134]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
><EM
>leafnode</EM
> is available by anonymous FTP from
<EM
>wpxx02.toxi.uni-wuerzburg.de</EM
>
in the <TT
CLASS="FILENAME"
>/pub/</TT
> directory.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNIN01"
HREF="#X-087-2-FNIN01"
><SPAN
CLASS="footnote"
>[135]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Very
small news sites should consider a caching NNTP server program like
<B
CLASS="COMMAND"
>leafnode</B
>, which is available at <SPAN
CLASS="SYSTEMITEM"
>http://wpxx02.toxi.uni-wuerzburg.de/~krasel/leafnode.html.</SPAN
></P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN18328"
HREF="#AEN18328"
><SPAN
CLASS="footnote"
>[136]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> This is
indicated by the <TT
CLASS="REPLACEABLE"
><I
>Date:</I
></TT
> header field; the limit is
usually two weeks.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN18357"
HREF="#AEN18357"
><SPAN
CLASS="footnote"
>[137]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Threading 1,000 articles when talking to a loaded
server could easily take around five minutes, which only the most
dedicated Usenet addict would find acceptable.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN18380"
HREF="#AEN18380"
><SPAN
CLASS="footnote"
>[138]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> The name apparently stands for NetNews Read
&#38; Post Daemon.  </P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN19080"
HREF="#AEN19080"
><SPAN
CLASS="footnote"
>[139]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>PGP and GPG are tools designed to authenticate or encrypt messages using
public key techniques. GPG is the GNU free version of PGP. GPG may be found
at <SPAN
CLASS="SYSTEMITEM"
>http://www.gnupg.org/</SPAN
>, and PGP may be
found at <SPAN
CLASS="SYSTEMITEM"
>http://www.pgp.com/</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNR01"
HREF="#X-087-2-FNNR01"
><SPAN
CLASS="footnote"
>[140]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Things improve drastically if the NNTP server does the threading itself and
lets the client retrieve the threads databases; INN does this, for instance.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNR03"
HREF="#X-087-2-FNNR03"
><SPAN
CLASS="footnote"
>[141]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>This is the reason why you will get ugly error messages when invoking 
<B
CLASS="COMMAND"
>tin</B
> as superuser. But you shouldn't do routine work as
<SPAN
CLASS="SYSTEMITEM"
>root</SPAN
>, anyway.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNR04"
HREF="#X-087-2-FNNR04"
><SPAN
CLASS="footnote"
>[142]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Note that C News (described in <A
HREF="#X-087-2-CNEWS"
>Chapter 21</A
>) doesn't update
this low-water mark automatically; you have to run <B
CLASS="COMMAND"
>updatemin</B
>
to do so. </P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNNR05"
HREF="#X-087-2-FNNR05"
><SPAN
CLASS="footnote"
>[143]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Their order has to agree with that of the entries in the
(binary) <TT
CLASS="FILENAME"
>MASTER</TT
> file.</P
></TD
></TR
></TABLE
></BODY
></HTML
>