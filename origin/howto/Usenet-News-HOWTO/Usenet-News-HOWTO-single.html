<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Usenet News HOWTO </TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
>Usenet News HOWTO</A
></H1
><DIV
CLASS="AUTHORGROUP"
><A
NAME="AEN4"
></A
><H3
CLASS="AUTHOR"
><A
NAME="AEN5"
>Shuvam Misra                 (usenet at starcomsoftware dot com)
                </A
></H3
></DIV
><DIV
CLASS="REVHISTORY"
><TABLE
WIDTH="100%"
BORDER="0"
><TR
><TH
ALIGN="LEFT"
VALIGN="TOP"
COLSPAN="3"
><B
>Revision History</B
></TH
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 2.1</TD
><TD
ALIGN="LEFT"
>2002-08-20</TD
><TD
ALIGN="LEFT"
>Revised by: sm</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>New sections on Security and Software History,
		    lots of other small additions and cleanup</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 2.0</TD
><TD
ALIGN="LEFT"
>2002-07-30</TD
><TD
ALIGN="LEFT"
>Revised by: sm</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Rewritten by new authors at Starcom Software</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 1.4</TD
><TD
ALIGN="LEFT"
>1995-11-29</TD
><TD
ALIGN="LEFT"
>Revised by: vs</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Original document; authored by Vince Skahan.</TD
></TR
></TABLE
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
>1. <A
HREF="#AEN26"
>What is the Usenet?</A
></DT
><DD
><DL
><DT
>1.1. <A
HREF="#AEN28"
>Discussion groups</A
></DT
><DT
>1.2. <A
HREF="#AEN37"
>How it works, loosely speaking</A
></DT
><DT
>1.3. <A
HREF="#AEN45"
>About sizes, volumes, and so on</A
></DT
></DL
></DD
><DT
>2. <A
HREF="#AEN63"
>Principles of Operation</A
></DT
><DD
><DL
><DT
>2.1. <A
HREF="#AEN66"
>Newsgroups and articles</A
></DT
><DT
>2.2. <A
HREF="#AEN106"
>Of readers and servers</A
></DT
><DT
>2.3. <A
HREF="#AEN127"
>Newsfeeds</A
></DT
><DT
>2.4. <A
HREF="#CONTROLMSG"
>Control messages</A
></DT
></DL
></DD
><DT
>3. <A
HREF="#AEN247"
>Usenet news software</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="#AEN249"
>A brief history of Usenet systems</A
></DT
><DT
>3.2. <A
HREF="#AEN254"
>C-News and NNTPd</A
></DT
><DT
>3.3. <A
HREF="#AEN272"
>INN</A
></DT
><DT
>3.4. <A
HREF="#AEN280"
>Leafnode</A
></DT
><DT
>3.5. <A
HREF="#AEN291"
>Suck</A
></DT
><DT
>3.6. <A
HREF="#AEN301"
>Carrier class software</A
></DT
></DL
></DD
><DT
>4. <A
HREF="#SETTINGUP"
>Setting up CNews + NNTPd</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="#AEN313"
>Getting the sources and stuff</A
></DT
><DT
>4.2. <A
HREF="#AEN357"
>Compiling and installing</A
></DT
><DT
>4.3. <A
HREF="#CONFIGURESYSTEM"
>Configuring the system: What and how to configure files?</A
></DT
><DT
>4.4. <A
HREF="#AEN589"
>Testing the system</A
></DT
><DT
>4.5. <A
HREF="#AEN611"
><TT
CLASS="LITERAL"
>pgpverify</TT
> and <TT
CLASS="LITERAL"
>controlperms</TT
></A
></DT
><DT
>4.6. <A
HREF="#AEN628"
>Feeding off an upstream neighbour</A
></DT
><DT
>4.7. <A
HREF="#AEN637"
>Configuring outgoing feeds</A
></DT
></DL
></DD
><DT
>5. <A
HREF="#AEN686"
>Setting up INN</A
></DT
><DD
><DL
><DT
>5.1. <A
HREF="#AEN688"
>Getting the source</A
></DT
><DT
>5.2. <A
HREF="#AEN694"
>Compiling and installing</A
></DT
><DT
>5.3. <A
HREF="#AEN697"
>Configuring the system</A
></DT
><DT
>5.4. <A
HREF="#AEN700"
>Setting up <TT
CLASS="LITERAL"
>pgpverify</TT
></A
></DT
><DT
>5.5. <A
HREF="#AEN704"
>Feeding off an upstream neighbour</A
></DT
><DT
>5.6. <A
HREF="#AEN707"
>Setting up outgoing feeds</A
></DT
><DT
>5.7. <A
HREF="#INNEFFICIENCY"
>Efficiency issues and advantages</A
></DT
></DL
></DD
><DT
>6. <A
HREF="#AEN713"
>Connecting email with Usenet news</A
></DT
><DD
><DL
><DT
>6.1. <A
HREF="#AEN719"
>Feeding Usenet news to email</A
></DT
><DT
>6.2. <A
HREF="#AEN725"
>Feeding email to news: the <TT
CLASS="LITERAL"
>mail2news gateway</TT
></A
></DT
><DT
>6.3. <A
HREF="#AEN745"
>Using GNU Mailman as an email-NNTP gateway</A
></DT
></DL
></DD
><DT
>7. <A
HREF="#AEN757"
>Security issues</A
></DT
><DD
><DL
><DT
>7.1. <A
HREF="#AEN762"
>Intrusion threats</A
></DT
><DT
>7.2. <A
HREF="#AEN788"
>Vulnerabilities unique to the Usenet service</A
></DT
></DL
></DD
><DT
>8. <A
HREF="#AEN817"
>Access control in NNTPd</A
></DT
><DD
><DL
><DT
>8.1. <A
HREF="#AEN822"
>Host-based access control</A
></DT
><DT
>8.2. <A
HREF="#AEN825"
>User authentication and authorisation</A
></DT
></DL
></DD
><DT
>9. <A
HREF="#COMPONENT"
>Components of a running system</A
></DT
><DD
><DL
><DT
>9.1. <A
HREF="#AEN843"
><TT
CLASS="LITERAL"
>/var/lib/news</TT
>: the CNews control area</A
></DT
><DT
>9.2. <A
HREF="#AEN916"
><TT
CLASS="LITERAL"
>/var/spool/news</TT
>: the article repository</A
></DT
><DT
>9.3. <A
HREF="#AEN962"
><TT
CLASS="LITERAL"
>/usr/lib/newsbin</TT
>: the executables</A
></DT
><DT
>9.4. <A
HREF="#CRONJOBS"
><TT
CLASS="LITERAL"
>crontab and cron jobs </TT
></A
></DT
><DT
>9.5. <A
HREF="#AEN999"
><TT
CLASS="LITERAL"
>newsrun</TT
> and <TT
CLASS="LITERAL"
>relaynews</TT
>: digesting received articles</A
></DT
><DT
>9.6. <A
HREF="#AEN1016"
><TT
CLASS="LITERAL"
>doexpire</TT
> and <TT
CLASS="LITERAL"
>expire</TT
>: removing old articles</A
></DT
><DT
>9.7. <A
HREF="#AEN1030"
><TT
CLASS="LITERAL"
>nntpd</TT
> and <TT
CLASS="LITERAL"
>msgidd</TT
>: managing the NNTP interface</A
></DT
><DT
>9.8. <A
HREF="#AEN1071"
><TT
CLASS="LITERAL"
>nov</TT
>, the News Overview system</A
></DT
><DT
>9.9. <A
HREF="#AEN1090"
>Batching feeds with UUCP and NNTP</A
></DT
></DL
></DD
><DT
>10. <A
HREF="#AEN1093"
>Monitoring and administration</A
></DT
><DD
><DL
><DT
>10.1. <A
HREF="#AEN1096"
>The <TT
CLASS="LITERAL"
>newsdaily</TT
> report</A
></DT
><DT
>10.2. <A
HREF="#AEN1145"
>Crisis reports from <TT
CLASS="LITERAL"
>newswatch</TT
></A
></DT
><DT
>10.3. <A
HREF="#AEN1152"
>Disk space</A
></DT
><DT
>10.4. <A
HREF="#AEN1163"
>CPU load and RAM usage</A
></DT
><DT
>10.5. <A
HREF="#AEN1175"
>The <TT
CLASS="LITERAL"
>in.coming/bad</TT
> directory</A
></DT
><DT
>10.6. <A
HREF="#AEN1186"
>Long pending queues in <TT
CLASS="LITERAL"
>out.going</TT
></A
></DT
><DT
>10.7. <A
HREF="#AEN1190"
>Problems with <TT
CLASS="LITERAL"
>nntpxmit</TT
> and <TT
CLASS="LITERAL"
>nntpsend</TT
></A
></DT
><DT
>10.8. <A
HREF="#AEN1195"
>The <TT
CLASS="LITERAL"
>junk</TT
> and <TT
CLASS="LITERAL"
>control</TT
> groups</A
></DT
></DL
></DD
><DT
>11. <A
HREF="#AEN1207"
>Usenet news clients</A
></DT
><DD
><DL
><DT
>11.1. <A
HREF="#AEN1219"
>Usenet User Agents</A
></DT
><DT
>11.2. <A
HREF="#AEN1230"
>Clients that transfer articles</A
></DT
><DT
>11.3. <A
HREF="#AEN1234"
>Special clients</A
></DT
></DL
></DD
><DT
>12. <A
HREF="#AEN1242"
>Our perspective</A
></DT
><DD
><DL
><DT
>12.1. <A
HREF="#FEEDEFFICIENCY"
>Efficiency issues of NNTP</A
></DT
><DT
>12.2. <A
HREF="#AEN1298"
>C-News+NNTPd or INN?</A
></DT
></DL
></DD
><DT
>13. <A
HREF="#SOFTWAREHISTORY"
>Usenet software: a historical perspective</A
></DT
><DD
><DL
><DT
>13.1. <A
HREF="#AEN1321"
>The quoted excerpts</A
></DT
></DL
></DD
><DT
>14. <A
HREF="#AEN1413"
>Documentation, information and further reading</A
></DT
><DD
><DL
><DT
>14.1. <A
HREF="#AEN1416"
>The manpages</A
></DT
><DT
>14.2. <A
HREF="#AEN1508"
>Papers, documents, articles</A
></DT
><DT
>14.3. <A
HREF="#AEN1537"
>O'Reilly's books on Usenet news</A
></DT
><DT
>14.4. <A
HREF="#AEN1542"
>Usenet-related RFCs</A
></DT
><DT
>14.5. <A
HREF="#AEN1545"
>The source code</A
></DT
><DT
>14.6. <A
HREF="#AEN1548"
>Usenet newsgroups</A
></DT
><DT
>14.7. <A
HREF="#AEN1562"
>We</A
></DT
></DL
></DD
><DT
>15. <A
HREF="#AEN1585"
>Wrapping up</A
></DT
><DD
><DL
><DT
>15.1. <A
HREF="#AEN1587"
>Acknowledgements</A
></DT
><DT
>15.2. <A
HREF="#AEN1594"
>Comments invited</A
></DT
><DT
>15.3. <A
HREF="#AEN1597"
>Copyright</A
></DT
><DT
>15.4. <A
HREF="#AEN1611"
>About Starcom Software Private Limited</A
></DT
></DL
></DD
></DL
></DIV
><DIV
CLASS="SECTION"
><H2
CLASS="SECTION"
><A
NAME="AEN26"
>1. What is the Usenet?</A
></H2
><DIV
CLASS="SECTION"
><H3
CLASS="SECTION"
><A
NAME="AEN28"
>1.1. Discussion groups</A
></H3
><P
>The Usenet is a huge worldwide collection of discussion
groups. Each discussion group has a name, <EM
>e.g.</EM
>
<TT
CLASS="LITERAL"
>comp.os.linux.announce</TT
>, and a collection of messages.
These messages, usually called <EM
>articles</EM
>, are posted
by readers like you and me who have access to Usenet servers, and are
then stored on the Usenet servers.</P
><P
>This ability to both read and write into a Usenet newsgroup makes
the Usenet very different from the bulk of what people today call ``the
Internet.'' The Internet has become a colloquial term to refer to the
World Wide Web, and the Web is (largely) read-only. There are online
discussion groups with Web interfaces, and there are mailing lists, but
Usenet is probably more convenient than either of these for most large
discussion communities. This is because the articles get replicated to
your local Usenet server, thus allowing you to read and post articles
without accessing the global Internet, something which is of great value
for those with slow Internet links. Usenet articles also conserve
bandwidth because they do not come and sit in each member's mailbox, unlike 
email
based mailing lists. This way, twenty members of a mailing list in one
office will have twenty copies of each message copied to their
mailboxes. However, with a Usenet discussion group and a local Usenet
server, there's just one copy of each article, and it does not fill up
anyone's mailbox.</P
><P
>Another nice feature of having your own local Usenet server is
that articles stay on the server even after you've read them. You can't
accidentally delete a Usenet articles the way you can delete a message
from your mailbox. This way, a Usenet server is an
<EM
>excellent</EM
> way to archive articles of a group
discussion on a local server without placing the onus of archiving on
any group member. This makes local Usenet servers very valuable as
archives of internal discussion messages within corporate Intranets,
provided the article expiry configuration of the Usenet server software
has been set up for sufficiently long expiry periods.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN37"
>1.2. How it works, loosely speaking</A
></H3
><P
> Usenet news works by the reader first firing up a Usenet news
program, which in today's GUI world will highly likely be something like
Netscape Messenger or Microsoft's Outlook Express. There are a lot of
proven, well-designed character-based Usenet news readers, but a proper
review of the user agent software is outside the scope of this HOWTO, so
we will just assume that you are using whatever software you like. The
reader then selects a Usenet newsgroup from the hundreds or thousands of
newsgroups which are hosted by her local server, and accesses all unread
articles. These articles are displayed to her. She can then decide to
respond to some of them.</P
><P
>When the reader writes an article, either in response to an
existing one or as a start of a brand-new thread of discussion, her
software <EM
>posts</EM
> this article to the Usenet server.
The article contains a list of newsgroups into which it is to be posted.
Once it is accepted by the server, it becomes available for other users
to read and respond to. The article is automatically
<EM
>expired</EM
> or deleted by the server from its internal
archives based on expiry policies set in its software; the author of the
article usually can do little or nothing to control the expiry of her
articles.</P
><P
>A Usenet server rarely works on its own. It forms a part of
a collection of servers, which automatically exchange articles with
each other. The flow of articles from one server to another is called a
<EM
>newsfeed</EM
>. In a simplistic case, one can imagine a
worldwide network of servers, all configured to replicate articles with
each other, busily passing along copies across the network as soon as one
of them receives a new articles posted by a human reader. This replication
is done by powerful and fault-tolerant processes, and gives the Usenet
network its power. Your local Usenet server literally has a copy of all
current articles in all relevant newsgroups.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN45"
>1.3. About sizes, volumes, and so on</A
></H3
><P
>Any would-be Usenet server administrator or creator
<EM
>must</EM
> read the <SPAN
CLASS="QUOTE"
>"Periodic Posting about the basic steps
involved in configuring a machine to store Usenet news,"</SPAN
> also known as
the Site Setup FAQ, available from
<TT
CLASS="LITERAL"
>ftp://rtfm.mit.edu/pub/usenet/news.answers/usenet/site-setup</TT
>
or
<TT
CLASS="LITERAL"
>ftp://ftp.uu.net/usenet/news.answers/news/site-setup.Z</TT
>.
It was last updated in 1997, but trends haven't changed much since
then, though absolute volume figures have.</P
><P
>If you want your Usenet server to be a repository for all articles
in all newsgroups, you will probably not be reading this HOWTO, or even
if you do, you will rapidly realise that anyone who needs to read this
HOWTO may not be ready to set up such a server. This is because the
volumes of articles on the Usenet have reached a point where very
specialised networks, very high end servers, and large disk arrays
are required for handling such Usenet volumes. Those setups are called
``carrier-class'' Usenet servers, and will be discussed a bit later on in
this HOWTO. Administering such an array of hardware may not be the job
of the new Usenet administrator, for which this HOWTO (and most Linux
HOWTO's) are written.</P
><P
>Nevertheless, it may be interesting to understand what volumes we
are talking about. Usenet news article volumes have been doubling every
fourteen months or so, going by what we hear in comments from
carrier class Usenet administrators. In the beginning of 1997, this
volume was 1.2 GBytes of articles a day. Thus, the volumes should have
roughly done five doublings, or grown 32 times, by the time we reach
mid-2002, at the time of this writing. This gives us a volume of 38.4
GBytes per day. Assume that this transfer happens using uncompressed
NNTP (the norm), and add 50% extra for the overheads of NNTP, TCP,
and IP. This gives you a raw data transfer volume of 57.6 GBytes/day or
about 460 Gbits/day. If you have to transfer such volumes of data in 24
hours (86400 seconds), you'll need raw bandwidth of about 5.3 Mbits per
second just to <EM
>receive all these articles</EM
>. You'll
need more bandwidth to send out feeds to other neighbouring Usenet
servers, and then you'll need bandwidth to allow your readers to access
your servers and read and post articles in retail quantities. Clearly,
these volume figures are outside the network bandwidths of most
corporate organisations or educational institutions, and therefore only
those who are in the business of offering Usenet news can afford
it.</P
><P
>At the other end of the scale, it is perfectly feasible for a
small office to subscribe to a well-trimmed subset of Usenet newsgroups,
and exclude most of the high-volume newsgroups.  Starcom Software, where
the authors of this HOWTO work, has worked with a fairly large subset of
600 newsgroups, which is still a tiny fraction of the 15,000+ newsgroups
that the carrier class services offer. Your office or college may not
even need 600 groups. And our company had excluded specific high-volume
but low-usefulness newsgroups like the <TT
CLASS="LITERAL"
>talk</TT
>,
<TT
CLASS="LITERAL"
>comp.binaries</TT
>, and <TT
CLASS="LITERAL"
>alt</TT
>
hierarchies. With the pruned subset, the total volume of articles per
day may amount to barely a hundred MBytes a day or so, and can be easily
handled by most small offices and educational institutions. And in such
situations, a single Intel Linux server can deliver excellent performance
as a Usenet server.</P
><P
>Then there's the <EM
>internal</EM
> Usenet service. By
internal here, we mean a private set of Usenet newsgroups, not a private
computer network. Every company or university which runs a Usenet news
service creates its own hierarchy of internal newsgroups, whose articles
never leave the campus or office, and which therefore do not consume
Internet bandwidth. These newsgroups are often the ones most hotly
accessed, and will carry more <EM
>internally generated</EM
>
traffic than all the ``public'' newsgroups you may subscribe to, within your
organisation.  After all, how often does a guy have something to say
which is relevant to the world at large, unless he's discussing a globally
relevant topic like ``Unix rules!''? If such internal newsgroups are the
focus of your Usenet servers, then you may find that fairly modest
hardware and Internet bandwidth will suffice, depending on the size of
your organisation.</P
><P
>The new Usenet server administrator has to undertake a sizing
exercise to ensure that he does not bite off more than he, or his
network resources, can chew. We hope we have provided sufficient
information for him to get started with the right questions.</P
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H2
CLASS="SECTION"
><A
NAME="AEN63"
>2. Principles of Operation</A
></H2
><P
>Here we discuss the basic concepts behind the operation of a Usenet news
system.</P
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN66"
>2.1. Newsgroups and articles</A
></H3
><P
>A Usenet news article sits in a file or in some other on-disk
data structure on the disks of a Usenet server, and its contents look
like this:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>Xref: news.starcomsoftware.com starcom.tech.misc:211 starcom.tech.security:452
Newsgroups: starcom.tech.misc,starcom.tech.security
Path: news.starcomsoftware.com!purva!shuvam
From: Shuvam &#60;shuvam@starcomsoftware.com&#62;
Subject: "You just throw up your hands and reboot" (fwd)
Content-Type: TEXT/PLAIN; charset=US-ASCII 
Distribution: starcom
Organization: Starcom Software Pvt Ltd, India
Message-ID: &#60;Pine.LNX.4.31.0107022153490.30462-100000@starcomsoftware.com&#62;
Mime-Version: 1.0
Date: Mon, 2 Jul 2001 16:27:57 GMT

Interesting quote, and interesting article.

Incidentally, comp.risks may be an interesting newsgroup to follow. We
must be receiving the feed for this group on our server, since we
receive all groups under comp.*, unless specifically cancelled. Check it
out sometime.

comp.risks tracks risks in the use of computer technology, including
issues in protecting ourselves from failures of such stuff.

Shuvam

&#62; Date: Thu, 14 Jun 2001 08:11:00 -0400
&#62; From: "Chris Norloff" &#60;cnorloff@norloff.com&#62;
&#62; Subject: NYSE: "Throw up your hands and reboot"
&#62; 
&#62; When the New York Stock Exchange computer systems crashed for 85
&#62; minutes (8 Jun 2001), Andrew Brooks, chief of equity trading at
&#62; Baltimore mutual fund giant T. Rowe Price, was quoted as saying "Hey,
&#62; we're all subject to the vagaries of technology. It happens on your
&#62; own PC at home. You just throw up your hands and reboot."
&#62; 
&#62; http://www.washingtonpost.com/ac3/ContentServer?articleid=A42885-2001Jun8&#38;pagename=article
&#62; 
&#62; Chris Norloff
&#62; 
&#62; 
&#62; This is from --
&#62; 
&#62; From: risko@csl.sri.com (RISKS List Owner)
&#62; Newsgroups: comp.risks
&#62; Subject: Risks Digest 21.48
&#62; Date: Mon, 18 Jun 2001 19:14:57 +0000 (UTC)
&#62; Organization: University of California, Berkeley
&#62; 
&#62; RISKS-LIST: Risks-Forum Digest  Monday 19 June 2001
&#62; Volume 21 : Issue 48
&#62; 
&#62;    FORUM ON RISKS TO THE PUBLIC IN COMPUTERS AND RELATED SYSTEMS (comp.risks)
&#62;    ACM Committee on Computers and Public Policy,
&#62;    Peter G. Neumann, moderator
&#62; 
&#62; This issue is archived at &#60;URL:http://catless.ncl.ac.uk/Risks/21.48.html&#62;
&#62; and by anonymous ftp at ftp.sri.com, cd risks .
&#62; </PRE
></FONT
></TD
></TR
></TABLE
><P
>A Usenet article's header is very interesting if you want to learn
about the functioning of the Usenet. The <TT
CLASS="LITERAL"
>From</TT
>,
<TT
CLASS="LITERAL"
>Subject</TT
>, and <TT
CLASS="LITERAL"
>Date</TT
> headers are
familiar to anyone who has used email. The <TT
CLASS="LITERAL"
>Message-ID</TT
>
header contains a unique ID for each message, and is present in each
email message, though not many non-technical email users know about it.
The <TT
CLASS="LITERAL"
>Content-Type</TT
> and <TT
CLASS="LITERAL"
>Mime-Version</TT
>
headers are used for MIME encoding of articles, attaching files and
other attachments, and so on, just like in email messages.</P
><P
>The <TT
CLASS="LITERAL"
>Organisation</TT
> header is an informational header
which is supposed to carry some information identifying the organisation
to which the author of the article belongs. What remains now are the
<TT
CLASS="LITERAL"
>Newsgroups</TT
>, <TT
CLASS="LITERAL"
>Xref</TT
>,
<TT
CLASS="LITERAL"
>Path</TT
> and <TT
CLASS="LITERAL"
>Distributions</TT
> headers.
These are special to Usenet articles and are very important.</P
><P
>The <TT
CLASS="LITERAL"
>Newsgroups</TT
> header specifies which newsgroups
this article should belong to. The <TT
CLASS="LITERAL"
>Distributions</TT
>
header, sadly under-utilised in today's globalised Internet world,
allows the author of an article to specify how far the article will be
re-transmitted. The author of an article, working in conjunction with
well-configured networks of Usenet servers, can control the ``radius'' of
replication of his article, thus posting an article of local significance
into a newsgroup but setting the <TT
CLASS="LITERAL"
>Distribution</TT
> header to
some suitable setting, <EM
>e.g.</EM
> <TT
CLASS="LITERAL"
>local</TT
>
or <TT
CLASS="LITERAL"
>starcom</TT
>, to prevent the article from being relayed
to servers outside the specified domain.</P
><P
>The <TT
CLASS="LITERAL"
>Xref</TT
> header specifies the precise
<STRONG
>article number</STRONG
> of this article in each of the
newsgroups in which it is inserted, for the current server. When an
article is copied from one server to another as part of a newsfeed,
the receiving server throws away the old <TT
CLASS="LITERAL"
>Xref</TT
> header
and inserts its own, with its own article numbers. This indicates an
interesting feature of the Usenet system: each article in a Usenet server
has a unique number (an integer) for each newsgroup it is a part of.
Our sample above has been added to two newsgroups on our server, and has
the article numbers 211 and 452 in those groups. Therefore, any Usenet
client software can query our server and ask for article number 211 in
the newsgroup <TT
CLASS="LITERAL"
>starcom.tech.misc</TT
> and get this article.
Asking for article number 452 in <TT
CLASS="LITERAL"
>starcom.tech.security</TT
>
will fetch the article too. On another server, the numbers may be very
different.</P
><P
>The <TT
CLASS="LITERAL"
>Path</TT
> specifies the list of machines through
which this article has travelled before it has reached the current
server. UUCP-style syntax is used for this string. The current
example indicates that a user called <TT
CLASS="LITERAL"
>shuvam</TT
> first
wrote this article and posted it onto a computer which calls itself
<TT
CLASS="LITERAL"
>purva</TT
>, and this computer then transferred this article
by a newsfeed to <TT
CLASS="LITERAL"
>news.starcomsoftware.com</TT
>. The
<TT
CLASS="LITERAL"
>Path</TT
> header is critical for breaking loops in
newsfeeds, and will be discussed in detail later.</P
><P
>Our sample article will sit in the two newsgroups listed above
forever, unless expired. The Usenet software on a server is usually
configured to expire articles based on certain conditions,
<EM
>e.g.</EM
> after it's older than a certain number of
days. The C-News software we use allows expiry control based on the
newsgroup hierarchy and the type of newsgroup, <EM
>i.e.</EM
>
moderated or unmoderated. Against each class of newsgroups, it allows
the administrator to specify a number of days after which the article
will be expired. It is possible for an article to control its own
expiry, by carrying an <TT
CLASS="LITERAL"
>Expires</TT
> header specifying a
date and time. Unless overriden in the Usenet server software, the
article will be expired only after its explicit expiry time is
reached.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN106"
>2.2. Of readers and servers</A
></H3
><P
>Computers which access Usenet articles are broadly of two classes:
the readers and the servers. A Usenet server carries a repository of
articles, manages them, handles newsfeeds, and offers its repository to
authorised readers to read. A Usenet reader is merely a computer with
the appropriate software to allow a user to access a software, fetch
articles, post new articles, and keep track of which articles it has
read in each newsgroup. In terms of functionality, Usenet reading
software is less interesting to a Usenet administrator than a Usenet
server software. However, in terms of lines of code, the Usenet reader
software can often be much larger than Usenet server software, primarily
because of the complexities of modern GUI code.</P
><P
>Most modern computers almost exclusively access Usenet servers using
the NNTP (Network News Transfer Protocol) for reading and posting. This
protocol can also be used for inter-server communication, but those
aspects will be discussed later. The NNTP protocol, like any other
well-designed TCP-based Internet protocol, carries ASCII commands and
responses terminated with <TT
CLASS="LITERAL"
>CR-LF</TT
>, and comprises a
sequence of commands, somewhat reminiscent of the POP3 protocol for
email. Using NNTP, a Usenet reader program connects to a Usenet server,
asks for a list of active newsgroups, and receives this (often huge)
list. It then sets the ``current newsgroup'' to one of these, depending
on what the user wants to browse through. Having done this, it gets the
meta-data of all current articles in the group, including the author,
subject line, date, and size of each article, and displays an index of
articles to the user.</P
><P
>The user then scans through this list, selects an article, and
asks the reader to fetch it.  The reader gives the article number of
this article to the server, and fetches the full article for the user
to read through. Once the user finishes his NNTP session, he exits,
and the reader program closes the NNTP socket. It then (usually)
updates a local file in the user's home area, keeping track of which
news articles the user has read. These articles are typically not shown
to the user next time, thus allowing the user to progress rapidly to new
articles in each session. The reader software is helped along in this
endeavour by the <TT
CLASS="LITERAL"
>Xref</TT
> header, using which it knows
all the different identities by which a single article is identified
in the server. Thus, if you read the sample article given above by
accessing <TT
CLASS="LITERAL"
>starcom.tech.misc</TT
>, you'll never be shown
this article again when you access <TT
CLASS="LITERAL"
>starcom.tech.misc</TT
>
or <TT
CLASS="LITERAL"
>starcom.tech.security</TT
>; your reader software will
do this by tracking the <TT
CLASS="LITERAL"
>Xref</TT
> header and mapping
article numbers.</P
><P
>When a user posts an article, he first composes his message using
the user interface of his reader software. When he finally gives the
command to send the article, the reader software contacts the Usenet
server using the pre-existing NNTP connection and sends the article to
it. The article carries a <TT
CLASS="LITERAL"
>Newsgroups</TT
> header with the
list of newsgroups to post to, often a <TT
CLASS="LITERAL"
>Distribution</TT
>
header with a distribution specification, and other headers
like <TT
CLASS="LITERAL"
>From</TT
>, <TT
CLASS="LITERAL"
>Subject</TT
>
<EM
>etc.</EM
> These headers are used by the server
software to do the right thing. Special and rare headers like
<TT
CLASS="LITERAL"
>Expires</TT
> and <TT
CLASS="LITERAL"
>Approved</TT
> are acted upon
when present. The server assigns a new article number to the article for
each newsgroup it is posted to, and creates a new <TT
CLASS="LITERAL"
>Xref</TT
>
header for the article.</P
><P
>Transfer of articles between servers is done in various ways, and
is discussed in quite a bit of detail in Section XXX titled
``Newsfeeds'' below.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN127"
>2.3. Newsfeeds</A
></H3
><DIV
CLASS="SECTION"
><H4
CLASS="SECTION"
><A
NAME="AEN129"
>2.3.1. Fundamental concepts</A
></H4
><P
>When we try to analyse newsfeeds in real life, we begin to see
	that, for most sites, traffic flow is not symmetrical in both
	directions. We usually find that one server will feed the bulk
	of the world's articles to one or more secondary servers every
	day, and receive a few articles written by the users of those
	secondary servers in exchange. Thus, we usually find that
	articles flow down from the stem to the branches to the leaves
	of the worldwide Usenet server network, and not exactly in a totally
	balanced mesh flow pattern. Therefore, we use the term
	``upstream server'' to refer to the server from which we receive
	the bulk of our daily dose of articles, and ``downstream
	server'' to refer to those servers which receive the bulk dose
	of articles from us.</P
><P
>Newsfeeds relay articles from one server to their ``next door
	neighbour'' servers, metaphorically speaking. Therefore, articles
	move around the globe, not by a massive number of single-hop
	transfers from the originating server to every other server in
	the world, but in a sequence of hops, like passing the baton in
	a relay race.  This increases the latency time for an article
	to reach a remote tertiary server after, say, ten hops, but
	it allows tighter control of what gets relayed at every hop,
	and helps in redundancy, decentralisation of server loads,
	and conservation of network bandwidth. In this respect, Usenet
	newsfeeds are more complex than HTTP data flows, which
	typically use single-hop techniques.</P
><P
>Each Usenet news server therefore has to worry about
	newsfeeds each time it receives an article, either by a fresh post
	or from an incoming newsfeed. When the Usenet server digests this
	article and files it away in its repository, it simultaneously
	looks through its database to see which other server it should
	feed the article to. In order to do this, it carries out a
	sequence of checks, described below.</P
><P
>Each server knows which other servers are its ``next door
	neighbours;'' this information is kept in its newsfeed
	configuration information. Against each of its ``next door
	neighbours,'' there will be a list of newsgroups which it
	wants, and a list of distributions. The new article's list of
	newsgroups will be matched against the newsgroup list of the
	``next door neighbour'' to see whether there's even a single
	common newsgroup which makes it necessary to feed the article to
	it. If there's a matching newsgroup, and the server's distribution
	list matches the article's distribution, then the article is
	marked for feeding to this neighbour.</P
><P
>When the neighbour receives the article as part of the
	feed, it performs some sanity checks of its own. The first check
	it performs is on the <TT
CLASS="LITERAL"
>Newsgroups</TT
> header of
	the new article. If none of the newsgroups listed there are part
	of the active newsgroups list of this server, then the article
	can be rejected. An article rejected thus may even be queued for
	outgoing feeds to other servers, but will not be digested for
	incorporation into the local article repository.</P
><P
>The next check performed is against the
	<TT
CLASS="LITERAL"
>Path</TT
> header of the incoming article. If this
	header lists the name of the current Usenet server anywhere,
	it indicates that it has already passed through this server at
	least once before, and is now re-appearing here erroneously because
	of a newsfeed loop. Such loops are quite often configured into
	newsfeed topologies for redundancy: ``I'll get the articles from
	Server X if not Server Y, and may the first one in win.'' The
	Usenet server software automatically detects a duplicate feed
	of an article and rejects it.</P
><P
>The next check is against what is called the server's
	<EM
>history database</EM
>. Every Usenet server has
	a history database, which is a list of the message IDs of all
	current articles in the local repository. Oftentimes the history
	database also carries the message IDs of all messages recently
	expired. If the incoming article's message ID matches any of the
	entries in the database, then again it is rejected without being
	filed in the local repository. This is a second loop detection
	method. Sometimes, the mere checking of the article's
	<TT
CLASS="LITERAL"
>Path</TT
> header does not detection of all
	potential problems, because the problem may be a re-insertion
	instead of a loop. A re-insertion happens when the same incoming
	batch of news articles is re-fed into the local server, perhaps
	after recovering the system's data from tapes after a system
	crash. In such cases, there's no newsfeed loop, but there's
	still the risk that one article may be digested into the local
	server twice. The history database prevents this.</P
><P
>All these simple checks are very effective, and work
	across server and software types, as per the Internet standards.
	Together, they allow robust and fail-safe Usenet article flow
	across the world.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN143"
>2.3.2. Types of newsfeeds</A
></H4
><P
>This section explains the basics of newsfeeds, without getting 
	into details of software and configuration files.</P
><DIV
CLASS="SECTION"
><HR><H5
CLASS="SECTION"
><A
NAME="AEN146"
>2.3.2.1. Queued feeds</A
></H5
><P
>	    This is the commonest method of sending articles from one server
	    to another, and is followed whenever large volumes of articles 
	    are to be transferred per day. This approach needs a one-time 
	    modification to the upstream server's configuration for each 
	    outgoing feed, to define a new <EM
>queue.</EM
>
	</P
><P
>	    In essence all queued feeds work in the following way. When the 
	    sending server receives an article, it processes it for 
	    inclusion into its local repository, and also checks through all
	    its outgoing feed definitions to see whether the article needs 
	    to be queued for any of the feeds. If yes, it is added to a 
	    <EM
>queue file</EM
> for each outgoing feed. The
	    precise details
	    of the queue file can change depending on the software 
	    implementation, but the basic processes remain the same. A queue
	    file is a list of queued articles, but does not contain the
	    article contents. Typical queue files are ASCII text files with
	    one line per article giving the path to a copy of the article in
	    the local spool area.
	</P
><P
>	    Later, a separate process picks up each queue file and creates 
	    one or more <EM
>batches</EM
> for each outgoing feed.
	    A <EM
>batch</EM
> is a large file containing multiple
	    Usenet news 
	    articles. Once the batches are created, various transport 
	    mechanisms can be used to move the files from sending server to
	    receiving server. You can even use scripted FTP.  You only need
	    to ensure that the batch is picked up from the upstream server 
	    and somehow copied into a designated incoming batch directory in
	    the downstream server.
	</P
><P
>	    UUCP has traditionally been the mechanism of choice for batch 
	    movement, because it predates the Internet and wide availability
	    of fast packet-switched data networks. Today, with TCP/IP 
	    everywhere, UUCP once again emerges as the most logical choice 
	    of batch movement, because it too has moved with the times: it 
	    can work over TCP.
	</P
><P
>	    NNTP is the <EM
>de facto</EM
> mechanism of choice
	    for moving 
	    queued newsfeeds for carrier-class Usenet servers on the 
	    Internet, and unfortunately, for a lot of other Usenet servers 
	    as well. The reason why we find this choice unfortunate is 
	    discussed in <A
HREF="#FEEDEFFICIENCY"
>Section 12.1</A
>&#62; below. But in NNTP
	    feeds, an intermediate step of building batches out of queue 
	    files can be eliminated --- this is both its strength and its 
	    weakness.
	</P
><P
>	    In the case of queued NNTP feeds, articles get added to queue 
	    files as described above. An NNTP transmit process periodically
	    wakes up, picks up a queue file, and makes an NNTP connection to
	    the downstream server. It then begins a processing loop where, 
	    for each queued article, it uses the NNTP
	    <TT
CLASS="LITERAL"
>IHAVE</TT
> 
	    command to inform the downstream server of the article's 
	    message~ID. The downstream server checks its local repository to
	    see whether it already has the message. If not, it responds with
	    a <TT
CLASS="LITERAL"
>SENDME</TT
> response. The transmitting server
	    then pumps
	    out the article contents in plaintext form.  When all articles 
	    in the queue have been thus processed, the sending server closes
	    the connection. If the NNTP connection breaks in between due to
	    any reason, the sending server truncates the queue file and 
	    retains only those articles which are yet to be transmitted, 
	    thus minimising repeat transmissions.
	</P
><P
><A
NAME="DIALUPNONNTP"
></A
>&#62;
	    A queued NNTP feed works with the sending server making an NNTP
	    connection to the receiving server. This implies that the 
	    receiving server must have an IP address which is known to the 
	    sending server or can be looked up in the DNS. If the receiving
	    server connects to the Internet periodically using a dialup 
	    connection and works with a dynamically assigned IP address, 
	    this can get tricky. UUCP feeds suffer no such problems because
	    the sending server for the newsfeed can be the UUCP server,
	    <EM
>i.e.</EM
>
	    passive. The receiving server for the feed can be the UUCP 
	    master, <EM
>i.e.</EM
> the active party. So the
	    receiving server can then
	    initiate the UUCP connection and connect to the sending server.
	    Thus, if even one of the two parties has a static IP address, 
	    UUCP queued feeds can work fine.
	</P
><P
>	    Thus, NNTP feeds can be sent out a little faster than the 
	    batched transmission processes used for UUCP and other older 
	    methods, because no batches need to be constructed. However, 
	    NNTP is often used in newsfeeds where it is not necessary and it
	    results in colossal waste of bandwidth.  Before we study 
	    efficiency issues of NNTP versus batched feeds, we will cover 
	    another way feeds can be organised using NNTP: the pull feeds.
	</P
></DIV
><DIV
CLASS="SECTION"
><HR><H5
CLASS="SECTION"
><A
NAME="AEN167"
>2.3.2.2. Pull feeds</A
></H5
><P
>	    This method of transferring a set of articles works only over 
	    NNTP, and requires absolutely no configuration on the 
	    transmitting, or upstream, server. In fact, the upstream server
	    cannot even easily detect that the downstream server is pulling
	    out a feed --- it appears to be just a heavy and thorough
	    newsreader, that's all.
	</P
><P
>	    This pull feed works by the downstream server pulling out
	    articles i one by one, just like any NNTP newsreader, using the
	    NNTP <TT
CLASS="LITERAL"
>ARTICLE</TT
> command with the Message-ID as
	    parameter.
	    The interesting detail is how it gets the message~IDs to begin
	    with. For this, it uses an NNTP command, specially designed for
	    pull feeds, called <TT
CLASS="LITERAL"
>NEWNEWS</TT
>. This command
	    takes a hierarchy and a date, 
	    <TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
> NEWNEWS comp 15081997 </PRE
></FONT
></TD
></TR
></TABLE
>
	</P
><P
>	    This command is sent by the downstream server over NNTP to the 
	    upstream server, and in effect asks the upstream server to list
	    out all news articles which are newer than 15 August 1997 in the
	    <TT
CLASS="LITERAL"
>comp</TT
> hierarchy. The upstream server responds
	    with a 
	    (often huge) list of message~IDs, one per line, ending with a
	    period on a line by itself.
	</P
><P
>	    The pulling server then compares each newly received message~ID
	    with its own article database and makes a (possibly shorter)
	    list of all articles which it does not have, thus eliminating
	    duplicate fetches.  That done, it begins fetching articles one
	    by one, using the NNTP <TT
CLASS="LITERAL"
>ARTICLE</TT
> command as
	    mentioned above.
	</P
><P
>	    In addition, there is another NNTP command,
	    <TT
CLASS="LITERAL"
>NEWGROUPS</TT
>,
	    which allows the NNTP client --- <EM
>i.e.</EM
> the
	    downstream server in
	    this case --- to ask its upstream server what were the new
	    newsgroups created since a given date. This allows the
	    downstream server to add the new groups to its
	    <TT
CLASS="LITERAL"
>active</TT
> file.
	</P
><P
>	    The <TT
CLASS="LITERAL"
>NEWNEWS</TT
> based approach is usually one of
	    the most inefficient methods of pulling out a large Usenet feed.
	    By inefficiency, here we refer to the CPU loads and RAM
	    utilisation on the upstream server, not on bandwidth usage. This
	    inefficiency is because most Usenet news servers do not keep
	    their article databases indexed by hierarchy and date; CNews
	    certainly does not. This means that a <TT
CLASS="LITERAL"
>NEWNEWS</TT
>
	    command issued to an upstream server will put that server into a
	    sequential search of its article database, to see which articles
	    fit into the hierarchy given and are newer than the given date.
	</P
><P
>	    If pull feeds were to become the most common way of sending out 
	    articles, then all upstream servers would badly need an
	    efficient way of sorting their article databases to allow each 
	    <TT
CLASS="LITERAL"
>NEWNEWS</TT
> command to rapidly generate its list
	    of matching articles. A slow upstream server today might take
	    minutes to begin responding to a <TT
CLASS="LITERAL"
>NEWNEWS</TT
>
	    command, and
	    the downstream server may time out and close its NNTP connection
	    in the meanwhile. We have often seen this happening, till we
	    tweak timeouts.
	</P
><P
>	    There are basic efficiency issues of bandwidth utilisation
	    involved in NNTP for news feeds, which are applicable for both
	    queued and pull feeds. But the problem with
	    <TT
CLASS="LITERAL"
>NEWNEWS</TT
> is unique to pull feeds, and relates
	    to server loads, not bandwidth wastage. 
	</P
></DIV
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="CONTROLMSG"
>2.4. Control messages</A
></H3
><P
>The Usenet is a massive dispersed collection of servers which
operate almost without any supervision, provided they have adequate disk
space and do not suffer disk corruption due to power failures,
<EM
>etc.</EM
> (It is indeed surprising how self-managing a
good Usenet server is, provided these two pre-requisites are met.) These
servers are each under the control of human administrators, but it is
preferable that certain routine actions be performed across all these
servers remotely from one location, without the manual intervention of
these humans.</P
><P
>One common need for centralised operations is the creation of new
groups in the standard eight hierarchies. The Usenet follows a fairly
formal process which asks for votes from readers worldwide before
deciding on the restructuring of its newsgroups list, including merging of
low-volume groups, splitting of high-volume groups into many specialised
groups, creating new groups, and even deleting groups. Once the voting
process for a change concludes and the change action is to be carried
out, it would be extremely tedious to send email to the hundreds of
thousands of Usenet administrators and hope that they make the changes
right, and answer their doubts if they get confused. It would be much
better to have an <EM
>automatic</EM
> way to make the
changes across all servers, of course with proper authorisation.</P
><P
>The solution to this does not lie in giving some central authority
the ability to run an OS-level command of his choice on all the world's
Usenet servers, because OS commands differ from OS to OS, and because
few Usenet administrators would trust a stranger from another part of
the world with OS level access. Therefore, the solution lay in defining
a small set of common Usenet maintenance actions, and permitting only
these actions to be triggered on all servers through the passing of
special command messages, called <EM
>control
messages</EM
>.</P
><P
>Control messages look like ordinary Usenet articles, more or less.
They have an extra header line, with its value in a specific format,
but they usually carry body text which looks like a normal human-written
article. Here is a control message (a spurious one at that, but it'll
do for now):</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>Xref: news.starcomsoftware.com control:814217
Path: news.starcomsoftware.com!linux594.dn.net!news.dn.hoopoo.com!
	feed-out.newsfeeds.com!newsfeeds.com!feed.newsfeeds.com!
	newsfeeds.com!news-spur1.maxwell.syr.edu!news.maxwell.syr.edu!
	newsfeed.icl.net!newsfeed.skycache.com!Cidera!newsfeed.gamma.ru!
	Gamma.RU!carrier.kiev.ua!goblin.nadrabank.kiev.ua!not-for-mail
From: tale@uunet.uu.net (David C Lawrence)
Newsgroups: news.groups,humanities.hipcrime
Subject: cmsg newgroup humanities.hipcrime
Control: newgroup humanities.hipcrime
Date: Sun, 18 Feb 2001 11:50:28 GMT
Organization: The Cabal
Lines: 20
Approved: tale@uunet.uu.net
Message-ID: &#60;3afWYZTIR.G5YOC2@uunet.uu.net&#62;
NNTP-Posting-Host: 203.145.147.67
X-Trace: goblin.nadrabank.kiev.ua 982528840 21455 203.145.147.67
         (18 Feb 2001 20:40:40 GMT)
X-Complaints-To: usenet@nadrabank.kiev.ua
NNTP-Posting-Date: 18 Feb 2001 20:40:40 GMT
X-No-Archive: Yes

humanities.hipcrime is an unmoderated newsgroup which passed its
vote for creation by 326:10 as reported in news.announce.newgroups
on 18 Feb 2001.

For your newsgroups file:
humanities.hipcrime	HipCrime for Humanity - you committed one now!

Anyone can create a newsgroup in the alt, biz, comp, earth,
humanities, misc, news, meow, rec, sci, soc, talk, us, or
any other Usenet hierarchy.  New newsgroup proposals may be
optionally discussed in news.groups. Please be sure that your
/usr/lib/news/control.ctl is configured correctly:

##	NEWGROUP MESSAGES
## honor them all and log in \${LOG}/newgroup.log
newgroup:*:alt.*|biz.*|comp.*|earth.*|humanities.*|misc.*|news.*|\
	meaw.*|rec.*|sci.*|soc.*|talk.*|us.*:doit=newgroup

##	RMGROUP MESSAGES
## drop them all and don't log
rmgroup:*:*:drop

Meow!
David C Lawrence</PRE
></FONT
></TD
></TR
></TABLE
><P
>A control message must have a <TT
CLASS="LITERAL"
>Control</TT
>
header. Besides, all control messages <EM
>will</EM
>
have an <TT
CLASS="LITERAL"
>Approved</TT
> header, like messages posted
to moderated newsgroups. The <TT
CLASS="LITERAL"
>Control</TT
> header
actually specifies a command to run on the local server, and the
parameter(s) to supply to it. The local Usenet server software is
supposed to figure out its own way to get the task done. In this
example, the command in the <TT
CLASS="LITERAL"
>Control</TT
> header is
<TT
CLASS="LITERAL"
>newgroup</TT
>, which creates a new newsgroup. And its
parameter is <TT
CLASS="LITERAL"
>humanities.hipcrime</TT
>, which gives the
name of the newsgroup to create.</P
><P
>In C-News, the control message implementation works through
separate shellscripts kept in a fixed directory,
<TT
CLASS="LITERAL"
>$NEWSBIN/ctl/</TT
>, as a security measure; if the
executable script isn't present there, the control message command will
be ignored. The control message types supported are:</P
><P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>checkgroups</TT
>:  control message to
check whether the list of newsgroups in your active file are all correct
as per a master list of newsgroups sent in the control message</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newgroup</TT
>: control message to create a
new newsgroup</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>rmgroup</TT
>: control message to delete a
newsgroup and all articles in it</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>sendsys</TT
>: control message to cause an
email response to be sent to the author with the <TT
CLASS="LITERAL"
>sys</TT
>
file of your server in it. This results in a response storm of
emails from all the Usenet servers in the world to the author. These
responses allow the sender of the control message to analyse all the
<TT
CLASS="LITERAL"
>sys</TT
> files of the world's Usenet servers and create the
directed graph of Usenet newsfeeds. Why someone would want to do this is
hard to guess, but the result is surely an awesome picture of one facet
of networked human civilisation, like looking at a giant world map.</P
><P
>Incidentally, there is no invasion of privacy here, because
your server's <TT
CLASS="LITERAL"
>sys</TT
> file is supposed to be public
information, if you take feeds from the public Usenet.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>version</TT
>: control message which results
in your Usenet software sending an email to the author of the message,
containing the type and version of the Usenet news software you are
using. This too is not an invasion of privacy, because this information
is supposed to be public knowledge.</P
></LI
><LI
><P
>The cancel message: the most frequently occurring type of
control messages. They specify the message ID of an article, and result
in the cancellation (deletion) of that article. If you post an article
and regret it a moment later, your Usenet newsreader software usually
allows you to ``cancel'' it by generating a cancel message.</P
></LI
></UL
><P
>The Usenet news software maintains a pseudo-newsgroup called
<TT
CLASS="LITERAL"
>control</TT
>, where it files all control messages it
receives. If you have an incoming newsfeed from the public Usenet, your
server's <TT
CLASS="LITERAL"
>control</TT
> group will usually be full with
thousands of cancel messages from trigger-happy fingers all over the
world. Usenet news server software like C-News allows you to filter the
incoming feed based on newsgroups, and will discard articles for groups
they do not subscribe to. But since all servers have to receive and
process control messages, they will all accept these cancel messages,
though many of them may apply to articles which are not part of your
highly-pruned subset of groups. <TT
CLASS="LITERAL"
>C'est la vie</TT
>.</P
><P
>Remember to set expiry for the <TT
CLASS="LITERAL"
>control</TT
> group to
one day or even shorter, so that the junk can be cleaned out as rapidly as
possible, just like the <TT
CLASS="LITERAL"
>junk</TT
> newsgroup.</P
><P
>The beauty of the control message architecture is that it
integrates seamlessly into the newsfeed mechanism for automatic control
of the network of servers. No separate channel of connection is needed
for the control actions. And article replication automatically
propagates control messages with human-readable articles, thus
guaranteeing reach across heterogenous networks technologies.</P
><P
>What your Usenet server does on receiving a
control message is governed by an authorisation file:
<TT
CLASS="LITERAL"
>$NEWSCTL/controlperms</TT
> in the case of C-News
and <TT
CLASS="LITERAL"
>control.ctl</TT
> in the case of INN, for
instance. The security measures implemented by this module are
further enhanced by the <TT
CLASS="LITERAL"
>pgpcontrol</TT
> package with its
<TT
CLASS="LITERAL"
>pgpverify</TT
> script. Using <TT
CLASS="LITERAL"
>pgpverify</TT
>,
your server can check that all control messages (except for article
cancellation messages) are digitally signed by a trusted party
using military-spec public key cryptography. Our integrated
Usenet news software distribution includes integration with
<TT
CLASS="LITERAL"
>pgpverify</TT
>.</P
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H2
CLASS="SECTION"
><A
NAME="AEN247"
>3. Usenet news software</A
></H2
><DIV
CLASS="SECTION"
><H3
CLASS="SECTION"
><A
NAME="AEN249"
>3.1. A brief history of Usenet systems</A
></H3
><P
>Towards the end of this HOWTO, we have added some information
about the history of Usenet server software by quoting sections from an
earlier Usenet Periodic Posting. We consider this historical
perspective, and the Usenix papers and other documents referred to in
it, essential reading for any Usenet server administrator. Please see
the section titled <SPAN
CLASS="QUOTE"
>"<A
HREF="#SOFTWAREHISTORY"
>Usenet software: a historical perspective</A
>&#62;"</SPAN
>.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN254"
>3.2. C-News and NNTPd</A
></H3
><P
>C-News was written by Henry Spencer and Geoff Collyer of the
Department of Zoology, University of Toronto, almost entirely in shell
and <TT
CLASS="LITERAL"
>awk</TT
>, as a replacement for an earlier system called
B-News. The focus was on adding some extra features and a
lot of performance. The first release was called Shellscript Release,
which was deployed by a very large number of servers worldwide, as
a natural upgrade to B-News.  This version of C-News had upward
compatibility with B-News meta-data, <EM
>e.g.</EM
> history
files. This was the version of C-News which was initially rolled out
in 1991 or so at the National Centre for Software Technology (NCST,
<TT
CLASS="LITERAL"
>http://www.ncst.ernet.in</TT
>) and the Indian Institutes
of Technology in India as part of the Indian educational and research
network (ERNET). We received guidance from the NCST about Usenet news
installation and management.</P
><P
>The Shellscript Release was soon followed by a re-write with a lot
more C code, called Performance Release, and then a set of cleanup and
component integration steps leading to the last release called the Cleanup
Release. This Cleanup Release was patched many times by the authors,
and the last one was CR.G (Cleanup Release revision G). The version of
C-News discussed in this HOWTO is a set of small bug fixes on CR.G.</P
><P
>Since C-News came from shellscript-based antecedents, its
architecture followed the set-of-programs style so typical of Unix,
rather than large monolothic software systems traditional to some other
OSs. All pieces had well-defined roles, and therefore could be easily
replaced with other pieces as needed. This allowed easy adaptations and
upgradations. This never affected performance, because key components
which did a lot of work at high speed, <EM
>e.g.</EM
>
<TT
CLASS="LITERAL"
>newsrun</TT
>, had been rewritten in C by that time. Even
within the shellscripts, crucial components which handled binary data,
<EM
>e.g.</EM
> a component called <TT
CLASS="LITERAL"
>dbz</TT
>
to manipulate efficient on-disk hash arrays, were C programs with
command-line interfaces, called from scripts.</P
><P
>C-News was born in a world with widely varying network line speeds,
where bandwidth utilisation was a big issue and dialup links with UUCP
file transfers was common. Therefore, it has strong support for
batched feeds, specially with a variety of compression techniques and
over a variety of fast and slow transport channels. And C-News virtually
does not know the existence of TCP/IP, other than one or two tiny batch
transport programs like <TT
CLASS="LITERAL"
>viarsh</TT
>. However, its design
was so modular that there was absolutely no problem in plugging in NNTP
functionality using a separate set of C programs without modifying
a single line of C-News. This was done by a program suite called
NNTP Reference Implementation, which we call NNTPd.</P
><P
>This software suite could work with B-News and C-News article
repositories, and provided the full NNTP functionality.  Since B-News
died a gradual death, the combination of C-News and NNTPd became a freely
redistributable, portable, modern, extensible, and high-performance
software suite for Unix Usenet servers.  Further refinements were
added later, <EM
>e.g.</EM
> <TT
CLASS="LITERAL"
>nov</TT
>, the News
Overview package and <TT
CLASS="LITERAL"
>pgpverify</TT
>, a public-key-based
digital signature module to protect Usenet news servers against
fraudulent control messages.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN272"
>3.3. INN</A
></H3
><P
>INN is one of the two most widely used Usenet news server solutions. It
was written by Rich Salz for Unix systems which have a socket API ---
probably all Unix systems do, today.</P
><P
>INN has an architecture diametrically opposite to CNews. It is a
monolithic program, which is started at bootup time, and keeps running
till your server OS is shut down. This is like the way high performance
HTTP servers are run in most cases, and allows INN to cache a lot of
things in its memory, including message-IDs of recently posted messages,
<EM
>etc.</EM
> This interesting architecture has been discussed
in an interesting paper by the author, where he explains the problems
of the older B-News and C-News systems that he tried to address. Anyone
interested in Usenet software in general and INN in particular should
study this paper.</P
><P
>INN addresses a Usenet news world which revolves around NNTP, though it
has support for UUCP batches --- a fact that not many INN administrators 
seem to talk about. INN works faster than the CNews-NNTPd combination when
processing multiple parallel incoming NNTP feeds. For multiple readers
reading and posting news over NNTP, there is no difference between the
efficiency of INN and NNTPd. <A
HREF="#INNEFFICIENCY"
>Section 5.7</A
>&#62; discusses
the efficiency issues of INN over the earlier C-News architecture, based
on Rich Salz' paper and our analyses of usage patterns.  </P
><P
>INN's architecture has inspired a lot of high-performance Usenet news
software, including a lot of commercial systems which address the
``carrier class'' market. That is the market for which the INN
architecture has clear advantages over C-News.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN280"
>3.4. Leafnode</A
></H3
><P
>This is an interesting software system, to set up a ``small'' Usenet
news server on one computer which only receives newsfeeds but does not
have the headache of sending out bulk feeds to other sites,
<EM
>i.e.</EM
> it is a ``leaf node'' in the newsfeed flow
diagram. According to its homepage (<TT
CLASS="LITERAL"
>www.leafnode.org</TT
>),
``Leafnode is a USENET software package designed for small sites running
any flavour of Unix, with a few tens of readers and only a slow link
to the net. [...] The current version is 1.9.24.''</P
><P
>This software is a sort of combination of article repository and
NNTP news server, and receives articles, digests and stores them on the
local hard disks, expires them periodically, and serves them to an NNTP
reader. It is claimed that it is simple to manage and is ideal for
installation on a desktop-class Unix or Linux box, since it does not
take up much resources.</P
><P
>Leafnode is based on an appealing idea, but we find no problem
using C-News and NNTPd on a desktop-class box. Its resource consumption is
somewhat proportional to the volume of articles you want it to process,
and the number of groups you'll want to retain for a small team of users
will be easily handled by C-News on a desktop-class computer. An office
of a hundred users can easily use C-News and NNTPd on a desktop computer
running Linux, with 64 MBytes of RAM, IDE drives, and sufficient disk
space. Of course, ease of configuration and management is dependent on
familiarity, and we are more familiar with C-News than with Leafnode. We
hope this HOWTO will help you in that direction.</P
><P
>There <EM
>is</EM
>, however, one area in which Leafnode
is far easier to administer than INN or C-News. Leafnode constantly
monitors the actual usage of the newsgroups it carries, based on
readership statistics of its NNTP readers. If a particular newsgroup
is not read at all by any user for a week, then Leafnode will delete
all articles in that newsgroup, free up disk space, and stop fetching
new articles for it. If it finds that a previously abandoned newsgroup
is now again receiving attention, even from one user, then it'll fetch
all articles for that group from its upstream server the next time it
connects. This self-tuning feature of Leafnode is really an excellent
advantage which makes a Leafnode site easier to manage, specially for
small setups with bandwidth and disk space constraints.</P
><P
>The Leafnode Website gives a lot of details in an easily
understood format.</P
><P
>TO BE EXTENDED AND CORRECTED.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN291"
>3.5. Suck</A
></H3
><P
>Suck is a program which lets you pull out an NNTP feed from an NNTP
server and file it locally. It does not contain any article repository
management software, expecting you to do it using some other
software system, <EM
>e.g.</EM
> C-News or INN.  It can
create batchfiles which can be fed to C-News, for instance. (Well,
to be fair, Suck <EM
>does</EM
> have an option to store the
fetched articles in a spool directory tree very much like what is used
by C-News or INN in their article area, with one file per article. You
can later read this raw message spool area using a mail client which
supports the <TT
CLASS="LITERAL"
>msgdir</TT
> file layout for mail folders,
like MH, perhaps. We don't find this option useful if you're running
Suck on a Usenet server.)  Suck finally boils down to a single
command-line program which is invoked periodically, typically from
<TT
CLASS="LITERAL"
>cron</TT
>. It has a zillion command-line options which
are confusing at first, but later show how mature and finely tunable
the software is.</P
><P
>If you need an NNTP pull feed, then we know of no better programs
than Suck for the job. The <TT
CLASS="LITERAL"
>nntpxfer</TT
> program which
forms part of the NNTPd package also implements an NNTP pull feed, for
instance, but does not have one-tenth of the flexibility and fine-tuning
of Suck. One of the banes of the NNTP pull feed is connection timeouts;
Suck allows a lot of special tuning to handle this problem.  If we had
to set up a Usenet server with an NNTP pull feed, we'd use Suck right
away.</P
><P
>TO BE EXTENDED AND CORRECTED.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN301"
>3.6. Carrier class software</A
></H3
><P
>Carrier-class servers are expected to handle a complete feed of all
articles in all newsgroups, including a lot of groups which have what we
call a ``high noise-to-signal ratio.'' They do not have the luxury of
choosing a ``useful'' subset like administrators of internal corporate
Usenet servers do. Secondly, carrier-class servers are expected to turn
articles around very fast, <EM
>i.e.</EM
> they are expected to
have very low latency from the moment they receive an article to the
time they retransmit it by NNTP to downstream servers. Third, they
are supposed to provide very high availability, like other ``carrier
class'' services. This usually means that they have parallel arrays of
computers in load sharing configurations. And fourth, they usually do
not cater to retail connections for reading and posting articles by human
users. Usenet news carriers usually reserve separate computers to handle
retail connections.</P
><P
>Thus, carrier-class servers do not need to maintain a repository
of articles; they only need to focus on super-efficient real-time
re-transmission. These highly specialised servers have software which
receive an article over NNTP, parse it, and immediately re-queue it for
outward transmission to dozens or hundreds of other servers. And since
they work at these high throughputs, their downstream servers are also
expected to be live on the Internet round the clock to receive incoming
NNTP connections, or be prepared to lose articles. Therefore, there's
no batching or long queueing needed, and C-News-style batching in fact
is totally inapplicable.</P
><P
>Therefore, these carrier-class Usenet servers are more like packet
routers than servers with repositories. They are referred to nowadays as
NNTP routers or news routers.</P
><P
>It can be seen why batch-oriented repository management
software like C-News is a total anachronism here, and why they need an
NNTP-oriented, online, real-time design. The INN antecedents of some
of these systems is therefore natural. We would love to hear from any
Linux HOWTO reader whose Usenet server requirements include carrier-class
behaviour.</P
><P
>We are aware of only one freely redistributable NNTP router:
NNTPRelay (see <TT
CLASS="LITERAL"
>http://nntprelay.maxwell.syr.edu/</TT
>); this
software runs on NT. There is no reason why such services cannot run off
Linux servers, even Intel Linux, provided you have fast network links and
arrays of servers. Linux as an OS platform is not an issue here.</P
><P
>TO BE EXTENDED AND CORRECTED.</P
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H2
CLASS="SECTION"
><A
NAME="SETTINGUP"
>4. Setting up CNews + NNTPd</A
></H2
><DIV
CLASS="SECTION"
><H3
CLASS="SECTION"
><A
NAME="AEN313"
>4.1. Getting the sources and stuff</A
></H3
><DIV
CLASS="SECTION"
><H4
CLASS="SECTION"
><A
NAME="AEN315"
>4.1.1. The sources</A
></H4
><P
>C-News software can be obtained from
<TT
CLASS="LITERAL"
>ftp://ftp.uu.net/networking/news/transport/cnews/cnews.tar.Z</TT
>
and will need to be uncompressed using the BSD
<TT
CLASS="LITERAL"
>uncompress</TT
> utility or a compatible program. The
tarball is about 650 KBytes in size. It has its own highly intelligent
configuration and installation processes, which are very well
documented. The version that is available is Cleanup Release revision G,
on which our own version is based.</P
><P
>NNTPd (the NNTP Reference Implementation) is available from
<TT
CLASS="LITERAL"
>ftp://ftp.uu.net/networking/news/nntp/nntp.1.5.12.1.tar.Z</TT
>.
It has no automatic scripts and processes to configure itself. After
fetching the sources, you will have to follow a set of directions given
in the documentation and configure some C header files. These
configuration settings must be done keeping in mind what you have
specified when you build the C-News sources, because NNTPd and C-News
must work together. Therefore, some key file formats, directory paths,
<EM
>etc.</EM
>, will have to be specified identically in both
software systems.</P
><P
>The third software system we use is Nestor. This too is to be
found in the same place where the NNTPd software is kept, at
<TT
CLASS="LITERAL"
>ftp://ftp.uu.net/networking/news/nntp/nestor.tar.Z</TT
>.
This software compiles to one binary program, which must be run
periodically to process the logs of <TT
CLASS="LITERAL"
>nntpd</TT
>, the NNTP
server which is part of NNTPd, and report usage statistics to the
administrator. We have integrated Nestor into our source base.</P
><P
>The fourth piece of the system, without which no Usenet server
administrator dares venture out into the wild world of public Internet
newsfeeds, is <TT
CLASS="LITERAL"
>pgpverify</TT
>.</P
><P
>We have been working with C-News and NNTPd for many years now, and
have fixed a few bugs in both packages. We have also integrated the four
software systems listed above, and added a few features here and there to
make things work more smoothly. We offer our entire source base to
anyone for free download from
<TT
CLASS="LITERAL"
>http://www.starcomsoftware.com/proj/usenet/src/news.tar.gz</TT
>.
There are no licensing restrictions on our sources; they are as freely
redistributable as the original components we started with.</P
><P
>When you download our software distribution, you will extract it
to find a directory tree with the following subdirectories and files:</P
><P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>c-news</TT
>: the source tree of the CR.G
    software release, with our additions like
    <TT
CLASS="LITERAL"
>pgpverify</TT
> integration, our scripts like
    <TT
CLASS="LITERAL"
>mail2news</TT
>, and pre-created configuration
    files.
    </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>nntp-1.5.12.1</TT
>: the source tree of the
    original NNTPd release, with header files pre-configured to fit in
    with our configuration of C-News, and our addition of bits and
    pieces like Nestor, the log analysis program.
    </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>howto</TT
>: this document, and its SGML
    sources and Makefile.
    </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>build.sh</TT
>: a shellscript you can run
    to compile the entire combined source tree and install binaries in the
    right places, if you are lucky and all goes well.
    </P
></LI
></UL
><P
>Needless to say, we believe that our source tree is a better
place to start with than the original components, specially if you
are installing a Usenet server on a Linux box and for the first time.
We will be available on email to provide technical assistance should
you run into trouble.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN347"
>4.1.2. The key configuration files</A
></H4
><P
>Once you get the sources, you will need some key configuration
files to seed your C-News system. These configuration files are
actually database tables, and are changing frequently, whenever
newsgroups are created, modified or deleted. These files specify
the list of active newsgroups in the ``public'' Usenet. You can,
and should, add your organisation's internal newsgroups to this
list when you set up your own server, but you will need to know
the list of public standard newsgroups to begin with. This list
can be obtained from the same FTP server by downloading the files
<TT
CLASS="LITERAL"
>active.gz</TT
> and <TT
CLASS="LITERAL"
>newsgroups.gz</TT
> from
<TT
CLASS="LITERAL"
>ftp://ftp.uu.net/networking/news/config/</TT
>. You
can create your own <TT
CLASS="LITERAL"
>active</TT
> and
<TT
CLASS="LITERAL"
>newsgroups</TT
> files by retaining a subset of the entries
in these two files. Both these are ASCII text files.</P
><P
>Getting the sources from our server will not obviate the need to
get the latest versions of these files from
<TT
CLASS="LITERAL"
>ftp.uu.net</TT
>. We do not (yet) maintain an up-to-date
copy of these files on our server, and we will add no value to the
original by just mirroring them.</P
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN357"
>4.2. Compiling and installing</A
></H3
><P
>    For installing, first make sure you have an entry for a user called 
    <TT
CLASS="LITERAL"
>news</TT
> in your <TT
CLASS="LITERAL"
>/etc/password</TT
> file. This
    is setting the news-database owner to <TT
CLASS="LITERAL"
>news</TT
>. Now download
    the source from us and untar it in the home directory of news. This creates
    two main directories <EM
>viz.</EM
> <TT
CLASS="LITERAL"
>c-news</TT
>
    and <TT
CLASS="LITERAL"
>nntp</TT
>. 
    To install and compile, run the script <TT
CLASS="LITERAL"
>build.sh</TT
> as root
    in the directory that contains the script. It is important that the script 
    run as <TT
CLASS="LITERAL"
>root</TT
> as it sets ownerships, installs and 
    compiles the source as user <TT
CLASS="LITERAL"
>news</TT
>. This
    is a one-step process that puts in place both the C-News and the
    NNTP software, setting correct permissions and paths.
    Following
    is a brief description of what build.sh does:</P
><P
></P
><UL
><LI
><P
> 
    Checks for the <TT
CLASS="LITERAL"
>OS</TT
> platform and exits if
    it is not <TT
CLASS="LITERAL"
>Linux</TT
>.</P
></LI
><LI
><P
> 
    Again, exits if you are not running as
    <TT
CLASS="LITERAL"
>root</TT
>.</P
></LI
><LI
><P
>    Looks for and exits if cannot find the above two directories.</P
></LI
><LI
><P
> 
    Compiles <TT
CLASS="LITERAL"
>C-News</TT
> and performs regression tests if the 
    compilation was successfull.  Sends out a warning to read the error file 
    <TT
CLASS="LITERAL"
>make.out.r</TT
> and to fix 'em.
    Compilation erros are written to a file called <TT
CLASS="LITERAL"
>make.out</TT
>. &#13;</P
></LI
><LI
><P
> 
    Performs the above operation in the <TT
CLASS="LITERAL"
>nntp</TT
> directory, too. </P
></LI
><LI
><P
> 
    Checks for the presence of the three key directories:
    <TT
CLASS="LITERAL"
>$NEWSARTS - (/var/spool/news)</TT
> that houses the artciles, 
    <TT
CLASS="LITERAL"
>$NEWSCTL -(/var/lib/news)</TT
> that contain
    configuration, log and status files and <TT
CLASS="LITERAL"
>$NEWSBIN - 
    (/usr/lib/newsbin)</TT
> that contain binaries and
    executables for
    the working of the Usenet News system. Tries to create them if non-existent
    and exits if it results in failure.</P
></LI
><LI
><P
> 
    Changes the ownership of these directories to <TT
CLASS="LITERAL"
>news.news</TT
>.
    This is important since the entire Usenet News System runs as user <TT
CLASS="LITERAL"
>news.</TT
> It
    will not function properly as any other user. </P
></LI
><LI
><P
> 
    Then starts the installation process of C News. It runs
    <TT
CLASS="LITERAL"
>make install </TT
>to install binaries at the right locations; 
    <TT
CLASS="LITERAL"
>make setup </TT
>to set the correct paths and umask, create 
    directories for newsgroups, determine who will receive reports; 
    <TT
CLASS="LITERAL"
>make ui</TT
> to set up inews and injnews and 
    <TT
CLASS="LITERAL"
>make readpostcheck </TT
>to use readnews, postnews and 
    checknews scripts provided by C News. The errors, if any are to be found in
    the respective <TT
CLASS="LITERAL"
>make.out</TT
> files. e.g. make.setup will write
    errors to <TT
CLASS="LITERAL"
>make.out.setup</TT
></P
></LI
><LI
><P
> 
    <TT
CLASS="LITERAL"
>Newsspool</TT
>,  which queues incoming
    batches in <TT
CLASS="LITERAL"
>$NEWSARTS/in.coming</TT
> directory should run as
    set-userid and set-groupid. This is done.</P
></LI
><LI
><P
> 
    A softlink is made to <TT
CLASS="LITERAL"
>/var/lib/news</TT
> from 
    <TT
CLASS="LITERAL"
>/usr/lib/news.</TT
>	</P
></LI
><LI
><P
> 
    The NNTP software is installed. </P
></LI
><LI
><P
> 
    Sets up the manpages for C News and makes it world
    readable. The NNTP manpages get installed when the software is installed.
    Compiles the C News documentation <TT
CLASS="LITERAL"
>guide.ps</TT
> and makes it 
    readable and available in <TT
CLASS="LITERAL"
>/usr/doc/packages/news</TT
> or
    <TT
CLASS="LITERAL"
>/usr/doc/news</TT
>.</P
></LI
><LI
><P
> 
    Checks for the PGP binary and asks the administrator to get
    it, if not found.</P
></LI
></UL
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="CONFIGURESYSTEM"
>4.3. Configuring the system: What and how to configure files?</A
></H3
><P
>Once installed, you have to now configure the system to accept feeds and 
batch them for your neighbours. You will have to do the following:</P
><P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>nntpd</TT
>:  
    Copy the compiled <TT
CLASS="LITERAL"
>nntpd</TT
> into a directory where
    executables are kept and activate it. It runs on port 119 as a daemon
    through <TT
CLASS="LITERAL"
>inetd</TT
> unless you have compiled it as stand-alone.
    An entry in the <TT
CLASS="LITERAL"
>/etc/services</TT
> file for nntp would look 
    like this:
    <TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>nntp	119/tcp    \# Network News Transfer Protocol</PRE
></FONT
></TD
></TR
></TABLE
>
    An entry in the <TT
CLASS="LITERAL"
>inetd.conf </TT
>file will be:
    <TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
> nntp    stream    tcp    nowait   news    path-to-tcpd  path-to-nntpd </PRE
></FONT
></TD
></TR
></TABLE
>

    The last two fields in the <TT
CLASS="LITERAL"
>inetd.conf</TT
> file are paths to 
    binaries of the <TT
CLASS="LITERAL"
>tcp</TT
> and the <TT
CLASS="LITERAL"
>nntp </TT
> 
    daemon respectively.</P
></LI
><LI
><P
><EM
>Configuring control files:</EM
>  
    There are plenty of control files in <TT
CLASS="LITERAL"
>$NEWSCTL</TT
> that will
    need to be configured before you can
    start using the news system.  The files mentioned here are also discussed
    in the first section of the section titled 
    <SPAN
CLASS="QUOTE"
>"<A
HREF="#COMPONENT"
>Components of a running system</A
>&#62;"</SPAN
>. These control files are 
    dealt in detail in the following below.</P
><P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>sys</TT
>:
	One line per system/NDN listing all the
	newsgroup hierarchies each system subscribes to. Each line is prefixed
	with the system name and the one beginning with
	<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ME:</PRE
></FONT
></TD
></TR
></TABLE
> indicates what your
	server is willing to receive. Following are typical entries that go into
	this file: <TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ME:comp,news,misc,netscape</PRE
></FONT
></TD
></TR
></TABLE
>
	This line indicates what newsgroups your server has subscribed to.
	<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>server/server.starcomsoftware.com:all,!general/all:f</PRE
></FONT
></TD
></TR
></TABLE
>
        This is a list of newsgroups your server will pass on to your NDN.
	The newsgroups specified should be a comma separated list and the entire
	line should contain no spaces. The <EM
>f</EM
> flag indicates
	that the newsgroup name and the article number alongwith its size will 
	make up one entry in the <TT
CLASS="LITERAL"
>togo</TT
> file in the 
	<TT
CLASS="LITERAL"
>$NEWSARTS/out.going</TT
> directory.
    </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>explist</TT
>: 
	This file has entries indicating which articles expire and when and  
	whether they have to be archived. The order in which the newsgroups are
	listed is important. An example follows:
	<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>comp.lang.java.3d    x    60    /var/spool/news/Archive</PRE
></FONT
></TD
></TR
></TABLE
>
	This means that the articles of comp.lang.java expire after 60 days and
	shall be archived in the directory mentioned in the fourth field. 
	Archiving is an option. The second field indicates that this line 
	applies to both moderated and unmoderted newsgroups.
	<EM
>m</EM
> would 
	specify moderated and <EM
>u</EM
> would specify unmoderated
	groups. If you want to specify an extremely large no. as the expiry
	period you can use the keyword <SPAN
CLASS="QUOTE"
>"never"</SPAN
>. 
    </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>batchparms</TT
>:
	<TT
CLASS="LITERAL"
>sendbatches</TT
> is a program that
	administers batched transmission of news articles to other sites. To do
	this it consults the <TT
CLASS="LITERAL"
>batchparms</TT
> file. Each line in 
	the file specifies the behaviour for each of your NDN mentioned in the
	<TT
CLASS="LITERAL"
>sys</TT
> file. There are five fields for each site to be
	specified.</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
> server   u     100000    100    batcher | gzip -9 | viauux -d gunzip </PRE
></FONT
></TD
></TR
></TABLE
><P
>	The first field is the site name which matches the entry in the 
	<TT
CLASS="LITERAL"
>sys</TT
> file and has a corresponding directory in 
	<TT
CLASS="LITERAL"
>$NEWSARTS/out.going </TT
>by that name. 
    </P
><P
>	
	The second field is the class of the site,<EM
>u</EM
> for 
	UUCP and <EM
>n </EM
>for NNTP feeds. A <SPAN
CLASS="QUOTE"
>"!"</SPAN
> in 
	this field means that batching for this site has been disabled. 
    </P
><P
>	The third field is the size of batches to be prepared in bytes.
    </P
><P
>	
	The fourth field is the maximum length of the output queue for 
	transmission to that site.
    </P
><P
>	The fifth field is the command line to be used to build, compress and
	transmit batches to that site. The contents of the 
	<TT
CLASS="LITERAL"
>togo </TT
> file are made available on standard input.
    </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>controlperm</TT
>:
	This file controls how the news
	system responds to control messages. Each line consists of 4-5 fields
	separated by white space. Control messages has been discussed in 
	<SPAN
CLASS="QUOTE"
>"<A
HREF="#CONTROLMSG"
>Section 2.4</A
>&#62;"</SPAN
>.
	</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>comp,sci    tale@uunet.uu.net   nrc    pv   news.announce.newsgroups</PRE
></FONT
></TD
></TR
></TABLE
><P
>	The first field is a newsgroup pattern to which the line applies.
    </P
><P
>	The second field is either the keyword <SPAN
CLASS="QUOTE"
>"any"</SPAN
> or an e-mail 
	address. The latter specifies that the line applies to control messages
	from only that author.
    </P
><P
>	The third field is a set of opcode letters indicating what control
	operations need to be performed on messages emanating from the e-mail
	address mentioned in the second field. <EM
>n</EM
> stands for
	creating a newgroup, <EM
>r</EM
> stands for deleting a 
	newsgroup and <EM
>c</EM
> stands for checkgroup. 
    </P
><P
>	The fourth field is a set of flag letters indicating how to respond to
	a control message that meets all the applicability tests:
	<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>	     y 	Do it.
	     n	Don't do it.
	     v 	Report it and include the entire control
	        message in the report.
	     q 	Don't report it.
	     p	Do it iff the control message carries a valid PGP signature. 
	</PRE
></FONT
></TD
></TR
></TABLE
>
	Exactly one of y, n or p must be present.
    </P
><P
>	The fifth field, which is optional, will be used if the fourth field
	contains a <EM
>p</EM
>. It must contain the PGP key ID of the
	public key to be used for signature verification. 
    </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>mailpaths</TT
>: 
	This file describes how to reach
	the moderators of various hierarchies of newsgroups by mail. Each line
	consists of two fields: a news group pattern and an e-mail address. The
	first line whose group pattern matches the newsgroup is used. As an
	example:

       <TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>	   comp.lang.java.3d		somebody@mydomain.com
	   all				%s@moderators.uu.net
      </PRE
></FONT
></TD
></TR
></TABLE
>

	In the second example, the <TT
CLASS="LITERAL"
>%s</TT
> gets replaced with the
	groupname and all dots appearing in the newsgroup name are substituted 
	with dashes.
    </P
></LI
><LI
><P
><EM
>Miscellaneous files:</EM
>
	The other files to be modified are:
	<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>mailname:</TT
>
	    Contains the Internet domain name of the
	    news system.  Consider getting one if you don't have it.
	</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>organization:</TT
> 
	    Contains the default value for the <TT
CLASS="LITERAL"
>Organization:</TT
>
	    header for postings originating locally.
	</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>whoami:</TT
>
	    Contains the name of the news system. This is the site name used in
	    the <TT
CLASS="LITERAL"
>Path:</TT
> headers and hence should concur with
	    the names your neighbours use in their <TT
CLASS="LITERAL"
>sys</TT
> files.
	</P
></LI
></UL
>
    </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>active </TT
>file:
	This file specifies one line for each
	newsgroup (not just the hierarchy) to be found on your news system. You
	will have to get the most recent copy of the active file from 
	<TT
CLASS="LITERAL"
>ftp://ftp.isc.org/usenet/CONFIG/active</TT
> and prune it
	to delete newsgroups that you have not subscribed to. Run the script 
	<TT
CLASS="LITERAL"
>addgroup</TT
> for each newsgroup in this file which will 
	create relevant directories in the <TT
CLASS="LITERAL"
>$NEWSARTS</TT
> area. 
	The <TT
CLASS="LITERAL"
>addgroup</TT
> script takes
	two paramters: the newsgroup name being created and a flag. The flag can
	be any one of the following:
	<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>	    y		local postings are allowed
	    n 		no local postings, only remote ones
	    m		postings to this group must be approved
	                by the moderator
	    j		articles in this group are only passed and not kept
	    x		posting to this newsgroup is disallowed
	    =foo.bar	articles are locally filed in
	                "foo.bar" group
	</PRE
></FONT
></TD
></TR
></TABLE
>

	An entry in this file looks like this:

	 <TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>comp.lang.java.3d	0000003716	01346	m </PRE
></FONT
></TD
></TR
></TABLE
>

	The first field is the name of the newsgroup. The second field is the
	highest article number that has been used in that newsgroup. The
	third field is the lowest article number in the group. The fourth
	field is a flag as explained above.
    </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newsgroups </TT
>file:
	This contains a one-line description
	of each newsgroup to be found in the active file. You will have to
	get the most recent file from
	<TT
CLASS="LITERAL"
>ftp://ftp.isc.org/usenet/CONFIG/newsgroups</TT
> 
	and prune it to remove unwanted information. As an example:

	<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>comp.lang.java.3d 	3D Graphics APIs for the Java language</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
></LI
><LI
><P
><EM
>Aliases: </EM
>
	These aliases are required for trouble reporting. 
	Once the system is in place and scripts are run, anomalies/problems
	are reported to addresses in the <TT
CLASS="LITERAL"
>/etc/aliases</TT
> file. 
	These entries include email addresses for <TT
CLASS="LITERAL"
>newsmaster, 
	newscrisis, news, usenet,  newsmap</TT
>.
	They should ideally point to an email address that will be 
	accessed at regularly.  Arrange the emails for 
	<TT
CLASS="LITERAL"
>newsmap</TT
> to be discarded to minimize the effect of 
	<TT
CLASS="LITERAL"
>sendsys bombing</TT
> by practical jokers.
    </P
></LI
><LI
><P
><EM
>Cron jobs:</EM
> 
	Certain scripts like <TT
CLASS="LITERAL"
>newsrun</TT
> that picks up incoming 
	batches and maintenance scripts, should run through news-database 
	owner's cron which is <TT
CLASS="LITERAL"
>news</TT
>. The cron entries ideally
	will be for the following: A more detailed report can be found in 
	<SPAN
CLASS="QUOTE"
>"<A
HREF="#CRONJOBS"
>Section 9.4</A
>&#62;"</SPAN
> 
	<P
></P
><OL
TYPE="1"
><LI
><P
><TT
CLASS="LITERAL"
>newsrun: </TT
>
	    This script processes incoming batches of
	    article.  Run this as frequently as you want them to get digested.
	</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>sendbatches:</TT
>
	    This script transmit batches to the
	    NDNs. Set the frequency according to your requirements.
	</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newsdaily:</TT
>
	    This should be run ideally once a day
	    since it reports errors and anomalies in the news system.
	</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newswatch:</TT
>
	    This looks for errors/anomalies at a more detailed level and hence
	    should be run atleast once every hour
	</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>doexpire:</TT
>
	    This script expires old articles as
	    determined by the explist file. Run this once a day.
	</P
></LI
></OL
>
    </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newslog: </TT
>
	Make an entry in the system's <TT
CLASS="LITERAL"
>syslog.conf</TT
>
	file for logging messages spewed out by <TT
CLASS="LITERAL"
>nntpd</TT
> in 
	<TT
CLASS="LITERAL"
>newslog </TT
>.  It should be located in 
	<TT
CLASS="LITERAL"
>$NEWSCTL</TT
>. The entry will look like this:

	<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>news.debug		-/var/lib/news/newslog</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>Newsboot: </TT
>
	Have this run (as <TT
CLASS="LITERAL"
>news</TT
> the
	news-database owner) when the system boots to clear out debris left
	around by crashes.
    </P
></LI
><LI
><P
>Add a Usenet mailer in sendmail: 
	The <TT
CLASS="LITERAL"
>mail2news</TT
> program provided as 
	part of the source code is a handy tool to send an e-mail to a newsgroup
	which gets digested as an article. You will have to add the following 
	ruleset and mailer definition in your <TT
CLASS="LITERAL"
>sendmail.cf </TT
>
	file:</P
><P
></P
><UL
><LI
><P
>Under SParse1, add the following:
	    <TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>	    R$+ . USENET &#60; @ $=w . &#62;      $#usenet     $: $1
	    </PRE
></FONT
></TD
></TR
></TABLE
>
	</P
></LI
><LI
><P
>Under mailer definitions, define the mailer Usenet as:
	<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>	    MUsenet 	 P=/usr/lib/newsbin/mail2news/m2nmailer, F=lsDFMmn, 
		S=10, R=0, M=2000000, T=X-Usenet/X-Usenet/X-Unix, A=m2nmailer $u
	</PRE
></FONT
></TD
></TR
></TABLE
>
	</P
></LI
></UL
><P
>In order to send a mail to a newsgroup you will now have to suffix
	the newsgroup name with usenet <EM
>i.e.</EM
> your 
	<TT
CLASS="LITERAL"
>To:</TT
>  header will look like this:
	<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>To: misc.test.usenet@yourdomain.</PRE
></FONT
></TD
></TR
></TABLE
>
	The mailer definition of usenet will intercept this mail and post it to
	the respective newsgroup, in this case, <TT
CLASS="LITERAL"
>misc.test</TT
>
	</P
></LI
></UL
><P
>This, more or less, completes the configuration part.</P
></LI
></UL
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN589"
>4.4. Testing the system</A
></H3
><P
>To locally test the system, follow the steps given below:</P
><P
></P
><UL
><LI
><P
>post an article: 
    Create a local newsgroup
    <TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>    cnewsdo addgroup mysite.test y
    </PRE
></FONT
></TD
></TR
></TABLE
>
    and using <TT
CLASS="LITERAL"
>postnews </TT
>post an article to it.</P
></LI
><LI
><P
>Has it arrived in <TT
CLASS="LITERAL"
>$NEWSARTS/in.coming</TT
>?:
    The article should show up in the directory mentioned. Note the nomenclature
    of the article.</P
></LI
><LI
><P
>When newsrun runs: 
    When newsrun runs from <TT
CLASS="LITERAL"
>cron </TT
>, the article disappears from
    <TT
CLASS="LITERAL"
>in.coming</TT
> directory and appears in 
    <TT
CLASS="LITERAL"
>$NEWSARTS/mysite/test</TT
>. Look how
    the <TT
CLASS="LITERAL"
>newsgroup, active, log and history </TT
>(not the errorlog)
    files and <TT
CLASS="LITERAL"
>.overview </TT
>file in
    <TT
CLASS="LITERAL"
>$NEWSARTS/mysite/test</TT
> reflect the digestion of the file
    into the news system.</P
></LI
><LI
><P
>reading the article: 
    Try to read the article through <TT
CLASS="LITERAL"
>readnews</TT
> or any 
    news client. If you are able to, then you have set most everything right.</P
></LI
></UL
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN611"
>4.5. <TT
CLASS="LITERAL"
>pgpverify</TT
> and <TT
CLASS="LITERAL"
>controlperms</TT
></A
></H3
><P
>    As mentioned in <SPAN
CLASS="QUOTE"
>"<A
HREF="#CONTROLMSG"
>Section 2.4</A
>&#62;"</SPAN
>, it becomes 
    necessary to authenticate control messages to protect yourself from being 
    attacked by pranksters. For this, you will have to configure the
    <TT
CLASS="LITERAL"
>$NEWSCTL/controlperm </TT
>file to declare whose control
    messages you are willing to honour and for what newsgroups alongwith their
    public key ID. The <TT
CLASS="LITERAL"
>controlperm</TT
> manpage shall give you 
    details on the format.</P
><P
>    This will work only in association with <TT
CLASS="LITERAL"
> pgpverify </TT
> which
    verifies the Usenet control messages that have been signed using the 
    <TT
CLASS="LITERAL"
>signcontrol</TT
> process. The script can be found at
    <TT
CLASS="LITERAL"
>ftp://ftp.isc.org/pub/pgpcontrol/pgpverify</TT
>. 
    <TT
CLASS="LITERAL"
> pgpverify </TT
>internally uses the PGP binary which
    will have to be made available in the default executables directory. If you
    wish to send control messages for your local news system, you will have to
    digitally sign them using the above mentioned <TT
CLASS="LITERAL"
>signcontrol</TT
>
    program which is available at
    <TT
CLASS="LITERAL"
>ftp://ftp.isc.org/pub/pgpcontrol/signcontrol</TT
>. You will
    also have to configure the <TT
CLASS="LITERAL"
>signcontrol</TT
> program accordingly.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN628"
>4.6. Feeding off an upstream neighbour</A
></H3
><P
>    For external feeds, commercial customers will have to buy them
    from a regular News Provider like <TT
CLASS="LITERAL"
>dejanews.com</TT
>
    or <TT
CLASS="LITERAL"
>newsfeeds.com</TT
>. You will have to specify
    to them what hierarchies you want and decide on the mode of
    transmission, <EM
>i.e.</EM
> UUCP or NNTP, based on
    your requirements. Once that is done, you will have to ask them to
    initiate feeds, and check <TT
CLASS="LITERAL"
>$NEWSARTS/in.coming</TT
>
    directory to see if feeds are coming in.</P
><P
>    If your organisation belongs to the academic community or is
    otherwise lucky enough to have an NDN server somewhere which is
    willing to provide you a free newsfeed, then the payment issue goes
    out of the picture, but the rest of the technical requirements
    remain the same.</P
><P
>    One problem with incoming NNTP feeds is that it is far easier to use
    (relatively) efficient NNTP inflows if you have a server with a
    permanent Internet connection and a fixed IP address. If you are a
    small office with a dialup Internet connection, this may not be
    possible. In that case, the only way to get incoming newsfeeds by
    NNTP may be by using a highly inefficient pull feed.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN637"
>4.7. Configuring outgoing feeds</A
></H3
><P
>    If you are a leaf node, you will only have to send feeds back to your
    news provider for your postings in public newsgroups to propagate
    to the outside world. To enable this, you need one line in the
    <TT
CLASS="LITERAL"
>sys</TT
> and <TT
CLASS="LITERAL"
>batchparms</TT
> files
    and one directory in <TT
CLASS="LITERAL"
>$NEWSARTS/out.going</TT
>. If
    you are willing to transmit articles to your neighbouring
    sites, you will have to configure <TT
CLASS="LITERAL"
>sys</TT
> and
    <TT
CLASS="LITERAL"
>batchparms</TT
> with more entries. The number of directories
    in <TT
CLASS="LITERAL"
>$NEWSARTS/out.going</TT
> shall increase, too. Refer
    to first two sections of the chapter titled 
    <SPAN
CLASS="QUOTE"
>"<A
HREF="#COMPONENT"
>Components of a running system</A
>&#62;"</SPAN
>for a better understanding of
    outgoing feeds. Again, you will have to determine how you wish to
    transmit the feed: UUCP or NNTP.</P
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN648"
>4.7.1. By UUCP</A
></H4
><P
>For outgoing feeds by UUCP, we recommend that you start with
    Taylor UUCP. In fact, this is the UUCP version which forms part
    of the GNU Project and is the default UUCP on Linux
    systems.</P
><P
>A full treatment of UUCP configuration is beyond the scope of
    this document. However, the basic steps will be as follows. First,
    you will have to define a <SPAN
CLASS="QUOTE"
>"system"</SPAN
> in your Usenet server for the
    NDN (next door neighbour) host. This definition will include various
    parameters, including the manner in which your server will call the
    remote server, the protocol it will use, <EM
>etc.</EM
>
    Then an identical process will have to be followed on the NDN
    server's UUCP configuration, for your server, so that
    <EM
>that</EM
> server can recognize
    <EM
>your</EM
> Usenet server.</P
><P
>Finally, you will need to set up appropriate
    <TT
CLASS="LITERAL"
>cron</TT
> jobs for the user <TT
CLASS="LITERAL"
>uucp</TT
>
    to run <TT
CLASS="LITERAL"
>uucico</TT
> periodically. Taylor UUCP comes with
    a script called <TT
CLASS="LITERAL"
>uusched</TT
> which may be modified to
    your requirements; this script calls <TT
CLASS="LITERAL"
>uucico</TT
>. One
    <TT
CLASS="LITERAL"
>uucico</TT
> connection will both upload and download
    news batches. Smaller sites can run <TT
CLASS="LITERAL"
>uusched</TT
> even
    once or twice a day.</P
><P
>Later versions of this document will include the
    <TT
CLASS="LITERAL"
>uusched</TT
> scripts that we use in Starcom. We use
    UUCP over TCP/IP, and we run the <TT
CLASS="LITERAL"
>uucico</TT
>
    connection through an SSH tunnel, to prevent transmission of
    UUCP passwords in plain text over the Internet, and our SSH tunnel
    is established using public-key cryptography, without passwords
    being used anywhere.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN667"
>4.7.2. By NNTP</A
></H4
><P
>For NNTP feeds, you will have to decide whether your server
    will be the connection initiator or connection recipient. If you are
    the connection initiator, you can send outgoing NNTP feeds more
    easily. If you are the connection recipient, then outgoing feeds
    will have to be pulled out of your server using the NNTP
    <TT
CLASS="LITERAL"
>NEWNEWS</TT
> command, which will place heavy loads on
    your server. This is not recommended.</P
><P
>Connecting to your NDN server for pushing out outgoing feeds
    will require the use of the <TT
CLASS="LITERAL"
>nntpsend.sh</TT
> script,
    which is part of the NNTPd source tree. This script will perform
    some housekeeping, and internally call the
    <TT
CLASS="LITERAL"
>nntpxmit</TT
> binary to actually send the queued set
    of articles out. You may have to provide authentication information
    like usernames and passwords to <TT
CLASS="LITERAL"
>nntpxmit</TT
> to allow
    it to connect to your NDN server, in case that server insists on
    checking the identity of incoming connections. (You can't be too
    careful in today's world.) <TT
CLASS="LITERAL"
>nntpsend.sh</TT
> will clean
    up after an <TT
CLASS="LITERAL"
>nntpxmit</TT
> connection finishes, and
    will requeue any unsent articles for the next session. Thus, even if
    there is a network problem, typically nothing is lost and all
    pending articles are transmitted next time.</P
><P
>Thus, pushing feeds out <EM
>via</EM
> may mean
    setting up <TT
CLASS="LITERAL"
>nntpsend.sh</TT
> properly, and then
    invoking it periodically from <TT
CLASS="LITERAL"
>cron</TT
>. If your
    Usenet server connects to the Internet only intermittently, then the
    process which sets up the Internet connection should be extended or
    modified to fire <TT
CLASS="LITERAL"
>nntpsend.sh</TT
> whenever the Internet
    link is established. For instance, if you are using the Linux
    <TT
CLASS="LITERAL"
>pppd</TT
>, you can add statements to the
    <TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
> script to change user to
    <TT
CLASS="LITERAL"
>news</TT
> and run <TT
CLASS="LITERAL"
>nntpsend.sh</TT
></P
></DIV
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H2
CLASS="SECTION"
><A
NAME="AEN686"
>5. Setting up INN</A
></H2
><DIV
CLASS="SECTION"
><H3
CLASS="SECTION"
><A
NAME="AEN688"
>5.1. Getting the source</A
></H3
><P
>INN is maintained and archived by the ISC (Internet Software
Consortium, <TT
CLASS="LITERAL"
>www.isc.org</TT
>) since 1996, and the INN
homepage is at <TT
CLASS="LITERAL"
>http://www.isc.org/products/INN/</TT
>. The
latest release of INN as of the time of this writing is INN v2.3.3,
released 7 May 2002. The full sources can be downloaded from
<TT
CLASS="LITERAL"
>ftp://ftp.isc.org/isc/inn/inn-2.3.3.tar.gz</TT
></P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN694"
>5.2. Compiling and installing</A
></H3
><P
>TO BE EXTENDED LATER.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN697"
>5.3. Configuring the system</A
></H3
><P
>TO BE ADDED LATER.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN700"
>5.4. Setting up <TT
CLASS="LITERAL"
>pgpverify</TT
></A
></H3
><P
>TO BE ADDED LATER.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN704"
>5.5. Feeding off an upstream neighbour</A
></H3
><P
>TO BE ADDED LATER.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN707"
>5.6. Setting up outgoing feeds</A
></H3
><P
>TO BE ADDED LATER.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="INNEFFICIENCY"
>5.7. Efficiency issues and advantages</A
></H3
><P
>TO BE ADDED LATER.</P
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H2
CLASS="SECTION"
><A
NAME="AEN713"
>6. Connecting email with Usenet news</A
></H2
><P
>Usenet news and mailing lists constantly remind us of each other.  And the
parallels are so strong that many mailing lists are gatewayed two-way
with corresponding Usenet newsgroups, in the <TT
CLASS="LITERAL"
>bit</TT
> hierarchy
which maps onto the old BITNET, and elsewhere.</P
><P
>There are probably ten different situations where a mailing list is
better, and ten others where the newsgroup approach works better. The
point to recognise is that the system administrator needs a choice of
gatewaying one with the other, whenever tradeoffs justify it. Instead
of getting into the tradeoffs themselves, this chapter will then focus
on the mechanisms of gatewaying the two worlds.</P
><P
>One clear and recurring use we find for this gatewaying is for mailing
lists which are of general use to many employees in a corporate network.
For instance, in stockbroking company, many employees may like to
subscribe to a business news mailing list. If each employee had to
subscribe to the mailing list independently, it would waste mail spool
area and perhaps bandwidth. In such situations, we receive the mailing
list into an internal newsgroup, so that individual mailboxes are not
overloaded. Everyone can then read the newsgroup, and messages are also
archived till expired.</P
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN719"
>6.1. Feeding Usenet news to email</A
></H3
><P
>In CNews, this is trivially done by adding one line to the
<TT
CLASS="LITERAL"
>sys</TT
> file, defining a new outgoing feed listing all the
relevant groups and distributions, and specifying the commandline to be executed
which is supposed to send out the outgoing message to that ``feed.'' This
command, in our case, should be a mail-sending program,
<EM
>e.g.</EM
>
<TT
CLASS="LITERAL"
>/bin/mail user@somewhere.com</TT
>. This is often adequate to get
the job done. We are sure almost every Usenet news software system will have
an equally easy way of piping the feed of a newsgroup to an email address.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN725"
>6.2. Feeding email to news: the <TT
CLASS="LITERAL"
>mail2news gateway</TT
></A
></H3
><P
>With our Usenet software sources has been integrated a set of
scripts which we have been using for at least five years internally.
This set of scripts is called <TT
CLASS="LITERAL"
>mail2news</TT
>. It contains
one shellscript called <TT
CLASS="LITERAL"
>mail2news</TT
>, which takes an
email message from <TT
CLASS="LITERAL"
>stdin</TT
>, processes it, and feeds the
processed version to <TT
CLASS="LITERAL"
>inews</TT
>, the
<TT
CLASS="LITERAL"
>stdin</TT
>-based news article injection utility of C-News.
The <TT
CLASS="LITERAL"
>inews</TT
> utility accepts a new article post in its
<TT
CLASS="LITERAL"
>stdin</TT
> and queues it for digestion by
<TT
CLASS="LITERAL"
>newsrun</TT
> whenever it runs next.</P
><P
>To use <TT
CLASS="LITERAL"
>mail2news</TT
>, we assume you are using
Sendmail to process incoming email. Our instructions can easily be
modified to adapt to any Mail Transport Agent (MTA) of your choice. You
will have to configure Sendmail or any other MTA to redirect incoming
mails for the gateway to a program called <TT
CLASS="LITERAL"
>m2nmailer</TT
>,
a Perlscript which accepts the incoming message in its standard input
and a list of newsgroup names, space separated, on its command line.
Sendmail can be easily configured to trigger <TT
CLASS="LITERAL"
>m2nmailer</TT
>
this way by defining a new mailer in <TT
CLASS="LITERAL"
>sendmail.cf</TT
>,
and directing all incoming emails meant for the Usenet news system to
this mailer. Once you set up the appropriate rulesets for Sendmail,
it automatically triggers <TT
CLASS="LITERAL"
>m2nmailer</TT
> each time an
incoming email comes for the <TT
CLASS="LITERAL"
>mail2news</TT
>
gateway.</P
><P
>The precise configuration changes to Sendmail have already been
specified in the chapter titled ``Setting up C-News + NNTPd.''</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN745"
>6.3. Using GNU Mailman as an email-NNTP gateway</A
></H3
><P
>TO BE ADDED LATER</P
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN748"
>6.3.1. GNU's all-singing all-dancing MLM</A
></H4
><P
>TO BE ADDED LATER</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN751"
>6.3.2. Features of GNU Mailman</A
></H4
><P
>TO BE ADDED LATER</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN754"
>6.3.3. Gateway features connecting NNTP and email</A
></H4
><P
>TO BE ADDED LATER</P
></DIV
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H2
CLASS="SECTION"
><A
NAME="AEN757"
>7. Security issues</A
></H2
><P
>It almost seems strange that we are discussing security issues in
the context of Usenet news servers. Usenet news has been one of the most
open and free-for-all network services traditionally. However, with the
exponential growth of the Internet, all services are becoming aware of
potential threats. The community of Internet intruders too has acquired
new profiles: a lot of Internet intrusion attempts are program-driven,
and exploit a set of ``well known'' vulnerabilities,
<EM
>i.e.</EM
> vulnerabilities which have been identified by
the computer security and intrusion community and published in their
reports and advisories. Thus, the question of ``Why will someone attack
my harmless Usenet server?'' is no longer valid. It will be attacked if
it can be attacked, merely because its IP address falls in a range of
addresses being targeted, perhaps.</P
><P
>Security issues for Usenet news servers fall into two categories.
First come vulnerabilities which will allow an attacker to bring down
your server or run code of his choice on it. Second come vulnerabilities
which can distort or corrupt your Usenet article hierarchy, either by
junk postings, unsolicited commercial messages, or forged control
messages. The second category of threats is specific to Usenet news and
needs Usenet-specific protection mechanisms, some of which require
tapping into defence mechanisms designed by the Usenet administrator
community.</P
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN762"
>7.1. Intrusion threats</A
></H3
><P
>Here we discuss the vulnerabilities which will allow an intruder
to ``gain control'' of your Usenet server, or ``bring it down,'' either
of which may be irritating, embarassing, or downright disastrous for your
business or occupation.</P
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN765"
>7.1.1. Generic server vulnerabilities</A
></H4
><P
>Foremost among these vulnerabilities are those which render
<EM
>any</EM
> server vulnerable to intrusion attempts.
Most of these vulnerabilities are unrelated to Usenet news itself. For
instance, if you have the Telnet service active on a server exposed to
the Internet, then it is likely that systematic attempts by intruders
to acquire usernames and passwords will bear fruit, using methods we
will best leave to specialised texts on the subject. Once this is done,
the intruder will merely ``walk into'' your server by Telnetting into
it.</P
><P
>We will not discuss this class of vulnerabilities here any further;
they belong in documents dedicated to general security issues. For
further reading, check the ``Security HOWTO'', the ``Security Quickstart
HOWTO'', the ``User Authentication HOWTO'', the ``VPN HOWTO'', and
the ``VPN Masquerade HOWTO'' ... and that's just from the Linux HOWTO
collection. As one can see, there is, if anything, a surfeit of material
on this and related subjects.</P
><P
>There are vulnerabilities which allow an intruder to mount the
so-called DoS attacks, which make your service inaccessible to
legitimate users, even though it does not let the intruder in. The most
publicised of these attacks were the SYNFlood and the Ping of Death
attacks, both quite old and well-understood by now. A Linux server
running a recent version of the kernel and properly configured, should
be immune to both these attack methods. But network protocols being
what they are, there are always new DoS methods being thought up, which
can temporarily overload or slow down a server. Once again, the texts
discussing generic security issues are the best place to study these
vulnerabilities.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN771"
>7.1.2. Vulnerabilities in Usenet software</A
></H4
><P
>Then come server vulnerabilities, if any, which are caused
specifically by Usenet news software. For instance, if it was possible
for an intruder to issue some string of bytes to your server's NNTP
server and cause it to execute a command of the intruder's choice, then
this vulnerability would be in this category.</P
><P
>Any server which accepts a text string as input from a
client is open to the buffer overrun class of attacks, if the
<TT
CLASS="LITERAL"
>gets()</TT
> C library function has been used in its code
instead of the <TT
CLASS="LITERAL"
>fgets()</TT
> with a buffer size limit. This
was a vulnerability made famous by the 1988 Morris Internet Worm,
discussions on which can be found elsewhere. (Go Google for it if you're
keen.) As far as we know, the INN NNTP server and the
<TT
CLASS="LITERAL"
>nntpd</TT
> which forms part of the NNTP Reference
Implementation both have no known buffer overrun vulnerabilities. This
class of vulnerabilities is less significant in the case of NNTPd or
INN because these daemons do not run as <TT
CLASS="LITERAL"
>root</TT
>. In
fact, they would begin to cause malfunctioning of the underlying Usenet
software if they ran as <TT
CLASS="LITERAL"
>root</TT
>. Therefore, even if an
intrepid intruder could find some way of gaining control of these
daemons, she would only be able to get into the server as user
<TT
CLASS="LITERAL"
>news</TT
>, which means that she can play havoc with the
Usenet installation, but no further. A daemon which runs as
<TT
CLASS="LITERAL"
>root</TT
>, if compromised, can allow an intruder to take
control of the operating system itself.</P
><P
>UUCP is generally believed to be insecure. We believe a careful
configuration of Taylor UUCP plugs a lot of these vulnerabilities. One
vulnerability with UUCP over TCP is that the username and password travel
in plaintext form in TCP data streams, much like with Telnet or FTP. We
therefore do not advise using UUCP over TCP in this manner if security
is a concern at all. We recommend the use of UUCP through a SSH tunnel,
with the SSH setup working only with a pre-installed public key. This way,
there is no need for usernames and passwords for the SSH tunnel setup,
and passwords cannot be leaked even intentionally. And the UUCP username
and password then passes through this encrypted tunnel and is therefore
totally superfluous for security; the preceding SSH tunnel provides a much
stronger connection authentication than the UUCP username and password.
And since we set up our SSH tunnels to demand key-based authentication
only, it rejects any attempt to connect using usernames and passwords
when the tunnel is being set up.</P
><P
>A third possible vulnerability is related to the back-end software
which processes incoming Usenet articles. It is conceivable that an
NNTP server will receive an incoming <TT
CLASS="LITERAL"
>POST</TT
> command,
receive an article, and queue it for processing on the local spool;
the NNTP server often does not perform any real-time processing on the
incoming post. The post-processing software which periodically processes
the incoming spool (the <TT
CLASS="LITERAL"
>in.coming</TT
> directory in C-News)
will read this article and somehow be forced to run a command of the
intruder's choice, either by buffer overrun vulnerabilities or any
other means.</P
><P
>While this possibility exists, it appears that neither the C-News
<TT
CLASS="LITERAL"
>newsrun</TT
> and family nor INN are vulnerable to this class
of attempts. We base our comment on the solid evidence that both these
systems have been around in an intrusion-prone world of public Usenet
servers for more than a decade. INN, the newer of the two, completed
one decade of life on 20 August 2002. And both these software systems
had their source freely available to all, including intruders. We can be
fairly certain that if vulnerabilities of this class have not been seen,
it not for want of intrusion attempts.</P
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN788"
>7.2. Vulnerabilities unique to the Usenet service</A
></H3
><P
>There are certain security precautions that a Usenet server
administrator has to take to ensure that her servers are not swamped by
irritating junk or configured out of shape by spurious control messages.
These vulnerabilities do not allow an intruder to run her software on
your servers, but allows her to mess up your server, causing you to lose
a precious weekend (or week) straightening out the mess.</P
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN791"
>7.2.1. Unsolicited commercial messages</A
></H4
><P
>Unsolicited commercial messages are called SPAM. There is a
war against SPAM being fought in the Internet community. The biggest
battlefront is in the world of email. Second to that is Usenet
newsgroups.</P
><P
>There are many tools that Usenet administrators use in their
battle against SPAM. The most important of these is the NoCeM suite. See
<TT
CLASS="LITERAL"
>http://www.cm.org/</TT
> for details of NoCeM, and the
newsgroup <TT
CLASS="LITERAL"
>alt.nocem.misc</TT
> for the SPAM cancel messages
which NoCeM reads to identify which articles to discard. Your server
will need a feed of <TT
CLASS="LITERAL"
>alt.nocem.misc</TT
> to use the NoCeM
facility. These special messages are signed by NoCeM volunteers whose
job is to identify SPAM articles, list their message-IDs, and then
issue these deletion instruction, digitally signed with special private
keys, which tell all Usenet servers to delete the SPAM messages. Your
server's NoCeM software will need public key software (typically PGP)
and a keyring with the public key of each NoCeM volunteer you want to
accept instructions from.</P
><P
>Other anti-spam tools for Usenet services are listed in the
Anti-SPAM Software Web page
(<TT
CLASS="LITERAL"
>http://www.exit109.com/~jeremy/news/antispam.html</TT
>).
The <TT
CLASS="LITERAL"
>Cleanfeed</TT
> software will clean out articles
identified as SPAM. There are many others.</P
><P
>SPAM is such a nuisance and a drain on organisational expense
pockets (by wasting bandwidth you pay for) that it is almost imperative
today that every Usenet server protects itself against it. We will
integrate some selected anti-SPAM measures into our integrated source
distribution soon.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN802"
>7.2.2. Spurious control messages</A
></H4
><P
>Control messages, discussed in detail earlier in <A
HREF="#CONTROLMSG"
>Section 2.4</A
>&#62;, instruct a Usenet server to take certain
actions, like delete a message or create a newsgroup. If this facility
is ``open to the public'', anyone with half a brain can forge control
messages to create twenty new newsgroups, and then post thousands of
articles into those groups. In the mid-nineties, we were hit by a storm
of over 2,000 (two thousand) <TT
CLASS="LITERAL"
>newgroup</TT
> control
messages, which rapidly taught us the danger of unprotected control
messages and the protection against them.</P
><P
>The standard protection mechanism against this
vulnerability is <TT
CLASS="LITERAL"
>pgpverify</TT
>, which can be
downloaded from multiple Websites and FTP mirror sites by
searching for <TT
CLASS="LITERAL"
>pgpverify</TT
> (the program) or
<TT
CLASS="LITERAL"
>pgpcontrol</TT
> (the total software package). We have
integrated this into our source distribution, so that our C-News works
in a tightly coupled manner with <TT
CLASS="LITERAL"
>pgpverify</TT
>.</P
><P
><TT
CLASS="LITERAL"
>pgpverify</TT
> works using public key cryptography,
much like NoCeM, and all the official maintainers of respective Usenet
group hierarchies sign control messages using their private keys. Your
server will carry their public keys, and <TT
CLASS="LITERAL"
>pgpverify</TT
>
will check the sign on each control message to ensure that it's from the
official maintainer of the hierarchy. It will then act upon legit
control messages and discard the spurious ones.</P
><P
>In today's nuisance-ridden Usenet environment, no sane Usenet
server administrator receiving a feed of ``public'' hierarchies and
control messages will even dream of running her server without
<TT
CLASS="LITERAL"
>pgpverify</TT
> protection.</P
></DIV
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H2
CLASS="SECTION"
><A
NAME="AEN817"
>8. Access control in NNTPd</A
></H2
><P
>The original NNTPd had host-based authentication which allowed clients
connecting from a particular IP address to read only certain newsgroups.
This was very clearly inadequate for enterprise deployment on an
Intranet, where each desktop computer has a different IP address, often
DHCP-assigned, and the mapping between person and desktop is not static.</P
><P
>What was needed was a user-based authentication, where a username and
password could be used to authenticate the user. Even this was provided
as an extension to NNTPd, but more was needed. The corporate IS manager
needs to ensure that certain Usenet discussion groups remain visible only
to certain people. This authorisation layer was not available in NNTPd.
Once authenticated, all users could read all newsgroups.</P
><P
>We have extended the user-based authentication facility in NNTPd in some
(we hope!) useful ways, and we have added an entire authorisation layer
which lets the administrator specify which newsgroups each user can
read. With this infrastructure, we feel NNTPd is fit for enterprise
deployment and can be used to handle corporate document repositories,
messages, and discussion archives. Details are given below.</P
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN822"
>8.1. Host-based access control</A
></H3
><P
>TO BE ADDED LATER</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN825"
>8.2. User authentication and authorisation</A
></H3
><DIV
CLASS="SECTION"
><H4
CLASS="SECTION"
><A
NAME="AEN827"
>8.2.1. The NNTPd password file</A
></H4
><P
>TO BE ADDED LATER</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN830"
>8.2.2. Mapping users to newsgroups</A
></H4
><P
>TO BE ADDED LATER</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN833"
>8.2.3. The <TT
CLASS="LITERAL"
>X-Authenticated-Author</TT
> article header</A
></H4
><P
>TO BE ADDED LATER</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN837"
>8.2.4. Other article header additions</A
></H4
><P
>TO BE ADDED LATER</P
></DIV
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H2
CLASS="SECTION"
><A
NAME="COMPONENT"
>9. Components of a running system</A
></H2
><P
>This chapter reviews the components of a running CNews+NNTPd server.
Analogous components will be found in an INN-based system too. We invite
additions from readers familiar with INN to add their pieces to this
chapter.</P
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN843"
>9.1. <TT
CLASS="LITERAL"
>/var/lib/news</TT
>: the CNews control area</A
></H3
><P
>This directory is more popularly known as <TT
CLASS="LITERAL"
>$NEWSCTL</TT
>. It
contains configuration, log and status files. There are no
articles or binaries kept here. Let's see what some of the
files are meant for. Control files are dealt in slightly greater detail in 
<SPAN
CLASS="QUOTE"
>"<A
HREF="#CONFIGURESYSTEM"
>Section 4.3</A
>&#62;"</SPAN
></P
><P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>sys</TT
>: 
    One line per system/NDN listing all the newsgroup 
    hierarchies each system subscribes to. Each line is prefixed with the system
    name and the one beginning with ME: indicates what we are going to receive.
    Look up manpage of <TT
CLASS="LITERAL"
>newssys</TT
>.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>explist</TT
>:
    This file has entries indicating articles of which
    newsgroup expire and when and if they have to be archived.  The order in
    which the newsgroups are listed is important. See manpage of
    <TT
CLASS="LITERAL"
>expire</TT
> for file format.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>batchparms</TT
>:
    Details of how to feed other sites/NDN, like the size of
    batches, the mode of transmission (UUCP/NNTP) are specified here.
    manpage to refer: <TT
CLASS="LITERAL"
>newsbatch</TT
>.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>controlperm</TT
>: 
    If you wish to authenticate a control message before any
    action is taken on it, you must enter authentication-related information 
    here.  The <TT
CLASS="LITERAL"
>controlperm</TT
> manpage will list all the fields
    in detail.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>mailpaths</TT
>: 
    It features the e-mail address of the moderator for each 
    newsgroup who is responsible for approving/disapproving
    articles posted to moderated newsgroups. The sample
    <TT
CLASS="LITERAL"
>mailpaths</TT
> file in the <TT
CLASS="LITERAL"
>tar</TT
> will 
    give you an idea of how entries are made.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>nntp_access/user_access</TT
>:  
    These files contain entries of servernames 
    and usernames on whom restrictions will apply when accessing newsgroups. 
    Again, the sample file in the tarball shall explain the format of the file.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>log, errlog</TT
>: 
    These are log files that keep growing large with each batch 
    that is received. The <TT
CLASS="LITERAL"
>log</TT
> file has one entry per
    article telling you if it 
    has been accepted by your news server or rejected. To understand the
    format of this file, refer to Chapter 2.2 of the <TT
CLASS="LITERAL"
>CNews</TT
>
    guide.  Errors, if any, while digesting the articles are
    logged in <TT
CLASS="LITERAL"
>errlog</TT
>. These 
    log files have to be rolled as the files hog a lot of disk space. </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>nntplog</TT
>:  
    This file logs information of the <TT
CLASS="LITERAL"
>nntpd</TT
> giving
    details of when a connection was established/broken and what commands were 
    issued. This file needs to be configured in <TT
CLASS="LITERAL"
>syslog</TT
> 
    <TT
CLASS="LITERAL"
>syslogd</TT
> should be running.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>active</TT
>: 
    This file has one line per newsgroup to be found in your news
    server. Besides other things, it tells you how many articles are
    currently present in each newsgroup. It is updated when each batch is
    digested or when articles are expired. The <TT
CLASS="LITERAL"
>active</TT
>
    manpage will furnish more details about other paramaters.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>history</TT
>: 
    This file, again, contains one line per article, mapping 
    <TT
CLASS="LITERAL"
>message-id</TT
> to newsgroup name and also giving its
    associated article number in that newsgroup. It is updated
    each time a feed is digested 
    and when <TT
CLASS="LITERAL"
>doexpire</TT
> is run. Plays a key role in
    loop-detection and serves as an article database. Read manpage of
    <TT
CLASS="LITERAL"
>newsdb</TT
>, <TT
CLASS="LITERAL"
>doexpire</TT
> for the file format </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newsgroups</TT
>:
    It has a one-line description for each newsgroup explaining 
    what kind of posts go into each of them. Ideally speaking, it should cover 
    all the newsgroups found in the <TT
CLASS="LITERAL"
>active</TT
> file.</P
></LI
><LI
><P
><EM
>Miscellaneous files</EM
>:
    Files like <TT
CLASS="LITERAL"
>mailname</TT
>, <TT
CLASS="LITERAL"
>organisation</TT
>,
    <TT
CLASS="LITERAL"
>whoami</TT
> contain information required for forming some of
    the headers of an article. The contents of
    <TT
CLASS="LITERAL"
>mailname</TT
> form the <TT
CLASS="LITERAL"
>From:</TT
> header and
    that of <TT
CLASS="LITERAL"
>organisation</TT
> form the
    <TT
CLASS="LITERAL"
>Organisation:</TT
> header. <TT
CLASS="LITERAL"
>whoami</TT
> contains
    the name of the news system. Refer to chapter 2.1 of
    <TT
CLASS="LITERAL"
>guide.ps</TT
> for a detailed list of files in the
    <TT
CLASS="LITERAL"
>$NEWSCTL</TT
> area.  Read <TT
CLASS="LITERAL"
>RFC 1036</TT
> for
    description of article headers .</P
></LI
></UL
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN916"
>9.2. <TT
CLASS="LITERAL"
>/var/spool/news</TT
>: the article repository</A
></H3
><P
>This is also known as the <TT
CLASS="LITERAL"
>$NEWSARTS</TT
> or
<TT
CLASS="LITERAL"
>$NEWSSPOOL</TT
> directory. This is where the
articles reside on your disk. No binaries or control files
should belong here.  Enough space should be allocated to this 
directory as the number of articles keep increasing with each
batch that is digested. An explanation of the following sub-directories will
give you an overview of this directory:
<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>in.coming</TT
>:
    Feeds/batches/articles from NDNs on their arrival and
    before being processed reside in this directory. After processing, they
    appear in 
    <TT
CLASS="LITERAL"
>$NEWSARTS</TT
> or in its <TT
CLASS="LITERAL"
>bad</TT
> sub-directory
    if there were errors. </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>out.going</TT
>: 
    This directory contains batches/feeds to be sent to your
    NDNs <EM
>i.e.</EM
> feeds to be pushed to your neighbouring sites
    reside here before they are transmitted. It contains one sub-directory per 
    NDN mentioned in the <TT
CLASS="LITERAL"
>sys</TT
> file. These sub-directories 
    contain files called <TT
CLASS="LITERAL"
>togo</TT
> which contain information about
    the article like the <TT
CLASS="LITERAL"
>message-id</TT
> or the article number 
    that is queued for transmission. </P
></LI
><LI
><P
><A
NAME="NEWSGROUPDIR"
></A
>&#62;<EM
>newsgroup directories</EM
>:
    For each newsgroup hierarchy that the news server
    has subscribed to, a directory is created under
    <TT
CLASS="LITERAL"
>$NEWSARTS</TT
>. 
    Further sub-directories are created under the parent to hold
    articles of specific newsgroups. For instance, for a
    newsgroup like <TT
CLASS="LITERAL"
>comp.music.compose</TT
>, the parent directory
    <TT
CLASS="LITERAL"
>comp</TT
> will appear in <TT
CLASS="LITERAL"
>$NEWSARTS</TT
> and a
    sub-directory called <TT
CLASS="LITERAL"
>music</TT
> will be created under
    <TT
CLASS="LITERAL"
>comp</TT
>. The <TT
CLASS="LITERAL"
>music</TT
> sub-directory 
    shall contain a further sub-directory called <TT
CLASS="LITERAL"
>compose</TT
> and
    all articles of <TT
CLASS="LITERAL"
>comp.music.compose</TT
>
    shall reside here. In effect, article 242 of newsgroup
    <TT
CLASS="LITERAL"
>comp.music.compose</TT
> shall map to file
    <TT
CLASS="LITERAL"
>$NEWSARTS/comp/music/compose/242</TT
>.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>control</TT
>: 
    The control directory houses only the control messages that
    have been received by this site. The control messages could be any of the
    following: <TT
CLASS="LITERAL"
>newgroup, rmgroup, checkgroup</TT
> and
    <TT
CLASS="LITERAL"
>cancel</TT
> appearing in the subject line of the article.
    More information to be found in <SPAN
CLASS="QUOTE"
>"<A
HREF="#CONTROLMSG"
>Section 2.4</A
>&#62;"</SPAN
></P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>junk</TT
>: 
    The <TT
CLASS="LITERAL"
>junk</TT
> directory contains all
    articles that the news 
    server has received and has decided, after processing, that it does not 
    belong to any of the hierarchies it has subscribed to. The news server 
    transfers/passes all articles in this directory to NDNs
    that have subscribed to the <TT
CLASS="LITERAL"
>junk</TT
> hierarchy.</P
></LI
></UL
></P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN962"
>9.3. <TT
CLASS="LITERAL"
>/usr/lib/newsbin</TT
>: the executables</A
></H3
><P
>TO BE ADDED LATER</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="CRONJOBS"
>9.4. <TT
CLASS="LITERAL"
>crontab and cron jobs </TT
></A
></H3
><P
>The heart of the Usenet news server is the various scripts that run at regular
intervals processing articles, digesting/rejecting them and
transmitting them to NDNs. I shall try to enumerate the ones that are important
enough to be cronned. :)</P
><P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>newsrun</TT
>: 
    The key script. This script picks the batches in the 
    <TT
CLASS="LITERAL"
>in.coming</TT
> directory, uncompresses them if necessary and
    feeds it to <TT
CLASS="LITERAL"
>relaynews</TT
> which then processes each
    article digesting and batching them and logging any errors. This script
    needs to run through <TT
CLASS="LITERAL"
>cron</TT
>
    as frequently as you want the feeds to be digested. Every half hour should 
    suffice for a non-critical requirement.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>sendbatches</TT
>: 
    This script is run to transmit the <TT
CLASS="LITERAL"
>togo</TT
> files formed in
    the <TT
CLASS="LITERAL"
>out.going</TT
> directory to your NDNs. It reads the
    <TT
CLASS="LITERAL"
>batchparms</TT
> file to know 
    exactly how and to whom the batches need to be transmitted. The frequency,
    again, can be set according to your requirements. Once an hour should be 
    sufficient.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newsdaily</TT
>: 
    This script does maintenance chores like rolling logs and 
    saving them, reporting errors/anomalies and doing cleanup jobs.
    It should typically run once a day.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newswatch</TT
>: 
    This looks for news problems at a more detailed level than
    newsdaily like looking for persistent lock files or unattended batches, 
    determining space shortage issues, and the likes. This should typically run
    once every hour.  For more on this and the above, read the 
    <TT
CLASS="LITERAL"
>newsmaint</TT
> manpage.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>doexpire</TT
>: 
    This script expires old articles as determined by the
    control file <TT
CLASS="LITERAL"
>explist</TT
> and updates the
    <TT
CLASS="LITERAL"
>active</TT
> file. This is necessary if you do not 
    want unnecessary/unwanted articels hogging up your disk space. Run it once 
    a day.  Manpage: <TT
CLASS="LITERAL"
>expire</TT
></P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newsrunning off/on</TT
>: 
    This script shuts/starts off the news server for you.
    You could choose to add this in your cron job if you think the news server 
    takes up lots of CPU time during peak hours and you wish to keep a check on
    it. </P
></LI
></UL
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN999"
>9.5. <TT
CLASS="LITERAL"
>newsrun</TT
> and <TT
CLASS="LITERAL"
>relaynews</TT
>: digesting received articles</A
></H3
><P
>The heart and soul of the Usenet News system, <TT
CLASS="LITERAL"
>newsrun</TT
> just picks up the batches/
articles in the <TT
CLASS="LITERAL"
>in.coming</TT
> directory of
<TT
CLASS="LITERAL"
>$NEWSARTS</TT
> and uncompresses them (if required) and calls
<TT
CLASS="LITERAL"
>relaynews</TT
>. It should run from cron.</P
><P
><TT
CLASS="LITERAL"
>relaynews</TT
> picks up each article one by one through 
<TT
CLASS="LITERAL"
>stdin</TT
>, determines if it belongs to a subscribed group
by looking up
<TT
CLASS="LITERAL"
>sys</TT
> file, looks in the <TT
CLASS="LITERAL"
>history</TT
> file
to determine that it does not already exist locally, digests it updating the 
<TT
CLASS="LITERAL"
>active</TT
>  and <TT
CLASS="LITERAL"
>history</TT
> file and batches it
for neighbouring sites. Logs errors on encountering problems while processing
the article and takes appropriate action if it happens to be
a control message. More info in manpage of <TT
CLASS="LITERAL"
>relaynews</TT
>.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1016"
>9.6. <TT
CLASS="LITERAL"
>doexpire</TT
> and <TT
CLASS="LITERAL"
>expire</TT
>: removing old articles</A
></H3
><P
>A good way to get rid of unwanted/old articles from the
<TT
CLASS="LITERAL"
>$NEWSARTS</TT
> area is to run <TT
CLASS="LITERAL"
>doexpire</TT
> once a 
day. It reads the
<TT
CLASS="LITERAL"
>explist</TT
> file from the <TT
CLASS="LITERAL"
>$NEWSCTL</TT
> directory
to determine what articles expire today. It can archive the
said article if so configured. It then updates the
<TT
CLASS="LITERAL"
>active</TT
> and the <TT
CLASS="LITERAL"
>history</TT
> file accordingly.
If you wish to retain the article entry in the
<TT
CLASS="LITERAL"
>history</TT
> file to avoid re-digesting it as a new
article after having expired it, add a special <EM
>/expired/;</EM
>
line in the control file. More on the options and functioning in the 
<TT
CLASS="LITERAL"
>expire </TT
> manpage.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1030"
>9.7. <TT
CLASS="LITERAL"
>nntpd</TT
> and <TT
CLASS="LITERAL"
>msgidd</TT
>: managing the NNTP interface</A
></H3
><P
>As has already been discussed in the chapter on setting up the software,
<TT
CLASS="LITERAL"
>nntpd</TT
> is a TCP-based server daemon which runs under
<TT
CLASS="LITERAL"
>inetd</TT
>. It is fired by <TT
CLASS="LITERAL"
>inetd</TT
>
whenever there's an incoming connection on the NNTP port, and it takes
over the dialogue from there. It reads the C-News configuration and data
files in <TT
CLASS="LITERAL"
>$NEWSCTL</TT
>, article files from
<TT
CLASS="LITERAL"
>$NEWSARTS&#62;</TT
>, and receives incoming posts and
transfers. These it dutifully queues in
<TT
CLASS="LITERAL"
>$NEWSARTS/in.coming</TT
>, either as batch files or single
article files.</P
><P
>It is important that <TT
CLASS="LITERAL"
>inetd</TT
> be configured to
fire <TT
CLASS="LITERAL"
>nntpd</TT
> as user <TT
CLASS="LITERAL"
>news</TT
>, not as
<TT
CLASS="LITERAL"
>root</TT
> like it does for other daemons like
<TT
CLASS="LITERAL"
>telnetd</TT
> or <TT
CLASS="LITERAL"
>ftpd</TT
>. If this is not
done correctly, a lot of problems can be caused in the functioning of
the C-News system later.</P
><P
><TT
CLASS="LITERAL"
>nntpd</TT
> is fired each time a new NNTP connection
is received, and dies once the NNTP client closes its connection. Thus,
if one <TT
CLASS="LITERAL"
>nntpd</TT
> receives a few articles by an incoming
batch feed (not a <TT
CLASS="LITERAL"
>POST</TT
> but an <TT
CLASS="LITERAL"
>XFER</TT
>),
then another <TT
CLASS="LITERAL"
>nntpd</TT
> will not know about the receipt of
these articles till the batches are digested. This will hamper
duplicate newsfeed detection if there are multiple upstream NDNs feeding
our server with the same set of articles over NNTP. To fix this,
<TT
CLASS="LITERAL"
>nntpd</TT
> uses an ally: <TT
CLASS="LITERAL"
>msgidd</TT
>, the
message ID daemon. This
daemon is fired once at server bootup time through
<TT
CLASS="LITERAL"
>newsboot</TT
>, and keeps running quietly in the
background, listening on a named Unix socket in the
<TT
CLASS="LITERAL"
>$NEWSCTL</TT
> area. It keeps in its memory a list of all
message IDs which various incarnations of <TT
CLASS="LITERAL"
>nntpd</TT
> have
asked it to remember.</P
><P
>Thus, when one copy of <TT
CLASS="LITERAL"
>nntpd</TT
> receives an
incoming feed of news articles, it updates <TT
CLASS="LITERAL"
>msgidd</TT
>
with the message IDs of these messages through the Unix socket. When
another copy of <TT
CLASS="LITERAL"
>nntpd</TT
> is fired later and the NNTP
client tries to feed it some more articles, the <TT
CLASS="LITERAL"
>nntpd</TT
>
checks each message ID against <TT
CLASS="LITERAL"
>msgidd</TT
>. Since
<TT
CLASS="LITERAL"
>msgidd</TT
> stores all these IDs in memory, the lookup is
very fast, and duplicate articles are blocked at the NNTP interface
itself.</P
><P
>On a running system, expect to see one instance of
<TT
CLASS="LITERAL"
>nntpd</TT
> for each active NNTP connection, and just one
instance of <TT
CLASS="LITERAL"
>msgidd</TT
> running quietly in the background,
hardly consuming any CPU resources. Our <TT
CLASS="LITERAL"
>nntpd</TT
> is
configured to die if the NNTP connection is more than a few minutes
idle, thus conserving server resources. This does not inconvenience the
user because modern NNTP clients simply re-connect. If an
<TT
CLASS="LITERAL"
>nntpd</TT
> instance is found to be running for days, it is
either hung due to a network error, or is receiving a very long incoming
NNTP feed from your upstream server. We used to receive our primary
incoming feed from our service provider through NNTP sessions lasting 18
to 20 hours without a break, every day.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1071"
>9.8. <TT
CLASS="LITERAL"
>nov</TT
>, the News Overview system</A
></H3
><P
>NOV, the News Overview System is a recent augmentation to the
C-News and NNTP systems and to the NNTP protocol. This subsystem
maintains a file for each active newsgroup, in which it maintains one
line per current article. This line of text contains some key meta-data
about the article, <EM
>e.g.</EM
> the contents of the
<TT
CLASS="LITERAL"
>From</TT
>, <TT
CLASS="LITERAL"
>Subject</TT
>,
<TT
CLASS="LITERAL"
>Date</TT
> and the article size and message ID. This speeds
up NNTP response enormously. The <TT
CLASS="LITERAL"
>nov</TT
> library has been
integrated into the <TT
CLASS="LITERAL"
>nntpd</TT
> code, and into key binaries
of C-News, thus providing seamless maintenance of the News Overview
database when articles are added or deleted from the repository.</P
><P
>When <TT
CLASS="LITERAL"
>newsrun</TT
> adds an article into
<TT
CLASS="LITERAL"
>starcom.test</TT
>, it also updates
<TT
CLASS="LITERAL"
>$NEWSARTS/starcom/test/.overview</TT
> and adds a line with
the relevant data, tab-separated, into it. When <TT
CLASS="LITERAL"
>nntpd</TT
>
comes to life with an NNTP client, and it sees the
<TT
CLASS="LITERAL"
>XOVER</TT
> NNTP command, it reads this
<TT
CLASS="LITERAL"
>.overview</TT
> file, and returns the relevant lines to the
NNTP client. When <TT
CLASS="LITERAL"
>expire</TT
> deletes an article, it also
removes the corresponding line from the <TT
CLASS="LITERAL"
>.overview</TT
>
file. Thus, the maintenance of the NOV database is seamless.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1090"
>9.9. Batching feeds with UUCP and NNTP</A
></H3
><P
>Some information about batching feeds has been provided in earlier
sections. More will be added later here in this document.</P
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H2
CLASS="SECTION"
><A
NAME="AEN1093"
>10. Monitoring and administration</A
></H2
><P
>Once the Usenet News system is in place and running, the news administrator
is then aided in monitoring the system by various reports generated by it.
Also, he needs to make regular checks in specific directories and
files to ascertain the smooth working of the system.</P
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1096"
>10.1. The <TT
CLASS="LITERAL"
>newsdaily</TT
> report</A
></H3
><P
>This report is generated by the script <TT
CLASS="LITERAL"
>newsdaily</TT
> which is 
typically run through <TT
CLASS="LITERAL"
>cron</TT
>. I shall enumerate some of the 
problems that are reported by it, based on my observations .</P
><P
></P
><UL
><LI
><P
><EM
>bad input batches</EM
>:  
    This gives a list of articles that have been declared bad after processing
    and hence have not been digested. The reason for this is not given. You
    are expected to check each article and determine the cause. </P
></LI
><LI
><P
><EM
>leading unknown newsgroups by articles</EM
>:  
    Newsgroup names that do not appear in the <TT
CLASS="LITERAL"
>active</TT
> file
    but their hierarchy has been subscribed to, would find their names mentioned
    under this heading. Choose to add the name in the active file if you think 
    it is important. For <EM
>e.g.</EM
>, you would see this happen
    if you have subscribed to the hierarchy <TT
CLASS="LITERAL"
>comp</TT
> but the
    <TT
CLASS="LITERAL"
>active</TT
> does not contain the newsgroup name 
    <TT
CLASS="LITERAL"
>comp.lang.java.3d</TT
>. You could deny subscription to this 
    particular newsgroup by specifying so in the <TT
CLASS="LITERAL"
>sys</TT
> file.
    </P
></LI
><LI
><P
><EM
>leading unsubscribed newsgroups</EM
>:
    If the news server receives maximum articles of a particular newsgroup
    hierarchy to which you haven't subscribed, it will appear under this
    heading. You really cannot do much about this except to 
    subscribe to them if they are required.</P
></LI
><LI
><P
><EM
>leading sites sending bad headers</EM
>: 
    This will list your NDNs who
    are sending articles with malformed/insufficient headers. </P
></LI
><LI
><P
><EM
>leading sites sending stale/future/misdated news</EM
>: 
    This will list your NDNs who are sending you articles that are older than
    the date you have specified for accepting feeds. </P
></LI
><LI
><P
>Some of the reports generated by us: 
    We have modified the newsdaily script to include some more statistics. 
    <P
></P
><UL
><LI
><P
><EM
>disk usage</EM
>: 
	This reports the size in bytes of the <TT
CLASS="LITERAL"
>$NEWSARTS</TT
>
	area. If you are receiving feeds regularly, you should see this figure
	increasing.
    </P
></LI
><LI
><P
><EM
>incoming feed statistics</EM
>: 
	This reports the number of articles and total bytes recevied from each 
	of your NDNs.
    </P
></LI
><LI
><P
><EM
>NNTP traffic report</EM
>: 
	The output of nestor has also been included in this report which gives
	details of each <TT
CLASS="LITERAL"
>nntp</TT
> connection and the overall 
	performance of the network connection read from the <TT
CLASS="LITERAL"
>newslog
	</TT
> file.  To understand the format, read the manpage of 
	<TT
CLASS="LITERAL"
>nestor</TT
>.
    </P
></LI
></UL
></P
></LI
><LI
><P
><EM
>Error reporting from the <TT
CLASS="LITERAL"
>errorlog</TT
>
file</EM
>: 
    Reports  errors logged in the <TT
CLASS="LITERAL"
>errorlog</TT
> file. Usually
    these are  file ownership or file missing problems which can be easily
    handled. </P
></LI
></UL
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1145"
>10.2. Crisis reports from <TT
CLASS="LITERAL"
>newswatch</TT
></A
></H3
><P
>Most of the problems reported to me are those with either space shortage or
persistent locks. There are instances when the scripts have created locks files
and have aborted/terminated without removing them. Sometimes they are 
innocuous enough to be deleted but this should be determined after a careful
analysis. They could be an indication of some part of the system not working
correctly. For <EM
>e.g.</EM
> I would receive this error message when
sendbatches would abnormally terminate trying to transmit huge togo files. I had
to determine why sendbatches was failing this often.</P
><P
>The space shortage issue has to be addressed immediately. You could
delete unwanted articles by running <TT
CLASS="LITERAL"
>doexpire</TT
> or add more disk
space at the OS level. </P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1152"
>10.3. Disk space</A
></H3
><P
>The <TT
CLASS="LITERAL"
>$NEWSBIN</TT
> area occupies space that is fixed. Since the
binaries do not grow once installed, you do not have to worry about disk 
shortage here. The areas that take up more space as feeds come in are
<TT
CLASS="LITERAL"
>$NEWSCTL</TT
> and <TT
CLASS="LITERAL"
>$NEWSARTS</TT
>. The 
<TT
CLASS="LITERAL"
>$NEWSCTL</TT
> has log files that keep growing with each feed.
As the articles are digested in huge numbers, the <TT
CLASS="LITERAL"
>$NEWSARTS</TT
>
area continues to grow. Also, you will need space if you have chosen to archive
articles on expiry.  Allocate a few GB of disk space for
<TT
CLASS="LITERAL"
>$NEWSARTS</TT
> depending on the number of hierarchies you are
subscribing and the feeds that come in everyday. <TT
CLASS="LITERAL"
>$NEWSCTL</TT
>
grows to a lesser proportion as compared to <TT
CLASS="LITERAL"
>$NEWSARTS</TT
>.
Allocate space for this accordingly.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1163"
>10.4. CPU load and RAM usage</A
></H3
><P
>With modern C-News and NNTPd, there is very little usage of these
system resources for processing news article flow. Key components like
<TT
CLASS="LITERAL"
>newsrun</TT
> or <TT
CLASS="LITERAL"
>sendbatches</TT
> do not load
the system much, except for cases where you have a very heavy flow of
compressed outgoing batches and the compression utility is run by
<TT
CLASS="LITERAL"
>sendbatches</TT
> frequently. <TT
CLASS="LITERAL"
>newsrun</TT
> is
amazingly efficient in the current C-News release. Even when it takes
half an hour to digest a large consignment of batches, it hardly loads the
CPU of a slow Pentium 200 MHz CPU or consumes much RAM in a 64 MB
system.</P
><P
>One thing which does slow down a system is a large bunch of
users connecting using NNTP to browse newsgroups. We do not have
heuristic based figures off-hand to provide a guidance figure for
resource consumption for this, but we have found that the load on the
CPU and RAM for a certain number of active users invoking
<TT
CLASS="LITERAL"
>nntpd</TT
> is more than with an equal number of
users connecting to the POP3 port of the same system for pulling
out mailboxes. A few hundred active NNTP users can really slow down
a dual-P-III Intel Linux server, for instance. This loading has no
bearing on whether you are using INN or <TT
CLASS="LITERAL"
>nntpd</TT
>;
both have practically identical implementations for NNTP
<EM
>reading</EM
> and differ only in their handling of
feeds.</P
><P
>Another situation which will slow down your Usenet news server is
when downstream servers connect to you for pulling out NNTP feeds using
the pull method. This has been mentioned before. This can really load
your server's I/O system and CPU.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1175"
>10.5. The <TT
CLASS="LITERAL"
>in.coming/bad</TT
> directory</A
></H3
><P
>The <TT
CLASS="LITERAL"
>in.coming</TT
> directory is where the batches/articles reside when you have 
received feeds from your NDN and before processing happens. Checking this
directory regularly to see if there are batches is a good way of determining
that feeds are coming in. The batches and articles have different nomenclature.
Batches, typically, have names like <EM
>nntp.GxhsDj</EM
> and 
individual articles are named beginning with digits like <EM
>0.10022643380.t</EM
></P
><P
>The <TT
CLASS="LITERAL"
>bad</TT
> sub-directory under <TT
CLASS="LITERAL"
>in.coming</TT
> 
holds batches/articles that have encountered errors when they were being
processed by <TT
CLASS="LITERAL"
>relaynews</TT
>. You will have to look at the 
individual files in this directory to determine the cause . Ideally speaking, 
this directory should be empty.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1186"
>10.6. Long pending queues in <TT
CLASS="LITERAL"
>out.going</TT
></A
></H3
><P
>TO BE ADDED.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1190"
>10.7. Problems with <TT
CLASS="LITERAL"
>nntpxmit</TT
> and <TT
CLASS="LITERAL"
>nntpsend</TT
></A
></H3
><P
>TO BE ADDED.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1195"
>10.8. The <TT
CLASS="LITERAL"
>junk</TT
> and <TT
CLASS="LITERAL"
>control</TT
> groups</A
></H3
><P
>Control messages are those that have a <TT
CLASS="LITERAL"
>newgroup/rmgroup/cancel/checkgroup</TT
> in
their subject line. Such messages result in <TT
CLASS="LITERAL"
>relaynews</TT
> calling
the appropriate script and on execution a message is mailed to the admin about
the action taken. These control messages are stored in the 
<TT
CLASS="LITERAL"
>control</TT
> directory of <TT
CLASS="LITERAL"
>$NEWSARTS</TT
>.  For the
propogation of such messages, one must subscribe to the
<TT
CLASS="LITERAL"
>control</TT
> hierarchy.</P
><P
>When your news system determines that a certain article has not been subscribed
by you, it is <SPAN
CLASS="QUOTE"
>"junked"</SPAN
> i.e. such articles appear in the junk
directory. This
directory plays a key role in transferring articles to your NDNs as they would
subscribe to the junk hierarchy to receive feeds. If you are a leaf node, there
is no reason why articles should pile here. Keep deleting them on a daily 
basis.</P
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H2
CLASS="SECTION"
><A
NAME="AEN1207"
>11. Usenet news clients</A
></H2
><P
>This HOWTO was written to allow a Linux system administrator provide the
Usenet news service to readers of those articles. The rest of this HOWTO
focuses on the server-end software and systems, but one chapter
dedicated to the clients does not seem disproportionate, considering
that the <EM
>raison d'etre</EM
> of Usenet news servers is to serve
these clients.</P
><P
>The overwhelming majority of clients are software programs which access
the article database, either by reading <TT
CLASS="LITERAL"
>/var/spool/news</TT
> on a
Unix system or over NNTP, and allow their human users to read and post
articles. We can therefore probably term this class of programs UUA, for
Usenet User Agents, along the lines of MUA for Mail User Agents.</P
><P
>There are other special-purpose clients, which either pull out
articles to copy or transfer somewhere else, or for analysis,
<EM
>e.g.</EM
> a search engine which allows you to search a
Usenet article archive, like Google (<TT
CLASS="LITERAL"
>www.google.com</TT
>)
does.</P
><P
>This chapter will discuss issues in UUA software design, and bring out
essential features and efficiency and management issues. What this
chapter will certainly <EM
>never</EM
> attempt to do is catalogue all
the different UUA programs available in the world --- that is best left to
specialised catalogues on the Internet.</P
><P
>This chapter will also briefly cover special-purpose clients which
transfer articles or do other special-purpose things with them.</P
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1219"
>11.1. Usenet User Agents</A
></H3
><DIV
CLASS="SECTION"
><H4
CLASS="SECTION"
><A
NAME="AEN1221"
>11.1.1. Accessing articles: NNTP or spool area?</A
></H4
><P
>TO BE ADDED LATER</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN1224"
>11.1.2. Threading</A
></H4
><P
>TO BE ADDED LATER</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN1227"
>11.1.3. Quick reading features</A
></H4
><P
>TO BE ADDED LATER</P
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1230"
>11.2. Clients that transfer articles</A
></H3
><P
>We will discuss Suck and <TT
CLASS="LITERAL"
>nntpxfer</TT
> from the NNTP server
distribution here. Suck has already discussed earlier. We will be happy
to take contributed additions that discuss other client software.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1234"
>11.3. Special clients</A
></H3
><DIV
CLASS="SECTION"
><H4
CLASS="SECTION"
><A
NAME="AEN1236"
>11.3.1. NNTPCache</A
></H4
><P
>NNTPCache is an interesting transparent cacheing proxy for
    news articles. News articles are read-only by definition,
    <EM
>i.e.</EM
> they do not change once they are posted;
    they can only be deleted. NNTPCache uses this feature to build a
    local cache of news articles.</P
><P
>You set up NNTPCache to listen on the NNTP port of your local
    Unix server, and act like an NNTP daemon. You configure it to
    connect back-to-back to another NNTP daemon, further away, which has
    all the interesting stuff the users want to read. When a user
    connects to the local NNTPCache, it connects to the remote NNTP
    server and acts as a relay for the NNTP connection, ferrying
    commands and responses back and forth. What the user sees therefore
    comes from the remote server, the first time. However, all news
    articles fetched by NNTPCache are also stored in a local cache, thus
    allowing the next user to browse the same set of articles faster.
    Like all demand-driven caches, the advantage here is that the local
    NNTPCache does not need (much) administering, and will automatically
    delete all articles from its cache once they've been lying unread
    long enough.</P
><P
>We list it here as an NNTP client because every proxy server
    is a server on one side and a client on the other.</P
></DIV
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H2
CLASS="SECTION"
><A
NAME="AEN1242"
>12. Our perspective</A
></H2
><P
>This chapter has been added to allow us to share our perspective on
certain technical choices. Certain issues which are more a matter of
opinion than detail, are discussed here.</P
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="FEEDEFFICIENCY"
>12.1. Efficiency issues of NNTP</A
></H3
><P
>    To understand why NNTP is often an inappropriate choice for
    newsfeeds, we need to understand TCP's sliding window protocol
    and the nature of NNTP. NNTP is an apalling waste of bandwidth
    for most bulk article transfer situations, because of the
    following simple reasons:</P
><P
></P
><UL
><LI
><P
>    <EM
>No compression</EM
>: articles are transferred in plain text. </P
></LI
><LI
><P
> 
    <EM
>No article transmission restart</EM
>: if a
    connection breaks halfway through an article, the next round
    will have to start with the beginning of the article.</P
></LI
><LI
><P
> 
    <EM
>Ping-pong protocol</EM
>: NNTP is unsuitable for
    bulk streaming data transfer because the TCP sliding window feature
    is unusable with NNTP.</P
></LI
></UL
><P
>    What is a ping-pong protocol? TCP uses a sliding window mechanism to
    pump out data in one direction very rapidly, and can achieve near
    wire speeds under most circumstances. However, this only works if
    the application layer protocol can aggregate a large amount of data
    and pump it out without having to stop every so often, waiting for
    an ack or a response from the other end's application layer. This is
    precisely why sending one file of 100 Mbytes by FTP takes so much less
    clock time than 10,000 files of 10 Kbytes each, all other parameters
    remaining unchanged. The trick is to keep the sliding window sliding
    smoothly over the outgoing data, blasting packets out as fast as the
    wire will carry it, without ever allowing the window to empty out
    while you wait for an ack.  Protocols which require short bursts of
    data from either end constantly, <EM
>e.g.</EM
> in the
    case of remote procedure calls, are called ``ping pong protocols''
    because they remind you of a table-tennis ball.</P
><P
>    With NNTP, this is precisely the problem. The average size
    of Usenet news messages, including header and body, is
    3 Kbytes. When thousands of such articles are sent out by
    NNTP, the sending server has to send the message ID of the
    first article, then wait for the receiving server to respond
    with a ``yes'' or ``no.'' Once the sending server gets the
    ``yes'', it sends out that article, and waits for an ``ok''
    from the receiving server. Then it sends out the message ID
    of the second article, and waits for another ``yes'' or
    ``no.'' And so on. The TCP sliding window never gets to do
    its job.  </P
><P
>    This sub-optimal use of TCP's data pumping ability, coupled with
    the absence of compression, make for a protocol which is great
    for synchronous connectivity, <EM
>e.g.</EM
> for news
    reading or real-time
    updates, but very poor for batched transfer of data which can be
    delayed and pumped out. All these are precisely reversed in the
    case of UUCP over TCP.</P
><P
>    To decide which protocol, UUCP over TCP or NNTP, is appropriate
    for your server, you must address two questions:</P
><P
></P
><OL
TYPE="1"
><LI
><P
> 
    How much time can your server afford to wait from the time
    your upstream server receives an article to the time it
    passes it on to you?</P
></LI
><LI
><P
> 
    Are you receiving the same set of hierarchies from multiple
    next-door neighbour servers, <EM
>i.e.</EM
> is your
    newsfeed flow pattern a mesh instead of a tree?</P
></LI
></OL
><P
>    If your answers to the two questions above are ``messages cannot
    wait'' and ``we operate in a mesh'', then NNTP is the correct
    protocol for your server to receive its primary feed(s). </P
><P
>    In most cases, carrier-class servers operated by major service
    providers do not want to accept even a minute's delay from the
    time they receive an article to the time they retransmit it out.
    They also operate in a mesh with other servers operated by their
    own organisations (<EM
>e.g.</EM
> for redundancy) or
    others. They usually
    sit very close to the Internet backbone,
    <EM
>i.e.</EM
> with Tier 1 ISPs,
    and have extremely fast Internet links, usually more than
    10 Mbits/sec. The amount of data that flows out of such servers
    in outgoing feeds is more than the amount that comes in, because
    each incoming article is retained, not for local consumption,
    but for retransmission to others lower down in the flow. And
    these servers boast of a retransmission latency of less than 30
    seconds, <EM
>i.e.</EM
> I will retransmit an article
    to you within 30 seconds of my having received it.  </P
><P
>    However, if your server is used by a company for making Usenet
    news available for its employees, or by an institute to make the
    service available for its students and teachers, then you are
    not operating your server in a mesh pattern, nor do you mind it
    if messages take a few hours to reach you from your upstream
    neighbour. </P
><P
>    In that case, you have enormous bandwidth to conserve by moving
    to UUCP.  Even if, in this Internet-dominated era, you have no
    one to supply you with a newsfeed using dialup point-to-point
    links, you can pick up a compressed batched newsfeed using UUCP
    over TCP, over the Internet.  </P
><P
>    In this context, we want to mention Taylor UUCP, an excellent
    UUCP implementation available under GNU GPL. We use this UUCP
    implementation in preference to the bundled UUCP systems offered
    by commercial Unix vendors even for dialup connections, because
    it is far more stable, high performance, and always supports
    file transfer restart. Over TCP/IP, Taylor is the only one we
    have tried, and we have no wish to try any others.  </P
><P
>    Apart from its robustness, Taylor UUCP has one invaluable
    feature critical to large Usenet batch transfers: file transfer
    restart. If it is transferring a 10 MB batch, and the connection
    breaks after 8 MB, it will restart precisely where it left off
    last time. Therefore, no bytes of bandwidth are wasted, and
    queues never get stuck forever.  </P
><P
>    Over NNTP, since there is no batching, transfers happen one
    article at a time. Considering the (relatively) small size of an
    article compared to multi-megabyte UUCP batches, one would
    expect that an article would never pose a major problem while
    being transported; if it can't be pushed across in one attempt,
    it'll surely be copied the next time.  However, we have
    experienced entire NNTP feeds getting stuck for days on end
    because of one article, with logs showing the same article
    breaking the connection over and over again while being
    transferred <A
NAME="AEN1280"
HREF="#FTN.AEN1280"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
>. Some rare articles can be
    more than a megabyte in size, particularly in
    <TT
CLASS="LITERAL"
>comp.binaries</TT
>. In each such incident, we have
    had to manually edit the queue file on the transmitting server
    and remove the offending article from the head of the queue.
    Taylor UUCP, on the other hand, has never given us a single
    hiccup with blocked queues.  </P
><P
>    We feel that the overwhelming majority of servers offering the
    Usenet news service are at the leaf nodes  of the Usenet news
    flow, not at the heart. These servers are usually connected in a
    tree, with each server having one upstream ``parent node'', and
    multiple downstream ``child nodes.'' These servers receive their
    bulk incoming feed from their upstream server, and their users
    can tolerate a delay of a few hours for articles to move in and
    out. If your server is in this class, we feel you should
    consider using UUCP over TCP and transfer compressed batches.
    This will minimise bandwidth usage, and if you operate using
    dialup Internet connections, it will directly reduce your
    expenses.  </P
><P
>    A word about the link between mesh-patterned newsfeed flow and
    the need to use NNTP. If your server is receiving primary ---
    as against trickle --- feeds from multiple next-door neighbours,
    then you have to use NNTP to receive these feeds. The reason
    lies in the way UUCP batches are accepted. UUCP batches are
    received in their entirety into your server, and then they are
    uncompressed and processed. When the sending server is giving
    you the batch, it is not getting a chance to go through the
    batch article by article and ask your server whether you have or
    don't have each article. This way, if multiple servers give you
    large feeds for the same hierarchies, then you will be bound to
    receive multiple copies of each article if you go the UUCP way.
    All the gains of compressed batches will then be neutralised.
    NNTP's <TT
CLASS="LITERAL"
>IHAVE</TT
> and <TT
CLASS="LITERAL"
>SENDME</TT
>
    dialogue in effect
    permits precisely this double-check for each article, and thus
    you don't receive even a single  article twice. </P
><P
>    For Usenet servers which connect to the Internet periodically
    using dialup connections to fetch news, the UUCP option is
    especially important. Their primary incoming newsfeed cannot be
    pushed into them using queued NNTP feeds for reasons described
    in the above <A
HREF="#DIALUPNONNTP"
>paragraph</A
>
    These
    hapless servers are usually forced to pull out their articles
    using a pull NNTP feed, which is often very slow. This may lead
    to long connect times, repeat attempts after every line break,
    and high Internet connection charges.  </P
><P
>    On the other hand, we have been using UUCP over TCP and
    <TT
CLASS="LITERAL"
>gzip</TT
>'d batches for more than five years now
    in a variety of sites. Even today, a full feed of all eight
    standard hierarchies, plus the full
    <TT
CLASS="LITERAL"
>microsoft</TT
>, <TT
CLASS="LITERAL"
>gnu</TT
>
    and <TT
CLASS="LITERAL"
>netscape</TT
> hierarchies, minus 
    <TT
CLASS="LITERAL"
>alt</TT
> and <TT
CLASS="LITERAL"
>comp.binaries</TT
>, can
    comfortably be handled in just a few hours of connect time every
    night, dialing up to the 
    Internet at 33.6 or 56 Kbits/sec. We believe that the proverbial
    `full feed' with all hierarchies including
    <TT
CLASS="LITERAL"
>alt</TT
> can be handled comfortably with a 24-hour
    link at 56 Kbits/sec, provided you forget about NNTP feeds. We
    usually get compression ratios of 4:1 using
    <TT
CLASS="LITERAL"
>gzip -9</TT
> on our news batches, incidentally. </P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1298"
>12.2. C-News+NNTPd or INN?</A
></H3
><P
>INN and CNews are the two most popular free software implementations
of Usenet news. Of these two, we prefer CNews, primarily because
we have been using it across a very large range of Unixen for more
than one decade, starting from its earliest release --- the so-called
``Shellscript release'' --- and we have yet to see a need to
change.<A
NAME="AEN1301"
HREF="#FTN.AEN1301"
><SPAN
CLASS="footnote"
>[2]</SPAN
></A
></P
><P
>We have seen INN, and we are not comfortable with a software
implementation which puts in so much of functionality inside one
executable. This reminds us of Windows NT, Netscape Communicator,
and other complex and monolithic systems, which make us uncomfortable
with their opaqueness. We feel that CNews' architecture, which comprises
many small programs, intuitively fits into the Unix approach of building
large and complex systems, where each piece can be understood, debugged,
and if needed, replaced, individually.</P
><P
>Secondly, we seem to see the move towards INN accompanied by a move
towards NNTP as a primary newsfeed mechanism. This is no fault of INN;
we suspect it is a sort of cultural difference between INN users and
CNews users.  We find the issue of UUCP versus NNTP for batched newsfeeds
a far more serious issue than the choice of CNews versus INN. We simply
cannot agree with the idea that NNTP is an appropriate protocol for bulk
Usenet feeds for most sites. Unfortunately, we seem to find that most
sites which are more comfortable using INN seem to also prefer NNTP over
UUCP, for reasons not clear to us.</P
><P
>Our comments should not be taken as expressing any reservation about
INN's quality or robustness. Its popularity is testimony to its
quality; it most certainly ``gets the job done'' as well as anything
else. In addition, there are a large number of commercial Usenet news
server implementations which have started with the INN code; we do not
know of any which have started with the CNews code. The Netwinsite DNews
system and the Cyclone Typhoon, we suspect, both are INN-spired.</P
><P
>We will recommend CNews and NNTPd over INN, because we are more
comfortable with the CNews architecture for reasons given above, and we
do not run carrier-class sites. We will continue to support, maintain and
extend this software base, at least for Linux.  And we see no reason for
the overwhelming majority of Usenet sites to be forced to use anything
else. Your viewpoints welcome.</P
><P
>Had we been setting up and managing carrier-class sites with their
near-real-time throughput requirements, we would probably not have
chosen CNews. And for those situations, our opinion of NNTP versus
compressed UUCP has been discussed in <A
HREF="#FEEDEFFICIENCY"
>Section 12.1</A
>&#62;</P
><P
>Suck and Leafnode have their place in the range of options, where they
appear to be attractive for novices who are intimidated by the ``full
blown'' appearance of CNews+NNTPd or INN. However, we run CNews + NNTPd
even on Linux laptops. We suspect INN can be used this way too. We do
not find these ``full blown'' implementations any more resource
hungry than their simpler cousins. Therefore, other than administration
and configuration familiarity, we don't see any other reason why even a
solitary end-user will choose Leafnode or Suck over CNews+NNTPd. As
always, contrary opinions invited.</P
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H2
CLASS="SECTION"
><A
NAME="SOFTWAREHISTORY"
>13. Usenet software: a historical perspective</A
></H2
><P
>This section comprises excerpts from a well-known Usenet Periodic
Posting document which was last changed in Feb 1998. Our copy of that old
document was picked up from</P
><P
><TT
CLASS="LITERAL"
>ftp://rtfm.mit.edu/pub/usenet-by-hierarchy/news/software/b/Usenet_Software:_History_and_Sources</TT
></P
><P
>We suspect other copies will also be found elsewhere. The physical
file on the FTP server appears to have been touched last on 29 Dec
1999. The first few lines of the archived file provide information about
the origin of this document and its authors:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>Date: Tue, 28 Dec 1999 09:00:19 GMT
Supersedes: &#60;FMMECL.58s@tac.nyc.ny.us&#62;
Expires: Fri, 28 Jan 2000 09:00:19 GMT
Message-ID: &#60;FnG10J.HAo@tac.nyc.ny.us&#62;
From: netannounce@deshaw.com (Mark Moraes)
Subject: Usenet Software: History and Sources
Newsgroups: news.admin.misc,news.announce.newusers,news.software.readers,news.software.b,news.answers
Followup-To: news.newusers.questions
Approved: netannounce@deshaw.com (Mark Moraes)

Archive-name: usenet/software/part1
Original-from: spaf@cs.purdue.edu (Gene Spafford)
Comment: edited until 5/93 by spaf@cs.purdue.edu (Gene Spafford)
Last-change: 9 Feb 1998 by netannounce@deshaw.com (Mark Moraes)
Changes-posted-to: news.admin.misc,news.misc,news.software.readers,news.software.b,news.answers</PRE
></FONT
></TD
></TR
></TABLE
><P
>We have been seeing this document as a periodic posting in
<TT
CLASS="LITERAL"
>news.announce.newusers</TT
> since the early nineties, and
it has always been our final reference on the history of Usenet
server software. We reproduce excerpts below, retaining the portions
which discuss server software, and removing discussions of client
software, newsreaders, software for non-Unix operating systems,
<EM
>etc.</EM
> All quoted portions are reproduced unedited
other than changing FTP file paths to the modern URL format.  We have
added our comments emphasised, in separate paragraphs.  We feel the
information captured here is essential reading for anyone interested in
Usenet server software.</P
><P
>If anyone can point us to a fresher version of this document, in
case it is still maintained, we will be happy to refer to that version
instead of this one, though we suspect the reader will not suffer due to
the four-year gap; most of the information reproduced below is
historical anyway.</P
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1321"
>13.1. The quoted excerpts</A
></H3
><P
>Currently, Usenet readers interact with the news using a number of
software packages and programs.  This article mentions the important
ones and a little of their history, gives pointers where you can look
for more information and ends with some special notes about ``foreign''
and ``obsolete'' software.  At the very end is a list of sites from which
current versions of the Usenet software may be obtained.</P
><P
> ... </P
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN1325"
>13.1.1. History</A
></H4
><P
>Usenet came into being in late 1979, shortly after the release of V7
Unix with UUCP.  Two Duke University grad students in North Carolina,
Tom Truscott and Jim Ellis, thought of hooking computers together to
exchange information with the Unix community.  Steve Bellovin, a grad
student at the University of North Carolina, put together the first
version of the news software using shell scripts and installed it on the
first two sites: <TT
CLASS="LITERAL"
>unc</TT
> and <TT
CLASS="LITERAL"
>duke</TT
>. At
the beginning of 1980 the network consisted of those two sites and
<TT
CLASS="LITERAL"
>phs</TT
> (another machine at Duke), and was described
at the January Usenix conference.  Steve Bellovin later rewrote
the scripts into C programs, but they were never released beyond
<TT
CLASS="LITERAL"
>unc</TT
> and <TT
CLASS="LITERAL"
>duke</TT
>. Shortly thereafter,
Steve Daniel did another implementation in C for public distribution.
Tom Truscott made further modifications, and this became the ``A'' news
release.</P
><P
>In 1981 at U. C. Berkeley, grad student Mark Horton and high school
student Matt Glickman rewrote the news software to add functionality
and to cope with the ever increasing volume of news -- ``A'' News was
intended for only a few articles per group per day.  This rewrite was
the ``B'' News version.  The first public release was version 2.1 in
1982; the 1.* versions were all beta test.  As the net grew, the news
software was expanded and modified.  The last version maintained and
released primarily by Mark was 2.10.1.</P
><P
>Rick Adams, at the Center for Seismic Studies, took over
coordination of the maintenance and enhancement of the B News software
with the 2.10.2 release in 1984.  By this time, the increasing volume
of news was becoming a concern, and the mechanism for moderated groups
was added to the software at 2.10.2.  Moderated groups were inspired by
ARPA mailing lists and experience with other bulletin board systems.
In late 1986, version 2.11 of B News was released, including a number
of changes to support a new naming structure for newsgroups, enhanced
batching and compression, enhanced <TT
CLASS="LITERAL"
>ihave/sendme</TT
>
control messages, and other features.</P
><P
>The final release of B News was 2.11, patchlevel 19.  B News has
been declared ``dead'' by a number of people, including Rick Adams, and
is unlikely to be upgraded further; most Usenet sites are using C News
or INN (see next paragraphs).</P
><P
>In March 1986 a package was released implementing news transmission,
posting, and reading using the Network News Transfer Protocol (NNTP)
(as specified in RFC 977).  This protocol allows hosts to exchange
articles via TCP/IP connections rather than using the traditional UUCP.
It also permits users to read and post news (using a modified news user
agent) from machines which cannot or choose not to install the Usenet
news software.  Reading and posting are done using TCP/IP messages to a
server host which does run the Usenet software.  Sites which have many
workstations like the Sun and SGI, and HP products find this a convenient
way to allow workstation users to read news without having to store
articles on each system.  Many of the Usenet hosts that are also on the
Internet exchange news articles using NNTP because the load impact of NNTP
is much lower than UUCP (and NNTP ensures much faster propagation).</P
><P
><EM
>Our comments: This remark about relative loadings
    of UUCP and NNTP is no longer applicable with faster machines and
    networks, and with hugely increased traffic volumes. Today's desktop
    computers, let alone servers, can all handle both NNTP and UUCP loads
    effortlessly, if traffic volumes can be restricted. This is partly
    due to performance enhancements to UUCP as embodied in Taylor UUCP,
    and partly due to vastly faster processors.</EM
></P
><P
>NNTP grew out of independent work in 1984-1985 by Brian Kantor
at U.  C.  San Diego and Phil Lapsley at U. C. Berkeley.  Primary
development was done at U. C. Berkeley by Phil Lapsley with help from
Erik Fair, Steven Grady, and Mike Meyer, among others.  The NNTP package
(now called the reference implementation) was distributed on the 4.3BSD
release tape (although that was version 1.2a and out-of-date) and is
also available on many major hosts by anonymous FTP.  The current
version is 1.5.12.2.  It includes NOV (News Overview -- see below)
support and runs on a wide variety of systems.  It is available from
<TT
CLASS="LITERAL"
>ftp.academ.com:/pub/nntp1.5/nntp.1.5.12.2.tar.gz</TT
>.
For those with access to the World-Wide Web on the Internet, the
WWW page <TT
CLASS="LITERAL"
>http://www.academ.com/academ/nntp.html</TT
>
contains a description and news about NNTP.  A different
variant, called nntp-t5, implements many of the extensions
provided by INN (including NOV support).  It is available from
<TT
CLASS="LITERAL"
>ftp.uu.net:/networking/news/nntp/nntp-t5.tar.gz</TT
>.</P
><P
>One widely-used version of news, known as C News, was developed
at the University of Toronto by Geoff Collyer and Henry Spencer.  This
version is a rewrite of the lowest levels of news to increase article
processing speed, decrease article expiration processing and improve the
reliability of the news system through better locking, etc.  The package
was released to the net in the autumn of 1987.  For more information,
see the paper ``News Need Not Be Slow,'' published in The Winter 1987
Usenix Technical Conference proceedings.  This paper is also available
from <TT
CLASS="LITERAL"
>ftp://ftp.cs.toronto.edu/doc/programming/c-news.*,</TT
>
and is recommended reading for all news software programmers.  The most
recent version of C News is the Sept 1994 ``Cleanup Release.''  C News
can be obtained by anonymous ftp from its official archive site,
<TT
CLASS="LITERAL"
>ftp.cs.toronto.edu:pub/c-news/c-news.tar.Z</TT
>.  </P
><P
><EM
>Our comments: C News is no longer maintained by
    anyone that we know, other than ourselves. However, after fixing
    the remaining bugs in the source, we have not found the need for
    further maintenance.  NNTPd from Brian Kantor and Phil Lapsley is
    in the same state, but we are working on enhancements to the source
    for access control and other functionality.</EM
></P
><P
>Another Usenet system, known as InterNetNews, or INN, was written by
Rich Salz <TT
CLASS="LITERAL"
>(rsalz@uunet.uu.net)</TT
>.  INN is designed to run
on Unix hosts that have a socket interface.  It is optimized for larger
hosts where most traffic uses NNTP, but it does provide full UUCP support.
INN is very fast, and since it integrates NNTP many people find it easier
to administer only one package.  The package was publicly released on
August 20, 1992.  For more information, see the paper ``InterNetNews:
Usenet Transport for Internet Sites'' published in the June 1992
Usenix Technical Conference Proceedings.  INN can be obtained
from many places, including the 4.4BSD tape; its official
archive site is <TT
CLASS="LITERAL"
>ftp.uu.net</TT
> in the directory
<TT
CLASS="LITERAL"
>/networking/news/nntp/inn</TT
>.  Rich's last official
release was 1.4sec in Dec 1993.</P
><P
><EM
>Our comments: The original paper by Rich Salz about
    INN, where he proposed the design of an alternate Usenet server
    software, is a must-read for readers interested in Usenet server
    software. So is the paper by C News authors, cited before it. Most of
    the issues that Rich Salz had with C News, as stated in his paper,
    were very relevant at that time. Today, with the current version of
    NNTPd and the incorporation of the message ID daemon and NOV, these
    issues are no longer relevant, and the choice of C News+NNTPd versus
    INN is now based more on the level of maintenance of source code,
    familiarity and personal preferences than on core design factors.
    </EM
></P
><P
>In June 1995, David Barr began a series of unoffical releases
of INN based on 1.4sec, integrating various bug-fixes, enhancements
and security patches.  His last release was 1.4unoff4, found in
<TT
CLASS="LITERAL"
>ftp://ftp.math.psu.edu:/pub/INN</TT
>.  This site is also the
home of contributed software for INN and other news administration
tools.</P
><P
>INN is now maintained by the Internet Software Consortium
<TT
CLASS="LITERAL"
>(inn@isc.org)</TT
>.  The official INN home is now
<TT
CLASS="LITERAL"
>http://www.isc.org/isc/</TT
> and the latest version (1.7.2)
can be obtained from <TT
CLASS="LITERAL"
>ftp://ftp.isc.org/isc/inn/</TT
>.</P
><P
><EM
>Our comments: The URL for the INN home page above
    is probably incorrect. Try http://www.isc.org/products/INN/.
    </EM
></P
><P
>Towards the end of 1992, Geoff Collyer implemented NOV (News
Overview): a database that stores the important headers of all news
articles as they arrive.  This is intended for use by the implementors
of news readers to provide fast article presentation by sorting and
``threading'' the article headers.  (Before NOV, newsreaders like
<TT
CLASS="LITERAL"
>trn</TT
>, <TT
CLASS="LITERAL"
>tin</TT
> and <TT
CLASS="LITERAL"
>nn</TT
>
came with their own daemons and databases that used a nontrivial amount
of system resources).  NOV is fully supported by C News, INN and NNTP-t5.
Most modern news readers use NOV to get information for their threading
and article menu presentation; use of NOV by a newsreader is fairly easy,
since NOV comes with sample client-side threading code.</P
><P
> ... </P
><P
>Details on many other mail and news readers for MSDOS, Windows and
OS/2 systems can be found in the FAQ posted to
<TT
CLASS="LITERAL"
>comp.os.msdos.mail-news</TT
>.</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>  &#60;ftp://rtfm.mit.edu/pub/usenet/comp.os.msdos.mail-news/intro&#62;
  &#60;ftp://rtfm.mit.edu/pub/usenet/comp.os.msdos.mail-news/software&#62;</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN1371"
>13.1.2. Newsfeed management software</A
></H4
><P
><EM
>Gup</EM
>, the Group Update Program is a Unix
mail-server program that lets a remote site change their newsgroups
subscription on their news feed without requiring the intervention of
the news administrator at the feed site.  Gup operates with the INN
(and likely the C News) batching mechanisms.  The news administrators
at the remote sites simply mail commands to gup to make changes to
their own site's subscription list.  The mail/interface is password
protected.  Gup checks the requests for valid newsgroup names,
patterns that have no effect and so on. Gup's authors are Mark
Delany (<TT
CLASS="LITERAL"
>markd@mira.net.au</TT
>) and Andrew Herbert
(<TT
CLASS="LITERAL"
>andrew@mira.net.au</TT
>).  Its official FTP location
is <TT
CLASS="LITERAL"
>ftp.mira.net.au:/unix/news/gup-0.4.tar.gz</TT
>,
but since that's not as well connected as UUNET, people are strongly
advised to obtain it from a mirror site, <EM
>e.g.</EM
>
<TT
CLASS="LITERAL"
>ftp.uu.net:/networking/news/misc/gup-0.4.tar.gz</TT
>.</P
><P
><EM
><TT
CLASS="LITERAL"
>dynafeed</TT
></EM
> is
a package from Looking Glass Software Limited that maintains a
<TT
CLASS="LITERAL"
>.newsrc</TT
> for every remote site and generates the batches
for them.  Remote sites can use UUCP or run a program to change their
<TT
CLASS="LITERAL"
>.newsrc</TT
> dynamically.  It comes with a program that the
remote site can run to monitor readership in newsgroups and dynamically
update the feed list to match reader interest.  The goal of this is
to get a feed that sends only exactly the groups currently being read.
<TT
CLASS="LITERAL"
>dynafeed</TT
> can be obtained from
<TT
CLASS="LITERAL"
>ftp://ftp.clarinet.com/sources/dynafeed.tar.Z</TT
>.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN1387"
>13.1.3. News processing software</A
></H4
><P
>Software also exists to automatically archive Usenet newsgroups.
The package <TT
CLASS="LITERAL"
>rkive</TT
>, written by Kent Landfield
(<TT
CLASS="LITERAL"
>kent@sterling.com</TT
>) can be configured to archive
news automatically based on different headers -- Archive-Name,
Volume-Issue, Chronological, Subject and External-Command to
name a few.  It can be run in batch mode from the command line or
from cron.  It can also be installed in the <TT
CLASS="LITERAL"
>sys</TT
>
or <TT
CLASS="LITERAL"
>newsfeeds</TT
> file to process articles as they are
received.  <TT
CLASS="LITERAL"
>rkive</TT
> supports local spool directories as
well as NNTP based access.  <TT
CLASS="LITERAL"
>rkive</TT
> is available via
FTP from <TT
CLASS="LITERAL"
>ftp://ftp.sterling.com/rkive</TT
>.  </P
><P
>Newsclip is a programming language for writing news
filtering programs, from Looking Glass Software Limited, marketed
by ClariNet Communications Corp.  It is C-like, and translates to
C, so a C compiler is required.  It has data-types to represent
the kinds of things found in article headers and bodies.  It can
maintain databases of users, message-ids, patterns, subjects, etc.
These can be used to decide whether to ignore or select an article.
Newsclip can either operate as a standalone program or as part
of rn. It is free for non-commercial use and is available from
<TT
CLASS="LITERAL"
>ftp://ftp.clarinet.com/sources/nc.tar.Z</TT
>.  Contact
<TT
CLASS="LITERAL"
>clari-info@clarinet.com</TT
> with a subject line of
``newsclip'' for more info.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN1400"
>13.1.4. Commercial software</A
></H4
><P
>DNEWS is a commercial product from NetWin.  DNEWS licenses
are provided free to educational institutions for non profit
use. With DNEWS, the news is stored in a database so as not to
overload the raw file system.  DNEWS supports 'sucking' where only
groups which users read are pulled over from the feeder site. DNEWS
is currently known to run on VMS, Windows NT, Solaris, SunOS,
Unixware, HP/UX.  DNEWS binaries are available by anonymous FTP from
<TT
CLASS="LITERAL"
>ftp://ftp.std.com/ftp/vendors/netwin/dnews</TT
> or from
<TT
CLASS="LITERAL"
>http://world.std.com/~netwin/</TT
> DNEWS sources can be
obtained on request, see the file <TT
CLASS="LITERAL"
>source.txt</TT
> in the
FTP area for more information.</P
><P
><EM
>Our comments: The information on DNEWS may be dated. We
have been seeing DNEWS on their own Website for quite a few years now.
Check <TT
CLASS="LITERAL"
>www.netwinsite.com</TT
>. Moreover, there are other
commercial Usenet server software systems available, including the one
bundled with the Internet Information Server of Microsoft Windows NT and
the ones from iPlanet. And for carrier class systems, there are many
commercial Usenet routers available.</EM
></P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN1409"
>13.1.5. Special note on ``notes'' and old versions of news</A
></H4
><P
> ... </P
><P
>``B'' news software is currently considered obsolete.  Unix sites
joining the Usenet should install C news or INN to ensure proper
behavior and good performance.  Most old B news software had
compiled-in limits on the number of newsgroups and the number of
articles per newsgroup; the increasing volume of news means that B
news software cannot reliably cope with a moderately-full newsfeed.</P
></DIV
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H2
CLASS="SECTION"
><A
NAME="AEN1413"
>14. Documentation, information and further reading</A
></H2
><P
>This section fills in gaps which were hard to classify under any
of the previous chapters.</P
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1416"
>14.1. The manpages</A
></H3
><P
>The following manpages are installed automatically when our
integrated software distribution is compiled and installed, listed here
in no particular order:</P
><P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>badexpiry:</TT
>
utility to look for articles with bad explicit Expiry headers</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>checkactive:</TT
>
utility to perform some sanity checks on the <TT
CLASS="LITERAL"
>active</TT
>
file</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>cnewsdo:</TT
>
utility to perform some checks and then run C-News maintenance commands</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>controlperm:</TT
>
configuration file for controlling responses to Usenet control messages</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>expire:</TT
>
utility to expire old articles</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>explode:</TT
>
internal utility to convert a master batch file to ordinary batch files</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>inews:</TT
>
the program which forms the entry point for fresh postings to be
injected into the Usenet system</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>mergeactive:</TT
>
utility to merge one site's newsgroups to another site's
<TT
CLASS="LITERAL"
>active</TT
> file</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>mkhistory:</TT
>
utility to rebuild news <TT
CLASS="LITERAL"
>history</TT
> file</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>news(5):</TT
>
description of Usenet news article file and batch file formats</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newsaux:</TT
>
a collection of C-News utilities used by its own scripts and by the
Usenet news administrator for various maintenance purposes</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newsbatch:</TT
>
covers all the utilities and programs which are part of the news
batching system of C-News</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newsctl:</TT
>
describes the file formats and uses of all the files in
<TT
CLASS="LITERAL"
>$NEWSCTL</TT
> other than the two key files,
<TT
CLASS="LITERAL"
>sys</TT
> and <TT
CLASS="LITERAL"
>active</TT
></P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newsdb:</TT
>
describes the key files and directories for news articles, including the
structure of <TT
CLASS="LITERAL"
>$NEWSARTS</TT
>, the <TT
CLASS="LITERAL"
>active</TT
>
file, the <TT
CLASS="LITERAL"
>active.times</TT
> file, and the
<TT
CLASS="LITERAL"
>history</TT
> file.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newsflag:</TT
>
utility to change the flag or type column of a newsgroup in the
<TT
CLASS="LITERAL"
>active</TT
> file</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newsmail:</TT
>
utility scripts used to send and receive newsfeeds by email. This is
different from a mail-to-news gateway, since this is for communication
between two Usenet news servers.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newsmaint:</TT
>
utility scripts used by Usenet administrator to manage and maintain
C-News system</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newsoverview(5):</TT
>
file formats for the NOV database</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newsoverview(8):</TT
>
library functions of the NOV library and the utilities which use them</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>newssys:</TT
>
the important <TT
CLASS="LITERAL"
>sys</TT
> file of C-News</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>relaynews:</TT
>
the <TT
CLASS="LITERAL"
>relaynews</TT
> program of C-News</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>report:</TT
>
utility to generate and send email reports of errors and events from
C-News scripts</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>rnews:</TT
>
receive news batches and queue them for processing</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>nntpd:</TT
>
The NNTP daemon</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>nntpxmit:</TT
>
The NNTP batch transmit program for outgoing push feeds</P
></LI
></UL
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1508"
>14.2. Papers, documents, articles</A
></H3
><P
>There are certain documents and published conference papers which
are a must-read for Usenet server administrators, both for their
historical value and for the insight they give into Usenet server
architecture in general. We list our chart-toppers here.</P
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN1511"
>14.2.1. The Usenix paper on C News</A
></H4
><P
>This very interesting paper has been mentioned in the section titled
<SPAN
CLASS="QUOTE"
>"<A
HREF="#SOFTWAREHISTORY"
>Usenet software: a historical perspective</A
>&#62;"</SPAN
>. It is titled ``News
Need Not Be Slow'', and is available from
<TT
CLASS="LITERAL"
>ftp://ftp.cs.toronto.edu/doc/programming/c-news.*</TT
> or
from our Website
(<TT
CLASS="LITERAL"
>http://www.starcomsoftware.com/proj/usenet/doc/c-news.{ps,pdf}</TT
>).</P
><P
>It focuses on B News, analyses it for performance, and
demonstrates how specific changes in design and implementation can speed
things up. It is well-written, and is educative in many areas
independent of Usenet news.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN1519"
>14.2.2. The Usenix paper on INN</A
></H4
><P
>This paper talks about the things that C News didn't address,
and takes Usenet news processing into the world of pure Internet
connectivity. Its author is Rich Salz, the author of INN, and the paper
is titled ``InterNetNews: Usenet Transport for Internet Sites.'' This
can be picked up from
<TT
CLASS="LITERAL"
>ftp://ftp.uu.net/networking/news/nntp/inn/inn.usenix.ps.Z</TT
>
or from our Website
(<TT
CLASS="LITERAL"
>http://www.starcomsoftware.com/proj/usenet/doc/inn.usenix.{ps,pdf}</TT
>),
uncompressed.
Be warned: this PostScript file is probably missing some mandatory
first-line tag like <TT
CLASS="LITERAL"
>%!PS-Adobe-1.0</TT
> and some
PostScript processors can have problems with it. For instance, on our
Linux boxes, <TT
CLASS="LITERAL"
>ghostview</TT
> can display it, but
<TT
CLASS="LITERAL"
>kghostview</TT
> can't, which is very strange.</P
><P
>This paper analyses the world of Usenet servers with C News and
NNTPd, in the presence of multiple parallel feeds, and proceeds to build
a case for a powerful NNTP-optimised software architecture which will
handle multiple parallel incoming NNTP feeds efficiently. What later INN
users appear to miss sometimes when comparing C-News+NNTPd with INN, is
that INN's strengths are <EM
>only</EM
> in situations which
its author had specifically targeted, <EM
>i.e.</EM
> multiple
parallel incoming NNTP feeds. There is no clear superiority of one
system over the other in any other situation.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H4
CLASS="SECTION"
><A
NAME="AEN1530"
>14.2.3. The C News guide</A
></H4
><P
>This document is part of the C-News source, and is available in
the <TT
CLASS="LITERAL"
>c-news/doc</TT
> directory of the source tree. The
<TT
CLASS="LITERAL"
>makefile</TT
> here uses <TT
CLASS="LITERAL"
>troff</TT
> and the
source files to generate <TT
CLASS="LITERAL"
>guide.ps</TT
>. This C News Guide
is a very well-written document and provides an introduction to the
functioning of C News.</P
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1537"
>14.3. O'Reilly's books on Usenet news</A
></H3
><P
>O'Reilly and Associates had an excellent book that can form the
foundations for understanding C-News and Usenet news in general, titled
``Managing UUCP and Usenet,'' dated 1992. This was considered a bit
dated because it did not cover INN or the Internet protocols.</P
><P
>They have subsequently published a more recent book, titled
``Managing Usenet,'' written by Henry Spencer, the co-author of C-News,
and David Lawrence, one of the most respected Usenet veterans and
administrators today. The book was published in 1998 and includes both
C-News and INN.</P
><P
>We have a distinct preference for books published by O'Reilly; we
usually find them the best books on their subjects. We make no attempts
to hide this bias. We recommend both books. In fact, we believe that
there is very little of value in this HOWTO for someone who studies one
of these books and then peruses information on the Internet.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1542"
>14.4. Usenet-related RFCs</A
></H3
><P
>TO BE ADDED</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1545"
>14.5. The source code</A
></H3
><P
>TO BE ADDED</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1548"
>14.6. Usenet newsgroups</A
></H3
><P
>There are many discussion groups on the Usenet dedicated to the
technical and non-technical issues in managing a Usenet server and
service. These are:</P
><P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>news.admin.technical</TT
>
Discusses technical issues about administering Usenet news</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>news.admin.policy</TT
>
Discusses policy issues about Usenet news</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>news.software.b</TT
>
Discusses C-News (no separate newsgroup was created after B-News gave
way to C-News) source, configuration and bugs (if any)</P
></LI
></UL
><P
>MORE WILL BE ADDED LATER</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1562"
>14.7. We</A
></H3
><P
>We, at Starcom Software, offer the services of our Usenet news
team to provide assistance to you by email, as a service to the Linux
and Usenet administrator community, on a best effort basis.</P
><P
>We also offer you an integrated source distribution
of C News, NNTPd, as discussed earlier in the section titled
<SPAN
CLASS="QUOTE"
>"<A
HREF="#SETTINGUP"
>Setting up C News + NNTPd</A
>&#62;"</SPAN
>. This integrated
source distribution fixes some bugs in the component packages it
includes, and it comes pre-configured with ready made configuration
files which allow all components to be compiled and installed
on a Linux server in a manner by which they can work together
(<EM
>e.g.</EM
> key directory paths are specified consistently
across all components, <EM
>etc.</EM
>) This is available at
<TT
CLASS="LITERAL"
>http://www.starcomsoftware.com/proj/usenet/src/</TT
></P
><P
>The URL
<TT
CLASS="LITERAL"
>http://www.starcomsoftware.com/proj/usenet/src/archives/</TT
>
holds the original sources of some of the software components we base our
distribution on. These include C News (<TT
CLASS="LITERAL"
>c-news.tar.Z</TT
>),
NNTPd (<TT
CLASS="LITERAL"
>nntp.1.5.12.1.tar.Z</TT
>), and Nestor
(<TT
CLASS="LITERAL"
>nestor.tar.Z</TT
>). Other components, like
<TT
CLASS="LITERAL"
>pgpverify</TT
> are maintained by their current maintainers
and can be obtained from their respective sites. Therefore, they are not
included in our archives.</P
><P
>The URL
<TT
CLASS="LITERAL"
>http://www.starcomsoftware.com/proj/usenet/doc/</TT
>
carries copies of some of the important technical articles and Usenix
papers on the subject of the Usenet.</P
><P
>We will endeavour to answer all queries sent to
<TT
CLASS="LITERAL"
>usenet@starcomsoftware.com</TT
>, pertaining to the source
distribution we have put together and its configuration and maintenance,
and also pertaining to general technical issues related to running a
Usenet news service off a Unix or Linux server.</P
><P
>We may not be in a position to assist with software components we
are not familiar with, <EM
>e.g.</EM
> Leafnode, or platforms
we do not have access to, <EM
>e.g.</EM
> SGI IRIX. Intel
Linux will be supported as long as our group is alive; our entire office
runs on Linux servers and diskless Linux desktops.</P
><P
>You are not forced to be dependent on us, because neither do we
have proprietary knowledge nor proprietary closed-source software. All
the extensions we are currently involved in with C-News and NNTPd will
immediately be made available to the Internet in freely redistributable
source form.</P
></DIV
></DIV
><DIV
CLASS="SECTION"
><HR><H2
CLASS="SECTION"
><A
NAME="AEN1585"
>15. Wrapping up</A
></H2
><DIV
CLASS="SECTION"
><H3
CLASS="SECTION"
><A
NAME="AEN1587"
>15.1. Acknowledgements</A
></H3
><P
>This HOWTO is a by-product of many years of experience setting up and
managing Usenet news servers. We have learned a lot from those who have
trod the path ahead of us. Some of them include the team of the ERNET
Project (Educational and Research Network), which brought the Internet
technology to India's academic institutions in the early
nineties. We specially remember what we have learned from the
<EM
>SIGSys</EM
> Group of the Department of Computer Science
of the Indian Institute of Technology, Mumbai. We have also benefited
enormously from the guidance we received from the Networking Group at
the NCST (National Centre for Software Technology) in Mumbai, specially
from Geetanjali Sampemane.  </P
><P
>On a wider scale, our learning along the path of systems and
networks started with Unix, without which our appreciation of computer
systems would have remained very fragmented and superficial. Our insight
into Unix came from our ``Village Elders'' in the Department of Computer
Science of the IIT (Indian Institute of Technology) at Mumbai, specially
from ``Hattu,'' ``Sathe,'' and ``Sapre,'' none of whom are with the IIT
today, and from Professor D. B. Phatak and others, many of whom, luckily
are still with the Institute.</P
><P
>Coming to Starcom, all the members of Starcom Software who
have worked on various problems with networking, Linux, and Usenet news
installations have helped the authors in understanding what works and
what doesn't. Without their work, this HOWTO would have been a dry text
book.</P
><P
>Hema Kariyappa co-authored the first couple of versions of this
HOWTO, starting with v2.0.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1594"
>15.2. Comments invited</A
></H3
><P
>Your comments and contributions are invited. We cannot possibly
write all sections of this HOWTO based on our knowledge alone. Please
contribute all you can, starting with minor corrections and bug fixes
and going on to entire sections and chapters. Your contributions will be
acknowledged in the HOWTO.</P
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1597"
>15.3. Copyright</A
></H3
><P
><EM
>Copyright (c) 2002 Starcom Software Private Limited,
India</EM
></P
><P
>Please freely copy and distribute (sell or give away) this
document in any format. It is requested that corrections and/or
comments be fowarded to the document maintainer, reachable at
<TT
CLASS="LITERAL"
>usenet@starcomsoftware.com</TT
>. When these comments
and contributions are incorporated into this document and released
for distribution in future versions of this HOWTO, the content of the
incorporated text will become the copyright of Starcom Software Private
Limited. By submitting your contributions to us, you implicitly agree
to these terms.</P
><P
>You may create a derivative work and distribute it provided that
you:</P
><P
></P
><OL
TYPE="1"
><LI
><P
>    Send your derivative work (in the most suitable format such as SGML) to the 
    LDP (Linux Documentation Project) or the like for posting on the Internet. 
    If not the LDP, then let the LDP know where it is available.</P
></LI
><LI
><P
>    License the derivative work with this same license or use GPL.
    Include a copyright notice and at least a pointer to the licence
    used. </P
></LI
><LI
><P
>    Give due credit to previous authors and major contributors.
    If you are considering making a derived work other than a
    translation, it is requested that you discuss your plans with the 
    current maintainer.</P
></LI
></OL
></DIV
><DIV
CLASS="SECTION"
><HR><H3
CLASS="SECTION"
><A
NAME="AEN1611"
>15.4. About Starcom Software Private Limited</A
></H3
><P
><EM
>starcom</EM
> (Starcom Software Private
Limited, <TT
CLASS="LITERAL"
>www.starcomsoftware.com</TT
>) has been building
products and solutions using Linux and Web technology since 1996. Our
entire office runs on Linux, and we have built mission-critical
solutions for some of the top corporate entities in India and abroad.
Our client list includes arguably the world's largest securities
depository (The National Securities Depository Limited, India,
<TT
CLASS="LITERAL"
>www.nsdl.com</TT
>), one of the world's top five stock
exchanges in terms of trading volumes (The National Stock Exchange of
India Limited, <TT
CLASS="LITERAL"
>www.nseindia.com</TT
>), and one of India's
premier financial institutions listed on the NYSE. In all these cases, we
have introduced them to Linux, and in many cases, we have built them their
first mission-critical business applications on Linux. Contact the authors
or check the Starcom Website for more information about the work we have done.</P
></DIV
></DIV
></DIV
><H3
CLASS="FOOTNOTES"
>Notes</H3
><TABLE
BORDER="0"
CLASS="FOOTNOTES"
WIDTH="100%"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN1280"
HREF="#AEN1280"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>    This lack of a restart facility is something NNTP shares with
    its older cousin, SMTP, and we have often seen email messages
    getting stuck in a similar fashion over flaky data links. In
    many such networks which we manage for our clients, we have
    moved the inter-server mail transfer to Taylor UUCP, using UUCP
    over TCP.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN1301"
HREF="#AEN1301"
><SPAN
CLASS="footnote"
>[2]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>One of us did his first installation with BNews,
actually, at the IIT Mumbai. Then we rapidly moved from there to CNews
Shellscript Release, then CNews Performance Release, CNews Cleanup
Release, and our current release has fixed some bugs in the latest
Cleanup Release.</P
></TD
></TR
></TABLE
></BODY
></HTML
>