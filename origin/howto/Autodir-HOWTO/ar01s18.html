<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>18. Managing home directories</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Autodir HOWTO"><link rel="up" href="index.html" title="Autodir HOWTO"><link rel="prev" href="ar01s17.html" title="17. Getting Autodir"><link rel="next" href="ar01s19.html" title="19. Managing group directories"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">18. Managing home directories</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s17.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s19.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="homedir"></a>18. Managing home directories</h2></div></div></div><p>This section will explain how to configure <span class="bold"><strong>Autodir</strong></span> so that user home directories are created on demand. For this purpose the <code class="literal">autohome</code> module, which deals with specifics of home directory creation, is used.</p><p>To load the <code class="literal">autohome</code> module with <span class="bold"><strong>Autodir</strong></span>, use the <code class="literal">-m</code> option. For example, <code class="literal">-m /usr/lib/autodir/autohome.so</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">User/home matching</h3><p>When an application tries to access a home directory, that home directory is used to check if there is any user with the same user name as the directory name being accessed. If a user name exists, then the home directory is created. Otherwise the message <span class="quote">&#8220;<span class="quote">no such file or directory</span>&#8221;</span> is reported back to the application.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">User accounts</h3><p><code class="literal">Autohome</code> does not deal with the creation of user accounts on local systems, in LDAP or in any other database. It only deals with creating home directories once these accounts exist and are imported to the local system from databases like LDAP and NIS.</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Limitations</h3><p>It is worth mentioning one limitation of the <code class="literal">autohome</code> module. It expects that user name and home directory are related to each other. For example, for user <code class="literal">user1</code> the home directory should be <code class="filename">/home/user1</code> or <code class="filename">/some/directory/name/user1</code> but not <code class="filename">/some/directory/name/userhome1</code>. This can be supported but it will be a burden on system resources as each password entry has to be examined from first to last.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Knowing when not to use autohome</h3><p>If the existing user password database is such that user home directories are distributed under different base directories, for example <code class="filename">/home/class1/user1</code>, <code class="filename">/home/class2/user2332</code>, then <code class="literal">autohome</code> configuration becomes complicated and is not recommended.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm482"></a>18.1. Base directories for autohome</h3></div></div></div><p>The next step in the setup procedure is to decide where the <span class="emphasis"><em>virtual base directory</em></span> and <span class="emphasis"><em>real base directory</em></span> for home directory creation will be located.</p><p>What are the <span class="emphasis"><em>virtual base directory</em></span> and the <span class="emphasis"><em>real base directory</em></span> in the context of the <code class="literal">autohome</code> module?</p><p>This all depends on how user accounts are created. If a user account created for user name user1 with home directory <code class="filename">/home/user1</code> then <code class="filename">/home</code> <span class="emphasis"><em>will become the virtual base directory</em></span>.</p><p>Then what is the <span class="emphasis"><em>real base directory</em></span>?  This can be any directory. The only thing that you need to keep in mind is that there should be enough space, as all actual files are stored here instead of in the <span class="emphasis"><em>virtual base directory</em></span>.</p><p>In most server configurations <code class="filename">/home</code> is a separate partition. But if <code class="filename">/home</code> is the <span class="emphasis"><em>virtual base directory</em></span>, then files are not stored in that directory! The solution is not to mount a partition on <code class="filename">/home</code> but instead mount it somewhere else and make it the <span class="emphasis"><em>real base directory</em></span>.</p><p>The <span class="bold"><strong>Autodir</strong></span> option <code class="literal">-d</code> is used to specify the <span class="emphasis"><em>virtual base directory</em></span>. For example: <code class="literal">autodir -d /home</code> assumes that <code class="filename">/home</code> is the <span class="emphasis"><em>virtual base directory</em></span>.</p><p>It is somewhat tricky to specify the <span class="emphasis"><em>real base directory</em></span>.  The <span class="emphasis"><em>real base directory</em></span> is managed by the <code class="literal">autohome</code> module so this option must be passed to the module through module suboptions. If the <span class="emphasis"><em>real base directory</em></span> is <code class="filename">/var/autohome</code> then it is specified with the option <code class="literal">-o</code> as <code class="literal">-o realpath=/var/autohome</code>.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm519"></a>18.2. Directory organization</h3></div></div></div><p>Refer to <a class="link" href="ar01s09.html" title="9. Directory organization in the real base directory">directory organization under the real base directory</a> for a detailed explanation of this topic.</p><p><code class="literal">autohome</code> does support this kind of organization. The suboption used to specify the desired directory organization the <code class="literal">level</code> suboption, for instance: <code class="literal">-o level=2</code>.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm527"></a>18.3. Misc suboptions for autohome</h3></div></div></div><p>The suboption <code class="literal">skel</code> can be used if the skeleton path is not the default value <code class="filename">/etc/skel</code>: <code class="literal"> -o skel=/some/other/dir</code>.</p><p>The suboption <code class="literal">noskel</code> can be used with <code class="literal">-o</code> to indicate not to copy any skeleton files to the home directories when these are created.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm536"></a>18.4. Example</h3></div></div></div><p>First, import your user accounts from a centralized database, for instance from LDAP.</p><p>Next, the <code class="literal">autofs</code> kernel module must be loaded into the Linux kernel. This can be done as described in <a class="link" href="ar01s15.html" title="15. Autofs kernel module">autofs kernel module section</a>.</p><p>If <code class="filename">/home</code> is to be used for home directories then <code class="filename">/home</code> will become the <span class="emphasis"><em>virtual directory</em></span>; this is specified to <span class="command"><strong>autodir</strong></span> with the <code class="literal">-d /home</code> option.</p><p>Assuming that the <code class="literal">autohome</code> module is located in <code class="filename">/usr/lib/autodir/autohome.so</code>, this module can be loaded with <span class="command"><strong>autodir</strong></span> as <code class="literal">-m /usr/lib/autodir/autohome.so</code>. Note that the full path for the module is given.</p><p>The actual location of the real home directories is given with the <code class="literal">realpath</code> suboption. If it is <code class="filename">/autohome</code>, the location can be specified as <code class="literal">realpath=/autohome</code>.</p><p>With all these options <span class="command"><strong>autodir</strong></span> can be started as:</p><pre class="screen">
# autodir -d /home 						\
		-m /usr/lib/autodir/autohome.so 		\
		-o 'realpath=/autohome'			 	\
</pre><p>Once <span class="bold"><strong>Autodir</strong></span> is started, initially the <code class="filename">/home</code> directory will be empty. Whether <span class="bold"><strong>Autodir</strong></span> is working properly can be tested by changing directories to one of the home directories, as the root user or as the owner of the home directory.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s17.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s19.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">17. Getting Autodir </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 19. Managing group directories</td></tr></table></div></body></html>
