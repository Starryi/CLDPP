<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>7. How it works</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Autodir HOWTO"><link rel="up" href="index.html" title="Autodir HOWTO"><link rel="prev" href="ar01s06.html" title="6. Differences between Autodir and Autofs"><link rel="next" href="ar01s08.html" title="8. Some definitions"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">7. How it works</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s06.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s08.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm174"></a>7. How it works</h2></div></div></div><p><span class="bold"><strong>Autodir</strong></span> uses modules to get specific functionality. The core <span class="bold"><strong>Autodir</strong></span> implements generic functionality that modules can exploit and add specific functionality to.</p><p>At any moment only one module can be added to <span class="bold"><strong>Autodir</strong></span>. If there are two modules, for example <code class="literal">autohome</code> and <code class="literal">autogroup</code>, then two processes of <span class="bold"><strong>Autodir</strong></span> should be created so that each process can have one of the required modules attached to it.</p><p>For further explanation I chose the <code class="literal">autohome</code> module which handles transparent home directory creation.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Assumptions</h3><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="literal">autohome</code> module creates user home directories on demand if these do not exist already.</p></li><li class="listitem"><p>It is assumed that user accounts exists, but the accompanying home directories do not - either because these accounts were created with the <code class="literal">-M</code> option with <span class="command"><strong>useradd</strong></span> or because these accounts were imported from LDAP, NIS or some other external database for which home directories are yet to be created.</p></li><li class="listitem"><p>It also assumed <span class="emphasis"><em>for this explanation only</em></span> that all user home directories are expected to be in the <code class="filename">/home</code> directory.</p></li></ul></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">KISS</h3><p>Keep it Simple: Some fine details are intentionally kept aside to make the explanation easy to understand.</p></div><p>First the autofs file system is mounted on the <code class="filename">/home</code> directory by <span class="bold"><strong>Autodir</strong></span>. The Linux kernel is informed that <code class="filename">/home</code> is managed by a user space application, <span class="bold"><strong>Autodir</strong></span>, from now on.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Autofs?</h3><p>Do not bother too much about the autofs file system if you do not understand about it. Just think of it as a special kind of file system, similar to memory based file systems but with some additional special properties.</p></div><pre class="screen">

                                +----------------+
                                |  Linux Kernel  |
                                +----------------+
                                  /        \
                                 /          \
                                /            \
                               /              \
   +-------------+       +--------+       +------------+        +-----------------+
   | Application |------&gt;| /home  |&lt;-----&gt;|  Autodir   |&lt;------&gt;| autohome module |
   +-------------+       +--------+       +------------+        +-----------------+
                              \                                          /
                               \  +----------------+                    /
                                +-|   /autohome    |&lt;------------------+
                                  +----------------+
</pre><p>Whenever an application or daemon needs access to a user's home directory, for example <code class="filename">/home/userhome1</code>, they directly enter into <code class="filename">/home/userhome1</code> to access it. The kernel, which notices this, informs <span class="bold"><strong>Autodir</strong></span> if the <code class="filename">userhome1</code> directory does not yet exist already in <code class="filename">/home</code>.</p><p><span class="bold"><strong>Autodir</strong></span>, in turn, passes this request to the <code class="literal">autohome</code> module.  The <code class="literal">autohome</code> module does not touch the <code class="filename">/home</code> directory. Instead it manages <span class="emphasis"><em>real home directories</em></span> somewhere else, for example in <code class="filename">/autohome</code> as shown in the above figure.</p><p>The <code class="literal">autohome</code> module creates a real home directory if it does not exist in the <code class="filename">/autohome</code> directory. After it is successfully created or failed to be created, whatever the outcome, <code class="literal">autohome</code> reports back to <span class="bold"><strong>Autodir</strong></span>.  When the directory creation task has completed successfully, the path to real home directory is provided to <span class="bold"><strong>Autodir</strong></span>.</p><p>If the <code class="literal">autohome</code> module reports success, <span class="bold"><strong>Autodir</strong></span> creates <code class="filename">userhome1</code> directory under <code class="filename">/home</code> and mounts the <span class="emphasis"><em>real home directory</em></span> from <code class="filename">/autohome</code> on it. At the end of the process, <span class="bold"><strong>Autodir</strong></span> informs the kernel whether the whole operation was successful or not. Accordingly, the kernel allows applications to enter the directory, or, in case of failure, it reports that no such directory exists.</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s06.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s08.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">6. Differences between Autodir and Autofs </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 8. Some definitions</td></tr></table></div></body></html>
