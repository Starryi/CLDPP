<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Common PHP-Nuke security vulnerabilities</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PHP-Nuke: Management and Programming"
HREF="index.html"><LINK
REL="UP"
TITLE="Security "
HREF="security.html"><LINK
REL="PREVIOUS"
TITLE="The impact of bad security record on software popularity "
HREF="security-record-software-popularity.html"><LINK
REL="NEXT"
TITLE="How to guard against security vulnerabilities in PHP-Nuke"
HREF="guard-security-vulnerabilities-in-php-nuke.html"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PHP-Nuke: Management and Programming</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="security-record-software-popularity.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 23. Security</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="guard-security-vulnerabilities-in-php-nuke.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="COMMON-PHP-NUKE-SECURITY-VULNERABILITIES"
>23.3. Common <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> security vulnerabilities</A
></H1
><P
>It's instructive to take the time and have a look at <A
HREF="http://www.secunia.com/advisories/search/date/?task=search&#38;search=php-nuke&#38;vuln_title=1&#38;vuln_software_os=1&#38;vuln_bodytext=1&#38;vuln_cve=1"
TARGET="_top"
>PHP-Nuke's list of vulnerabilities</A
> (see <A
HREF="common-php-nuke-security-vulnerabilities.html#TAB-SECURITY-VULNERABILITIES"
>Table 23-1</A
>). Even a superficial inspection reveals some common vulnerability patterns:</P
><P
></P
><UL
><LI
><P
>Cross-site scripting (<A
HREF="common-php-nuke-security-vulnerabilities.html#CROSS-SITE-SCRIPTING-WITH-PHP-NUKE"
>Section 23.3.1</A
>)</P
></LI
><LI
><P
>SQL injection (<A
HREF="common-php-nuke-security-vulnerabilities.html#SQL-INJECTION-WITH-PHP-NUKE"
>Section 23.3.2</A
>)</P
></LI
><LI
><P
>Path disclosure (<A
HREF="common-php-nuke-security-vulnerabilities.html#PATH-DISCLOSURE-WITH-PHP-NUKE"
>Section 23.3.3</A
>)</P
></LI
><LI
><P
>Cross-site tracing (<A
HREF="common-php-nuke-security-vulnerabilities.html#CROSS-SITE-TRACING-WITH-PHP-NUKE"
>Section 23.3.4</A
>)</P
></LI
></UL
><P
>In the following we will examine them in more detail.</P
><P
><DIV
CLASS="TABLE"
><A
NAME="TAB-SECURITY-VULNERABILITIES"
></A
><P
><B
>Table 23-1. List of <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> security vulnerabilities</B
></P
><TABLE
BORDER="1"
RULES="all"
CLASS="CALSTABLE"
><COL
WIDTH="1*"
ALIGN="LEFT"
TITLE="COL0"><COL
WIDTH="1*"
ALIGN="LEFT"
TITLE="COL1"><TBODY
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Description</P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Date</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/10040/"
TARGET="_top"
>PHP-Nuke Path Disclosure Vulnerability</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>21.10.2003</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/9307/"
TARGET="_top"
>Splatt Forum Cross-Site Scripting Vulnerability</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>19.07.2003</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/8801/"
TARGET="_top"
>PHP-Nuke SQL injection</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>19.05.2003</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/8716/"
TARGET="_top"
>Splatt Forum Cross Site Scripting</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>02.05.2003</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/8662/"
TARGET="_top"
>PHP-Nuke Cross-Site Scripting</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>25.04.2003</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/8478/"
TARGET="_top"
>PHP-Nuke Cross-Site Scripting</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>01.04.2003</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/8417/"
TARGET="_top"
>PHP-Nuke SQL Injection</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>26.03.2003</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/8341/"
TARGET="_top"
>PHP-Nuke Referer Cross-Site Scripting</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>19.03.2003</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/8321/"
TARGET="_top"
>PHP-Nuke Path Disclosure</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>18.03.2003</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/8245/"
TARGET="_top"
>PHP-Nuke Multiple SQL Injection Vulnerabilities</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>07.03.2003</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/8144/"
TARGET="_top"
>PHP-Nuke Multiple SQL Injection Vulnerabilities</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>25.02.2003</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/7993/"
TARGET="_top"
>PHP Nuke Avatar Scriptcode Injection</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>04.02.2003</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/7776/"
TARGET="_top"
>PHP-Nuke mail CRLF injection</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>23.12.2002</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/7731/"
TARGET="_top"
>PHP-Nuke execution of arbitrary code</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>17.12.2002</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/7736/"
TARGET="_top"
>PHP-Nuke Cross Site Scripting</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>17.12.2002</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/7595/"
TARGET="_top"
>PHP-Nuke Cross Site Scripting</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>25.11.2002</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/7430/"
TARGET="_top"
>PHP-Nuke SQL injection resets passwords</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>01.11.2002</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/7271/"
TARGET="_top"
>PHP-Nuke Cross Site Scripting</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>10.10.2002</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><A
HREF="http://www.secunia.com/advisories/7153/"
TARGET="_top"
>Cross Site Scripting holes in Xoops, PHP-Nuke, NPDS, daCode, Drupal and phpWebSite</A
></P
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>24.09.2002</P
></TD
></TR
></TBODY
></TABLE
></DIV
></P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CROSS-SITE-SCRIPTING-WITH-PHP-NUKE"
>23.3.1. Cross-site scripting with PHP-Nuke</A
></H2
><P
>A CSS vulnerability is caused by the failure of a site to validate user input before returning it to the client s web-browser. The essence of cross-site scripting is that an intruder causes a legitimate web server to send a page to a victim's browser that contains malicious script or HTML of the intruder's choosing. The malicious script runs with the privileges of a legitimate script originating from the legitimate web server (see <A
HREF="http://www.cert.org/archive/pdf/cross_site_scripting.pdf"
TARGET="_top"
>Cross-Site Scripting Vulnerabilities</A
>). By failing to validate user input, the vulnerable site makes it possible for a malicious user to execute (&#8220;inject&#8221;) a script in the context of that site's process.</P
><P
>Here are some known examples of cross-site scripting with PHP-Nuke:</P
><P
></P
><UL
><LI
><P
>When a user posts messages, special characters are not stripped making it possible to inject malicious script code. The user types in a forum message </P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Some test text for fun &#60;script&#62;alert(document.cookie);&#60;/script&#62; some more text..</PRE
></FONT
></TD
></TR
></TABLE
><P
>the text is not checked for the presence of a script - and the script is executed in the victim's browser, who thinks it is a safe forum text from a trusted <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> site. (see <A
HREF="http://www.secunia.com/advisories/8716/"
TARGET="_top"
>Splatt Forum Cross Site Scripting</A
>).</P
></LI
><LI
><P
>In a search field, the user types</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>&#60;script&#62;alert(document.cookie);&#60;/script&#62;</PRE
></FONT
></TD
></TR
></TABLE
><P
>The search text is displayed in the results page without being validated. The result: a script is again executed in the victim's browser (see <A
HREF="http://www.secunia.com/advisories/8716/"
TARGET="_top"
>Splatt Forum Cross Site Scripting</A
>, <A
HREF="http://www.secunia.com/advisories/7595/"
TARGET="_top"
>PHP-Nuke Cross Site Scripting</A
>).</P
></LI
><LI
><P
>In a forum post, a user types</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>&#60;html&#62;
&#60;body&#62;
&#60;script&#62;
&#60;!-- Modify here --&#62;
var address='http://www.splatt.it/gate.html?mop=modload&#38;name=Forums&#38;file=newtopic';
&#60;/script&#62;
&#60;!-- Exploit form --&#62;
&#60;script&#62;
document.write("&#60;form action="+address+" method='post' name='coolsus'&#62;");
&#60;/script&#62;
Forum Number: &#60;input type=text name=forum value=1 size=3&#62;&#60;br&#62;
Username: &#60;input CLASS=textbox TYPE="TEXT" NAME="username" 
           SIZE="25" MAXLENGTH="40"&#62;&#60;br&#62;
Password: &#60;input CLASS=textbox TYPE="PASSWORD" NAME="password" 
           SIZE="25" MAXLENGTH="25"&#62;&#60;br&#62;
Subject: &#60;input CLASS=textbox TYPE="TEXT" NAME="subject" 
          SIZE="75" MAXLENGTH="75"&#62;&#60;br&#62;
Message:&#60;br&#62;&#60;textarea name="message" rows="10" cols="75" 
        wrap="VIRTUAL"&#62;&#60;/textarea&#62;&#60;br&#62;
&#60;input type=hidden name=bbcode value=0&#62;
&#60;input type=hidden name=smile value=0&#62;
&#60;input type=hidden name=notify value=0&#62;
&#60;b&#62;Inject code:&#60;/b&#62; &#60;input type=text name=image_subject 
value='icon1.gif"&#62;HTML CODE&#60;!-- "' size=100&#62;&#60;br&#62;
&#60;input type="submit" name="submit" value=submit class="Button"&#62;
&#60;/form&#62;
&#60;/body&#62;
&#60;/html&#62;</PRE
></FONT
></TD
></TR
></TABLE
><P
>The input is not checked if it contains malicious code, the script is executed in a user's browser when viewed. Successful exploitation can result in disclosure of various information (eg. cookie-based authentication information) associated with the site running Splatt Forum or inclusion of malicious content, which the user thinks is part of the real website (see <A
HREF="http://www.secunia.com/advisories/9307/"
TARGET="_top"
>Splatt Forum Cross-Site Scripting Vulnerability</A
>).</P
></LI
><LI
><P
>Due to insufficient validation of user input used in an attribute inside a tag, arbitrary script code can be executed by a malicious user. The characters &#60; and &#62; are filtered, but <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> neglects to filter out &#8220; characters. A malicious person can exploit this to execute arbitrary script code in a user's browser session by including it in either the profile, comments, or a private message, where one has only to type something like</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>&#60;a href="http://" onclick="alert('test')"&#62;http://" onclick="alert('test')&#60;/a&#62;</PRE
></FONT
></TD
></TR
></TABLE
><P
>to provoke this behaviour (see <A
HREF="http://www.secunia.com/advisories/8662/"
TARGET="_top"
>PHP-Nuke Cross-Site Scripting</A
>).</P
></LI
><LI
><P
>By posting a forum message with a title like: </P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>"&#62;&#38;lt;script&#38;gt;evil_code;&#38;lt;/script&#38;gt; </PRE
></FONT
></TD
></TR
></TABLE
><P
>the title will be returned by blocks/block-Forum.php as valid html or script code to the users viewing the message (see <A
HREF="http://www.secunia.com/advisories/8478/"
TARGET="_top"
>PHP-Nuke Cross-Site Scripting</A
>).</P
></LI
><LI
><P
>Input supplied to the $referer variable is not filtered when inserted into the backend database, which makes it possible to include arbitrary script code. When viewed by an administrator, the script code will be executed automatically in the administrator's browser session and could eg. steal the authentication cookie associated with the website, which contains the administrator's username and password (see <A
HREF="http://www.secunia.com/advisories/8341/"
TARGET="_top"
>PHP-Nuke Referer Cross-Site Scripting</A
>).</P
></LI
><LI
><P
>Using the following manipulated addresses</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>modules/Forums/bb_smilies.php?name=code
modules/Forums/bb_smilies.php?Default_Theme=code
modules/Forums/bb_smilies.php?site_font=}--&#62;&#60;/style&#62;code
modules/Forums/bb_smilies.php?bgcolor1="&#62;code</PRE
></FONT
></TD
></TR
></TABLE
><P
>where "code" is a malicious code, a user can execute this code in a viewer's browser (see <A
HREF="http://www.secunia.com/advisories/7736/"
TARGET="_top"
>PHP-Nuke Cross Site Scripting</A
>).</P
></LI
></UL
><P
>As you can see from the above examples, the only remedy to cross-site scripting problems is to write <ACRONYM
CLASS="ACRONYM"
>PHP</ACRONYM
> code that validates user input (or, if you are the &#8220;viewer&#8221;, disable scripting altogether, although even this will not prevent the injection of malicious HTML, see <A
HREF="http://www.cert.org/archive/pdf/cross_site_scripting.pdf"
TARGET="_top"
>Cross-Site Scripting Vulnerabilities</A
>).</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="SQL-INJECTION-WITH-PHP-NUKE"
>23.3.2. SQL injection with PHP-Nuke</A
></H2
><P
>Interaction with relational databases takes place through a textual language, the Structured Query Language ('SQL'). The most recent standard is ANSI SQL-92 and forms the basis around which most SQL dialects are based today. See <A
HREF="http://www-dbs.inf.ethz.ch/~isk/WS_97/syntax_diagramme/"
TARGET="_top"
>SQL syntax diagrams</A
> for a visualization of SQL syntax. Data extraction from the database takes place through a 'query', which is a collection of SQL statements. An SQL query returns the data in a so-called 'result set'. </P
><P
>SQL statements are divided into two general categories: those that can modify the structure (Data Definition Language statements, or 'DDL') and those that can manipulate the contents of databases (Data Manipulation Language statements, or 'DML'). SQL Injection occurs when an attacker is able to insert a series of SQL statements into a 'query' by manipulating data input into an application (see <A
HREF="http://www.nextgenss.com/papers/advanced_sql_injection.pdf"
TARGET="_top"
>Advanced SQL Injection in SQLServer Applications</A
>).</P
><P
>The typical scenario of an SQL Injection goes like this: an SQL statement like (taken from mainfile.php)</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>SELECT active FROM ".$prefix."_modules WHERE title='$module'</PRE
></FONT
></TD
></TR
></TABLE
><P
>is used to retrieve the 'active' column from the 'nuke_modules' table (assuming that $prefix is set to 'nuke' in config.php, see <A
HREF="config-php-file.html"
>Section 3.7</A
>), returning in the 'result set' only the row that matches the module $module. An important point to note here is that the string literal '$module' is delimited with single quotes. Presuming that $module is taken from the URL or from user input and was not subjected to further scrutiny, one could use a &#8220;module name&#8221; of </P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>' UNION ALL SELECT user_password FROM nuke_users WHERE "=' </PRE
></FONT
></TD
></TR
></TABLE
><P
>and the 'query string' would become: </P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>SELECT active FROM ".$prefix."_modules 
WHERE title=" UNION ALL SELECT user_password FROM nuke_users WHERE "="</PRE
></FONT
></TD
></TR
></TABLE
><P
>The database server would execute the first part </P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>SELECT active FROM ".$prefix."_modules WHERE title="</PRE
></FONT
></TD
></TR
></TABLE
><P
>and would find no modules with empty title. It would then combine<A
NAME="AEN16048"
HREF="#FTN.AEN16048"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
> this empty result set with the outcome of </P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>SELECT user_password FROM nuke_users WHERE "="</PRE
></FONT
></TD
></TR
></TABLE
><P
>which selects all passwords (since the WHERE clause is tautologically true, comparing an empty string with itself), returning the &#8220;cartesian product&#8221; (UNION) of the two - i.e. the set of all passwords. If the outcome of such a query is supposed to be printed somewhere, the user will be able to see sensitive information.</P
><P
>If the &#8220;module name&#8221; passed on unchecked were</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>' ; DROP TABLES WHERE "='</PRE
></FONT
></TD
></TR
></TABLE
><P
>the consequences would be catastrophic: the database server would execute</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>SELECT active FROM ".$prefix."_modules WHERE title=" ; DROP TABLES WHERE "="</PRE
></FONT
></TD
></TR
></TABLE
><P
>Depending on the actual SQL query, you may have to try some of these possibilities for the WHERE clause:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>' or 1=1--
" or 1=1--
or 1=1--
' or 'a'='a
" or "a"="a
') or ('a'='a</PRE
></FONT
></TD
></TR
></TABLE
><P
>instead of</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>"='</PRE
></FONT
></TD
></TR
></TABLE
><P
>The general rule is that to "break out" of the quotes and manipulate the SQL query, while maintaining valid SQL syntax, your query string must start with a quote and end in a WHERE clause that needs a query appended to it (see <A
HREF="http://www.spidynamics.com/papers/SQLInjectionWhitePaper.pdf"
TARGET="_top"
>SQL Injection</A
>).</P
><P
>In PHP-Nuke, SQL injection has been reported in the following vulnerabilities:</P
><P
></P
><UL
><LI
><P
>The "cid" parameter isn't properly verified in the "Downloads" module. This can be exploited to manipulate the SQL query and may potentially allow bypassing authentication or reveal sensitive information (see <A
HREF="http://www.secunia.com/advisories/9994/"
TARGET="_top"
>PHP-Nuke SQL Injection Vulnerability</A
>).</P
></LI
><LI
><P
>Numeric values in the Web_Links module aren't validated before they are used in SQL queries. Example:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>/modules.php?op=modload&#38;name=Web_Links&#38;file=index&#38;l_op=viewlink&#38;cid=2%20malicious_SQL </PRE
></FONT
></TD
></TR
></TABLE
><P
>(see <A
HREF="http://www.secunia.com/advisories/8801/"
TARGET="_top"
>PHP-Nuke SQL injection</A
>). You wonder how malicious_SQL might look like? Here is a real world example from my web server logs:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>/modules.php?name=Web_Links&#38;l_op=viewlink&#38;cid=2
%20UNION%20select%20counter,%20pwd,%20aid%20FROM%20nuke_authors%20</PRE
></FONT
></TD
></TR
></TABLE
></LI
><LI
><P
>Several input validation errors, which could be exploited by malicious people to manipula te existing SQL queries by conducting SQL injection attacks against the application, see <A
HREF="http://www.secunia.com/advisories/8417/"
TARGET="_top"
>PHP-Nuke SQL Injection</A
>.</P
></LI
><LI
><P
>Input validation errors in the modules "Members_List" and "Your_Account", which can be exploited by conducting a SQL injection attack, see <A
HREF="http://www.secunia.com/advisories/8245/"
TARGET="_top"
>PHP-Nuke Multiple SQL Injection Vulnerabilities</A
>.</P
></LI
><LI
><P
>Vulnerabilities can be exploited to manipulate existing SQL queries, which can result in disclosure of the Admin user's password hash. This can afterwards be used to gain administrative priviliges for PHP-Nuke, see <A
HREF="http://www.secunia.com/advisories/8144/"
TARGET="_top"
>PHP-Nuke Multiple SQL Injection Vulnerabilities</A
>.</P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="PATH-DISCLOSURE-WITH-PHP-NUKE"
>23.3.3. Path disclosure with PHP-Nuke</A
></H2
><P
>Path disclosure is a vulnerability that enables a user to gain knowledge of the internal path structure of an installation. It affects not only PHP-Nuke, but almost all <ACRONYM
CLASS="ACRONYM"
>PHP</ACRONYM
> scripts too. A typical path disclosure scenario goes as follows:</P
><P
>A user enters deliberately a value which is passed unchecked to the script. The value is crafted so as to cause an error in the <ACRONYM
CLASS="ACRONYM"
>PHP</ACRONYM
> interpreter or the database server. The user's speculation is that the error message will contain valuable information about the paths of the given software installation.</P
><P
>As an example, the error could be something like:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Fatal error: Cannot redeclare theindex() in 
/mnt/be1/02/738/0004711/w3/htdocs/www.yoursite.net/index.php 
on line 7</PRE
></FONT
></TD
></TR
></TABLE
><P
>Typically, error reporting is set to display the errors on the served page and the user would gain knowledge of the full path of the index.php script on the server. This may or may not worry you, but it is a good idea to keep undisclosed to malicious users. To achieve this, once a script is in production and displayed messages are no longer needed for debugging, they should be disabled.</P
><P
>Path disclosure with <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> has been reported in the following cases:</P
><P
></P
><UL
><LI
><P
>The search module can't handle certain characters such as """, "&#38;gt;" and "'". This causes <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> to return an error m essage that discloses the installation path (see <A
HREF="http://www.secunia.com/advisories/10040/"
TARGET="_top"
>PHP-Nuke Path Disclosure Vulnerability</A
>).</P
></LI
><LI
><P
>The <ACRONYM
CLASS="ACRONYM"
>PHP</ACRONYM
> script "print.php" used by the modules "News" and "AvantGo" does not verify user input supplied to the "$sid" variable. A malicious person could exploit this to gain knowledge of the full path to the installation directory by sending a HTTP request including invalid input to the "$sid" variable (see <A
HREF="http://www.secunia.com/advisories/8321/"
TARGET="_top"
>PHP-Nuke Path Disclosure</A
>).</P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CROSS-SITE-TRACING-WITH-PHP-NUKE"
>23.3.4. Cross-site tracing with PHP-Nuke</A
></H2
><P
>A new vulnerability has been found in Microsoft's Internet Information Server (IIS) which allows the reading of cookies. This is potentially possible also on Apache. Since <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> relies on the cookie mechanism (<A
HREF="guard-security-vulnerabilities-in-php-nuke.html#COOKIES"
>Section 23.4.5</A
>) for user authentication, it is important to know the risks emanating from this type of vulnerability. Here is the way it works, according a <A
HREF="http://www.cert.org/nav/index_main.html"
TARGET="_top"
>CERT</A
> advisory (see <A
HREF="http://www.kb.cert.org/vuls/id/288308"
TARGET="_top"
>Microsoft Internet Information Server (IIS) vulnerable to cross-site scripting via HTTP TRACK method</A
>):</P
><P
>Microsoft IIS servers support the HTTP TRACK method. The HTTP TRACK method asks a web server to echo the contents of the request back to the client for debugging purposes. The TRACK request is not RFC compliant and not well documented.</P
><P
>The complete request, including HTTP headers, is returned in the entity-body of a TRACK response. This leads to a Cross-site Scripting attack. Using features that provide client-side HTTP protocol support, such as <A
HREF="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/xmlsdk/htm/xml_obj_ixmlhttprequest_8bp0.asp"
TARGET="_top"
>XMLHTTP</A
> ActiveX or XMLDOM scripting objects, a web site can cause browsers to issue TRACK requests. The site can read the TRACK response, including sensitive header information such as cookies or authentication data.</P
><P
>Because the TRACK method is similar to the TRACE method, when combined with cross-domain browser vulnerabilities (<A
HREF="http://www.kb.cert.org/vuls/id/244729"
TARGET="_top"
>VU#244729</A
>, <A
HREF="http://www.kb.cert.org/vuls/id/711843"
TARGET="_top"
>VU#711843</A
>, <A
HREF="http://www.kb.cert.org/vuls/id/728563"
TARGET="_top"
>VU#728563</A
>), HTTP TRACK and client-side HTTP support can be leveraged by attackers to read sensitive header information from third-party domains. This technique has been termed "Cross-Site Tracing," or XST, in <A
HREF="http://www.cgisecurity.com/whitehat-mirror/WhitePaper_screen.pdf"
TARGET="_top"
>Cross-Site Tracing (XST)</A
>, a report published by WhiteHat Security. Cross-site tracing is also described in a <A
HREF="http://www.kb.cert.org/vuls/id/867593"
TARGET="_top"
>CERT advisory about Cross-Site-Tracing</A
>.</P
><P
>As noted in the report of WhiteHat, the technique can be used to bypass the <A
HREF="http://msdn.microsoft.com/workshop/author/dhtml/httponly_cookies.asp"
TARGET="_top"
>HttpOnly</A
> cookie attribute introduced in Microsoft Internet Explorer 6.0 SP1. HttpOnly blocks script access to the <A
HREF="http://msdn.microsoft.com/workshop/author/dhtml/reference/properties/cookie.asp"
TARGET="_top"
>cookie</A
> property (document.cookie), but does not prevent a scripting object from reading the cookie out of an HTTP TRACK response. In the White Paper of WhiteHat Security, this new method of Cross-Site-Scripting is explained in detail. The essence is that this technique</P
><A
NAME="AEN16193"
></A
><BLOCKQUOTE
CLASS="BLOCKQUOTE"
><P
>...is able not only to bypass the httpOnly mechanism present in i.e. 6 service pack 1, but in addition the ability to xss just about anything from just about anywhere. This technique allows client-side scripting languages, such as javascript, and possibly other client-side technologies like vbscript, flash, java, etc., the ability access http web authentication credentials, with the added bonus of achieving this result over ssl.</P
></BLOCKQUOTE
><P
>Normally, the cookie is sent back to the domain it belongs. But with this TRACE or TRACK HTTP method, it is possible to request a trace and the web server will send back all data, <EM
>including the cookie!</EM
> This is especially important for PHP-Nuke, since it relies on cookies for the authentication of its users.</P
><P
>To protect yourself, you should deactivate the TRACE HTTP method , if you are using Apache, and the TRACK HTTP method, if you are using IIS:</P
><P
></P
><UL
><LI
><P
>For Apache, you should put the following in the .htaccess file (<A
HREF="htaccess-file.html"
>Section 25.4</A
>) of your document root (or, for performance reasons, directly in the configuration file of Apache, if you have access to it):</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>RewriteEngine On
RewriteCond %{REQUEST_METHOD} ^TRACE
RewriteRule .* - [F]</PRE
></FONT
></TD
></TR
></TABLE
><P
>Of course, this assumes that you have mod_rewrite (<A
HREF="mod-rewrite.html"
>Section 25.2</A
>) installed.</P
></LI
><LI
><P
>For IIS, you should filter out the TRACE and TRACK methods with the URLScan filter. The only methods allowed should be GET, HEAD and POST.</P
></LI
></UL
><P
>There is nothing you can do in the code of <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> to avoid this vulnerability, however you should bear in mind when we talk about cookies <A
HREF="guard-security-vulnerabilities-in-php-nuke.html#COOKIES"
>Section 23.4.5</A
> that a Cross-Site Tracing attack may steal the cookies of your <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> too. See also <A
HREF="http://www.karakas-online.de/forum/viewtopic.php?t=341"
TARGET="_top"
>Cross-site tracing attack via HTTP TRACK / TRACE method</A
>.</P
></DIV
></DIV
><H3
CLASS="FOOTNOTES"
>Notes</H3
><TABLE
BORDER="0"
CLASS="FOOTNOTES"
WIDTH="100%"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN16048"
HREF="common-php-nuke-security-vulnerabilities.html#AEN16048"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>this kind of SQL injection needs a database capable of understanding the UNION clause (for MySQL at least v. 4.x)</P
></TD
></TR
></TABLE
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="security-record-software-popularity.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="guard-security-vulnerabilities-in-php-nuke.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>The impact of bad security record on software popularity</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="security.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>How to guard against security vulnerabilities in PHP-Nuke</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>