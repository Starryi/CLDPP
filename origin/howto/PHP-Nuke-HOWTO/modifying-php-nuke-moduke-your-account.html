<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Modifying the PHP-Nuke Your_Account module</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PHP-Nuke: Management and Programming"
HREF="index.html"><LINK
REL="UP"
TITLE="Modifying PHP-Nuke modules"
HREF="modifying-php-nuke-modules.html"><LINK
REL="PREVIOUS"
TITLE="Modifying the PHP-Nuke Web_Links module"
HREF="modifying-php-nuke-module-web-links.html"><LINK
REL="NEXT"
TITLE="Modifying the PHP-Nuke News module"
HREF="modifying-php-nuke-news-module.html"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PHP-Nuke: Management and Programming</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="modifying-php-nuke-module-web-links.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 18. Modifying <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> modules</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="modifying-php-nuke-news-module.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="MODIFYING-PHP-NUKE-MODUKE-YOUR-ACCOUNT"
>18.6. Modifying the <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> Your_Account module</A
></H1
><P
>In this section we modify the <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> Your Account module, one of the most central modules of <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
>. We show:</P
><P
></P
><UL
><LI
><P
>How to redirect users to the Homepage (<A
HREF="modifying-php-nuke-moduke-your-account.html#REDIRECT-USERS-TO-HOMEPAGE"
>Section 18.6.1</A
>),</P
></LI
><LI
><P
>How to redirect Your Info to the Forums user profile (<A
HREF="modifying-php-nuke-moduke-your-account.html#REDIRECT-YOUR-INFO-TO-FORUMS-USER-PROFILE"
>Section 18.6.2</A
>),</P
></LI
><LI
><P
>How to redirect users to Login and back (<A
HREF="modifying-php-nuke-moduke-your-account.html#REDIRECT-USERS-TO-LOGIN-AND-BACK"
>Section 18.6.3</A
>),</P
></LI
><LI
><P
>How to disable registration (<A
HREF="modifying-php-nuke-moduke-your-account.html#DISABLE-REGISTRATION"
>Section 18.6.4</A
>),</P
></LI
><LI
><P
>How to let users register immediately (<A
HREF="modifying-php-nuke-moduke-your-account.html#REGISTER-USERS-IMMEDIATELY"
>Section 18.6.5</A
>),</P
></LI
><LI
><P
>How to approve users before registration (<A
HREF="modifying-php-nuke-moduke-your-account.html#APPROVE-USERS"
>Section 18.6.6</A
>),</P
></LI
><LI
><P
>How to register users through iBill (<A
HREF="modifying-php-nuke-moduke-your-account.html#REGISTER-USERS-THROUGH-IBILL"
>Section 18.6.7</A
>),</P
></LI
><LI
><P
>How to change the maximum allowed length for user names (<A
HREF="modifying-php-nuke-moduke-your-account.html#CHANGE-MAXIMUM-USERNAME-LENGTH"
>Section 18.6.8</A
>).</P
></LI
></UL
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="REDIRECT-USERS-TO-HOMEPAGE"
>18.6.1. How to redirect users to the Homepage</A
></H2
><P
>Are you looking for a way to redirect a user to Home rather than Your Account when they login? Would you rather prefer them to go to Your Account only when they choose to and be automatically redirected to Home when they login? There is a simple way to accomplish this (see <A
HREF="http://www.karakas-online.de/forum/viewtopic.php?t=333"
TARGET="_top"
>How to redirect users to the Homepage</A
> and <A
HREF="http://www.nukeforums.com/forums/viewtopic.php?t=13776"
TARGET="_top"
>Redirect login to home</A
>):</P
><P
>Find the following lines in function login() in the modules/Your_Account/index.php:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Header("Location: modules.php?name=Your_Account&#38;op=userinfo&#38;bypass=1&#38;username=$username");</PRE
></FONT
></TD
></TR
></TABLE
><P
>Change it to this:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Header("Location: index.php"); </PRE
></FONT
></TD
></TR
></TABLE
><P
>See <A
HREF="modifying-php-nuke-homepage.html#REDIRECT-USERS-TO-LOGIN-PAGE"
>Section 18.2.1</A
> for the inverse procedure &#8212; but don't try both. <SPAN
CLASS="INLINEMEDIAOBJECT"
><IMG
SRC="./images/icon_wink.png"></SPAN
> </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="REDIRECT-YOUR-INFO-TO-FORUMS-USER-PROFILE"
>18.6.2. How to redirect Your Info to the Forums user profile</A
></H2
><P
><DIV
CLASS="FIGURE"
><A
NAME="FIG-YOUR-INFO-PROFILE-LINK"
></A
><P
><B
>Figure 18-5.    Your Info link in the User Preferences panel.
   </B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="./images/your-info-profile-link.png"><DIV
CLASS="CAPTION"
><P
>Your Info link in the User Preferences panel.</P
></DIV
></P
></DIV
></DIV
></P
><P
>With the advent of <A
HREF="http://www.phpbb.com"
TARGET="_top"
>phpBB</A
> forums in <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> (starting from somewhere around v. 6.5), you not only have to cope with two administration panels, one for <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> in general and one for the Forums in particular, your users can maintain their profile in two places too, from the Your Info link in the User Preference panel (<A
HREF="modifying-php-nuke-moduke-your-account.html#FIG-YOUR-INFO-PROFILE-LINK"
>Figure 18-5</A
>), as well as the Forums profile link in the Forums module (<A
HREF="modifying-php-nuke-moduke-your-account.html#FIG-FORUM-PROFILE-LINK"
>Figure 18-6</A
>).</P
><P
><DIV
CLASS="FIGURE"
><A
NAME="FIG-FORUM-PROFILE-LINK"
></A
><P
><B
>Figure 18-6.    Forum Profile link in the Forums module.
   </B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="./images/forum-profile-link.png"><DIV
CLASS="CAPTION"
><P
>Forum Profile link in the Forums module.</P
></DIV
></P
></DIV
></DIV
></P
><P
>The Your Info link has the URL</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>modules.php?name=Your_Account&#38;op=edituser</PRE
></FONT
></TD
></TR
></TABLE
><P
>and leads to a panel similar to the one of <A
HREF="modifying-php-nuke-moduke-your-account.html#FIG-YOUR-INFO-PROFILE"
>Figure 18-7</A
>.</P
><P
><DIV
CLASS="FIGURE"
><A
NAME="FIG-YOUR-INFO-PROFILE"
></A
><P
><B
>Figure 18-7.    User profile in Your Info.
   </B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="./images/your-info-profile.png"><DIV
CLASS="CAPTION"
><P
>User profile in Your Info.</P
></DIV
></P
></DIV
></DIV
></P
><P
>The Profile link in the Forums module, on the other hand, has the URL</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>modules.php?name=Forums&#38;file=profile&#38;mode=editprofile</PRE
></FONT
></TD
></TR
></TABLE
><P
>(optionally with the session <ACRONYM
CLASS="ACRONYM"
>ID</ACRONYM
> parameter, sid, which is not shown here) and leads to the panel shown in <A
HREF="modifying-php-nuke-moduke-your-account.html#FIG-FORUM-PROFILE"
>Figure 18-8</A
>.</P
><P
>Both panels use the same database tables in the background, so it doesn't matter which one you use. This may be confortable for some, but also confusing for other users.</P
><P
>If your users find it confusing to use two different entry points for their personal information, you can modify the Your_Account module to redirect them to the Forum profile (<A
HREF="modifying-php-nuke-moduke-your-account.html#FIG-FORUM-PROFILE"
>Figure 18-8</A
>), even when they click on the Your Info link (<A
HREF="modifying-php-nuke-moduke-your-account.html#FIG-YOUR-INFO-PROFILE-LINK"
>Figure 18-5</A
>).</P
><P
><DIV
CLASS="FIGURE"
><A
NAME="FIG-FORUM-PROFILE"
></A
><P
><B
>Figure 18-8.    User profile in the Forums.
   </B
></P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="./images/forum-profile.png"><DIV
CLASS="CAPTION"
><P
>User profile in the Forums.</P
></DIV
></P
></DIV
></DIV
></P
><P
>The Your Info link is output (&#8220;echoed&#8221;) in modules/Your_Account/navbar.php, in the following code block:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>echo "&#60;font class=\"content\"&#62;"
    ."&#60;center&#62;&#60;a href=\"modules.php?name=Your_Account&#38;amp;op=edituser\"&#62;
      &#60;img src=\"$menuimg\" border=\"0\" alt=\""._CHANGEYOURINFO.
     "\" title=\""._CHANGEYOURINFO."\"&#62;&#60;/a&#62;&#60;br&#62;"
    ."&#60;a href=\"modules.php?name=Your_Account&#38;amp;op=edituser\"&#62;"
    ._CHANGEYOURINFO."&#60;/a&#62;"
    ."&#60;/center&#62;&#60;/font&#62;&#60;/td&#62;";</PRE
></FONT
></TD
></TR
></TABLE
><P
>To redirect the users to the Forum profile (<A
HREF="modifying-php-nuke-moduke-your-account.html#FIG-FORUM-PROFILE"
>Figure 18-8</A
>), you can change the above block to:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>echo "&#60;font class=\"content\"&#62;"
    ."&#60;center&#62;&#60;a href=\"modules.php?name=Forums&#38;amp;file=profile&#38;amp;mode=editprofile\"&#62;
      &#60;img src=\"$menuimg\" border=\"0\" alt=\""._CHANGEYOURINFO.
     "\" title=\""._CHANGEYOURINFO."\"&#62;&#60;/a&#62;&#60;br&#62;"
    ."&#60;a href=\"modules.php?name=Forums&#38;amp;file=profile&#38;amp;mode=editprofile\"&#62;"
    ._CHANGEYOURINFO."&#60;/a&#62;"
    ."&#60;/center&#62;&#60;/font&#62;&#60;/td&#62;";</PRE
></FONT
></TD
></TR
></TABLE
><P
>As you can easily see, we have changed only the two links (one for the image and one for the text), the other lines are for your reference only. </P
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.png"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>It is not necessary to compute the user's numeric <ACRONYM
CLASS="ACRONYM"
>ID</ACRONYM
> and pass it on the URL through the u parameter - the mode=editprofile parameter on the URL will find the user automatically (but mode=viewprofile will not!).</P
></TD
></TR
></TABLE
></DIV
><P
>But wait a minute! Is this really all we have to change? Is the Your Info link (<A
HREF="modifying-php-nuke-moduke-your-account.html#FIG-YOUR-INFO-PROFILE-LINK"
>Figure 18-5</A
>) the only one that leads a user to the profile screen of the Your_Info module (<A
HREF="modifying-php-nuke-moduke-your-account.html#FIG-YOUR-INFO-PROFILE"
>Figure 18-7</A
>)? How about the user name links in other modules, for example? Search for the string &#8220;op=edituser&#8221; and you will already find a ton of those links in various places (Newsletter, language files, Reviews...) And how about a new user? Will the new user registration screen be the one of Your_Account or the one of Forums?</P
><P
>Instead of chasing links in the code, there is a more elegant solution that will eliminate any attempt to bring a user to the Your Info profile at its very beginning! It is also a very good example of what type of control you can achieve over your PHP-Nuke, if you put your knowledge about the way a module works (see <A
HREF="creating-modules.html"
>Chapter 21</A
>) into practice:</P
><P
>In modules/Your_Account/index.php find the lines:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>case "edituser":
edituser();
break;</PRE
></FONT
></TD
></TR
></TABLE
><P
>and replace them with:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>case "edituser":
Header("Refresh: 0; url=modules.php?name=Forums&#38;file=profile&#38;mode=editprofile");
break;</PRE
></FONT
></TD
></TR
></TABLE
><P
>This will take care of the &#8220;edit user&#8221; case. We need to do the same for the &#8220;new user&#8221; case too. Just replace</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>case "new_user":
new_user();
break;</PRE
></FONT
></TD
></TR
></TABLE
><P
>with:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>case "new_user":
Header("Refresh: 0; url=modules.php?name=Forums&#38;file=profile&#38;mode=register");
break;</PRE
></FONT
></TD
></TR
></TABLE
><P
>The idea here is the following: instead of searching all code of all modules for links that point to the Your Info profile, we look at the parameters that such a link passes on the URL. A typical Your Info profile link is of the form:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>modules.php?name=Your_Account&#38;op=edituser</PRE
></FONT
></TD
></TR
></TABLE
><P
>so the parameters it passes to the modules.php script are:</P
><P
></P
><UL
><LI
><P
>name: the name of the module to execute (Your_Account)</P
></LI
><LI
><P
>op: the operation to execute (edituser)</P
></LI
></UL
><P
>The second URL parameter, op, is checked at one single place in the code, in the switch statement of modules/Your_Account/index.php:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>switch($op) {
    case "logout":
        logout();
        break;
    ...many other cases checked here, among them "edituser" and "new_user"
    
    default:
        main($user);
        break;
}</PRE
></FONT
></TD
></TR
></TABLE
><P
>This is the one and only point of control for the actions taken by the Your_Account module. We make use of this fact and change the actions that are to be taken for the operations "edituser" and "new_user". We don't change the links, we change the actions that follow when the links are clicked.<SPAN
CLASS="INLINEMEDIAOBJECT"
><IMG
SRC="./images/icon_cool.png"></SPAN
></P
><P
>This will make the Your Info profile practically inaccessible in your system and will present the Forums profile instead.</P
><DIV
CLASS="WARNING"
><P
></P
><TABLE
CLASS="WARNING"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.png"
HSPACE="5"
ALT="Warning"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Missing functionality in the Forums profile!</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Bear in mind that, depending on the versions of <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> and Forums, you may be missing some functionality in the Forums profile, that was present in the profile that was accessible through the Your Info link. This may include changing the fake email address, changing the subscription to the newsletter, or changing the extra info (<A
HREF="user-extra-information.html#FIG-EXTRA-INFO"
>Figure 12-1</A
>). However, this is planned to be corrected in the future.</P
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="REDIRECT-USERS-TO-LOGIN-AND-BACK"
>18.6.3. How to redirect users to Login and back</A
></H2
><P
>We have already seen how to redirect users to the Login page (<A
HREF="modifying-php-nuke-homepage.html#REDIRECT-USERS-TO-LOGIN-PAGE"
>Section 18.2.1</A
>), to the Homepage (<A
HREF="modifying-php-nuke-moduke-your-account.html#REDIRECT-USERS-TO-HOMEPAGE"
>Section 18.6.1</A
>) and to the Forum profile from the Your Info profile (<A
HREF="modifying-php-nuke-moduke-your-account.html#REDIRECT-YOUR-INFO-TO-FORUMS-USER-PROFILE"
>Section 18.6.2</A
>). Finally, it is time that we consider the general redirection problem:</P
><P
>You are using some module, say an eCommerce module like the Emporium Shopping Cart (<A
HREF="php-nuke-add-on-modules.html#PHP-NUKE-ECOMMERCE-MODULE"
>Section 8.3.14</A
>), and at some point you need to ask the user to login (if not already done) to finish off the order. You would like to redirect the user to the Login screen (<A
HREF="common-installation-problems.html#FIG-SECURITY-CODE"
>Figure 3-28</A
>), then bring him back where he was to continue.</P
><P
>This is already implemented in <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> at some places, like the Private Messages part of the Your Account module: in the forums for example, if you aren't logged in, you see the link 'Log in to check your private messages', which when clicked on it, takes you to Your Account (address line becomes : http://www.yoursite.com/modules.php?name=Your_Account&#38;redirect=privmsg&#38;folder=inbox), and upon login in, you get taken back to PMs.</P
><P
>To accomplish this from an arbitrary module, that serves as the starting point for the redirection, open that module's code and find the place where the redirection has to happen. Initiate the redirection with the following two lines:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$redirect = $module_name;
&#60;a href=\"modules.php?name=Your_Account&#38;redirect=$redirect\"&#62;CLICK HERE TO LOGIN&#60;/a&#62;</PRE
></FONT
></TD
></TR
></TABLE
><P
>The value of $redirect is what you will key off in the next step. In this example we use the module name as the key that will point the way back, but you can use anything, as long as you know how to use it later, to trace your way back with the right link.</P
><P
>Now go to modules/Your_Account/index.php and look for the following code in the login() function:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>if ($pm_login != "") {
            Header("Location: modules.php?name=Private_Messages&#38;file=index&#38;folder=inbox");
            exit;
            }</PRE
></FONT
></TD
></TR
></TABLE
><P
>Add the following after it:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>if ($redirect == "XXXXXXXXX"){
        Header("Location: modules.php?name=YYYYYYYYY");
        exit;
        }</PRE
></FONT
></TD
></TR
></TABLE
><P
>where XXXXXXXXX is the value of $redirect from the first step and YYYYYYYY is the name of the module you want them dumped into after login.</P
><P
>You might think that we are done by now, but there is a caveat: the above will work as long as they log in correctly on the first try. If they make a mistake and have to try a second or more times, they will get dumped in Your Account, after they log in successfully, not in the module they came from. This is also true for the Private Messages example above.</P
><P
>To fix this, find the following code in Your_Account\index.php at the bottom of the login function.</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>} else {
   Header("Location: modules.php?name=$module_name&#38;stop=1");
    }</PRE
></FONT
></TD
></TR
></TABLE
><P
>and change it to:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>} else {
     Header("Location: modules.php?name=$module_name&#38;stop=1&#38;redirect=$redirect");
    }</PRE
></FONT
></TD
></TR
></TABLE
><P
>Then it will redirect even if they log in incorrectly the first time. See <A
HREF="http://www.nukeforums.com/forums/viewtopic.php?t=17779"
TARGET="_top"
>How to redirect</A
>.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DISABLE-REGISTRATION"
>18.6.4. How to disable registration</A
></H2
><P
>If you want to make registration of users impossible, you can apply a variation of the solution in <A
HREF="modifying-php-nuke-moduke-your-account.html#REDIRECT-YOUR-INFO-TO-FORUMS-USER-PROFILE"
>Section 18.6.2</A
>: you can redirect the users to the main page (index.php) whenever they try to register (e.g. by clicking on some registration link). Note that just by deleting the registration links from the code (see <A
HREF="find-all-registration-links.html"
>Section 26.5</A
> on how to find them), you still can't prevent a determined user from entering</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>http://www.yourdomain.com/modules.php?name=Your_Account&#38;op=new_user</PRE
></FONT
></TD
></TR
></TABLE
><P
>in the URL box of his browser by hand, thus triggering the &#8220;operation new_user&#8221; in <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
>. By this, it becomes clear that a real solution must at least change the behaviour of <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> for the value &#8220;new_user&#8221; of the op URL parameter.</P
><P
>Again, instead of chasing links in the code, there is a more elegant solution:</P
><P
>In modules/Your_Account/index.php find the lines:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>case "new_user":
new_user();
break;</PRE
></FONT
></TD
></TR
></TABLE
><P
>and replace them with:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>case "new_user":
Header("Refresh: 0; url=index.php");
break;</PRE
></FONT
></TD
></TR
></TABLE
><P
>This will only disable registration from the Your Account module (more accurately: it will redirect every registration attempt to the main index.php page).</P
><P
>To disable it in the Forums too, edit modules/Forums/profile.php. Find</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>else if ( $mode == 'editprofile' || $mode == 'register' )
{
        if ( !$userdata['session_logged_in'] &#38;&#38; $mode == 'editprofile' )
        {
                $header_location = ( @preg_match("/Microsoft|WebSTAR|Xitami/",
                $_SERVER["SERVER_SOFTWARE"]) ) ? "Refresh: 0; URL=" : "Location: ";
                header($header_location .
                append_sid("login.$phpEx?redirect=profile.$phpEx&#38;mode=editprofile", 
                true));
                exit;
        }
        include("includes/usercp_register.php");
        exit;
}</PRE
></FONT
></TD
></TR
></TABLE
><P
>and change it to something like:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>else if ( $mode == 'editprofile' || $mode == 'register' )
{
        Header("Refresh: 0; url=index.php");
        exit;
}</PRE
></FONT
></TD
></TR
></TABLE
><P
>i.e. we again redirect the user to the index.php page. See also <A
HREF="http://www.nukeforums.com/forums/viewtopic.php?t=18403"
TARGET="_top"
>How to disable registration</A
>.</P
><DIV
CLASS="TIP"
><P
></P
><TABLE
CLASS="TIP"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/tip.png"
HSPACE="5"
ALT="Tip"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>It's also possible without programming!</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>As so often in life, it all depends on what you want. You can of course achieve a similar effect, without any programming,  if you make the Your Account module accessible to admins only, from the modules administration, in the administration panel.</P
></TD
></TR
></TABLE
></DIV
><P
>If you want users to be registered directly, without confirmation mails, see <A
HREF="modifying-php-nuke-moduke-your-account.html#REGISTER-USERS-IMMEDIATELY"
>Section 18.6.5</A
>. If you want to approve every user who applied for registration, you can use the Approve Membership module (see <A
HREF="php-nuke-add-on-modules.html#PHP-NUKE-APPROVE-MEMBERSHIP-MODULE"
>Section 8.3.4</A
>).</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="REGISTER-USERS-IMMEDIATELY"
>18.6.5. How to let users register immediately</A
></H2
><P
>When new users register, you may want them to be able to do so immediately, without having to wait for an email notification with an activation link. </P
><DIV
CLASS="CAUTION"
><P
></P
><TABLE
CLASS="CAUTION"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/caution.png"
HSPACE="5"
ALT="Caution"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Do you trust your users?</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>If you let everyone post without being registered, you will not have *any* data as to who wrote that inflammatory, libellous, pornographic or whatever post in your forum that caught FBI's attention. Thus you should really trust your users not to abuse your system, if you plan to bypass email notification on registration.</P
></TD
></TR
></TABLE
></DIV
><P
>You have two options, if you are not in the mood of programming it yourself <SPAN
CLASS="INLINEMEDIAOBJECT"
><IMG
SRC="./images/icon_wink.png"></SPAN
>:</P
><P
></P
><OL
TYPE="1"
><LI
><P
>From the administration panel, Preferences, just choose that non-registered users are allowed to post. Then, from the modules and blocks administration panels, for each module or block you use, choose that all users are allowed to see it. That should come very close to what you want - that all users be able to use all parts of your site without registration. </P
></LI
><LI
><P
>A module that allows the administrator to bypass email activation is <A
HREF="http://www.nukefixes.com/article6.html"
TARGET="_top"
>NSN Your Account Tweak 650 3.0.2</A
>. According to the description, administrators can choose to bypass email activation. But the module offers a lot of other useful features around user management, see <A
HREF="php-nuke-add-on-modules.html#NSN-YOUR-ACCOUNT-TWEAK-MODULE"
>Section 8.3.3</A
>.</P
></LI
></OL
><P
>See also <A
HREF="http://www.karakas-online.de/forum/viewtopic.php?t=288"
TARGET="_top"
>Authorization and avatars</A
>.</P
><DIV
CLASS="CAUTION"
><P
></P
><TABLE
CLASS="CAUTION"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/caution.png"
HSPACE="5"
ALT="Caution"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Download the right NSN Your Account Tweak version!</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Be careful with the version you download from this module! The number 650, for example, indicates that it is only for <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> 6.5. Use only the version that is in accordance with your installed <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> version, otherwise you are guaranteed to mess up your installation completely.</P
></TD
></TR
></TABLE
></DIV
><P
>See also the <A
HREF="http://ravenphpscripts.com/download-file-58.html"
TARGET="_top"
>New User Auto Activation Hack</A
> and the <A
HREF="http://ravenphpscripts.com/download-file-83.html"
TARGET="_top"
>Auto Registration Activation For Nuke v7.0</A
>. If you want to disable registration, see <A
HREF="modifying-php-nuke-moduke-your-account.html#DISABLE-REGISTRATION"
>Section 18.6.4</A
>. If you want to approve every user who applied for registration, you can use the Approve Membership module (see <A
HREF="php-nuke-add-on-modules.html#PHP-NUKE-APPROVE-MEMBERSHIP-MODULE"
>Section 8.3.4</A
>).</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="APPROVE-USERS"
>18.6.6. How to approve users before registration</A
></H2
><P
>If you want to enforce the opposite of what is described in <A
HREF="modifying-php-nuke-moduke-your-account.html#REGISTER-USERS-IMMEDIATELY"
>Section 18.6.5</A
>, i.e. be able to approve each and every user before he is allowed to register, then you should have a look at the Approve Membership module. See <A
HREF="php-nuke-add-on-modules.html#PHP-NUKE-APPROVE-MEMBERSHIP-MODULE"
>Section 8.3.4</A
> and <A
HREF="http://www.karakas-online.de/forum/viewtopic.php?t=83"
TARGET="_top"
>Authorize accounts</A
> for more details.</P
><P
>If you want users to be registered directly, without confirmation mails, see <A
HREF="modifying-php-nuke-moduke-your-account.html#REGISTER-USERS-IMMEDIATELY"
>Section 18.6.5</A
>. If you want to disable registration, see <A
HREF="modifying-php-nuke-moduke-your-account.html#DISABLE-REGISTRATION"
>Section 18.6.4</A
>.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="REGISTER-USERS-THROUGH-IBILL"
>18.6.7. How to register users through iBill</A
></H2
><P
>Theoretically, you could modify the Your Account module easily to accomodate for a registration through the <A
HREF="http://www.ibill.com"
TARGET="_top"
>iBill</A
> credit card option. You could proceed along the following lines (see <A
HREF="http://www.nukeforums.com/forums/viewtopic.php?t=10200"
TARGET="_top"
>Replacing registration with iBill credit card option</A
>):</P
><P
>The iBill system essentially works by users entering information into the iBill script. The script would then connect to the web server and create an account in an .htaccess file (<A
HREF="htaccess-file.html"
>Section 25.4</A
>) in the <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> root directory. When a paid user account would expire, iBill's server could then remove the user account from the .htaccess file.</P
><P
>With iBill controlling the .htaccess file, there would be no need for a Registration option in <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
>. The only thing that would be needed would be to change the code in block-Login.php, perhaps replacing the Register link with a link to a static html page, where the iBill sign up scripts would do the trick. Or you could just put the iBill code in a block and remove the Register option.</P
><P
>There is no ready-made solution for this scenario yet, but the procedure outlined above points to the right direction.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CHANGE-MAXIMUM-USERNAME-LENGTH"
>18.6.8. How to change the maximum allowed length for user names</A
></H2
><P
>The standard maximum length for user names is 25 characters. If your users really pick up such long nicknames, they may break your blocks' layout, depending on your theme and resolution. This is because they may appear as authors of news articles etc. in headlines that appear in various blocks.</P
><P
>To prevent your users from using long user names, you must change the maximum allowed length in modules/Your_Account/index.php, in the function userCheck(). Find the line:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>if (strlen($username) &#62; 25) $stop = "&#60;center&#62;"._NICK2LONG."&#60;/center&#62;";</PRE
></FONT
></TD
></TR
></TABLE
><P
>and change the 25 to a lower length. A better programming style would be to define a constant for this and do the check against the constant.</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="modifying-php-nuke-module-web-links.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="modifying-php-nuke-news-module.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Modifying the <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> Web_Links module</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="modifying-php-nuke-modules.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Modifying the <SPAN
CLASS="APPLICATION"
>PHP-Nuke</SPAN
> News module</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>