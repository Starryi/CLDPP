<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>4. Raw I/O Variable-Size Optimization Patch</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="I/O Performance HOWTO"><link rel="up" href="index.html" title="I/O Performance HOWTO"><link rel="prev" href="ar01s03.html" title="3. Avoiding Bounce Buffers"><link rel="next" href="ar01s05.html" title="5. I/O Request Lock Patch"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. Raw I/O Variable-Size Optimization Patch</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s03.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s05.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm159"></a>4. Raw I/O Variable-Size Optimization Patch</h2></div></div></div><p>This section provides information on the raw I/O variable-size optimization patch for the Linux 2.4 kernel written by Badari Pulavarty. This patch is also known as the RAW VARY or PAGESIZE_io patch. </p><p>The raw I/O variable-size patch changes the block size used for raw I/O from <em class="structfield"><code>hardsect_size</code></em> (normally 512 bytes) to 4 kilobytes (K).	The patch improves I/O throughput and CPU utilization by reducing the number of buffer heads needed for raw I/O operations.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm164"></a>4.1. Locating the Patch</h3></div></div></div><p>You can download the patch from one of the following locations:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Andrea Arcangeli has made the patch available at			
<a class="ulink" href="http://www.kernel.org/pub/linux/kernel/people/andrea/kernels/v2.4/2.4.18pre7aa2/" target="_top">http://www.kernel.org/pub/linux/kernel/people/andrea/kernels/v2.4/2.4.18pre7aa2/</a>. 
The name of the file is <span class="emphasis"><em>10_rawio-vary-io-1</em></span>.</p></li><li class="listitem"><p>Alan Cox has included the patch in the <span class="emphasis"><em>2.4.18pre9-ac2</em></span> kernel patch. The patch is available at <a class="ulink" href="http://www.kernel.org/pub/linux/kernel/people/alan/linux-2.4/2.4.18/" target="_top">http://www.kernel.org/pub/linux/kernel/people/alan/linux-2.4/2.4.18/</a>. </p></li><li class="listitem"><p>The patch is available from SourceForge at <a class="ulink" href="http://sourceforge.net/projects/lse/io" target="_top">http://sourceforge.net/projects/lse/io</a>. The latest version is <span class="emphasis"><em>PAGESIZE_io-2.4.17.patch</em></span>.</p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm180"></a>4.2. Modifying Your Driver for the Raw I/O Variable-Size Optimization Patch</h3></div></div></div><p>In previous versions of this patch, changes were enabled for all drivers. However, the 2.4.17 and later 				versions of the patch enable the changes only for the Adaptec, Qlogic ISP1020, and IBM ServerRAID drivers. All other drivers for version 2.4.17 and later must be modified to make use of the patch by setting the <em class="structfield"><code>can_do_varyio</code></em> bit in the <em class="structfield"><code>Scsi_Host_Template</code></em>  structure.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Drivers that have the raw I/O patch enabled must support buffer heads of variable sizes <em class="structfield"><code>(b_size)</code></em> in a single I/O request because <em class="structfield"><code>hardsect_size</code></em> is used until the data buffer is aligned  on a 4 K boundary.</p><p>Additional information is available on rebuilding Linux device drivers at <a class="ulink" href="http://www.xml.com/ldd/chapter/book/index.html" target="_top">http://www.xml.com/ldd/chapter/book/index.html</a>.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s03.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s05.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3. Avoiding Bounce Buffers </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 5. I/O Request Lock Patch</td></tr></table></div></body></html>
