<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>5. I/O Request Lock Patch</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="I/O Performance HOWTO"><link rel="up" href="index.html" title="I/O Performance HOWTO"><link rel="prev" href="ar01s04.html" title="4. Raw I/O Variable-Size Optimization Patch"><link rel="next" href="ar01s06.html" title="6. Additional Resources"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. I/O Request Lock Patch</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s04.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s06.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm191"></a>5. I/O Request Lock Patch</h2></div></div></div><p>This section provides information on the I/O request lock patch, also known as the scsi concurrent queuing patch 			(sior1), written by Johnathan Lahr. </p><p>The I/O request lock patch improves SCSI I/O performance on Linux 2.4 multi-processor systems by providing concurrent I/O request 	queuing. There are significant I/O performance and CPU utilization improvements possible by enabling multi-processors to concurrently drive multiple block devices.</p><p>Before the patch is applied block I/O requests are queued one at a time holding the global spin lock, <em class="structfield"><code> 				io_request_lock</code></em>.	Once the patch is applied, SCSI requests are queued while holding the  lock specific to the queue associated with the request. Requests that are made to different devices are queued concurrently, and requests that are made to the same device are queued serially.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm197"></a>5.1. Locating the Patch</h3></div></div></div><p>You can download the I/O request patch from Sourceforge at <a class="ulink" href="http://sourceforge.net/projects/lse/io" target="_top">http://sourceforge.net/projects/lse/io</a>. The latest version is <span class="emphasis"><em>sior1-v1.2416</em></span>. Patches that enable concurrent queuing for specific drivers are also available at SourceForge. The patch for the Emulex SCSI/FC is <span class="emphasis"><em>lpfc_sior1-v0.249</em></span> and the patch for Adaptec SCSI is <span class="emphasis"><em>aic_sior1-v0.249</em></span>.</p><p></p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm205"></a>5.2. Modifying Your Driver for the I/O Request Lock Patch</h3></div></div></div><p>The I/O request lock patch installs concurrent queuing capability into the SCSI midlayer. Concurrent queuing is 
activated for each SCSI adapter device driver. To activate the driver, the <em class="structfield"><code>concurrent_queue</code></em> field in the 	<em class="structfield"><code>Scsi_Host_Template</code></em> structure must be set when the driver is registered.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Drivers that activate concurrent queuing must ensure that any access of the <em class="structfield"><code>request_queue</code></em> by the driver is protected by the <em class="structfield"><code>request_queue.queue_lock</code></em>.</p><p>Additional information is available on rebuilding device drivers at <a class="ulink" href="http://www.xml.com/ldd/chapter/book/index.html" target="_top">http://www.xml.com/ldd/chapter/book/index.html</a>.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s04.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s06.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4. Raw I/O Variable-Size Optimization Patch </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 6. Additional Resources</td></tr></table></div></body></html>
