<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>12.  The Linux-2.6 kernel</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="USB Flash Memory HOWTO"><link rel="up" href="index.html" title="USB Flash Memory HOWTO"><link rel="prev" href="ar01s11.html" title="11.  Maintenance"><link rel="next" href="ar01s13.html" title="13.  Formalities"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">12.  The Linux-2.6 kernel</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s11.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s13.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="linux-2.6"></a>12.  The Linux-2.6 kernel</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="What-is-new"></a>12.1.  What is new?</h3></div></div></div><p> 
      Setting up your system as described above for the Linux-2.4.x
      kernels will be perfectly good, but with the Linux-2.6.x kernels
      (x = 0, 1, 2, 3 at the time of this writing) much more is possible:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          USB Hotplugging of devices has been improved immensely. This
          means that it has become possible to attach and remove a
          device from the USB port with full cognisance of the
          system. If a device is attached, it will show in the /proc
          filesystem. Once it is removed, it will not show anymore.
         </p></li><li class="listitem"><p>
          The <span class="emphasis"><em>sysfs</em></span> system has been
          introduced. By using this facility, a very tight grip on
          attached devices, their attributes and nodes of attachment
          is possible.
         </p></li><li class="listitem"><p>
          Utilities for handling hotplugging have been improved or
          became available. With the aid of these it is possible to
          easily distinguish between attached devices irrespective of
          the order in which they were attached.
         </p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="kernel-options"></a>12.2.  Kernel options </h3></div></div></div><p>
      Kernel configuration options are very much the same as described
      in <a class="xref" href="ar01s05.html#kernel" title="5.2.  Kernel options">Section 5.2, &#8220; Kernel options&#8221;</a>. The configuration menu
      (<code class="prompt">#</code><strong class="userinput"><code><span class="command"><strong> make </strong></span>  
      menuconfig</code></strong>) has been organized differently
      and more systematically. Here are the relevant choices:
     </p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="bus-options"></a>12.2.1.  Bus options</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: none; "><li class="listitem" style="list-style-type: none">
           Support for hot-pluggable devices (CONFIG_HOTPLUG)
          </li></ul></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="device-drivers"></a>12.2.2.  Device drivers</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: none; "><li class="listitem" style="list-style-type: disc">
           <span class="strong"><strong> SCSI device support</strong></span>
          </li><li class="listitem" style="list-style-type: none">
            SCSI device support (CONFIG_SCSI scsi_mod)
          </li><li class="listitem" style="list-style-type: none"> 
           legacy /proc/scsi support (CONFIG_SCSI_PROC_FS)
          </li><li class="listitem" style="list-style-type: none"> 
           SCSI disk support (CONFIG_BLK_DEV_SD sd_mod)
          </li><li class="listitem" style="list-style-type: none"><p> </p></li><li class="listitem" style="list-style-type: disc">
           <span class="strong"><strong> USB support</strong></span>
          </li><li class="listitem" style="list-style-type: none">
           Support for USB (CONFIG_USB usbcore)
          </li><li class="listitem" style="list-style-type: none">
           USB device filesystem (CONFIG_USB_DEVICEFS)
          </li><li class="listitem" style="list-style-type: none">
           UHCI HCD support (CONFIG_USB_UHCI_HCD uhci_hcd) 
          </li><li class="listitem" style="list-style-type: none">
           USB Mass Storage support (CONFIG_USB_STORAGE usb_storage)
          </li></ul></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="fss-2.6"></a>12.2.3.  File systems</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: none; "><li class="listitem" style="list-style-type: none"> 
           Second extended (CONFIG_EXT2_FS ext2)
          </li><li class="listitem" style="list-style-type: none"><p> </p></li><li class="listitem" style="list-style-type: disc"> 
           <span class="strong"><strong> DOS/FAT/NT filesystems</strong></span>
          </li><li class="listitem" style="list-style-type: none"> 
           DOS FAT fs support (CONFIG_FAT_FS fat)
          </li><li class="listitem" style="list-style-type: none"> 
           MSDOS fs support (CONFIG_MSDOS_FS msdos)
          </li><li class="listitem" style="list-style-type: none"> 
           VFAT (Windows 95) fs support (CONFIG_VFAT_FS vfat)
          </li><li class="listitem" style="list-style-type: none"><p> </p></li><li class="listitem" style="list-style-type: disc">
           <span class="strong"><strong> Pseudo filesystems</strong></span>
          </li><li class="listitem" style="list-style-type: none"> 
           /proc file system support (CONFIG_PROC_FS)
          </li></ul></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="notes-2.6"></a>12.3. Notes</h3></div></div></div><p>
     It may be in your interest to consult 
        <a class="ulink" href="http://thomer.com/linux/migrate-to-2.6.html" target="_top">
          Migrating to Linux Kernel 2.6</a>,
     but it is not necessary to follow steps that cannot be followed.
    </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="hotplug"></a>12.4.  Hotplugging and Naming </h3></div></div></div><p>
         In <a class="xref" href="ar01s06.html#scsidev" title="6.2.  SCSI devices">Section 6.2, &#8220; SCSI devices&#8221;</a> the situation of two USB
         devices plugged in at the same time was discussed. The
         difficulty is that it becomes hard for the user to
         distinguish the two devices. Progress recently made in the
         <a class="ulink" href="http://sourceforge.net/search/" target="_top">Linux Hotplug
         Project </a> (search for hotplug) and implemented in the
         2.6-series of kernels, has made it possible to address this
         problem efficiently. For implementation some utilities are
         needed:
       </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"> sysfs -- compiled by default into Linux-2.6.x
          </li><li class="listitem">
           <a class="ulink" href="http://linux-diag.sourceforge.net/Sysfsutils.html" target="_top">
            sysfsutils-0.4.0 or later</a>
          </li><li class="listitem"> 
           <a class="ulink" href="http://sourceforge.net/projects/linux-hotplug" target="_top">
           hotplug-2004_01_05 or later</a>
          </li><li class="listitem">
            <a class="ulink" href="http://www.kernel.org/pub/linux/utils/kernel/hotplug" target="_top">
             udev-016 or later</a>
          </li></ul></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="installation"></a>12.4.1.  Installation</h4></div></div></div><p><b>The sysfs filesystem. </b></p><p>
             The <span class="emphasis"><em>sysfs</em></span> filesystem is intrinsic to
             the Linux-2.6 kernel series. It is used by
             <span class="emphasis"><em>udev</em></span> and
             <span class="emphasis"><em>sysfstools</em></span> to obtain information
             about kernel objects (devices, etc.), their attributes
             and mutual linkages. Activation is according to the
             following procedure:
            </p><pre class="screen">
              <code class="prompt"># </code><strong class="userinput"><code><span class="command"><strong>cd</strong></span></code></strong> /
              <code class="prompt"># </code><strong class="userinput"><code><span class="command"><strong>mkdir</strong></span></code></strong> sys
              <code class="prompt"># </code><strong class="userinput"><code><span class="command"><strong>mount</strong></span></code></strong> -t sysfs none /sys
            </pre><p> 

             If you do <strong class="userinput"><code><span class="command"><strong> ls </strong></span>  -F
             /sys</code></strong>, a whole directory structure
             with entries like <span class="emphasis"><em>block/</em></span>,
             <span class="emphasis"><em>bus/</em></span>, ... will be shown. You were
             successful. The mounting should now be made permanent by
             adding the following line to
             <code class="filename">/etc/fstab</code>:
            </p><pre class="screen">
              none  /sys   sysfs  defaults  0  0
            </pre><p><b>Sysfsutils. </b></p><p>
             This is installed in one of the usual ways without having
             to make special configuration options. Instructions in
             the README file are very clear. You should, however,
             first make sure that the entry
             <code class="filename">/usr/local/lib</code> is entered in
             <code class="filename">/etc/ld.so.conf</code> so that the
             <code class="filename">libsysfs.so</code> libraries will be
             recognisable by the system. After installation, check
             that the utilities <code class="filename">/usr/local/bin/lsbus</code>
             and <code class="filename">/usr/local/bin/systool</code> have been
             installed. Also check that the libraries mentioned above
             have been properly linked in
             (<strong class="userinput"><code><span class="command"><strong>ldconfig </strong></span>-p | grep
             libsysfs</code></strong>).
           </p><p><b>Hotplug. </b></p><p>
             Next install the <code class="filename">hotplug</code>
             scripts. The first thing to do is to check that
             hotplugging will work on your system. Do:
             <strong class="userinput"><code><span class="command"><strong> less </strong></span>
             /proc/sys/kernel/hotplug</code></strong>. The
             result should be
             <code class="computeroutput">/sbin/hotplug</code>. If it is
             not so, you should add the line <code class="filename"> echo
             "/sbin/hotplug" &gt; /proc/sys/kernel/hotplug</code> to
             an appropriate initialization script,
             e.g. <code class="filename">/etc/rc.d/rc.local</code>. This
             command could also be given (as root) before checking
             that everything works. Installation is extremely
             simple. Do: <code class="prompt"># </code><strong class="userinput"><code><span class="command"><strong> make
             </strong></span> install</code></strong>. Check afterwards that the
             script <code class="filename">/sbin/hotplug</code> exists.
            </p><p><b>Udev. </b></p><p>
             This is the last installation. Study the README file and
             follow the instructions necessary to be able to run
             <strong class="userinput"><code><span class="command"><strong>make </strong></span>
             USE_KLIBC=true</code></strong>. If you have
             compiled the Linux-2.6.x kernel, this should not be too
             difficult. A quick check would be to find out if
             <code class="filename">/sbin/udev</code> and
             <code class="filename">/sbin/udevinfo</code> exist. There are
             other occurences as well, a very important one being
             <code class="filename">/etc/udev/udev.rules</code>. If you have a
             working setup for memory sticks (as described above) and
             a memory stick plugged in you could try
             <strong class="userinput"><code><span class="command"><strong>ls </strong></span>/udev</code></strong>, you
             should see the device (sda, sda1, ...). If it is there,
             unplug the device and list again. It should be gone!
           </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="names"></a>12.4.2. Naming memory sticks</h4></div></div></div><p>
             With the <span class="emphasis"><em>udev</em></span> utility in place, it
             is possible to identify a memory stick on the basis of
             some built-in attribute. One that works, is the
             <span class="emphasis"><em>vendor</em></span> identity. To find this for an
             attached device, do <strong class="userinput"><code><span class="command"><strong>systool
             </strong></span> -vb scsi | grep vendor</code></strong>. This
             should give a list of attached SCSI devices (remember
             that your memory stick poses as a SCSI device <a class="xref" href="ar01s06.html#scsidev" title="6.2.  SCSI devices">Section 6.2, &#8220; SCSI devices&#8221;</a>). Let us suppose that you have two
             memory sticks plugged in at the same time and found (as I
             did) two vendor Id's, namely "UFD" and "STORAGE". Then
             add to the file <code class="filename">/etc/udev/udev.rules</code>
             the following lines (at the top if you like):
           </p><pre class="screen">
              ## Flash Memory 1
              BUS="scsi", SYSFS_vendor="UFD*", NAME="namib%n"

              ## Flash Memory 2
              BUS="scsi", SYSFS_vendor="STORAGE*", NAME="kalahari%n"
           </pre><p>
             The vendor-identities may have trailing blank spaces, and
             therefore the wildcard asterisks have a purpose. Do not
             ignore them.  Remove and replace the memory sticks, then
             do <strong class="userinput"><code><span class="command"><strong>ls </strong></span>
             /udev</code></strong>. Instead of the impersonal
             <code class="filename">sda</code>, <code class="filename">sda1</code>,
             etc. there should now be <code class="filename">kalahari</code>,
             <code class="filename">kalahari1</code>,
             <code class="filename">namib</code> and
             <code class="filename">namib1</code>. The devices have been named
             according to the "vendor" information in them. Thus we
             can identify the device, no matter where it was
             mapped. All that remains to be done is to creat
             appropriate mount points like
             <code class="filename">/mnt/namib</code> and
             <code class="filename">kalahari</code> and make entries like
           </p><pre class="screen">
             /udev/namib1     /mnt/namib     vfat,ext2  user,noauto,rw  0 0 
             /udev/kalahari1  /mnt/kalahari  vfat,ext2  user,noauto,rw  0 0         
            </pre><p>
             in <code class="filename">/etc/fstab</code> to enable mounting
             from other places.
           </p><p>
             This is great fun ... and remember, there are other
             deserts on the planet.
           </p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s11.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s13.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">11.  Maintenance </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 13.  Formalities</td></tr></table></div></body></html>
