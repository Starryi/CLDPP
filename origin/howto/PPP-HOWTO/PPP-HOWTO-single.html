<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Linux PPP HOWTO</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"></HEAD
><BODY
CLASS="BOOK"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="BOOK"
><A
NAME="AEN1"
></A
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
><A
HREF="http://www.linuxports.com/howto/ppp"
TARGET="_top"
>Linux PPP HOWTO</A
></A
></H1
><H3
CLASS="AUTHOR"
><A
NAME="AEN5"
></A
>Corwin Light-Williams</H3
><H3
CLASS="AUTHOR"
><A
NAME="AEN8"
></A
>Joshua Drake</H3
><P
CLASS="COPYRIGHT"
>Copyright &copy; 2000 Commandprompt, Inc</P
><P
CLASS="COPYRIGHT"
>Copyright &copy; 1997 Robert Hart</P
><P
CLASS="PUBDATE"
>v4.0, 8 July 2000<BR></P
><DIV
><DIV
CLASS="ABSTRACT"
><P
></P
><A
NAME="AEN18"
></A
><P
>This is a LinuxPorts.Com Document for the Linux Documentation Project.</P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
><A
HREF="#AEN20"
>About This Document</A
></DT
><DT
>1. <A
HREF="#AEN28"
>How can I help?</A
></DT
><DT
>2. <A
HREF="#AEN44"
>Introduction</A
></DT
><DD
><DL
><DT
>2.1. <A
HREF="#AEN52"
>Clients and Servers</A
></DT
><DT
>2.2. <A
HREF="#AEN71"
>Differences between Linux distributions</A
></DT
><DT
>2.3. <A
HREF="#AEN100"
>PPP configuration tools</A
></DT
></DL
></DD
><DT
>3. <A
HREF="#AEN112"
>IP Numbers</A
></DT
><DT
>4. <A
HREF="#AEN143"
>Aims of this Document</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="#AEN145"
>Setting up a PPP Client</A
></DT
><DT
>4.2. <A
HREF="#AEN150"
>Linking two LANs or a LAN to the Internet using PPP</A
></DT
><DT
>4.3. <A
HREF="#AEN153"
>Using intuitive configuration tools to set up PPP</A
></DT
><DT
>4.4. <A
HREF="#AEN156"
>Setting up a PPP server</A
></DT
><DT
>4.5. <A
HREF="#AEN161"
>Using PPP over a direct null modem connection</A
></DT
><DT
>4.6. <A
HREF="#AEN164"
>This document at present does NOT cover...</A
></DT
></DL
></DD
><DT
>5. <A
HREF="#AEN180"
>Software versions covered</A
></DT
><DT
>6. <A
HREF="#AEN189"
>Other Useful/Important Documents</A
></DT
><DD
><DL
><DT
>6.1. <A
HREF="#AEN227"
>Useful Linux Mailing Lists</A
></DT
></DL
></DD
><DT
>7. <A
HREF="#TOOLS"
>Easy Configuration Utilities for PPP</A
></DT
><DD
><DL
><DT
>7.1. <A
HREF="#AEN238"
>KPPP - The KDE PPP Dialer</A
></DT
><DT
>7.2. <A
HREF="#AEN314"
>WvDial - A command-line pppd driver</A
></DT
><DT
>7.3. <A
HREF="#AEN328"
>rp3 - RedHat PPP dialer</A
></DT
><DT
>7.4. <A
HREF="#AEN342"
>Linuxconf - Universal (almost) Linux PPP dialer</A
></DT
></DL
></DD
><DT
>8. <A
HREF="#PROBLEMS"
>Debugging</A
></DT
><DD
><DL
><DT
>8.1. <A
HREF="#AEN386"
>I have compiled PPP support into the kernel, but...</A
></DT
><DT
>8.2. <A
HREF="#AEN412"
>My modem connects but ppp never starts up</A
></DT
><DT
>8.3. <A
HREF="#AEN419"
>The syslog says "serial line is not 8 bit clean"</A
></DT
><DT
>8.4. <A
HREF="#AEN452"
>Default route not set</A
></DT
><DT
>8.5. <A
HREF="#AEN459"
>Other Problems</A
></DT
></DL
></DD
><DT
>9. <A
HREF="#AEN463"
>Overview of what has to be done to get PPP working as a client</A
></DT
><DD
><DL
><DT
>9.1. <A
HREF="#AEN467"
>Obtaining/Installing the software</A
></DT
><DT
>9.2. <A
HREF="#AEN474"
>Compiling PPP support into the kernel</A
></DT
><DT
>9.3. <A
HREF="#AEN492"
>Obtaining information from your ISP</A
></DT
><DT
>9.4. <A
HREF="#AEN499"
>Configuring your modem and serial port</A
></DT
><DT
>9.5. <A
HREF="#AEN505"
>Setting up Name to Address Resolution (DNS)</A
></DT
><DT
>9.6. <A
HREF="#AEN521"
>PPP and root Privileges</A
></DT
><DT
>9.7. <A
HREF="#AEN526"
>Checking your distribution PPP Files and setting up the PPP Options</A
></DT
><DT
>9.8. <A
HREF="#AEN537"
>If your PPP server uses PAP (Password Authentication Protocol)</A
></DT
><DT
>9.9. <A
HREF="#AEN545"
>Connecting to the PPP server by hand</A
></DT
><DT
>9.10. <A
HREF="#AEN550"
>Automating your PPP Connection</A
></DT
><DT
>9.11. <A
HREF="#AEN557"
>Shutting down the link</A
></DT
><DT
>9.12. <A
HREF="#AEN562"
>If you have problems</A
></DT
><DT
>9.13. <A
HREF="#AEN570"
>After the link comes up</A
></DT
><DT
>9.14. <A
HREF="#AEN577"
>Problems with standard IP services on a Dynamic IP number PPP link</A
></DT
><DT
>9.15. <A
HREF="#AEN582"
>Maintaining a permanent connection to the net with <EM
>pppd</EM
>.</A
></DT
></DL
></DD
><DT
>10. <A
HREF="#KERNEL-CONFIGURATION"
>Configuring your Linux Kernel</A
></DT
><DD
><DL
><DT
>10.1. <A
HREF="#AEN609"
>Installing the Linux Kernel source</A
></DT
><DT
>10.2. <A
HREF="#AEN640"
>Knowing your hardware</A
></DT
><DT
>10.3. <A
HREF="#AEN644"
>Kernel compilation - the Linux 1.2.13 kernel</A
></DT
><DT
>10.4. <A
HREF="#AEN656"
>Kernel compilation - the Linux 1.3.x, 2.0.x, and 2.2.x kernels</A
></DT
><DT
>10.5. <A
HREF="#AEN676"
>Note on PPP-2.x and <TT
CLASS="LITERAL"
>/proc/net/dev</TT
></A
></DT
><DT
>10.6. <A
HREF="#AEN686"
>General kernel config considerations for PPP</A
></DT
></DL
></DD
><DT
>11. <A
HREF="#SERVER-INFO"
>Getting the Information you need about the PPP server</A
></DT
><DT
>12. <A
HREF="#MODEM"
>Configuring your modem and serial port</A
></DT
><DD
><DL
><DT
>12.1. <A
HREF="#AEN745"
>A note about serial ports and speed capabilities</A
></DT
><DT
>12.2. <A
HREF="#AEN753"
>Serial Port Names</A
></DT
><DT
>12.3. <A
HREF="#AEN761"
>Configuring your modem</A
></DT
><DT
>12.4. <A
HREF="#AEN797"
>Note on Serial Flow Control</A
></DT
><DT
>12.5. <A
HREF="#AEN808"
>Testing your modem for dial out</A
></DT
></DL
></DD
><DT
>13. <A
HREF="#DNS"
>Setting up Name to Address Resolution (DNS)</A
></DT
><DD
><DL
><DT
>13.1. <A
HREF="#AEN877"
>The <TT
CLASS="LITERAL"
>/etc/resolv.conf</TT
> file</A
></DT
><DT
>13.2. <A
HREF="#AEN892"
>The <TT
CLASS="LITERAL"
>/etc/host.conf</TT
> file</A
></DT
></DL
></DD
><DT
>14. <A
HREF="#ROOT"
>Using PPP and root privileges</A
></DT
><DT
>15. <A
HREF="#OPTIONS"
>Setting up the PPP connection files</A
></DT
><DD
><DL
><DT
>15.1. <A
HREF="#AEN964"
>The supplied options.tpl file</A
></DT
><DT
>15.2. <A
HREF="#AEN970"
>What options should I use? (No PAP/CHAP)</A
></DT
><DT
>15.3. <A
HREF="#AEN980"
>Other options to consider adding</A
></DT
></DL
></DD
><DT
>16. <A
HREF="#PAP"
>If your PPP server uses PAP (Password Authentication
Protocol)</A
></DT
><DD
><DL
><DT
>16.1. <A
HREF="#AEN994"
>Using MSCHAP</A
></DT
><DT
>16.2. <A
HREF="#AEN1005"
>The PAP/CHAP secrets file</A
></DT
><DT
>16.3. <A
HREF="#AEN1034"
>The PAP secrets file</A
></DT
><DT
>16.4. <A
HREF="#AEN1053"
>The CHAP secrets file</A
></DT
><DT
>16.5. <A
HREF="#AEN1071"
>Handling multiple PAP-authenticated connections</A
></DT
></DL
></DD
><DT
>17. <A
HREF="#MANUAL"
>Setting up the PPP connection manually</A
></DT
><DT
>18. <A
HREF="#AUTOMATE"
>Automating your connections - Creating the connection scripts</A
></DT
><DD
><DL
><DT
>18.1. <A
HREF="#AEN1173"
>Connection scripts for User name/Password Authentication</A
></DT
><DT
>18.2. <A
HREF="#AEN1188"
>The ppp-on script</A
></DT
><DT
>18.3. <A
HREF="#AEN1200"
>Editing the supplied PPP startup scripts</A
></DT
><DT
>18.4. <A
HREF="#AEN1219"
>What a Chat script means...</A
></DT
><DT
>18.5. <A
HREF="#AEN1285"
>A chat script for PAP/CHAP authenticated connections</A
></DT
><DT
>18.6. <A
HREF="#AEN1290"
>The pppd <TT
CLASS="LITERAL"
>debug</TT
> and <TT
CLASS="LITERAL"
>file option_file</TT
> options</A
></DT
></DL
></DD
><DT
>19. <A
HREF="#AEN1303"
>Testing your connection script</A
></DT
><DT
>20. <A
HREF="#OFF"
>Shutting down the PPP link</A
></DT
><DT
>21. <A
HREF="#AEN1329"
>Getting Help when totally stuck</A
></DT
><DT
>22. <A
HREF="#AEN1337"
>Common Problems once the link is working</A
></DT
><DD
><DL
><DT
>22.1. <A
HREF="#AEN1341"
>I can't see beyond the PPP server I connect to</A
></DT
><DT
>22.2. <A
HREF="#AEN1354"
>I can send email, but not receive it</A
></DT
><DT
>22.3. <A
HREF="#AEN1357"
>Why can't people finger, WWW, gopher, talk, etc. to my machine?</A
></DT
></DL
></DD
><DT
>23. <A
HREF="#DYNAMIC-SERVER"
>Using Internet services with Dynamic IP numbers</A
></DT
><DD
><DL
><DT
>23.1. <A
HREF="#AEN1368"
>Setting up email</A
></DT
><DT
>23.2. <A
HREF="#AEN1386"
>Setting Up a local Name server</A
></DT
></DL
></DD
><DT
>24. <A
HREF="#WAN"
>Linking two networks using PPP</A
></DT
><DD
><DL
><DT
>24.1. <A
HREF="#AEN1403"
>Setting up the IP numbers</A
></DT
><DT
>24.2. <A
HREF="#AEN1410"
>Setting up the routing</A
></DT
><DT
>24.3. <A
HREF="#AEN1418"
>Network security</A
></DT
></DL
></DD
><DT
>25. <A
HREF="#IP-UP"
>After the link comes up - the <TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
> script</A
></DT
><DD
><DL
><DT
>25.1. <A
HREF="#AEN1442"
>Special routing</A
></DT
><DT
>25.2. <A
HREF="#AEN1448"
>Handling email queues</A
></DT
><DT
>25.3. <A
HREF="#AEN1455"
>A sample <TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
> script</A
></DT
><DT
>25.4. <A
HREF="#AEN1464"
>Handling email</A
></DT
></DL
></DD
><DT
>26. <A
HREF="#AEN1477"
>Using <TT
CLASS="LITERAL"
>/etc/ppp/ip-down</TT
></A
></DT
><DT
>27. <A
HREF="#AEN1482"
>Routing issues on a LAN</A
></DT
><DD
><DL
><DT
>27.1. <A
HREF="#AEN1500"
>Note on Security</A
></DT
></DL
></DD
><DT
>28. <A
HREF="#PPP-SERVER"
>Setting up a PPP server</A
></DT
><DD
><DL
><DT
>28.1. <A
HREF="#AEN1510"
>Kernel compilation</A
></DT
><DT
>28.2. <A
HREF="#AEN1516"
>Overview of the server system</A
></DT
><DT
>28.3. <A
HREF="#AEN1535"
>Getting the software together</A
></DT
><DT
>28.4. <A
HREF="#AEN1547"
>Setting up standard (shell access) dialup.</A
></DT
><DT
>28.5. <A
HREF="#AEN1552"
>Setting up the PPP options files</A
></DT
><DT
>28.6. <A
HREF="#AEN1569"
>Setting pppd up to allow users to (successfully) run it</A
></DT
><DT
>28.7. <A
HREF="#AEN1577"
>Setting up the global alias for pppd</A
></DT
></DL
></DD
><DT
>29. <A
HREF="#DIRECT"
>Using PPP across a null modem (direct serial) connection</A
></DT
><DT
>30. <A
HREF="#AEN1609"
>PPPoE or PPP over Ethernet</A
></DT
></DL
></DIV
><DIV
CLASS="PREFACE"
><HR><H1
><A
NAME="AEN20"
></A
>About This Document</H1
><P
>This document was updated via assistance from the 
<A
HREF="http://www.opendocspublishing.com/"
TARGET="_top"
>Open Source Documentation Fund.</A
>
This is a <A
HREF="http://www.linuxports.com/"
TARGET="_top"
>LinuxPorts.Com</A
> Document for the
<A
HREF="http://www.linuxdoc.org/"
TARGET="_top"
>Linux Documentation Project</A
></P
><P
>This document shows how to connect your Linux PC to a PPP server, how to
use PPP to link two LANs together and provides one method of setting up
your Linux computer as a PPP server.The document also provides help in
debugging non-functional PPP connections.</P
><P
>This document is distributed under the terms of the GPL (GNU Public
License).</P
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="AEN28"
></A
>Chapter 1. How can I help?</H1
><P
>We will try to provide comprehensive coverage for all Linux PPP implementations. However
time is of the essence and this document is not a revenue maker. We provide this information
in hopes that it will be useful to the Linux Community and newly converted Linux users.
We are always interested in feedback and will implement every relevant topic possible to
this HOWTO.</P
><P
>If you would like to assist with this document, there are two primary avenues that are extremely
helpful.</P
><P
></P
><UL
><LI
><P
><A
HREF="http://www.linuxports.com/cart/"
TARGET="_top"
>Purchase an OpenBook!</A
> If you purchase
OpenDocs books, OpenDocs Publishing will donate a portion of the proceeds back to the 
<A
HREF="http://www.opendocspublishing.com/"
TARGET="_top"
>Open Source Documentation Fund.</A
> This
fund assists authors financially while they continue to write documentation for Open Source
projects.</P
></LI
><LI
><P
><EM
>Provide a monetary contribution to the document</EM
>. By doing so you can even request what
you would like to have updated, written, or expanded with in the document. If it is a
major revision (such as writing sections specifically for Mandrake or Caldera) please
contact <A
HREF="http://www.commandprompt.com/"
TARGET="_top"
>Command Prompt, Inc.</A
></P
></LI
><LI
><P
>If you have written something that you would like to contribute just email it to
<A
HREF="mailto:poet@linuxports.com"
TARGET="_top"
>poet@linuxports.com</A
></P
></LI
></UL
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="AEN44"
></A
>Chapter 2. Introduction</H1
><P
>PPP (the Point to Point Protocol) is a mechanism for creating and
running IP  (the Internet Protocol) and other network protocols over a
serial link - be that a direct serial connection (using a null-modem
cable), over a telnet established link, or a link made using modems and
telephone lines (and of course using digital lines such as ISDN).</P
><P
>Using PPP, you can connect your Linux PC to a PPP server and access the
resources of the network to which the server is connected (almost) as if
you were directly connected to that network.</P
><P
>You can also set up your Linux PC as a PPP server, so that other
computers can dial into your computer and access the resources on your
local PC and/or network.</P
><P
>As PPP is a peer-to-peer system, you can also use PPP on two Linux PCs
to link together two networks (or a local network to the Internet),
creating a Wide Area Network (WAN).</P
><P
>One major difference between serial based PPP and an Ethernet connection is of course
speed - a standard Ethernet connection operates at 10 Mbs (Mega - million bits
per second) or 100 Mbs maximum theoretical throughput, whereas an analogue modem
operates at speeds up to 56 kbps (kilo - thousand bits per second).</P
><P
>Also, depending on the type of PPP connection, there may be some
limitations in usage of some applications and services.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN52"
>2.1. Clients and Servers</A
></H2
><P
>PPP is strictly a <EM
>peer to peer</EM
> protocol; there is (technically) no
difference between the machine that dials in and the machine that is
dialed into. However, for clarity's sake, it is useful to think in terms
of <EM
>servers</EM
> and <EM
>clients</EM
>.</P
><P
>When you dial into a site to establish a PPP connection, you are a
<EM
>client</EM
>. The machine to which you connect is the <EM
>server</EM
>.</P
><P
>When you are setting up a Linux box to receive and handle dial-in PPP
connections, you are setting up a PPP <EM
>server</EM
>.</P
><P
>Any Linux PC can be both a PPP server and client - even
simultaneously if you have more than one serial port (and modem if
necessary). As stated above, there is no real difference between clients
and servers as far as PPP is concerned, once the connection is made.</P
><P
>This document refers to the machine that initiates the call (that dials
in) as the <EM
>CLIENT</EM
>, whilst the machine that answers the telephone,
checks the authentication of the dial in request (using user names,
passwords and possibly other mechanisms) is referred to as the
<EM
>SERVER</EM
>.</P
><P
>The use of PPP as a client to link one or more machines at a location
into the Internet is, probably, the one in which  most people are
interested - that is using their Linux PC as a client.</P
><P
>The procedure described in this document will allow you to
establish and automate your Internet connection.</P
><P
>This document will also give you guidance in setting up your Linux PC as
a PPP <EM
>server</EM
> and in linking two LANs together (with full routing)
using PPP (this is frequently characterized as establishing a WAN - wide
area network - link).</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN71"
>2.2. Differences between Linux distributions</A
></H2
><P
>There are many different Linux distributions and they all have their own
idiosyncrasies and ways of doing things.</P
><P
>In particular, there are two different ways a Linux (and Unix) computer
actually starts up, configures its interfaces, and so forth.</P
><P
>These are <EM
>BSD system initialization</EM
> and <EM
>System V system
initialization</EM
>. If you dip into some of the Unix news groups, you
will find occasional religious wars between proponents of these two
systems. If that sort of thing amuses you, have fun burning bandwidth
and join in!</P
><P
>Possibly the most widely used distributions are</P
><P
>&#13;<P
></P
><UL
><LI
><P
>Slackware

which uses BSD style system initialization</P
></LI
><LI
><P
>Red Hat (and its former associate Caldera)

which use SysV system initialization (although in a slightly modified form)</P
></LI
><LI
><P
>Debian

which uses SysV system initialization</P
></LI
></UL
>&#13;</P
><P
>BSD style initialization typically keeps its initialization files in
<TT
CLASS="LITERAL"
>/etc/...</TT
> and these files are:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>	/etc/rc
	/etc/rc.local
	/etc/rc.serial
		(and possibly other files)</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Of recent times, some BSD system initialization schemes use a <TT
CLASS="LITERAL"
>/etc/rc.d...</TT
>
directory to hold the start up file rather than putting everything into <TT
CLASS="LITERAL"
>/etc</TT
>.</P
><P
>System V initialization keeps its initialization files in directories under
<TT
CLASS="LITERAL"
>/etc/...</TT
> or  <TT
CLASS="LITERAL"
>/etc/rc.d/...</TT
> and a number of
subdirectories under there:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>drwxr-xr-x   2 root     root         1024 Jul  6 15:12 init.d
-rwxr-xr-x   1 root     root         1776 Feb  9 05:01 rc
-rwxr-xr-x   1 root     root          820 Jan  2  1996 rc.local
-rwxr-xr-x   1 root     root         2567 Jul  5 20:30 rc.sysinit
drwxr-xr-x   2 root     root         1024 Jul  6 15:12 rc0.d
drwxr-xr-x   2 root     root         1024 Jul  6 15:12 rc1.d
drwxr-xr-x   2 root     root         1024 Jul  6 15:12 rc2.d
drwxr-xr-x   2 root     root         1024 Jul 18 18:07 rc3.d
drwxr-xr-x   2 root     root         1024 May 27  1995 rc4.d
drwxr-xr-x   2 root     root         1024 Jul  6 15:12 rc5.d
drwxr-xr-x   2 root     root         1024 Jul  6 15:12 rc6.d</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>If you are trying to track down where your Ethernet interface and
associated network routes are actually configured, you will need to
track through these files to actually find where the commands are
that do this.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN100"
>2.3. PPP configuration tools</A
></H2
><P
>There are many good tools available for configuring and using PPP
on Linux. This document will try to cover some of the more popular
ones, including:</P
><P
></P
><UL
><LI
><P
>kppp
A PPP setup and dialer tool for KDE.</P
></LI
><LI
><P
>WvDial
Another PPP driver for Linux, with an emphasis on simplicity.</P
></LI
><LI
><P
>RP3...(short for RedHat PPP). It is a simple configuration program
with a "wizard" interface- it asks a series of questions.</P
></LI
><LI
><P
>Linuxconf
A generalized tool for configuring and managing your Linux machine,
it has a section that helps configure PPP.</P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="AEN112"
></A
>Chapter 3. IP Numbers</H1
><P
>Every device that connects to the Internet must have its own, unique IP
number. These are assigned centrally by a designated authority for each
country.</P
><P
>If you are connecting a local area network (LAN) to the Internet,
<EM
>YOU MUST</EM
> use an IP number from your own assigned network range for
all the computers and devices you have on your LAN. You <EM
>MUST NOT</EM
>
pick IP numbers out of the air and use these whilst connecting to
another LAN (let alone the Internet). At worst this will simply not work
at all and could cause total havoc as your 'stolen' IP number starts
interfering with the communications of another computer that is already
using the IP number you have picked out of the air.</P
><P
>Please note that the IP numbers used throughout this document (with some
exceptions) are from the 'unconnected network numbers' series that are
reserved for use by networks that are not (ever) connected to the
Internet.</P
><P
>There are IP numbers that are specifically dedicated to LANs that do not
connect to the Internet. The IP number sequences are:-</P
><P
>&#13;<P
></P
><UL
><LI
><P
>One A Class Network Address

10.0.0.0 (netmask 255.0.0.0)</P
></LI
><LI
><P
>16 B Class Network Addresses

172.16.0.0 - 172.31.0.0 (netmask 255.255.0.0)</P
></LI
><LI
><P
>256 C Class Network Addresses

192.168.0.0 - 192.168.255.0 (netmask 255.255.255.0)</P
></LI
></UL
>&#13;</P
><P
>If you have a LAN for which you have <EM
>not</EM
> been allocated IP
numbers by the responsible authority in your country, you should use one
of the network numbers from the above sequences for your machines.</P
><P
>These numbers should <EM
>never</EM
> be used on the Internet.</P
><P
>However, they can be used for the local Ethernet on a machine that is
connecting to the Internet. This is because IP numbers are actually
allocated to a network interface, not to a computer. So whilst your
Ethernet interface may use 10.0.0.1 (for example), when you hook onto
the Internet using PPP, your PPP interface will be given another (and
valid) IP number by the server. Your PC will have Internet connectivity,
but the other computers on your LAN will not.</P
><P
>However, using Linux and the IP Masquerade (also known as NAT - Network
address Translation) capabilities of the Linux and the ipfwadm
software, you can connect your LAN to the Internet (with some
restriction of services), even if you do not have valid IP numbers for the
machines on your Ethernet.</P
><P
>For more information on how to do this see the IP Masquerade mini-HOWTO
at <A
HREF="http://metalab.unc.edu/mdw/HOWTO/IP-Masquerade-HOWTO.html"
TARGET="_top"
>Linux IP Masquerade mini HOWTO</A
></P
><P
>For most users, who are connecting a single machine to an Internet 
service provider via PPP, obtaining an IP number (or more accurately, a
network number) will not be necessary.</P
><P
>If you wish to connect a small LAN to the Internet, many Internet
Service Providers (ISPs) can provide you with a dedicated subnet (a specific
sequence of IP numbers) from their existing IP address space.
Alternatively, use IP Masquerading.</P
><P
>For users, who are connecting a single PC to the Internet via an ISP,
most providers use <EM
>dynamic</EM
> IP number assignment. That is, as part
of the connection process, the PPP service you contact will tell your
machine what IP number to use for the PPP interface during the current
session. This number will not be the same every time you connect to your
ISP. </P
><P
>With dynamic IP numbers, you are <EM
>not</EM
> necessarily
given the same IP number each time you connect. This has implications for
server type applications on your Linux machine such as sendmail, ftpd, httpd
and so forth. These services are based on the premise that the computer
offering the service is accessible at the same IP number all the time
(or at least the same fully qualified domain name - FQDN - and that DNS
resolution of the name to IP address is available).</P
><P
>The limitations of service due to dynamic IP number assignment (and ways
to work around these, where possible) are discussed later in the
document.</P
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="AEN143"
></A
>Chapter 4. Aims of this Document</H1
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="AEN145"
>4.1. Setting up a PPP Client</A
></H2
><P
>This document provides guidance to people who wish to use Linux and PPP to
dial into a PPP server and set up an IP connection using PPP. It assumes
that PPP has been compiled and installed on your Linux machine (but does
briefly cover reconfiguring/recompiling your kernel to include PPP support).</P
><P
>Whilst DIP (the standard way of creating a SLIP connection) can be used
to set up a PPP connection, DIP scripts are generally quite complex. For
this reason, this document does NOT cover using DIP to set up a PPP
connection.</P
><P
>Instead, this document describes the standard Linux PPP software
(chat/pppd).</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN150"
>4.2. Linking two LANs or a LAN to the Internet using PPP</A
></H2
><P
>This document provides (basic) information on linking two LANs or a LAN
to the Internet using PPP.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN153"
>4.3. Using intuitive configuration tools to set up PPP</A
></H2
><P
>There are many tools used for configuring your PPP connection.
This document will try to cover the most common and easiest to
use of said programs.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN156"
>4.4. Setting up a PPP server</A
></H2
><P
>This document provides guidance on how to configure your Linux PC
as a PPP server (allowing other people to dial into your Linux PC and
establish a PPP connection).</P
><P
>You should note that there are a myriad of ways of setting up Linux as a
PPP server. This document gives one method - that used by
the author to set up several small PPP servers (each of 16 modems).</P
><P
>This method is known to work well. However, it is not necessarily
the best method.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN161"
>4.5. Using PPP over a direct null modem connection</A
></H2
><P
>This document provides a brief overview of using PPP to link two Linux
PCs via a null modem cable. It is possible to link other OS's to Linux
this way as well. To do so, you will need to consult the documentation
for the operating system you are interested in.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN164"
>4.6. This document at present does NOT cover...</A
></H2
><P
>&#13;<P
></P
><UL
><LI
><P
>Compiling the PPP daemon software

See the documentation that comes with the version of pppd you are using.&#13;</P
></LI
><LI
><P
>Connecting and configuring a modem to Linux (in detail)

See the Serial-HOWTO and for modem specific initialization, see <A
HREF="http://www.in.net/info/modems/index.html"
TARGET="_top"
>Modem Setup Information</A
> for information that may help you to configure your modem.&#13;</P
></LI
><LI
><P
>Using DIP to make PPP connections.

Use chat instead...&#13;</P
></LI
><LI
><P
>Using socks or IP Masquerade.

There are perfectly good documents already covering these two packages.&#13;</P
></LI
><LI
><P
>Using EQL to gang together two modems into a single PPP link. This is covered in the
<A
HREF="http://www.linuxports.com/howto/networking"
TARGET="_top"
>Networking-HOWTO</A
>.</P
></LI
></UL
>&#13;</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="AEN180"
></A
>Chapter 5. Software versions covered</H1
><P
>This HOWTO assumes that you are using a Linux 1.2.x kernel with the
PPP 2.1.2 software or 1.3.x/2.0.x/2.2.x kernel with the PPP 2.4.0 software.</P
><P
>This HOWTO will cover version 1.6.18 of KPPP.</P
><P
>This HOWTO will cover version 1.41 of WvDial.</P
><P
>This HOWTO will cover version 0.03 of PPPoE.</P
><P
>This HOWTO will cover version 1.18 of Linuxconf.</P
><P
><EM
>Please try to use the latest versions of software, as many bugs are fixed
as time goes on.</EM
></P
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="AEN189"
></A
>Chapter 6. Other Useful/Important Documents</H1
><P
>Users are advised to read :-

<P
></P
><UL
><LI
><P
>The documentation that comes with the PPP package.</P
></LI
><LI
><P
>The pppd and chat man pages;

(use <TT
CLASS="LITERAL"
>man chat</TT
> and <TT
CLASS="LITERAL"
>man pppd</TT
> to explore these.)</P
></LI
><LI
><P
>The Linux Network Administration Guide (NAG);

see <A
HREF="http://metalab.unc.edu/mdw/LDP/nag/nag.html"
TARGET="_top"
>The Network Administrators' Guide</A
>.</P
></LI
><LI
><P
>The Net-2/3 HOWTO;

see <A
HREF="http://metalab.unc.edu/mdw/HOWTO/NET3-4-HOWTO.html"
TARGET="_top"
>Linux Networking-HOWTO</A
>.</P
></LI
><LI
><P
>Linux kernel documentation installed in
<TT
CLASS="LITERAL"
>/usr/src/linux/Documentation</TT
> when you install the Linux source
code.</P
></LI
><LI
><P
>The modem setup information page - see <A
HREF="http://www.in.net/info/modems/index.html"
TARGET="_top"
>Modem Setup Information</A
>.</P
></LI
><LI
><P
>The excellent Unix/Linux books published by O'Reilly and
Associates. See (<A
HREF=" http://www.ora.com/"
TARGET="_top"
>O'Reilly and Associates On-Line Catalogue</A
>). If you are new
to Unix/Linux, <EM
>run</EM
> (don't walk) to your nearest computer book shop
and invest in a number of these immediately!</P
></LI
><LI
><P
>The PPP-FAQ maintained by Al Longyear, available from <A
HREF="ftp://sunsite.unc.edu/pub/Linux/docs/faqs/PPP-FAQ/PPP-FAQ"
TARGET="_top"
>Linux PPP-FAQ</A
>.

This contains a great deal of useful information in question/answer
format that is very useful when working out why PPP is not working
(properly).</P
></LI
><LI
><P
>The growing number of Linux books from various publishing houses and
authors;

You are actively encouraged to check the currency of these
books. Linux development and distributions tend to evolve fairly
rapidly, whilst the revision of books move (generally) much more slowly!
Buying an excellent book (and there are many) that is now out of date
will cause new users considerable confusion and frustration.</P
></LI
><LI
><P
>The documentation associated with the PPP tool(s) you are using

The package specific documentation, usually easily available, is
often the most useful when dealing with a specific tool.</P
></LI
></UL
>&#13;</P
><P
>The best general starting point for Linux documentation is <A
HREF="http://www.linuxdoc.org"
TARGET="_top"
>The Linux Documentation Project Home Page</A
>. The HOWTO's tend to be revised reasonably regularly.</P
><P
>Whilst you can use this document to create your PPP link without reading
any of these documents, you will have a far better understanding of what
is going on if you do so! You will also be able to address problems
yourself (or at least ask more intelligent questions on the
comp.os.linux... newsgroups or Linux mailing lists).</P
><P
>These documents (as well as various others, including the relevant RFCs)
provide additional and more detailed explanation than is possible in
this HOWTO.</P
><P
>If you are connecting a LAN to the Internet using PPP, you will need
to know a reasonable amount about TCP/IP networking. In addition to the
documents above, you will find the O'Reilly books "TCP/IP Network Administration"
 and "Building Internet Firewalls" of considerable benefit!</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN227"
>6.1. Useful Linux Mailing Lists</A
></H2
><P
>There are many Linux mailing lists that operate as a means of communication
between users of many levels of ability. By all means subscribe to those
that interest you and contribute your expertise and views.</P
><P
><EM
>A word to the wise</EM
>: some lists are specifically aimed at "high powered"
users and/or specific topics. Whilst no-one will complain if you 'lurk'
(subscribe but don't post messages), you are likely to earn heated
comments (if not outright flames) if you post 'newbie' questions to
inappropriate lists.</P
><P
>This is not because guru level users hate new users, but because these
lists are there to handle the specific issues at particular levels of
difficulty.</P
><P
>By all means join the lists that offer open subscription, but keep your
comments relevant to the subject of the list!</P
><P
>A good starting point for Linux mailing lists is
<A
HREF="http://oslab.snu.ac.kr/~djshin/linux/mail-list/index.shtml"
TARGET="_top"
>Linux Mailing List Directory</A
></P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="TOOLS"
></A
>Chapter 7. Easy Configuration Utilities for PPP</H1
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="AEN238"
>7.1. KPPP - The KDE PPP Dialer</A
></H2
><P
>http://devel-home.kde.org/~kppp/index.html</P
><P
>KPPP is an easy tool for configuring your PPP links. It comes with the
default installation of KDE, and is quite well integrated into that
environment.</P
><P
>KPPP also has a good help system built in. If you just right click
on the majority of the buttons in the application, a menu will pop
up with an item called "Quickhelp". Clicking it will give a quick
summary of whatever item you clicked on.</P
><P
>The opening screen of kppp will list any available connections, and
allow you to specify a Login ID and password for the connection. 
There is also a "Show Log Window" option. Selecting this will show
a log window. This can be handy if you are trying to debug a connection.</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot05.jpg"></P
></DIV
><P
>For now, click on the "Setup" button. This will bring up the setup
window. It has a series of tabs across the top. Select the one called
"Accounts". There will be a list of Accounts, if any.</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot06.jpg"></P
></DIV
><P
>Select "New" from the right hand side. Another menu will pop up.</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot01.jpg"></P
></DIV
><P
>First, specify a name for this connection in the "Connection Name" box.
A good name would be the name of your ISP. Then enter the phone number.
Select the type of authentication. If your ISP hasn't specified otherwise,
leave it as "PAP". You can optionally store your password between sessions,
but this may be a security risk.</P
><P
>Click on the tab marked "IP". Here you have the option to configure your
IP address, either a Dynamic or Static address. You should know what kind
you want, specified by your ISP. You can also optionally specify that
you wish to configure the hostname for this IP, which means that kppp will
name your machine according to the name given to it by your ISP.</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot07.jpg"></P
></DIV
><P
>Click on the tab marked "DNS". Here you can set up DNS. Fill in the appropriate
fields with the information supplied from your ISP.</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot08.jpg"></P
></DIV
><P
>Click on the "Gateway" tab. Here you can configure your gateway, or router
address. If a gateway or router address was specified by your ISP, select
"Static Gateway" and enter it in the box below. Otherwise leave this alone.
The box marked "Assign the Default Route" should be checked.</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot09.jpg"></P
></DIV
><P
>The "Login Script" tag is only useful if you specified "Login Script"
authentication under the "Dial" tab. If you need to use a Login Script,
you can enter it here, as a series of commands. Select the type of command
you wish to use, followed by the argument, then click "Add". Click "Remove"
to remove a selected command.</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot10.jpg"></P
></DIV
><P
>The "Accounting" tab allows you to track the number of bytes that you
have sent and recieved for a given connection. This can be useful if your
ISP tracks the amount of data that you use, and perhaps charges you based
on that. If you wish to use accounting, click on the "Enable accounting" box.
You can then select a country, if you live in a country that has taxes,
tariffs, or other charges based on data transfer. Otherwise, just select
either "Bytes in", "Bytes in and out", or "Bytes out". For more information,
consult the KPPP manual.</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot11.jpg"></P
></DIV
><P
>Click OK to finish the creation of this new account.</P
><P
>Now we'll cover the other tabs in the kppp configuration window.</P
><P
>The next one is "Device". It contains configuration information about
your modem. You can select the device, flow control, line termination,
and connection speed. It is recommended that you leave these alone unless
otherwise specified by your ISP. You can also specify values for using
a lock file for your modem device(recommended) and a modem timeout.
Modem timeout refers to the amount of time that kppp will wait for your
modem to respond.</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot12.jpg"></P
></DIV
><P
>The "Modem" tab is mainly useful for debugging your modem. You can also
adjust your modem volume. For more information on these commands, consult
the kppp documentation.</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot13.jpg"></P
></DIV
><P
>Next is the "PPP" tag. It contains many useful items for making kppp tailor
fit to your needs. The "pppd Timeout" field specifies how long kppp should
wait for pppd to bring up a connection. The "Dock" option states that kppp
should recede into the KDE dock when it is connected. The "Automatic redial"
specifies that kppp should redial if it is disconnected. The "show clock"
option will display how time you have been connected. The "Disconnect on
X-server shutdown" means that if you leave KDE, PPP should shut down.
The "Quit on Disconnect" option will close kppp if you disconnect from your
ISP. Finally, the "Minimize window on connect" option will minimize kppp
when it connects.</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot14.jpg"></P
></DIV
><P
>The "Graph" tab is useful for kppp's throughput graphing. For more information
on this feature, see kppp's documentation.</P
><P
>Click Ok to leave this menu. Now ensure your connection is selected in
the "Connect to:" box, and click "connect". You're all set!</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN314"
>7.2. WvDial - A command-line pppd driver</A
></H2
><P
>The WvDial homepage is <A
HREF="http://www.worldvisions.ca/wvdial/"
TARGET="_top"
>here</A
></P
><P
>WvDial is a command-line pppd driver. It has two main components, wvdialconf
and wvdial. Both must be run as root. </P
><P
>First you must run wvdialconf. wvdialconf is generates a configuration
file containing information on your modem and ISP information. Running
wvdialconf will probe your comm ports, looking for a modem, and determine
the capabilities of any modems it finds.</P
><P
>wvdialconf is invoked with the name of your wvdial configuration file-
which is always /etc/wvdial.conf. Here's what the output should look like.</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>[root@blah /root]# wvdialconf newconffile
Scanning your serial ports for a modem.

ttyS1&#60;*1&#62;: ATQ0 V1 E1 -- OK
ttyS1&#60;*1&#62;: ATQ0 V1 E1 Z -- OK
ttyS1&#60;*1&#62;: ATQ0 V1 E1 S0=0 -- OK
ttyS1&#60;*1&#62;: ATQ0 V1 E1 S0=0 &#38;C1 -- OK
ttyS1&#60;*1&#62;: ATQ0 V1 E1 S0=0 &#38;C1 &#38;D2 -- OK
ttyS1&#60;*1&#62;: ATQ0 V1 E1 S0=0 &#38;C1 &#38;D2 S11=55 -- OK
ttyS1&#60;*1&#62;: ATQ0 V1 E1 S0=0 &#38;C1 &#38;D2 S11=55 +FCLASS=0 -- OK
ttyS1&#60;*1&#62;: Modem Identifier: ATI -- 28800
ttyS1&#60;*1&#62;: Speed 2400: AT -- OK
ttyS1&#60;*1&#62;: Speed 4800: AT -- OK
ttyS1&#60;*1&#62;: Speed 9600: AT -- OK
ttyS1&#60;*1&#62;: Speed 19200: AT -- OK
ttyS1&#60;*1&#62;: Speed 38400: AT -- OK
ttyS1&#60;*1&#62;: Speed 57600: AT -- OK
ttyS1&#60;*1&#62;: Speed 115200: AT -- OK
ttyS1&#60;*1&#62;: Max speed is 115200; that should be safe.
ttyS1&#60;*1&#62;: ATQ0 V1 E1 S0=0 &#38;C1 &#38;D2 S11=55 +FCLASS=0 -- OK
ttyS0&#60;*1&#62;: ATQ0 V1 E1 -- ATQ0 V1 E1 -- ATQ0 V1 E1 -- nothing.
Port Scan&#60;*1&#62;: S2   S3   

Found a modem on /dev/ttyS1.</PRE
></FONT
></TD
></TR
></TABLE
><P
>If your output looks different, check that your modem is plugged in,
turned on, and connected to a com port.</P
><P
>Once you have run wvdialconf, you need to edit the /etc/wvdial.conf file
to reflect the phone number to dial, and your username and password.
Open up /etc/wvdial.conf in your favorite text editor. It should look
something like this:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>[Dialer Defaults]
Modem = /dev/ttyS1
Baud = 115200
Init1 = ATZ
Init2 = ATQ0 V1 E1 S0=0 &#38;C1 &#38;D2 S11=55 +FCLASS=0
; Phone = 555-1212
; Username = my_login_name
; Password = my_login_password</PRE
></FONT
></TD
></TR
></TABLE
><P
>Remove the ';' and fill in the appropriate fields- phone number,
login name and password. Now you should be all set to run wvdial.</P
><P
>Run wvdial. Assuming that you filled in your phone number, username,
and password correctly, wvdial will now dial your ISP. wvdial will not
exit until the connection is terminated- you can do a Ctrl-C to terminate
it.</P
><P
>wvdial is fairly new and untested software, so if you run into any
problems along the way, you should contact the authors. You can find
their contact info on the homepage listed above.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN328"
>7.3. rp3 - RedHat PPP dialer</A
></H2
><P
>A good page about rp3 is located <A
HREF="http://www.redhat.com/support/manuals/RHL-6.2-Manual/getting-started-guide/ch-ppp.html"
TARGET="_top"
>here</A
>.</P
><P
>rp3 is available on any RedHat system running RedHat 6.2 or later.
It is located on your GNOME menu under Internet- called
"Dialup Configuration Tool". It is perhaps the simplest to use
of the tools this HOWTO covers. When you start it up, it presents
you with a screen that looks like this:</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot04.jpg"></P
></DIV
><P
>Click "Next". If rp3 can't find a modem, it will try to confiugre one.
Select your modem from the list and click next if this happens. You should
see a screen asking for an "Account name" and a phone number. Enter your
ISP's name and number in the appropriate fields. Click "Next".</P
><P
>rp3 will then ask you for your username and password. Enter them
in the appropriate fields and click "Next". Next rp3 will ask you
if your ISP is named in a list. If it is, select it and click
next. If not, select "Normal ISP" and click next.</P
><P
>That's it! Click "Finish" to complete account creation. </P
><P
>To initiate a connection, go to the GNOME menu again, and look under Internet
for "RH PPP Dialer". Click on it. When asked for an interface, select
"ppp0". This should bring up a small window. Right click on the window,
then on "Connect to ppp0". Wait a few seconds, and you're online! To
disconnect, right click on the window again, and then click "Disconnect".
That's it.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN342"
>7.4. Linuxconf - Universal (almost) Linux PPP dialer</A
></H2
><P
><A
HREF="http://dns.solucorp.qc.ca/linuxconf/"
TARGET="_top"
>Linuxconf homepage</A
></P
><P
>For help at any time while using Linuxconf, just hit the help key. Linuxconf
has contextual help menus for most its functionality.</P
><P
>Linuxconf's PPP section is fairly simple. First of all, open up Linuxconf.
This must be done as root. Here's a shot of Linuxconf in action:</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot02.jpg"></P
></DIV
><P
>Click on the box next to "Config", then the box on "Networking", then the
box next to "Client tasks". You should see an entry called "PPP/SLIP/PLIP".
Click on that. On the right hand side of Linuxconf, you should now see
a box called "PPP/Slip/Plip configurations". There should be an area
below that, listing existing PPP devices(if any) and three buttons below
that. </P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot15.jpg"></P
></DIV
><P
>Click "Add" to add a new connection. It will then ask you to
select a type of interface. Make sure "PPP" is selected, then press
Accept.</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot03.jpg"></P
></DIV
><P
>In this box, there are fields for phone number, modem, username and password.
Enter the appropriate information into the appropriate fields, and
you should be configured. </P
><P
>To bring up the PPP link, open the "Control" tab on the left hand side,
then go to "Control Panels", then "Control PPP/SLIP/PLIP Link".
You should see a list of PPP devices. Click on the one you just made.
A question will pop up, asking you if you wish to activate the connection.
Click "Yes".</P
><DIV
CLASS="MEDIAOBJECT"
><P
><IMG
SRC="images/snapshot16.jpg"></P
></DIV
><P
>There are also advanced configuration options, such as modem speed,
connect scripts and etc. If you need to configure any of that, go
back to the place where you originally configured the link, and click
on the link you wish to customize. It should bring up a screen with
four tabs: Hardware, Communication, Networking,and PAP.</P
><P
>It is advisable to not change any of these options unless you are specifically
told to do so by your ISP or modem vendor. Most of them will work just fine
without any additional configuration.</P
><P
>Linuxconf also has command line tools for use in bringing your
PPP connection up and down:</P
><P
></P
><UL
><LI
><P
>netconf --connect pppsetup [--fore]
This will bring the link up. The optional --fore means that it remains
in the foreground. Otherwise it will terminate either if the connection is
successful or if it fails. It will return 0 if successful, higher if otherwise.</P
><P
></P
></LI
><LI
><P
>netconf --dialctl
This will display all the available connections and their status.</P
></LI
><LI
><P
>netconf --disconnect pppsetup
This will disconnect the link.</P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="PROBLEMS"
></A
>Chapter 8. Debugging</H1
><P
>There are any number of reasons that your connection does not work -
chat has failed to complete correctly, you have a dirty line, etc. So
check your syslog for indications.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN386"
>8.1. I have compiled PPP support into the kernel, but...</A
></H2
><P
>A very common problem is that people compile PPP support into the kernel
and yet when they try to run pppd, the kernel complains that it does not
support ppp! There are a variety of reasons this can occur.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN389"
>8.1.1. Are you booting the right kernel?</A
></H3
><P
>Whilst you <EM
>have</EM
> recompiled your kernel to support ppp, you
are not booting the new kernel. This can happen if you do not update
<TT
CLASS="LITERAL"
>/etc/lilo.conf</TT
> and rerun lilo.</P
><P
>A good check on the kernel can be obtained by issuing the command
<TT
CLASS="LITERAL"
>uname -a</TT
>, which should produce a line like:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>Linux archenland 2.0.28 #2 Thu Feb 13 12:31:37 EST 1997 i586</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>This gives the kernel version and the date on which this kernel was
compiled - which should give you a pretty good idea of what is going on.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN399"
>8.1.2. Did you compile ppp kernel support as a module?</A
></H3
><P
>If you compiled your kernel ppp support as a module, but did not make
and install the modules, then you can get this error. Check the
kernel-HOWTO and the README file in <TT
CLASS="LITERAL"
>/usr/src/linux</TT
>!</P
><P
>Another module connected possibility is that you are expecting required
modules to be automatically loaded, but are not running the <TT
CLASS="LITERAL"
>kerneld</TT
>
daemon (which auto-loads and unloads modules on the fly). Check the
kerneld mini-HOWTO for information on setting up kerneld.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN405"
>8.1.3. Are you using the correct version of PPP for your kernel?</A
></H3
><P
>You <EM
>must</EM
> use ppp-2.2 with kernel version 2.0.x. You can use ppp-2.2
with kernel version 1.2.x (if you patch the kernel), otherwise you must
use ppp-2.1.2.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN409"
>8.1.4. Are you running pppd as root?</A
></H3
><P
>If you are not running pppd as the root user (and pppd is not suid to
root), you can receive this message.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN412"
>8.2. My modem connects but ppp never starts up</A
></H2
><P
>There are innumerable variations on this (take a look in comp.os.linux...).</P
><P
>A <EM
>VERY</EM
> common mistake is that you have mistyped something in your
scripts. The only thing to do here is to make sure you are logging the
chat conversation between you Linux PC and the server into your syslog
(/var/log/messages) and then go through this <EM
>line by line</EM
> to make
sure there are no mistakes.You may need to dial into the ppp server manually to check
things out again.</P
><P
>You need to check the log against the actual prompts very carefully -
and bear in mind that we humans have a tendency to read what we THINK we
have typed - not what is actually there!</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN419"
>8.3. The syslog says "serial line is not 8 bit clean"</A
></H2
><P
>There are variations on this too - such as <TT
CLASS="LITERAL"
>serial line looped back</TT
>
etc., and the cause can be one (or a sequence) of a number of things.</P
><P
>To understand what is going on here, it is necessary to grasp a bit of
what is going on behind the scenes in pppd itself.</P
><P
>When pppd starts up, it sends LCP (link control protocol) packets to the
remote machine. If it receives a valid response it then goes on to the
next stage (using IPCP - IP control protocol packets) and only when
this negotiation completes is the actual IP layer started so that you
can use the PPP link.</P
><P
>If there is no ppp server operating at the remote end when your PC sends
lcp packets, these get reflected by the login process at the far end. As
these packets use 8 bits, reflecting them strips the 8th bit (remember,
ASCII is a 7 bit code). PPP sees this and complains accordingly.</P
><P
>There are several reasons this reflection can occur.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN427"
>8.3.1. You are not correctly logging into the server</A
></H3
><P
>When your chat script completes, pppd starts on your PC. However, if you
have not completed the log in process to the server (including sending
any command required to start PPP  on the server), PPP will not start.</P
><P
>So, the lcp packets are reflected and you receive this error.</P
><P
>You need to carefully check and correct (if necessary) your chat script
(see above).</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN432"
>8.3.2. You are not starting PPP on the server</A
></H3
><P
>Some PPP servers require you to enter a command and/or a RETURN after
completing the log in process before the remote end starts ppp.</P
><P
>Check your chat script (see above).</P
><P
>If you log in manually and find you need to send a RETURN after this to
start PPP, simply add a blank expect/send pair to the end of your chat
script (an empty send string actually sends a RETURN).</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN437"
>8.3.3. The remote PPP process is slow to start</A
></H3
><P
>This one is a bit tricksy!</P
><P
>By default, your Linux pppd is compiled to send a maximum of 10 lcp
configuration requests. If the server is a bit slow to start up, all 10
such requests can be sent before the remote PPP is ready to receive
them.</P
><P
>On your machine, pppd sees all 10 requests reflected back (with the 8th
bit stripped) and exits.</P
><P
>There are two ways round this:-</P
><P
>Add "<TT
CLASS="LITERAL"
>lcp-max-configure 30</TT
>" to your ppp options. This increases
the maximum number of lcp configure packets pppd sends before giving up.
For really slow server, you may need even more than this.</P
><P
>Alternatively, you can get a bit tricksy in return. You may have noticed
that when you logged in by hand to the PPP server and PPP started there,
the <EM
>first</EM
> character of the ppp garbage that appears was always the
tilde character (&#732;).</P
><P
>Using this knowledge we can add a new <TT
CLASS="LITERAL"
>expect/send</TT
> pair to the
end of the chat script which expects a tilde and sends nothing. This
would look like:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>\~	''</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Note: as the tilde character has a special meaning in the shell, it must
be escaped (and hence the leading backslash).</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN452"
>8.4. Default route not set</A
></H2
><P
>If pppd refuses to set up a default route, it is because (quite
correctly) it refuses to remove/replace an existing default route.</P
><P
>The usual reason that this error occurs is that some distributions set
up a default route via your Ethernet card as opposed to setting up a
specific network route.</P
><P
>See the Linux NAG and the Net2/3 HOWTOs for information on correctly
setting up your Ethernet card and associated routes.</P
><P
>An alternative to this is that your LAN uses a gateway/router already and your
routing table has been set up to point the default route at this.</P
><P
>Fixing up this last situation can require a fair bit of IP networking knowledge
and is beyond the scope of this HOWTO. It is suggested you obtain some
expert advice (via the news groups of from someone locally you can ask).</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN459"
>8.5. Other Problems</A
></H2
><P
>There are many reasons apart from these that ppp fails to connect and/or
operate properly.</P
><P
>Look in the PPP FAQ (which is really a series of questions and
answers). This is a very comprehensive document and the answers ARE
there! From my own (sad) experience, if the answer to your
problems is not there, the problem is NOT ppp's fault! In my case I was
using an ELF kernel that I had not upgraded to  the appropriate
kernel modules. I only wasted about 2 days (and most of one night)
cursing what had been a perfect PPP server before the light dawned!</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="AEN463"
></A
>Chapter 9. Overview of what has to be done to get PPP working as a client</H1
><P
>This document contains a great deal of information - and with each
version it grows!</P
><P
>As a consequence, this section aims to provide a concise overview of the
actions you will need to take to get your Linux system connected as a
client to a PPP server.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN467"
>9.1. Obtaining/Installing the software</A
></H2
><P
>If your Linux distribution does not include the PPP software, you will
need to obtain this from <A
HREF="ftp://ftp.linuxcare.com.au/pub/ppp/"
TARGET="_top"
>the Linux PPP daemon</A
>.</P
><P
>Select the latest possible version(2.4.0 at the time of this writing.)</P
><P
>The PPP package contains instructions on how to compile and install the
software <EM
>so this HOWTO does not</EM
>!</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN474"
>9.2. Compiling PPP support into the kernel</A
></H2
><P
>Linux PPP operations come in two parts

<P
></P
><UL
><LI
><P
>the PPP daemon mentioned above</P
></LI
><LI
><P
>kernel support for PPP</P
></LI
></UL
>&#13;</P
><P
>Most distributions seem to provide PPP kernel support in their default
installation kernels, but others do not.</P
><P
>If at boot your kernel reports messages like</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>PPP Dynamic channel allocation code copyright 1995 Caldera, Inc.
PPP line discipline registered.</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>your kernel does have PPP support compiled in.</P
><P
>That said, you may want to compile your own kernel, whatever
your distribution, to provide the most efficient use of system resources
given your particular hardware configuration. It is worth remembering
that the kernel cannot be swapped out of memory and so keeping the
kernel as small as possible has advantages on a memory limited machine.</P
><P
>This document provides minimal kernel re-compilation instructions at
section <A
HREF="#KERNEL-CONFIGURATION"
>Chapter 10</A
>.</P
><P
>For greater detail, see the Kernel-HOWTO at <A
HREF="http://sunsite.unc.edu/mdw/HOWTO/Kernel-HOWTO.html"
TARGET="_top"
>The Linux Kernel HOWTO</A
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN492"
>9.3. Obtaining information from your ISP</A
></H2
><P
>There are an almost infinite number of ways in which a PPP server can be
set up. In order to connect to your ISP (or corporate PPP server to access
your intranet), you will need to obtain information on how the PPP
server operates.</P
><P
>Because you are using Linux, you may have some difficulty with some ISP
help desks (and work site based PPP intranet servers) which know only
about MS Windows clients.</P
><P
>However, a rapidly growing number of ISPs use Linux to provide their
service - and Linux is also penetrating the corporate environment as
well, so you may be lucky if you do strike problems.</P
><P
>Section <A
HREF="#SERVER-INFO"
>Chapter 11</A
> tells you what you need to know about the PPP server
to which you are going to connect - and how to find out the information
you need to know.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN499"
>9.4. Configuring your modem and serial port</A
></H2
><P
>In order to connect to a PPP server and to obtain the best possible
data transfer rate, your modem needs to be configured correctly.</P
><P
>Similarly, the serial ports on your modem and computer need to be set up
correctly.</P
><P
>Section <A
HREF="#MODEM"
>Chapter 12</A
>
provides information on this.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN505"
>9.5. Setting up Name to Address Resolution (DNS)</A
></H2
><P
>In addition to the files that run PPP and perform the automated log in
to the PPP server, there are a number of text configuration files that
have to be set up for your computer to be able to resolve names like
<TT
CLASS="LITERAL"
>www.interweft.com.au</TT
> to the IP address 
that is actually used to contact that computer. These are:-</P
><P
>&#13;<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>/etc/resolv.conf</TT
></P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>/etc/host.conf</TT
></P
></LI
></UL
>&#13;</P
><P
>Section <A
HREF="#DNS"
>Chapter 13</A
>
for details on setting this up.</P
><P
>In particular, you do <EM
>NOT</EM
> need to run a name server on your Linux
PC in order to connect to the Internet (although you may wish to). All
you need is to know the IP number of at least one name server that you
can use (preferably one at your ISPs site).</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN521"
>9.6. PPP and root Privileges</A
></H2
><P
>As establishing a PPP link between you Linux computer and another PPP
server requires manipulation of network devices (the PPP interface is a
network interface) and the kernel routing table, pppd requires root
privileges.</P
><P
>For details on this, see section <A
HREF="#ROOT"
>Chapter 14</A
>.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN526"
>9.7. Checking your distribution PPP Files and setting up the PPP Options</A
></H2
><P
>There are a number of configuration and dialer files that need to be set up
to get PPP operational. There are examples as part of the PPP
distribution and this section shows what files you should have:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>/etc/ppp/options
/etc/ppp/scripts/ppp-on
/etc/ppp/scripts/ppp-on-dialer
/etc/ppp/options.tpl</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>You may need to create some additional files depending on exactly what
you are aiming to achieve with PPP:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>/etc/ppp/options.ttyXX
/etc/ppp/ip-up
/etc/ppp/pap-secrets
/etc/ppp/chap-secrets</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>In addition, the PPP daemon can use a large number of command line
options and it is important to use the right ones; so this section takes
you through the standard PPP options and helps you choose the options
you should use.</P
><P
> For details on this, see <A
HREF="#OPTIONS"
>Chapter 15</A
>.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN537"
>9.8. If your PPP server uses PAP (Password Authentication Protocol)</A
></H2
><P
>Many ISPs and corporate PPP servers use PAP. If your server does
<EM
>not</EM
> require you to use PAP (if you can log in manually and receive
the standard user name/password text based prompts it does not use PAP),
you can safely ignore this section.</P
><P
>Instead of logging into such a server using a user name and password
when prompted to enter them by the server, a PPP server using PAP does
not require a text based login.</P
><P
>The user authentication information instead is exchanged as part of the
link control protocol (LCP), which is the first part of establishing a
PPP link.</P
><P
>Section <A
HREF="#PAP"
>Chapter 16</A
> provides information on the files you need to set up to
establish a PPP link using PAP.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN545"
>9.9. Connecting to the PPP server by hand</A
></H2
><P
>Having set up the basic files, it is a good idea to test these by
connecting (using minicom or seyon) and starting pppd on your Linux PC
by hand.</P
><P
>See Section <A
HREF="#MANUAL"
>Chapter 17</A
> for
full details of setting this up.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN550"
>9.10. Automating your PPP Connection</A
></H2
><P
>Once you are able to log in by hand, you can now move to setting up a
set of scripts that will automate the establishment of the connection.</P
><P
>Section <A
HREF="#AUTOMATE"
>Chapter 18</A
> covers setting up the necessary scripts, with
considerable attention paid to <TT
CLASS="LITERAL"
>chat</TT
> and scripting the login process
to the PPP server.</P
><P
>This section discusses scripts for user name/password authentication as
well as scripts for PAP/CHAP authenticating servers.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN557"
>9.11. Shutting down the link</A
></H2
><P
>Once your link is up and working, you need to be able to deactivate the
link.</P
><P
>This is covered in Section <A
HREF="#OFF"
>Chapter 20</A
>.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN562"
>9.12. If you have problems</A
></H2
><P
>Many people have problems getting PPP to work straight away. The
variation in PPP servers and how they require you to set up the
connection is enormous. Similarly, there are many options to PPP - and
some combinations of these just do not work together, ever.</P
><P
>In addition to the problems of logging in and starting the PPP service,
there are problems with the modems and the actual telephone lines as well!</P
><P
>Section <A
HREF="#PROBLEMS"
>Chapter 8</A
> provides some basic
information about common errors, how to isolate these and fix them.</P
><P
>This is <EM
>NOT</EM
> intended to provide more than just the basics. Al
Longyear maintains the PPP-FAQ which contains much more information on
this topic!</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN570"
>9.13. After the link comes up</A
></H2
><P
>Once a PPP link is operational (specifically, once the IP layer is
operational), Linux PPP can automatically run (as the root user), a script
to perform <EM
>any</EM
> function you can write a script to accomplish.</P
><P
>Section <A
HREF="#IP-UP"
>Chapter 25</A
> provides information on the
<TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
> script, the parameters it receives from PPP, and
how to use it to do things like, acquire your email from your ISP
account, send any queued email waiting transmission on your machine and
such.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN577"
>9.14. Problems with standard IP services on a Dynamic IP number PPP link</A
></H2
><P
>As noted in the introduction, dynamic IP numbers affect the
ability of your Linux PC to act as a server on the Internet.</P
><P
>Section <A
HREF="#DYNAMIC-SERVER"
>Chapter 23</A
> provides information on the (main) services
affected and what you can do (if anything) to overcome this.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN582"
>9.15. Maintaining a permanent connection to the net with <EM
>pppd</EM
>.</A
></H2
><P
>If you are fortunate enough to have a semi permanent connection to the net and
would like to have your machine automatically redial your PPP connection if it
is lost then here is a simple trick to do so.</P
><P
>Configure PPP such that it can be started by the <TT
CLASS="LITERAL"
>root</TT
> user by issuing the
command:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
># pppd</PRE
></FONT
></TD
></TR
></TABLE
>

<EM
>Be sure</EM
> that you have the `<TT
CLASS="LITERAL"
>-detach</TT
>' option configured in your
<TT
CLASS="LITERAL"
>/etc/ppp/options</TT
> file. Then, insert the following line into your
<TT
CLASS="LITERAL"
>/etc/inittab</TT
> file, down with the <EM
>getty</EM
> definitions:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>pd:23:respawn:/usr/sbin/pppd</PRE
></FONT
></TD
></TR
></TABLE
>

This will cause the <EM
>init</EM
> program to spawn and monitor the
<EM
>pppd</EM
>
program and automatically restart it if it dies.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="KERNEL-CONFIGURATION"
></A
>Chapter 10. Configuring your Linux Kernel</H1
><P
>In order to use PPP, your Linux kernel must be compiled to include PPP
support. Obtain the Linux source code for your kernel if you do not
already have this - it belongs in <TT
CLASS="LITERAL"
>/usr/src/linux</TT
> on Linux's standard
file system.</P
><P
>Check out this directory - many Linux distributions install the source
tree (the files and subdirectories) as part of their installation process.</P
><P
>At bootup, your Linux kernel prints out a great deal of information.
Amongst this is information about PPP support and if the kernel includes
it. To view this information, look at your syslog file or use
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>dmesg | less</PRE
></FONT
></TD
></TR
></TABLE
>
 to display the information to the screen. If your kernel includes
PPP support, you will see lines like</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>PPP Dynamic channel allocation code copyright 1995 Caldera, Inc.
PPP line discipline registered.</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>(this is for the Linux 2.x.x kernel series).</P
><P
>Linux kernel sources can be obtained by ftp from <TT
CLASS="LITERAL"
>sunsite.unc.edu</TT
> or its
mirror sites.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN609"
>10.1. Installing the Linux Kernel source</A
></H2
><P
>The following are brief instructions for obtaining and installing the
Linux kernel sources. Full information can be obtained from <A
HREF="http://sunsite.unc.edu/mdw/HOWTO/Kernel-HOWTO.html"
TARGET="_top"
>The Linux Kernel HOWTO</A
>.</P
><P
>In order to install and compile the Linux kernel, you need to be logged
in as root.</P
><P
>&#13;<P
></P
><OL
TYPE="1"
><LI
><P
>Change directory to the <TT
CLASS="LITERAL"
>/usr/src</TT
> directory

<TT
CLASS="LITERAL"
>cd /usr/src</TT
>.</P
></LI
><LI
><P
>Check in <TT
CLASS="LITERAL"
>/usr/src/linux</TT
> to see if you already have the
sources installed.</P
></LI
><LI
><P
>If you don't have the sources, get them from <A
HREF="ftp://sunsite.unc.edu/pub/Linux/kernel/"
TARGET="_top"
>Linux kernel source directory</A
> or your nearest mirror.

Select the appropriate directory- v2.0 if you are running a 2.0.x
kernel, or v2.2 if you are running a 2.2.x kernel.

If you are looking for earlier versions of the kernel (such as 1.2.X),
these are kept in <A
HREF="ftp://sunsite.unc.edu/pub/Linux/kernel/old"
TARGET="_top"
>Old Linux kernel source directory</A
>.</P
></LI
><LI
><P
>Choose the appropriate kernel - usually the most recent one
available is what you are looking for. Retrieve this and put the source
tar file in <TT
CLASS="LITERAL"
>/usr/src</TT
>.

<EM
>Note</EM
>: a 'tar' file is an archive - possibly compressed (as are the
Linux kernel source tar files) containing many files in a number of
directories. It is the Linux equivalent of a DOS multi-directory zip file.&#13;</P
></LI
><LI
><P
>If you already have the Linux sources installed but are upgrading
to a new kernel, you must remove the old sources. Use the
command

<TT
CLASS="LITERAL"
>rm -rf /usr/src/linux</TT
>.</P
></LI
><LI
><P
>Now uncompress and extract the sources using the command

<TT
CLASS="LITERAL"
>tar xzf linux-X.X.XX.tar.gz</TT
>

where "X.X.XX" is the version of the kernel you downloaded.</P
></LI
><LI
><P
>Now, <TT
CLASS="LITERAL"
>cd /usr/src/linux</TT
> and read the README file. This contains
an excellent explanation of how to go about configuring and compiling a
new kernel. Read this file, (it's a good idea to print it out and have a
copy handy whilst you are compiling until you have done this enough
times to know your way around).</P
></LI
></OL
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN640"
>10.2. Knowing your hardware</A
></H2
><P
>You <EM
>MUST</EM
> know what cards/devices you have inside your PC if you are
going to recompile your kernel!!! For some devices (such as sound cards)
you will also need to know various settings (such as IRQ's, I/O
addresses and such).</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN644"
>10.3. Kernel compilation - the Linux 1.2.13 kernel</A
></H2
><P
>To start the configuration process, follow the instructions in the
README file to properly install the sources. You start the kernel
configuration process with...</P
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>make config</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>In order to use PPP, you must configure the kernel to include PPP
support (PPP requires BOTH pppd AND kernel support for PPP).</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>  PPP (point-to-point) support (CONFIG_PPP) [n] y</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Answer the other make config questions according to the
hardware in your PC and the features of the Linux operating system you
want. Then continue to follow the README to compile and install your new
kernel.</P
><P
>The 1.2.13 kernel creates only 4 PPP devices. For multi-
port serial cards, you will need to edit the kernel PPP
sources to obtain more ports. (See the README.linux file that comes as
part of the PPP-2.1.2 distribution for full details of the simple edits
you need to make).</P
><P
>Note: the 1.2.13 configuration dialogue does NOT allow you to go
backwards - so if you make a mistake in answering one of the questions
in the <TT
CLASS="LITERAL"
>make config</TT
> dialogue, exit by typing CTRL C and start again.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN656"
>10.4. Kernel compilation - the Linux 1.3.x, 2.0.x, and 2.2.x kernels</A
></H2
><P
>For Linux 1.3.x, 2.0.x, and 2.2.x you can use a similar process as for Linux
1.2.13. Again, follow the instructions in the README file to properly
install the sources. You start the kernel configuration process with...</P
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>make config</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>However, you also have the choice of...

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>make menuconfig</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>This provides a menu based configuration system with online help that
allows you to move backwards and forwards in the configuration process.</P
><P
>There is also a highly recommended X windows based configuration interface...

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>make xconfig</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>You can compile PPP support directly into your kernel or as a
loadable module.</P
><P
>If you only use PPP some of the time that your Linux machine is
operating, then compiling PPP support as a loadable module is
recommended. Using 'kerneld', your kernel will automatically load the
module(s) required to provide PPP support when you start your PPP link
process. This saves valuable memory space: no part of the kernel can be
swapped out of memory, but loadable modules are automatically removed if
they are not in use.</P
><P
>To do this, you need to enable loadable module support:-

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>	Enable loadable module support (CONFIG_MODULES) [Y/n/?] y</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>To add PPP kernel support, answer the following question:-

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>	PPP (point-to-point) support (CONFIG_PPP) [M/n/y/?]  </PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>For a PPP loadable module, answer <EM
>M</EM
>, otherwise for PPP compiled in as
part of the kernel, answer <EM
>Y</EM
>.</P
><P
>Unlike kernel 1.2.13, kernel 2.0.x creates PPP devices on the fly as
needed and it is not necessary to hack the sources to increase available
PPP device numbers at all.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN676"
>10.5. Note on PPP-2.x and <TT
CLASS="LITERAL"
>/proc/net/dev</TT
></A
></H2
><P
>If you are using PPP-2.x, you will find that a side effect of the 'on
the fly' creation of the PPP devices is that no devices show up if you
look in the <TT
CLASS="LITERAL"
>/proc/net</TT
> file system until a device is created by
starting up pppd:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>[hartr@archenland hartr]$ cat /proc/net/dev
Inter-|   Receive                  |  Transmit
 face |packets errs drop fifo frame|packets errs drop fifo colls carrier
    lo:  92792    0    0    0    0    92792    0    0    0     0    0
  eth0: 621737   13   13    0   23   501621    0    0    0  1309    0</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Once you have one (or more) ppp services started, you will see entries
such as this (from a ppp server):-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>[root@kepler /root]# cat /proc/net/dev
Inter-|   Receive                  |  Transmit
 face |packets errs drop fifo frame|packets errs drop fifo colls carrier
    lo: 428021    0    0    0    0   428021    0    0    0     0    0
  eth0:4788257  648  648  319  650  1423836    0    0    0  4623    5
  ppp0:   2103    3    3    0    0     2017    0    0    0     0    0
  ppp1:  10008    0    0    0    0     8782    0    0    0     0    0
  ppp2:    305    0    0    0    0      297    0    0    0     0    0
  ppp3:   6720    7    7    0    0     7498    0    0    0     0    0
  ppp4: 118231  725  725    0    0   117791    0    0    0     0    0
  ppp5:  38915    5    5    0    0    28309    0    0    0     0    0</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN686"
>10.6. General kernel config considerations for PPP</A
></H2
><P
>If you are setting up your Linux PC as a PPP server, you must compile in
IP forwarding support. This is also necessary if you want to use Linux
to link to LANs together or your LAN to the Internet.</P
><P
>If you are linking a LAN to the Internet (or linking together two LANs), you
should be concerned about security. Adding support for IP fire walls to
the kernel is probably a MUST!</P
><P
>You will also need this if you want to use IP masquerade to connect a
LAN that uses any of the above mentioned 'unconnected' IP network
numbers.</P
><P
>To enable IP Masquerade and IP fire walling, you <EM
>MUST</EM
> answer yes to the
first question in the <TT
CLASS="LITERAL"
>make config</TT
> process:-

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>Prompt for development and/or incomplete code/drivers (CONFIG_EXPERIMENTAL)?</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Whilst this may sound a bit off-putting to new users, many users are
actively using the IP Masquerade and IP fire walling features of the
Linux 2.0.x or 2.2.x kernels with no problems.</P
><P
>Once you have installed and rebooted your new kernel, you can start
configuring and testing your PPP link(s).</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="SERVER-INFO"
></A
>Chapter 11. Getting the Information you need about the PPP server</H1
><P
>Before you can establish a PPP connection with a server, you need to
obtain the following information (from the sysadmin/user support people
of the PPP server):-

<P
></P
><UL
><LI
><P
>The telephone number(s) to dial for the service

If you are behind a PABX. You also need the PABX number that gives you
an outside dial tone - this is frequently digit zero (0) or nine (9).&#13;</P
></LI
><LI
><P
> Does the server use DYNAMIC or STATIC IP numbers?

If the server uses STATIC IP numbers, then you may need to know what IP
number to use for your end of the PPP connection. If your ISP is
providing you with a subnet of valid IP numbers, you will need to know
the IP numbers you can use and the network mask (netmask).


Most Internet Service Providers use DYNAMIC IP numbers. As mentioned
above, this has some implications in terms of the services you can
use.


However, even if you are using STATIC IP numbers, most PPP servers will
never (for security reasons) allow the client to specify an IP number as
this is a security risk. You <EM
>do</EM
> still need to know this information!&#13;</P
></LI
><LI
><P
>What are the IP numbers of the ISPs Domain Name Servers?

There should be at least two, although only one is needed.


There could be a problem here. The MS Windows 95 PPP setup allows the
DNS address to be passed to the client as part of its connection
process. So your ISP (or corporate help desk) may well tell you
don't need the IP address of the DNS server(s).


For Linux, you <EM
>DO</EM
> need the address of at least one DNS. The linux
implementation of PPP does not allow the setting of the DNS IP number
dynamically at connection time - and quite possibly will never do
so.


<EM
>Note</EM
>: whilst Linux (as a PPP client) cannot accept the DNS address
from a server, it can, when acting as a server, pass this information to
clients using the <TT
CLASS="LITERAL"
>dns-addr</TT
> pppd option.&#13;</P
></LI
><LI
><P
>Does the server require the use of PAP/CHAP?

If this is the case you need to know the "id" and "secret" you are to
use in connecting. (These are probably your user name and
password at your ISP).&#13;</P
></LI
><LI
><P
>Does the server automatically start PPP, or do you need to issue any
commands to start PPP on the server once you are logged in?

If you must issue a command to start PPP, what is it?&#13;</P
></LI
><LI
><P
>Is the server a Microsoft Windows NT system and, if so, is it
using the MS PAP/CHAP system?

Many corporate LANs seem to use MS Windows NT this way for increased security.</P
></LI
></UL
>&#13;</P
><P
>Carefully note down this information - you are going to use it!</P
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="MODEM"
></A
>Chapter 12. Configuring your modem and serial port</H1
><P
>You should make sure that your modem is correctly set up and that you
know which serial port it is connected to.</P
><P
><EM
>Remember</EM
>...

<P
></P
><UL
><LI
><P
>DOS com1: = Linux /dev/cua0 (and /dev/ttyS0)</P
></LI
><LI
><P
>DOS com2: = Linux /dev/cua1 (and /dev/ttyS1)

et cetera</P
></LI
></UL
>&#13;</P
><P
>It is also worth remembering that if you have 4 serial ports, the
standard PC set up is to have com1 and com3 share IRQ4 and com2 and com4
share IRQ3.</P
><P
>If you have devices on standard serial ports that share an IRQ with your
modem you are going to have problems. You need to make sure that your
modem serial port is on its own, unique IRQ. Many modern serial cards
(and better quality motherboard serial ports) allow you to move the IRQ
of the serial ports around.</P
><P
>If you are running Linux kernel 2, you can check the in-use IRQs using
<TT
CLASS="LITERAL"
>cat /proc/interrupts</TT
>, which will produce output like

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
> 0:    6766283   timer
 1:      91545   keyboard
 2:          0   cascade
 4:     156944 + serial
 7:     101764   WD8013
10:     134365 + BusLogic BT-958
13:          1   math error
15:    3671702 + serial</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>This shows a serial port on IRQ4 (a mouse) and a serial port
on IRQ15 (the permanent modem based PPP link to the Internet. (There is
also a serial port on com2, IRQ3 and com4 is on IRQ14, but as they are
not in use, they do not show up).</P
><P
>Be warned - you need to know what you are doing if you are going to play
with your IRQs! Not only do you have to open up you computer, pull out
cards and play with jumpers, but you need to know what is on which IRQ.
In my case, this is a totally SCSI based PC, and so I can disable the "on
motherboard" IDE interfaces that normally use IRQ14 and 15!</P
><P
>You should also remember that if your PC boots other operating systems,
moving IRQs around may well mean that OS cannot boot properly - or at all!</P
><P
>If you do move your serial ports to non-standard IRQs, then you need to
tell Linux which IRQ each port is using. This is done using "
<TT
CLASS="LITERAL"
>setserial</TT
>" and is best done as part of the boot process in
<TT
CLASS="LITERAL"
>rc.local</TT
> or <TT
CLASS="LITERAL"
>rc.serial</TT
> which is called from <TT
CLASS="LITERAL"
>rc.local</TT
> or as
part of the SysV initialization. For the machine illustrated above, the
commands used are...

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>/bin/setserial -b /dev/ttyS2 IRQ 11
/bin/setserial -b /dev/ttyS3 IRQ 15</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>However, if you are using serial modules dynamically loaded, when
required by the <TT
CLASS="LITERAL"
>kerneld</TT
> process, you cannot set and forget the IRQs,
(etc.) once at boot time. This is because if the serial module is unloaded,
Linux forgets the special settings.</P
><P
>So, if you are loading the serial module on demand, you will need to
reconfigure the IRQs, (etc.) each time the module is loaded.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN745"
>12.1. A note about serial ports and speed capabilities</A
></H2
><P
>If you are using a high speed (external) modem (14,400 Baud or above),
your serial port needs to be capable of handling the throughput that
such a modem is capable of producing, particularly when the modems are
compressing the data.</P
><P
>This requires your serial port to use a modern UART (Universal
Asynchronous Receiver Transmitter) such as a 16550(A). If you are using
an old machine (or old serial card), it is quite possible that your
serial port has only an 8250 UART, which will cause you considerable
problems when used with a high speed modem.</P
><P
>Use the command...

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>setserial -a /dev/ttySx</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>to get Linux to report to you the type of UART you have. If you
do not have a 16550A type UART, invest in a new serial card (available
for under $50). When you purchase a new card, make sure you can
move the IRQs around on it!</P
><P
>Note: the first versions of the 16550 UART chip had an error. This was
rapidly discovered and a revision of the chip was released - the 16550A
UART. A relatively small number of the faulty chips did however get into
circulation. It is unlikely that you will encounter one of these but you
should look for a response that says 16550A, particularly on serial
cards of some vintage.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN753"
>12.2. Serial Port Names</A
></H2
><P
>Historically, Linux used <TT
CLASS="LITERAL"
>cuaX</TT
> devices for dial-out and <TT
CLASS="LITERAL"
>ttySx</TT
>
devices for dial-in.</P
><P
>The kernel code that required this was changed in kernel version 2.0.x
and you should now use <TT
CLASS="LITERAL"
>ttySx</TT
> for both dial in and dial out. I
understand that the <TT
CLASS="LITERAL"
>cuaX</TT
> device names may well disappear in future
kernel versions.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN761"
>12.3. Configuring your modem</A
></H2
><P
>You will need to configure your modem correctly for PPP - to do this <EM
>READ
YOUR MODEM MANUAL</EM
>! Most modems come with a <EM
>factory default setting</EM
>
that selects the options required for PPP. The minimum configuration
specifies:-

<P
></P
><UL
><LI
><P
>Hardware flow control (RTS/CTS) (<TT
CLASS="LITERAL"
>&#38;</TT
>K3 on many Hayes modems)</P
></LI
></UL
>&#13;</P
><P
>Other settings (in standard Hayes commands) you should investigate are:

<P
></P
><UL
><LI
><P
>E1 Command/usr/src/linux-2.0.27/include/linux/serial.h Echo ON (required for chat to operate).</P
></LI
><LI
><P
>Q0 Report result codes (required for chat to operate).</P
></LI
><LI
><P
>S0=0 Auto Answer OFF (unless you want your modem to answer the phone).</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>&#38;</TT
>C1 Carrier Detect ON only after connect.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>&#38;</TT
>S0 Data Set Ready (DSR) always ON.</P
></LI
><LI
><P
>(depends)   Data Terminal Ready.</P
></LI
></UL
>&#13;</P
><P
>There is a site offering modem setups for a growing variety of modems,
makes and models at <A
HREF="http://www.in.net/info/modems/index.html"
TARGET="_top"
>Modem setup information</A
> which may assist you in this.</P
><P
>It is also worth while investigating how the modem's serial interface
between your computer and modem operates. Most modern modems allow you
to run the serial interface at a FIXED speed whilst allowing the
telephone line interface to change its speed to the highest speed it and
the remote modem can both handle.</P
><P
>This is known as split speed operation. If your modem supports this,
lock the modem's serial interface to its highest available speed
(usually 115,200 baud but maybe 38,400 baud for 14,400 baud modems).</P
><P
>Use your communications software (e.g. minicom or seyon) to find out
about your modem configuration and set it to what is required for PPP.
Many modems report their current settings in response to
AT<TT
CLASS="LITERAL"
>&#38;</TT
>V, but you should consult your modem manual.</P
><P
>If you completely mess up the settings, you can return to sanity
(usually) by issuing an AT<TT
CLASS="LITERAL"
>&#38;</TT
>F - return to factory settings.
(For most modem modems I have encountered, the factory settings include
all you need for PPP - but you should check).</P
><P
>Once you have worked out the modem setup string required, write it down.
You now have a decision: you can store these settings in your modem
non-volatile memory so they can be recalled by issuing the appropriate
AT command, or you can pass the correct settings to your
modem as part of the PPP dialing process.</P
><P
>If you only use your modem from Linux to call into your ISP or corporate
server, the simplest set up will have you save your modem configuration
in non-volatile RAM. </P
><P
>If on the other hand, you modem is used by other applications and
operating systems, it is safest to pass this information to the modem as
each call is made so that the modem is guaranteed to be in the correct
state for the call. (This has the added advantage also of recording the modem
setup string in case the modem looses  the contents of its NV-RAM, which
can indeed happen).</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN797"
>12.4. Note on Serial Flow Control</A
></H2
><P
>When data is traveling on serial communication lines, it can happen
that data arrives faster than a computer can handle it (the computer may
be busy doing something else - remember, Linux is a multi-user, multi-
tasking operating system). In order to ensure that data is not lost
(data does not over run in the input buffer and hence get lost), some
method of controlling the flow of data is necessary.</P
><P
>There are two ways of doing this on serial lines:-

<P
></P
><UL
><LI
><P
>Using hardware signals (Clear To Send/Request to Send - CTS/RTS).</P
></LI
><LI
><P
>Using software signals (control S and control Q, also known as XON/XOFF).</P
></LI
></UL
>&#13;</P
><P
>Whilst the latter may be fine for a terminal (text) link, data on a
PPP link uses all 8 bits - and it is quite probable that somewhere in
the data there will be data bytes that translate as control S and
control Q. So, if a modem is set up to use software flow control, things
can rapidly go berserk!</P
><P
>For high speed links using PPP (which uses 8 bits of data) hardware flow
control is vital and it is for this reason that you must use hardware
flow control.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN808"
>12.5. Testing your modem for dial out</A
></H2
><P
>Now that you have sorted out the serial port and modem settings it is a
good idea to make sure that these setting do indeed work by dialing you
ISP and seeing if you can connect.</P
><P
>Using you terminal communications package (such as minicom), set up the
modem initialisation required for PPP and dial into the PPP server you
want to connect to with a PPP session.</P
><P
>(Note: at this stage we are <EM
>NOT</EM
> trying to make a PPP connection
- just establishing that we have the right phone number and also to find
out <EM
>exactly</EM
> what the server sends to us in order to get logged in and
start PPP).</P
><P
>During this process, either capture (log to a file) the entire login
process or carefully (<EM
>very carefully</EM
>) write down <EM
>exactly</EM
> what
prompts the server gives to let you know it is time to enter your
user name and password (and any other commands needed to establish the
PPP connection).</P
><P
>If your server uses PAP, you should not see a login prompt, but should
instead see the (text representation) of the link control protocol
(which looks like garbage) starting on your screen.</P
><P
>A few words of warning:-</P
><P
>&#13;<P
></P
><UL
><LI
><P
>some servers are quite intelligent: you can log in
using text based user name/passwords OR using PAP. So if your ISP or
corporate site uses PAP but you do not see the garbage start up
immediately, this may not mean you have done something wrong.</P
></LI
><LI
><P
>some servers require you to enter some text initially and <EM
>then</EM
>
start a standard PAP sequence.</P
></LI
><LI
><P
>Some PPP servers are passive - that is they simply sit there
sending nothing until the client that is dialing in sends them a valid
lcp packet. If the ppp server you are connecting to operates in passive
mode, you will never see the garbage!</P
></LI
><LI
><P
>Some servers do not start PPP until you press ENTER - so it is
worth trying this if you correctly log in and do not see the garbage!</P
></LI
></UL
>&#13;</P
><P
>It is worth dialing in at least twice - some servers change their
prompts (e.g. with the time!) every time you log in. The two critical
prompts your Linux box needs to be able to identify every time you dial
in are:-

<P
></P
><UL
><LI
><P
>the prompt that requests you to enter your user name;</P
></LI
><LI
><P
>the prompt that requests you to enter your password;</P
></LI
></UL
>&#13;</P
><P
>If you have to issue a command to start PPP on the server, you will also
need to find out the prompt the server gives you once you are logged in
to tell you that you can now enter the command to start ppp.</P
><P
>If your server automatically starts PPP, once you have logged in,
you will start to see garbage on your screen - this is the PPP server
sending your machine information to start up and configure the PPP
connection.</P
><P
>This should look something like this :-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>~y}#.!}!}!} }8}!}$}%U}"}&#38;} } } } }%}&#38; ...}'}"}(}"} .~~y}</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>(and it just keeps on coming!)</P
><P
>On some systems PPP must be explicitly started on the server. This
is usually because the server has been set up to allow PPP logins and
shell logins using the same user name/password pair. If this is the case,
issue this command once you have logged in. Again, you will see the
garbage as the server end of the PPP connection starts up.</P
><P
>If you do not see this immediately after connecting (and logging in and
starting the PPP server if required), press <EM
>Enter</EM
> to see if this
starts the PPP server.</P
><P
>At this point, you can hang up your modem (usually, type <TT
CLASS="LITERAL"
>+++</TT
>
quickly and then issue the ATHO command once your modem responds with
OK).</P
><P
>If you can't get your modem to work, read your modem manual, the man
pages for your communications software and the Serial HOWTO! Once you
have this sorted out, carry on as above.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="DNS"
></A
>Chapter 13. Setting up Name to Address Resolution (DNS)</H1
><P
>Whilst we humans like to give names to things, computers really like
numbers. On a TCP/IP network (which is what the Internet is), we call
machines by a particular name - and every machine lives in a
particular domain. For example, my Linux workstation is called 
<EM
>archenland</EM
> and it resides in the <EM
>interweft.com.au</EM
> 
domain. Its human readable address is thus archenland.interweft.com.au (which is known as 
the FQDN - fully qualified domain name).</P
><P
>However, for this machine to be found by other computers on the
Internet, it is actually known by its IP number when computers are
communicating across the Internet.</P
><P
>Translating (resolving) machine (and domain) names into the numbers
actually used on the Internet is the business of machines that offer the
Domain Name Service.</P
><P
>What happens is this:-</P
><P
>&#13;<P
></P
><UL
><LI
><P
> your machine needs to know the
IP address of a particular computer. The application requiring this
information asks the 'resolver' on your Linux PC to provide this
information;&#13;</P
></LI
><LI
><P
>the resolver queries the local host file (<TT
CLASS="LITERAL"
>/etc/hosts</TT
>
and/or the domain name servers it knows about (the exact behaviour of
the resolver is determined by <TT
CLASS="LITERAL"
>/etc/host.conf</TT
>);&#13;</P
></LI
><LI
><P
>if the answer is found in the host file, this answer is returned;&#13;</P
></LI
><LI
><P
>if a domain name server is specified, your PC queries this
machine;&#13;</P
></LI
><LI
><P
>if the DNS machine already knows the IP number for the required
name, it returns it. If it does not, it queries other name servers across
the Internet to find the information. The name server than passes this
information back to the requesting resolver - which gives the
information to the requesting application.</P
></LI
></UL
>&#13;</P
><P
>When you make a PPP connection, you need to tell your Linux machine
where it can get host name to IP number (address resolution) information
so that <EM
>you</EM
> can use the machine names but your <EM
>computer</EM
> can
translate these to the IP numbers it needs to do its work.</P
><P
>One way is to enter every host that you want to talk to into the
<TT
CLASS="LITERAL"
>/etc/hosts</TT
> file (which is in reality totally impossible if you are
connecting to the Internet); another is to use the machine IP numbers as
opposed to the names (an impossible memory task for all but the smallest
LANs).</P
><P
>The best way is to set up Linux so that it knows where to go to get this
name to number information - automatically. This service is provided by
the Domain Name Server (DNS) system. All that is necessary is to enter
the IP number(s) for the domain name servers into your /etc/resolv.conf file.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN877"
>13.1. The <TT
CLASS="LITERAL"
>/etc/resolv.conf</TT
> file</A
></H2
><P
>Your PPP server sysadmin/user support people should provide you with two
DNS IP numbers (only one is necessary - but two gives some
redundancy in the event of failure).</P
><P
>As previously mentioned, Linux cannot set its name server IP number
in the way that MS Windows 95 does. So you must <EM
>insist</EM
> (politely) that
your ISP provide you with this information!</P
><P
>Your <TT
CLASS="LITERAL"
>/etc/resolv.conf</TT
> should look something like :-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>domain your.isp.domain.name
nameserver 10.25.0.1
nameserver 10.25.1.2</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Edit this file (creating it if necessary) to represent the information
that your ISP has provided. It should have ownership and permissions as
follows :-</P
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>-rw-r--r--   1 root     root           73 Feb 19 01:46 /etc/resolv.conf</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>If you have already set up a <TT
CLASS="LITERAL"
>/etc/resolv.conf</TT
> because you are on a
LAN, simply add the IP numbers of the PPP DNS servers to your
existing file.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN892"
>13.2. The <TT
CLASS="LITERAL"
>/etc/host.conf</TT
> file</A
></H2
><P
>You should also check that your <TT
CLASS="LITERAL"
>/etc/host.conf</TT
> file is
correctly set up. This should look like

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>order hosts,bind
multi on</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>This tells the resolver to use information in the host file before it
sends queries to the DNS for resolution.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="ROOT"
></A
>Chapter 14. Using PPP and root privileges</H1
><P
>Because PPP needs to set up networking devices, change the kernel
routing table and so forth, it requires root privileges to do this.</P
><P
> If users other than root are to set up PPP connections, the pppd
program should be setuid root :-</P
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>-rwsr-xr-x   1 root     root        95225 Jul 11 00:27 /usr/sbin/pppd</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>If /usr/sbin/pppd is not set up this way, then <EM
>as root</EM
> issue
the command:-</P
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>chmod u+s /usr/sbin/pppd</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>What this does is make pppd run with root privileges <EM
>even</EM
> if the
binary is run by an ordinary user. This allows a normal user to run pppd
with the necessary privileges to set up the network interfaces and the
kernel routing table.</P
><P
>Programs that run 'set uid root' are potential security holes and you
should be extremely cautious about making programs 'suid root'. A number
of programs (including pppd) have been carefully written to minimise the
danger of running suid root, so you should be safe with this one, (but no
guarantees). </P
><P
>Depending on how you want your system to operate - specifically if you
want ANY user on your system to be able to initiate a PPP link, you should
make your ppp-on/off scripts world read/execute. (This is probably fine if
your PC is used ONLY by you).</P
><P
>However, if you do NOT want just anyone to be able to start up a PPP
connection (for example, your children have accounts on your Linux PC
and you do not want them hooking into the Internet without your
supervision), you will need to establish a PPP group (as root, edit
/etc/group) and :-

<P
></P
><UL
><LI
><P
>Make pppd suid root, owned by user root and group PPP, with the 'other'
permissions on this file empty. It should then look like:-

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>-rwsr-x---   1 root     PPP        95225 Jul 11 00:27 /usr/sbin/pppd</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></LI
><LI
><P
>Make the ppp-on/off scripts owned by user root and group PPP.&#13;</P
></LI
><LI
><P
>Make the ppp-on/off scripts read/executable by group PPP.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>  -rwxr-x---   1 root     PPP           587 Mar 14  1995 /usr/sbin/ppp-on
  -rwxr-x---   1 root     PPP           631 Mar 14  1995 /usr/sbin/ppp-off</PRE
></FONT
></TD
></TR
></TABLE
>
&#13;</P
></LI
><LI
><P
>Make the other access rights for ppp-on/off nill.&#13;</P
></LI
><LI
><P
>add the users who will be firing up PPP to the PPP group in /etc/group.</P
></LI
></UL
>&#13;</P
><P
>Even if you do this, ordinary users will STILL not be able to shut down
the link under software control! Running the <TT
CLASS="LITERAL"
>ppp-off</TT
> script
requires root privileges. However, any user can just turn off the modem
(or disconnect the telephone line from an internal modem).</P
><P
>An alternative (and better method) to this set up is to use the
<TT
CLASS="LITERAL"
>sudo</TT
> program. This offers superior security and will allow you to
set things up so that any (authorised) user can activate/deactivate the
link using the scripts. Using <TT
CLASS="LITERAL"
>sudo</TT
> will allow an authorised user to
activate/deactivate the PPP link cleanly and securely.</P
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="OPTIONS"
></A
>Chapter 15. Setting up the PPP connection files</H1
><P
>You now need to be logged in as <EM
>root</EM
> to create the directories and
edit the files needed to set up PPP, even if you want PPP to be
accessible to all users.</P
><P
>PPP uses a number of files to connect and set up a PPP connection. These
differ in name and location between PPP 2.1.2 and 2.2+.</P
><P
>For PPP 2.1.2 the files are:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>/usr/sbin/pppd		# the PPP binary
/usr/sbin/ppp-on	# the dialer/connection script
/usr/sbin/ppp-off	# the disconnection script
/etc/ppp/options	# the options pppd uses for all connections
/etc/ppp/options.ttyXX	# the options specific to a connection on this port</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>For PPP 2.2 the files are:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>/usr/sbin/pppd			# the PPP binary
/etc/ppp/scripts/ppp-on		# the dialer/connection script
/etc/ppp/scripts/ppp-on-dialer	# part 1 of the dialer script
/etc/ppp/scripts/ppp-off	# the actual chat script itself
/etc/ppp/options		# the options pppd uses for all connections
/etc/ppp/options.ttyXX		# the options specific to a connection on this port</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Red Hat Linux users should note that the standard Red Hat 4.X installation
places these scripts in <TT
CLASS="LITERAL"
>/usr/doc/ppp-2.2.0f-2/scripts</TT
>.</P
><P
>In your /etc directory there should be a ppp directory:-</P
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>drwxrwxr-x   2 root     root         1024 Oct  9 11:01 ppp</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>If it does not exist - create it with these ownerships and permissions.</P
><P
>If the directory already existed, it should contain a template options
file called <EM
>options.tpl</EM
>. This file is included below in case it
does not.</P
><P
>Print it out as it contains an explanation of nearly all the PPP options
(these are useful to read in conjunction with the pppd man pages).
Whilst you can use this file as the basis of your
<TT
CLASS="LITERAL"
>/etc/ppp/options</TT
> file, it is probably better to create your own
options file that does not include all the comments in the template - it
will be much shorter and easier to read/maintain.</P
><P
>If you have multiple serial lines/modems, (typically the case for PPP
servers), create a general <TT
CLASS="LITERAL"
>/etc/ppp/options</TT
> file containing the
options that are common for all the serial ports on which you are
supporting dial in/out  and set up individual option files for each serial
line on which you will be establishing a PPP connection with the
individual settings required for each port.</P
><P
>These port specific option files are named <TT
CLASS="LITERAL"
>options.ttyx1</TT
>,
<TT
CLASS="LITERAL"
>options.ttyx2</TT
> and so forth (where x is the appropriate letter for
your serial ports).</P
><P
>However, for a single PPP connection, you can happily use the
<TT
CLASS="LITERAL"
>/etc/ppp/options</TT
> file. Alternatively, you can put all the
options as arguments in the pppd command itself.</P
><P
>It is easier to maintain a setup that uses
<TT
CLASS="LITERAL"
>/etc/ppp/options.ttySx</TT
> files. If you use PPP to connect to a
number of different sites, you can create option files for each site in
<TT
CLASS="LITERAL"
>/etc/ppp/options.site</TT
> and then specify the option file as a
parameter to the PPP command as you connect (using the <TT
CLASS="LITERAL"
>file
option-file</TT
> pppd option to pppd on the command line).</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN964"
>15.1. The supplied options.tpl file</A
></H2
><P
>Some distributions of PPP seem to have lost the options.tpl file, so
here is the complete file. I suggest that you do NOT edit this file to
create your <TT
CLASS="LITERAL"
>/etc/ppp/options</TT
> file(s). Rather, copy this to a
new file and then edit that. If you mess up your edits, you can then go
back to the original and start again.</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
># /etc/ppp/options -*- sh -*- general options for pppd
# created 13-Jul-1995 jmk
# autodate: 01-Aug-1995
# autotime: 19:45

# Use the executable or shell command specified to set up the serial
# line.  This script would typically use the "chat" program to dial the
# modem and start the remote ppp session.
#connect "echo You need to install a connect command."

# Run the executable or shell command specified after pppd has
# terminated the link.  This script could, for example, issue commands
# to the modem to cause it to hang up if hardware modem control signals
# were not available.
#disconnect "chat -- \d+++\d\c OK ath0 OK"

# async character map -- 32-bit hex; each bit is a character
# that needs to be escaped for pppd to receive it.  0x00000001
# represents '\x01', and 0x80000000 represents '\x1f'.
#asyncmap 0

# Require the peer to authenticate itself before allowing network
# packets to be sent or received.
#auth

# Use hardware flow control (i.e. RTS/CTS) to control the flow of data
# on the serial port.
#crtscts

# Use software flow control (i.e. XON/XOFF) to control the flow of data
# on the serial port.
#xonxoff

# Add a default route to the system routing tables, using the peer as
# the gateway, when IPCP negotiation is successfully completed.  This
# entry is removed when the PPP connection is broken.
#defaultroute

# Specifies that certain characters should be escaped on transmission
# (regardless of whether the peer requests them to be escaped with its
# async control character map).  The characters to be escaped are
# specified as a list of hex numbers separated by commas.  Note that
# almost any character can be specified for the escape option, unlike
# the asyncmap option which only allows control characters to be
# specified.  The characters which may not be escaped are those with hex
# values 0x20 - 0x3f or 0x5e.
#escape 11,13,ff

# Don't use the modem control lines.
#local

# Specifies that pppd should use a UUCP-style lock on the serial device
# to ensure exclusive access to the device.
#lock

# Use the modem control lines.  On Ultrix, this option implies hardware
# flow control, as for the crtscts option.  (This option is not fully
# implemented.)
#modem

# Set the MRU [Maximum Receive Unit] value to &#60;n&#62; for negotiation.  pppd
# will ask the peer to send packets of no more than &#60;n&#62; bytes. The
# minimum MRU value is 128.  The default MRU value is 1500.  A value of
# 296 is recommended for slow links (40 bytes for TCP/IP header + 256
# bytes of data).
#mru 542

# Set the interface netmask to &#60;n&#62;, a 32 bit netmask in "decimal dot"
# notation (e.g. 255.255.255.0).
#netmask 255.255.255.0

# Disables the default behaviour when no local IP address is specified,
# which is to determine (if possible) the local IP address from the
# hostname. With this option, the peer will have to supply the local IP
# address during IPCP negotiation (unless it specified explicitly on the
# command line or in an options file).
#noipdefault

# Enables the "passive" option in the LCP.  With this option, pppd will
# attempt to initiate a connection; if no reply is received from the
# peer, pppd will then just wait passively for a valid LCP packet from
# the peer (instead of exiting, as it does without this option).
#passive

# With this option, pppd will not transmit LCP packets to initiate a
# connection until a valid LCP packet is received from the peer (as for
# the "passive" option with old versions of pppd).
#silent

# Don't request or allow negotiation of any options for LCP and IPCP
# (use default values).
#-all

# Disable Address/Control compression negotiation (use default, i.e.
# address/control field disabled).
#-ac

# Disable asyncmap negotiation (use the default asyncmap, i.e. escape
# all control characters).
#-am

# Don't fork to become a background process (otherwise pppd will do so
# if a serial device is specified).
#-detach

# Disable IP address negotiation (with this option, the remote IP
# address must be specified with an option on the command line or in an
# options file).
#-ip

# Disable magic number negotiation.  With this option, pppd cannot
# detect a looped-back line.
#-mn

# Disable MRU [Maximum Receive Unit] negotiation (use default, i.e.
# 1500).
#-mru

# Disable protocol field compression negotiation (use default, i.e.
# protocol field compression disabled).
#-pc

# Require the peer to authenticate itself using PAP.
# This requires TWO WAY authentication - do NOT use this for a standard
# PAP authenticated link to an ISP as this will require the ISP machine
# to authenticate itself to your machine (and it will not be able to).
#+pap

# Don't agree to authenticate using PAP.
#-pap

# Require the peer to authenticate itself using CHAP [Cryptographic
# Handshake Authentication Protocol] authentication.
# This requires TWO WAY authentication - do NOT use this for a standard
# CHAP authenticated link to an ISP as this will require the ISP machine
# to authenticate itself to your machine (and it will not be able to).
#+chap

# Don't agree to authenticate using CHAP.
#-chap

# Disable negotiation of Van Jacobson style IP header compression (use
# default, i.e. no compression).
#-vj

# Increase debugging level (same as -d).  If this option is given, pppd
# will log the contents of all control packets sent or received in a
# readable form.  The packets are logged through syslog with facility
# daemon and level debug. This information can be directed to a file by
# setting up /etc/syslog.conf appropriately (see syslog.conf(5)).  (If
# pppd is compiled with extra debugging enabled, it will log messages
# using facility local2 instead of daemon).
#debug

# Append the domain name &#60;d&#62; to the local host name for authentication
# purposes.  For example, if gethostname() returns the name porsche,
# but the fully qualified domain name is porsche.Quotron.COM, you would
# use the domain option to set the domain name to Quotron.COM.
#domain &#60;d&#62;

# Enable debugging code in the kernel-level PPP driver.  The argument n
# is a number which is the sum of the following values: 1 to enable
# general debug messages, 2 to request that the contents of received
# packets be printed, and 4 to request that the contents of transmitted
# packets be printed.
#kdebug n

# Set the MTU [Maximum Transmit Unit] value to &#60;n&#62;. Unless the peer
# requests a smaller value via MRU negotiation, pppd will request that
# the kernel networking code send data packets of no more than n bytes
# through the PPP network interface.
#mtu &#60;n&#62;

# Set the name of the local system for authentication purposes to &#60;n&#62;.
# This will probably have to be set to your ISP user name if you are
# using PAP/CHAP.
#name &#60;n&#62;

# Set the user name to use for authenticating this machine with the peer
# using PAP to &#60;u&#62;.
# Do NOT use this if you are using 'name' above!
#user &#60;u&#62;

# Enforce the use of the host name as the name of the local system for
# authentication purposes (overrides the name option).
#usehostname

# Set the assumed name of the remote system for authentication purposes
# to &#60;n&#62;.
#remotename &#60;n&#62;

# Add an entry to this system's ARP [Address Resolution Protocol]
# table with the IP address of the peer and the Ethernet address of this
# system.
#proxyarp

# Use the system password database for authenticating the peer using
# PAP.
#login

# If this option is given, pppd will send an LCP echo-request frame to
# the peer every n seconds. Under Linux, the echo-request is sent when
# no packets have been received from the peer for n seconds. Normally
# the peer should respond to the echo-request by sending an echo-reply.
# This option can be used with the lcp-echo-failure option to detect
# that the peer is no longer connected.
#lcp-echo-interval &#60;n&#62;

# If this option is given, pppd will presume the peer to be dead if n
# LCP echo-requests are sent without receiving a valid LCP echo-reply.
# If this happens, pppd will terminate the connection.  Use of this
# option requires a non-zero value for the lcp-echo-interval parameter.
# This option can be used to enable pppd to terminate after the physical
# connection has been broken (e.g., the modem has hung up) in
# situations where no hardware modem control lines are available.
#lcp-echo-failure &#60;n&#62;

# Set the LCP restart interval (retransmission timeout) to &#60;n&#62; seconds
# (default 3).
#lcp-restart &#60;n&#62;

# Set the maximum number of LCP terminate-request transmissions to &#60;n&#62;
# (default 3).
#lcp-max-terminate &#60;n&#62;

# Set the maximum number of LCP configure-request transmissions to &#60;n&#62;
# (default 10).
# Some PPP servers are slow to start up. You may need to increase this
# if you keep getting 'serial line looped back' errors and your are SURE
# that you have logged in correctly and PPP should be starting on the server.
#lcp-max-configure &#60;n&#62;

# Set the maximum number of LCP configure-NAKs returned before starting
# to send configure-Rejects instead to &#60;n&#62; (default 10).
#lcp-max-failure &#60;n&#62;

# Set the IPCP restart interval (retransmission timeout) to &#60;n&#62;
# seconds (default 3).
#ipcp-restart &#60;n&#62;

# Set the maximum number of IPCP terminate-request transmissions to &#60;n&#62;
# (default 3).
#ipcp-max-terminate &#60;n&#62;

# Set the maximum number of IPCP configure-request transmissions to &#60;n&#62;
# (default 10).
#ipcp-max-configure &#60;n&#62;

# Set the maximum number of IPCP configure-NAKs returned before starting
# to send configure-Rejects instead to &#60;n&#62; (default 10).
#ipcp-max-failure &#60;n&#62;

# Set the PAP restart interval (retransmission timeout) to &#60;n&#62; seconds
# (default 3).
#pap-restart &#60;n&#62;

# Set the maximum number of PAP authenticate-request transmissions to
# &#60;n&#62; (default 10).
#pap-max-authreq &#60;n&#62;

# Set the CHAP restart interval (retransmission timeout for
# challenges) to &#60;n&#62; seconds (default 3).
#chap-restart &#60;n&#62;

# Set the maximum number of CHAP challenge transmissions to &#60;n&#62;
# (default 10).
#chap-max-challenge

# If this option is given, pppd will re-challenge the peer every &#60;n&#62;
# seconds.
#chap-interval &#60;n&#62;

# With this option, pppd will accept the peer's idea of our local IP
# address, even if the local IP address was specified in an option.
#ipcp-accept-local

# With this option, pppd will accept the peer's idea of its (remote) IP
# address, even if the remote IP address was specified in an option.
#ipcp-accept-remote</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN970"
>15.2. What options should I use? (No PAP/CHAP)</A
></H2
><P
>Well, as in all things, that depends, (sigh). The options specified here
should work with most servers.</P
><P
>However, if it does NOT work, READ THE TEMPLATE FILE
(<TT
CLASS="LITERAL"
>/etc/ppp/options.tpl</TT
>) <EM
>and</EM
> the pppd man pages <EM
>and</EM
>
speak to the sysadmin/user support people who run the server to which
you are connecting.</P
><P
>You should also note that the connect scripts presented here also use
some command line options to pppd to make things a bit easier to change.</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
># /etc/ppp/options (NO PAP/CHAP)
#
# Prevent pppd from forking into the background
-detach
#
# use the modem control lines
modem
# use uucp style locks to ensure exclusive access to the serial device
lock
# use hardware flow control
crtscts
# create a default route for this connection in the routing table
defaultroute
# do NOT set up any "escaped" control sequences
asyncmap 0
# use a maximum transmission packet size of 552 bytes
mtu 552
# use a maximum receive packet size of 552 bytes
mru 552
#
#-------END OF SAMPLE /etc/ppp/options (no PAP/CHAP)</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN980"
>15.3. Other options to consider adding</A
></H2
><P
>There are a couple useful things you might want to add to the /etc/ppp/options
file.</P
><P
>One is an idle time. Pppd can terminate the connection if it has been idle for
too long. This could be nice if your isp charges by time, or if you don't
want to keep your phone line tied up. To use this feature, simply add the
line:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
># Idle after X seconds
idle X</PRE
></FONT
></TD
></TR
></TABLE
><P
>Replace 'X' with the number of seconds you wish the connection to terminate
after.</P
><P
>The next feature is "dial on demand". This means that every time
you attempt to open an interent connection, pppd will try to open
a PPP connection to your ISP.
In order to do this, add the following lines to /etc/ppp/options</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
># dial on demand
demand</PRE
></FONT
></TD
></TR
></TABLE
><P
>This should make pppd dial out when necessary.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="PAP"
></A
>Chapter 16. If your PPP server uses PAP (Password Authentication
Protocol)</H1
><P
>If the server to which you are connecting requires PAP or CHAP
authentication, you have a little bit more work.</P
><P
>To the above options file, add the following lines

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>#
# force pppd to use your ISP user name as your 'host name' during the
# authentication process
name &#60;your ISP user name&#62;	# you need to edit this line
#
# If you are running a PPP *server* and need to force PAP or CHAP
# uncomment the appropriate one of the following lines. Do NOT use 
# these is you are a client connecting to a PPP server (even if it uses PAP
# or CHAP) as this tells the SERVER to authenticate itself to your
# machine (which almost certainly can't do - and the link will fail).
#+chap
#+pap
#
# If you are using ENCRYPTED secrets in the /etc/ppp/pap-secrets
# file, then uncomment the following line.
# Note: this is NOT the same as using MS encrypted passwords as can be
# set up in MS RAS on Windows NT.
#+papcrypt</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN994"
>16.1. Using MSCHAP</A
></H2
><P
>Microsoft Windows NT RAS can be set up to use a variation on CHAP
(Challenge/Handshake Authentication Protocol). In your PPP sources tar
ball, you will find a file called README.MSCHAP80 that discusses this.</P
><P
>You can determine if the server is requesting authentication using this
protocol by enabling debugging for pppd. If the server is requesting MS
CHAP authentication, you will see lines like:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>rcvd [LCP ConfReq id=0x2 &#60;asyncmap 0x0&#62; &#60;auth chap 80&#62; &#60;magic 0x46a3&#62;]</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>The critical information here is <EM
>auth chap 80</EM
>.</P
><P
>In order to use MS CHAP, you will need to recompile pppd to support
this. Please see the instructions in the README.MSCHAP80 file in the PPP
source file for instructions on how to compile and use this variation.</P
><P
>You should note that at present this code supports only Linux PPP
clients connecting to an MS Windows NT server. It does <EM
>NOT</EM
> support
setting up a Linux PPP server to use MSCHAP80 authentication from clients.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1005"
>16.2. The PAP/CHAP secrets file</A
></H2
><P
>If you are using pap or chap authentication, then you also need to
create the secrets file. These are:

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>/etc/ppp/pap-secrets
/etc/ppp/chap-secrets</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>They must be owned by user root, group root and have file permissions
740 for security.</P
><P
>The first point to note about PAP and CHAP is that they are designed to
authenticate <EM
>computer systems</EM
> not <EM
>users</EM
>.</P
><P
>Huh? What's the difference? I hear you ask.</P
><P
>Well now, once your computer has made its PPP connection to the server,
<EM
>ANY</EM
> user on your system can use that connection - not just you.
This is why you can set up a WAN (wide area network) link that joins two
LANs (local area networks) using PPP.</P
><P
>PAP can (and for CHAP <EM
>DOES</EM
>) require <EM
>bidirectional</EM
>
authentication - that is a valid name and secret is required on each
computer for the other computer involved. However, this is <EM
>NOT</EM
> the
way most PPP servers offering dial-up PPP PAP-authenticated connections
operate. </P
><P
>That being said, your ISP will probably have given you a user name and
password to allow you to connect to their system and thence the
Internet. Your ISP is not interested in your computer's name at all, so
you will probably need to use the user name at your ISP as the name for
your computer.</P
><P
>This is done using the <TT
CLASS="LITERAL"
>name user name</TT
> option to pppd. So, if you are
to use the user name given you by your ISP, add the line

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>name your_user name_at_your_ISP</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>to your <TT
CLASS="LITERAL"
>/etc/ppp/options</TT
> file.</P
><P
>Technically, you should really use <TT
CLASS="LITERAL"
>user our_user name_at_your_ISP</TT
>
for PAP, but pppd is sufficiently intelligent to interpret <TT
CLASS="LITERAL"
>name</TT
> as
<TT
CLASS="LITERAL"
>user</TT
> if it is required to use PAP. The advantage of using the <TT
CLASS="LITERAL"
>name</TT
>
option is that this is also valid for CHAP.</P
><P
>As PAP is for authenticating <EM
>computers</EM
>, technically you need
also to specify a remote computer name. However, as most people only
have one ISP, you can use a wild card (*) for the remote host name in
the secrets file.</P
><P
>It is also worth noting that many ISPs operate multiple modem banks
connected to different terminal servers - each with a different name,
but ACCESSED from a single (rotary) dial in number. It can therefore be
quite difficult in some circumstances to know ahead of time what the
name of the remote computer is, as this depends on which terminal server
you connect to!</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1034"
>16.3. The PAP secrets file</A
></H2
><P
>The <TT
CLASS="LITERAL"
>/etc/ppp/pap-secrets</TT
> file looks like

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
># Secrets for authentication using PAP
# client        server       secret     acceptable_local_IP_addresses</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>The four fields are white space delimited and the last one can be blank (which is
what you want for a dynamic and probably static IP allocation from your ISP).</P
><P
>Suppose your ISP gave you a user name of <TT
CLASS="LITERAL"
>fred</TT
> and a password of
<TT
CLASS="LITERAL"
>flintstone</TT
> you would set the <TT
CLASS="LITERAL"
>name fred</TT
> option in
<TT
CLASS="LITERAL"
>/etc/ppp/options[.ttySx]</TT
> and set up your
<TT
CLASS="LITERAL"
>/etc/ppp/pap-secrets</TT
> file as follows</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
># Secrets for authentication using PAP
# client        server  secret		acceptable local IP addresses
fred		*	flintstone</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>This says for the local machine name <TT
CLASS="LITERAL"
>fred</TT
> (which we have told pppd
to use even though it is not our local machine name) and for <EM
>ANY</EM
>
server, use the password (secret) of <TT
CLASS="LITERAL"
>flintstone</TT
>.</P
><P
>Note that we do not need to specify a local IP address, unless we are
required to FORCE a particular local, static IP address. Even if you try
this, it is unlikely to work as most PPP servers (for security reasons)
do not allow the remote system to set the IP number they are to be given.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1053"
>16.4. The CHAP secrets file</A
></H2
><P
>This requires that you have mutual authentication
methods - that is you must allow for both your machine to authenticate
the remote server <EM
>AND</EM
> the remote server to authenticate your
machine.</P
><P
>So, if your machine is <TT
CLASS="LITERAL"
>fred</TT
> and the remote is <TT
CLASS="LITERAL"
>barney</TT
>, your
machine would set <TT
CLASS="LITERAL"
>name fred remotename barney</TT
> and the remote
machine would set <TT
CLASS="LITERAL"
>name barney remotename fred</TT
> in their respective
<TT
CLASS="LITERAL"
>/etc/ppp/options.ttySx</TT
> files.</P
><P
>The <TT
CLASS="LITERAL"
>/etc/chap-secrets</TT
> file for fred would look like

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
># Secrets for authentication using CHAP
# client        server  secret            acceptable local IP addresses
fred		barney	flintstone
barney		fred	wilma</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>and for barney</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
># Secrets for authentication using CHAP
# client        server  secret            acceptable local IP addresses
barney          fred    flintstone
fred		barney	wilma</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Note in particular that both machines must have entries for
bidirectional authentication. This allows the local machine to
authenticate itself to the remote <EM
>AND</EM
> the remote machine to
authenticate itself to the local machine.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1071"
>16.5. Handling multiple PAP-authenticated connections</A
></H2
><P
>Some users have more than one server to which they connect that use PAP.
Provided that your user name is different on each machine to which you
want to connect, this is not a problem.</P
><P
>However, many users have the same user name on two (or more - even all)
systems to which they connect. This then presents a problem in correctly
selecting the appropriate line from <TT
CLASS="LITERAL"
>/etc/ppp/pap-secrets</TT
>.</P
><P
>As you might expect, PPP provides a mechanism for overcoming this. PPP
allows you to set an 'assumed name' for the remote (server) end of the
connection using the <EM
>remotename</EM
> option to pppd.</P
><P
>Let us suppose that you connect to two PPP servers using the username
fred. You set up your <TT
CLASS="LITERAL"
>/etc/ppp/pap-secrets</TT
> something like</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>fred	pppserver1	barney
fred	pppserver2	wilma</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Now, to set connect to pppserver1 you would use <TT
CLASS="LITERAL"
>name fred remotename
pppserver1</TT
> in your ppp-options and for pppserver2 <TT
CLASS="LITERAL"
>name fred
remotename pppserver2</TT
>.</P
><P
>As you can select the ppp options file to use with pppd using the
<TT
CLASS="LITERAL"
>file filename</TT
> option, you can set up a script to connect to each of
your PPP servers, correctly picking the options file to use and hence
selecting the right <TT
CLASS="LITERAL"
>remotename</TT
> option.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="MANUAL"
></A
>Chapter 17. Setting up the PPP connection manually</H1
><P
>Now that you have created your <TT
CLASS="LITERAL"
>/etc/ppp/options</TT
> and
<TT
CLASS="LITERAL"
>/etc/resolv.conf</TT
> files (and, if necessary, the
<TT
CLASS="LITERAL"
>/etc/ppp/pap|chap-secrets</TT
> file), you can test the settings by
manually establishing a PPP connection. (Once we have the manual
connection working, we will automate the process).</P
><P
>To do this, your communications software must be capable of quitting
WITHOUT resetting the modem. Minicom can do this - ALT Q (or in older
version of minicom CTRL A Q)</P
><P
>Make sure you are logged in as root.</P
><P
>Fire up you communications software, (such as minicom), dial into the PPP
server and log in as normal. If you need to issue a command to start up
PPP on the server, do so. You will now see the garbage you saw before.</P
><P
>If you are using pap or chap, then merely connecting to the remote system
should start ppp on the remote and you will see the garbage without
logging in, (although this may not happen for some servers - try pressing
<EM
>Enter</EM
> and see if the garbage starts up).</P
><P
>Now quit the communications software <EM
>without resetting the modem</EM
> (ALT Q
or CTL A Q in minicom) and at the Linux prompt (as root) type...</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>pppd -d -detach /dev/ttySx 38400 &#38;</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>The -d option turns on debugging - the ppp connection start up
conversation will be logged to your system log - which is useful if
you are having trouble.</P
><P
>Your modem lights should now flash as the PPP connection is established.
It will take a short while for the PPP connection to be made.</P
><P
>At this point you can look at the PPP interface, by issuing the command:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>ifconfig</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>In addition to any Ethernet and loop back devices you have, you
should see something like :-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>ppp0     Link encap:Point-Point Protocol
         inet addr:10.144.153.104  P-t-P:10.144.153.51 Mask:255.255.255.0
         UP POINTOPOINT RUNNING  MTU:552  Metric:1
         RX packets:0 errors:0 dropped:0 overruns:0
         TX packets:0 errors:0 dropped:0 overruns:0</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Where

<P
></P
><UL
><LI
><P
>inet addr:10.144.153.10 is the IP number of your end of the link.</P
></LI
><LI
><P
>P-t-P:10.144.153.5 is the SERVER's IP number.</P
></LI
></UL
>&#13;</P
><P
>(Naturally, ifconfig will not report these IP numbers, but the ones used
by your PPP server.)</P
><P
>Note: ifconfig also tells you that the link is UP and RUNNING!</P
><P
>If you get no ppp device listed or something like:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>ppp0     Link encap:Point-Point Protocol
         inet addr:0.0.0.0  P-t-P:0.0.0.0  Mask:0.0.0.0
         POINTOPOINT  MTU:1500  Metric:1
         RX packets:0 errors:0 dropped:0 overruns:0
         TX packets:0 errors:0 dropped:0 overruns:0</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Your PPP connection has not been made...see the later section on
debugging!</P
><P
>You should also be able to see a route to the remote host (and
beyond). To do this, issue the command</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>route -n</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>You should se something like:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>Kernel routing table
Destination     Gateway         Genmask         Flags MSS    Window Use Iface
10.144.153.3    *               255.255.255.255 UH    1500   0        1 ppp0
127.0.0.0       *               255.0.0.0       U     3584   0       11 lo
10.0.0.0        *               255.0.0.0       U     1500   0       35 eth0
default         10.144.153.3    *               UG    1500   0        5 ppp0</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Of particular importance here, notice we have TWO entries pointing to our
ppp interface.</P
><P
>The first is a HOST route, (indicated by the H flag) and
that allows us to see the host to which we are connected to - but no
further.</P
><P
>The second is the default route, (established by giving pppd the option
<TT
CLASS="LITERAL"
>defaultroute</TT
>. This is the route that tells our
Linux PC to send any packets NOT destined for the local Ethernet(s) - to
which we have specific network routes - to the PPP server itself. The
PPP server then is responsible for routing our packets out onto the
Internet and routing the return packets back to us.</P
><P
>If you do not see a routing table with two entries, something is wrong.
In particular if your syslog shows a message telling you pppd is not
replacing an existing default route, then you have a default route
pointing at your Ethernet interface - which <EM
>MUST</EM
> be replaced by a
specific network route: <EM
>YOU CAN ONLY HAVE ONE DEFAULT ROUTE!!!</EM
></P
><P
>You will need to explore your system initialization files to find out
where this default route is being set up (it will use a <TT
CLASS="LITERAL"
>route add
default...</TT
> command). Change this command to something like <TT
CLASS="LITERAL"
>route
add net...</TT
>.</P
><P
>Now test the link by 'pinging' the server at its IP number as reported
by the ifconfig output, i.e.</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>ping 10.144.153.51</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>You should receive output like</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>PING 10.144.153.51 (10.144.153.51): 56 data bytes
64 bytes from 10.144.153.51: icmp_seq=0 ttl=255 time=328.3 ms
64 bytes from 10.144.153.51: icmp_seq=1 ttl=255 time=190.5 ms
64 bytes from 10.144.153.51: icmp_seq=2 ttl=255 time=187.5 ms
64 bytes from 10.144.153.51: icmp_seq=3 ttl=255 time=170.7 ms</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>This listing will go on for ever - to stop it press CTRL C, at which
point you will receive some more information :-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>--- 10.144.153.51 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max = 170.7/219.2/328.3 ms</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>So far so good.</P
><P
>Now try pinging a host by name (not the name of the PPP server itself)
but a host at another site that you KNOW is probably going to be up and
running...). For example</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>ping sunsite.unc.edu</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>This time there will be a bit of a pause as Linux obtains the IP number
for the fully qualified host name you have 'ping'ed from the DNS you
specified in <TT
CLASS="LITERAL"
>/etc/resolv.conf</TT
> - so don't worry (but you will
see your modem lights flash). Shortly you will receive output like</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
> PING sunsite.unc.edu (152.2.254.81): 56 data bytes
64 bytes from 152.2.254.81: icmp_seq=0 ttl=254 time=190.1 ms
64 bytes from 152.2.254.81: icmp_seq=1 ttl=254 time=180.6 ms
64 bytes from 152.2.254.81: icmp_seq=2 ttl=254 time=169.8 ms
64 bytes from 152.2.254.81: icmp_seq=3 ttl=254 time=170.6 ms
64 bytes from 152.2.254.81: icmp_seq=4 ttl=254 time=170.6 ms</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Again, stop the output by pressing CTRL C and get the statistics...</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>--- sunsite.unc.edu ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max = 169.8/176.3/190.1 ms</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>If you don't get any response, try pinging the IP address of the DNS
server at your ISP's site. If you get a result from this, then it looks
like you have a problem with <TT
CLASS="LITERAL"
>/etc/resolv.conf</TT
>.</P
><P
>If this doesn't work, you have a routing problem, or your ISP has a
problem routing packets back to you. Check your routing table as shown
above and if that is OK, contact your ISP. A good test of the ISP is to
use another operating system to connect. If you can get beyond your ISP
with that, then the problem is at your end.</P
><P
>If everything works, shut down the connection by typing:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>ppp-off</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>After a short pause, the modem should hang itself up.</P
><P
>If that does not work, either turn off your modem or fire up your
communications software and interrupt the modem with +++ and then hang
up with ATH0 when you receive the modem's OK prompt.</P
><P
>You may also need to clean up the lock file created by pppd.

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>rm -f /var/lock/LCK..ttySx</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="AUTOMATE"
></A
>Chapter 18. Automating your connections - Creating the connection scripts</H1
><P
>Whilst you can continue to log in by hand as shown above, it is much
neater to set up some scripts to do this automatically for you.</P
><P
>A set of scripts automates the log in and PPP start up so all you have to
do (as root or as a member of the PPP group) is issue a single command
to fire up your connection.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1173"
>18.1. Connection scripts for User name/Password Authentication</A
></H2
><P
>If your ISP does NOT require the use of PAP/CHAP, these are the scripts
for you!</P
><P
>If the ppp package installed correctly, you should have two example files.
For PPP 2.1.2 they are in <TT
CLASS="LITERAL"
>/usr/sbin</TT
> and for PPP 2.2 they are in
<TT
CLASS="LITERAL"
>/etc/ppp/scripts</TT
>. They are called</P
><P
>for PPP-2.1.2</P
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ppp-on
ppp-off</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>and for PPP-2.2</P
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ppp-off
ppp-on
ppp-on-dialer</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Now, if you are using PPP 2.1.2, I strongly urge you to delete the
sample files. There are potential problems with these - and don't tell
me they work fine - I used them for ages too (and recommended them in
the first version of this HOWTO)!</P
><P
>For the benefit of PPP 2.1.2 users, here are BETTER template versions,
taken from the PPP 2.2 distribution. I suggest you copy and use these
scripts <EM
>instead of</EM
> the old PPP-2.1.2 scripts. </P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1188"
>18.2. The ppp-on script</A
></H2
><P
>This is the first of a PAIR of scripts that actually fire up the
connection.</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>#!/bin/sh
#
# Script to initiate a PPP connection. This is the first part of the
# pair of scripts. This is not a secure pair of scripts as the codes
# are visible with the 'ps' command.  However, it is simple.
#
# These are the parameters. Change as needed.
TELEPHONE=555-1212      # The telephone number for the connection
ACCOUNT=george          # The account name for logon (as in 'George Burns')
PASSWORD=gracie         # The password for this account (and 'Gracie Allen')
LOCAL_IP=0.0.0.0        # Local IP address if known. Dynamic = 0.0.0.0
REMOTE_IP=0.0.0.0       # Remote IP address if desired. Normally 0.0.0.0
NETMASK=255.255.255.0   # The proper netmask if needed
#
# Export them so that they will be available to 'ppp-on-dialer'
export TELEPHONE ACCOUNT PASSWORD
#
# This is the location of the script which dials the phone and logs
# in.  Please use the absolute file name as the $PATH variable is not
# used on the connect option.  (To do so on a 'root' account would be
# a security hole so don't ask.)
#
DIALER_SCRIPT=/etc/ppp/ppp-on-dialer
#
# Initiate the connection
#
#
exec /usr/sbin/pppd debug /dev/ttySx 38400 \
        $LOCAL_IP:$REMOTE_IP \
        connect $DIALER_SCRIPT</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Here is the ppp-on-dialer script:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>#!/bin/sh
#
# This is part 2 of the ppp-on script. It will perform the connection
# protocol for the desired connection.
#
/usr/sbin/chat -v                                                 \
        TIMEOUT         3                               \
        ABORT           '\nBUSY\r'                      \
        ABORT           '\nNO ANSWER\r'                 \
        ABORT           '\nRINGING\r\n\r\nRINGING\r'    \
        ''              \rAT                            \
        'OK-+++\c-OK'   ATH0                            \
        TIMEOUT         30                              \
        OK              ATDT$TELEPHONE                  \
        CONNECT         ''                              \
        ogin:--ogin:    $ACCOUNT                        \
        assword:        $PASSWORD</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>For PPP-2.2, the <TT
CLASS="LITERAL"
>ppp-off</TT
> script looks like:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>#!/bin/sh
######################################################################
#
# Determine the device to be terminated.
#
if [ "$1" = "" ]; then
        DEVICE=ppp0
else
        DEVICE=$1
fi

######################################################################
#
# If the ppp0 pid file is present then the program is running. Stop it.
if [ -r /var/run/$DEVICE.pid ]; then
        kill -INT `cat /var/run/$DEVICE.pid`
#
# If the kill did not work then there is no process running for this
# pid. It may also mean that the lock file will be left. You may wish
# to delete the lock file at the same time.
        if [ ! "$?" = "0" ]; then
                rm -f /var/run/$DEVICE.pid
                echo "ERROR: Removed stale pid file"
                exit 1
        fi
#
# Success. Let pppd clean up its own junk.
        echo "PPP link to $DEVICE terminated."
        exit 0
fi
#
# The ppp process is not running for ppp0
echo "ERROR: PPP link is not active on $DEVICE"
exit 1</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1200"
>18.3. Editing the supplied PPP startup scripts</A
></H2
><P
>As the new scripts come in two parts, we will edit them in turn.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN1203"
>18.3.1. The ppp-on script</A
></H3
><P
>You will need to edit the script to reflect YOUR user name at your ISP,
YOUR password at your ISP, and the telephone number of your ISP.</P
><P
>Each of the lines like "<TT
CLASS="LITERAL"
>TELEPHONE=</TT
>" actually set up shell variables that
contain the information to the right of the '=' (excluding the comments
of course). So edit each of these lines so it is correct for your ISP
and connection.</P
><P
>Also, as you are setting the IP number (if you need to) in the
<TT
CLASS="LITERAL"
>/etc/ppp/options</TT
> file, DELETE the line that says</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>$LOCAL_IP:$REMOTE_IP \</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Also, make sure that the shell variable DIALER_SCRIPT points at
the full path and name of the dialer script that you are actually going
to use. So, if you have moved this or renamed the script,
make sure you edit this line correctly in the <TT
CLASS="LITERAL"
>ppp-on</TT
> script!</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN1214"
>18.3.2. The ppp-on-dialer script</A
></H3
><P
>This is the second of the scripts that actually brings
up our ppp link.</P
><P
>Note: a chat script is normally all on one line. the backslashes are
used to allow line continuations across several physical lines (for
human readability) and do not form part of the script itself.</P
><P
>However, it is very useful to look at it in detail so
that we understand what it is actually (supposed) to be doing!</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1219"
>18.4. What a Chat script means...</A
></H2
><P
>A chat script is a sequence of expect
string, send string pairs. In particular, note that we <EM
>ALWAYS</EM
> 
expect <EM
>something</EM
>
before we send something.</P
><P
>If we are to send something <EM
>WITHOUT</EM
> receiving anything first, we
must use an empty expect string (indicated by " ") and similarly for expecting something
without sending anything! Also, if a string consists of several words,
(e.g. NO CARRIER), you must quote the string so that it is seen as a
single entity by chat.</P
><P
>The chat line in our template is:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>exec /usr/sbin/chat -v</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Invoke chat, the -v tells chat to copy ALL its I/O into the system log
(usually /var/log/messages). Once you are happy that the chat script is
working reliably, edit this line to remove the -v to save unnecessary
clutter in your syslog.</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>TIMEOUT         3</PRE
></FONT
></TD
></TR
></TABLE
>

This sets the timeout for the receipt of expected input to three
seconds. You may need to increase this to say 5 or 10 seconds if you are
using a really slow modem!</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>ABORT           '\nBUSY\r'</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>If the string BUSY is received, abort the operation.</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>ABORT           '\nNO ANSWER\r'</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>If the string NO ANSWER is received, abort the operation</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>ABORT           '\nRINGING\r\n\r\nRINGING\r'</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>If the (repeated) string RINGING is received, abort the
operation. This is because someone is ringing your phone line!</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>\rAT</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Expect nothing from the modem and send the string AT.</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>OK-+++\c-OK   ATH0</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>This one is a bit more complicated as it uses some of chat's error
recovery capabilities.</P
><P
>What is says is...Expect OK, if it is NOT received (because the modem is
not in command mode) then send +++ (the standard Hayes-compatible modem
string that returns the modem to command mode) and expect OK. Then send
ATH0 (the modem hang up string). This allows your script to
cope with the situation of your modem being stuck on-line!</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>TIMEOUT         30</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Set the timeout to 30 seconds for the remainder of the script. If you
experience trouble with the chat script aborting due to timeouts,
increase this to 45 seconds or more.</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>OK              ATDT$TELEPHONE</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Expect OK (the modem's response to the ATH0 command) and dial the number
we want to call.</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>CONNECT         ''</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Expect CONNECT (which our modem sends when the remote modem answers) and
send nothing in reply.</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>ogin:--ogin:    $ACCOUNT</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Again, we have some error recovery built in here. Expect the login
prompt (...ogin:) but if we don't receive it by the timeout, send a
return and then look for the login prompt again. When the prompt is
received, send the username (stored in the shell variable $ACCOUNT).</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>assword:        $PASSWORD</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Expect the password prompt and send our password (again, stored in a
shell variable).</P
><P
>This chat script has reasonable error recovery capability. Chat has
considerably more features than demonstrated here. For more information
consult the chat manual page (<TT
CLASS="LITERAL"
>man 8 chat</TT
>).</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN1265"
>18.4.1. Starting PPP at the server end</A
></H3
><P
>Whilst the ppp-on-dialer script is fine for servers that automatically
start pppd at the server end once you have logged in, some servers
require that you explicitly start PPP on the server.</P
><P
>If you need to issue a command to start up PPP on the server, you DO need
to edit the ppp-on-dialer script.</P
><P
> At the END of the script (after the password line) add an additional
<EM
>expect send</EM
> pair - this one would look for your login prompt (beware
of characters that have a special meaning in the Bourne shell - such as
$ and [ or ] (open and close square brackets).</P
><P
>Once chat has found the shell prompt, chat must issue the ppp
start up command required for your ISPs PPP server.</P
><P
>In my case, my PPP server uses the standard Linux Bash prompt

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>[hartr@kepler hartr]$</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>and requires that I type</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>ppp</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>to start up PPP on the server.</P
><P
>It is a good idea to allow for a bit of error recovery here, so in my
case I use

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>	hartr--hartr	ppp</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>This says,  if we don't receive the prompt within the timeout, send a
carriage return and looks for the prompt again.</P
><P
>Once the prompt is received, then send the string <TT
CLASS="LITERAL"
>ppp</TT
>.</P
><P
>Note: don't forget to add a \ to the end of the previous line so chat
still thinks the entire chat script is on one line!</P
><P
>Unfortunately, some servers produce a very variable set of prompts! You
may need to log in several times using minicom to understand what is
going on and pick the stable "expect" strings.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1285"
>18.5. A chat script for PAP/CHAP authenticated connections</A
></H2
><P
>If your ISP is using PAP/CHAP, then your chat script is much simpler.
All your chat script needs to do is dial the telephone, wait for a
connect and then let pppd handle the logging in!</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>#!/bin/sh
#
# This is part 2 of the ppp-on script. It will perform the connection
# protocol for the desired connection.
#
exec /usr/sbin/chat -v                                  \
        TIMEOUT         3                               \
        ABORT           '\nBUSY\r'                      \
        ABORT           '\nNO ANSWER\r'                 \
        ABORT           '\nRINGING\r\n\r\nRINGING\r'    \
        ''              \rAT                            \
        'OK-+++\c-OK'   ATH0                            \
        TIMEOUT         30                              \
        OK              ATDT$TELEPHONE                  \
        CONNECT         ''                              \</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1290"
>18.6. The pppd <TT
CLASS="LITERAL"
>debug</TT
> and <TT
CLASS="LITERAL"
>file option_file</TT
> options</A
></H2
><P
>As we have already seen, you can turn on debug information logging
with the -d option to pppd. The 'debug' option is equivalent to this.</P
><P
>As we are establishing a new connection with a new script, leave in the
debug option for now. (Warning: if your disk space is tight, logging
pppd exchanges can rapidly extend your syslog file and run you into
trouble - but to do this you must fail to connect and keep on trying for
quite a few minutes).</P
><P
>Once you are happy that all is working properly, then you can remove
this option.</P
><P
>If you have called your ppp options file anything other than
<TT
CLASS="LITERAL"
>/etc/ppp/options</TT
> or <TT
CLASS="LITERAL"
>/etc/ppp/options.ttySx</TT
>, specify
the file name with the <TT
CLASS="LITERAL"
>file</TT
> option to pppd - e.g.</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>exec /usr/sbin/pppd debug file options.myserver /dev/ttyS0 38400 \</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="AEN1303"
></A
>Chapter 19. Testing your connection script</H1
><P
>Open a new root Xterm (if you are in X) or open a new virtual console
and log in as root.</P
><P
>In this new session, issue the command</P
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>tail -f /var/log/messages</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>(or whatever your system log file is).</P
><P
>In the first window (or virtual console) issue the command</P
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ppp-on &#38;</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>(or whatever name you have called your edited version of /usr/sbin/ppp-
on). If you do not put the script into the background by specifying &#38;
at the end of the command, you will not get your terminal prompt back
until ppp exits (when the link terminates).</P
><P
>Now switch back to the window that is tracking your system log.</P
><P
>You will see something like the following (provided you specified -v to
chat and -d to pppd)....this is the chat script and responses being
logged to the system log file followed by the start up information for
pppd :-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>Oct 21 16:09:58 hwin chat[19868]: abort on (NO CARRIER)
Oct 21 16:09:59 hwin chat[19868]: abort on (BUSY)
Oct 21 16:09:59 hwin chat[19868]: send (ATZ^M)
Oct 21 16:09:59 hwin chat[19868]: expect (OK)
Oct 21 16:10:00 hwin chat[19868]: ATZ^M^M
Oct 21 16:10:00 hwin chat[19868]: OK -- got it
Oct 21 16:10:00 hwin chat[19868]: send (ATDT722298^M)
Oct 21 16:10:00 hwin chat[19868]: expect (CONNECT)
Oct 21 16:10:00 hwin chat[19868]: ^M
Oct 21 16:10:22 hwin chat[19868]: ATDT722298^M^M
Oct 21 16:10:22 hwin chat[19868]: CONNECT -- got it
Oct 21 16:10:22 hwin chat[19868]: send (^M)
Oct 21 16:10:22 hwin chat[19868]: expect (ogin:)
Oct 21 16:10:23 hwin chat[19868]: kepler login: -- got it
Oct 21 16:10:23 hwin chat[19868]: send (hartr^M)
Oct 21 16:10:23 hwin chat[19868]: expect (ssword:)
Oct 21 16:10:23 hwin chat[19868]:  hartr^M
Oct 21 16:10:23 hwin chat[19868]: Password: -- got it
Oct 21 16:10:23 hwin chat[19868]: send (??????^M)
Oct 21 16:10:23 hwin chat[19868]: expect (hartr)
Oct 21 16:10:24 hwin chat[19868]: [hartr -- got it
Oct 21 16:10:24 hwin chat[19868]: send (ppp^M)
Oct 21 16:10:27 hwin pppd[19872]: pppd 2.1.2 started by root, uid 0
Oct 21 16:10:27 hwin pppd[19873]: Using interface ppp0
Oct 21 16:10:27 hwin pppd[19873]: Connect: ppp0 &#60;--&#62; /dev/cua1
Oct 21 16:10:27 hwin pppd[19873]: fsm_sdata(LCP): Sent code 1, id 1.
Oct 21 16:10:27 hwin pppd[19873]: LCP: sending Configure-Request, id 1
Oct 21 16:10:27 hwin pppd[19873]: fsm_rconfreq(LCP): Rcvd id 1.
Oct 21 16:10:27 hwin pppd[19873]: lcp_reqci: rcvd MRU
Oct 21 16:10:27 hwin pppd[19873]: (1500)
Oct 21 16:10:27 hwin pppd[19873]:  (ACK)
Oct 21 16:10:27 hwin pppd[19873]: lcp_reqci: rcvd ASYNCMAP
Oct 21 16:10:27 hwin pppd[19873]: (0)
Oct 21 16:10:27 hwin pppd[19873]:  (ACK)
Oct 21 16:10:27 hwin pppd[19873]: lcp_reqci: rcvd MAGICNUMBER
Oct 21 16:10:27 hwin pppd[19873]: (a098b898)
Oct 21 16:10:27 hwin pppd[19873]:  (ACK)
Oct 21 16:10:27 hwin pppd[19873]: lcp_reqci: rcvd PCOMPRESSION
Oct 21 16:10:27 hwin pppd[19873]:  (ACK)
Oct 21 16:10:27 hwin pppd[19873]: lcp_reqci: rcvd ACCOMPRESSION
Oct 21 16:10:27 hwin pppd[19873]:  (ACK)
Oct 21 16:10:27 hwin pppd[19873]: lcp_reqci: returning CONFACK.
Oct 21 16:10:27 hwin pppd[19873]: fsm_sdata(LCP): Sent code 2, id 1.
Oct 21 16:10:27 hwin pppd[19873]: fsm_rconfack(LCP): Rcvd id 1.
Oct 21 16:10:27 hwin pppd[19873]: fsm_sdata(IPCP): Sent code 1, id 1.
Oct 21 16:10:27 hwin pppd[19873]: IPCP: sending Configure-Request, id 1
Oct 21 16:10:27 hwin pppd[19873]: fsm_rconfreq(IPCP): Rcvd id 1.
Oct 21 16:10:27 hwin pppd[19873]: ipcp: received ADDR
Oct 21 16:10:27 hwin pppd[19873]: (10.144.153.51)
Oct 21 16:10:27 hwin pppd[19873]:  (ACK)
Oct 21 16:10:27 hwin pppd[19873]: ipcp: received COMPRESSTYPE
Oct 21 16:10:27 hwin pppd[19873]: (45)
Oct 21 16:10:27 hwin pppd[19873]:  (ACK)
Oct 21 16:10:27 hwin pppd[19873]: ipcp: returning Configure-ACK
Oct 21 16:10:28 hwin pppd[19873]: fsm_sdata(IPCP): Sent code 2, id 1.
Oct 21 16:10:30 hwin pppd[19873]: fsm_sdata(IPCP): Sent code 1, id 1.
Oct 21 16:10:30 hwin pppd[19873]: IPCP: sending Configure-Request, id 1
Oct 21 16:10:30 hwin pppd[19873]: fsm_rconfreq(IPCP): Rcvd id 255.
Oct 21 16:10:31 hwin pppd[19873]: ipcp: received ADDR
Oct 21 16:10:31 hwin pppd[19873]: (10.144.153.51)
Oct 21 16:10:31 hwin pppd[19873]:  (ACK)
Oct 21 16:10:31 hwin pppd[19873]: ipcp: received COMPRESSTYPE
Oct 21 16:10:31 hwin pppd[19873]: (45)
Oct 21 16:10:31 hwin pppd[19873]:  (ACK)
Oct 21 16:10:31 hwin pppd[19873]: ipcp: returning Configure-ACK
Oct 21 16:10:31 hwin pppd[19873]: fsm_sdata(IPCP): Sent code 2, id 255.
Oct 21 16:10:31 hwin pppd[19873]: fsm_rconfack(IPCP): Rcvd id 1.
Oct 21 16:10:31 hwin pppd[19873]: ipcp: up
Oct 21 16:10:31 hwin pppd[19873]: local  IP address 10.144.153.104
Oct 21 16:10:31 hwin pppd[19873]: remote IP address 10.144.153.51</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>(Note - I am using STATIC IP numbers - hence my machine sent that to the
PPP server - you won't see this if you are using DYNAMIC IP numbers.)
Also, this server requires a specific command to start ppp at its end.</P
><P
>This looks OK - so test it out as before with pings to IP numbers and
host names.</P
><P
>Fire up you web browser or whatever and go surfing - you are connected!</P
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="OFF"
></A
>Chapter 20. Shutting down the PPP link</H1
><P
>When you have finished with the PPP link, use the standard ppp-off
command to shut it down (remember - you need to be root or a member of
the PPP group!).</P
><P
>In your system log you will see something like:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>Oct 21 16:10:45 hwin pppd[19873]: Interrupt received: terminating link
Oct 21 16:10:45 hwin pppd[19873]: ipcp: down
Oct 21 16:10:45 hwin pppd[19873]: default route ioctl(SIOCDELRT): Bad address
Oct 21 16:10:45 hwin pppd[19873]: fsm_sdata(LCP): Sent code 5, id 2.
Oct 21 16:10:46 hwin pppd[19873]: fsm_rtermack(LCP).
Oct 21 16:10:46 hwin pppd[19873]: Connection terminated.
Oct 21 16:10:46 hwin pppd[19873]: Exit.</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Don't worry about the <TT
CLASS="LITERAL"
>SIOCDELRT</TT
> - this is just pppd noting that it
is terminating and is nothing to worry about.</P
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="AEN1329"
></A
>Chapter 21. Getting Help when totally stuck</H1
><P
>If you can't get your PPP link to work, go back through this document and
check everything - in conjunction with the output created by "chat-v..."
and "pppd -d" in you system log.</P
><P
>Also consult the PPP documentation and FAQ plus the other documents
mention herein!</P
><P
>If you are still stuck, try the comp.os.linux.misc and
comp.os.linux.networking newsgroups are reasonably regularly scanned by
people that can help you with PPP as is comp.protocols.ppp</P
><P
>You can try sending me personal email, but I do have a day job (and a
life) and I do not guarantee to respond quickly (if at all) as this
depends on my current work load and the state of my private life!</P
><P
>In particular - <EM
>DO NOT POST REAMS OF DEBUGGING OUTPUT TO THE NEWS GROUPS
NOR SEND IT TO ME BY EMAIL</EM
> - the former wastes huge amounts of network
bandwidth and the latter will be consigned to /dev/null (unless I have
specifically requested it).</P
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="AEN1337"
></A
>Chapter 22. Common Problems once the link is working</H1
><P
>One problem you will find is that many service providers will only
support the connection software package that they distribute to new
accounts. This is (typically) for Microsoft Windows :-( - and many service
provider help desks seem to know nothing about Unix (or Linux). So, be
prepared for limited assistance from them!</P
><P
>You could of course do the individual a favour and educate then about
Linux (any ISP help desk person should be reasonably 'with it' in
Internet terms and that means they should have a home Linux box - of
course it does)!</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1341"
>22.1. I can't see beyond the PPP server I connect to</A
></H2
><P
>OK - your PPP connection is up and running and you can ping the PPP
server by IP number (the second or "remote" IP number shown by <TT
CLASS="LITERAL"
>ifconfig
ppp0</TT
>), but you can't reach anything beyond this.</P
><P
>First of all, try pinging the IP numbers you have specified in
/etc/resolv.conf as name servers. If this works, you <EM
>can</EM
> see beyond your
PPP server (unless this has the same IP number as the "remote" IP number
of your connection). So now try pinging the full Internet name of your
service provider - eg</P
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ping my.provider.net.au</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>If this does NOT work, you have a problem with the name resolution. This
is probably because of a typo in your /etc/resolv.conf file. Check this
carefully against the information you acquired by ringing your service
provider. If all looks OK, ring your service provider and check that you
wrote down the IP numbers correctly.</P
><P
>If it STILL doesn't work (and your service provider confirms that his
name servers are up and running), you have a problem somewhere else -
and I suggest you check carefully through your Linux installation
(looking particularly for file permissions).</P
><P
>If you STILL can't ping your service provider's IP name servers by IP number,
either they are down (give them a voice call and check) or there is a
routing problem at your service provider's end. Again, ring them and
check this out.</P
><P
>One possibility is that the "remote end" is a Linux PPP server where the
IP forwarding option has not been specified in the kernel!</P
><P
>A good general test is to try connecting to your service provider using
the software that most supply for (gulp) Microsoft Windows. If
everything works from another operating system to exactly the same
account, then the problem is with your Linux system and NOT your service
provider.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1354"
>22.2. I can send email, but not receive it</A
></H2
><P
>If you are using dynamic IP numbers, this is perfectly normal. See
"Setting up Services" below.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1357"
>22.3. Why can't people finger, WWW, gopher, talk, etc. to my machine?</A
></H2
><P
>Again, if you are using dynamic IP numbers, this is perfectly normal.
See "Setting up Services" below.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="DYNAMIC-SERVER"
></A
>Chapter 23. Using Internet services with Dynamic IP numbers</H1
><P
>If you are using dynamic IP numbers (and many service providers will only
give you a dynamic IP number unless you pay significantly more for your
connection), then you have to recognize the limitations this imposes.</P
><P
>First of all, outbound service requests will work just fine. That is,
you can send email using sendmail (provided you have correctly set up
sendmail), ftp files from remote sites, finger users on other machines,
browse the web etc.</P
><P
>In particular, you can answer email that you have brought down to your
machine whilst you are off line. Mail will simply sit in your mail queue
until you dial back into your ISP.</P
><P
>However, your machine is NOT connected to the Internet 24 hours a day,
nor does it have the same IP number every time it is connected. So it is
impossible for you to receive email directed to your machine, and very
difficult to set up a web or ftp server that your friends can access! As
far as the Internet is concerned your machine does not exist as a
unique, permanently contactable machine as it does not have a unique IP
number (remember - other machines will be using the IP number when they
are allocated it on dial-in).</P
><P
>If you set up a WWW, (or any other server), it is totally unknown by any
user on the Internet UNLESS they know that your machine is connected AND
its actual (current) IP number. There are a number of ways they can get
this info, ranging from you ringing them, sending them email to tell
them or cunning use of ".plan" files on a shell account at your service
provider (assuming that your provider allows shell and finger access).</P
><P
>Now, for most users, this is not a problem - all that most people want
is to send and receive email (using your account on your service
provider) and make outbound connections to WWW, ftp and other servers on
the Internet. If you MUST have inbound connections to your server, you
should really get a static IP number. Alternatively you can explore the
methods hinted at above...</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1368"
>23.1. Setting up email</A
></H2
><P
>Even for dynamic IP numbers, you can certainly configure sendmail on your
machine to send out any email that you compose locally. Configuration of
sendmail can be obscure and difficult - so this document does not
attempt to tell you how to do this. However, you should probably
configure sendmail so that your Internet service provider is designated
as your "smart relay" host (the <TT
CLASS="LITERAL"
>sendmail.cf</TT
> <EM
>DS</EM
> option). (For more
sendmail configuration info, see the sendmail documents - and look at the
m4 configurations that come with sendmail. There is almost certain to be
one there that will meet your needs).</P
><P
>There are also excellent books on Sendmail (notably the 'bible' from
O'Reilly and Associates), but these are almost certainly overkill for
most users!</P
><P
>Once you have sendmail configured, you will probably want to have
sendmail dispatch any messages that have been sitting in the outbound
mail queue as soon as the PPP connection comes up. To do this, add the
command</P
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>sendmail -q &#38;</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>to your /etc/ppp/ip-up script (see below).</P
><P
>Inbound email is a problem for dynamic IP numbers. The way to handle
this is to:-

<P
></P
><UL
><LI
><P
>configure your mail user agent so that all mail is sent out with a
"reply to" header giving your email address at your Internet Service
provider.

If you can, you should also set your FROM address to be your email
address at your ISP as well.&#13;</P
></LI
><LI
><P
>use the popclient, fetchmail programs to retrieve your email from your
service provider. Alternatively, if your ISP is using IMAP, use an IMAP
enabled mail user agent, (such as pine).</P
></LI
></UL
>&#13;</P
><P
>You can automate this process at dial up time by putting the necessary
commands in the <TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
> script (see below).</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1386"
>23.2. Setting Up a local Name server</A
></H2
><P
>Whilst you can quite happily use the domain name servers located at your
ISP, you can also set up a local caching only (secondary) name server
that is brought up by the ip-up script. The advantage of running a local
(caching only) name server is that it will save you time (and bandwidth)
if you frequently contact the same sites during a long on-line session.</P
><P
>DNS configuration for a caching only nameserver (that uses a
"forwarders' line in the named.boot file pointing at your ISPs DNS) is
relatively simple. The O'Reilly book (DNS and Bind) explains all you
want to know about this.</P
><P
>There is also a DNS-HOWTO available.</P
><P
>If you are running a small LAN that can access the Internet through you
Linux PC (using IP Masquerade for example), it is probably a good idea
to run a local name server (with a forwarders directive) whilst the link
is up as this will minimise the bandwidth and delays associated with
name resolution.</P
><P
>One point of Nettiquette: ask permission from your ISP before you start
using a secondary, caching only name server in your ISP's domain.
Properly configured, your DNS will not cause any problems to your ISP at
all, but if you get things wrong, it can cause problems.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="WAN"
></A
>Chapter 24. Linking two networks using PPP</H1
><P
>There is basically no difference between linking a single Linux PC to a
PPP server and linking two LANs using PPP on a machine on each LAN.
Remember, PPP is a <EM
>peer to peer</EM
> protocol.</P
><P
>However, you <EM
>DEFINITELY</EM
> need to understand about how routing is
established. Read the NET-2 howto and the Linux Network Administrator
Guide (NAG). You will also find TCP/IP Network
Administration (published by O'Reilly and Assoc - ISBN
0-937175-82-X) to be of invaluable assistance.</P
><P
>If you are going to be sub networking an IP network number on either side
of the link, you will also find the Linux (draft) sub networking
mini-howto) to be of use. This is available at <A
HREF="http://www.interweft.com.au/other/"
TARGET="_top"
>Linux Sub networking mini-HOWTO</A
>.</P
><P
>In order to link two LANs, you <EM
>must</EM
> be using different IP network
numbers (or subnets of the same network number) and you will need to use
static IP numbers - or use IP masquerade. If you want to use IP
masquerade, see the IP masquerade mini-howto for instructions on setting
that up.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1403"
>24.1. Setting up the IP numbers</A
></H2
><P
>Arrange with the network administrator of the other LAN the IP numbers
that will be used for each end of the PPP interface. If you are using
static IP numbers, this will also probably require you to dial into a
specific telephone number.</P
><P
>Now edit the appropriate <TT
CLASS="LITERAL"
>/etc/ppp/options[.ttyXX]</TT
> file - it's a
good idea to have a specific modem and port at your end for this
connection. This may well require you to change your
<TT
CLASS="LITERAL"
>/etc/ppp/options</TT
> file - and create appropriate
options.ttyXX files for any other connections!</P
><P
>Specify the IP numbers for your end of the PPP link in
the appropriate options file exactly as shown above for static IP
numbers.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1410"
>24.2. Setting up the routing</A
></H2
><P
>You must arrange that packets on your local LAN are routed across the
interface that the PPP link establishes. This is a two stage process.</P
><P
>First of all, you need to establish a route from the machine running the
PPP link to the network(s) at the far end of the link. If the link is to
the Internet, this can be handled by a default route established by pppd
itself at your end of the connection using the 'defaultroute' option to pppd.</P
><P
>If however, the link is only linking two LANs, then a specific network
route must be added for each network that is accessible across the link.
This is done using a 'route' command for each network in the
/etc/ppp/ip-up script (see "After the link comes up"...) for instructions
on doing this.</P
><P
>The second thing you need to do is to tell the other computers on your
LAN that your Linux computer is actually the 'gateway' for the network(s)
at the far end of the ppp link.</P
><P
>Of course, the network administrator at the other end of the link has to
do all this too! However, as s/he will be routing packets to your specific
networks, a <EM
>specific network route</EM
> will be required, not a default
route (unless the LANs at the far and of the link are linking into you
to access the Internet across your connection).</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1418"
>24.3. Network security</A
></H2
><P
>If you are linking you LAN to the Internet using PPP - or even just to a
"foreign" LAN, you need to think about security issues. I 
strongly urge you to think about setting up a firewall!</P
><P
>You should also speak to the LAN administrator at your site <EM
>BEFORE</EM
>
you start linking to foreign LANs or the Internet this way. Failure to
do so could earn you anything from no reaction to really serious trouble!</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="IP-UP"
></A
>Chapter 25. After the link comes up - the <TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
> script</H1
><P
>Once the PPP link is established, pppd looks for
<TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
>. If this script exists and is executable, the
PPP daemon executes the script. This allows you to automate any special
routing commands that may be necessary and any other actions that you
want to occur every time the PPP link is activated.</P
><P
>This is just a shell script and can do anything that a shell script can
do (i.e. virtually anything you want).</P
><P
>For example, you can get sendmail to dispatch any waiting outbound
messages in the mail queue.</P
><P
>Similarly, you can insert the commands into ip-up to collect (using pop)
any email waiting for you at your ISP.</P
><P
>There are restrictions on <TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
>:-</P
><P
>&#13;<P
></P
><UL
><LI
><P
>It runs in a deliberately restricted environment to enhance
security. This means you must give a full path to binaries etc.</P
></LI
><LI
><P
>Technically, <TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
> is a <EM
>program</EM
> not a
script. This means it can be directly executed - and hence it requires
the standard file magic (<TT
CLASS="LITERAL"
>#!/bin/bash</TT
>) at the start of the first line and must be
readable and executable by root.</P
></LI
></UL
>&#13;</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1442"
>25.1. Special routing</A
></H2
><P
>If you are linking two LANs, you will need to set up specific routes
to the 'foreign' LANs. This is easily done using the <TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
>
script. The only difficulty arises if your machine handles multiple PPP
links.</P
><P
>This is because the <TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
> is executed for EVERY ppp
connection that comes up, so you need to carefully execute the correct
routing commands for the particular link that comes up - and not when
any other link comes up!</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1448"
>25.2. Handling email queues</A
></H2
><P
>When the link between two LANs comes up, you may well want to make sure
that email that is queued at either end is <EM
>flushed</EM
> - sent out to
its destination. This is done by adding the appropriate <TT
CLASS="LITERAL"
>sendmail</TT
>
invocation.</P
><P
>Using the bash 'case' statement on an appropriate parameter that pppd
passes into the script accomplishes this. For example, this is
the <TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
> script I use to handle our WAN links and the
link to my home Ethernet (also handled on the same ppp server).</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1455"
>25.3. A sample <TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
> script</A
></H2
><P
>The example below provides a variety of example uses.</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>#!/bin/bash
#
# Script which handles the routing issues as necessary for pppd
# Only the link to Newman requires this handling.
#
# When the ppp link comes up, this script is called with the following
# parameters
#       $1      the interface name used by pppd (e.g. ppp3)
#       $2      the tty device name
#       $3      the tty device speed
#       $4      the local IP address for the interface
#       $5      the remote IP address
#       $6      the parameter specified by the 'ipparam' option to pppd
#
case "$5" in
# Handle the routing to the Newman Campus server
        202.12.126.1)
                /sbin/route add -net 202.12.126.0 gw 202.12.126.1
# and flush the mail queue to get their email there asap!
		/usr/sbin/sendmail -q &#38;
                ;;
	139.130.177.2)
# Our Internet link
# When the link comes up, start the time server and synchronise to the world
# provided it is not already running
                if [ ! -f /var/lock/subsys/xntpd ]; then
                        /etc/rc.d/init.d/xntpd.init start &#38;
                fi
# Start the news server (if not already running)
                if [ ! -f /var/lock/subsys/news ]; then
                        /etc/rc.d/init.d/news start &#38;
                fi
                ;;
	203.18.8.104)
# Get the email down to my home machine as soon as the link comes up
# No routing is required as my home Ethernet is handled by IP
# masquerade and proxyarp routing.
		/usr/sbin/sendmail -q &#38;
		;;
        *)
esac
exit 0</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>As a result of bringing up the ppp link to our Newman campus and this
script, we end up with the following routing table entries (this machine
also is our general dial up PPP server AND handles our Internet link). I
have interspersed comments in the output to help explain what each entry
is) :-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>[root@kepler /root]# route -n
Kernel routing table
Destination     Gateway         Genmask         Flags MSS    Window Use Iface
# the HOST route to our remote internet gateway
139.130.177.2   *               255.255.255.255 UH    1500   0      134 ppp4
# the HOST route to our Newman campus server
202.12.126.1    *               255.255.255.255 UH    1500   0       82 ppp5
# the HOST route to my home ethernet
203.18.8.104    *               255.255.255.255 UH    1500   0       74 ppp3
# two of our general dial up PPP lines
203.18.8.64     *               255.255.255.255 UH    552    0        0 ppp2
203.18.8.62     *               255.255.255.255 UH    552    0        1 ppp1
# the specific network route to the Newman campus LAN
202.12.126.0    202.12.126.1    255.255.255.0   UG    1500   0        0 ppp5
# the route to our local Ethernet (super-netting two adjacent C classes)
203.18.8.0      *               255.255.254.0   U     1500   0     1683 eth0
# the route to the loop back device
127.0.0.0       *               255.0.0.0       U     3584   0      483 lo
# the default route to the Internet
default         139.130.177.2   *               UG    1500   0     3633 ppp4</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1464"
>25.4. Handling email</A
></H2
><P
>The previous section shows how to handle the outgoing mail - simply by
flushing the mail queue once the link is up.</P
><P
>If you are running a WAN link, you can arrange with the network
administrator of the remote LAN to do exactly the same thing. For
example, at the Newman Campus end of our WAN link, the
<TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
> script looks like :-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>#!/bin/bash
#
# Script which handles the routing issues as necessary for pppd
# Only the link to Hedland requires this handling.
#
# When the ppp link comes up, this script is called with the following
# parameters
#       $1      the interface name used by pppd (e.g. ppp3)
#       $2      the tty device name
#       $3      the tty device speed
#       $4      the local IP address for the interface
#       $5      the remote IP address
#       $6      the parameter specified by the 'ipparam' option to pppd
#
case "$5" in
        203.18.8.4)
                /usr/sbin/sendmail -q
                ;;
        *)
esac
exit 0</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>If however you have only a dynamic IP PPP link to your ISP, you need to
get your email from the account on your ISPs machine. This is usually
done using the POP (Post Office Protocol). This process can be handled
using the 'popclient' program - and the ip-up script can automate this
process for you too!</P
><P
>Simply create a <TT
CLASS="LITERAL"
>/etc/ppp/ip-up</TT
> script that contains the
appropriate invocation of popclient. For my laptop that runs Red Hat Linux
(which I take on any travels), this is...</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>popclient -3 -c -u hartr -p &#60;password&#62; kepler.hedland.edu.au |formail -s procmail</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>You could use slurp or whatever to do the same for news, and so forth.
Remember, the ip-up script is just a standard bash script and so can be
used to automate ANY function that needs to be accomplished every time
the appropriate PPP link comes up.</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="AEN1477"
></A
>Chapter 26. Using <TT
CLASS="LITERAL"
>/etc/ppp/ip-down</TT
></H1
><P
>You can create a script  that will be executed once the
link has been terminated. This is stored in <TT
CLASS="LITERAL"
>/etc/ppp/ip-down</TT
>. It can be
used to undo anything special that you did in the corresponding
/etc/ppp/ip-up script.</P
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="AEN1482"
></A
>Chapter 27. Routing issues on a LAN</H1
><P
>If you are connected to a LAN but still want to use PPP on your personal
Linux machine , you need to address some issues of the routes packets
need to take from your machine to reach your LAN (through your Ethernet
interface) and also to the remote PPP server and beyond.</P
><P
>This section does NOT attempt to teach you about routing - it deals only
with a simple, special case of (static) routing!</P
><P
>I strongly urge you to read the Linux Network Administrator Guide (NAG)
if you are NOT familiar with routing. Also the O'Reilly book "TCP/IP
Network Administration" covers this topic in a very understandable form.</P
><P
>The basic rule of static routing is that the DEFAULT route should be the
one that points to the MOST number of network addresses. For other
networks, enter specific routes to the routing table.</P
><P
>The ONLY situation I am going to cover here is where your Linux box is
on a LAN that is not connected to the Internet - and you want to dial
out to the Internet for personal use whilst still connected to the LAN.</P
><P
>First of all, make sure that your Ethernet route is set up to the
specific network addresses available across your LAN - NOT set to the
default route!</P
><P
>Check this by issuing a route command, you should see something like the
following:-</P
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>[root@hwin /root]# route -n
Kernel routing table
Destination     Gateway         Genmask         Flags MSS    Window Use Iface
loopback        *               255.255.255.0   U     1936   0       50 lo
10.0.0.0        *               255.255.255.0   U     1436   0      565 eth0</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>If your Ethernet interface (eth0) is pointing at the default route, (the
first column will show "default" in the eth0 line) you need to change
your Ethernet initialization scripts to make it point at the specific
network numbers rather than the default route (consult the Net2 HOWTO
and NAG).</P
><P
>This will allow pppd to set up your default route as shown below:-</P
><P
>&#13;<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>[root@hwin /root]# route -n
Kernel routing table

Destination     Gateway         Genmask         Flags MSS    Window Use Iface
10.144.153.51   *               255.255.255.255 UH    488    0        0 ppp0
127.0.0.0       *               255.255.255.0   U     1936   0       50 lo
10.1.0.0        *               255.255.255.0   U     1436   0      569 eth0
default         10.144.153.51   *               UG    488    0        3 ppp0</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>As you can see, we have a host route to the PPP server ( 10.144.153.51)
via ppp0 and also a default network route that uses the PPP server as
its gateway.</P
><P
>If your set up needs to be more complex than this - read the routing
documents already mentioned and consult an expert at your site!</P
><P
>If your LAN already has routers on it, you will already have gateways
established to the wider networks available at your site. You should
STILL point your default route at the PPP interface - and make the other
routes specific to the networks they serve.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1500"
>27.1. Note on Security</A
></H2
><P
>When you set up a Linux box on an existing LAN to link into the
Internet, you are potentially opening your entire LAN to the Internet -
and the hackers that reside there. Before you do this, I strongly urge
you to consult your network administrator and site security policy. If
your PPP connection to the Internet is used to successfully attack your
site, you will at the very least earn the intense anger of your fellow
users, network and system administrators. You may also find yourself in
very much more serious trouble!</P
><P
>Before you connect a LAN to the Internet, you should consider the
security implications of even a DYNAMIC connection - hence the earlier
reference to the O'Reilly "Building Internet Firewalls"!</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="PPP-SERVER"
></A
>Chapter 28. Setting up a PPP server</H1
><P
>As already mentioned, there are many ways to do this. What I present
here is the way I do it, (using a Cyclades multi-port serial card), and a
rotary dial in set of telephone lines.</P
><P
>If you don't like the method I present here, please feel free to go your
own way. I would however, be pleased to include additional methods in
future versions of the HOWTO. So, please send me your comments and
methods!</P
><P
>Please note, this section only concerns setting up Linux as a PPP
server. I do not (ever) intend to include information on setting up
special terminal servers and such.</P
><P
>Also, I have yet to experiment with shadow passwords (but will be doing
so sometime). Information currently presented does NOT therefore include any
bells and whistles that are required by the shadow suite.</P
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1510"
>28.1. Kernel compilation</A
></H2
><P
>All the earlier comments regarding kernel compilation and kernel
versions versus pppd versions apply. This section assumes that you have
read the earlier sections of this document!</P
><P
>For a PPP server, you <EM
>MUST</EM
> include IP forwarding in your kernel.
You may also wish to include other capabilities (such as IP fire walls,
accounting etc etc).</P
><P
>If you are using a multi-port serial card, then you must obviously
include the necessary drivers in your kernel too!</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1516"
>28.2. Overview of the server system</A
></H2
><P
>We offer dial up PPP (and SLIP) accounts and shell accounts using the
same user name/password pair. This has the advantages (for us) that a
user requires only one account and can use it for all types of
connectivity. </P
><P
>As we are an educational organization, we do not charge our staff and
students for access, and so do not have to worry about accounting and
charging issues.</P
><P
>We operate a firewall between our site and the Internet, and this
restricts some user access as the dial up lines are inside our
(Internet) firewall (for fairly obvious reasons, details of our other
internal fire walls are not presented here and are irrelevant in any
case).</P
><P
>The process a user goes through to establish a PPP link to our site
(once they have a valid account of course) is :-

<P
></P
><UL
><LI
><P
>Dial into our rotary dialer (this is a single phone number that
connects to a bank of modems - the first free modem is then used).</P
></LI
><LI
><P
>Log in using a valid user name and password pair.</P
></LI
><LI
><P
>At the shell prompt, issue the command <TT
CLASS="LITERAL"
>ppp</TT
> to start PPP on
the server.</P
></LI
><LI
><P
>Start PPP on their PC (be it running Windows, DOS, Linux MAC OS or
whatever - that is their problem).</P
></LI
></UL
>&#13;</P
><P
>The server uses individual <TT
CLASS="LITERAL"
>/etc/ppp/options.ttyXX</TT
> files for each
dial in port that set the remote IP number for dynamic IP allocation.
The server users proxyarp routing for the remote clients (set via the
appropriate option to pppd). This obviates the need for routed or gated.</P
><P
>When the user hangs up at their end, pppd detects this and tells the modem
to hang up, bringing down the PPP link at the same time.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1535"
>28.3. Getting the software together</A
></H2
><P
>You will need the following software:-

<P
></P
><UL
><LI
><P
>Linux, properly compiled to include the necessary options.</P
></LI
><LI
><P
>The appropriate version of pppd for your kernel.</P
></LI
><LI
><P
>A 'getty' program that intelligently handles modem
communications.

We use getty_ps2.0.7h, but mgetty is highly thought of. I understand
that mgetty can detect a call that is using pap/chap (pap is the
standard for Windows95) and invoke pppd automatically, but I have yet to
explore this.</P
></LI
><LI
><P
>An operational domain name server (DNS) that is accessible to your
dial up users.

You should really be running your own DNS if possible...</P
></LI
></UL
>&#13;</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1547"
>28.4. Setting up standard (shell access) dialup.</A
></H2
><P
>Before you can set up your PPP server, your Linux box must be capable of
handling standard dial up access.</P
><P
><EM
>This howto does NOT cover setting this up. Please see the
documentation of the getty of your choice and serial HOWTO for
information on this.</EM
></P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1552"
>28.5. Setting up the PPP options files</A
></H2
><P
>You will need to set up the overall <TT
CLASS="LITERAL"
>/etc/ppp/options</TT
> with the
common options for all dial up ports. The options we use are:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>asyncmap 0
netmask 255.255.254.0
proxyarp
lock
crtscts
modem</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>Note - we do NOT use any (obvious) routing - and in particular there is
no defaultroute option. The reason for this is that all you (as a PPP
server) are required to do is to route packets <EM
>from</EM
> the ppp client
out across your LAN/Internet and route packets <EM
>to</EM
> the client from
your LAN and beyond.</P
><P
>All that is necessary for this is a host route to the client machine and
the use of the 'proxyarp' option to pppd.</P
><P
>The 'proxyarp' option sets up (surprise) a proxy ARP entry in the PPP
server's ARP table that basically says 'send all packets destined for
the PPP client to me'. This is the easiest way to set up routing to a
single PPP client - but you cannot use this if you are routing between
two LANs - you must add proper network routes which can't use proxy ARP.</P
><P
>You will almost certainly wish to provide dynamic IP number allocation
to your dial up users. You can accomplish this by allocating an IP
number to each dial up port. Now, create a <TT
CLASS="LITERAL"
>/etc/ppp/options.ttyXX</TT
>
for each dial up port.</P
><P
>In this, simply put the local (server) IP number and the IP number that
is to be used for that port. For example</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>kepler:slip01</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>In particular, note that you can use valid host names in this file (I
find that I only remember the IP numbers of critical machines and
devices on my networks - names are more meaningful)!</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1569"
>28.6. Setting pppd up to allow users to (successfully) run it</A
></H2
><P
>As starting a ppp link implies configuring a kernel device (a network
interface) and manipulating the kernel routing tables, special
privileges are required - in fact full root privileges.</P
><P
>Fortunately, pppd has been designed to be 'safe' to run set uid to root.
So you will need to...

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>chmod u+s /usr/sbin/pppd</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>When you list the file, it should then appear as...

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>-rwsr-xr-x   1 root     root        74224 Apr 28 07:17 /usr/sbin/pppd</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>If you do not do this, users will be unable to set up their ppp link.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN1577"
>28.7. Setting up the global alias for pppd</A
></H2
><P
>In order to simplify things for our dial up PPP users, we create a
global alias (in /etc/bashrc) so that one simple command will start ppp
on the server once they are logged in.</P
><P
>This looks like...

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>alias ppp="exec /usr/sbin/pppd -detach"</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>What this does is

<P
></P
><UL
><LI
><P
>exec : this means replace the running program (in this case the
shell) with the program that is run.</P
></LI
><LI
><P
>pppd -detach : start up pppd and do NOT fork into the background.
This ensures that when pppd exits there is no process hanging around.</P
></LI
></UL
>&#13;</P
><P
>When a user logs in like this, they will appear in the output of 'w' as...

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>  6:24pm  up 3 days,  7:00,  4 users,  load average: 0.05, 0.03, 0.00
User     tty       login@  idle   JCPU   PCPU  what
hartr    ttyC0     3:05am  9:14                -</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>And that is it...I told you this was a simple, basic PPP server system!</P
></DIV
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="DIRECT"
></A
>Chapter 29. Using PPP across a null modem (direct serial) connection</H1
><P
>This is very simple - there is no modem in the way so things are much
simpler.</P
><P
>First of all, choose one of the machines as a 'server', setting up a
getty on the serial port so you can test that you do have connectivity
using minicom to access the serial port on the 'client'.</P
><P
>Once you have this functioning, you can remove the getty UNLESS you want
to make sure that the connection is validated using user name/password
pairs as for a dial up connection. As you have 'physical control' of
both machines, I will presume that you do NOT want to do this.</P
><P
>Now, on the server, remove the getty and make sure that you have the serial
ports on both machines configured correctly using 'setserial'.</P
><P
>All you need to do now is to start pppd on both systems. I will assume
that the connection uses /dev/ttyS34 on both machines. So, on both
machines execute the command:-</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>pppd -detach crtscts lock &#60;local IP&#62;:&#60;remote IP&#62; /dev/ttyS3 38400 &#38;</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>This will bring up the link - but as yet you have no routing specified.
You can test the link by pinging to and fro to each machine. If this
works, bring down the link by killing one of the pppd processes.</P
><P
>The routing you need will of course depend on exactly what you are
trying to do. Generally, one of the machines will be connected
to an Ethernet (and beyond) and so the routing required is exactly the
same as for a PPP server and client.</P
><P
>So on the Ethernet equipped machine, the pppd command would be...</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>pppd -detach crtscts lock proxyarp &#60;local IP&#62;:&#60;remote IP&#62; /dev/ttyS3 38400 &#38;</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>and on the other machine
...</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>pppd -detach crtscts lock defaultroute &#60;local IP&#62;:&#60;remote IP&#62; /dev/ttyS3 38400 &#38;</PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><P
>If you are linking two networks (using a serial link!) or have more
complex routing requirements, you can use /etc/ppp/ip-up in exactly the
same way as mentioned earlier in this document.</P
></DIV
><DIV
CLASS="CHAPTER"
><HR><H1
><A
NAME="AEN1609"
></A
>Chapter 30. PPPoE or PPP over Ethernet</H1
><P
>This document does not currently cover PPoE as it appears to NOT (for Linux anyway) be under active development.
For those who have interest or need of PPPoE we do include the following links.</P
><P
>We have heard rumors that the 2.4 series of kernels will have PPoE but we are unable to confirm this
at this time. If you know differently please <A
HREF="mailto:webmaster@linuxports.com"
TARGET="_top"
>contact us.</A
></P
><P
></P
><UL
><LI
><P
><A
HREF="http://www.ecf.toronto.edu/~stras/pppoe.html"
TARGET="_top"
>pppoe: a PPP-over-Ethernet redirector for pppd</A
></P
><P
>This program can be used to enable PPPoE support using the pppd
daemon.  PPPoE is a technique for the encapsulation of PPP streams
inside of Ethernet frames.  This technology is being deployed by
high-speed Internet access providers (cable modems, xDSL, etc.) in
order to decouple the supply of bandwidth from ISP services.  In
particular, in Canada, the Bell Sympatico ADSL service is moving from
DHCP-based access control to PPPoE.  Further details on PPPoE can be
found in RFC2516.</P
></LI
><LI
><P
><A
HREF="http://www.roaringpenguin.com/pppoe.html"
TARGET="_top"
>Roaring Penguin PPoE Client.</A
></P
><P
>The client is a user-mode program and does not require any kernel modifications. It is 
fully compliant with RFC 2516, the official PPPoE specification. </P
></LI
><LI
><P
><A
HREF="http://www.carricksolutions.com/pppoe.htm"
TARGET="_top"
>A PPoE FAQ Page.</A
> This
page includes comprehensive information on what PPoE is, what it is used for, and 
implementations of the protocol. If you are looking for a good all around resource on
PPoE this is an excellent page to start with.</P
></LI
><LI
><P
><A
HREF="http://www.faqs.org/rfcs/rfc2516.html"
TARGET="_top"
>The actual RFC.</A
> This is for
the technically minded only and usually only of help to those wishing to program with or
for the protocol.</P
></LI
></UL
></DIV
></DIV
></BODY
></HTML
>