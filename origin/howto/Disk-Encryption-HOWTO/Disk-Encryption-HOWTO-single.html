<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Disk Encryption HOWTO</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="description" content="A method is described for encrypting a hard disk, either in whole or in part, with the encryption key stored on an external medium for increased security."></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="article"><div class="titlepage"><div><div><h2 class="title"><a name="Disk-Encryption-HOWTO"></a>Disk Encryption HOWTO</h2></div><div><div class="author"><h3 class="author"><span class="firstname">David</span> <span class="surname">Braun</span></h3><div class="affiliation"><div class="address"><p><code class="email">&lt;<a class="email" href="mailto:cruhmoz602%20%5Bat%5D%20sneakemale%20%5Bperiod%5D%20com%20(rewrite%20'male'%20as%20'mail')">cruhmoz602 [at] sneakemale [period] com (rewrite 'male' as 'mail')</a>&gt;</code></p></div></div></div></div><div><p class="copyright">Copyright © 2004 David Braun</p></div><div><p class="pubdate">2004-11-17</p></div><div><div class="revhistory"><table style="border-style:solid; width:100%;" summary="Revision History"><tr><th align="left" valign="top" colspan="3"><b>Revision History</b></th></tr><tr><td align="left">Revision 1.5</td><td align="left">2004-11-17</td><td align="left">DB</td></tr><tr><td align="left" colspan="3">added warning about dm-crypt</td></tr><tr><td align="left">Revision 1.4</td><td align="left">2004-08-17</td><td align="left">DB</td></tr><tr><td align="left" colspan="3">bug fixes, hints toward plausible deniability and dm-crypt</td></tr><tr><td align="left">Revision 1.3</td><td align="left">2003-12-18</td><td align="left">DB</td></tr><tr><td align="left" colspan="3">added link to Diceware</td></tr><tr><td align="left">Revision 1.2</td><td align="left">2003-10-09</td><td align="left">DB</td></tr><tr><td align="left" colspan="3">added idle logout and Gentoo instructions</td></tr><tr><td align="left">Revision 1.1</td><td align="left">2003-09-13</td><td align="left">DB</td></tr><tr><td align="left" colspan="3">added step to zero out keychain</td></tr><tr><td align="left">Revision 1.0</td><td align="left">2003-08-28</td><td align="left">tmm</td></tr><tr><td align="left" colspan="3">Initial release, reviewed by LDP</td></tr><tr><td align="left">Revision 0.92</td><td align="left">2003-08-27</td><td align="left">DB</td></tr><tr><td align="left" colspan="3">first submission to LDP</td></tr></table></div></div><div><div class="abstract"><p class="title"><b>Abstract</b></p><p>A method is described for encrypting a hard disk, either in whole
      or in part, with the encryption key stored on an external medium for
      increased security.</p></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="sect1"><a href="#Introduction">1. Introduction</a></span></dt><dd><dl><dt><span class="sect2"><a href="#TechnicalSummary">1.1. Technical Summary</a></span></dt><dt><span class="sect2"><a href="#CopyrightAndLicense">1.2. Copyright and License</a></span></dt><dt><span class="sect2"><a href="#Disclaimer">1.3. Disclaimer</a></span></dt><dt><span class="sect2"><a href="#Acknowledgments">1.4. Acknowledgments</a></span></dt><dt><span class="sect2"><a href="#Feedback">1.5. Feedback</a></span></dt><dt><span class="sect2"><a href="#Approaches">1.6. Approaches</a></span></dt><dt><span class="sect2"><a href="#ThreatModel">1.7. Threat Model</a></span></dt><dt><span class="sect2"><a href="#Caveats">1.8. Caveats</a></span></dt><dt><span class="sect2"><a href="#Requirements">1.9. Requirements</a></span></dt><dt><span class="sect2"><a href="#LookingToTheFuture">1.10. Looking to the Future</a></span></dt></dl></dd><dt><span class="sect1"><a href="#Procedure">2. Procedure</a></span></dt><dd><dl><dt><span class="sect2"><a href="#PrepareTheKeychain">2.1. Prepare the Keychain</a></span></dt><dt><span class="sect2"><a href="#PrepareTheAsset">2.2. Prepare the Asset</a></span></dt><dt><span class="sect2"><a href="#Scripts">2.3. Scripts</a></span></dt><dt><span class="sect2"><a href="#TestingAndBackup">2.4. Testing and Backup</a></span></dt><dt><span class="sect2"><a href="#RescueDisk">2.5. Rescue Disk</a></span></dt><dt><span class="sect2"><a href="#InstallingLinux">2.6. Installing Linux</a></span></dt></dl></dd><dt><span class="sect1"><a href="#MoreInformation">3. More Information</a></span></dt><dt><span class="glossary"><a href="#Glossary">Glossary</a></span></dt><dt><span class="appendix"><a href="#gfdl">A. GNU Free Documentation License</a></span></dt><dd><dl><dt><span class="section"><a href="#gfdl-0">1. PREAMBLE</a></span></dt><dt><span class="section"><a href="#gfdl-1">2. APPLICABILITY AND DEFINITIONS</a></span></dt><dt><span class="section"><a href="#gfdl-2">3. VERBATIM COPYING</a></span></dt><dt><span class="section"><a href="#gfdl-3">4. COPYING IN QUANTITY</a></span></dt><dt><span class="section"><a href="#gfdl-4">5. MODIFICATIONS</a></span></dt><dt><span class="section"><a href="#gfdl-5">6. COMBINING DOCUMENTS</a></span></dt><dt><span class="section"><a href="#gfdl-6">7. COLLECTIONS OF DOCUMENTS</a></span></dt><dt><span class="section"><a href="#gfdl-7">8. AGGREGATION WITH INDEPENDENT WORKS</a></span></dt><dt><span class="section"><a href="#gfdl-8">9. TRANSLATION</a></span></dt><dt><span class="section"><a href="#gfdl-9">10. TERMINATION</a></span></dt><dt><span class="section"><a href="#gfdl-10">11. FUTURE REVISIONS OF THIS LICENSE</a></span></dt><dt><span class="section"><a href="#gfdl-addendum">12. ADDENDUM: How to use this License for your documents</a></span></dt></dl></dd></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Introduction"></a>1. Introduction</h2></div></div></div><p>I've got a
    laptop computer running Linux and I don't want to
    worry about someone reading the personal information it contains, in case
    it gets lost or stolen. My log on password may stop someone from booting
    it, but it won't prevent an attacker from removing the hard disk and
    reading its data. I need stronger protection.</p><p>Fortunately, it's relatively easy to use encryption so the hard
    disk data would be unreadable if it were to fall into the wrong hands.
    Encryption's not only useful for portable computers like laptops&#8212;it
    can be used to protect any computer with personal information. I protect
    my computer's files with encryption for the same reason I lock my
    filing cabinet at home. For further motivation, you may be interested in
    reading Michael Crawford's <a class="ulink" href="http://www.goingware.com/encryption/" target="_top">Why You Should Use Encryption</a>.</p><p>I could encrypt only certain files, such as those in my home
    directory. This would protect the files but then I'd have to worry
    about information leaking out of them to other, unencrypted places on the
    disk. Instead I encrypt the whole disk so I don't have to manage this
    problem.</p><p>There are many encryption algorithms to choose from. I chose <a class="ulink" href="http://csrc.nist.gov/CryptoToolkit/aes/" target="_top">AES</a> because it has
    been approved by the US government's <a class="ulink" href="http://www.nist.gov/" target="_top">National
    Institute of Standards and Technology</a> and is well regarded by the
    cryptography community. I want my use of it to be resistant to dictionary
    attacks, so I use a long, randomly generated key. There's no way
    I'm going to memorize such a key so I keep it in a form I can carry
    with me easily: on a USB flash drive on my keychain. I encrypt the key
    with a passphrase so my data is protected in two ways: by a) what I have
    (the USB flash drive) and b) what I know (the passphrase). I can even give
    a friend access to my computer without giving away my passphrase&#8212;she uses
    her own USB flash drive and her own passphrase.</p><p>The operating system keeps the data encrypted on the disk at all
    times and decrypts it in RAM only as it's used. This way if the
    computer loses power suddenly the data will remain protected. The
    decryption key is loaded into RAM at boot time and kept there while the
    computer is on, so I don't need to keep the USB flash drive plugged in
    after starting the computer.</p><p>The procedure outlined in this HOWTO is written for version 2.4 of
    the Linux kernel. It will become less complicated with the release of
    Linux 2.6, which will have built-in support for encryption and do a better
    job of managing partitions within loopback devices.</p><p>This document assumes the reader has a moderate level of experience
    with Linux (you should be comfortable <a class="ulink" href="http://www.tldp.org/HOWTO/Kernel-HOWTO/index.html" target="_top">patching and
    compiling kernels</a> as well as <a class="ulink" href="http://www.tldp.org/HOWTO/Multi-Disk-HOWTO.html" target="_top">partitioning,
    mounting, and unmounting disks</a>).</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="TechnicalSummary"></a>1.1. Technical Summary</h3></div></div></div><p>The encryption is implemented through a special kind of
      <em class="glossterm">loopback device</em>. A loopback device doesn't
      store any data itself; instead it takes all the data storage and
      retrieval requests it receives and passes them along to a real storage
      device, such as a disk or a file. As the data passes through, it can be
      filtered, and in our case the filter used is encryption.</p><p>When the system is deployed, a removable medium (USB flash drive)
      boots using GRUB, a kernel, and an initrd. Both the key and the kernel
      are selected from the GRUB menu, allowing a single removable medium to
      be used with multiple computers. The initrd contains just enough tools
      to ask for a passphrase, set up an encrypted loopback device, and mount
      it. After mounting, <code class="literal">pivot_root</code> is used to resume the
      boot process from the encrypted device. Loopback device offsets are
      used, instead of partitions, to access separate swap and root file
      system spaces within the encrypted loopback device because the 2.4
      kernel doesn't provide access to partitions within loopback devices.
      The offset method does not generalize to multiple partitions
      (unfortunately) because the maximum offset understood by
      <code class="literal">losetup</code> is 2GB.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="CopyrightAndLicense"></a>1.2. Copyright and License</h3></div></div></div><p>Permission is granted to copy, distribute and/or modify this
      document under the terms of the GNU Free Documentation License, Version
      1.2 or any later version published by the Free Software Foundation; with
      no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts. A
      copy of the license is included in <a class="xref" href="#gfdl" title="A. GNU Free Documentation License">Appendix A, <i>GNU Free Documentation License</i></a>.</p><p><span class="trademark">Linux is a registered trademark of
      Linus Torvalds.</span>®</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Disclaimer"></a>1.3. Disclaimer</h3></div></div></div><p>No liability for the contents of this document can be accepted.
      Use the concepts, examples and information at your own risk. There may
      be errors and inaccuracies that could be damaging to your system and you
      may lose important data. Proceed with caution, and although this is
      highly unlikely, the author does not take any responsibility.</p><p>All copyrights are held by their by their respective owners,
      unless specifically noted otherwise. Use of a term in this document
      should not be regarded as affecting the validity of any trademark or
      service mark. Naming of particular products or brands should not be seen
      as endorsements.</p><p>I know you hate reading directions and want to skip to the meaty
      bit right away, but I advise you to read the whole document first before
      touching anything. I know all the HOWTOs say that, but I really mean it
      for this one. It's worth it; trust me. You may also want to run
      through the procedure first on a test system before tackling a
      production system.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Acknowledgments"></a>1.4. Acknowledgments</h3></div></div></div><p>Thanks to Linus Torvalds, Jari Ruusu, and all the developers who
      contributed to their software, without which this HOWTO would have been
      impossible.</p><p>Thanks to the <a class="ulink" href="http://www.nist.gov/" target="_top">National Institute
      of Standards and Technology</a> for carefully selecting a strong,
      open encryption algorithm.</p><p>Thanks to Mark Garboden and others on the <a class="ulink" href="http://mail.nl.linux.org/linux-crypto/" target="_top">linux-crypto</a>
      mailing list and <a class="ulink" href="http://www.tldp.org/mailinfo.html#maillists" target="_top">The Linux
      Documentation Project mailing lists</a> who took the time to
      critique my writing and offer suggestions.</p><p>Thanks to alert readers Ladislao Bastetti and Norris Pouhovitch for
      struggling through unusual hardware configurations, finding mistakes in
      the HOWTO, and suggesting good ideas.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Feedback"></a>1.5. Feedback</h3></div></div></div><p>Feedback is solicited for this document. Please send additions,
      comments, and criticisms to the author.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Approaches"></a>1.6. Approaches</h3></div></div></div><p>There are three different approaches we can take to encrypt the
      disk: encrypt the whole thing, a single partition, or a single file. I
      strongly recommend the first approach for best security. The first two
      approaches assume you'll be booting from removable media, such as a
      USB flash drive or a business card size CD-ROM. If you don't want to
      do this, you may modify the method to boot from the disk instead by
      making a small, unencrypted boot partition. If you want to use a USB
      flash drive to boot your computer, be sure your motherboard can do it
      first. At the time of this writing many cannot.</p><p>To avoid having to enumerate all three approaches everywhere
      I'm going to refer to what you're protecting as the
      <em class="glossterm">asset</em>. I will refer to the removable medium used
      to store the key as the <em class="glossterm">keychain</em>. I call it the
      keychain instead of the key because we can store lots of keys, each for
      different computers, on the same medium.</p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm102"></a>1.6.1. Whole Disk</h4></div></div></div><p>A problem with keeping data secret with encryption is that the
        data likes to move around. Imagine the encryption is like a fence
        around your data. While the data's inside the fence, it's
        safe. To be most useful, however, data likes to be transmitted on
        networks, put on removable disks like CD-ROMs, and shared with
        friends. Any time your data leaves the fenced area it's
        unprotected. We can't put an encryption fence around all possible
        locations where our data might play but we do want to make the fence
        as large as practical. By putting the encryption fence around your
        whole hard disk, you won't have to worry about data becoming
        unprotected if it jumps to another part of the disk.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>In this approach, we create one swap
        space and one root file system. Some people want more than a single
        encrypted partition for the root file system. Unfortunately, the
        method detailed here relies on the offset parameter of
        <code class="literal">losetup</code> to create "subpartitions" within
        the asset. The offset parameter is limited to a maximum value of 2GB,
        limiting the size of all but the last partition to 2GB. This works
        nicely for swap, which is already limited to 2GB on the i386
        architecture, but I'm guessing it won't be practical for other
        uses. Using it to create multiple partitions smaller than 2GB is left
        as an exercise for the reader.</p><p>Another way to handle multiple partitions is to encrypt each partition separately (using the same key) to avoid the technical limitation above.  This isn't secure as encrypting the whole disk because the partition table is exposed.  When an attacker attempts to break encryption, the first thing he does is try to figure out what it's encrypting.  A partition table listing Linux partitions is a big hint.  For this reason I discourage encrypting multiple partitions separately, but arguably it's a good compromise for getting around the current <code class="literal">losetup</code> limitation.  Another option is simply to wait for the release of Linux 2.6 because it is expected to make the offset parameter unnecessary.</p></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm110"></a>1.6.2. Partition (for multiboot systems)</h4></div></div></div><p>Encrypting the whole disk is fine if Linux is the only operating
        system on it, but this won't work for people who have set up their
        computer to boot multiple operating systems, e.g., <a class="ulink" href="http://www.kernel.org" target="_top">Linux</a>, <a class="ulink" href="http://www.netbsd.org/" target="_top">NetBSD</a>, and <a class="ulink" href="http://developer.apple.com/darwin/" target="_top">Darwin</a>. In this case
        we can encrypt just the Linux partition and leave the others alone.
        Since we're booting from a removable medium, we won't even
        need to include the Linux partition in the multiboot menu with the
        others. To see why this isn't as secure as encrypting the whole
        disk, read <a class="xref" href="#Attack_Tree" title="Table 1. Attack Tree">Table 1, &#8220;Attack Tree&#8221;</a>.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm117"></a>1.6.3. File (for home directories)</h4></div></div></div><p>You may want to encrypt only a file on a file system. Once
        you've encrypted it you can put into it whatever you want,
        including other file systems. You might want to use this approach to
        encrypt only your home directory, for example. This is the least
        secure of the three approaches and not recommended. If you choose this
        approach you will notice instructions below to skip whole sections.
        This is because I'm assuming you've already booted an
        operating system and have your swap issues handled, so those sections
        don't apply to you. This HOWTO may be overkill for your needs and
        you can probably get away with just reading the fine
        <code class="literal"><a class="ulink" href="http://loop-aes.sourceforge.net/loop-AES.README" target="_top">README</a></code>
        that comes with <a class="ulink" href="http://sourceforge.net/projects/loop-aes/" target="_top">loop-AES</a>.
        If you do, be sure to read <a class="xref" href="#ThreatModel" title="1.7. Threat Model">Section 1.7, &#8220;Threat Model&#8221;</a> before you
        finish here.</p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="ThreatModel"></a>1.7. Threat Model</h3></div></div></div><p>In order to protect our asset well, we must first understand what
      we're protecting it against. The general idea is that you've got
      a laptop which is vulnerable to being stolen or lost, and have a USB
      flash drive on your keychain that isn't, so this system is designed
      to handle the case that your laptop is stolen. I'm guessing your
      keychain won't be as easily stolen because it's in your pocket,
      and because an attacker won't know that it's important. If you
      pull your USB flash drive out of your pocket and someone non-technical
      exclaims, "What's that?", tell them it's a <a class="ulink" href="http://www.pez.com/" target="_top">Pez dispenser</a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This system falls short when it comes to <em class="glossterm">plausible
        deniability</em>, which means there's no way to hide the
        fact that your personal data is encrypted. This is like locking your
        jewels in a safe and keeping the safe in plain sight in the middle of
        your living room. Only you can open the safe, but a man with a gun can
        tell you to open the safe for him. So if you're worried about your
        <a class="ulink" href="http://zdnet.com.com/2100-11-502433.html?legacy=zdnn" target="_top">computer
        being subpoenaed</a> and being told to hand over your laptop,
        keychain, and passphrase, you'd better look at other solutions
        such as <a class="ulink" href="http://stegfs.sourceforge.net/" target="_top">StegFS</a>.</p><p>The following solution to the deniability problem has been suggested by Norris Pouhovitch.
        It should be possible to install a minimal Windows partition at the front
        of the disk and to encrypt the remainder.  When the computer
        is turned on without the keychain, it boots Windows normally.  When the
        keychain is booted, it skips the Windows partition, decrypts the remainder of
        the disk, and boots Linux.</p><p>The advantage of this scheme is that if the laptop is stolen and turned
        on, it will look like what a casual attacker is expecting to see (a Windows
        computer).  On the other hand, a serious attacker could notice the unusually
        small partition and become suspicious.  I will flesh out this idea further in
        a future version of the HOWTO.</p></div><div class="table"><a name="Attack_Tree"></a><p class="title"><b>Table 1. Attack Tree</b></p><div class="table-contents"><table class="table" summary="Attack Tree" border="1"><colgroup><col class="A1"><col class="A2"><col class="A3"><col class="A4"><col align="center"><col></colgroup><thead><tr><th colspan="4" align="center">Attack</th><th align="center">Reaction</th><th align="center">Notes</th></tr></thead><tbody><tr valign="middle"><td rowspan="4" valign="middle">attacker steals laptop</td><td colspan="3" valign="middle">while it is on</td><td align="center" valign="middle"><a class="glossterm" href="#SOL"><em class="glossterm"><a class="glossterm" href="#SOL" title="SOL">SOL</a></em></a></td><td valign="middle">The asset is unprotected while the computer is running because the encryption key is in RAM.  You can lower the risk by using an idle logout (<a class="xref" href="#Idle_Logout" title="2.6.3. Idle Logout">Section 2.6.3, &#8220;Idle Logout&#8221;</a>), but if you think your laptop is about to be stolen, turn off the power immediately and quickly read the <a class="ulink" href="http://www.aikidofaq.com/" target="_top">Aikido HOWTO</a>.</td></tr><tr valign="middle"><td rowspan="3" valign="middle">while it is off</td><td colspan="2" valign="middle">attacker doesn't steal
              keychain</td><td align="center" valign="middle"><a class="glossterm" href="#new_key"><em class="glossterm"><a class="glossterm" href="#new_key" title="new key">new key</a></em></a></td><td class="auto-generated"> </td></tr><tr valign="middle"><td rowspan="2" valign="middle">attacker steals keychain</td><td valign="middle">attacker knows your passphrase</td><td align="center" valign="middle"><a class="glossterm" href="#SOL"><em class="glossterm"><a class="glossterm" href="#SOL" title="SOL">SOL</a></em></a></td><td class="auto-generated"> </td></tr><tr valign="middle"><td valign="middle">attacker doesn't know your passphrase</td><td align="center" valign="middle"><a class="glossterm" href="#new_key"><em class="glossterm"><a class="glossterm" href="#new_key" title="new key">new key</a></em></a></td><td class="auto-generated"> </td></tr><tr valign="middle"><td rowspan="3" valign="middle">attacker steals keychain but doesn't
              have laptop</td><td colspan="3" valign="middle">attacker knows passphrase</td><td align="center" valign="middle"><a class="glossterm" href="#new_key"><em class="glossterm"><a class="glossterm" href="#new_key" title="new key">new key</a></em></a></td><td valign="middle">Your asset is at risk because the attacker can decrypt
              it.</td></tr><tr valign="middle"><td rowspan="2" valign="middle">attacker doesn't know passphrase</td><td colspan="2" valign="middle">you're feeling lazy or
              you're convinced the keychain was lost, not stolen</td><td align="center" valign="middle"><a class="glossterm" href="#new_passphrase"><em class="glossterm"><a class="glossterm" href="#new_passphrase" title="new passphrase">new passphrase</a></em></a></td><td valign="middle">You're probably OK without changing the asset key
              because the attacker can't decrypt the asset without the
              passphrase.</td></tr><tr valign="middle"><td colspan="2" valign="middle">you're feeling paranoid</td><td align="center" valign="middle"><a class="glossterm" href="#new_key"><em class="glossterm"><a class="glossterm" href="#new_key" title="new key">new key</a></em></a></td><td class="auto-generated"> </td></tr><tr valign="middle"><td colspan="4" valign="middle">attacker convinces you to send
              data over network</td><td align="center" valign="middle"><a class="glossterm" href="#SOL"><em class="glossterm"><a class="glossterm" href="#SOL" title="SOL">SOL</a></em></a></td><td class="auto-generated"> </td></tr><tr valign="middle"><td colspan="4" valign="middle">attacker convinces you to copy
              data to removable medium</td><td align="center" valign="middle"><a class="glossterm" href="#SOL"><em class="glossterm"><a class="glossterm" href="#SOL" title="SOL">SOL</a></em></a></td><td class="auto-generated"> </td></tr><tr valign="middle"><td colspan="4" valign="middle">you encrypt only a partition and
              a process writes data to a different partition</td><td align="center" valign="middle"><a class="glossterm" href="#SOL"><em class="glossterm"><a class="glossterm" href="#SOL" title="SOL">SOL</a></em></a></td><td class="auto-generated"> </td></tr><tr valign="middle"><td colspan="4" valign="middle">you encrypt only a file and a
              process copies data from RAM to the unencrypted swap, or to a
              file in <code class="literal">/tmp</code>, or elsewhere on the unencrypted disk</td><td align="center" valign="middle"><a class="glossterm" href="#SOL"><em class="glossterm"><a class="glossterm" href="#SOL" title="SOL">SOL</a></em></a></td><td class="auto-generated"> </td></tr><tr valign="middle"><td colspan="4" valign="middle">attacker demands you hand over
              laptop, keychain, and passphrase while waving a rubber hose
              menacingly</td><td align="center" valign="middle"><a class="glossterm" href="#SOL"><em class="glossterm"><a class="glossterm" href="#SOL" title="SOL">SOL</a></em></a></td><td valign="middle">There is no plausible deniability built into the system.</td></tr></tbody></table></div></div><br class="table-break"><div class="glosslist"><a name="reactions"></a><dl><dt><a name="new_passphrase"></a><span class="glossterm">new passphrase</span></dt><dd class="glossdef"><p>Restore the keychain backup and choose a new passphrase.</p></dd><dt><a name="new_key"></a><span class="glossterm">new key</span></dt><dd class="glossdef"><p>Generate a new random key to re-encrypt the asset, choose a
            new passphrase, and restore the asset backup.</p></dd><dt><a name="SOL"></a><span class="glossterm"><acronym class="acronym">SOL</acronym></span></dt><dd class="glossdef"><p>Sorry Over your Loss</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Caveats"></a>1.8. Caveats</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>This method won't work (yet)
      with <a class="ulink" href="http://swsusp.sourceforge.net/" target="_top">Software Suspend for
      Linux</a>.</p></li><li class="listitem"><p>Encrypting the disk will
      undoubtedly slow it down. I don't know by how much. If anyone has
      done some benchmarks, please send them to me.</p></li><li class="listitem"><p>There
      is nothing in this method to support <em class="glossterm">plausible deniability</em>
      (see <a class="xref" href="#ThreatModel" title="1.7. Threat Model">Section 1.7, &#8220;Threat Model&#8221;</a>).</p></li><li class="listitem"><p>It
      won't prevent information leaks via networks and removable disks.</p></li><li class="listitem"><p>Encrypting
      backups is beyond the scope of this HOWTO.</p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Requirements"></a>1.9. Requirements</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>a computer with an easily accessible removable medium reader
          (such as a USB port or a CD-ROM drive)</p></li><li class="listitem"><p>a motherboard which supports booting from removable media
          (check carefully for USB, not all do)</p></li><li class="listitem"><p>removable medium (such as a <em class="glossterm">USB flash drive</em>)
          to be used as the <em class="glossterm">keychain</em></p></li><li class="listitem"><p><a class="ulink" href="http://www.kernel.org/" target="_top">Linux</a> 2.4</p></li><li class="listitem"><p><a class="ulink" href="http://sourceforge.net/projects/loop-aes/" target="_top">loop-AES</a></p></li></ul></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm257"></a>1.9.1. A Digression about USB Flash Drives</h4></div></div></div><p>There are many choices on the market. When I bought mine, I
        found one which fit the following requirements:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>physically small (I carry it on my physical keychain)</p></li><li class="listitem"><p>supports USB 2.0 at full speed</p></li><li class="listitem"><p>has a write-protect switch, so I don't clobber my
            encryption keys by accident</p></li></ul></div><p>You might be tempted to get one with a fingerprint reader. I
        strongly encourage you not to. It might initially seem like a good
        idea, because by adding the biometric, your security protection
        expands to:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>something you have (the USB flash drive)</p></li><li class="listitem"><p>something you know (the passphrase)</p></li><li class="listitem"><p>something you are (your fingerprint, or whatever)</p></li></ul></div><p>However, suppose something goes wrong. If you are now asking
        yourself, "What could go wrong?", then why are you reading
        this HOWTO? If something goes wrong, you make a change (see <a class="xref" href="#reactions">Corrective Reactions</a>):</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Change what you have by using a different USB flash drive.</p></li><li class="listitem"><p>Change what you know by learning a new passphrase.</p></li><li class="listitem"><p><span class="emphasis"><em>You can't change what you are.</em></span></p></li></ul></div><p>Stop and ponder that last line for a while.</p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="LookingToTheFuture"></a>1.10. Looking to the Future</h3></div></div></div><p>I wrote this document while using the 2.4 kernel.  Linux 2.6 introduces the <a class="ulink" href="http://sources.redhat.com/dm/" target="_top">Device-mapper</a> which we will be able to use to avoid playing games with
losetup offsets.  Linux 2.6 also introduces <a class="ulink" href="http://www.saout.de/misc/dm-crypt/" target="_top">dm-crypt</a>, an
encryption layer for the Device-mapper which looks quite elegant.  Unfortunately, <a class="ulink" href="http://mareichelt.de/pub/texts.cryptoloop.php" target="_top">it's not safe!</a>  Hopefully someday
it will be fixed, but in the mean time the best course is to stick with loop-AES.</p><p>A future version of this HOWTO will explain how to use the Device-mapper with Linux 2.6.</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Procedure"></a>2. Procedure</h2></div></div></div><p>This method is designed to erase the contents of the asset before
    encrypting it. If you already have data on the disk you intend to encrypt,
    you should copy it somewhere else temporarily and then move it back once
    the encryption is set up. It is possible to encrypt data in place, but for
    now I consider such magic too advanced for this HOWTO. See <a class="ulink" href="http://sourceforge.net/projects/loop-aes/" target="_top">loop-AES</a>'s
    <a class="ulink" href="http://loop-aes.sourceforge.net/loop-AES.README" target="_top">README</a>
    for more details if you're interested in that method.</p><p>To do the following operations you will need to be running a system
    which has a <a class="ulink" href="http://sourceforge.net/projects/loop-aes/" target="_top">loop-AES</a>
    capable kernel. If you don't have one already, I recommend using
    <a class="ulink" href="http://www.knoppix.com/" target="_top">KNOPPIX</a>. It boots off a
    CD-ROM and doesn't need to be installed, so it's very little
    hassle.</p><p>For simplicity these instructions assume you'll be preparing the
    keychain and the asset on the same computer, but this needn't be the
    case. Adapt the instructions to whatever's convenient for you.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="PrepareTheKeychain"></a>2.1. Prepare the Keychain</h3></div></div></div><p>If you're taking the approach of encrypting only a file
      instead of a disk or a partition, you may skip this section and proceed
      directly to <a class="xref" href="#PrepareTheAsset" title="2.2. Prepare the Asset">Section 2.2, &#8220;Prepare the Asset&#8221;</a>.</p><p>In the ideal setup you will use a bootable keychain device, such
      as a <em class="glossterm">USB flash drive</em> or a business card size
      CD-ROM. This is because we want to expose as little of your disk as
      possible, but we're going to have to expose a minimal boot process
      or the computer will never start. Since the boot process will be
      necessarily unencrypted, it's better to have it away from your
      computer (on your keychain). If you can't or don't want to use a
      bootable keychain for some reason, then follow these instructions anyway
      but instead apply them to a small boot partition on your disk instead of
      the keychain.</p><p>In the following example the keychain shows up as the first SCSI
	drive <code class="literal">/dev/sda</code>.  Replace <code class="literal">/dev/sda</code>
	with the device for your drive as appropriate.</p><p>The first step&#8212;zeroing out the keychain&#8212;is technically
	unnecessary, but it will make the keychain backup smaller if you back
	it up as an image as I suggest in <a class="xref" href="#TestingAndBackup" title="2.4. Testing and Backup">Section 2.4, &#8220;Testing and Backup&#8221;</a>.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>dd if=/dev/zero of=/dev/sda</code></strong></pre></blockquote></div><p>Next, partition the keychain as you would any bootable
      disk. See the <a class="ulink" href="http://www.tldp.org/HOWTO/Partition/index.html" target="_top">Linux Partition
      HOWTO</a> if you need help with partitioning.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>cfdisk /dev/sda</code></strong></pre></blockquote></div><p>Put a file system on the first partition.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>mkfs /dev/sda1</code></strong></pre></blockquote></div><p>Mount the keychain.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>mkdir /tmp/keychain</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>mount /dev/sda1 /tmp/keychain</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>cd /tmp/keychain</code></strong></pre></blockquote></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm337"></a>2.1.1. Build the Kernel</h4></div></div></div><p>If you use the keychain with multiple computers you may
        want to build a different kernel for each one.</p><p>You probably need to build a custom kernel for your keychain so
        you can ensure two things:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>It has been patched correctly with <a class="ulink" href="http://sourceforge.net/projects/loop-aes/" target="_top">loop-AES</a>
            and encryption support is turned on.</p></li><li class="listitem"><p>All the device drivers necessary to boot your computer and
            make the asset accessible have been compiled in instead of loaded
            as modules.</p></li></ul></div><p>You can load device drivers as modules, since we're using an
        initrd, but I chose to compile them into the kernel in order to keep
        the boot disk as simple as possible. Feel free to do differently.</p><p>For help building a custom kernel read <a class="ulink" href="http://www.tldp.org/HOWTO/Kernel-HOWTO/index.html" target="_top">The Linux
        Kernel HOWTO</a>. Be sure to set <code class="literal">CONFIG_BLK_DEV_RAM</code>
    in the kernel configuration so it can boot using an initrd.</p><p>Follow the directions that come with <a class="ulink" href="http://sourceforge.net/projects/loop-aes/" target="_top">loop-AES</a> to
        build the new loop driver.  Also follow the directions to rebuild
        the <a class="ulink" href="http://www.kernel.org/pub/linux/utils/util-linux/" target="_top">util-linux</a>
        tools, some of which we'll copy to the keychain later.  Your distribution may have
    already built them for you (e.g., see the <code class="literal">loop-aes-utils</code> and <code class="literal">loop-aes-source</code> packages in Debian).</p><p>Once you've built the kernel, copy it to the keychain.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>mkdir boot</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>cp arch/i386/boot/bzImage boot/vmlinuz-laptop</code></strong></pre></blockquote></div><p>Install <a class="ulink" href="http://www.gnu.org/software/grub/grub.html" target="_top">GRUB</a>
        or your favorite boot loader.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>grub-install --root-directory=. /dev/sda</code></strong></pre></blockquote></div><p>Here is a sample <code class="filename">menu.lst</code> for GRUB. It has
        entries for two computers named <code class="systemitem">laptop</code>
        and <code class="systemitem">desktop</code>.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>It is required to pass the name of the key (I suggest you name
          it after the computer) as the first parameter to <a class="xref" href="#linuxrc" title="Figure 2. /tmp/initrd/linuxrc">linuxrc</a>.</p></div><div class="example"><a name="idm376"></a><p class="title"><b>Example 1. <code class="filename">/tmp/keychain/boot/grub/menu.lst</code></b></p><div class="example-contents"><pre class="programlisting">title  laptop
root (hd0,0)
kernel /boot/vmlinuz-laptop root=/dev/ram0 init=/linuxrc laptop
initrd /boot/initrd
 
title  desktop
root (hd0,0)
kernel /boot/vmlinuz-desktop root=/dev/ram0 init=/linuxrc desktop
initrd /boot/initrd.old</pre></div></div><br class="example-break"></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm380"></a>2.1.2. Make the initrd</h4></div></div></div><p>We boot the keychain using an initrd so we can remove it after
the boot process starts (who wants a USB flash drive hanging out of
their laptop while trying to look cool in a café?). To gain access to
the asset we create a loopback device attached to the initrd's
<code class="filename">/dev/loop0</code>.  Putting the device file on the initrd
means the initrd will have to stay mounted while the asset is mounted (not a big deal).</p><p>To learn all about making initial RAM disks you're welcome
        to read <a class="ulink" href="http://www.tldp.org/HOWTO/Bootdisk-HOWTO/index.html" target="_top">The Linux
        Bootdisk HOWTO</a> and Linux's <a class="ulink" href="http://linux.bkbits.net:8080/linux-2.4/anno/Documentation/initrd.txt@1.2?nav=index.html%7Csrc/%7Csrc/Documentation" target="_top"><code class="filename">Documentation/initrd.txt,</code></a>
        or don't bother and just follow along.</p><p>We start by choosing 4MB for the size of the initial RAM disk,
        all of which we won't need, but it's the conventional maximum
        size (and it won't hurt) so that's one less decision to make.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>head -c 4m /dev/zero &gt; boot/initrd</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>mke2fs -F -m0 -b 1024 boot/initrd</code></strong></pre></blockquote></div><p>Mount the initrd so we can work on it.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>mkdir /tmp/initrd</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>mount -o loop=/dev/loop3 boot/initrd /tmp/initrd</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>cd /tmp/initrd</code></strong></pre></blockquote></div><p>Create the minimal directory structure we'll need.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>mkdir -p {bin,dev,lib,mnt/{keys,new-root},usr/sbin,sbin}</code></strong></pre></blockquote></div><p>Create the minimal set of devices we'll need. Note that
        <code class="filename">tty</code> is necessary for the password prompt. This
        command assumes your asset is the drive <code class="filename">/dev/hda</code>.
        Change it as appropriate.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>cp -a /dev/{console,hda,loop0,loop1,tty} dev</code></strong></pre></blockquote></div><p>We'll copy the six programs we'll need.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>You can use <code class="literal">which</code> to find a program's
          full pathname, e.g.:</p><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>which mount</code></strong>
<code class="computeroutput">/bin/mount</code></pre></div><p>Copy the programs:</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>cp /bin/{mount,sh,umount} bin</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>cp /sbin/{losetup,pivot_root} sbin</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>cp /usr/sbin/chroot usr/sbin</code></strong></pre></blockquote></div><p>Use <code class="literal">ldd</code> to find out which shared libraries are
          used by each program:</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>ldd /bin/{mount,sh,umount} /sbin/{losetup,pivot_root} /usr/sbin/chroot</code></strong>
<code class="computeroutput">/bin/mount:
        libc.so.6 =&gt; /lib/libc.so.6 (0x40023000)
        /lib/ld-linux.so.2 =&gt; /lib/ld-linux.so.2 (0x40000000)
/bin/sh:
        libncurses.so.5 =&gt; /lib/libncurses.so.5 (0x40020000)
        libdl.so.2 =&gt; /lib/libdl.so.2 (0x4005c000)
        libc.so.6 =&gt; /lib/libc.so.6 (0x4005f000)
        /lib/ld-linux.so.2 =&gt; /lib/ld-linux.so.2 (0x40000000)
/bin/umount:
        libc.so.6 =&gt; /lib/libc.so.6 (0x40023000)
        /lib/ld-linux.so.2 =&gt; /lib/ld-linux.so.2 (0x40000000)
/sbin/losetup:
        libc.so.6 =&gt; /lib/libc.so.6 (0x40023000)
        /lib/ld-linux.so.2 =&gt; /lib/ld-linux.so.2 (0x40000000)
/sbin/pivot_root:
        libc.so.6 =&gt; /lib/libc.so.6 (0x40023000)
        /lib/ld-linux.so.2 =&gt; /lib/ld-linux.so.2 (0x40000000)
/usr/sbin/chroot:
        libc.so.6 =&gt; /lib/libc.so.6 (0x40023000)
        /lib/ld-linux.so.2 =&gt; /lib/ld-linux.so.2 (0x40000000)</code>
</pre></blockquote></div><p>Copy the libraries.  On my system I copied these libraries (yours may be different):</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>cp /lib/{ld-linux.so.2,libc.so.6,libdl.so.2,libncurses.so.5} lib</code></strong></pre></blockquote></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="PrepareTheAsset"></a>2.2. Prepare the Asset</h3></div></div></div><p>It's possible to repeat these steps as many times as you want
      to handle multiple computers using the same keychain. Each computer will
      have its own key and probably its own kernel. The instructions here
      assume the computer's name is <code class="systemitem">laptop</code>;
      substitute the name of the computer you're working with each time
      you repeat the steps.</p><p>First, back up your data. See the <a class="ulink" href="http://www.tldp.org/HOWTO/Linux-Complete-Backup-and-Recovery-HOWTO/index.html" target="_top">Linux
      Complete Backup and Recovery HOWTO</a>.</p><p>No, stop, listen to me. Back up your data. Really. It's no fun
      to have an encrypted hard disk if you can't decrypt it because of
      some mistake you made. These tools are powerful magic; if you blow it
      you can't just call up <span class="emphasis"><em>Computer Gurus Are Us</em></span>
      and expect them to get your data back for you. That's the whole
      point of this exercise.</p><p>If you are encrypting your whole disk (recommended), replace
      <code class="filename">/dev/hda</code> with the device for your disk.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>ln -s /dev/hda /tmp/asset</code></strong></pre></blockquote></div><p>If you are encrypting a partition (multiboot case), replace
      <code class="filename">/dev/hda3</code> with the device for your partition.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>ln -s /dev/hda3 /tmp/asset</code></strong></pre></blockquote></div><p>If you are encrypting a file only, replace <code class="filename">~/encrypted</code>
      with the name of the file and create a link named <code class="filename">/tmp/keychain</code>
      that points to where you decide to store your key file (an already
      prepared removable medium, e.g., <code class="filename">/mnt/cf</code>).</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>ln -s ~/encrypted /tmp/asset</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>ln -s /mnt/cf /tmp/keychain</code></strong></pre></blockquote></div><p>Initialize the asset with random data. This will make it less
      obvious to the attacker which parts are free space.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>shred -n 1 -v /tmp/asset</code></strong></pre></blockquote></div><p>Here we create an encrypted file system to hold the keys. More
      encryption, you say? Yes, in case your keychain is stolen (see <a class="xref" href="#Attack_Tree" title="Table 1. Attack Tree">Table 1, &#8220;Attack Tree&#8221;</a>), you don't want your keys to be exposed. I
      chose one megabyte as the size of the file system because it's a
      round number. There's no way we're going to need that much space
      for keys so feel free to chose a smaller size if you like (each key file
      will be 61 bytes long).</p><p>Again, initialize with random data.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>cd /tmp/initrd</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>head -c 1m /dev/urandom &gt; keys</code></strong></pre></blockquote></div><p>To make the passphrase resistant to dictionary attacks we'll
      generate a seed. Whenever you see the symbol <em class="replaceable"><code>&lt;seed&gt;</code></em>
      be sure to replace it with the one you generated. The following command
      will display a random seed on the screen.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>head -c 15 /dev/random | uuencode -m - | head -2 | tail -1</code></strong></pre></blockquote></div><p>Set up the loopback device using the seed. This is where you
      choose your passphrase, which must be at least 20 characters in length. Choose one with care that you know you won't forget.  You may want to use the <a class="ulink" href="http://world.std.com/~reinhold/diceware.html" target="_top">Diceware method</a> for choosing a secure passphrase.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>losetup -e AES128 -C 100 -S <em class="replaceable"><code>&lt;seed&gt;</code></em> -T /dev/loop1 keys</code></strong></pre></blockquote></div><p>Format and mount the keys file system (the <a class="xref" href="#decrypt.sh" title="Figure 1. /tmp/initrd/decrypt.sh">decrypt.sh</a> script assumes you use the <code class="literal">ext2</code>
      file system here).</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>mke2fs /dev/loop1</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>mkdir /tmp/keys</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>mount /dev/loop1 /tmp/keys</code></strong></pre></blockquote></div><p>Now for the actual asset key, 45 bytes as random as your computer
      can make them. Try a dictionary attack against that, attacker! Ha! We
      name the key after the computer with which it will be used (<code class="systemitem">laptop</code>). Substitute the name of your
      computer instead.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>head -c 45 /dev/random | uuencode -m - | head -2 | tail -1 &gt; /tmp/keys/laptop</code></strong></pre></blockquote></div><p>Set up a loopback device with the key for encrypted access to the
      asset.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>losetup -e AES128 -p 0 /dev/loop0 /tmp/asset &lt; /tmp/keys/laptop</code></strong></pre></blockquote></div><p>Unmount the keys file system.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>umount /tmp/keys</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>losetup -d /dev/loop1</code></strong></pre></blockquote></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm531"></a>2.2.1. Swap Partition</h4></div></div></div><p>Skip this section if you're encrypting only a file.</p><p>It's critical to give <code class="literal">mkswap</code> a size
        parameter here because we're not handing it a dedicated partition.
        Choose whatever size you want; I chose 2GB.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>mkswap /dev/loop0 $((2*1024*1024))</code></strong>
<code class="computeroutput">mkswap: warning: truncating swap area to 2097144kB
Setting up swapspace version 1, size = 2147471360 bytes</code></pre></blockquote></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm541"></a>2.2.2. Root File System</h4></div></div></div><p>If you're encrypting only a file, format it with a file
        system like this and skip to <a class="xref" href="#Scripts" title="2.3. Scripts">Section 2.3, &#8220;Scripts&#8221;</a>.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>mkfs /dev/loop0</code></strong></pre></blockquote></div><p>We'll create the root "partition" after the swap
        space. I put the word 'partition' in quotes because it's
        not a real partition. We're faking it using the offset argument of
        <code class="literal">losetup</code>.</p><p>Notice how <code class="literal">mkswap</code> told us the actual size of
        the swapspace, which is not necessarily the size requested. Use the
        actual size (which was 2147471360 in the above example) when
        specifying the offset to begin the root file system.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>losetup -o <em class="replaceable"><code>&lt;root offset&gt;</code></em> /dev/loop1 /dev/loop0</code></strong></pre></blockquote></div><p>If the asset is the whole disk or the last partition on the
        disk, then we needn't worry about specifying a size for the file
        system. If this applies to you, do the following and skip to <a class="xref" href="#initrd_Mount_Point" title="2.2.2.1. initrd Mount Point">Section 2.2.2.1, &#8220;initrd Mount Point&#8221;</a>.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>mkfs /dev/loop1</code></strong></pre></blockquote></div><p>Since the asset isn't the last partition on the disk, we
        must give <code class="literal">mkfs</code> a size limitation or it will write
        all over whatever partitions are between this one and the end of the
        disk. I repeat, <span class="emphasis"><em>if you don't give <code class="literal">mkfs</code>
        the correct size parameter here, you may lose data</em></span>.
        <code class="literal">mkfs</code> is actually just a front end, so to be as
        careful as possible we'll choose an actual file system maker, in
        this case <code class="literal">mke2fs</code>.</p><p>It's possible to limit the size of the file system by
        specifying its size in blocks, but <code class="literal">mke2fs</code> chooses
        the block size based on the size of the file system. A classic
        Catch-22! We can ask it to do a dry run on the rest of the disk (more
        than we want) to see what block size it would chose.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>mke2fs -n -j /dev/loop1</code></strong>
<code class="computeroutput">mke2fs 1.34-WIP (21-May-2003)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
9781248 inodes, 19544448 blocks
977222 blocks (5.00%) reserved for the super user
First data block=0
597 block groups
32768 blocks per group, 32768 fragments per group
16384 inodes per group
Superblock backups stored on blocks:
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
        4096000, 7962624, 11239424</code></pre></blockquote></div><p>In this case it chose 4096. Whatever it chooses is probably
        close enough for our file system. Calculate the correct size in
        blocks.</p><div class="blockquote"><blockquote class="blockquote"><p>file system size = (size of partition &#8722; size of swap space) ÷
          block size</p></blockquote></div><p>Suppose the size of the partition is 10GB and the size of the
        swap is 2GB. The correct size for <code class="literal">mke2fs</code> is (10 &#8722;
        2) × 2<sup>30</sup> ÷ 4096 = 2097152. Don't get this wrong! Make backups!
        Measure twice, cut once!</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>mke2fs -j /dev/loop1 2097152</code></strong></pre></blockquote></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="initrd_Mount_Point"></a>2.2.2.1. initrd Mount Point</h5></div></div></div><p>Mount the new root file system and create the
          <code class="filename">initrd</code> mount point. This is necessary for the
          <a class="xref" href="#linuxrc" title="Figure 2. /tmp/initrd/linuxrc">linuxrc</a> script's call to <code class="literal">pivot_root</code>.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>mount /dev/loop1 mnt/new-root</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>mkdir mnt/new-root/initrd</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>umount mnt/new-root</code></strong></pre></blockquote></div></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Scripts"></a>2.3. Scripts</h3></div></div></div><p>We have enough information to create the decryption script. Change
      the variables at the beginning to reflect your setup (including the seed
      you generated earlier).</p><p>If you're encrypting the whole disk or a partition, set
      <code class="varname">ROOT_OFFSET</code> to the size you got from
      <code class="literal">mkswap</code>. Put the script in <code class="filename">/tmp/initrd</code>
      and name it <code class="filename">decrypt.sh</code>.</p><p>If you're encrypting only a file then this script can live
      anywhere. In this case be sure to set <code class="varname">ROOT_OFFSET</code> to
      zero and set <code class="varname">MOUNT</code> to a convenient mount point
      (probably not <code class="filename">/mnt/new-root</code>).</p><div class="figure"><a name="decrypt.sh"></a><p class="title"><b>Figure 1. <code class="filename">/tmp/initrd/decrypt.sh</code></b></p><div class="figure-contents"><pre class="programlisting">#!/bin/sh

SEED=<em class="replaceable"><code>&lt;seed&gt;</code></em>
ASSET=/dev/hda
ROOT_OFFSET=<em class="replaceable"><code>&lt;root offset&gt;</code></em>
ROOT_TYPE=ext3
MOUNT=/mnt/new-root
KEY="$1"

# Ask for a passphrase to open the keys (this prevents exposure of the keys in
# case the owner loses the keychain).  Give the user three tries to get the
# passphrase right.
for ((FAILED=1, TRY=1; ($FAILED != 0) &amp;&amp; (TRY &lt;= 3); TRY++))
do
        mount -n -t ext2 -o loop=/dev/loop1,encryption=AES128,itercountk=100,pseed=$SEED keys /mnt/keys
        FAILED=$?
done
                                                                                
if [ $FAILED -ne 0 ]; then
        echo "Sorry, you get only three attempts to guess the password."
        exit 1
fi

# Use the key to decrypt the asset.
losetup -e AES128 -p 0 /dev/loop0 $ASSET &lt; "/mnt/keys/$KEY"
 
# Close the keys.
umount -n /mnt/keys
losetup -d /dev/loop1
 
# Set up the root "partition" device.
losetup -o $ROOT_OFFSET /dev/loop1 /dev/loop0
 
# Mount the root file system (read-only, so it can be checked with fsck).
mount -n -r -t $ROOT_TYPE /dev/loop1 $MOUNT</pre></div></div><br class="figure-break"><p>Make the script executable.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>chmod +x decrypt.sh</code></strong></pre></blockquote></div><p>If you're encrypting only a file, skip to <a class="xref" href="#TestingAndBackup" title="2.4. Testing and Backup">Section 2.4, &#8220;Testing and Backup&#8221;</a>. Otherwise, save the following boot
      script as <code class="filename">linuxrc</code> and place it in
      <code class="filename">/tmp/initrd</code>.</p><div class="figure"><a name="linuxrc"></a><p class="title"><b>Figure 2. <code class="filename">/tmp/initrd/linuxrc</code></b></p><div class="figure-contents"><pre class="programlisting">#!/bin/sh

# Decrypt the asset
source decrypt.sh "$1"

# Pivot to the asset's root file system.
cd $MOUNT
/sbin/pivot_root . initrd

# Pass control to init.
shift 1
exec chroot . /sbin/init $* &lt;dev/console &gt;dev/console 2&gt;&amp;1</pre></div></div><br class="figure-break"><p>Make the script executable.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>chmod +x linuxrc</code></strong></pre></blockquote></div><p>Okay, the keychain and asset are now ready. Unmount everything.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>umount /tmp/{initrd,keychain}</code></strong></pre></blockquote></div><p>You now have an empty, encrypted file system. Hurray!</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="TestingAndBackup"></a>2.4. Testing and Backup</h3></div></div></div><p>Test your system by booting the keychain or executing the <a class="xref" href="#decrypt.sh" title="Figure 1. /tmp/initrd/decrypt.sh">decrypt.sh</a> script as appropriate (give it the name of the
      key you want to use as a parameter). After booting there may be a
      complaint about a nonexistent <code class="filename">/sbin/init</code> but
      that's okay for now.</p><p>Check to make sure your root file system mounted successfully.
      When you're confident everything is working, back up your keychain.
      In fact, make lots of backups. You might ask, "But isn't it
      insecure to have a copy of my keychain somewhere?" The answer is
      yes, it is, but not as insecure as losing your only keychain, if you
      define security as also meaning "securing access to my data".</p><p>Because my keychain is small I decided to back up the whole image
      so it's easy to restore:</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>bzip2 -c /dev/sda &gt; keychain.img.bz2</code></strong></pre></blockquote></div><p>If you're encrypting only a file, you can pat yourself on your
      back at this point because you've finished.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RescueDisk"></a>2.5. Rescue Disk</h3></div></div></div><p>Rescue disks are useful when a system isn't behaving properly
      and/or refuses to boot. Check to make sure your rescue disk has <a class="ulink" href="http://sourceforge.net/projects/loop-aes/" target="_top">loop-AES</a> support
      in its kernel and has the correctly patched <span class="application"><a class="ulink" href="http://www.kernel.org/pub/linux/utils/util-linux/" target="_top">util-linux</a></span>
      tools such as <code class="literal">losetup</code> and <code class="literal">mount</code>,
      otherwise it will be worthless with your newly encrypted asset. In the
      future, all rescue disks will include this support because it will come
      standard with the 2.6 kernel. In the meantime, <a class="ulink" href="http://www.knoppix.com/" target="_top">KNOPPIX</a> (for example) already has
      all the necessary support and can be used as a rescue disk.</p><p>After booting an appropriate rescue disk, mount your keychain and
      execute the <a class="xref" href="#decrypt.sh" title="Figure 1. /tmp/initrd/decrypt.sh">decrypt.sh</a> script.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>mkdir /tmp/{keychain,initrd}</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>mount /dev/sda1 /tmp/keychain</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>mount -o loop=/dev/loop3 /tmp/keychain/boot/initrd /tmp/initrd</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>pushd /tmp/initrd</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>./decrypt.sh laptop</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>popd</code></strong>
<code class="prompt">bash# </code><strong class="userinput"><code>umount /tmp/{initrd,keychain}</code></strong></pre></blockquote></div><p>You can now access your asset through the mount point you
      specified in <a class="xref" href="#decrypt.sh" title="Figure 1. /tmp/initrd/decrypt.sh">decrypt.sh</a>.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="InstallingLinux"></a>2.6. Installing Linux</h3></div></div></div><p>Your final task is to install Linux to your new encrypted file system.  As you do this make sure the entries in your <code class="filename">/etc/fstab</code> for the root and swap look like those below:</p><div class="informalexample"><pre class="programlisting"># /etc/fstab: static file system information.
#
# &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;               &lt;dump&gt;  &lt;pass&gt;
/dev/loop0      none            swap    sw                      0       0
/dev/loop1      /               ext3    errors=remount-ro       0       1</pre></div><p>If you already have an installation elsewhere, read the <a class="ulink" href="http://www.tldp.org/HOWTO/Hard-Disk-Upgrade/" target="_top">Hard Disk Upgrade
      Mini How-To</a> to learn how to copy it over.</p><p>The procedure for a fresh installation of Linux is different for
      each distribution.  Please send me
      instructions for distributions not listed below and I will include them here.</p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm693"></a>2.6.1. <a class="ulink" href="http://www.debian.org" target="_top">Debian</a></h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Boot from a rescue disk by following the instructions in <a class="xref" href="#RescueDisk" title="2.5. Rescue Disk">Section 2.5, &#8220;Rescue Disk&#8221;</a>.</p></li><li class="listitem"><p>Install using the method <a class="ulink" href="http://www.debian.org/releases/stable/i386/ch-preparing.en.html#s-linux-upgrade" target="_top">3.7
            Installing Debian GNU/Linux from a Unix/Linux System</a>.</p></li></ol></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm703"></a>2.6.2. <a class="ulink" href="http://www.gentoo.org/" target="_top">Gentoo</a></h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Boot from a rescue disk (Gentoo's Live CD 1.4 won't work) by following the instructions in <a class="xref" href="#RescueDisk" title="2.5. Rescue Disk">Section 2.5, &#8220;Rescue Disk&#8221;</a>.</p></li><li class="listitem"><p>Activate the swap partition if you created one.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>swapon /dev/loop0</code></strong></pre></blockquote></div></li><li class="listitem"><p>Point <code class="filename">/mnt/gentoo</code> to the root file system.</p><div class="blockquote"><blockquote class="blockquote"><pre class="screen"><code class="prompt">bash# </code><strong class="userinput"><code>ln -s new-root /mnt/gentoo</code></strong></pre></blockquote></div></li><li class="listitem"><p>Skip to <a class="ulink" href="http://www.gentoo.org/doc/en/gentoo-x86-install.xml#doc_chap8" target="_top">Chapter 8. Stage tarballs and chroot</a> in the <a class="ulink" href="http://www.gentoo.org/doc/en/gentoo-x86-install.xml" target="_top">Gentoo Linux 1.4 Installation Instructions</a>.</p></li></ol></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="Idle_Logout"></a>2.6.3. Idle Logout</h4></div></div></div><p>Once your system is up and running, consider configuring it to log out automatically after a period of inactivity.  This will lessen (but not eliminate) the risk of exposing your asset if the laptop is stolen while on (see <a class="xref" href="#Attack_Tree" title="Table 1. Attack Tree">Table 1, &#8220;Attack Tree&#8221;</a>).</p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="MoreInformation"></a>3. More Information</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="filename"><a class="ulink" href="http://loop-aes.sourceforge.net/loop-AES.README" target="_top">README</a></code>
        that comes with <span class="application"><a class="ulink" href="http://sourceforge.net/projects/loop-aes/" target="_top">loop-AES</a></span>
        explains how to use it in multiple scenarios.</p></li><li class="listitem"><p><a class="ulink" href="http://www.tldp.org/HOWTO/Encrypted-Root-Filesystem-HOWTO/" target="_top">Encrypted Root Filesystem HOWTO</a></p></li><li class="listitem"><p>The <a class="ulink" href="http://www.gentoo.org/proj/en/hardened/" target="_top">Hardened Gentoo Project</a>'s <a class="ulink" href="http://www.sdc.org/~leila/usb-dongle/readme.html" target="_top">A Structured Approach to Hard Disk Encryption</a> is more comprehensive and is targeted to <a class="ulink" href="http://www.gentoo.org/" target="_top">Gentoo</a> users.</p></li></ul></div></div><div class="glossary"><div class="titlepage"><div><div><h2 class="title"><a name="Glossary"></a>Glossary</h2></div></div></div><dl><dt><span class="glossterm"><acronym class="acronym"><a class="ulink" href="http://csrc.nist.gov/CryptoToolkit/aes/" target="_top">AES</a></acronym></span></dt><dd class="glossdef"><p>Advanced Encryption Standard, a strong, well-regarded
        <em class="glossterm">encryption</em> algorithm chosen by the United
        States <a class="ulink" href="http://www.nist.gov/" target="_top">National Institute of
        Standards and Technology</a></p></dd><dt><span class="glossterm">asset</span></dt><dd class="glossdef"><p>the data being protected by <em class="glossterm">encryption</em>&#8212;either
        a disk, partition, or a file</p></dd><dt><span class="glossterm">encryption</span></dt><dd class="glossdef"><p>a mathematical means of scrambling data so that it's
        unintelligible unless decrypted using a specific
        <em class="glossterm">key</em></p></dd><dt><span class="glossterm">key</span></dt><dd class="glossdef"><p>the small piece of data necessary to make encrypted data
        intelligible</p></dd><dt><a name="keychain"></a><span class="glossterm">keychain</span></dt><dd class="glossdef"><p>the physical medium (such as a <em class="glossterm">USB flash drive)
        </em>used to hold the encryption <em class="glossterm">key</em>
        (and possibly the beginning of the boot process)</p></dd><dt><span class="glossterm">loopback device</span></dt><dd class="glossdef"><p>a Linux block device which appears to store data (by using
        another device)</p></dd><dt><span class="glossterm"><a class="ulink" href="http://sourceforge.net/projects/loop-aes/" target="_top">loop-AES</a></span></dt><dd class="glossdef"><p>software written by Jari Ruusu that implements the
        <em class="glossterm">AES</em> algorithm using a <em class="glossterm">loopback
        device</em></p></dd><dt><span class="glossterm">plausible deniability</span></dt><dd class="glossdef"><p>a means to avoid being coerced into decrypting one's own
        data for an attacker</p></dd><dt><span class="glossterm">USB flash drive</span></dt><dd class="glossdef"><p>a small electronic device containing a memory chip and a USB
        interface</p></dd></dl></div><div class="appendix"><h2 class="title" style="clear: both"><a name="gfdl"></a>A. GNU Free Documentation License</h2><div class="blockquote"><a name="fsf-copyright"></a><blockquote class="blockquote"><p>Copyright (C) 2000,2001,2002 Free Software Foundation, Inc. 59
      Temple Place, Suite 330, Boston, MA 02111-1307 USA Everyone is permitted
      to copy and distribute verbatim copies of this license document, but
      changing it is not allowed.</p></blockquote></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gfdl-0"></a>1. PREAMBLE</h2></div></div></div><p>The purpose of this License is to make a manual, textbook, or
      other functional and useful document "free" in the sense of
      freedom: to assure everyone the effective freedom to copy and
      redistribute it, with or without modifying it, either commercially or
      noncommercially. Secondarily, this License preserves for the author and
      publisher a way to get credit for their work, while not being considered
      responsible for modifications made by others.</p><p>This License is a kind of "copyleft", which means that
      derivative works of the document must themselves be free in the same
      sense. It complements the GNU General Public License, which is a
      copyleft license designed for free software.</p><p>We have designed this License in order to use it for manuals for
      free software, because free software needs free documentation: a free
      program should come with manuals providing the same freedoms that the
      software does. But this License is not limited to software manuals; it
      can be used for any textual work, regardless of subject matter or
      whether it is published as a printed book. We recommend this License
      principally for works whose purpose is instruction or reference.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gfdl-1"></a>2. APPLICABILITY AND DEFINITIONS</h2></div></div></div><p><a name="gfdl-doc"></a>This License applies to any manual or other work, in
      any medium, that contains a notice placed by the copyright holder saying
      it can be distributed under the terms of this License. Such a notice
      grants a world-wide, royalty-free license, unlimited in duration, to use
      that work under the conditions stated herein. The "Document",
      below, refers to any such manual or work. Any member of the public is a
      licensee, and is addressed as "you". You accept the license if
      you copy, modify or distribute the work in a way requiring permission
      under copyright law.</p><p><a name="gfdl-mod-ver"></a>A "Modified Version" of the Document
      means any work containing the Document or a portion of it, either copied
      verbatim, or with modifications and/or translated into another language.</p><p><a name="gfdl-secnd-sect"></a>A "Secondary Section" is a named
      appendix or a front-matter section of the Document that deals
      exclusively with the relationship of the publishers or authors of the
      Document to the Document's overall subject (or to related matters)
      and contains nothing that could fall directly within that overall
      subject. (Thus, if the Document is in part a textbook of mathematics, a
      Secondary Section may not explain any mathematics.) The relationship
      could be a matter of historical connection with the subject or with
      related matters, or of legal, commercial, philosophical, ethical or
      political position regarding them.</p><p><a name="gfdl-inv-sect"></a>The "Invariant Sections" are certain
      Secondary Sections whose titles are designated, as being those of
      Invariant Sections, in the notice that says that the Document is
      released under this License. If a section does not fit the above
      definition of Secondary then it is not allowed to be designated as
      Invariant. The Document may contain zero Invariant Sections. If the
      Document does not identify any Invariant Sections then there are none.</p><p><a name="gfdl-cov-text"></a>The "Cover Texts" are certain short
      passages of text that are listed, as Front-Cover Texts or Back-Cover
      Texts, in the notice that says that the Document is released under this
      License. A Front-Cover Text may be at most 5 words, and a Back-Cover
      Text may be at most 25 words.</p><p><a name="gfdl-transparent"></a>A "Transparent" copy of the Document
      means a machine-readable copy, represented in a format whose
      specification is available to the general public, that is suitable for
      revising the document straightforwardly with generic text editors or
      (for images composed of pixels) generic paint programs or (for drawings)
      some widely available drawing editor, and that is suitable for input to
      text formatters or for automatic translation to a variety of formats
      suitable for input to text formatters. A copy made in an otherwise
      Transparent file format whose markup, or absence of markup, has been
      arranged to thwart or discourage subsequent modification by readers is
      not Transparent. An image format is not Transparent if used for any
      substantial amount of text. A copy that is not "Transparent" is
      called "Opaque".</p><p>Examples of suitable formats for Transparent copies include plain
      ASCII without markup, Texinfo input format, LaTeX input format, SGML or
      XML using a publicly available DTD, and standard-conforming simple HTML,
      PostScript or PDF designed for human modification. Examples of
      transparent image formats include PNG, XCF and JPG. Opaque formats
      include proprietary formats that can be read and edited only by
      proprietary word processors, SGML or XML for which the DTD and/or
      processing tools are not generally available, and the machine-generated
      HTML, PostScript or PDF produced by some word processors for output
      purposes only.</p><p><a name="gfdl-title-page"></a>The "Title Page" means, for a printed
      book, the title page itself, plus such following pages as are needed to
      hold, legibly, the material this License requires to appear in the title
      page. For works in formats which do not have any title page as such,
      "Title Page" means the text near the most prominent appearance
      of the work's title, preceding the beginning of the body of the
      text.</p><p><a name="gfdl-entitled"></a>A section "Entitled XYZ" means a named
      subunit of the Document whose title either is precisely XYZ or contains
      XYZ in parentheses following text that translates XYZ in another
      language. (Here XYZ stands for a specific section name mentioned below,
      such as "Acknowledgements", "Dedications",
      "Endorsements", or "History".) To "Preserve the
      Title" of such a section when you modify the Document means that it
      remains a section "Entitled XYZ" according to this definition.</p><p>The Document may include Warranty Disclaimers next to the notice
      which states that this License applies to the Document. These Warranty
      Disclaimers are considered to be included by reference in this License,
      but only as regards disclaiming warranties: any other implication that
      these Warranty Disclaimers may have is void and has no effect on the
      meaning of this License.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gfdl-2"></a>3. VERBATIM COPYING</h2></div></div></div><p>You may copy and distribute the Document in any medium, either
      commercially or noncommercially, provided that this License, the
      copyright notices, and the license notice saying this License applies to
      the Document are reproduced in all copies, and that you add no other
      conditions whatsoever to those of this License. You may not use
      technical measures to obstruct or control the reading or further copying
      of the copies you make or distribute. However, you may accept
      compensation in exchange for copies. If you distribute a large enough
      number of copies you must also follow the conditions in section 3.</p><p>You may also lend copies, under the same conditions stated above,
      and you may publicly display copies.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gfdl-3"></a>4. COPYING IN QUANTITY</h2></div></div></div><p>If you publish printed copies (or copies in media that commonly
      have printed covers) of the Document, numbering more than 100, and the
      Document's license notice requires Cover Texts, you must enclose the
      copies in covers that carry, clearly and legibly, all these Cover Texts:
      Front-Cover Texts on the front cover, and Back-Cover Texts on the back
      cover. Both covers must also clearly and legibly identify you as the
      publisher of these copies. The front cover must present the full title
      with all words of the title equally prominent and visible. You may add
      other material on the covers in addition. Copying with changes limited
      to the covers, as long as they preserve the title of the Document and
      satisfy these conditions, can be treated as verbatim copying in other
      respects.</p><p>If the required texts for either cover are too voluminous to fit
      legibly, you should put the first ones listed (as many as fit
      reasonably) on the actual cover, and continue the rest onto adjacent
      pages.</p><p>If you publish or distribute Opaque copies of the Document
      numbering more than 100, you must either include a machine-readable
      Transparent copy along with each Opaque copy, or state in or with each
      Opaque copy a computer-network location from which the general
      network-using public has access to download using public-standard
      network protocols a complete Transparent copy of the Document, free of
      added material. If you use the latter option, you must take reasonably
      prudent steps, when you begin distribution of Opaque copies in quantity,
      to ensure that this Transparent copy will remain thus accessible at the
      stated location until at least one year after the last time you
      distribute an Opaque copy (directly or through your agents or retailers)
      of that edition to the public.</p><p>It is requested, but not required, that you contact the authors of
      the Document well before redistributing any large number of copies, to
      give them a chance to provide you with an updated version of the
      Document.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gfdl-4"></a>5. MODIFICATIONS</h2></div></div></div><p>You may copy and distribute a Modified Version of the Document
      under the conditions of sections 2 and 3 above, provided that you
      release the Modified Version under precisely this License, with the
      Modified Version filling the role of the Document, thus licensing
      distribution and modification of the Modified Version to whoever
      possesses a copy of it. In addition, you must do these things in the
      Modified Version:</p><div class="orderedlist"><a name="gfdl-modif-cond"></a><ol class="orderedlist" type="A"><li class="listitem">Use in the Title Page (and on the covers, if any) a title
          distinct from that of the Document, and from those of previous
          versions (which should, if there were any, be listed in the History
          section of the Document). You may use the same title as a previous
          version if the original publisher of that version gives permission.</li><li class="listitem">List on the Title Page, as authors, one or more persons or
          entities responsible for authorship of the modifications in the
          Modified Version, together with at least five of the principal
          authors of the Document (all of its principal authors, if it has
          fewer than five), unless they release you from this requirement.</li><li class="listitem">State on the Title page the name of the publisher of the
          Modified Version, as the publisher.</li><li class="listitem">Preserve all the copyright notices of the Document.</li><li class="listitem">Add an appropriate copyright notice for your modifications
          adjacent to the other copyright notices.</li><li class="listitem">Include, immediately after the copyright notices, a license
          notice giving the public permission to use the Modified Version
          under the terms of this License, in the form shown in the <a class="link" href="#gfdl-addendum" title="12. ADDENDUM: How to use this License for your documents">Addendum</a> below.</li><li class="listitem">Preserve in that license notice the full lists of Invariant
          Sections and required Cover Texts given in the Document's
          license notice.</li><li class="listitem">Include an unaltered copy of this License.</li><li class="listitem">Preserve the section Entitled "History", Preserve
          its Title, and add to it an item stating at least the title, year,
          new authors, and publisher of the Modified Version as given on the
          Title Page. If there is no section Entitled "History" in the
          Document, create one stating the title, year, authors, and publisher
          of the Document as given on its Title Page, then add an item
          describing the Modified Version as stated in the previous sentence.</li><li class="listitem">Preserve the network location, if any, given in the
          Document for public access to a Transparent copy of the Document,
          and likewise the network locations given in the Document for
          previous versions it was based on. These may be placed in the
          "History" section. You may omit a network location for a
          work that was published at least four years before the Document
          itself, or if the original publisher of the version it refers to
          gives permission.</li><li class="listitem">For any section Entitled "Acknowledgements" or
          "Dedications", Preserve the Title of the section, and
          preserve in the section all the substance and tone of each of the
          contributor acknowledgements and/or dedications given therein.</li><li class="listitem">Preserve all the Invariant Sections of the Document,
          unaltered in their text and in their titles. Section numbers or the
          equivalent are not considered part of the section titles.</li><li class="listitem">Delete any section Entitled "Endorsements". Such a
          section may not be included in the Modified Version.</li><li class="listitem">Do not retitle any existing section to be Entitled
          "Endorsements" or to conflict in title with any Invariant
          Section.</li><li class="listitem">Preserve any Warranty Disclaimers.</li></ol></div><p>If the Modified Version includes new front-matter sections or
      appendices that qualify as Secondary Sections and contain no material
      copied from the Document, you may at your option designate some or all
      of these sections as invariant. To do this, add their titles to the list
      of Invariant Sections in the Modified Version's license notice.
      These titles must be distinct from any other section titles.</p><p>You may add a section Entitled "Endorsements", provided it
      contains nothing but endorsements of your Modified Version by various
      parties--for example, statements of peer review or that the text has
      been approved by an organization as the authoritative definition of a
      standard.</p><p>You may add a passage of up to five words as a Front-Cover Text,
      and a passage of up to 25 words as a Back-Cover Text, to the end of the
      list of Cover Texts in the Modified Version. Only one passage of
      Front-Cover Text and one of Back-Cover Text may be added by (or through
      arrangements made by) any one entity. If the Document already includes a
      cover text for the same cover, previously added by you or by arrangement
      made by the same entity you are acting on behalf of, you may not add
      another; but you may replace the old one, on explicit permission from
      the previous publisher that added the old one.</p><p>The author(s) and publisher(s) of the Document do not by this
      License give permission to use their names for publicity for or to
      assert or imply endorsement of any Modified Version.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gfdl-5"></a>6. COMBINING DOCUMENTS</h2></div></div></div><p>You may combine the Document with other documents released under
      this License, under the terms defined in <a class="link" href="#gfdl-4" title="5. MODIFICATIONS">section
      4</a> above for modified versions, provided that you include in the
      combination all of the Invariant Sections of all of the original
      documents, unmodified, and list them all as Invariant Sections of your
      combined work in its license notice, and that you preserve all their
      Warranty Disclaimers.</p><p>The combined work need only contain one copy of this License, and
      multiple identical Invariant Sections may be replaced with a single
      copy. If there are multiple Invariant Sections with the same name but
      different contents, make the title of each such section unique by adding
      at the end of it, in parentheses, the name of the original author or
      publisher of that section if known, or else a unique number. Make the
      same adjustment to the section titles in the list of Invariant Sections
      in the license notice of the combined work.</p><p>In the combination, you must combine any sections Entitled
      "History" in the various original documents, forming one section
      Entitled "History"; likewise combine any sections Entitled
      "Acknowledgements", and any sections Entitled
      "Dedications". You must delete all sections Entitled
      "Endorsements".</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gfdl-6"></a>7. COLLECTIONS OF DOCUMENTS</h2></div></div></div><p>You may make a collection consisting of the Document and other
      documents released under this License, and replace the individual copies
      of this License in the various documents with a single copy that is
      included in the collection, provided that you follow the rules of this
      License for verbatim copying of each of the documents in all other
      respects.</p><p>You may extract a single document from such a collection, and
      distribute it individually under this License, provided you insert a
      copy of this License into the extracted document, and follow this
      License in all other respects regarding verbatim copying of that
      document.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gfdl-7"></a>8. AGGREGATION WITH INDEPENDENT WORKS</h2></div></div></div><p>A compilation of the Document or its derivatives with other
      separate and independent documents or works, in or on a volume of a
      storage or distribution medium, is called an "aggregate" if the
      copyright resulting from the compilation is not used to limit the legal
      rights of the compilation's users beyond what the individual works
      permit. When the Document is included in an aggregate, this License does
      not apply to the other works in the aggregate which are not themselves
      derivative works of the Document.</p><p>If the Cover Text requirement of section 3 is applicable to these
      copies of the Document, then if the Document is less than one half of
      the entire aggregate, the Document's Cover Texts may be placed on
      covers that bracket the Document within the aggregate, or the electronic
      equivalent of covers if the Document is in electronic form. Otherwise
      they must appear on printed covers that bracket the whole aggregate.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gfdl-8"></a>9. TRANSLATION</h2></div></div></div><p>Translation is considered a kind of modification, so you may
      distribute translations of the Document under the terms of section 4.
      Replacing Invariant Sections with translations requires special
      permission from their copyright holders, but you may include
      translations of some or all Invariant Sections in addition to the
      original versions of these Invariant Sections. You may include a
      translation of this License, and all the license notices in the
      Document, and any Warranty Disclaimers, provided that you also include
      the original English version of this License and the original versions
      of those notices and disclaimers. In case of a disagreement between the
      translation and the original version of this License or a notice or
      disclaimer, the original version will prevail.</p><p>If a section in the Document is Entitled
      "Acknowledgements", "Dedications", or "History",
      the requirement (section 4) to Preserve its Title (section 1) will
      typically require changing the actual title.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gfdl-9"></a>10. TERMINATION</h2></div></div></div><p>You may not copy, modify, sublicense, or distribute the Document
      except as expressly provided for under this License. Any other attempt
      to copy, modify, sublicense or distribute the Document is void, and will
      automatically terminate your rights under this License. However, parties
      who have received copies, or rights, from you under this License will
      not have their licenses terminated so long as such parties remain in
      full compliance.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gfdl-10"></a>11. FUTURE REVISIONS OF THIS LICENSE</h2></div></div></div><p>The Free Software Foundation may publish new, revised versions of
      the GNU Free Documentation License from time to time. Such new versions
      will be similar in spirit to the present version, but may differ in
      detail to address new problems or concerns. See
      http://www.gnu.org/copyleft/.</p><p>Each version of the License is given a distinguishing version
      number. If the Document specifies that a particular numbered version of
      this License "or any later version" applies to it, you have the
      option of following the terms and conditions either of that specified
      version or of any later version that has been published (not as a draft)
      by the Free Software Foundation. If the Document does not specify a
      version number of this License, you may choose any version ever
      published (not as a draft) by the Free Software Foundation.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gfdl-addendum"></a>12. ADDENDUM: How to use this License for your documents</h2></div></div></div><p>To use this License in a document you have written, include a copy
      of the License in the document and put the following copyright and
      license notices just after the title page:</p><div class="blockquote"><a name="copyright-sample"></a><blockquote class="blockquote"><p>Copyright (c) YEAR YOUR NAME. Permission is granted to copy,
        distribute and/or modify this document under the terms of the GNU Free
        Documentation License, Version 1.2 or any later version published by
        the Free Software Foundation; with no Invariant Sections, no
        Front-Cover Texts, and no Back-Cover Texts. A copy of the license is
        included in the section entitled "GNU Free Documentation
        License".</p></blockquote></div><p>If you have Invariant Sections, Front-Cover Texts and Back-Cover
      Texts, replace the "with...Texts." line with this:</p><div class="blockquote"><a name="inv-cover-sample"></a><blockquote class="blockquote"><p>with the Invariant Sections being LIST THEIR TITLES, with the
        Front-Cover Texts being LIST, and with the Back-Cover Texts being
        LIST.</p></blockquote></div><p>If you have Invariant Sections without Cover Texts, or some other
      combination of the three, merge those two alternatives to suit the
      situation.</p><p>If your document contains nontrivial examples of program code, we
      recommend releasing these examples in parallel under your choice of free
      software license, such as the GNU General Public License, to permit
      their use in free software.</p></div></div></div></body></html>
