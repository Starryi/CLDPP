<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>7. Adding your first server</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Caudium HOWTO"><link rel="up" href="ch04.html" title="Chapter 4. Creating your first server"><link rel="prev" href="ch04s06.html" title="6. Configuration InterFace (CIF.)"><link rel="next" href="ch05.html" title="Chapter 5. Customizing your server"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">7. Adding your first server</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04s06.html">Prev</a> </td><th width="60%" align="center">Chapter 4. Creating your first server</th><td width="20%" align="right"> <a accesskey="n" href="ch05.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="adding"></a>7. Adding your first server</h2></div></div></div><p>
      In this section, I will give you a step-by-step tutorial on how to create
      your first site (virtual server) with Caudium. If you want to do something
      useful with Caudium, you have to create at least one virtual
      server. Without this first server, Caudium will not do anything. If you use
      your browser to access your server, you will only get a dialog box
      prompting for the <abbr class="abbrev">CIF.</abbr> login/password.

    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      A virtual server allows you to have several servers running on
      the same port. For example you can have www.foo.com and www.foo.org running
      on the same port and machine. This is why it is called virtual server.
    </p></div><p>
      To create your first server, log into the web based <abbr class="abbrev">CIF.</abbr>. Click on the
      <span class="guimenu">Virtual Servers</span> tab, then the 
      <span class="guibutton">
	<span class="inlinemediaobject"><img src="images/new_virtual_server.png" alt="new virtual server"></span>
      </span> button.
    </p><p>
      Here, you are prompted for the server name:
      </p><div class="mediaobject"><img src="images/cif_newserver.png"></div><p>
      Type in an easily identifiable
      name. You also have to select the configuration type. Depending on the
      configuration you choose, your server will have a different set of
      modules. In other words, your server will have different capabilities. For
      your first server, choose <code class="option">Basic server</code>, and 
      click <span class="guibutton">OK</span>.
    </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="servervariables"></a>7.1. Server variables</h3></div></div></div><p>
	Now you'll see the Virtual Servers page again. As you can see, you have two
	different folders to work on: <span class="guisubmenu">Server variables</span> (<a class="xref" href="ch04s07.html#cif_ports" title="Figure 4.1. Ports in the CIF">Figure 4.1, &#8220;Ports in the CIF&#8221;</a>) and <span class="guisubmenu">File system</span> (<a class="xref" href="ch04s07.html#cif_filesystem" title="Figure 4.2. Filesystem in the CIF">Figure 4.2, &#8220;Filesystem in the CIF&#8221;</a>). 
	</p><div class="figure"><a name="cif_ports"></a><p class="title"><b>Figure 4.1. Ports in the CIF</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/cif_ports.png" alt="Ports in the CIF"></div></div></div><p><br class="figure-break">
	</p><div class="figure"><a name="cif_filesystem"></a><p class="title"><b>Figure 4.2. Filesystem in the CIF</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/cif_filesystem.png" alt="Filesystem in the CIF"></div></div></div><p><br class="figure-break">
	Server variables contain the URL of your site, and the port on which it will be
	available. File system describes the files/directories containing the .html
	and other files you want Caudium to serve.
      </p><p>
	In server variables, go into <span class="guisubmenu">Listen ports</span> and choose <span class="guibutton">Configure a new
	port</span>. Use the default values, choose <span class="guibutton">Use these values</span>, and click
        <span class="guibutton">
	<span class="inlinemediaobject"><img src="images/save.png" alt="save"></span>
      </span>. Now select the URL of your site, and select <span class="guibutton">Continue</span>. You can now
	go back to the page displaying all of your modules, that is, where you were
	before you had gone into Server Variables.
      </p><p>
	Under your server name, you'll see the status of your server. If it
	contains the word <span class="quote">&#8220;<span class="quote">Open</span>&#8221;</span> in blue everything is okay, and you can continue
	with configuring the file system.
      </p><p>
	If it contains the words <span class="quote">&#8220;<span class="quote">Not open</span>&#8221;</span> in red, there is a problem. You can go
	into the Event Log via the <abbr class="abbrev">CIF.</abbr> tab to investigate. If you have an error <span class="guiicon">
	<span class="inlinemediaobject"><img src="images/err_3.png" alt="error icon"></span>
        </span>
	<span class="errorname">Failed to open socket on 0:80 (already bound ?)</span>, you may have another
	program or Caudium itself already running on this port. To fix the problem,
	identify the program which is using this port, and restart Caudium
	<a href="#ftn.idm579" class="footnote" name="idm579"><sup class="footnote">[1]</sup></a>.
	To restart Caudium, go into <span class="guimenu">Action</span> &#8594; <span class="guisubmenu">Shutdown</span> &#8594; <span class="guisubmenu">Shutdown Caudium</span> &#8594; <span class="guimenuitem">Restart Caudium</span>. Wait a few seconds, and when prompted, select <span class="guimenu">Virtual Servers</span>. Now select your
	server, and you should have the word <span class="quote">&#8220;<span class="quote">Open</span>&#8221;</span> in blue.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">In the <abbr class="abbrev">CIF.</abbr> you may wonder what are those two different protocols http and http2?</h3><p>
	  The difference is that http2 uses Caudium's internal memory cache while
	  http is plain Pike http subsystem. 
	  So http2 is faster than http as you might expect. However, 
	  there are some issues on some specific sites.
        </p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="selectingfs"></a>7.2. Selecting file system</h3></div></div></div><p>
	By selecting a file system, you tell Caudium which files it will send to
	people browsing your site. For those who know other web servers, please pay
	close attention to these explanations, because Caudium is quite different
	from other servers in this respect.
      </p><p>
	Caudium file systems use the Unix philosophy of mount point, rather than
	<code class="constant">c:</code>, <code class="constant">d:</code>, and so forth. The mount point concept allows
	you to put your files/directory under any URL you want without changing the
	files on your local file system. For example, assume you have the
	following local file system: 
      </p><div class="example"><a name="idm605"></a><p class="title"><b>Example 4.1. Your user filesystem.</b></p><div class="example-contents"><pre class="programlisting"><code class="computeroutput">
/home/customers/customer1
/home/customers/customer2
/home/customers/bigcustomer3
/home/friends/franck
/home/friends/bertrand
/home/friends/didier
        </code></pre></div></div><br class="example-break"><p>
	And suppose your URL is http://www.iteam.org/.
      </p><p>
	With a default configuration, you would say that http://www.iteam.org points to /home/ so that you will have customer1 under http://www.iteam.org/customers/customer1, bertrand under http://www.iteam.org/friends/bertrand and bigcustomer3 under http://www.iteam.org/customers/bigcustomer3.
      </p><p>
	But bigcustomer3 gives you a lot of money and he asks you for an URL such
	as http://www.iteam.org/bigcustomer3. However, he doesn't want to be moved
	from /home/customers/bigcustomer3 because of his FTP client's
	configuration. Moreover, you can't move the other accounts. With the mount
	point philosophy, you just have to create another mount point saying that
	/home/customers/bigcustomer3 is mounted on /bigcustomer3 so that when
	someone uses http://www.iteam.org/bigcustomer3, Caudium will serve them files
	from /home/customers/bigcustomer3.
      </p><p>
	Now let's return to our setup. Go into the <code class="option">File System</code> module, and select
	<code class="option">NONE/ mounted on /</code> -&gt; <code class="option">Path</code> -&gt; <code class="option">Search Path</code>. 
        Here you will decide which of
	your directories will be available when someone hits the root of your
	server. Write, for example, <strong class="userinput"><code>/home</code></strong>.
      </p><p>
	You can now launch your favorite browser to the URL of your site and
	enjoy.
      </p><p>
  	If you don't want visitors to get a listing of your files for
	security reasons, you can disable listing by setting <code class="option">Directory Settings</code> -&gt;
	<code class="option">Enable directory listing per default</code> to <code class="option">No</code>. Next you have to hit the
	<code class="option">More options</code> button, and then reload the module. Don't forget to click
	<code class="option">Save</code>. It is possible to put one of two <span class="quote">&#8220;<span class="quote">magic files</span>&#8221;</span> in any directory to
	make it browsable/not browsable despite the setting in the <abbr class="abbrev">CIF.</abbr> for that particular file system:
      </p><pre class="programlisting"><code class="computeroutput">
.www_browsable - the directory will always be browsable
.www_not_browsable - the directory will never be browsable
      </code></pre><p>
	Finally, to allow bigcustomer3 to get to his URL, go to <code class="option">File System</code> -&gt; <code class="option">Copy
	Module</code>. Next, go to <code class="option">Path</code> -&gt; <code class="option">Search Path</code> and type
	<strong class="userinput"><code>/home/customers/bigcustomer3</code></strong>, then type <strong class="userinput"><code>/bigcustomer3</code></strong> in 
        <code class="option">Mount point</code>.
      </p><p>
        The <a class="xref" href="ch04s07.html#cif_filesystem_example" title="Figure 4.3. Example of output">Figure 4.3, &#8220;Example of output&#8221;</a> shows the output you 
	should have.
	</p><div class="figure"><a name="cif_filesystem_example"></a><p class="title"><b>Figure 4.3. Example of output</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/cif_filesystem_example.png" alt="Example of output"></div></div></div><p><br class="figure-break">
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  If you created these files/directories after you point Caudium to
	  your site, it is safe to go in the <code class="option">Actions</code> tab, then to <code class="option">Cache</code> -&gt;
          <code class="option">Cache status</code> -&gt; <code class="option">Flush caches</code>.
        </p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="creatingavs"></a>7.3. Creating a virtual server</h3></div></div></div><p>
	A web server is usually running on a single port and on a single IP
	address. So how can someone have different sites on this single port and
	single IP?  The solution is to tell Caudium that the server is different
	based on the URL. This is the task of the Virtual Hosting module. As this
	module is not present in the Generic template we use, you will have to add
	it. Just use the <code class="option">Add module</code> button, and click the image named <span class="quote">&#8220;<span class="quote">Virtual
	Host Matcher</span>&#8221;</span>.
      </p><p>
	You are now able to do redirection with the help of regular expressions. If
	you don't know what regular expressions (<span class="quote">&#8220;<span class="quote">regexp</span>&#8221;</span> for short) are, check the
	man page for regexp, see Pike/Perl manual, or maybe buy a book on regular
	expressions. To write these redirections based on the URL, go into <code class="option">Regular
	expression rewrite rules</code> and add the following rule:
      </p><div class="example"><a name="idm660"></a><p class="title"><b>Example 4.2. A simple virtual hosting regular expression.</b></p><div class="example-contents"><pre class="programlisting"><code class="computeroutput">
www\.virtualhost\.com	www.virtualhost.com
         </code></pre></div></div><br class="example-break"><div class="example"><a name="idm664"></a><p class="title"><b>Example 4.3. A better and quicker regular expression.</b></p><div class="example-contents"><pre class="programlisting"><code class="computeroutput">
^www\.virtualhost\.com$|^virtualhost\.com$ www.virtualhost.com
        </code></pre></div></div><br class="example-break"><p>
	Save and type this command on your command line in order to get your
	browser resolving www.virtualhost.com:
      </p><pre class="programlisting"><code class="computeroutput">
# echo "127.0.0.1   www.virtualhost.com" &gt;&gt; /etc/hosts.
      </code></pre><p>
	You now have to add another virtual server with the button <code class="option">New Virtual
	Server</code> at the root of the virtual server tab. Put <strong class="userinput"><code>Virtual host</code></strong> as the
	server name and choose the <code class="option">Generic server</code> configuration type. Go into
	<code class="option">Server variables</code> -&gt; <code class="option">Server URL</code> and type <strong class="userinput"><code>http://www.virtualhost.com/</code></strong>. You should see:
      </p><p>
	This server is handled by the port in my first virtual server. Server URL:
	http://www.virtualhost.com/
      </p><p>
	Change the file system root and /tmp in <code class="option">File system</code> -&gt; <code class="option">NONE/ mounted on /</code>
	-&gt; <code class="option">Paths</code> -&gt; <code class="option">Search path</code>.
      </p><p>
	You can now point your favorite browser to http://localhost/ and
	http://www.virtualhost.com/ and see the result.
      </p><p>
	If you have an error telling you www.virtualhost.com is unknown check your host file.
      </p><p>
	For more information about virtual hosting, see the Virtual-Web Mini-HOWTO
	available at the <a class="ulink" href="http://www.tldp.org/" target="_top">LDP</a> or in 
	<code class="computeroutput">/usr/share/doc/HOWTO</code> or
	<code class="computeroutput">/usr/doc/HOWTO</code> under Debian GNU/Linux.
      </p></div><div class="footnotes"><br><hr style="width:100; text-align:left;margin-left: 0"><div id="ftn.idm579" class="footnote"><p><a href="#idm579" class="para"><sup class="para">[1] </sup></a>
	    To identify you can use lsof(8). If you want to know which programs
	    listen on port 80 just issue the following command as root</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>You need to be root if lsof has been compiled with the HASSECURITY option which is the default for some GNU/Linux distributions</p></div><p>:
          </p><pre class="programlisting"><code class="computeroutput">
# lsof -i TCP:80
          </code></pre><p>
	    Here is the result:
          </p><pre class="programlisting"><code class="computeroutput">
COMMAND  PID USER   FD   TYPE DEVICE SIZE NODE NAME
caudium 1001 root   12u  IPv4   3993       TCP *:www (LISTEN)
         </code></pre></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04s06.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch04.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch05.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">6. Configuration InterFace (<abbr class="abbrev">CIF.</abbr>) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 5. Customizing your server</td></tr></table></div></body></html>
