<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>7. How it all works</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="The Printing HOWTO"><link rel="up" href="index.html" title="The Printing HOWTO"><link rel="prev" href="ar01s06.html" title="6. Spooling software"><link rel="next" href="ar01s08.html" title="8. How to set things up"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">7. How it all works</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s06.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s08.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="background"></a>7. How it all works</h2></div></div></div><a class="indexterm" name="idm1146"></a><p>In order to get printing working well, you need to understand how your 
spooling software works.  All systems work in essentially the same
way, although the exact order might vary a bit, and some systems
skip a step or two:</p><div class="figure"><a name="spool-illustration"></a><p class="title"><b>Figure 10. Spooling Illustration</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/spool-illustration.png" alt="Spooling Illustration"></div></div></div><p><br class="figure-break"></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">The user submits a job along with his selection of options.  The
job data is usually, but not always, Postscript.</li><li class="listitem">The spooling system copies the job and the options over the
network in the general direction of the printer.</li><li class="listitem">The spooling system waits for the printer to be available.</li><li class="listitem"><a class="indexterm" name="idm1162"></a></li><li class="listitem"><a name="background-filtering"></a>The spooling system applies the user's selected options to the
job, and translates the job data into the printer's native
language, which is usually not Postscript.  This step is called <span class="emphasis"><em>filtering</em></span>; most of the work in setting
things up lies in getting the proper filtering to happen.</li><li class="listitem">The job is done.  The spooling system will usually do assorted
cleanup things at this point.  If there was an error along the
way, the spooler will usually notify the user somehow (for
example, by email).</li></ol></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="cups-overview"></a>7.1. CUPS</h3></div></div></div><p>To print a job with CUPS, you can use both the BSD (see <a class="xref" href="ar01s05.html#printer-compat-list" title="5.3.1. Printer compatibility list">Section 5.3.1, &#8220;Printer compatibility list&#8221;</a>) and System V commands making it really easy for people with prior experience with either system.</p><div class="figure"><a name="idm1173"></a><p class="title"><b>Figure 11. Simplified CUPS illustration</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/cups-overview.png" alt="Simplified CUPS illustration"></div></div></div><br class="figure-break"><p>Initially CUPS lacked an LPD backend. This was of course quickly added. Currently there are backends available for at least IPP, LPD, SMB, JetDirect, USB, Netatalk, parallel and serial printers. You may find others on the net or write your own.</p><p>There are only a handfull of built-in drivers, allowing you to print with most printers but probably not at the maximum resolution. A PPD file for a Postscript driver can be added to CUPS but if you want to print at best quality with your fancy new HP Deskjet you are out of luck. It is here that Foomatic comes to the rescue. You can use Foomatic in combination with CUPS. Foomatic uses a CUPS filter called foomatic-rip to do its magic. foomatic-rip uses PPD files to describe printer capabilities, even for non-Postscript printers. CUPS + Foomatic is currently the recommended printing system. Some Linux distributions already use it and the number that do will only grow.</p><p>The CUPS scheduler does not only accept jobs, it is also a administrative webinterface. Currently you can add/delete printers, cancel jobs, start/stop printers. Moving jobs will be available in a later release.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="lpd-overview"></a>7.2. LPD</h3></div></div></div><a class="indexterm" name="idm1183"></a><p>Lpd stands for Line Printer Daemon, and refers in different
contexts to both the daemon and the whole collection of programs
which run print spooling.  These are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong><a class="ulink" href="http://www.linuxprinting.org/man/lpd.8.html" target="_top">lpd</a></strong></span></span></dt><dd><p>The spooling daemon.  One of these runs to control everything
on a machine, AND one is run per printer while the printer is
printing.</p></dd><dt><a name="lpr-in-lpd-overview"></a><span class="term"><span class="command"><strong><a class="ulink" href="http://www.linuxprinting.org/man/lpr.1.html" target="_top">lpr</a></strong></span><a class="indexterm" name="idm1197"></a><a class="indexterm" name="idm1199"></a></span></dt><dd><p>The user spooling command.  Lpr contacts lpd
and injects a new print job into the spool.</p></dd><dt><a name="lpq-in-lpd"></a><span class="term"><span class="command"><strong><a class="ulink" href="http://www.linuxprinting.org/man/lpq.1.html" target="_top">lpq</a></strong></span><a class="indexterm" name="idm1208"></a><a class="indexterm" name="idm1210"></a></span></dt><dd><p>Lists the jobs in a print queue.</p></dd><dt><a name="lpc-in-lpd"></a><span class="term"><span class="command"><strong><a class="ulink" href="http://www.linuxprinting.org/man/lpc.8.html" target="_top">lpc</a></strong></span><a class="indexterm" name="idm1219"></a><a class="indexterm" name="idm1221"></a></span></dt><dd><p>The Lpd system control command.  With lpc you can stop, start,
reorder, etc, the print queues.</p></dd><dt><a name="lprm-in-lpd"></a><span class="term"><span class="command"><strong><a class="ulink" href="http://www.linuxprinting.org/man/lprm.1.html" target="_top">lprm</a></strong></span><a class="indexterm" name="idm1230"></a><a class="indexterm" name="idm1232"></a></span></dt><dd><p><span class="command"><strong>lprm</strong></span> removes a job from the print spool.</p></dd></dl></div><p>So how does it fit together?  The following things happen:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">At boot time, <span class="command"><strong>lpd</strong></span> is run.  It waits for
connections and manages printer queues.</li><li class="listitem">A user submits a job with the <span class="command"><strong>lpr</strong></span> command
or, alternatively, with an lpr front-end like GPR, PDQ, etc.<span class="command"><strong>Lpr</strong></span> contacts <span class="command"><strong>lpd</strong></span> over the
network and submits both the user's data file (containing the
print data) and a control file (containing user options).</li><li class="listitem">When the printer becomes available, the main <span class="command"><strong>lpd</strong></span> spawns a child <span class="command"><strong>lpd</strong></span> to
handle the print job.</li><li class="listitem">The child <span class="command"><strong>lpd</strong></span> executes the appropriate
filter(s) (as specified in the <code class="option">if</code> attribute in<code class="filename">/etc/printcap</code>) for this job and sends the
resulting data on to the printer.</li></ol></div><p>The lp system was originally designed when most printers were line
printers - that is, people mostly printed plain ASCII.  By placing
all sorts of magic in the <code class="option">if</code> filter, modern
printing needs can be met with <span class="command"><strong>lpd</strong></span> (well, more
or less; many other systems do a better job).</p><p>There are many programs useful for writing LPD filters.  Among
them are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>gs</strong></span></span></dt><dd><p>Ghostscript is a host-based Postscript interpreter (aka a
Raster Image Processor or RIP).  It accepts Postscript and
produces output in various printer languages or a number of
graphics formats.  Ghostscript is covered in <a class="xref" href="ar01s10.html" title="10. Ghostscript.">Section 10, &#8220;Ghostscript.&#8221;</a>.</p></dd><dt><span class="term"><span class="command"><strong>ppdfilt</strong></span></span></dt><dd><p><span class="command"><strong><a class="ulink" href="http://sourceforge.net/project/?group_id=1658" target="_top">ppdfilt</a></strong></span> is a standalone version of a CUPS
component.  It filters Postscript, executing a few basic
transformations on it (n-up printing, multiple copies, etc)
and adding in user option statements according to a Postscript
Printer Definition (PPD) file usually included with Postscript
printers.</p><p><span class="command"><strong>ppdfilt</strong></span> is best used together with an
option-accepting LPD system (like the GNUlpr, or LPRng)
and a filter script which parses user-provided options into
the equivalent <span class="command"><strong>ppdfilt</strong></span> command.  VA Linux
and HP provide a modified rhs-printfilters package which does
exactly this; it produces nice results if you have a
Postscript printer.  See <a class="xref" href="ar01s08.html#lpd-for-postscript-printers" title="8.2.2. LPD for PostScript Printers">Section 8.2.2, &#8220;LPD for PostScript Printers&#8221;</a> for information on
this system.</p></dd><dt><span class="term"><span class="command"><strong>ps2ps</strong></span></span></dt><dd><p><span class="command"><strong>ps2ps</strong></span> is a utility script included
with Ghostscript.  It filters Postscript into more streamlined
Postscript, possibly at a lower Language Level.  This is
useful if you have an older Postscript printer; most modern
software produces modern Postscript.</p></dd><dt><span class="term"><span class="command"><strong>mpage</strong></span></span></dt><dd><p><span class="command"><strong>mpage</strong></span> is a utility which accepts
text or Postscript, and generates n-up output&#8212;that is,
output with several page images on each piece of paper.  There
are actually several programs which do this, including<span class="command"><strong>enscript</strong></span>, <span class="command"><strong>nenscript</strong></span>, and<span class="command"><strong>a2ps</strong></span>.</p></dd><dt><span class="term"><span class="command"><strong>a2ps</strong></span></span></dt><dd><p><span class="command"><strong>a2ps</strong></span>, aka any-to-ps, is a program which
accepts a variety of file types and converts them to
Postscript for printing.</p></dd></dl></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s06.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s08.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">6. Spooling software </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 8. How to set things up</td></tr></table></div></body></html>
