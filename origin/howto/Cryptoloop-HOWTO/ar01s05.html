<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>5. Setting up the loop device</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Cryptoloop HOWTO"><link rel="up" href="index.html" title="Cryptoloop HOWTO"><link rel="prev" href="ar01s04.html" title="4. Getting the user space tools"><link rel="next" href="ar01s06.html" title="6. Mounting the encrypted file system"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. Setting up the loop device</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s04.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s06.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="loopdevice-setup"></a>5. Setting up the loop device</h2></div></div></div><p>Cryptoloop can be used either on a file or an entire file system. The following describes how to
set it up on a particular partition. This partition can be any partition you like; the following
example uses <code class="filename">/dev/sda1</code>. I have chosen to use AES as a cipher, but you can substitute any cipher
you like that has been enabled in the kernel. You can get a list of the algorithms supported by
your currently running kernel by looking into <code class="filename">/proc/crypto</code>. An excellent resource, discussing the
different cryptographic algorithms, are Bruce Schneier's books, Applied Cryptography and Practical
Cryptography. Both AES and Serpent are probably a reasonable choice. AES has been cryptanalyzed a lot
and no serious weaknesses have been discovered so far. Serpent has not been analyzed as much, but is
considered to be even a little bit stronger than AES. However, Serpent is also slower than AES.
Stay away from DES, it is both slow and weak. Triple-DES may be an option, but AES is probably more
secure and faster, so there is really no reason to use Triple-DES anymore.
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>It is recommended that you format your partition and fill it with random data before you create the encrypted file system on it. This will make it harder for an attacker to detect patterns in your encrypted partition.
</p><p><span class="emphasis"><em>WARNING!</em></span> </p><p>Be careful what you type here for your partition. If you do make a mistake, you can easily overwrite the wrong partition with random garbage! </p><p>Filling a partition with random data can be done as follows:</p><pre class="screen">dd if=/dev/urandom of=/dev/sda1 bs=1M
</pre><p>You may get an error message that the device is full. You can ignore it.</p></li><li class="listitem"><p>Select a cipher and key size. A list of ciphers supported by your kernel can be obtained from <code class="filename">/proc/crypto</code>. I recommend that you use AES with a 256-bit key.</p></li><li class="listitem"><p>Set up the loop device. This is done using the <span class="command"><strong>losetup</strong></span> command from the util-linux package. The following command creates an encrypted filesystem using the loop device 0 using the AES cipher with a 256-bit key on the device <code class="filename">/dev/sda1</code>:</p><pre class="screen">losetup -e aes-256 /dev/loop0 /dev/sda1
</pre><p>The command prompts for a password. Select a strong password and try to remember it without having to stick a Post-It note to your monitor. 
        There is one big downside to using Cryptoloop. Since the password is hashed to create the encryption key, it is not easy to change the password later on. 
        The most straight-forward way of changing the password is to create a new encrypted partition or file and move all data into it. For this reason, make 
        sure you select a strong password from the start.  AES may be a strong algorithm, but if you chose a weak password, that security goes down the drain.
        </p><p>If <span class="command"><strong>losetup</strong></span> fails with an INVALID ARGUMENT error message, there is a problem with your util-linux package. 
         Make sure you have followed the instructions above on how to install a patched version of util-linux. Older and unpatched version use a 
         different way of passing the key size, and do not work with the 2.6 Crypto API.
        </p></li><li class="listitem"><p>Create a file system. You can chose whatever file system you like. The following creates an ext3 file system using the loop device:</p><pre class="screen">mkfs.ext3 /dev/loop0
</pre></li><li class="listitem"><p>Mount the encrypted file system. First you need to create a mount point, such as <code class="filename">/mnt/crypto</code>:</p><pre class="screen">mkdir /mnt/crypto</pre><p>Then you need to mount the file system. At this stage you need to tell mount explicitly which loop device to use:</p><pre class="screen">mount -t ext3 /dev/loop0 /mnt/crypto
</pre></li><li class="listitem"><p>You can now play with your encrypted file system until you are bored.</p></li><li class="listitem"><p>Unmount the file system. After you are done playing, unmount the filesystem:</p><pre class="screen">umount /mnt/crypto</pre></li><li class="listitem"><p>Detach the loop device. The loop device is still attached to your partition. Detach it with:</p><pre class="screen">losetup -d /dev/loop0</pre></li></ol></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s04.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s06.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4. Getting the user space tools </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 6. Mounting the encrypted file system</td></tr></table></div></body></html>
