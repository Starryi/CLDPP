<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>2. Special things you need to do</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Glibc Installation HOWTO"><link rel="up" href="ch03.html" title="Chapter 3. Preparations"><link rel="prev" href="ch03s01.html" title="1. Stuff you will need"><link rel="next" href="ch04.html" title="Chapter 4. The installation of glibc itself"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2. Special things you need to do</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s01.html">Prev</a> </td><th width="60%" align="center">Chapter 3. Preparations</th><td width="20%" align="right"> <a accesskey="n" href="ch04.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="special-things-you-need-to-do"></a>2. Special things you need to do</h2></div></div></div><p>Since you are going to substitute the basic library many programs
rely on, you can imagine the problems that may occur.</p><p>For me, it so happened that everything went fine until I typed in
<span class="command"><strong>make install</strong></span>.  At about halfway through the installation
process I got an error telling me that <span class="command"><strong>rm</strong></span> was not able to 
run, and I found out that even all the common commands like 
<span class="command"><strong>cp</strong></span>, <span class="command"><strong>ls</strong></span>, <span class="command"><strong>mv</strong></span>, 
<span class="command"><strong>ln</strong></span>, <span class="command"><strong>tar</strong></span>, etc., did not work; all told me
that they were not able to find parts of the library they needed.</p><p>But there is help available.  You can force the compilation of
programs with the libraries compiled into them, so the programs do not need
to look them up from the library.</p><p>For that reason, in this chapter, we will compile all the
utilities we need for the install into a static version.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="things-you-will-definitely-need"></a>2.1. Things you will definitely need</h3></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="the-gnu-binutils"></a>2.1.1. The GNU-Binutils</h4></div></div></div><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Get the newest version from: <a class="ulink" href="ftp.gnu.org/gnu/binutils" target="_top">ftp.gnu.org/gnu/binutils</a>; at the time of writing, this was version 2.14</p></li><li class="listitem"><p>Open the package: </p><pre class="screen">tar xIvf binutils-2.14.tar.bz2</pre></li><li class="listitem"><p>Change to the directory: </p><pre class="screen">cd binutils-2.14</pre></li><li class="listitem"><p>Configure the Makefiles: </p><pre class="screen">./configure</pre></li><li class="listitem"><p>Compile the sources: </p><pre class="screen">make</pre></li><li class="listitem"><p>Install them with: </p><pre class="screen">make install</pre></li></ol></div><p>
</p><p>
If you run into trouble with the compilation of the binutils,
referring to problems with gettext (indicated by errors like:
<span class="quote">&#8220;<span class="quote">undeclared reference to lib_intl</span>&#8221;</span> or similar) please install the
newest version, available from <a class="ulink" href="ftp.gnu.org/gnu/gettext" target="_top">ftp.gnu.org/gnu/gettext</a>.</p><p>If this does not help, try disabling the native-language support by using: </p><pre class="screen">./configure --no-nls</pre><p>You don't need to build a static version of the binutils, though it
would not hurt, but I encountered many systems running with very
old versions and ran into errors almost every time, so I think it
is a good idea to mention them here.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="gnu-make"></a>2.1.2. GNU make</h4></div></div></div><p>The <span class="command"><strong>make</strong></span> command is responsible for the compiling of the sources, calling gcc and all the other programs needed for a compile.
Since you may need to compile something if a problem occurs with the new glibc, it is a good idea to have it
static, otherwise it might not work after an error appears.</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Download the source from <a class="ulink" href="ftp.gnu.org/gnu/make/" target="_top">ftp.gnu.org/gnu/make/</a>; at the time of writing the current version was 3.80</p></li><li class="listitem"><p>Unpack the source, eg.: </p><pre class="screen">tar xIvf make-3.80.tar.bz2</pre></li><li class="listitem"><p>Change to the created directory: </p><pre class="screen">cd make-3.80</pre></li><li class="listitem"><p>Take care that the binaries are built static: </p><pre class="screen">export CFLAGS="-static -O2 -g"</pre></li><li class="listitem"><p>Run the configure script: </p><pre class="screen">./configure</pre></li><li class="listitem"><p>Compile the stuff: </p><pre class="screen">make</pre></li><li class="listitem"><p>Install the binaries: </p><pre class="screen">make install</pre></li><li class="listitem"><p>Make a check:</p><pre class="screen">make -v</pre><p> You should now see the new version installed.  If not, check for older binary files and replace them by smlinks to the new version.</p></li></ol></div><p>
</p><p>
Congratulations! You have compiled another static-linked program.
</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="gnu-core-utils"></a>2.1.3. the GNU core-utils</h4></div></div></div><p>The core-utils are commands like: <span class="command"><strong>cp</strong></span>, <span class="command"><strong>rm</strong></span>, <span class="command"><strong>ln</strong></span>, <span class="command"><strong>mv</strong></span>, etc. In case of an
error in the installation, these are an absolute requirement to
help bring your system up again, so static binaries are really necessary
here.</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Again, download the source tarball from: <a class="ulink" href="ftp.gnu.org/gnu/coreutils/" target="_top">ftp.gnu.org/gnu/coreutils/</a>; at the time of writing, version 5.0 was current.</p></li><li class="listitem"><p>Unpack it: </p><pre class="screen">tar xIvf coreutils-5.0.tar.bz2</pre></li><li class="listitem"><p>Change to the directory: </p><pre class="screen">cd coreutils-5.0</pre></li><li class="listitem"><p>Take care that the binaries are built static:</p><pre class="screen">export CFLAGS="-static -O2 -g"</pre></li><li class="listitem"><p>Configure the package: </p><pre class="screen">./configure</pre></li><li class="listitem"><p>Compile the binaries: </p><pre class="screen">make</pre></li><li class="listitem"><p>And install them: </p><pre class="screen">make install</pre></li><li class="listitem"><p>Verify that the right core-utils are used: </p><pre class="screen">cp --version</pre><p>.  You should see the correct version, otherwise remove any old binaries and replace them with symlinks to the new version.</p></li></ol></div><p>
</p><p>
Now that the binaries of these very elementary tools are static,
you can be sure they will work every time you need them.
</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="gnu-tar"></a>2.1.4. GNU tar</h4></div></div></div><p>You have already used GNU tar to unpack all the programs compiled
and installed so far. But maybe you need to compile another
program which is needed by glibc after you had a crash, and in
this situation (I experienced this myself!) it is very useful to
have a working <span class="command"><strong>tar</strong></span> ready to unpack the missing programs.
With tar, we also need to take care of the
bz2 compression algorithm, which is not included in the normal
source distribution of tar.</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Get the source of GNU tar from <a class="ulink" href="ftp.gnu.org/gnu/tar" target="_top">ftp.gnu.org/gnu/tar</a>; at the time of writing, version 1.13 was up-to-date.</p></li><li class="listitem"><p>As many source tarballs are compressed with bzip2, we would like to have the support built in, rather than working with pipes, so get the patch from:
    <a class="ulink" href="ftp://infogroep.be/pub/linux/lfs/lfs-packages/4.1/tar-1.13.patch" target="_top">ftp://infogroep.be/pub/linux/lfs/lfs-packages/4.1/tar-1.13.patch</a>.
    </p></li><li class="listitem"><p>Unpack the source by invoking: </p><pre class="screen">tar xzvf tar-1.13.tar.gz</pre></li><li class="listitem"><p>Copy the patch to the source directory of tar: </p><pre class="screen">cp tar-1.13.patch tar-1.13/</pre></li><li class="listitem"><p>Apply the patch: </p><pre class="screen">patch -Np1 -i tar-1.13.patch</pre></li><li class="listitem"><p>Set the compiler flags to make a static binary: </p><pre class="screen">export CFLAGS="-static -O2 -g"</pre></li><li class="listitem"><p>Now we are ready to configure: </p><pre class="screen">./configure</pre></li><li class="listitem"><p>Compile with: </p><pre class="screen">make</pre></li><li class="listitem"><p>And as the next step, install the package:</p><pre class="screen">make install</pre></li><li class="listitem"><p>Do a quick check to ensure the new version is being used from now on: </p><pre class="screen">tar --version</pre><p>  The version you just installed should display, otherwise 
    check for old binaries and replace them with symlinks to the new location.</p></li></ol></div><p>If you experience problems with the execution of <span class="command"><strong>make</strong></span>, try to turn
off native-language support (nls).  You may achieve this by
invoking configure with the option: </p><pre class="screen">--disable-nls</pre><p><span class="emphasis"><em>Note:</em></span> In this new version of tar, you must use the <code class="option">-j</code> switch to
decompress .bzip2 files, so instead of </p><pre class="screen">tar xIvf anyfile.tar.bz2</pre><p> you now have to use </p><pre class="screen">tar xjvf anyfile.tar.bz2</pre><p> I
do not know why this was changed, but it works fine.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="the-bash"></a>2.1.5. The Bash shell</h4></div></div></div><p>
I prefer Bash as my shell; if you use a different one, please be sure you have installed a static version of it before you install glibc.</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Get Bash from: <a class="ulink" href="ftp.gnu.org/gnu/bash/" target="_top">ftp.gnu.org/gnu/bash/</a>. Download the newest
  version you can find; at the time of writing this was version 2.05b.</p></li><li class="listitem"><p>Unpack the source tree: </p><pre class="screen">tar xzvf bash-2.05b.tar.gz</pre><p> which
  will create a directory called <code class="filename">bash-2.05b</code> with all the unpacked sources in it.</p></li><li class="listitem"><p>Go to the directory: </p><pre class="screen">cd bash-2.05a</pre></li><li class="listitem"><p>Set everything up for building a static version:  </p><pre class="screen">export CFLAGS="-static -O2 -g"</pre></li><li class="listitem"><p>Configure the makefiles: </p><pre class="screen">./configure</pre><p> If you would like something special in your Bash, see </p><pre class="screen">./configure --help</pre><p>
  for a list of options.</p></li><li class="listitem"><p>Compile everything: </p><pre class="screen">make</pre></li><li class="listitem"><p>Install the compiled binaries: </p><pre class="screen">make install</pre><p> This will install the binaries to <code class="filename">/usr/local/bin/</code>.</p></li><li class="listitem"><p>Make sure there is not another version laying around (like in my Suse-Linux: <code class="filename">/bin/</code>), by copying the file:
  </p><pre class="screen">cp /usr/local/bin/bash /bin/</pre><p> We don't use a symlink here because both at boot-time and when starting Bash there might be trouble with symlinks.
  </p></li></ol></div><p>
</p><p>You now have installed a static version of Bash.  For that reason,
the binary is much bigger than usual, but it will run under all
circumstances.</p><p>
If you prefer to use another shell, you are free to do so, but make
sure it is a statically-linked version. Feel free to email me a method to
build the shell of your choice in a static version, and chances are good
that it will be implemented in the next revision of this document.
</p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="software-that-may-come-in-handy"></a>2.2. Software that may come in handy</h3></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="midnight-commander"></a>2.2.1. Midnight Commander</h4></div></div></div><p>
Midnight Commander is a very useful file manager, supporting
many nice features like transparent decompression of packed files,
built-in copy, move and other common commands, as well as an
integrated editor.</p><p>To compile this piece of software, you will need to have glib
installed; in some distributions this is already the case. If you
get an error in the <span class="command"><strong>make</strong></span> command saying that ld could not 
find glib, you will need to install this library first. You can get the sources from:
<a class="ulink" href="ftp.gnome.org/pub/gnome/sources/glib/2.2/" target="_top">ftp.gnome.org/pub/gnome/sources/glib/2.2/</a>, and the installation is straight-forward.</p><p>Here are the steps to build Midnight Commander:</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Get the source from
    <a class="ulink" href="http://www.ibiblio.org/pub/Linux/utils/file/managers/mc/" target="_top">http://www.ibiblio.org/pub/Linux/utils/file/managers/mc/"</a>;
    at the time of writing, the newest version was 4.6.0.</p></li><li class="listitem"><p>Unpack the sources: </p><pre class="screen">tar xzvf mc-4.6.0.tar.gz</pre></li><li class="listitem"><p>Change to the directory you just created: </p><pre class="screen">cd mc-4.6.0</pre></li><li class="listitem"><p>Set up the configuration-files: </p><pre class="screen">./configure</pre></li><li class="listitem"><p>Start compiling: </p><pre class="screen">make</pre></li><li class="listitem"><p>Install everything: </p><pre class="screen">make install</pre></li></ol></div><p>
</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s01.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch03.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch04.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">1. Stuff you will need </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 4. The installation of glibc itself</td></tr></table></div></body></html>
