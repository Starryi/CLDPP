<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Glibc Installation HOWTO</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="book"><div class="titlepage"><div><div><h1 class="title"><a name="Glibc-Install-Mini-Howto"></a>Glibc Installation HOWTO</h1></div><div><div class="author"><h3 class="author"><span class="firstname">Kai</span> <span class="surname">Schlachter</span></h3><div class="affiliation"><div class="address"><p><br>
<code class="email">&lt;<a class="email" href="mailto:linux%20(at)%20murphyslantech.de">linux (at) murphyslantech.de</a>&gt;</code><br>
      </p></div></div></div></div><div><p class="pubdate">2004-03-19</p></div><div><div class="revhistory"><table style="border-style:solid; width:100%;" summary="Revision History"><tr><th align="left" valign="top" colspan="3"><b>Revision History</b></th></tr><tr><td align="left">Revision 1.01</td><td align="left">2004-03-19</td><td align="left">KC</td></tr><tr><td align="left" colspan="3">Initial Release, reviewed by LDP</td></tr></table></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="chapter"><a href="#preface">1. Preface</a></span></dt><dd><dl><dt><span class="sect1"><a href="#copyright">1. Copyright</a></span></dt><dt><span class="sect1"><a href="#history">2. Revision History</a></span></dt><dt><span class="sect1"><a href="#thanks">3. Thanks</a></span></dt></dl></dd><dt><span class="chapter"><a href="#introduction">2. Introduction</a></span></dt><dd><dl><dt><span class="sect1"><a href="#why">1. Why?</a></span></dt><dt><span class="sect1"><a href="#what">2. What?</a></span></dt></dl></dd><dt><span class="chapter"><a href="#preparations">3. Preparations</a></span></dt><dd><dl><dt><span class="sect1"><a href="#stuff-you-will-need">1. Stuff you will need</a></span></dt><dd><dl><dt><span class="sect2"><a href="#software-you-will-need">1.1. Software you will need</a></span></dt><dt><span class="sect2"><a href="#sources-you-will-need">1.2. Sources you will need</a></span></dt></dl></dd><dt><span class="sect1"><a href="#special-things-you-need-to-do">2. Special things you need to do</a></span></dt><dd><dl><dt><span class="sect2"><a href="#things-you-will-definitely-need">2.1. Things you will definitely need</a></span></dt><dt><span class="sect2"><a href="#software-that-may-come-in-handy">2.2. Software that may come in handy</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#the-install-of-glibc-itself">4. The installation of glibc itself</a></span></dt><dd><dl><dt><span class="sect1"><a href="#obtaining-and-compiling-the-source">1. Obtaining and compiling the source</a></span></dt><dt><span class="sect1"><a href="#the-installation">2. The installation</a></span></dt><dd><dl><dt><span class="sect2"><a href="#lilo">2.1. LILO</a></span></dt><dt><span class="sect2"><a href="#grub">2.2. Grub</a></span></dt></dl></dd><dt><span class="sect1"><a href="#after-the-kernel-is-booted">3. After the kernel is booted...</a></span></dt></dl></dd><dt><span class="chapter"><a href="#troubleshooting">5. Troubleshooting&#8212;if something goes wrong... </a></span></dt><dd><dl><dt><span class="sect1"><a href="#errors-with-configure-or-make-while-trying-to-compile-the-glibc">1. Errors with <span class="command"><strong>configure</strong></span> or <span class="command"><strong>make</strong></span> 
while trying to compile glibc</a></span></dt><dt><span class="sect1"><a href="#something-goes-wrong-during-make-install">2. Something goes wrong during <span class="command"><strong>make install</strong></span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#going-back-to-a-working-configuration">2.1. Going back to a working configuration</a></span></dt></dl></dd></dl></dd></dl></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="preface"></a>Chapter 1. Preface</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="sect1"><a href="#copyright">1. Copyright</a></span></dt><dt><span class="sect1"><a href="#history">2. Revision History</a></span></dt><dt><span class="sect1"><a href="#thanks">3. Thanks</a></span></dt></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="copyright"></a>1. Copyright</h2></div></div></div><p>Copyright (c) 2004 by Kai Schlachter</p><p>Permission is granted to copy, distribute and/or modify this document
      under the terms of the GNU Free Documentation License, Version 1.2
      or any later version published by the Free Software Foundation;
      with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
      Texts.  A copy of the license is located at <a class="ulink" href="http://www.gnu.org/licenses/fdl.html" target="_top">http://www.gnu.org/licenses/fdl.html</a>.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="history"></a>2. Revision History</h2></div></div></div><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>v1.01: Fixed some missplaced quotation marks</p></li></ul></div><p>
</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="thanks"></a>3. Thanks</h2></div></div></div><p>I especially want to thank Nico Schmoigl for helping me get
my crashed system back up after I ran <span class="command"><strong>make install</strong></span> for 
glibc while my system was still fully running. This was the main reason I wrote this mini-HOWTO.
</p><p>Thanks also go to all the other people who helped me along the way; getting the HOWTO in correct format, finding all the typos, etc.</p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="introduction"></a>Chapter 2. Introduction</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="sect1"><a href="#why">1. Why?</a></span></dt><dt><span class="sect1"><a href="#what">2. What?</a></span></dt></dl></div><p>In this HOWTO I will explain how you install a new version
of <span class="productname">glibc</span>&#8482; on your system.</p><p>I wrote this manual because I want to save others from the
problems I encountered.</p><p>This HOWTO is a kind of guideline, made up from settings and ways of 
doing things that worked out for me. No liability for the contents of this document can be accepted. Use the concepts, examples and other content at your own risk.  You are strongly recommended to make a backup of your system before major installations and backups at regular intervals.</p><p>If you have any suggestions, found another bug in some
distribution and how to fix it, please let me know by writing me
an e-mail: <code class="email">&lt;<a class="email" href="mailto:linux_at_murphyslantech.de">linux_at_murphyslantech.de</a>&gt;</code>.</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="why"></a>1. Why?</h2></div></div></div><p>
Yes, that's a good question. Why would you need to install a new
glibc? Well, there are several reasons:
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>you are a developer and you need the new functions of the library</p></li><li class="listitem"><p>you wanted to compile a new program that needs the new library</p></li><li class="listitem"><p>you like the thrill of errors and bugs in new versions ;-)</p></li></ul></div><p>
</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="what"></a>2. What?</h2></div></div></div><p>
If you do not know what glibc is by now, don't worry! When I
first had problems with a new program I wanted to compile, I only
knew that my version of glibc was not sufficient for the
compile.  Now that I know more, I will try to explain in a very simple way what
glibc does.</p><p>The glibc package contains a library written in the
programming language of C.  Libraries are a very useful thing in programming;
instead of inventing the wheel from scratch for operations such as
computing the square-root of a number, such common functions
are stored in separate files&#8212;the so-called libraries.
When a new version of a library is published it often contains
some new functions, uses more efficient algorithms for already
implemented functions, and so on.</p><p>This is the reason why some programs complain about an older
version of glibc: the current version just does not contain all the functions
the program needs in order to run.</p><p>I know this is not technically correct in all detail, but it
gives you a basic understanding of the architecture behind.</p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="preparations"></a>Chapter 3. Preparations</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="sect1"><a href="#stuff-you-will-need">1. Stuff you will need</a></span></dt><dd><dl><dt><span class="sect2"><a href="#software-you-will-need">1.1. Software you will need</a></span></dt><dt><span class="sect2"><a href="#sources-you-will-need">1.2. Sources you will need</a></span></dt></dl></dd><dt><span class="sect1"><a href="#special-things-you-need-to-do">2. Special things you need to do</a></span></dt><dd><dl><dt><span class="sect2"><a href="#things-you-will-definitely-need">2.1. Things you will definitely need</a></span></dt><dt><span class="sect2"><a href="#software-that-may-come-in-handy">2.2. Software that may come in handy</a></span></dt></dl></dd></dl></div><p>
As an installation of glibc is not an easy task.  You need to do a lot of things in advance, especially in the event that something goes
wrong. (That is what happened to me on my first glibc install, and I did not make any preparations.)</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="stuff-you-will-need"></a>1. Stuff you will need</h2></div></div></div><p>Basically, you need two different things: software that is already running on your machine (eg., pre-installed by your distribution) and packages 
of source-code for different programs.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="software-you-will-need"></a>1.1. Software you will need</h3></div></div></div><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>a running <span class="productname">gcc</span>&#8482;</p></li><li class="listitem"><p>an older version of <span class="productname">glibc</span>&#8482; ;-)</p></li><li class="listitem"><p><span class="productname">GNU-binutils</span>&#8482;</p></li><li class="listitem"><p><span class="productname">GNU-make</span>&#8482;</p></li><li class="listitem"><p>the <span class="productname">GNU-core-utils</span>&#8482;</p></li><li class="listitem"><p><span class="productname">GNU-tar</span>&#8482;</p></li><li class="listitem"><p><span class="productname">bash</span>&#8482; or any shell you prefer</p></li><li class="listitem"><p>very useful but not a must: <span class="productname">Midnight Commander</span>&#8482;</p></li><li class="listitem"><p>an editor you like (<span class="productname">vi, jed</span>&#8482;, etc.)</p></li></ul></div><p>
</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sources-you-will-need"></a>1.2. Sources you will need</h3></div></div></div><p>
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="productname">bash</span>&#8482;or the shell you like</p></li><li class="listitem"><p><span class="productname">GNU-tar</span>&#8482;</p></li><li class="listitem"><p><span class="productname">GNU-core-utils</span>&#8482;</p></li><li class="listitem"><p><span class="productname">GNU-make</span>&#8482;</p></li><li class="listitem"><p>of course:<span class="productname">glibc</span>&#8482;</p></li><li class="listitem"><p>possibly: <span class="productname">gcc</span>&#8482;</p></li></ul></div><p>
</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="special-things-you-need-to-do"></a>2. Special things you need to do</h2></div></div></div><p>Since you are going to substitute the basic library many programs
rely on, you can imagine the problems that may occur.</p><p>For me, it so happened that everything went fine until I typed in
<span class="command"><strong>make install</strong></span>.  At about halfway through the installation
process I got an error telling me that <span class="command"><strong>rm</strong></span> was not able to 
run, and I found out that even all the common commands like 
<span class="command"><strong>cp</strong></span>, <span class="command"><strong>ls</strong></span>, <span class="command"><strong>mv</strong></span>, 
<span class="command"><strong>ln</strong></span>, <span class="command"><strong>tar</strong></span>, etc., did not work; all told me
that they were not able to find parts of the library they needed.</p><p>But there is help available.  You can force the compilation of
programs with the libraries compiled into them, so the programs do not need
to look them up from the library.</p><p>For that reason, in this chapter, we will compile all the
utilities we need for the install into a static version.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="things-you-will-definitely-need"></a>2.1. Things you will definitely need</h3></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="the-gnu-binutils"></a>2.1.1. The GNU-Binutils</h4></div></div></div><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Get the newest version from: <a class="ulink" href="ftp.gnu.org/gnu/binutils" target="_top">ftp.gnu.org/gnu/binutils</a>; at the time of writing, this was version 2.14</p></li><li class="listitem"><p>Open the package: </p><pre class="screen">tar xIvf binutils-2.14.tar.bz2</pre></li><li class="listitem"><p>Change to the directory: </p><pre class="screen">cd binutils-2.14</pre></li><li class="listitem"><p>Configure the Makefiles: </p><pre class="screen">./configure</pre></li><li class="listitem"><p>Compile the sources: </p><pre class="screen">make</pre></li><li class="listitem"><p>Install them with: </p><pre class="screen">make install</pre></li></ol></div><p>
</p><p>
If you run into trouble with the compilation of the binutils,
referring to problems with gettext (indicated by errors like:
<span class="quote">&#8220;<span class="quote">undeclared reference to lib_intl</span>&#8221;</span> or similar) please install the
newest version, available from <a class="ulink" href="ftp.gnu.org/gnu/gettext" target="_top">ftp.gnu.org/gnu/gettext</a>.</p><p>If this does not help, try disabling the native-language support by using: </p><pre class="screen">./configure --no-nls</pre><p>You don't need to build a static version of the binutils, though it
would not hurt, but I encountered many systems running with very
old versions and ran into errors almost every time, so I think it
is a good idea to mention them here.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="gnu-make"></a>2.1.2. GNU make</h4></div></div></div><p>The <span class="command"><strong>make</strong></span> command is responsible for the compiling of the sources, calling gcc and all the other programs needed for a compile.
Since you may need to compile something if a problem occurs with the new glibc, it is a good idea to have it
static, otherwise it might not work after an error appears.</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Download the source from <a class="ulink" href="ftp.gnu.org/gnu/make/" target="_top">ftp.gnu.org/gnu/make/</a>; at the time of writing the current version was 3.80</p></li><li class="listitem"><p>Unpack the source, eg.: </p><pre class="screen">tar xIvf make-3.80.tar.bz2</pre></li><li class="listitem"><p>Change to the created directory: </p><pre class="screen">cd make-3.80</pre></li><li class="listitem"><p>Take care that the binaries are built static: </p><pre class="screen">export CFLAGS="-static -O2 -g"</pre></li><li class="listitem"><p>Run the configure script: </p><pre class="screen">./configure</pre></li><li class="listitem"><p>Compile the stuff: </p><pre class="screen">make</pre></li><li class="listitem"><p>Install the binaries: </p><pre class="screen">make install</pre></li><li class="listitem"><p>Make a check:</p><pre class="screen">make -v</pre><p> You should now see the new version installed.  If not, check for older binary files and replace them by smlinks to the new version.</p></li></ol></div><p>
</p><p>
Congratulations! You have compiled another static-linked program.
</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="gnu-core-utils"></a>2.1.3. the GNU core-utils</h4></div></div></div><p>The core-utils are commands like: <span class="command"><strong>cp</strong></span>, <span class="command"><strong>rm</strong></span>, <span class="command"><strong>ln</strong></span>, <span class="command"><strong>mv</strong></span>, etc. In case of an
error in the installation, these are an absolute requirement to
help bring your system up again, so static binaries are really necessary
here.</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Again, download the source tarball from: <a class="ulink" href="ftp.gnu.org/gnu/coreutils/" target="_top">ftp.gnu.org/gnu/coreutils/</a>; at the time of writing, version 5.0 was current.</p></li><li class="listitem"><p>Unpack it: </p><pre class="screen">tar xIvf coreutils-5.0.tar.bz2</pre></li><li class="listitem"><p>Change to the directory: </p><pre class="screen">cd coreutils-5.0</pre></li><li class="listitem"><p>Take care that the binaries are built static:</p><pre class="screen">export CFLAGS="-static -O2 -g"</pre></li><li class="listitem"><p>Configure the package: </p><pre class="screen">./configure</pre></li><li class="listitem"><p>Compile the binaries: </p><pre class="screen">make</pre></li><li class="listitem"><p>And install them: </p><pre class="screen">make install</pre></li><li class="listitem"><p>Verify that the right core-utils are used: </p><pre class="screen">cp --version</pre><p>.  You should see the correct version, otherwise remove any old binaries and replace them with symlinks to the new version.</p></li></ol></div><p>
</p><p>
Now that the binaries of these very elementary tools are static,
you can be sure they will work every time you need them.
</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="gnu-tar"></a>2.1.4. GNU tar</h4></div></div></div><p>You have already used GNU tar to unpack all the programs compiled
and installed so far. But maybe you need to compile another
program which is needed by glibc after you had a crash, and in
this situation (I experienced this myself!) it is very useful to
have a working <span class="command"><strong>tar</strong></span> ready to unpack the missing programs.
With tar, we also need to take care of the
bz2 compression algorithm, which is not included in the normal
source distribution of tar.</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Get the source of GNU tar from <a class="ulink" href="ftp.gnu.org/gnu/tar" target="_top">ftp.gnu.org/gnu/tar</a>; at the time of writing, version 1.13 was up-to-date.</p></li><li class="listitem"><p>As many source tarballs are compressed with bzip2, we would like to have the support built in, rather than working with pipes, so get the patch from:
    <a class="ulink" href="ftp://infogroep.be/pub/linux/lfs/lfs-packages/4.1/tar-1.13.patch" target="_top">ftp://infogroep.be/pub/linux/lfs/lfs-packages/4.1/tar-1.13.patch</a>.
    </p></li><li class="listitem"><p>Unpack the source by invoking: </p><pre class="screen">tar xzvf tar-1.13.tar.gz</pre></li><li class="listitem"><p>Copy the patch to the source directory of tar: </p><pre class="screen">cp tar-1.13.patch tar-1.13/</pre></li><li class="listitem"><p>Apply the patch: </p><pre class="screen">patch -Np1 -i tar-1.13.patch</pre></li><li class="listitem"><p>Set the compiler flags to make a static binary: </p><pre class="screen">export CFLAGS="-static -O2 -g"</pre></li><li class="listitem"><p>Now we are ready to configure: </p><pre class="screen">./configure</pre></li><li class="listitem"><p>Compile with: </p><pre class="screen">make</pre></li><li class="listitem"><p>And as the next step, install the package:</p><pre class="screen">make install</pre></li><li class="listitem"><p>Do a quick check to ensure the new version is being used from now on: </p><pre class="screen">tar --version</pre><p>  The version you just installed should display, otherwise 
    check for old binaries and replace them with symlinks to the new location.</p></li></ol></div><p>If you experience problems with the execution of <span class="command"><strong>make</strong></span>, try to turn
off native-language support (nls).  You may achieve this by
invoking configure with the option: </p><pre class="screen">--disable-nls</pre><p><span class="emphasis"><em>Note:</em></span> In this new version of tar, you must use the <code class="option">-j</code> switch to
decompress .bzip2 files, so instead of </p><pre class="screen">tar xIvf anyfile.tar.bz2</pre><p> you now have to use </p><pre class="screen">tar xjvf anyfile.tar.bz2</pre><p> I
do not know why this was changed, but it works fine.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="the-bash"></a>2.1.5. The Bash shell</h4></div></div></div><p>
I prefer Bash as my shell; if you use a different one, please be sure you have installed a static version of it before you install glibc.</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Get Bash from: <a class="ulink" href="ftp.gnu.org/gnu/bash/" target="_top">ftp.gnu.org/gnu/bash/</a>. Download the newest
  version you can find; at the time of writing this was version 2.05b.</p></li><li class="listitem"><p>Unpack the source tree: </p><pre class="screen">tar xzvf bash-2.05b.tar.gz</pre><p> which
  will create a directory called <code class="filename">bash-2.05b</code> with all the unpacked sources in it.</p></li><li class="listitem"><p>Go to the directory: </p><pre class="screen">cd bash-2.05a</pre></li><li class="listitem"><p>Set everything up for building a static version:  </p><pre class="screen">export CFLAGS="-static -O2 -g"</pre></li><li class="listitem"><p>Configure the makefiles: </p><pre class="screen">./configure</pre><p> If you would like something special in your Bash, see </p><pre class="screen">./configure --help</pre><p>
  for a list of options.</p></li><li class="listitem"><p>Compile everything: </p><pre class="screen">make</pre></li><li class="listitem"><p>Install the compiled binaries: </p><pre class="screen">make install</pre><p> This will install the binaries to <code class="filename">/usr/local/bin/</code>.</p></li><li class="listitem"><p>Make sure there is not another version laying around (like in my Suse-Linux: <code class="filename">/bin/</code>), by copying the file:
  </p><pre class="screen">cp /usr/local/bin/bash /bin/</pre><p> We don't use a symlink here because both at boot-time and when starting Bash there might be trouble with symlinks.
  </p></li></ol></div><p>
</p><p>You now have installed a static version of Bash.  For that reason,
the binary is much bigger than usual, but it will run under all
circumstances.</p><p>
If you prefer to use another shell, you are free to do so, but make
sure it is a statically-linked version. Feel free to email me a method to
build the shell of your choice in a static version, and chances are good
that it will be implemented in the next revision of this document.
</p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="software-that-may-come-in-handy"></a>2.2. Software that may come in handy</h3></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="midnight-commander"></a>2.2.1. Midnight Commander</h4></div></div></div><p>
Midnight Commander is a very useful file manager, supporting
many nice features like transparent decompression of packed files,
built-in copy, move and other common commands, as well as an
integrated editor.</p><p>To compile this piece of software, you will need to have glib
installed; in some distributions this is already the case. If you
get an error in the <span class="command"><strong>make</strong></span> command saying that ld could not 
find glib, you will need to install this library first. You can get the sources from:
<a class="ulink" href="ftp.gnome.org/pub/gnome/sources/glib/2.2/" target="_top">ftp.gnome.org/pub/gnome/sources/glib/2.2/</a>, and the installation is straight-forward.</p><p>Here are the steps to build Midnight Commander:</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Get the source from
    <a class="ulink" href="http://www.ibiblio.org/pub/Linux/utils/file/managers/mc/" target="_top">http://www.ibiblio.org/pub/Linux/utils/file/managers/mc/"</a>;
    at the time of writing, the newest version was 4.6.0.</p></li><li class="listitem"><p>Unpack the sources: </p><pre class="screen">tar xzvf mc-4.6.0.tar.gz</pre></li><li class="listitem"><p>Change to the directory you just created: </p><pre class="screen">cd mc-4.6.0</pre></li><li class="listitem"><p>Set up the configuration-files: </p><pre class="screen">./configure</pre></li><li class="listitem"><p>Start compiling: </p><pre class="screen">make</pre></li><li class="listitem"><p>Install everything: </p><pre class="screen">make install</pre></li></ol></div><p>
</p></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="the-install-of-glibc-itself"></a>Chapter 4. The installation of glibc itself</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="sect1"><a href="#obtaining-and-compiling-the-source">1. Obtaining and compiling the source</a></span></dt><dt><span class="sect1"><a href="#the-installation">2. The installation</a></span></dt><dd><dl><dt><span class="sect2"><a href="#lilo">2.1. LILO</a></span></dt><dt><span class="sect2"><a href="#grub">2.2. Grub</a></span></dt></dl></dd><dt><span class="sect1"><a href="#after-the-kernel-is-booted">3. After the kernel is booted...</a></span></dt></dl></div><p>Now we come to the most important thing: the glibc install.</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="obtaining-and-compiling-the-source"></a>1. Obtaining and compiling the source</h2></div></div></div><p>There are several versions of glibc available, but not in all cases are 
new versions really better than the old ones. The best thing you
can do to find out which works and which ones you should not use is to
check out the different forums on the Internet.  If you have
someone to ask, talk to him about the topic.  Maybe he already has
installed the new version and might be able to tell you that version x.y.z is a
PITA, but version a.b.c works really well!</p><p>I decided to install glibc-2.2.4, as I was told it
works well, but it is your decision which one to choose.</p><p>Ok, now let's go to work:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Get the source from <a class="ulink" href="ftp.gnu.org/gnu/glibc/" target="_top">ftp.gnu.org/gnu/glibc/</a>; as I said, I used version 2.2.4.</p></li><li class="listitem"><p>Unpack the source: </p><pre class="screen">tar -xzvf glibc-2.2.4.tar.gz</pre></li><li class="listitem"><p>In addition, you will need a package called 
<span class="quote">&#8220;<span class="quote">linuxthreads,</span>&#8221;</span> found in the <code class="filename">linuxthreads</code> 
directory on
    <a class="ulink" href="ftp.gnu.org" target="_top">ftp.gnu.org</a>.  The file is called: </p><pre class="screen">glibc-linuxthreads-2.2.4.tar.gz</pre><p> Make sure you get the version that 
corresponds to your glibc source tree.</p></li><li class="listitem"><p>Copy the linuxthreads package to your glibc source directory: </p><pre class="screen">cp glibc-linuxthreads-2.2.4.tar.gz glibc-2.2.4</pre></li><li class="listitem"><p>Change to the glibc directory: </p><pre class="screen">cd glibc-2.2.4</pre></li><li class="listitem"><p>Unpack linuxthreads: </p><pre class="screen">tar xzvf linux-threads-2.2.4.tar.gz</pre></li><li class="listitem"><p>Configure the package:</p><pre class="screen">./configure --enable-add-ons=linuxthreads</pre><p> This will configure the
    package in such a way that the linuxthreads are included in the
    compile; this is necessary for compliance with other
    Linux systems.  For example, programs you compile will probably
    not run on another machine if you forget to include this
    package.</p></li><li class="listitem"><p>Afterwards, start the compilation of glibc:
    </p><pre class="screen">make</pre><p> This may take some time (about half an hour on my
    Duron XP, running with 1.5 GHz).</p></li></ol></div><p>
</p><p>
Now that the library is compiled, everything is ready for the
installation, but things are not as easy this time.
</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="the-installation"></a>2. The installation</h2></div></div></div><p>
To install glibc you need a system with nothing running on it,
since many processes (for example sendmail) always try to use the
library and therefore block the files from being replaced.
Therefore we need a <span class="quote">&#8220;<span class="quote">naked</span>&#8221;</span> system, running nothing except
the things we absolutely need. You can achieve this by passing
the boot option </p><pre class="screen">init=/bin/bash</pre><p> to your kernel. Depending on
your bootloader you may need to do different things. In the following I will explain this using the two most common bootloaders, LILO (LInux-LOader)
and GNU grub, as examples.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="lilo"></a>2.1. LILO</h3></div></div></div><p>To start the <span class="quote">&#8220;<span class="quote">only-basics</span>&#8221;</span> system, reboot your computer and
at the LILO prompt enter the kernel image-name you like to load and
append </p><pre class="screen">init=/bin/bash</pre><p> to it before pressing 
<span class="keycap"><strong>Return</strong></span>.
If you are planing to replace your glibc more often, it might be a
good idea to add a separate configuration to your
<code class="filename">/etc/lilo.conf</code>.  For details, refer to the man-page of LILO.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="grub"></a>2.2. Grub</h3></div></div></div><p>Grub is a newer bootloader, with enhanced support for different
operating systems and file system types (eg. it supports booting from
reiserfs partitions).  If you would like to know more go to:
<a class="ulink" href="http://www.gnu.org/software/grub/" target="_top">http://www.gnu.org/software/grub/</a>, where you will find all the stuff you need.</p><p>If you already have Grub installed, you probably use the
text-based front-end to select the kernel you prefer to boot. Grub
has a nice feature&#8212;instead of returning to doing everything by
hand, you can simply select your entry and type <span class="keycap"><strong>e</strong></span>, which will
bring up an option menu. In this menu you will see the commands Grub
executes prior to booting the kernel. Simply select the line saying
</p><pre class="screen">kernel="/where/your-kernel-is and-options-are"</pre><p> and press 
<span class="keycap"><strong>e</strong></span> again.  Now you can edit this line. Here you just add
</p><pre class="screen">init=/bin/bash</pre><p> and after pressing <span class="keycap"><strong>Return</strong></span> to 
make the changes take effect, press <span class="keycap"><strong>b</strong></span> to start booting.</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="after-the-kernel-is-booted"></a>3. After the kernel is booted...</h2></div></div></div><p>
...You will find yourself in an absolute minimal bash-environment.</p><p>You will not even be asked to enter your username or password!
At this time you are the ultimate super-user; no-one can get
around you because the system is in single-user mode, so be
careful what you are doing.  There are no file-rights set or anything else!</p><p>Your prompt will probably look like this: </p><pre class="screen">init-x.y#</pre><p>
At this moment your root (/) has been mounted as read-only, thus
you will not be able to write the new library to your hard drive.
To make it <code class="varname">r/w</code>, enter the command:
</p><pre class="screen">mount -o remount,rw /</pre><p>
If your source is located on another partition you must also
mount it, as it is not done for you (for me this means mounting my
raid system): </p><pre class="screen">mount -t reiserfs /dev/md0 /usr/src</pre><p> As you
see, I defined the file system type, which is needed because 
<span class="command"><strong>mount</strong></span> does not look anything up in <code class="filename">/etc/fstab</code>.</p><p>Now you can go to the directory containing the source and type
in: </p><pre class="screen">make install</pre><p>If you like, now might be a good time to pray that everything works out fine... ;-)</p><p>If everything went through properly, you will return to your prompt
after the installation without any error message. In all other
cases, please see <a class="xref" href="#troubleshooting" title="Chapter 5. Troubleshooting&#8212;if something goes wrong...">Chapter 5, <i>Troubleshooting&#8212;if something goes wrong... </i></a>.</p><p>If everything goes fine, run: </p><pre class="screen">ldconfig -v</pre><p> to update your
library cache.</p><p>Congratulations! The library is successfully installed. Now type
in: <span class="command"><strong>mount -o remount,ro /</strong></span> to ensure that all the data is
written to the hard drive.</p><p>Now start the reboot: </p><pre class="screen">exit</pre><p>
This will cause an error message saying that you have caused a
kernel-panic. If possible, restart the computer by using
<span class="keycap"><strong>CTRL</strong></span>+<span class="keycap"><strong>ALT</strong></span>+<span class="keycap"><strong>DEL</strong></span>, otherwise use your hardware's reset switch.</p><p>Try booting your normal kernel. If everything turns out fine, you
are ready to use the new library.</p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="troubleshooting"></a>Chapter 5. Troubleshooting&#8212;if something goes wrong... </h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="sect1"><a href="#errors-with-configure-or-make-while-trying-to-compile-the-glibc">1. Errors with <span class="command"><strong>configure</strong></span> or <span class="command"><strong>make</strong></span> 
while trying to compile glibc</a></span></dt><dt><span class="sect1"><a href="#something-goes-wrong-during-make-install">2. Something goes wrong during <span class="command"><strong>make install</strong></span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#going-back-to-a-working-configuration">2.1. Going back to a working configuration</a></span></dt></dl></dd></dl></div><p>If you come to this section and you have followed all the instructions
above, you probably encountered the problem of different
Linux distributions, some of which do not keep stuff where it should normally
be, but somewhere else. The Suse Linux distributions are most
famous for such stupid quirks, but there may be others having
similar problems. If you encounter such a thing and you find the
cause for the trouble&#8212;and hopefully a solution&#8212;please let me
know and I will add this to my HOWTO.</p><p>I think this section will never really be complete, but I
will list some possible errors and solutions for these issues.</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="errors-with-configure-or-make-while-trying-to-compile-the-glibc"></a>1. Errors with <span class="command"><strong>configure</strong></span> or <span class="command"><strong>make</strong></span> 
while trying to compile glibc</h2></div></div></div><p>Sometimes you get configuration error telling you that, for example, a
requirement is not met&#8212;typical for software or other
library-packages which are to old. I encountered this with a series of
programs, especially during the compile of all the static
software. Normally there should be no problem: get an up-to-date
version of the software or libraries needed and then compile them
according to the description found in the source tree (usually
called <code class="filename">README</code>, <code class="filename">INSTALL</code> or 
something similar).</p><p>But there are sometimes cases where this just does not want to work. For
example, I experienced problems compiling a new version of my
binutils (one of the reasons why I mention them in the
requirements), as I needed to compile glibc.
In return, the configure script for the binutils told me, <span class="quote">&#8220;<span class="quote">Your
glibc is to old!</span>&#8221;</span>  So I thought, <span class="emphasis"><em>Here the snake starts eating
its tail</em></span>. Thankfully there is a solution for this problem: if you 
can not take one big step, try taking smaller ones, but more of them.</p><p>In my distribution, a glibc with the version number 2.1.1 was
included. To get around the error I tried to compile version
2.1.3, which was no problem. After I installed this version of the
library, I tried to compile the binutils once more, and this time
all the requirements were met.</p><p>If you encounter such a <span class="quote">&#8220;<span class="quote">loop,</span>&#8221;</span> try to find out what 
version of the software required is the minimum, then download that version
(I think that is one of the reasons why so many old versions are
still lying around on the FTP servers). After successfully
compiling and installing, try to build the software that
complained about the version again; in most cases you should now be
able to compile. It may be necessary that you continue to use this method 
to compile missing or old software.
This is what I call <span class="quote">&#8220;<span class="quote">the long tail of the rat</span>&#8221;</span> or
<span class="quote">&#8220;<span class="quote">domino-effect.</span>&#8221;</span>  You only wanted to do one thing, but you needed
to do many more before you could make the move you wanted to. It
might be very nasty, but there is one good side to it:  afterwards
you can be quite sure that many of the programs which were really
old will replaced by the time you finish your installation.
</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="something-goes-wrong-during-make-install"></a>2. Something goes wrong during <span class="command"><strong>make install</strong></span></h2></div></div></div><p>The most common mistake is not to have a set of basic, static tools; 
in this case you can only use the command <span class="command"><strong>cd</strong></span>,
but nothing else. This is the reason why in this HOWTO I have described
in detail how to make those tools static.</p><p>The only tool not static is <span class="command"><strong>mount</strong></span> and, for good 
reason in my opinion, it is included in the package of
linux-utils, which also contains <span class="command"><strong>login</strong></span>, 
<span class="command"><strong>passwd</strong></span>, etc.  Since you are
not able to use statically-linked versions in combination with PAM or
other security-related software, it would be unwise to
compile them statically under all circumstances. Of course you are free to do so if you are really sure about what you are doing.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="going-back-to-a-working-configuration"></a>2.1. Going back to a working configuration</h3></div></div></div><p>The way back to a working configuration is quite simple if you
have the static tools:  go to the directory 
<code class="filename">/usr/local/lib/</code>
and move all the newly installed files into another location (eg.
<code class="filename">/usr/local/lib/storedaway</code>). You may identify them by
looking at their version number, which should be the same as the one from
your glibc installation (in my example all files fitted to
the scheme lib*-2.2.4), and of course by the creation date and
time. It is quite uncommon that two different libraries have the
same version number at the same time&#8212;I, myself, have never
experienced such a thing&#8212;but just to be sure you do not delete
something important to your system, check the date and
time of creation. A very useful tool in this case is the Midnight
Commander, if you have it installed.</p><p>You could try to remove the files <code class="filename">ld-2.2.4.so</code> and
<code class="filename">libc-2.2.4.so</code> and run <span class="command"><strong>ldconfig -v</strong></span> afterwards, before
removing all the crashed files.  This will enable you to use at
least most of your programs and in every case you will be able
to run the Midnight Commander.</p><p>Do not forget to do at least one <span class="command"><strong>ldconfig -v</strong></span> after you have removed all the files.</p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="removing-the-causes-for-the-crashing-of-the-installation"></a>2.1.1. Removing the causes for the crashing of the installation</h4></div></div></div><p>A common cause for problems is that your distribution has stored
all the library files in a different location than the newly-installed
routine will use, thus it often happens that there are two
versions running simultaneously, disturbing each other. In my case,
lots of trouble was caused by a second copy of <code class="filename">libc6.so</code> 
lying around in <code class="filename">/lib</code>, a symbolic link from this file to
the corresponding one in <code class="filename">/usr/local/lib</code> fixes this problem.
</p></div></div></div></div></div></body></html>
