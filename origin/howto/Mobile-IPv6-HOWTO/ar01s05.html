<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>5. Doing some tests</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Linux Mobile IPv6 HOWTO"><link rel="up" href="index.html" title="Linux Mobile IPv6 HOWTO"><link rel="prev" href="ar01s04.html" title="4. Test bed"><link rel="next" href="ar01s06.html" title="6. FAQ"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. Doing some tests</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s04.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s06.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dotest"></a>5. Doing some tests</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="pretest"></a>5.1. Pre-test</h3></div></div></div><p>Do every configuration as shown above; it's especially important 
      to have a different ESSID on the home net and visited network. </p><p>When you start mobile-IPv6 on MN, you will see 
      multicasting router solicitations messages:</p><pre class="screen">
      # tcpdump -i eth0 -vv ip6 or proto ipv6

      ...
      13:32:54.681763 fe80::202:a5ff:fe6f:a08a &gt; ff02::2: icmp6: router solicitation \
      (src lladdr: 0:2:a5:6f:a0:8a) (len 16, hlim 255)

      13:32:55.681763 fe80::202:a5ff:fe6f:a08a &gt; ff02::2: icmp6: router solicitation \
      (src lladdr: 0:2:a5:6f:a0:8a) (len 16, hlim 255)

      13:32:57.681765 fe80::202:a5ff:fe6f:a08a &gt; ff02::2: icmp6: router solicitation \
      (src lladdr: 0:2:a5:6f:a0:8a) (len 16, hlim 255)
      ...

      </pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="MovDet"></a>5.2. Movement detection</h3></div></div></div><p>Generic movement detection uses Neighbor Unreachability
      Detection to detect when the default router is no longer
      bi-directionally reachable, in which case the mobile node must
      discover a new default router (usually on a new link).</p><p> To easily see whats going on, you should have one xterm
      window for each of these commands: </p><pre class="screen">
      # watch ifconfig eth0
      # watch route -A inet6
      # tcpdump -i eth0 -vv ip6 or proto ipv6
      </pre><p>To <span class="quote">&#8220;<span class="quote">travel</span>&#8221;</span> to another net, you can issue the
      command on MN:</p><pre class="screen">
      # iwconfig eth1 essid visitnet
      </pre><p>The MN is then on the other wireless network, and since it is
      sending out <span class="quote">&#8220;<span class="quote">router solicitation</span>&#8221;</span> (multicast), our AR will
      respond with it's prefix. MN will then configure itself with at new
      IPv6 address with the received prefix and it's own MAC address. If
      you type <span class="command"><strong>ifconfig eth0</strong></span> you will see the new IPv6 
      address:</p><pre class="screen">
    # ifconfig eth0
    eth0  Link encap:Ethernet  HWaddr 00:90:7D:F3:03:1A  
          inet6 addr: fec0:106:1100:0:290:7dff:fef3:31a/64 Scope:Site <a name="newaddr"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
          inet6 addr: fec0:106:2700:0:290:7dff:fef3:31a/64 Scope:Site <a name="superadr"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
          inet6 addr: fec0:106:2700::4/64 Scope:Site                  <a name="oldaddr"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
          inet6 addr: fe80::290:7dff:fef3:31a/64 Scope:Link           <a name="linkaddr"></a><span><img src="images/callouts/4.png" alt="4" border="0"></span>
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:854 errors:154 dropped:154 overruns:0 frame:148
          TX packets:293 errors:58 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:100 
          RX bytes:96536 (94.2 Kb)  TX bytes:44664 (43.6 Kb)
          Interrupt:3 Base address:0x100

      </pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#newaddr"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>The new <span class="quote">&#8220;<span class="quote">foreign</span>&#8221;</span> address, generated by
          combining AR's prefix and MAC-address</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#superadr"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>The superfluous home network address (because of HA
          radvd messages and MN autoconf set to
          <span class="quote">&#8220;<span class="quote">true</span>&#8221;</span>).</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#oldaddr"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>The <span class="quote">&#8220;<span class="quote">original</span>&#8221;</span> (home) address</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#linkaddr"><span><img src="images/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>The link-local address generated at boot</p></td></tr></table></div><p>Almost at the same time, the MN will perform a binding update
      to HA. In your tcpdump window, you will see several packets
      destined to HA. To verify that the binding update has been sent and
      acknowledged from MN:</p><pre class="screen">
      # mipdiag -s
      Mobile IPv6 Statistics
      NEncapsulations           : 0
      NDecapsulations           : 0
      NBindUpdatesRcvd          : 0
      NBindAcksRcvd             : 1    <a name="back"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
      NBindNAcksRcvd            : 0
      NBindRqsRcvd              : 0
      NBindUpdatesSent          : 1    <a name="bupdate"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
      NBindAcksSent             : 0
      NBindNAcksSent            : 0
      NBindRqsSent              : 0
      NBindUpdatesDropAuth      : 0
      NBindUpdatesDropInvalid   : 0
      NBindUpdatesDropMisc      : 0
      NBindAcksDropAuth         : 0
      NBindAcksDropInvalid      : 0
      NBindAcksDropMisc         : 0
      NBindRqsDropAuth          : 0
      NBindRqsDropInvalid       : 0
      NBindRqsDropMisc          : 0
     </pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#back"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>One binding ACK received.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#bupdate"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>One binding UPDATE sent.</p></td></tr></table></div><p>You can also verify the binding with the following command
     (on MN):</p><pre class="screen">
     # mipdiag -l
     Mobile IPv6 Binding update list
     Recipient CN: fec0:106:2700::2
     BINDING home address: fec0:106:2700::4 care-of address: fec0:106:1100:0:290:7dff:fef3:31a
             expires: 936 sequence: 0 state: 1
             delay: 3 max delay 32 callback time: 736
     </pre><p>You can also verify it on HA with the statistics option
     (-s) and with the <span class="quote">&#8220;<span class="quote">binding cache</span>&#8221;</span> (-c) option:</p><pre class="screen">
     # mipdiag -c
     Mobile IPv6 Binding cache
     Home Address      Care-of Address                    Lifetime  Type 
     fec0:106:2700::4  fec0:106:1100:0:290:7dff:fef3:31a  971       2    
     </pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="ping6"></a>5.3. ping6</h3></div></div></div><p>From the MN, you can try to ping AR's eth1
     (fec0:106:1100::1):</p><pre class="screen">
     # ping6 fec0:106:1100::1
     PING fec0:106:1100::1(fec0:106:1100::1) from fec0:106:2700::4 : 56 data bytes
     64 bytes from fec0:106:1100::1: icmp_seq=1 ttl=62 time=8.01 ms
     64 bytes from fec0:106:1100::1: icmp_seq=2 ttl=62 time=8.02 ms
     ...
     </pre><p>By using tcpdump, you can see how the packets travel:</p><pre class="screen">
     12:13:51.789688 fec0:106:1100:0:202:a5ff:fe6f:a08a &gt; fec0:106:2700::2: \  <a name="mntoha"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
     fec0:106:2700::4 &gt; fec0:106:1100::1: icmp6: echo request \ <a name="hatocr"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
     (len 64, hlim 64) (len 104, hlim 255)

     12:13:51.797675 fec0:106:2700::2 &gt; fec0:106:1100:0:202:a5ff:fe6f:a08a: \ <a name="artomn"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
     fec0:106:1100::1 &gt; fec0:106:2700::4: icmp6: echo reply \
     (len 64, hlim 62) (len 104, hlim 253)
     </pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#mntoha"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>The packet first goes from MN to the HA using MN new
          IPv6 address.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#hatocr"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>Then from HA to AR.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#artomn"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>The AR then responds to HA and tunnels the packets to
          MN.</p></td></tr></table></div><p>You can now see the statistics have been updated (on MN):</p><pre class="screen">
     # mipdiag -s
     Mobile IPv6 Statistics
     NEncapsulations           : 56
     NDecapsulations           : 25
     ...
    </pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="routeTable"></a>5.4. Kernel IP routing table</h3></div></div></div><p>One interesting thing MIPv6 does is change the default route to
    a tunnel. The new default route becomes:</p><pre class="screen">
    # route -A inet6
    Kernel IPv6 routing table
    Destination      Next Hop       Flags Metric Ref    Use Iface
    ::/0             ::             UD    64     0        0 ip6tnl1
    ....
    </pre><p>If it doesn't add a default route, you may add it manually:</p><pre class="screen">
    # ip route ::/0 via dev ip6tnl
    </pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="movement"></a>5.5. Travelling through several foregin LAN's</h3></div></div></div><p>To travel to several visited networks, is no different than
    travel to <span class="emphasis"><em>one</em></span> network. The only thing you
    must have in mind is that you will generate a new address for each
    visited network.
    </p><div class="mediaobject" align="center"><a name="LANvisits"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="550"><tr><td align="center"><img src="images/lanvisits.png" align="middle" width="550"></td></tr></table><div class="caption"><p>MN travelling through severeal different LANs.</p></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>MN first visits 'visitnet', as we have been through above.</p></li><li class="listitem"><p>MN is then travelling from 'visitnet' to
      'visitnet2'.</p></li><li class="listitem"><p>When at 'visitnet2', MN generates a new IPv6 address and
        do a new binding update to HA.</p></li><li class="listitem"><p>MN then travels back home. (Se next section.)</p></li></ol></div><p>The AR at <span class="quote">&#8220;<span class="quote">visitnet2</span>&#8221;</span>, is configured exactly
     as the other AR (at <span class="quote">&#8220;<span class="quote">visitnet</span>&#8221;</span>), except using address
     <strong class="userinput"><code>fec0:106:1000::/64</code></strong> instead of
     <strong class="userinput"><code>fec0:106:1100::/64</code></strong>.</p><p>To make the mobile node travel from 'visitnet' to
     'visitnet2', issue the command (on MN):</p><pre class="screen">
     # iwconfig eth0 essid visitnet2
     </pre><p>You will then see the MN configures itself to the new network:</p><pre class="screen">
    # ifconfig eth0
    eth1  Link encap:Ethernet  HWaddr 00:90:7D:F3:03:1A  
          inet6 addr: fec0:106:1000:0:290:7dff:fef3:31a/64 Scope:Site <a name="net2"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
          inet6 addr: fec0:106:1100:0:290:7dff:fef3:31a/64 Scope:Site 
          inet6 addr: fec0:106:2700:0:290:7dff:fef3:31a/64 Scope:Site 
          inet6 addr: fec0:106:2700::4/64 Scope:Site                  
          inet6 addr: fe80::290:7dff:fef3:31a/64 Scope:Link           
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1073 errors:212 dropped:212 overruns:0 frame:204
          TX packets:371 errors:72 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:100 
          RX bytes:120340 (117.5 Kb)  TX bytes:56912 (55.5 Kb)
          Interrupt:3 Base address:0x100 
     </pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#net2"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>The new autoconfigured address at 'visitnet2'.</p></td></tr></table></div><p><span class="emphasis"><em>Note! You may have to restart mobile-ipv6 on MN
    when coming to a new network!</em></span></p><pre class="screen">
    # /etc/init.d/mobile-ip6 restart
    Stopping Mobile IPv6: OK
    Starting Mobile IPv6: OK
    </pre><p>The MN will then perform a new binding update to HA. Notice
    the new <span class="quote">&#8220;<span class="quote">care-of address</span>&#8221;</span>:</p><pre class="screen">
    # mipdiag -l
    Mobile IPv6 Binding update list
    Recipient CN: fec0:106:2700::2
    BINDING home address: fec0:106:2700::4 care-of address: fec0:106:1000:0:290:7dff:fef3:31a
        expires: 973 sequence: 14 state: 1
        delay: 3 max delay 32 callback time: 773
    </pre><p>You can also see the <span class="quote">&#8220;<span class="quote">binding cache</span>&#8221;</span> on HA has
    been updated:</p><pre class="screen">
    # mipdiag -c
    Mobile IPv6 Binding cache
    Home Address      Care-of Address                    Lifetime  Type 
    fec0:106:2700::4  fec0:106:1000:0:290:7dff:fef3:31a  943       2  
    </pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="home"></a>5.6. Returning home</h3></div></div></div><p>To make the MN return home, you can just issue the
    command:</p><pre class="screen">
    # iwconfig eth0 essid homenet
    </pre><p>The MN will know it is back home, since HA is sending out
    radvd messages with the HA-bit set (AdvHomeAgentFlag), see <a class="xref" href="ar01s04.html#radvdar" title="4.2.4. Configuring radvd on HA">Section 4.2.4, &#8220;Configuring radvd on HA&#8221;</a></p><p>You can see the MN <span class="quote">&#8220;<span class="quote">is back home</span>&#8221;</span>, since the
    binding cache information at HA is flushed (empty):</p><pre class="screen">
    Mobile IPv6 Binding cache
    Home Address      Care-of Address                     Lifetime  Type 
    </pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="realLife"></a>5.7. Real life testing - smooth handover</h3></div></div></div><p>To really get the feel on how mobile IP works, fire up GnomeMeeting
     (See the figure GnomeMeeting and start a netmeeting. Note! You must use
     the latest GnomeMeeting to get support for IPv6! Then do a <span class="quote">&#8220;<span class="quote">travel</span>&#8221;</span>
     and you can see an almost smooth handover.</p><div class="mediaobject" align="center"><a name="gnomemeeting"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="250"><tr><td align="center"><img src="images/gnomemeeting1.png" align="middle" width="250" alt="GnomeMeeting"></td></tr></table><div class="caption"><p>Using GnomeMeeting with IPv6 to test roaming between two
       wireless networks</p></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s04.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s06.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4. Test bed </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 6. FAQ</td></tr></table></div></body></html>
