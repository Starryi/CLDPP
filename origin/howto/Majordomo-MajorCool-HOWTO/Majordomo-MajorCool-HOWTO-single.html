<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Majordomo and MajorCool HOWTO</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
>Majordomo and MajorCool HOWTO</A
></H1
><H3
CLASS="AUTHOR"
><A
NAME="AEN4"
>John Archie</A
></H3
><P
CLASS="PUBDATE"
>15 November 2000<BR></P
><DIV
><DIV
CLASS="ABSTRACT"
><P
></P
><A
NAME="AEN11"
></A
><P
>This document is intended to guide a user through an installation of the Majordomo Mailing List Software and MajorCool.  MajorCool is a utility for managing Majordomo lists via a CGI script; many people who are unfamiliar with Majordomo's text-based nature prefer the more user-friendly, web-based interface of MajorCool.</P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
>1. <A
HREF="#AEN13"
>Introduction</A
></DT
><DD
><DL
><DT
>1.1. <A
HREF="#AEN18"
>Credits</A
></DT
><DT
>1.2. <A
HREF="#AEN28"
>References</A
></DT
></DL
></DD
><DT
>2. <A
HREF="#AEN54"
>Sendmail</A
></DT
><DD
><DL
><DT
>2.1. <A
HREF="#SEC-ALIASES"
>Aliases</A
></DT
><DT
>2.2. <A
HREF="#AEN94"
>Editing <TT
CLASS="FILENAME"
>sendmail.cf</TT
></A
></DT
><DT
>2.3. <A
HREF="#AEN165"
>Configuring <TT
CLASS="FILENAME"
>sendmail.cf</TT
> Using the M4 Configuration</A
></DT
><DT
>2.4. <A
HREF="#SENDMAIL-SECURITY"
>Sendmail Security Concerns</A
></DT
></DL
></DD
><DT
>3. <A
HREF="#AEN253"
>Majordomo</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="#AEN256"
>Preparing to Install</A
></DT
><DT
>3.2. <A
HREF="#AEN279"
>Editing the Installation Files</A
></DT
><DT
>3.3. <A
HREF="#AEN307"
>Installing Majordomo</A
></DT
><DT
>3.4. <A
HREF="#AEN325"
>Creating the Majordomo Aliases</A
></DT
><DT
>3.5. <A
HREF="#AEN332"
>Testing the Configuration</A
></DT
><DT
>3.6. <A
HREF="#AEN342"
>Creating Lists</A
></DT
><DT
>3.7. <A
HREF="#AEN351"
>Further Testing of the Configuration</A
></DT
><DT
>3.8. <A
HREF="#AEN372"
>Creating Better Aliases</A
></DT
><DT
>3.9. <A
HREF="#AEN382"
>Debugging</A
></DT
><DT
>3.10. <A
HREF="#AEN397"
>Majordomo Security Concerns</A
></DT
></DL
></DD
><DT
>4. <A
HREF="#AEN424"
>MajorCool</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="#AEN428"
>Extracting MajorCool</A
></DT
><DT
>4.2. <A
HREF="#AEN441"
>Edit the <B
CLASS="COMMAND"
>Configure</B
> Script</A
></DT
><DT
>4.3. <A
HREF="#AEN452"
>Installing MajorCool</A
></DT
></DL
></DD
><DT
>5. <A
HREF="#AEN478"
>Frequently Asked Questions</A
></DT
><DT
><A
HREF="#AEN516"
>List of Terms</A
></DT
></DL
></DIV
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="AEN13"
>1. Introduction</A
></H2
><P
>This HOWTO is divided into several sections.  The Sendmail portion is a general discussion about Majordomo and how Majordomo interfaces with Sendmail, as well as the various ways Majordomo can be set up and the consequences of such decisions.  In contrast, the rest of the HOWTO is a tutorial guiding a user through a plain installation process of Majordomo.  I recommend going over the generic installation process described in the sections after Sendmail, referencing the appropriate portions of the Sendmail section when necessary (the appropriate sections are mentioned in the appropriate places).  Then, read the Sendmail section carefully and decide exactly how to configure your system.  Finally, a List of Terms provides definitions for some of the more abstruse terms.</P
><P
>Also, if the official sites for downloading any of the software mentioned in this document are down, the tarballs can be found at <A
HREF="http://philosophy.lander.edu/~jarchie/majordomo/"
TARGET="_top"
>my web site</A
>.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN18"
>1.1. Credits</A
></H3
><P
>Thanks go out (in alphabetical order) to a few people for their invaluable help.</P
><P
></P
><UL
><LI
><P
>Lee Archie for proofreading</P
></LI
><LI
><P
>James Bruce and Bill Poston for the opportunity to set up my first permanent machine running Majordomo</P
></LI
><LI
><P
>Joseph D. Sloan for reading the Sendmail portion and making helpful suggestions</P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN28"
>1.2. References</A
></H3
><P
>Although I have tried to make this HOWTO as complete as possible, it is always a good idea to look at more than one source.  Below is a list of the resources that I found helpful when trying to configure Majordomo for the first time.</P
><P
>Books:</P
><P
></P
><UL
><LI
><P
>Bryan Costales with Eric Allman, <EM
>sendmail</EM
>.  Cambridge: O'Reilly, 1997.</P
></LI
><LI
><P
>Alan Schwartz, <EM
>Managing Mailing Lists</EM
>.  Cambridge: O'Reilly, 1998.</P
></LI
></UL
><P
>Free resources:</P
><P
></P
><UL
><LI
><P
>the documentation accompanying Sendmail especially <TT
CLASS="FILENAME"
>README.cf</TT
></P
></LI
><LI
><P
>the documentation accompanying Majordomo especially <TT
CLASS="FILENAME"
>INSTALL</TT
> and <TT
CLASS="FILENAME"
>NEWLIST</TT
></P
></LI
><LI
><P
>the <A
HREF="http://www.hpc.uh.edu/majordomo-users/"
TARGET="_top"
><TT
CLASS="LITERAL"
>Majordomo-Users</TT
></A
> Mailing List Archive.</P
></LI
><LI
><P
>the documentation accompanying MajorCool</P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN54"
>2. Sendmail</A
></H2
><P
>Since Majordomo is responsible for managing E-mail lists, Majordomo relies heavily on a MTA such as Sendmail.  There are other MTA's such as Smail and Qmail out there; however, Sendmail is the oldest and most common.  This section introduces the reader to the areas of Sendmail that are useful or necessary to configure when using Majordomo.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="SEC-ALIASES"
>2.1. Aliases</A
></H3
><P
>The Sendmail aliases file (usually <TT
CLASS="FILENAME"
>/etc/aliases</TT
>) is used for making aliases for E-mail addresses.  For example, once Majordomo is installed, usually an entry in the aliases file reads:

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>majordomo-owner:	jarchie</PRE
></FONT
></TD
></TR
></TABLE
>

This entry means that all mail addressed to <TT
CLASS="LITERAL"
>majordomo-owner@host.com</TT
> will actually be sent to <TT
CLASS="LITERAL"
>jarchie@host.com</TT
>.  Notice it is unnecessary to append the <TT
CLASS="LITERAL"
>@host.com</TT
> to <TT
CLASS="LITERAL"
>jarchie</TT
> because both users are on the same host.  If it were desired to redirect the message to a different user on a different host, one would have to add the <TT
CLASS="LITERAL"
>@host.com</TT
> portion.  </P
><P
>Another type of entry in the aliases file allows E-mail to be redirected to multiple addresses listed in a file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>testlist:		:include:/usr/local/majordomo-1.94.5/lists/testlist</PRE
></FONT
></TD
></TR
></TABLE
>

This entry states that any message sent to <TT
CLASS="LITERAL"
>testlist@host.com</TT
> will be redirected to all the addresses listed in the file <TT
CLASS="FILENAME"
>/usr/local/majordomo-1.94.5/lists/testlist</TT
>.  The <TT
CLASS="FILENAME"
>testlist</TT
> file might look something like this:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>johnarchie@emeraldis.com
srobirds@yahoo.com
acreswell@geocities.com</PRE
></FONT
></TD
></TR
></TABLE
>

Majordomo is able to add or remove addresses from a list by taking advantage of this feature.  When a <TT
CLASS="LITERAL"
>subscribe</TT
> request is processed, the user's E-mail address is appended to the <TT
CLASS="FILENAME"
>testlist</TT
> file; when an <TT
CLASS="LITERAL"
>unsubscribe</TT
> request is processed, the user's E-mail address is removed from the <TT
CLASS="FILENAME"
>testlist</TT
> file.  One can also add or remove addresses manually simply by editing the file with a text editor such as <B
CLASS="COMMAND"
>vi</B
>.</P
><P
>Since Majordomo needs to be able to process commands sent to it via E-mail, Sendmail must be able to execute the Majordomo program and pass the message to it.  This is done by adding another type of entry to the <TT
CLASS="FILENAME"
>aliases</TT
> file:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>majordomo:		"|/usr/local/majordomo-1.94.5/wrapper majordomo"</PRE
></FONT
></TD
></TR
></TABLE
>

The program <TT
CLASS="FILENAME"
>/usr/local/majordomo-1.94.5/wrapper</TT
> is a wrapper (SUID <TT
CLASS="LITERAL"
>majordomo</TT
> and SGID <TT
CLASS="LITERAL"
>majordomo</TT
> or <TT
CLASS="LITERAL"
>daemon</TT
> depending on the configuration) that runs the Majordomo program.  The quotation marks around the second part of the alias entry are used to tell Sendmail that this part of the entry is all one statement; the quotation marks would be unnecessary if there were not a space between <TT
CLASS="LITERAL"
>wrapper</TT
> and <TT
CLASS="LITERAL"
>majordomo</TT
>.  The <TT
CLASS="LITERAL"
>|</TT
> is known as a "pipe"; it is used to tell Sendmail to send the E-mail to the wrapper via the standard input.  (Since all the wrapper does here is to call <B
CLASS="COMMAND"
>majordomo</B
>, the E-mail is actually being sent to Majordomo.)  The wrapper accepts one parameter--the parameter of the program it is supposed to execute.  (Any parameters after the first will be passed to the program the wrapper is executing.)  For security reasons, the wrapper only executes programs located in the Majordomo directory, <TT
CLASS="FILENAME"
>/usr/local/majordomo-1.94.5/</TT
>.  This restriction prevents a programmer from using the wrapper to run programs that should not have Majordomo privileges.  (For example, <B
CLASS="COMMAND"
>wrapper /bin/vi</B
> would allow any user to edit any Majordomo configuration file.)  When a message is sent to <TT
CLASS="LITERAL"
>majordomo@host.com</TT
>, Sendmail starts up the wrapper which, in turn, starts up <B
CLASS="COMMAND"
>majordomo</B
>, and Sendmail sends the message to the <B
CLASS="COMMAND"
>majordomo</B
> script via the standard input.  Majordomo then extracts the commands out of the message and responds appropriately.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN94"
>2.2. Editing <TT
CLASS="FILENAME"
>sendmail.cf</TT
></A
></H3
><P
>Due to its arcane syntax, <TT
CLASS="FILENAME"
>sendmail.cf</TT
> is perhaps the most feared of all configuration files.  In the installation of <TT
CLASS="LITERAL"
>majordomo</TT
>, it is not absolutely necessary to edit <TT
CLASS="FILENAME"
>sendmail.cf</TT
>; however, a couple of features are extremely useful.  Unless major changes have to be made to <TT
CLASS="FILENAME"
>sendmail.cf</TT
> (which, thankfully, Majordomo does not require), editing the file is not that difficult.  All that need be done is adding extra lines to the file.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN102"
>2.2.1. Another Aliases File</A
></H4
><P
>Creating a separate file for the Majordomo aliases, such as <TT
CLASS="FILENAME"
>/usr/local/majordomo-1.94.5/majordomo.aliases</TT
>, is often a good idea.  This can be done rather easily by adding a line to the end of the <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>OA/usr/local/majordomo-1.94.5/majordomo.aliases</PRE
></FONT
></TD
></TR
></TABLE
>

To have a <TT
CLASS="FILENAME"
>/usr/local/majordomo-1.94.5/majordomo.aliases</TT
>, Sendmail must be able to generate a database (<TT
CLASS="FILENAME"
>/usr/local/majordomo-1.94.5/majordomo.aliases.db</TT
>).  The easiest way to accomplish this is to go ahead and create an empty database for Sendmail to overwrite.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes majordomo-1.94.5]# </SAMP
><KBD
CLASS="USERINPUT"
>touch majordomo.aliases.db</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes majordomo-1.94.5]# </SAMP
><KBD
CLASS="USERINPUT"
>chmod 644 majordomo.aliases.db</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

Another method to get around this issue is simply to create the <TT
CLASS="FILENAME"
>majordomo.aliases</TT
> file in the <TT
CLASS="FILENAME"
>/etc/</TT
> directory, rather than the Majordomo home directory.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN117"
>2.2.2. Undesirable Sendmail Security Features</A
></H4
><P
>For certain setups, some security measures that Sendmail uses can prevent Majordomo from working properly.  Obviously, these security features must be turned off.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="SEC-SENDTRUST"
>2.2.3. Sendmail Trusted Users</A
></H4
><P
>Sendmail is programmed to make it difficult for people to make "perfect" forgeries of E-mail.  For example, when a user sends a message via SMTP, the source IP address is typically logged, and when a user sends a message by giving it directly to Sendmail and specifying the sender using <B
CLASS="COMMAND"
>sendmail -f</B
>, Sendmail puts a warning message in the header specifying the user who really sent the message.  However, some programs need to be able to send messages masquerading as other users, and having this extra security line appended to the header is annoying.  Sendmail handles this problem by having trusted users.  In order for Majordomo's <B
CLASS="COMMAND"
>resend</B
> script to work properly, <TT
CLASS="LITERAL"
>majordomo</TT
> must be a Sendmail trusted user since the program needs to resend mail from other users.</P
><P
>One way to make Majordomo a trusted user is by adding the line

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Tmajordomo</PRE
></FONT
></TD
></TR
></TABLE
>

to the <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="SMRSH"
>2.2.4. Sendmail Restricted Shell</A
></H4
><P
>If Sendmail is using <B
CLASS="COMMAND"
>smrsh</B
>, then the only programs that can be executed are those under the <TT
CLASS="FILENAME"
>/etc/smrsh/</TT
> directory.  Perhaps the best solution to run the wrapper from the <TT
CLASS="FILENAME"
>aliases</TT
> file is to create a symbolic link from <TT
CLASS="FILENAME"
>/etc/smrsh/wrapper</TT
> to <TT
CLASS="FILENAME"
>/usr/local/majordomo-1.94.5/wrapper</TT
>.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes smrsh]# </SAMP
><KBD
CLASS="USERINPUT"
>ln -s /usr/local/majordomo-1.94.5/wrapper wrapper</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

A second solution is to actually move the wrapper into the <TT
CLASS="FILENAME"
>/etc/smrsh/</TT
> directory.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes smrsh]# </SAMP
><KBD
CLASS="USERINPUT"
>mv /usr/local/majordomo-1.94.5/wrapper ./</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

If security is not a major concern, the secure shell can be disabled.  One fairly crude method is simply to delete <TT
CLASS="FILENAME"
>/usr/sbin/smrsh</TT
> and copy or link <TT
CLASS="FILENAME"
>/bin/sh</TT
> in its place.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes sbin]# </SAMP
><KBD
CLASS="USERINPUT"
>rm -f smrsh</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes sbin]# </SAMP
><KBD
CLASS="USERINPUT"
>ln -s /bin/sh smrsh</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

A better (but more difficult) method is to edit <TT
CLASS="FILENAME"
>sendmail.cf</TT
>.  Change the reference from <TT
CLASS="FILENAME"
>/usr/sbin/smrsh</TT
>

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Mprog,		P=/usr/sbin/smrsh, F=lsDFMoqeu9, S=10/30, R=20/40, D=$z:/,
		T=X-Unix,
		A=sh -c $u</PRE
></FONT
></TD
></TR
></TABLE
>

to <TT
CLASS="FILENAME"
>/bin/sh</TT
>

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>Mprog,		P=/bin/sh, F=lsDFMoqeu9, S=10/30, R=20/40, D=$z:/,
		T=X-Unix,
		A=sh -c $u</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="GROUP-PERM"
>2.2.5. Group Write Permission</A
></H4
><P
>If you plan on having a non-root user add and manage mailing lists, you will need to make the <TT
CLASS="FILENAME"
>majordomo.aliases</TT
> file group writable.  However, Sendmail does not allow this configuration for security reasons (see <A
HREF="#SENDMAIL-SECURITY"
>Section 2.4</A
>).  To disable this security feature, add the line

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>O DontBlameSendmail=GroupWritableAliasFile</PRE
></FONT
></TD
></TR
></TABLE
>

to the <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file.
Also, the lists directory must be group writable in order to add a list, but Sendmail will not allow this setup for similar security reasons.  To disable this security feature, adding the line

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>O DontBlameSendmail=IncludeFileInGroupWritableDirPath</PRE
></FONT
></TD
></TR
></TABLE
>

to the <TT
CLASS="FILENAME"
>sendmail.cf</TT
> configuration file is necessary.</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN165"
>2.3. Configuring <TT
CLASS="FILENAME"
>sendmail.cf</TT
> Using the M4 Configuration</A
></H3
><P
>For administrators who do not want to edit the <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file directly, it is possible to use M4 to create the file; this section describes how to make the changes discussed in the previous section to the mc file instead of the cf file.</P
><P
>The purpose of the M4 configuration is to provide an easy way to create the <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file.  The idea is that the created mc file is easier to understand than the <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file.  By running the m4 preprocessor, a <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file is generated:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes etc]# </SAMP
><KBD
CLASS="USERINPUT"
>m4 /etc/sendmail.mc &#62; /etc/sendmail.cf</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>&#13;</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN177"
>2.3.1. Creating Another Aliases File</A
></H4
><P
>Add the line

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>define(`ALIAS_FILE',`/etc/aliases,/usr/local/majordomo-1.94.5/majordomo.aliases')</PRE
></FONT
></TD
></TR
></TABLE
>

to the <TT
CLASS="FILENAME"
>sendmail.mc</TT
> file.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN182"
>2.3.2. Making Majordomo a Trusted User</A
></H4
><P
>Add the line

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>define(`confTRUSTED_USERS',`majordomo')</PRE
></FONT
></TD
></TR
></TABLE
>

to the <TT
CLASS="FILENAME"
>sendmail.mc</TT
> file.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN187"
>2.3.3. Disabling Sendmail Secure Shell</A
></H4
><P
>Delete the line that reads

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>FEATURE(smrsh)</PRE
></FONT
></TD
></TR
></TABLE
>

in the <TT
CLASS="FILENAME"
>sendmail.mc</TT
> file.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN192"
>2.3.4. Disabling Security Features</A
></H4
><P
>To disable the group write permission security check on the aliases file, add the line

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>define(`confDONT_BLAME_SENDMAIL',`GroupWritableAliasFile')</PRE
></FONT
></TD
></TR
></TABLE
>

to the <TT
CLASS="FILENAME"
>sendmail.mc</TT
> file.</P
><P
>To disable the path write permission security check for the include files, add the line

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>define(`confDONT_BLAME_SENDMAIL',`IncludeFileInGroupWritableDirPath')</PRE
></FONT
></TD
></TR
></TABLE
>

To enable both of these options, use

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>define(`confDONT_BLAME_SENDMAIL',`GroupWritableAliasFile,IncludeFileInGroupWritableDirPath')</PRE
></FONT
></TD
></TR
></TABLE
>

Adding the last statement is equivalent to writing

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>O DontBlameSendmail=GroupWritableAliasFile,IncludeFileInGroupWritableDirPath</PRE
></FONT
></TD
></TR
></TABLE
>

in <TT
CLASS="FILENAME"
>sendmail.cf</TT
>, and this entry is the same as writing the entries on separate lines:

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>O DontBlameSendmail=GroupWritableAliasFile
O DontBlameSendmail=IncludeFileInGroupWritableDirPath</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="SENDMAIL-SECURITY"
>2.4. Sendmail Security Concerns</A
></H3
><P
>Security is inversely proportional to convenience; the only secure machine is one that cannot be accessed by anyone.  When some of Sendmail's security features are disabled, a machine will inevitably become less secure.  However, it is important to understand the basic security risks in order to determine if the convenience out weighs possible breaches of security.</P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="GROUP-SECURITY"
>2.4.1. Consequences of Unsafe Group Writes</A
></H4
><P
>If a user has write permission to access an aliases file, <EM
>she should be a trusted user</EM
>.  By putting an entry into the aliases file (such as the one used to execute <B
CLASS="COMMAND"
>wrapper</B
>) a user can execute any program with the privileges of Sendmail (<TT
CLASS="LITERAL"
>daemon</TT
> or, in older versions, <TT
CLASS="LITERAL"
>root</TT
>).  This gaffe would allow people to remove or change the permissions of files that belong to <TT
CLASS="LITERAL"
>daemon</TT
> (using the <B
CLASS="COMMAND"
>rm</B
> or <B
CLASS="COMMAND"
>chmod</B
> commands in the aliases file).  To some extent, this possibility is avoided by using <B
CLASS="COMMAND"
>smrsh</B
>; however, one must still be careful as to what files are in the <TT
CLASS="FILENAME"
>/etc/smrsh/</TT
> directory.</P
><P
>Another important security issue is that the user who can access the aliases file can append or write to files that belong to <TT
CLASS="LITERAL"
>daemon</TT
> by using file redirection (a <TT
CLASS="LITERAL"
>&#62;&#62;</TT
> or <TT
CLASS="LITERAL"
>&#62;</TT
> instead of a <TT
CLASS="LITERAL"
>|</TT
>).  Even so, this breach too can be countered by adding a line to the <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file limiting what files can be written to through the aliases file.  Add the line

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>O SaveFileEnvironment=/path/to/safe/files</PRE
></FONT
></TD
></TR
></TABLE
>

to the <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file or add

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>define(`confSAFE_FILE_ENV',`/path/to/safe/files')</PRE
></FONT
></TD
></TR
></TABLE
>

to the <TT
CLASS="FILENAME"
>sendmail.mc</TT
> file.
However, this maneuver only leaves a thin layer of security between the user and <TT
CLASS="LITERAL"
>daemon</TT
>.  A much better idea would be to have the aliases file only writable by root and to create an SUID root program to add and remove the Majordomo related aliases.</P
><P
>In the case of include or .forward files, commands or redirections are run as the user who owns  the file.  Therefore, if a file is group writable, a member of the group can execute commands as the user who owns the file.  In other words, any user in the <TT
CLASS="LITERAL"
>majordomo</TT
> group could execute commands as Majordomo.  However, since the <TT
CLASS="LITERAL"
>majordomo</TT
> user is created without a shell, commands or redirections will not be processed in include files owned by <TT
CLASS="LITERAL"
>majordomo</TT
>.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN233"
>2.4.2. Consequences of Unsafe Group Writable Directory Paths</A
></H4
><P
>If a user has group write permission to a directory, for example <TT
CLASS="FILENAME"
>/etc/</TT
>, the user could simply move any file and create a new one in its place.  An attack might go something like this

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[mallory@kes etc]$ </SAMP
><KBD
CLASS="USERINPUT"
>mv aliases ...</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[mallory@kes etc]$ </SAMP
><KBD
CLASS="USERINPUT"
>vi aliases</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

The user can then make her own aliases!  This attack, however, could be prevented by Sendmail's security checking for unsafe group writable paths.  Such an attack also would work with include and .forward files having unsafe paths.</P
><P
>In the case of Majordomo, the user in the <TT
CLASS="LITERAL"
>majordomo</TT
> group already has access to the include files, so this does not really compromise security.  However, an administrator should be careful to prevent these undesirable unsafe group writable directory paths from occurring in the future because Sendmail will <EM
>not</EM
> check for them.</P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="AEN245"
>2.4.3. Protecting Subscribers' Privacy</A
></H4
><P
>Unfortunately, sophisticated spammers can expand mail lists using the <B
CLASS="COMMAND"
>EXPN</B
> SMTP command.  For this reason, administrators should disable this feature when serving mailing lists.  Add the line

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>O PrivacyOptions=noexpn</PRE
></FONT
></TD
></TR
></TABLE
>

to the <TT
CLASS="FILENAME"
>sendmail.cf</TT
> file or

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>define(`confPRIVACY_FLAGS',`noexpn')</PRE
></FONT
></TD
></TR
></TABLE
>

to the <TT
CLASS="FILENAME"
>sendmail.mc</TT
> file.</P
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN253"
>3. Majordomo</A
></H2
><P
>Majordomo is, of course, the piece of code that this document revolves around; it consists of a collection of Perl scripts with the sole purpose of managing mailing lists.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN256"
>3.1. Preparing to Install</A
></H3
><P
>Download the gzipped source distribution of the latest version of Majordomo from <A
HREF="http://www.greatcircle.com/majordomo/"
TARGET="_top"
>Great Circle Associates</A
> and uncompress it

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes jarchie]$ </SAMP
><KBD
CLASS="USERINPUT"
>tar zxvf majordomo-1.94.5.tar.gz</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

This will create a subdirectory with all of the files necessary to install Majordomo; this directory <EM
>cannot</EM
> be the same directory in which Majordomo is to be installed.</P
><P
>Majordomo must run under a specific UID and GID so when any of the scripts are run, they will run under Majordomo's UID.  Thus, it is necessary to decide what UID and GID Majordomo should run under.  Also, Majordomo must be a Sendmail trusted user (see <A
HREF="#SEC-SENDTRUST"
>Section 2.2.3</A
>).</P
><P
>Check the <TT
CLASS="FILENAME"
>/etc/passwd</TT
> and <TT
CLASS="FILENAME"
>/etc/group</TT
> files to find a UID and GID that are not taken.  For this example, a UID of 16 and a GID of 16 was chosen.  You have to decide on the location where the Majordomo scripts will reside; in this HOWTO, the directory <TT
CLASS="FILENAME"
>/usr/local/majordomo-1.94.5/</TT
> was chosen.  If you are using a shadowed password file, add entries similar to

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>majordomo:x:16:16:Majordomo List Manager:/usr/local/majordomo-1.94.5:</PRE
></FONT
></TD
></TR
></TABLE
>

to your <TT
CLASS="FILENAME"
>/etc/passwd</TT
> and add an appropriate entry to <TT
CLASS="FILENAME"
>/etc/shadow</TT
>.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>majordomo:*:10883:0:88888:7:::</PRE
></FONT
></TD
></TR
></TABLE
>

Use the other entries in these files as a guide for exactly what should be added.  <EM
>These are only the values for my system.</EM
>  If you are not using shadowed passwords, only an entry in the <TT
CLASS="FILENAME"
>/etc/passwd</TT
> file is necessary.</P
><P
>To create a Majordomo group, add a line similar to

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>majordomo:x:16:jarchie</PRE
></FONT
></TD
></TR
></TABLE
>

to your <TT
CLASS="FILENAME"
>/etc/group</TT
> file.  Appending your username to the end of the line will give you access to the Majordomo files that are group writable.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN279"
>3.2. Editing the Installation Files</A
></H3
><P
>The <TT
CLASS="FILENAME"
>Makefile</TT
> contains all the information needed to install Majordomo; it is usually necessary to edit lines in the <TT
CLASS="FILENAME"
>Makefile</TT
> that refer to system specific settings so Majordomo will be able to install cleanly on your system.  Most of the default settings are correct; however, the following settings, almost invariably, need to be changed on a per system basis.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes majordomo-1.94.5]$ </SAMP
><KBD
CLASS="USERINPUT"
>vi Makefile</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

The settings

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>PERL = /bin/perl
CC = cc
W_HOME = /usr/test/majordomo-$(VERSION)
MAN = $(W_HOME)/man
W_USER = 123
W_GROUP = 45</PRE
></FONT
></TD
></TR
></TABLE
>

should be changed to something more appropriate for your system.  For example, in my setup, the values were changed to

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>PERL = /usr/bin/perl
CC = gcc
W_HOME = /usr/local/majordomo-1.94.5
MAN = /usr/man
W_USER = 16
W_GROUP = 16</PRE
></FONT
></TD
></TR
></TABLE
>

Also the <TT
CLASS="FILENAME"
>majordomo.cf</TT
> file must be created.  An easy way to create this file is to copy the provided <TT
CLASS="FILENAME"
>sample.cf</TT
> file to <TT
CLASS="FILENAME"
>majordomo.cf</TT
> and edit it.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes majordomo-1.94.5]$ </SAMP
><KBD
CLASS="USERINPUT"
>cp sample.cf majordomo.cf</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes majordomo-1.94.5]$ </SAMP
><KBD
CLASS="USERINPUT"
>vi majordomo.cf</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

Again, most of the settings are correct by default, but the following lines might need to be changed for your system from

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$whereami = "example.com";
$whoami = "Majordomo\@$whereami";
$whoami_owner = "Majordomo-Owner\@$whereami";
     $homedir = "/usr/test/majordomo";
$digest_work_dir = "/usr/local/mail/digest";
$sendmail_command = "/usr/lib/sendmail";</PRE
></FONT
></TD
></TR
></TABLE
>

to something more appropriate such as

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>$whereami = "kes.emeraldis.com";
$whoami = "majordomo\@$whereami";
$whoami_owner = "majordomo-owner\@$whereami";
     $homedir = "/usr/local/majordomo-1.94.5";
$digest_work_dir = "/usr/local/majordomo-1.94.5/digest";
$sendmail_command = "/usr/sbin/sendmail";</PRE
></FONT
></TD
></TR
></TABLE
>

<CODE
CLASS="VARNAME"
>$whoami</CODE
> and <CODE
CLASS="VARNAME"
>$whoami_owner</CODE
> do not need to be changed for Majordomo to work; however, I changed them because I like to avoid typing capital letters.  <CODE
CLASS="VARNAME"
>$digest_work_dir</CODE
> is a temporary directory where digest files should be placed; this directory should be assigned to wherever you want digests to be stored.  If you do not plan to use digested lists, do not worry about this option.  <CODE
CLASS="VARNAME"
>$whereami</CODE
>, <CODE
CLASS="VARNAME"
>$homedir</CODE
>, and <CODE
CLASS="VARNAME"
>$sendmail_command</CODE
> should be changed to appropriate values for your system.  Unlike the <TT
CLASS="FILENAME"
>Makefile</TT
>, these options can always be changed after Majordomo is installed by editing <TT
CLASS="FILENAME"
>majordomo.cf</TT
> in the directory where Majordomo was installed.  (The configuration file is simply copied during setup.)</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN307"
>3.3. Installing Majordomo</A
></H3
><P
>The next step is to compile the Majordomo wrapper.  The wrapper is the only Majordomo component that needs to be compiled because everything else is a collection of perl scripts and, therefore, is not compiled.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes majordomo-1.94.5]$ </SAMP
><KBD
CLASS="USERINPUT"
>make wrapper</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

To install the Majordomo files, execute the commands

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes majordomo-1.94.5]# </SAMP
><KBD
CLASS="USERINPUT"
>make install</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes majordomo-1.94.5]# </SAMP
><KBD
CLASS="USERINPUT"
>make install-wrapper</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

The first command can be done as the Majordomo user (assuming <TT
CLASS="LITERAL"
>majordomo</TT
> can create or has access to <CODE
CLASS="VARNAME"
>$home_dir</CODE
>), but the second command needs to be done as <TT
CLASS="LITERAL"
>root</TT
> so the installation script can SUID root the Majordomo wrapper.  (Since, <TT
CLASS="LITERAL"
>majordomo</TT
> was created without a login shell or password, if you want to execute the first command as <TT
CLASS="LITERAL"
>majordomo</TT
>, you will need to <B
CLASS="COMMAND"
>su majordomo</B
> as root in order to become <TT
CLASS="LITERAL"
>majordomo</TT
>.)</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN325"
>3.4. Creating the Majordomo Aliases</A
></H3
><P
>Sendmail aliases must be created for Majordomo so commands sent to Majordomo can be processed by <B
CLASS="COMMAND"
>majordomo</B
>, and an alias for the Majordomo owner must be created so people can E-mail you through the standard <TT
CLASS="LITERAL"
>owner-majordomo</TT
> address.  Add the following entries to your aliases file (see <A
HREF="#SEC-ALIASES"
>Section 2.1</A
>).

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>majordomo:       "|/usr/local/majordomo-1.94.5/wrapper majordomo"
owner-majordomo: jarchie
majordomo-owner: jarchie</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN332"
>3.5. Testing the Configuration</A
></H3
><P
>As a regular user (<EM
>not</EM
> as <TT
CLASS="LITERAL"
>majordomo</TT
> <EM
>or</EM
> as <TT
CLASS="LITERAL"
>root</TT
>), run

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes jarchie]$ </SAMP
><KBD
CLASS="USERINPUT"
>/usr/local/majordomo-1.94.5/wrapper config-test</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

This program can detect most problems in the Majordomo installation.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN342"
>3.6. Creating Lists</A
></H3
><P
>To create a list, create a file with the name of the list in the Majordomo lists directory.  For example, to create a list called test, create a test file as Majordomo

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes /]# </SAMP
><KBD
CLASS="USERINPUT"
>su majordomo</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[majordomo@kes /]$ </SAMP
><KBD
CLASS="USERINPUT"
>touch /usr/local/majordomo-1.94.5/lists/test</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

and add the related aliases

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>test:	       :include:/usr/local/majordomo-1.94.5/lists/test
owner-test:    jarchie
test-request:  "|/usr/local/majordomo-1.94.5/wrapper request-answer test"
test-approval: jarchie</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN351"
>3.7. Further Testing of the Configuration</A
></H3
><P
>Now test the operation of the list by issuing a <B
CLASS="COMMAND"
>lists</B
> command to Majordomo.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes jarchie]$ </SAMP
><KBD
CLASS="USERINPUT"
>echo lists | mail majordomo</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

It should only take a second for <B
CLASS="COMMAND"
>majordomo</B
> to reply with a message containing all the lists which are currently set up.  Next, try issuing a <B
CLASS="COMMAND"
>help</B
> command.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes jarchie]$ </SAMP
><KBD
CLASS="USERINPUT"
>echo help | mail majordomo</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

Majordomo should reply with a list of all commands that Majordomo accepts.  It might be a good idea to save the message for future reference.</P
><P
>To see if the aliases are working properly, try subscribing and unsubscribing yourself to the list.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes jarchie]$ </SAMP
><KBD
CLASS="USERINPUT"
>echo subscribe test | mail majordomo</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

You will receive an E-mail message containing instructions on how to confirm your subscription as well as a letter confirming that your command was successful.  After sending back your confirmation, Majordomo should send back two letters--one letter stating that your subscribe request was successful and another letter welcoming you to the test list.  The owner of the list will also be sent a message stating that you have subscribed to the list.</P
><P
>To unsubscribe from a list, send a <B
CLASS="COMMAND"
>unsubscribe</B
> command

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes jarchie]$ </SAMP
><KBD
CLASS="USERINPUT"
>echo unsubscribe test | mail majordomo</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

You should be sent back a letter stating that your command was successful.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN372"
>3.8. Creating Better Aliases</A
></H3
><P
>For some lists, it may be desirable to have Majordomo process messages before they reach the list.  For example, Majordomo has the <B
CLASS="COMMAND"
>resend</B
> script to automatically filter messages based on content (such as taboo words), to prevent people from sending Majordomo commands to the list, and other features.  To use these options, it is necessary to use a better set of aliases such as

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>test:        "|/usr/local/majordomo-1.94.5/wrapper resend -l test test-list"
test-list:   :include:/usr/local/majordomo-1.94.5/lists/test
owner-test:  jarchie
test-owner:  jarchie
test-request:  "|/usr/local/majordomo-1.94.5/wrapper majordomo -l test"</PRE
></FONT
></TD
></TR
></TABLE
>

The last entry allows someone simply to send a message to <TT
CLASS="LITERAL"
>test-request@kes.emeraldis.com</TT
> with the text <TT
CLASS="LITERAL"
>subscribe</TT
> rather than sending a letter to <TT
CLASS="LITERAL"
>majordomo@kes.emeraldis.com</TT
> with the text <TT
CLASS="LITERAL"
>subscribe test</TT
>.  Also, note that if sendmail is using smrsh, the above aliases should reference the copy of the wrapper in the safe path--usually <TT
CLASS="FILENAME"
>/etc/smrsh/wrapper</TT
>.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN382"
>3.9. Debugging</A
></H3
><P
>It is common for Majordomo's permissions to be set incorrectly causing Majordomo to work improperly.  Fortunately, Sendmail and Majordomo typically, give decent error messages indicating a problem.  For example, the <TT
CLASS="FILENAME"
>lists</TT
> directory must be executable by the user sendmail setuids to, typically <TT
CLASS="LITERAL"
>mail</TT
> or <TT
CLASS="LITERAL"
>daemon</TT
>.  If <B
CLASS="COMMAND"
>sendmail</B
> cannot execute <TT
CLASS="FILENAME"
>lists</TT
>, the permissions must be loosened.
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes root]# </SAMP
><KBD
CLASS="USERINPUT"
>chmod +x /usr/local/majordomo-1.94.5/lists</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>
Another common problem is caused by the <TT
CLASS="FILENAME"
>lists</TT
> directory being group writable.  To solve this problem, one can ether clear the group writable bit, or use the sendmail option <TT
CLASS="LITERAL"
>IncludeFileInGroupWritableDirPath</TT
> (see <A
HREF="#GROUP-PERM"
>Section 2.2.5</A
> and <A
HREF="#GROUP-SECURITY"
>Section 2.4.1</A
> for more details).</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN397"
>3.10. Majordomo Security Concerns</A
></H3
><P
>Majordomo is intended to run on a isolated system; there are a couple of well-known security holes in the scripts that allow any local user capable of executing <B
CLASS="COMMAND"
>wrapper</B
> to execute code as the <TT
CLASS="LITERAL"
>majordomo</TT
> user.  If Majordomo must be run on a system providing users with shell access, then it is advisable to tighten up permissions on the wrapper.  This can be done by clearing the world executable bit and <B
CLASS="COMMAND"
>chgrp</B
>ing the wrapper to the user that needs to run the Majordomo scripts.  For example, if Sendmail and MajorCool are both being used to execute the wrapper use the commands
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes root]# </SAMP
><KBD
CLASS="USERINPUT"
>cp /usr/local/majordomo-1.94.5/wrapper /etc/smrsh/wrapper</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes root]# </SAMP
><KBD
CLASS="USERINPUT"
>chmod 4750 /usr/local/majordomo-1.94.5/wrapper</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes root]# </SAMP
><KBD
CLASS="USERINPUT"
>chown root:nobody /usr/local/majordomo-1.94.5/wrapper</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes root]# </SAMP
><KBD
CLASS="USERINPUT"
>chmod 4750 /etc/smrsh/wrapper</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes root]# </SAMP
><KBD
CLASS="USERINPUT"
>chown root:mail /etc/smrsh/wrapper</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>
to secure the system.  This will allow <B
CLASS="COMMAND"
>sendmail</B
> (while running under <TT
CLASS="LITERAL"
>mail</TT
>) to execute <B
CLASS="COMMAND"
>/etc/smrsh/wrapper</B
> while allowing the webserver's MajorCool (running under <TT
CLASS="LITERAL"
>nobody</TT
>) to execute <B
CLASS="COMMAND"
>/usr/local/majordomo-1.94.5/wrapper</B
>.  This solution, however, will allow anyone with the UID or GID of <TT
CLASS="LITERAL"
>mail</TT
> or <TT
CLASS="LITERAL"
>nobody</TT
> to also obtain access to the <TT
CLASS="LITERAL"
>majordomo</TT
> account.  To protect the <TT
CLASS="LITERAL"
>nobody</TT
> account, it is important not to allow normal users to make use of server side includes or cgi scripts unless those services do not run under <TT
CLASS="LITERAL"
>nobody</TT
>.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN424"
>4. MajorCool</A
></H2
><P
>MajorCool is a web-based interface to Majordomo allowing users to add and delete themselves from lists and manage lists that they own.  The installation is fairly straightforward; all that need be done is to unzip the files, edit one line in the <B
CLASS="COMMAND"
>Configure</B
> script, and execute the script.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN428"
>4.1. Extracting MajorCool</A
></H3
><P
>The latest files can be downloaded from <A
HREF="http://www.conveyanced.com/MajorCool/"
TARGET="_top"
>Conveyance Digital</A
>.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes jarchie]$ </SAMP
><KBD
CLASS="USERINPUT"
>mkdir majorcool</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes jarchie]$ </SAMP
><KBD
CLASS="USERINPUT"
>mv majorcool.tar.gz ./majorcool/</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes jarchie]$ </SAMP
><KBD
CLASS="USERINPUT"
>cd majorcool/</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes majorcool]$ </SAMP
><KBD
CLASS="USERINPUT"
>tar zxvf majorcool.tar.gz</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN441"
>4.2. Edit the <B
CLASS="COMMAND"
>Configure</B
> Script</A
></H3
><P
>Open <B
CLASS="COMMAND"
>Configure</B
> and

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes majorcool]$ </SAMP
><KBD
CLASS="USERINPUT"
>vi Configure</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

change the line that reads

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>PERLBIN="/usr/local/bin/perl"	# How to start a perl script</PRE
></FONT
></TD
></TR
></TABLE
>

to the proper location of <B
CLASS="COMMAND"
>perl</B
>

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>PERLBIN="/usr/bin/perl"		# How to start a perl script</PRE
></FONT
></TD
></TR
></TABLE
>

otherwise, MajorCool will not be installed properly.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN452"
>4.3. Installing MajorCool</A
></H3
><P
>When running the <B
CLASS="COMMAND"
>Configure</B
> script, if the default choice for an option is okay, simply pressing Enter will accept the default.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes majorcool]# </SAMP
><KBD
CLASS="USERINPUT"
>./Configure</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

The <B
CLASS="COMMAND"
>Configure</B
> script will ask you to hit Enter a few times, and then it will ask for the location of Majordomo and some more questions about the setup of your Web server.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>What is the installation directory of Majordomo?
	[]: </SAMP
><KBD
CLASS="USERINPUT"
>/usr/local/majordomo-1.94.5</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>Will place the MajorCool programs in /usr/local/majordomo-1.94.5.
 
What is the path to your Majordomo configuration file?
	[/usr/local/majordomo-1.94.5/majordomo.cf]: 
Using configuration file name '/usr/local/majordomo-1.94.5/majordomo.cf'
 
Where would you like temp files created when MajorCool runs?
	[/tmp]: 

MajorCool needs to install CGI programs, support files, and icons in
your Web server directories.
 
What is the root directory for your Web server?
	[]: </SAMP
><KBD
CLASS="USERINPUT"
>/var/www</KBD
>

<SAMP
CLASS="COMPUTEROUTPUT"
>Where is the cgi-bin directory for your Web server?
	[/var/www/cgi-bin]: 
Will place the programs in /var/www/cgi-bin.
 
What is your server's URL for '/var/www/cgi-bin'?
	[/cgi-bin]: 
 
Where is the image directory for your Web server?
	[/var/www/icons]: 
Will place the icons in /var/www/icons.
 
What is your server's URL for '/var/www/icons'?
	[/images]: </SAMP
><KBD
CLASS="USERINPUT"
>/icons</KBD
>

<SAMP
CLASS="COMPUTEROUTPUT"
>Where is the root directory for documents on your Web server?
	[]: </SAMP
><KBD
CLASS="USERINPUT"
>/var/www/html</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

The <B
CLASS="COMMAND"
>Configure</B
> script will ask other questions that are less critical.  (The defaults are fine, but you might want to change a few settings to fit your preferences.  Unlike some of the Web server questions, the meanings should be obvious from the context.)  When the configuration file that the script generated from your answers is displayed, you should accept the new version.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>Accept the new version? [yes|no|list|edit|diff]? </SAMP
><KBD
CLASS="USERINPUT"
>y</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>

The installation script will install the MajorCool files and run the <B
CLASS="COMMAND"
>majordomo</B
> cgi script which outputs the html file to the console.  Check to see if the installation worked by viewing the <B
CLASS="COMMAND"
>majordomo</B
> cgi script from the web.

<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[jarchie@kes jarchie]$ </SAMP
><KBD
CLASS="USERINPUT"
>lynx http://localhost/cgi-bin/majordomo</KBD
></PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN478"
>5. Frequently Asked Questions</A
></H2
><P
>Two questions occur often.</P
><DIV
CLASS="QANDASET"
><DL
><DT
>5.1. <A
HREF="#AEN483"
>Why does sendmail give the error, <TT
CLASS="LITERAL"
>sh: wrapper not available for sendmail programs</TT
>?</A
></DT
><DT
>5.2. <A
HREF="#AEN491"
>Why will Red Hat not process my mc file?</A
></DT
></DL
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN483"
></A
><B
>5.1. </B
>Why does sendmail give the error, <TT
CLASS="LITERAL"
>sh: wrapper not available for sendmail programs</TT
>?</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
><B
CLASS="COMMAND"
>smrsh</B
> will only allow sendmail to execute certain files. See <A
HREF="#SMRSH"
>Section 2.2.4</A
>.</P
></DIV
></DIV
><DIV
CLASS="QANDAENTRY"
><DIV
CLASS="QUESTION"
><P
><A
NAME="AEN491"
></A
><B
>5.2. </B
>Why will Red Hat not process my mc file?</P
></DIV
><DIV
CLASS="ANSWER"
><P
><B
> </B
>For some reason, Red Hat does not include the necessary files to process mc files.  According to <TT
CLASS="FILENAME"
>/etc/mail/sendmail.mc</TT
>, these files should be in the <TT
CLASS="LITERAL"
>sendmail-cf</TT
> package; however, I was unable to find this package on the CD.  To fix this problem, install Red Hat's sendmail SRPM, uncompress the sendmail tarball, and copy the necessary macro files.
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes root]# </SAMP
><KBD
CLASS="USERINPUT"
>rpm -i sendmail-8.11.0-8.src.rpm</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes root]# </SAMP
><KBD
CLASS="USERINPUT"
>cd /usr/src/redhat/SOURCES/</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes SOURCES]# </SAMP
><KBD
CLASS="USERINPUT"
>tar zxvf sendmail-8.11.0.tar.gz</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes SOURCES]# </SAMP
><KBD
CLASS="USERINPUT"
>cd sendmail-8.11.0</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes sendmail-8.11.0]# </SAMP
><KBD
CLASS="USERINPUT"
>cp -R cf /usr/lib/sendmail-cf</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes sendmail-8.11.0]# </SAMP
><KBD
CLASS="USERINPUT"
>cd ..</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>[root@kes SOURCES]# </SAMP
><KBD
CLASS="USERINPUT"
>rm -rf sendmail-8.11.0</KBD
></PRE
></FONT
></TD
></TR
></TABLE
>
Also in the default <TT
CLASS="FILENAME"
>/etc/mail/sendmail.mc</TT
> file, there is a slight syntax error.  (The beginning single quotes on one line slant in the wrong direction.)  The line that reads
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>define('ALIAS_FILE','/etc/aliases')dnl</PRE
></FONT
></TD
></TR
></TABLE
>
should be changed to
<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>define(`ALIAS_FILE',`/etc/aliases')dnl</PRE
></FONT
></TD
></TR
></TABLE
>
After these two changes, the new <TT
CLASS="FILENAME"
>sendmail.cf</TT
> should be generated properly.</P
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="GLOSSARY"
><H1
><A
NAME="AEN516"
></A
>List of Terms</H1
><DL
><DT
><A
NAME="DEF-DIGEST"
></A
><B
>digest</B
></DT
><DD
><P
>a collection of new messages mailed to the members of an archived list as one message.  A list is called digested when it is archived and, periodically, a digest is sent out.</P
></DD
><DT
><A
NAME="DEF-GID"
></A
><B
>Group ID</B
></DT
> (GID)<DD
><P
>an identification number assigned to files, directories, and processes to restrict access--similar to UID except multiple people can be a member of a group.  On Unix-type systems, groups can be set up (defined in the <TT
CLASS="FILENAME"
>/etc/group</TT
> file).  When a user name is a member of a group, she can access files created with that GID (assuming permissions allow it).</P
></DD
><DT
><A
NAME="DEF-MTA"
></A
><B
>Mail Transfer Agent</B
></DT
> (MTA)<DD
><P
>a program, such as Sendmail, responsible for passing mail from one location to another.</P
></DD
><DT
><A
NAME="DEF-SGID"
></A
><B
>Set Group ID</B
></DT
> (SGID)<DD
><P
>a file attribute which allows a program to run with specific group privileges no matter who executes it.</P
></DD
><DT
><A
NAME="DEF-SMRSH"
></A
><B
><B
CLASS="COMMAND"
>smrsh</B
></B
></DT
><DD
><P
>(SendMail Restricted SHell) the shell that Sendmail uses to execute programs.  <B
CLASS="COMMAND"
>smrsh</B
> puts restrictions on the programs that can be run to make it safer than using a regular shell such as the Bourne Shell.</P
></DD
><DT
><A
NAME="DEF-SUID"
></A
><B
>Set User ID</B
></DT
> (SUID)<DD
><P
>a file attribute which allows a program to run as a specific user no matter who executes it.</P
></DD
><DT
><A
NAME="DEF-UID"
></A
><B
>User ID</B
></DT
> (UID)<DD
><P
>an identification number assigned to files directories, and processes--similar to GID except every user has a unique UID.  Every process must run under a UID (the one-to-one relationship between the UID and user name is defined in <TT
CLASS="FILENAME"
>/etc/passwd</TT
>).  The process' UID determines what the program can access.  In general a regular user can change the permissions on files that she owns unless the UID is 0 (the <TT
CLASS="LITERAL"
>root</TT
> user).  In that case, <TT
CLASS="LITERAL"
>root</TT
> can modify any files on the system.</P
></DD
><DT
><A
NAME="DEF-WRAPPER"
></A
><B
>wrapper</B
></DT
><DD
><P
>a program used to start another program; usually a wrapper is SUID or SGID so it can bestow privileges onto another program that the other program would not normally have.</P
></DD
></DL
></DIV
></DIV
></BODY
></HTML
>