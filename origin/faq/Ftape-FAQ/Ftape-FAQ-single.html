<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.72">
 <TITLE>The Ftape-FAQ</TITLE>
</HEAD>
<BODY>
<H1>The Ftape-FAQ</H1>

<H2>Johan De Wit, <CODE>&lt;jo@correct.nl&gt;</CODE></H2> v0.2, 07 december 1997
<HR>
<EM>This is a very incomplete attempt to create a FAQ for the <EM>Ftape
Floppy Tape Device Driver</EM>.  Any suggestions, remarks ... that could
improve this FAQ are welcome indeed.
The most recent version of this FAQ can be found at 
<A HREF="http://www.correct.nl/~ftape/">&lt;http://www.correct.nl/~ftape/&gt;</A> </EM>
<HR>
<H2><A NAME="s1">1. A Word From The Maintainer Of Ftape.</A></H2>


<P>This is a very incomplete attempt to create a FAQ for the <EM>Ftape
Floppy Tape Device Driver</EM>.</P>
<P>You might encounter references to the following addresses while reading   
this document:</P>
<P>
<UL>
<LI>The maintainer of the Ftape FAQ :

<A HREF="mailto:jo@correct.nl">Johan De Wit &lt;jo@correct.nl&gt;</A></LI>
<LI>The Ftape maintainer :

<A HREF="mailto:heine@math1.rwth-aachen.de">Claus-Justus Heine &lt;claus@momo.math.rwth-aachen.de&gt;</A></LI>
<LI>The Ftape Home Page :

<A HREF="http://www-math.math.rwth-aachen.de/~LBFM/claus/ftape/">&lt;http://www-math.math.rwth-aachen.de/~LBFM/claus/ftape/&gt;</A> 
</LI>
<LI>Mirrors of the Ftape Home Page :
<P>
<A HREF="http://www.torque.net/ftape/">&lt;http://www.torque.net/ftape/&gt;</A> </P>
<P>Thanks to 
<A HREF="mailto:grant@torque.net">Grant R. Guenther &lt;grant@torque.net&gt;</A></P>
<P>
<A HREF="http://www.info-systems.com/ftape/">&lt;http://www.info-systems.com/ftape/&gt;</A> </P>
<P>Thanks to 
<A HREF="mailto:jc@info-systems.com">Jakob Curdes &lt;jc@info-systems.com&gt;</A></P>
<P>
<A HREF="http://www.newwwave.net/~joshg/ftape/">&lt;http://www.newwave.net/~joshg/ftape/&gt;</A> </P>
<P>Thanks to 
<A HREF="mailto:joshg@newwave.net">Josh Goins &lt;joshg@newwave.net&gt;</A></P>

</LI>
<LI>The Ftape HOWTO :

<A HREF="http://sunsite.unc.edu/LDP/HOWTO">&lt;http://sunsite.unc.edu/LDP/HOWTO&gt;</A> 
</LI>
<LI>The Ftape Mailing List :

<A HREF="mailto:linux-tape@vger.rutgers.edu">&lt;linux-tape@vger.rutgers.edu&gt;</A></LI>
</UL>
  </P>
<P>There is surely quite a lot missing. Please feel free to improve this FAQ.   
The preferred way of doing this is to post to the 
<A HREF="mailto:linux-tape@vger.rutgers.edu">Ftape Mailing List</A>  
in case you have a question that isn't answered here.</P>
<P>Also, if you are already reading the list regularly and have the impression   
that some questions occur again and again, feel free to send that question   
and possibly an answer in the format indicated below to the 
<A HREF="mailto:jo@correct.nl">maintainer</A> 
of the <EM>Ftape FAQ</EM> AND to 
<A HREF="mailto:linux-tape@vger.rutgers.edu">Ftape Mailing List</A>. </P>
<P>If you make FAQ related postings, then please DON'T FORGET to prepend the   
word "<B>[FAQ]</B>" to the subject of your posting. Please don't add the word  
"FAQ" to the subject if you post something that isn't related to the FAQ.</P>
<P>That's all for now.</P>
<P>
<A HREF="mailto:heine@math1.rwth-aachen.de">Claus-Justus Heine</A>.</P>
<H2><A NAME="s2">2. "Compiling and installing Ftape" related questions !</A></H2>



<H2><A NAME="ss2.1">2.1 What Ftape version should I use?</A>
</H2>


<P>Always the latest stable version which is _supposed_ to be available from
<A HREF="ftp://sunsite.unc.edu/pub/Linux/kernel/tapes">ftp://sunsite.unc.edu/pub/Linux/kernel/tapes</A>
and
<A HREF="http://www-math.math.rwth-aachen.de/~LBFM/claus/ftape/">http://www-math.math.rwth-aachen.de/~LBFM/claus/ftape/</A></P>
<P>At time of this writing the latest stable version is <CODE>ftape-4.02</CODE>.</P>
<P>&lt;answer from Claus Heine&gt;</P>
<H2><A NAME="ss2.2">2.2 I'm having problems getting my XYZ drive to run under the 2.0.xx kernel with the built-in driver.  How do I fix this?</A>
</H2>


<P>The default version of <EM>Ftape</EM> included in the 2.0.xx kernel sources is   
2.08 or 2.09 and is very out of date.  Please update the <EM>Ftape drivers</EM>   
to the latest from the 
<A HREF="http://www-math.math.rwth-aachen.de/~LBFM/claus/ftape/">Ftape Home Page</A>.</P>
<P>&lt;answer from Tim Jones&gt;</P>
<H2><A NAME="ss2.3">2.3 I'm running Linux/SMP and the system just freezes when trying to access the Ftape devices!</A>
</H2>


<P>You need to add <CODE>-D__SMP__</CODE> to the <CODE>KERNEL_OPT</CODE> variable in the
file <CODE>MCONFIG</CODE>. In newer <CODE>ftape</CODE> versions you only need to
uncomment a certain line in the <CODE>MCONFIG</CODE> file.</P>
<P>&lt;answer from Claus Heine&gt;</P>

<H2><A NAME="ss2.4">2.4 Why does depmod complain about "undefined symbols"?</A>
</H2>


<P>Ignore the depmod error messages. The problem is that the <EM>Ftape modules</EM>   
have to be compiled without the version checksum feature (i.e.   
<CODE>CONFIG_MODVERSIONS</CODE>) with 2.0.* kernels. This causes no problem, even   
when the modules are used with a kernel that has support for this feature;   
only that <CODE>depmod</CODE> wrongly complains about undefined symbols. Ignore the   
complaints of <CODE>depmod</CODE> and try to insert the modules despite of these   
complaints: 
<BLOCKQUOTE><CODE>
<PRE>
modprobe zftape
</PRE>
</CODE></BLOCKQUOTE>

If this fails, something is wrong.</P>
<P>&lt;answer from Claus Heine&gt;</P>

<H2><A NAME="ss2.5">2.5 "insmod" says the kernel version is wrong</A>
</H2>


<P>The <CODE>insmod</CODE> program can check the kernel version against the
version that <EM>Ftape</EM> was compiled for in two ways: It can directly
compare the kernel version number recorded in the <EM>Ftape module</EM> against
the version of the running kernel, or, if both the kernel and
<EM>Ftape</EM> is compiled with versioned symbols, compare the version of
the used kernel symbols.</P>
<P>If you have upgraded your version of GCC to v2.7.0 or later, you must
recompile the modules utilities with gcc v2.7.x.</P>
<P>Newer versions of <CODE>insmod</CODE> allows you to "force" insertion of
a module into the kernel, even though the version string is incorrect.</P>
<P>&lt;from the Ftape-Howto&gt;</P>

<H2><A NAME="ss2.6">2.6 "insmod" says that kernel 1.2.0 and 1.2.0 differ</A>
</H2>


<P>Did you remember to apply the <CODE>ksyms.c</CODE> patch to the kernel?  If
not, read the <CODE>README.linux-1.2</CODE> file in the source distribution.</P>
<P>&lt;from the Ftape-Howto&gt;</P>

<H2><A NAME="ss2.7">2.7 Trying to compile Ftape gives me the error "modversions.h: no such file or directory"</A>
</H2>


<P>The <CODE>modversions.h</CODE> file is created when the kernel is compiled  
with the configuration item <CODE>CONFIG_MODVERSIONS</CODE> turned on.  With  
this option enabled, the file will be created during the <CODE>make dep</CODE>  
step.</P>
<P>One more handy tip is that a <CODE>make mrproper</CODE> will remove  
<CODE>/usr/include/linux/modversions.h</CODE>.  You will need to reconfig  
the kernel and do a <CODE>make dep</CODE> to get the file back.  </P>
<P>&lt;from the Ftape-Howto&gt;</P>

<H2><A NAME="ss2.8">2.8 What is this versioned symbols stuff anyway?</A>
</H2>


<P>When you say `yes' to <CODE>CONFIG_MODVERSIONS</CODE> during `<CODE>make config</CODE>',  
all the symbols exported by the kernel, i.e: the symbols that the  
loadable modules can "see", are augmented to include a checksum  
across the types of the call/return parameters.  This allows  
<CODE>insmod</CODE> to detect whether the definition of a variable or function  
in the kernel has changed since the time when <EM>Ftape</EM> was compiled.</P>
<P>This ensures a high degree of safety, such that you do not crash the  
kernel because you used an outdated module with your kernel.</P>
<P>If you enable <CODE>CONFIG_MODVERSIONS</CODE> in the kernel, make sure you have  
<PRE>
-DMODVERSIONS -include /usr/include/linux/modversions.h
</PRE>

uncommented in the MODULE_OPT line in the <EM>Ftape</EM> Makefile.  Conversely,   
if you do not have CONFIG_MODVERSIONS enabled, make sure you have it  
commented out.</P>
<P>&lt;from the Ftape-Howto&gt;</P>

<H2><A NAME="ss2.9">2.9 I seem to be getting sftape instead of zftape. When I run "ftmt status" command, I get output that the Ftape docs says corresponds to sftape ( /dev/qft0: Invalid argument ). Why?</A>
</H2>


<P>There are (at least) two possible sources of the problem:
<UL>
<LI>All Ftape-3.* versions prior to 3.04 install the modules into
<BLOCKQUOTE><CODE>
<PRE>
/lib/modules/misc
instead of
/lib/modules/uname -r/misc
</PRE>
</CODE></BLOCKQUOTE>

As <CODE>modprobe</CODE> searches in <CODE>/lib/modules/misc/</CODE> last there might be   
an old <CODE>ftape.o</CODE> module floating around in <CODE>/lib/modules/</CODE><EM>  
uname -r</EM><CODE>/misc</CODE> which <CODE>modprobe</CODE> finds first (<CODE>uname -r</CODE>   
stands for the kernel version).
Remove the old <CODE>ftape.o</CODE> module.</LI>
<LI>Your kernel has support for <EM>Ftape</EM> compiled in. Reconfigure  
your kernel without support for <EM>Ftape</EM> (<CODE>CONFIG_FTAPE</CODE>) and  
recompile and install it.</LI>
</UL>
</P>
<P>&lt;answer from Claus Heins&gt;</P>

<H2><A NAME="ss2.10">2.10 My Ditto DASH/FC-20/Exabyte Accelerator card works under Microsoft Windows, but I get a drive not found type of error in /var/log/messages when trying to use it under Linux.</A>
</H2>


<P>You are probably trying to use the same IRQ and DMA settings as your on-board  
FDC. This does not work in versions of <EM>Ftape</EM> prior to 3.03b. Please   
update the <EM>Ftape Drivers</EM> to the latest from the
<A HREF="http://www-math.math.rwth-aachen.de/~LBFM/claus/ftape/">Ftape Home Page</A>.</P>
<P>&lt;answer from Tim Jones&gt;</P>

<H2><A NAME="ss2.11">2.11 Ftape DMA transfers gives ECC errors</A>
</H2>


<P>Sadly to say there are some SVGA cards and Ethernet cards that do not
decode their addresses correct.  This typically happens when the
<EM>Ftape</EM> buffers are in the range <CODE>0x1a0000</CODE> to <CODE>0x1c0000</CODE>.
Somehow, the DMA write cycles get clobbered and every other byte
written gets a bad value (<CODE>0xff</CODE>).  These problems are reported to
happen with both SVGA and Ethernet cards.  We know of at least one
(bad?) ATI 16bit VGA card that caused this.</P>
<P>The easiest solution is to put the card in an 8bit slot (it is often
not enough to reconfigure the card to 8bit transfers).  Moving the
<EM>Ftape</EM> buffer away from the VGA range is only a partial
solution; All DMA buffers used in Linux can have this problem!  Let us
make this one clear: This has nothing to do with the <EM>Ftape</EM>
software.</P>
<P>&lt;from the Ftape-Howto&gt;</P>

<H2><A NAME="ss2.12">2.12 Help! I'm getting 'dmaalloc() failed' in my syslog file.</A>
</H2>


<P>You should only see this is you are trying to <CODE>insmod</CODE> the
<CODE>ftape.o</CODE> module.  Try running <CODE>swapout</CODE> first.  It is provided
with the standalone <EM>Ftape</EM> source.  It doesn't appear in the
<EM>Ftape</EM> source that's provided with the kernel.</P>
<P>Here's an example of how you can set your rc.local file to use it.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# Install the Floppy Tape Driver
if [ -f /boot/modules/`uname -r`/misc/ftape.o ]; then
   echo Installing ftape for Linux `uname -r`
   swapout
   insmod /boot/modules/`uname -r`/misc/ftape.o
fi
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Please note that you won't have this type of problem if you compile
the <EM>Ftape driver</EM> into the kernel.</P>
<P>&lt;from the Ftape-Howto&gt;</P>

<H2><A NAME="ss2.13">2.13 Syslogd works overtime when running Ftape</A>
</H2>


<P>The compile-time options <CODE>NO_TRACE</CODE> and <CODE>NO_TRACE_AT_ALL</CODE> in <EM>Ftape</EM>  
control the amount of system logging.  Add whichever is appropriate to the
<CODE>FTAPE_OPT</CODE> line in the Makefile and recompile.</P>
<P>&lt;from the Ftape-Howto&gt;</P>

<H2><A NAME="ss2.14">2.14 How do I change the trace-level?</A>
</H2>


<P>There are three ways you can do this (in order of personal
preference).</P>
<P>While we're at it, here are the meanings of the various trace levels.</P>
<P>
<UL>
<LI>0 Bugs  </LI>
<LI>1 + Errors  </LI>
<LI>2 + Warnings  </LI>
<LI>3 + Information  </LI>
<LI>4 + More information  </LI>
<LI>5 + Program flow  </LI>
<LI>6 + FDC/DMA info  </LI>
<LI>7 + Data flow  </LI>
<LI>8 + Everything else  </LI>
</UL>
</P>
<P>
<OL>
<LI>Using insmod to change trace-level

If you are using the modules mechanism to load the <EM>Ftape</EM>  
driver, you can specify the tracing level as an option to the insmod  
command.
<BLOCKQUOTE><CODE>
<PRE>
        /sbin/insmod ftape.o tracing=&lt;tracing-level>
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI>Using mt to change trace-level

The <EM>Ftape</EM> driver has a hack in it that allows the <CODE>fsr</CODE> option  
in <CODE>mt</CODE> to be used to set the tracing level.  <CODE>zftape</CODE> does not  
have this hack.
<BLOCKQUOTE><CODE>
<PRE>
        mt -f /dev/ftape fsr &lt;tracing-level>
</PRE>
</CODE></BLOCKQUOTE>

The use of the <CODE>fsr</CODE> command in <CODE>mt</CODE> is a <EM>hack</EM>,  
and will probably disappear or change with time.
</LI>
<LI>Recompiling to change trace-level

The file <CODE>tracing.c</CODE> contains a line <CODE>int tracing = 3;</CODE>.  
Change the 3 to whatever is appropriate and recompile.
</LI>
</OL>
</P>
<P>&lt;From the Ftape-Howto&gt;</P>

<H2><A NAME="ss2.15">2.15 I'm having problems with Ftape.  I'm using the latest version of Ftape from the Ftape Home Page and believe that I've located a real bug. What should I do?</A>
</H2>


<P>Check the 
<A HREF="http://www-math.math.rwth-aachen.de/~LBFM/claus/ftape/">Ftape Home Page</A>.
for an even newer version. Then check the FAQ contained in the that package   
if your problem is listed there. Next, try to check if the manual that comes   
with the <EM>Ftape distribution</EM> mentions your problem.</P>
<P>There is no need to read the entire manual, simply check the "Concept Index"   
if it contains a keyword that might be related to your problem, then jump   
to the proper location in the manual.</P>
<P>If you are still convinced you've found a bug, then post a general question   
describing the problem to the 
<A HREF="mailto:linux-tape@vger.rutgers.edu">Linux-Tape Mailing List</A>
, but do not attach your entire <EM>Ftape</EM> error-log. If we've seen the   
problem before, we'll let you know where the resolution effort stands.  If   
we haven't, the 
<A HREF="mailto:heine@math1.rwth-aachen.de">Ftape maintainer</A>
will most likely request that you send him the entire <EM>Ftape</EM> error-log  
(snipped from your system messages file).</P>
<P>&lt;answer from Tim Jones&gt;</P>

<H2><A NAME="s3">3. "Using Ftape" related questions !</A></H2>



<H2><A NAME="ss3.1">3.1 How fast is Ftape ?</A>
</H2>


<P>You can achieve quite respectable backup and restore speeds with
<EM>Ftape</EM>: a Colorado DJ-20 and an Adaptec 1542CF controller, has
been measured at 4.25Mbyte/min sustained data transfer rate (no
compression) across a 70Mbyte tar archive, while comparing the archive
on the tape with data on an IDE disk.  The speed of <EM>Ftape</EM> is
mostly dependent on the data transfer rate of your FDC: The AHA1542CF
has a ``post-1991 82077'' FDC, and it will push 1Mbit/sec at the tape
drive.  If you have an FDC which can only deliver 500Kbit/sec data
rates, you will see half the transfer rate (well, roughly).</P>


<H2><A NAME="ss3.2">3.2 When I write to some of my tapes, they seem to spend a lot of time "shoe-shining," or repositioning instead of streaming.  Is something wrong with my system?</A>
</H2>


<P>There has been a few reports of "shoeshining".  This is when the tape just  
seems to run back and forth endlessly.  This has been seen on a Jumbo  
250 (74407.3051@compuserve.com) and on an Iomega 250 Ditto Insider  
(tom@opus.cais.com). In the latter case it has been narrowed own to  
using an ELF Linux and running off a SCSI hard disk (connected to an  
Adaptec 1542cf).  Please contact me if you have an update to this  
problem.</P>
<P>&lt;from the Ftape-Howto&gt;</P>
<P>Probably not. If you are backing up a large number of &lt; 2K files, you're   
just going to have to live with it.  In this event, the repositions are caused  
by file system access overhead. If you are backing up a normal system's files,  
this may be caused by slop or media stretching in the tape cartridge. By   
simply retensioning the tape, you should see this go away. Try  
<BLOCKQUOTE><CODE>
<PRE>
ftmt -f /dev/zqft0 reten
</PRE>
</CODE></BLOCKQUOTE>

to retension the tape. If retensioning doesn't solve this, and it's only   
happening on certain tapes, it might be wise to replace the tapes in question.</P>
<P>&lt;answer from Tim Jones&gt;</P>
<P>If you use afio as your backup tool you can set it to write a very large   
number of buffers in one hit by using the -c flag. Make it large enough so   
that you supply enough data for most of a single end-to-end pass over the tape.
For my system, the following streams quite nicely - stopping relatively few  
times per tape pass on an unloaded system:
<BLOCKQUOTE><CODE>
<PRE>
find /usr/local -xdev -print | afio -o -v -f -b 10240 -c 800 /dev/qft0
</PRE>
</CODE></BLOCKQUOTE>

In my case I'm writing 800 x 10240 bytes per tape write, i.e. about 8MB.   
haven't experimented that much with these settings - so someone might like   
to establish more optimal ones.</P>
<P>Presumably other backup utilities could be modified to use a similar technique.</P>
<P>&lt;answer by Michael Hamilton&gt;</P>
<P>GNU tar doesn't use buffering in this way. The commercial backup program   
"bru" is able to multi-buffer using shared memory; this works only when   
writing compressed archive with bru (regardless whether you use <EM>Ftape's</EM>   
builtin compression)</P>
<P>Another way to overcome the problem might be to use more dma buffers in the   
<EM>Ftape kernel driver</EM> like:
<BLOCKQUOTE><CODE>
<PRE>
mt -f /dev/qft0 setdrvbuffer $((6*32786))
</PRE>
</CODE></BLOCKQUOTE>

$((6*32786)) should be expanded by your shell when using a Bourne  
compatible one. This has a negative impact on the system's memory pool:   
<EM>Ftape's</EM> dma buffers cannot be used by any other part of the kernel nor   
by any other application. And kernel memory cannot be swapped out. If you   
decide to use this kind of multi-buffering then you should unload the driver   
as soon as it isn't needed any longer.</P>
<P>&lt;answer by Claus Heine&gt;</P>

<H2><A NAME="ss3.3">3.3 Do I have to reboot to the DOS world to format tapes? </A>
</H2>


<P>Not if you are using the latest version of the <EM>Ftape drivers</EM> from  the  
<A HREF="http://www-math.math.rwth-aachen.de/~LBFM/claus/ftape/">Ftape Home Page</A>.</P>
<P>To format a QIC-80, TR-1, TR-3, QICWide 3010 or 3020 tape, get the
latest version of <CODE>ftape</CODE> and the latest version of the
<CODE>ftape-tools</CODE> package (from the same location) and read the
documentation of the <CODE>ftformat</CODE> utility which is included in the
<CODE>ftape-tools</CODE> package.</P>
<P>
<H4>Comment</H4>
Do not try to format Ditto 2GB tapes.
<H4>Comment</H4>
Do not try to format Ditto Max or Max Pro tapes.</P>
<P>&lt;answers from Tim Jones and Claus Heine&gt; </P>

<H2><A NAME="ss3.4">3.4 Is it possibly to format Ditto 2GB tapes with ftape?</A>
</H2>


<P>It isn't possible to format <CODE>Ditto 2GB</CODE> tapes with <CODE>Ditto 2GB</CODE>
tape drive, and it isn't possible at all to re-format <CODE>Ditto 2GB</CODE>
tapes in a way that they still can be used by a <CODE>Ditto 2GB</CODE> tape
drive.</P>
<P>This is a hardware limitation of the <CODE>Ditto 2GB</CODE> tape drive. It
can't be helped at the software level, i.e. it isn't <CODE>ftape's</CODE>
fault.</P>

<H2><A NAME="ss3.5">3.5 Is it possibly to format Ditto Max or Max Pro tapes with ftape?</A>
</H2>


<P>No, the <CODE>Ditto Max</CODE> can't format tapes.</P>
<P>This is a hardware limitation of the <CODE>Ditto Max (Pro)</CODE> tape drive. It
can't be helped at the software level, i.e. it isn't <CODE>ftape's</CODE>
fault.</P>

<H2><A NAME="ss3.6">3.6 Ftape detects more bad sectors than DOS on QIC-3020 tapes</A>
</H2>


<P>If you look at the difference, you will notice that <EM>Ftape</EM>
always detects 2784 sectors more than DOS.</P>
<P>The number that <EM>Ftape</EM> reports is correct (of course <CODE>:-)</CODE>. Each
correctly formatted QIC-3020 tape has 2784 sectors at fixed positions
that are marked in the bad sector map. To quote from the specs:</P>
<P>
<BLOCKQUOTE>
Tracks 5,7,9,11,13,15,17,19,21,23,25 and 27 within 4 segments of
either EOT or BOT are prone to increased error rates due to hole
imprints.  Therefore, these regions shall be mapped as bad at format
time and entered in the bad sector map by indicating that all sectors
within the identified segments are bad.
</BLOCKQUOTE>
</P>
<P>This gives 12 tracks * 2 * 4 segments * 29 sectors == 2784 sectors.</P>
<P>So <EM>Ftape</EM> choose to report the real number of sectors that cannot be
used on the tape, while DOS gives a more optimistic number giving a
better indication of tape quality.  (<EM>Ftape's</EM> behavior might change in
the future to detect correct formatting and display the separate
numbers. It has rather low priority though).</P>
<P>QIC-3010 are alike QIC-3020 tapes regarding this.</P>
<P>&lt;from the Ftape-Howto&gt;</P>

<H2><A NAME="ss3.7">3.7 Is it ok that I'm not hearing the tape move when I do a fsf or a bsf with mt?</A>
</H2>


<P>Yes.  The driver merely updates an internal counter when those
commands are issues.  The tape should move to the proper location on
the next read or write access to the tape drive.</P>
<P>&lt;from the Ftape-Howto&gt;</P>

<H2><A NAME="ss3.8">3.8 Why does my XYZ backup program complain about "Invalid argument" errors?</A>
</H2>


<P><CODE>zftape</CODE> requires the data to be written in multiples of a fixed minimal   
block size. This is a very usual behavior for a tape device. There are three   
ways to get rid of those errors:
<UL>
<LI>set <EM>Ftape's</EM> block size to the block size used by the backup program. The example below works for "afio":
<BLOCKQUOTE><CODE>
<PRE>
mt -f /dev/qft0 setblk 5120
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI>If you don't want to use <EM>Ftape's</EM> built in compression you can also use
<BLOCKQUOTE><CODE>
<PRE>
mt -f /dev/qft0 setblk 0
</PRE>
</CODE></BLOCKQUOTE>

to switch <EM>Ftape</EM> to variable block size mode and be able to write the   
data in arbitrary portions to the tape (BUT: the builtin compression doesn't   
work with this setting). When you intend to use "KBackup" then this is the   
only way to make it work together with <EM>Ftape</EM> (it _may_ work, don't know   
if it does)</LI>
<LI>tell your backup program about <EM>Ftape's</EM> default block size of 10k (which   
is also the default of GNU tar). For "afio" you can use the following command   
line switch:
<BLOCKQUOTE><CODE>
<PRE>
afio -b 10k ...
</PRE>
</CODE></BLOCKQUOTE>
</LI>
</UL>
</P>
<P>You may want to read the section "Tape blocks" of the manual (use its   
"Concept index" to directly jump to that section)</P>
<P>When using GNU tar's builtin compression with GNU tar versions prior to
tar-1.12 one needs to run tar with the <CODE>--block-compress</CODE> switch to
<CODE>re-block</CODE> the output to the tape.  Otherwise tar will compress the data 
it reads, and write it in arbitrary portions to the tape.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
Example :

tar -czvf /dev/qft0 --block-compress /etc
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P><B>WARNING:</B>
One shouldn't use tar's builtin compression with large backups as it makes the
entire data stream one huge compressed block.  If such archives are corrupted
right at the beginning it will be very difficult to recover.</P>
<P>&lt;answer by Claus Heine&gt;</P>

<H2><A NAME="ss3.9">3.9 I/O errors and FDC - some explanations.</A>
</H2>


<P>When you get next messages, this could be interesting for you !</P>
<P>
<UL>
<LI>fdc-io.c (ft_handle_perpend) - Your FDC does not support QIC-3020.</LI>
<LI>Cannot write to /dev/qft0: I/O error</LI>
</UL>
</P>
<P>The explanations: </P>
<P>"FDC" menas "Floppy Disk Controller". The
problem is that your floppy disk controller must be able to support
something that is called "perpendicular mode" to be able to read and
write QIC-3020/QIC-3010 cartridges (i.e. TR-3 cartridges). To my
knowledge all FDCs that are capable of at least 1Mbit/sec data
transfer rate also support "perpendicular mode" ("perpendicular"
refers to the direction of magnetization of the ferro-magnetic
particles on the tape).</P>
<P>This means that you need to purchase another FDC. Either look around
some computer stores and ask for an IO controller cards that is able
to support 2.88 Mb floppies (which imlies 1Mbit data transfer rate and
perpendicular mode).</P>
<P>Or get one of the so called "high speed" controllers that even support
2Mbit/sec data transfer rate. Those controllers are based on an Intel
82078 FDC. Iomega sells such a card under the name "Ditto Dash". I
think Exabyte sells their 2Mbit controllers separately, too, whereas
Seagate ships its TR-3 drives (i.e. the TST-3200) together with such a
controller.</P>

<P>&lt;answer from Claus Heine&gt;</P>

<H2><A NAME="ss3.10">3.10 Why do I get "/dev/qft0: No such device" errors?</A>
</H2>


<P>I assume that the following is the problem:
The <EM>Ftape</EM> module is loaded OK into the kernel:
<BLOCKQUOTE><CODE>
<PRE>
/usr/src/ftape-3.03b-970603# lsmod
 Module         Pages    Used by
 ftape             22            0
</PRE>
</CODE></BLOCKQUOTE>

but then this happens:
<BLOCKQUOTE><CODE>
<PRE>
$ ftmt -f /dev/qft0 status
ftmt: /dev/qft0: No such device
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Solution
You need to load the <EM>zftape.o</EM> module as well. With Ftape-3.* the   
<EM>ftape.o</EM> module doesn't implement the VFS interface. This is done by   
<EM>zftape.o</EM>.</P>
<P>&lt;answer from Claus Heine&gt;</P>

<H2><A NAME="ss3.11">3.11 I get "device busy" when I make multiple backups on a tape using some script.</A>
</H2>


<P>The "device busy" messages can only occur while the <EM>Ftape devices</EM> are   
still held open by some program. As soon as the close() system call has   
completed the busy flag is cleared. May be "bru" or some other program has   
still forked off a child that dies delayed?</P>
<P>Yes, this will reproduce the problem, it seems:
<BLOCKQUOTE><CODE>
<PRE>
tar -cvvzf /dev/nqft0 --block-compress ; mt rewind
</PRE>
</CODE></BLOCKQUOTE>

You can skip the "--block-compress" if using the most recent version  
of GNU tar.</P>
<P>However, this is not a bug of <EM>Ftape</EM>. It seems that the parent tar  
process exits before its child has closed the tape device. I know,  
however, from hacking the tar code ages ago, that tar properly waits  
for its parent to die.</P>
<P>However, the busy message simply means that the "busy" variable is  
still held at 1 (zftape/zftape-init.c). And this simply means that  
there still is a process hanging around that holds the tape device  
open. </P>
<P>I think I have it (only for the case of tar 'cause I have the source
code.</P>
<P>If on uses tar with compression, then it forks a child which will
become the compressor bei execing  "gzip" or whatever. Before the call
to execlp() the child will fork off a grand child of its parent
tar. That grandchild will do the actual tape I/O.
<BLOCKQUOTE><CODE>
<PRE>
tar - fork() - write to child tar
        |
      child tar - fork() - gzip (will pipe to grand child tar)
                    |
                  grand child tar - open archive.
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Now, parent tar only waits for its child to die. gzip surely doesn't
wait for the grand child as the gzip is a result of an execlp().</P>
<P>What I don't know is whether the grand child should be implicitly
waited for by the parent tar, or if the wait() function also waits for
grand childs.</P>
<P>But this seems to be the problem: the parent tar already has exited
while its grandchild still is busy closing the archive. One hardly
will notice this problem if the close() happens fast (i.e. regular
files, block devices, also other tape devices?), but it isn't a bug in
<EM>Ftape</EM>, but either in the backup programs or in the kernel or maybe
libc exit code.</P>
<P>Don't know if the considerations above also apply to bru. If there is
no grandchild and the parent process properly waits for its childs
then there shouldn't be a problem.</P>
<P>&lt;answer from Claus Heine&gt;</P>

<H2><A NAME="ss3.12">3.12 How do I "..." with tar?</A>
</H2>


<P>These are really <CODE>tar</CODE> questions: Please read the <CODE>man</CODE> page and  
the <CODE>info</CODE> page.  If you have not got it either, try 
<BLOCKQUOTE><CODE>
<PRE>
tar  --help 2>&amp;1 | less
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>If your version of <CODE>tar</CODE> is v1.11.1 or earlier, consider  
upgrading to v1.11.8 - This version can call <CODE>GNU zip</CODE> directly  
(i.e.: it supports the <CODE>-z</CODE> option) and has an elaborate help  
included.  Also, it compiles right out of the box on Linux.  </P>
<P>&lt;from the Ftape-Howto&gt;</P>

<H2><A NAME="ss3.13">3.13 What block-size should I use with tar ?</A>
</H2>


<P>When using compression, and in all general, it can be a benefit to  
specify to <CODE>tar</CODE>, that it should block the output into chunks.  
Since <EM>Ftape</EM> cuts things into 29Kbyte blocks, saying `<CODE>-b58</CODE>'  
should be optimum.</P>
<P>"Why 29Kbyte?", I hear you cry.  Well, the QIC-80 standard specifies  
that all data should be protected by an Error Correcting Code (ECC)  
code.  The code specified in the QIC-80 standard is known as a  
Reed-Solomon (R-S) code.  The R-S code takes 29 data bytes and  
generates 3 parity bytes.  To increase the performance of the ECC  
code, the parity bytes are generated across 29 1Kbyte sectors.  Thus,  
<EM>Ftape</EM> takes 29Kbytes of data, adds 3Kbytes of ECC parity, and  
writes 32Kbytes to the tape at a time.  For this reason, <EM>Ftape</EM> will  
always read and write 32K byte blocks to be able to detect (and  
correct) data errors.</P>
<P>If you are curious, and wish to know more, look in the <CODE>ecc.c</CODE> and  
<CODE>ecc.h</CODE> files, for an explanation of the code and a reference to a  
textbook on Reed-Solomon codes.</P>
<P>&lt;from the Ftape-Howto&gt;</P>

<H2><A NAME="ss3.14">3.14 Where can I find the tar/mt/cpio/dd binaries - sources - manpages?</A>
</H2>


<P>All of these tools have been developed by the GNU project, and the  
source (and man page) can be fetched from just-about any ftp site in  
the world (including <CODE>ftp.funet.fi</CODE>, <CODE>tsx-11.mit.edu</CODE>, and  
<CODE>sunsite.unc.edu</CODE>).  In any case they can be fetched from the  
official GNU home site: <CODE>prep.ai.mit.edu [18.71.0.38]:/pub/gnu</CODE>.  The latest versions (as of September 12  
1996) are:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
cpio:   2.4.2 (cpio-2.4.2.tar.gz)
dd:     3.13 (fileutils-3.13.tar.gz)
mt:     2.4.2 (cpio-2.4.2.tar.gz)
tar:    1.11.8 (tar-1.11.8.tar.gz)
gzip:   1.2.4 (gzip-1.2.4.tar.gz)
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>They all compile out of the box on Linux <CODE>v1.0.4</CODE> / <CODE>libc
v4.5.19</CODE> / <CODE>gcc v2.5.8</CODE>.</P>
<P>&lt;from the Ftape-Howto&gt;</P>

<H2><A NAME="ss3.15">3.15 If I use tapers compression, is it a bad idea to use the compression with zftape, or would it be better to not use tapers compression, and let zftape do it?</A>
</H2>


<P>It is not bad as such to compress data twice (which would be the case
when using tapers compression together with <EM>zftape's</EM> compression) but
it doesn't make any sense. You won't gain much further compression,
but only waste CPU cycles. </P>
<P>Tapers compression should be quite safe, as taper compresses single
files; in contrast to <I>tar -czf ...</I> which makes the entire data
stream a large compressed block of data, which is really a bad thing
with serious backups as a single bad byte at the beginning of the
archive can make the entire archive unusable, well, it will be at
least quite difficult to recover.</P>
<P>&lt;Answer from Claus Heine&gt;</P>

<H2><A NAME="ss3.16">3.16 How does zftape compression compare to say gzip -9?</A>
</H2>


<P><I>gzip -9</I> is better (i.e. one gains higher compression). <EM>zftape's</EM>
compression is comparable with the Un*x <I>compress</I> program, but should
be faster, and is faster than <I>gzip</I>.</P>
<P>&lt;Answer from Claus Heine&gt;</P>

<H2><A NAME="ss3.17">3.17 I don't trust compression, but hear that the sftape interface is going away. What should I do?</A>
</H2>


<P>Use the <EM>zftape interface</EM>, but don't load the <EM>zft-compressor module</EM>.  
The device then becomes <CODE>/dev/qft0</CODE>.</P>
<P>&lt;answer from Tim Jones&gt;</P>

<H2><A NAME="ss3.18">3.18 Ftape says "This tape has no 'Linux raw format"</A>
</H2>


<P>You get this complaint if you haven't <EM>erased</EM> your freshly
formatted tape.  This is because <EM>Ftape</EM> expect a "magic header"
on the tape, to be able that it is allowed to interpret the header
segment in its own way (eg: file marks).  To remove the problem, say
<PRE>
mt -f /dev/nftape erase
</PRE>
</P>
<P>&lt;from the Ftape-Howto&gt;</P>

<H2><A NAME="ss3.19">3.19 Can I exchange tapes with someone using DOS?</A>
</H2>


<P>No.  The DOS software conforms to the QIC-80 specs about the layout of
the DOS filesystem, and it should(?)  be a small problem to write a
program that can read/write the DOS format.  In fact, I'd bet that
creating a nice user interface would be a bigger problem.</P>
<P>&lt;From the Ftape-Howto&gt;</P>

<H2><A NAME="ss3.20">3.20 How does `mt eom' work when you've started overwriting a tape in the middle?</A>
</H2>


<P>(EOM is "End Of recorded Media", the position right after all data  
already recorded to the tape)</P>
<P>One cannot use tape "files" like files on an ordinary file system.  </P>
<P>In principle, a tape doesn't allow anything but appending new data at  
EOM.  However, if one positiones just in the middle of the already  
recorded data AND starts writing, then the driver first deletes all  
following files (thus moving the EOM to the actual position) and then  
starts writing.</P>
<P>Thus, the new EOM after finishing the write process, is then after the  
newly recorded data.</P>
<P>One of the consequences of the above is, of course, that writing to  
the tape in the middle of the already recorded area, is destructive in  
the sense, that it not only overwrites the "file" the tape is  
positioned at, but also deletes all following files.  </P>
<P>&lt;from the Ftape-Howto&gt;
&lt;Answer from Claus Heine&gt;</P>

<H2><A NAME="ss3.21">3.21 When I made backups before using taper, under the 2.0.29 ftape my drive didn't support fsf, under the new zftape it does, why would this be, and what exactly is fsf ?</A>
</H2>


<P>It probably didn't work before because you didn't use a 
<BLOCKQUOTE><CODE>
<PRE>
mt -f /dev/rft0 erase
</PRE>
</CODE></BLOCKQUOTE>

before writing data to the cartridge. THIS ISN'T necessary any more.</P>
<P>But, hey, what does <I>mt fsf</I>? Tape drives don't store files in the
sense that you can use 
<PRE>
cp somefile /dev/my_what_ever_tape
</PRE>
 
or be able to mount the tape drive like you could mount a harddisk. 
You can't do nothing with a tape drive but write data to it in a sequential 
manner.</P>
<P>As this is quite inconvenient, somebody invented something which is
known under the name <I>file mark</I> or <I>eof mark</I> (eof == End Of
File). Those marks don't separate files that have been backed up to
the tape device, but only separate blocks of data (whatever data that
might be).</P>
<P>Normally, the kernel tape device drivers take care of writing file
marks when the tape device is closed, i.e.
<BLOCKQUOTE><CODE>
<PRE>
tar -cf /dev/nqft0 /bin
tar -cf /dev/nqft0 /etc
mt -f /dev/nqft0 rewind
</PRE>
</CODE></BLOCKQUOTE>

would result in a backup of all files under <I>/bin</I> and <I>/etc</I>. When
the first <I>tar</I> finishes, the kernel driver will take care of writing
a file mark to the tape at the current tape position, and when the
second <I>tar</I> process has finished, another file mark is written to the
tape cartridge at that position.</P>
<P>Now, the sense of those file marks is, that it is possible to skip
between different archives on the tape more quickly than would be
possible with reading the data back.</P>
<P>The commands to do that are:
<DL>
<DT><B>mt fsf</B><DD>
<P>fast skip to the next file mark towards EOT (End Of Tape)</P>
<DT><B>mt bsf</B><DD>
<P>fast skip to the next file marks towards BOT (Begin Of Tape)</P>
</DL>

Thus, to extract the second archive in the example above, one doesn't
need to read the first archive back, but can proceed as follows:
<BLOCKQUOTE><CODE>
<PRE>
mt -f /dev/nqft0 rewind
mt -f /dev/nqft0 fsf
tar -xvf /dev/nqft0 
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>&lt;Answer from Claus Heine&gt;</P>

<H2><A NAME="ss3.22">3.22 What exactly is the difference between ftape, and zftape?</A>
</H2>


<P>When <EM>Ftape</EM> was young there were two versions of the floppy tape
driver, one of them was called <EM>zftape</EM> because of its built-in
user-transparent on-the-fly compression. Whether such a thing is a
feature or a bug ('cause this needn't be done in kernel space) is
another question. However, the ioctl interface and file mark handling
provided by <EM>zftape</EM> was much better and had less bugs. And <EM>zftape</EM>
allows to use floppy tape cartridges with different OS. Well, you
can't exchange data, but <EM>zftape</EM> won't overwrite volumes created by
your Windoze program, and vice versa.</P>
<P>Nowadays, <EM>Ftape</EM> is name of the entire floppy tape driver package AND
<I>ftape.o</I> is the file-name of the kernel module that implements the
low-level hardware support. <EM>zftape</EM> has ceased to exist as a separate
package, but the new <EM>Ftape</EM> versions (since ftape-3.00) contain a
<EM>zftape.o</EM> module that needs to be loaded on top of <EM>ftape.o</EM>
(i.e. you need to load BOTH modules to be able to access your floppy
tape drive) and implements the file system interface and the advanced
(?) features of the previous verions <EM>zftape</EM>.</P>
<P>&lt;Answer from Claus Heine&gt;</P>

<H2><A NAME="ss3.23">3.23 What is the difference between a rewinding, and non rewinding drive?</A>
</H2>


<P>Well, the rewinding tape devices rewind the tape to BOT (Begin Of
Tape) when the device is closed, i.e.
<BLOCKQUOTE><CODE>
<PRE>
tar -cvf /dev/qft0 /bin
</PRE>
</CODE></BLOCKQUOTE>

will rewind the tape cartridge when the tar job has finished. In contrast, 
<BLOCKQUOTE><CODE>
<PRE>
tar -cvf /dev/nqft0 /bin 
</PRE>
</CODE></BLOCKQUOTE>

will NOT rewind the tape cartridge and leave the tape R/W head at its
current position.</P>
<P>Rewinding devices should be used when performing a single backup,
non-rewinding devices can be useful when doing multiple backups as one
doesn't need to space to EOM (End Of recorded Media) before appending
another archive.</P>
<P>Non-rewinding devices MUST be used when sending any of the tape motion
command to the tape drive, such as 
<BLOCKQUOTE><CODE>
<PRE>
mt -f /dev/nqft0 fsf
</PRE>
</CODE></BLOCKQUOTE>

, because when the <I>mt</I> process finishes then the tape device is closed  
which would result in rewinding the cartridge with the rewinding devices.</P>
<P>&lt;Answer from Claus Heine&gt;</P>

<H2><A NAME="ss3.24">3.24 Can someone tell me how to use mt to rewind my TR-3 drive one record using zftape record, so I can verify it?</A>
</H2>


<P>Well, it depends. If the tape is still positioned inside the volume  
just written, "mt bsf 1" (or equivalently "mt bsf") will backspace  
just to the beginning of that volume (this is how "tar --verify"  
works). If the tape is already positioned AFTER the filemark that  
marks the end of the last written volume, then you need to issue   
"mt bsf 2"</P>
<P>The logic behind this is as follows:
"MTBSF count" backspaces over count file marks, stops, and then  
positions on the <CODE>EOT</CODE> side of the last skipped file mark. This means,  
an "mt bsf 2" will position right at the beginning of the previous  
volume. </P>
<P>&lt;answer form Claus Heine&gt;</P>

<H2><A NAME="ss3.25">3.25 By non-rewinding, they mean that it doesn't automatically rewind, correct? It doesn't mean that under no circumstances it will rewind, right?  I tried using /dev/zqft0, and it instantly rewinds the tape.</A>
</H2>


<P>You are right: auto-rewind means, the tape is rewound when the tape  
device is closed, non-rewinding  means, the tape isn't automatically  
rewound when the tape device is closed (but you can, of course, use  
the tape motion commands BSF/FSF etc. to position the tape head at  
every position you like).</P>
<P>&lt;answer form Claus Heine&gt;</P>

<H2><A NAME="ss3.26">3.26 What is the difference between what mt considers a record and what it considers a file?</A>
</H2>


<P>A record is the minimal amount of bytes that will be accepted by the
tape in one read/write operation (except in "variable block size mode"
where it just should be the amount of data actually written in a
single write operation??). </P>
<P>For <EM>zftape</EM> every read and write access has to be a multiple of a fixed
block size (fixed, but tunable with <CODE>MTSETBLK</CODE>). This block size is a
"tape record" (as mentioned in the GNU mt man page and defaults to
10kb for <EM>zftape</EM>.</P>
<P>A "file" (in the sense of the mt man page) is a, well, misleading
terminus. What is meant is an area of the tape between two file
marks. This is not a file like a file on the file system, in the sense
that it could have a name, file access modes, could be moved or copied
with cp, mv, rm etc. </P>
<P>Instead, It simply is the area of the tape that was recorded in one
backup session, its end is marked by a tape file mark, and its
beginning is delimited by either <CODE>BOT</CODE> or the file mark of the previous
tape "file". That tape "files" are the things that can be skipped with
the <CODE>MTBSF/FSF</CODE> commands.</P>
<P>&lt;answer form Claus Heine&gt;</P>

<H2><A NAME="ss3.27">3.27 Reusing tapes with zftape without reformatting the tape.</A>
</H2>


<P>We try to answer the followong questions :
<UL>
<LI>Is there a good way to erase, as in remove the data or at least the volumes 
from a tape, without reformating?  </LI>
<LI>Can you overwrite the last volume on a tape with making a mess out of it? </LI>
<LI>Can you overwrite the last several volumes without making a mess? </LI>
<LI>Can you delete the last volume?</LI>
</UL>
</P>
<P>If you want to "erase" an entire cartridge, then simply do:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
mt -f /dev/qft0 erase
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>This will erase the volume table (i.e. the "file marks").</P>
<P>Pre-ftape-3.x releases of zftape and ftape used to allow overwriting
of already existing volumes on a cartridge. I have removed this
feature as it was reported that it already has caused data-loss with
some backup programs.</P>
<P>If you indeed need to remove some volumes on the tape then you should
use the </P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
vtblc
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>program that comes with the <CODE>ftape-tools</CODE> package which can be
down-loaded from the same locations as the <CODE>ftape</CODE> kernel driver
package. Please refer to the documentation which is contained in the
<CODE>ftape-tools</CODE> package for more information.</P>
<P>If you simply want to reuse old tapes, then it suffices to do</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
mt rewind
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>If the tape is at BOT (Begin Of Tape) then every write access to the
tape will silently erase all file marks and overwrite the data already
existing on the tape.</P>
<P>&lt;answer by Claus Heine&gt;</P>

<H2><A NAME="ss3.28">3.28 This script implements a simple contents listing for the zftape package using the "MTIOCVOLINFO" ioctl.</A>
</H2>


<P>Here is as little perl/bash script that lists the contents of a cartridge
using the <EM>zftape</EM> specific "volinfo" ioctl. Hope this shows how to
handle this kind of stuff.</P>
<P>What it basically does is the following:</P>
<P>
<OL>
<LI>Rewind the cartridge</LI>
<LI>Issue the volinfo command:
<BLOCKQUOTE><CODE>
<PRE>
   claus@thales:~$ mt volinfo
   file number          = 1
   block size           = 10240
   physical space used  =  522.0 kilobytes
   real size of volume  =  520.0 kilobytes
</PRE>
</CODE></BLOCKQUOTE>

Parse the ouput and place the values in appropriate variables</LI>
<LI>Skip to the next volume with "mt fsf"</LI>
<LI>Exit if this gives an error (EOD), otherwise "goto 2)"</LI>
</OL>
</P>
<P><B>The Perl Script</B></P>
<P>
<BLOCKQUOTE><CODE>
<PRE>

#!/usr/bin/perl
#
#     Copyright (C) 1997 Claus-Justus Heine
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; see the file COPYING.  If not, write to
# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
#
#   This script implements a simple contents listing for the zftape
#   package using the MTIOCVOLINFO ioctl.
#

$version = &lt;&lt;EOT;
listtape-1.0 -- a perl script to list the contents of a floppy tape cartridge
under Linux using the zftape driver

RCS \$Revision$
RCS \$Date$
EOT

$tapedev = "/dev/tape";
$usage = &lt;&lt;EOT;
Usage: listtape [options ...]

Mandatory or optional arguments to long options are mandatory or optional
for short options too.

-f, --file=FILE       Tape device to use. Default is  "/dev/tape".
-h, --help            Print this help.
-?                    Same as '-h'.
--usage           Same as '-h'.
-V, --version         Print version information.

Author: Claus-Justus Heine &lt;claus\@momo.math.rwth-aachen.de>
EOT

while ($ARGV[0] =~ /^-/) {
$_ = shift; 
if (/--file/) {$_ = shift; $tapedev = $_; next;} 
if (/-f/) {$_ = shift; $tapedev = $_; next;} 
if (/--help/) { print $usage; exit 0; }
if (/-h/) { print $usage; exit 0; }
if (/--usage/) { print $usage; exit 0; }
if (/-\?/) { print $usage; exit 0; }
if (/--version/) { print $version; exit 0; }
if (/-V/) { print $version; exit 0; }
die $usage;
}

&amp;open_tape($tapedev, "status");
while(&lt;FTMT>)
{
$online = 1 if (/.*online.*/);
}

if (! $online) { die "No cartridge present.\n"; }

&amp;mtop($tapedev, "rewind");

printf "%11s%12s%20s%20s\n",
"file number", "block size", "volume size", "tape space";

while (1)
{
&amp;open_tape($tapedev, "volinfo");
while (&lt;FTMT>) {
if (/^file number\s*=\s*([0-9]*)$/) { $filenumber = $1; }
if (/^block size\s*=\s*([0-9]*)$/) { $blocksize = $1; }
if (/^physical space used\s*=\s*([[0-9]*.*)/) { $rawsize = $1; }
if (/^real size of volume\s*=\s*([[0-9]*.*)/) { $size = $1; }
}
close(FTMT);
if (&amp;mtop($tapedev, "fsf 1") != 0) {
&amp;mtop($tapedev,"rewind");
print "\nRemaining space: $rawsize\n";
print "Tape block size: $blocksize\n";
exit 0;
}           
printf "%6d          %5d  %20s%20s\n",
    $filenumber, $blocksize, $size, $rawsize;
}

sub mtop
{
local ($tape, $operation) = @_;
local ($exitval);
system "ftmt -f $tape $operation > /dev/null 2>&amp;1";
}

sub open_tape
{
local ($tape, $operation) = @_;
local ($command);

$command = "ftmt -f " . $tape . " " . $operation . " |";
open(FTMT, $command) || die "Couldn't open $command -- $!\n";
}
</PRE>
</CODE></BLOCKQUOTE>
</P>


<P><B>The Bash Script</B></P>
<P>
<HR>
<PRE>

#! /bin/bash
#
#     Copyright (C) 1997 Claus-Justus Heine
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; see the file COPYING.  If not, write to
# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
#
#   This script implements a simple contents listing for the zftape
#   package using the MTIOCVOLINFO ioctl.
#

#
# insert better option parsing here
#
TAPEDEV=${1-/dev/tape}

if ! echo $TAPEDEV | grep "/dev/n"
then
TAPEDEV=/dev/n$(basename $TAPEDEV)
fi

if ! [ -c $TAPEDEV ]
then
echo $TAPEDEV is not a character device!  1>&amp;2
exit 1
fi

if ! mt -f $TAPEDEV rewind
then
echo Could not rewind $TAPEDEV - no cartridge present?  1>&amp;2
exit 1
fi

echo -e "\nContents of $TAPEDEV:\n"

printf "%11s%12s%20s%20s\n" "file number" "block size" "volume size" "tape space"

trap "rm -f /tmp/$0.$$" exit

while true
do
if ! foo=$(mt -f $TAPEDEV volinfo |cut -f 2 -d =)
then
echo $TAPEDEV doesn\'t seem to be a floppy tape device 1>&amp;2
exit 1
fi
#
# "echo foo | read foo" will not work as the "read foo" is executed in
# another shell.
#
echo $foo > /tmp/$0.$$
read file blksz used usedunit size sizeunit &lt; /tmp/$0.$$
if ! mt -f $TAPEDEV fsf 1 > /dev/null 2>&amp;1
then
echo -e "\nRemaining space: $used $usedunit"
echo -e "Tape block size: $blksz"
if ! mt -f $TAPEDEV rewind
then
    echo Rewind of $TAPEDEV failed 1>&amp;2
    exit 1
fi
exit 0
fi
printf "%6d          %5d  %20s%20s\n"\
$file $blksz "$size $sizeunit" "$used $usedunit"
done
</PRE>
<HR>
</P>
<P>&lt;answer from Claus Heine&gt;</P>

<H2><A NAME="s4">4. "Tape and Drivers" related questions !</A></H2>



<H2><A NAME="ss4.1">4.1 What are good makers of Travan tapes?</A>
</H2>


<P>I was the UNIX Product Manager at Archive Corp (Prior to the Conner/Seagate   
mess) and we performed extensive tests of tape media for compatibility   
certification, including retentivity, flaking and length consistancy.  Based   
on the results of the tests, we selected the best of these certified   
manufacturers' products to private label as our own media.  Here is the   
order in which we selected vendors up through 1995 (when I lost contact   
with the ATI group):</P>
<P>
<DL>
<DT><B>QIC</B><DD>
<P>
<OL>
<LI> 3M (now known as Imation)</LI>
<LI> QMaxell/Sony (tie)</LI>
<LI> (BTW - Iomega uses Sony private-labelled media)</LI>
</OL>
</P>
<DT><B>4MM</B><DD>
<P>
<OL>
<LI> Fuji</LI>
<LI> Maxell/Sony (tie - is this a trend?)</LI>
</OL>
</P>
<DT><B>8MM</B><DD>
<P>
<OL>
<LI> Fuji/Exabyte - which we believed to be OEM'd Fuji (tie - so much for trend!)</LI>
<LI> Sony</LI>
<LI> Maxell</LI>
</OL>
</P>
<DT><B>DLT</B><DD>
<P>
<OL>
<LI> Maxell</LI>
<LI> Sony</LI>
</OL>
</P>
</DL>
</P>
<P>Otherwise, we had entries in our search from other vendors which were   
generally a private-labelled version of one of the major labels above. The   
exceptions were Verbatim and DIC.  Both of these manufacturer's media had   
fall-out rates and length discrepancies that were so high that we would not   
certify them and even warned customers about them indicating that we could   
not offer any sort of guarantee that they would get a good backup using the   
media from these manufacturers.</P>
<P>In addition, since coming to EST, I've found that Verbatim media is still   
not worth the money saved in purchasing it.  We have 11 of their TR-Extra   
and QIC-Extra (QICXL) tapes that were useless after fewer than 20 passes each.</P>
<P>While this is my personal opinion, it is based on over 9 years of experience   
with this very question, I strongly recommend Imation/3M media for QIC/Travan   
user, Fuji media 4MM users, Exabyte/Fuji for 8MM and DEC labelled media   
for DLT users.</P>
<P>&lt;answer from Tim Jones&gt;</P>

<H2><A NAME="ss4.2">4.2 Where can I obtain the QIC standards?</A>
</H2>


<P>If you wish to help developing <EM>Ftape</EM>, or add some utility  
(e.g. a tape formatting program), you will need that appropriate QIC  
standards.  The standard(s) to get is: QIC-80, -117, -3010, and 3020.  
QIC-117 describes how commands are sent to the tape drive (including  
timing etc), so you would probably never need it.  QIC-80/3010/3020  
describes higher level part, such as tape layout, ECC code, standard  
filesystem.  You can get the QIC standards from the following address:  </P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
Quarter Inch Cartridge Drive Standards, Inc.
311 East Carrillo Street
Santa Barbara, California 93101
Phone: (805) 963-3853
Fax:   (805) 962-1541
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Note: They are registered as `Freeman Associates, Inc' in the phone  
book.</P>
<P>&lt;from the Ftape-Howto&gt;</P>

<H2><A NAME="ss4.3">4.3 Is the Iomega Ditto 2GB drive supported?</A>
</H2>


<P>Yes, if you are using version <CODE>ftape-3.x</CODE> or later of the <EM>Ftape
drivers</EM> from the 
<A HREF="http://www-math.math.rwth-aachen.de/~LBFM/claus/ftape/">Ftape Home Page</A> or from
<A HREF="ftp://sunsite.unc.edu/pub/Linux/kernel/tapes">ftp://sunsite.unc.edu/pub/Linux/kernel/tapes</A>.</P>
<P>&lt;answer from Tim Jones&gt;</P>
<P>As the Ditto 2GB is a Tr-3 tape (though it can only store 1GB instead of the  
1.6GB you get with a regular Tr-3 drive) you need an FDC (FDC means: Floppy  
Disk Controller) that is capable of at 1Mbit/sec transfer rate. You don't need  
to worry about this if you have an accellerator card (i.e. the Ditto Dash  
controller). Otherwise try to purchase an FDC that claims to be capable of  
driving 2.88Mb floppies because this implies that the FDC is capable of 1Mbit  
transfer rate.</P>
<P><EM>Ftape</EM> prints the maximum data rate of the FDC to the kernel log
files like this:
<PRE>
ftape-ctl.c (ftape_init_drive) - Highest FDC supported data rate: 500 Kbps.
</PRE>
</P>
<P>&lt;answer from Claus Heine&gt;</P>

<H2><A NAME="ss4.4">4.4 Is the Iomega Ditto Max drive supported?</A>
</H2>


<P>Yes, if you are using version <CODE>ftape-4.02</CODE> or later of the
<EM>Ftape drivers</EM> from the 
<A HREF="http://www-math.math.rwth-aachen.de/~LBFM/claus/ftape/">Ftape Home Page</A> or from 
<A HREF="ftp://sunsite.unc.edu/pub/Linux/kernel/tapes">ftp://sunsite.unc.edu/pub/Linux/kernel/tapes</A>.</P>
<P>&lt;answer from Claus Heine&gt;</P>

<H2><A NAME="ss4.5">4.5 Is the Iomega Ditto Max Pro drive supported?</A>
</H2>


<P>Yes. But if you want to use the 5GB (10GB with compression) cartridges
you don't need it. With <CODE>ftape</CODE> there doesn't seem to be any
difference between the <CODE>Ditto Max</CODE> and the <CODE>Ditto Max Pro</CODE>.</P>
<P>&lt;answer from Claus Heine&gt;</P>

<H2><A NAME="s5">5. Miscellaneous !</A></H2>



<H2><A NAME="ss5.1">5.1 How to subscribe to the Ftape Mailing List?</A>
</H2>


<P>You can subscribe to that list by sending mail to
<BLOCKQUOTE><CODE>
<PRE>
majordomo@vger.rutgers.edu
</PRE>
</CODE></BLOCKQUOTE>

with the single line
<BLOCKQUOTE><CODE>
<PRE>
subscribe linux-tape
</PRE>
</CODE></BLOCKQUOTE>

in its body. Please store the answer you get from majordomo in a safe place   
because it contains instructions how to <CODE>UNSUBSCRIBE</CODE> from the mailing list.</P>
<P>&lt;answer from Claus Heine&gt;</P>

<H2><A NAME="ss5.2">5.2 How to un-subscribe from the Ftape Mailing List?</A>
</H2>


<P>Send mail to
<BLOCKQUOTE><CODE>
<PRE>
majordomo@vger.rutgers.edu
</PRE>
</CODE></BLOCKQUOTE>

with the single line
<BLOCKQUOTE><CODE>
<PRE>
unsubscribe linux-tape MY@EMAIL.ADDRESS
</PRE>
</CODE></BLOCKQUOTE>

where <CODE>MY@EMAIL.ADDRESS</CODE> has to be replaced by the email   
address that you used when subscribing to the list. Note that you must   
have received an email with instructions how to unsubscribe from the   
mailing list at the time you subscribed to it.</P>
<P>&lt;answer from Claus Heine&gt;</P>

<H2><A NAME="ss5.3">5.3 Links to related information.</A>
</H2>



<P>
<A HREF="http://www.uwsg.indiana.edu/usail/library/backups.html">&lt;http://www.uwsg.indiana.edu/usai/library/backups.html&gt;</A></P>
<P>More links wanted !!!</P>


</BODY>
</HTML>
